---
title: 将日志传送升级到 SQL Server 2014 (Transact-sql) |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- log shipping [SQL Server], upgrading
ms.assetid: b1289cc3-f5be-40bb-8801-0e3eed40336e
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 80330d03853c984cfd26100b02918eb218705085
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87591526"
---
# <a name="upgrade-log-shipping-to-sql-server-2014-transact-sql"></a><span data-ttu-id="914c2-102">将日志传送升级到 SQL Server 2014 (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="914c2-102">Upgrade Log Shipping to SQL Server 2014 (Transact-SQL)</span></span>
  <span data-ttu-id="914c2-103">从 [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)]、 [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)]、 [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)]或 [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] 升级到 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]时，有可能保留日志传送配置。</span><span class="sxs-lookup"><span data-stu-id="914c2-103">It is possible to preserve log shipping configurations when upgrading from [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)], [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)], [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)], or [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="914c2-104">本主题介绍升级日志传送配置的备用方案和最佳做法。</span><span class="sxs-lookup"><span data-stu-id="914c2-104">This topic describes alternative scenarios and best practices for upgrading a log shipping configuration.</span></span>

> [!NOTE]
>  <span data-ttu-id="914c2-105">[中引入了](../../relational-databases/backup-restore/backup-compression-sql-server.md) 备份压缩 [!INCLUDE[ssEnterpriseEd10](../../includes/ssenterpriseed10-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="914c2-105">[Backup compression](../../relational-databases/backup-restore/backup-compression-sql-server.md) was introduced in [!INCLUDE[ssEnterpriseEd10](../../includes/ssenterpriseed10-md.md)].</span></span> <span data-ttu-id="914c2-106">升级后的日志传送配置使用“备份压缩默认值”  服务器级配置选项控制是否对事务日志备份文件使用备份压缩。</span><span class="sxs-lookup"><span data-stu-id="914c2-106">An upgraded log shipping configuration uses the **backup compression default** server-level configuration option to control whether backup compression is used for the transaction log backup files.</span></span> <span data-ttu-id="914c2-107">可以为每个日志传送配置指定日志备份的备份压缩行为。</span><span class="sxs-lookup"><span data-stu-id="914c2-107">The backup compression behavior of log backups can be specified for each log shipping configuration.</span></span> <span data-ttu-id="914c2-108">有关详细信息，请参阅[配置日志传送 (SQL Server)](configure-log-shipping-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="914c2-108">For more information, see [Configure Log Shipping &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span></span>


##  <a name="protect-your-data-before-the-upgrade"></a><a name="ProtectData"></a><span data-ttu-id="914c2-109">升级之前保护数据</span><span class="sxs-lookup"><span data-stu-id="914c2-109">Protect Your Data Before the Upgrade</span></span>
 <span data-ttu-id="914c2-110">建议您最好在日志传送升级之前保护好您的数据。</span><span class="sxs-lookup"><span data-stu-id="914c2-110">As a best practice, we recommend that you protect your data before a log shipping upgrade.</span></span>

 <span data-ttu-id="914c2-111">**保护数据**</span><span class="sxs-lookup"><span data-stu-id="914c2-111">**To protect your data**</span></span>

1.  <span data-ttu-id="914c2-112">对各个主数据库执行完整数据库备份。</span><span class="sxs-lookup"><span data-stu-id="914c2-112">Perform a full database backup on every primary database.</span></span>

     <span data-ttu-id="914c2-113">有关详细信息，请参阅 [创建完整数据库备份 (SQL Server)](../../relational-databases/backup-restore/create-a-full-database-backup-sql-server.md)中创建差异数据库备份。</span><span class="sxs-lookup"><span data-stu-id="914c2-113">For more information, see [Create a Full Database Backup &#40;SQL Server&#41;](../../relational-databases/backup-restore/create-a-full-database-backup-sql-server.md).</span></span>

2.  <span data-ttu-id="914c2-114">对各个主数据库运行 [DBCC CHECKDB](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql) 命令。</span><span class="sxs-lookup"><span data-stu-id="914c2-114">Run the [DBCC CHECKDB](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql) command on every primary database.</span></span>

##  <a name="upgrading-the-monitor-server-instance"></a><a name="UpgradeMonitor"></a><span data-ttu-id="914c2-115">升级监视服务器实例</span><span class="sxs-lookup"><span data-stu-id="914c2-115">Upgrading the Monitor Server Instance</span></span>
 <span data-ttu-id="914c2-116">监视服务器实例（如果存在）可随时升级。</span><span class="sxs-lookup"><span data-stu-id="914c2-116">The monitor server instance, if any, can be upgraded at any time.</span></span>

 <span data-ttu-id="914c2-117">升级监视服务器时，日志传送配置仍将有效，但其状态不会记录在监视器上的表中。</span><span class="sxs-lookup"><span data-stu-id="914c2-117">While the monitor server is being upgraded, the log shipping configuration continues to work, but its status is not recorded in the tables on the monitor.</span></span> <span data-ttu-id="914c2-118">监视服务器正在升级期间，已配置的任何警报都不会触发。</span><span class="sxs-lookup"><span data-stu-id="914c2-118">Any alerts that have been configured will not be triggered while the monitor server is being upgraded.</span></span> <span data-ttu-id="914c2-119">升级完毕后，可以通过执行 [sp_refresh_log_shipping_monitor](/sql/relational-databases/system-stored-procedures/sp-refresh-log-shipping-monitor-transact-sql) 系统存储过程来更新监视器表中的信息。</span><span class="sxs-lookup"><span data-stu-id="914c2-119">After the upgrade, you can update the information in the monitor tables by executing the [sp_refresh_log_shipping_monitor](/sql/relational-databases/system-stored-procedures/sp-refresh-log-shipping-monitor-transact-sql) system stored procedure.</span></span>

##  <a name="upgrading-log-shipping-configurations-with-a-single-secondary-server"></a><a name="UpgradeSingleSecondary"></a><span data-ttu-id="914c2-120">使用单个辅助服务器升级日志传送配置</span><span class="sxs-lookup"><span data-stu-id="914c2-120">Upgrading Log Shipping Configurations with a Single Secondary Server</span></span>
 <span data-ttu-id="914c2-121">本节讲述的升级过程适用于由主服务器和唯一一个辅助服务器组成的配置。</span><span class="sxs-lookup"><span data-stu-id="914c2-121">The upgrade process described in this section assumes a configuration consisting of the primary server and only one secondary server.</span></span> <span data-ttu-id="914c2-122">下图显示了此配置，其中 A 为主服务器实例，B 为单一辅助服务器实例。</span><span class="sxs-lookup"><span data-stu-id="914c2-122">This configuration is represented in the following illustration, which shows a primary server instance, A, and a single secondary server instance, B.</span></span>

 <span data-ttu-id="914c2-123">![一台辅助服务器，无监视服务器](../media/ls-2-wayconfig-nomonitor.gif "一台辅助服务器，无监视服务器")</span><span class="sxs-lookup"><span data-stu-id="914c2-123">![One secondary server and no monitor server](../media/ls-2-wayconfig-nomonitor.gif "One secondary server and no monitor server")</span></span>

 <span data-ttu-id="914c2-124">有关升级多个辅助服务器的信息，请参阅本主题后面的 [升级多个辅助服务器实例](#MultipleSecondaries)。</span><span class="sxs-lookup"><span data-stu-id="914c2-124">For information about upgrading multiple secondary servers, see [Upgrading Multiple Secondary Server Instances](#MultipleSecondaries), later in this topic.</span></span>
 

###  <a name="upgrading-the-secondary-server-instance"></a><a name="UpgradeSecondary"></a><span data-ttu-id="914c2-125">升级辅助服务器实例</span><span class="sxs-lookup"><span data-stu-id="914c2-125">Upgrading the Secondary Server Instance</span></span>
 <span data-ttu-id="914c2-126">升级主服务器实例之前的升级过程包括将辅助服务器实例的日志传送配置从 [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] 或更高版本升级到 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="914c2-126">The upgrade process involves upgrading the secondary server instances of a [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] or higher log shipping configuration to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] before upgrading the primary server instance.</span></span> <span data-ttu-id="914c2-127">辅助服务器实例必须总是先于主服务器实例升级。</span><span class="sxs-lookup"><span data-stu-id="914c2-127">Always upgrade the secondary server instance first.</span></span> <span data-ttu-id="914c2-128">由于在较新版本的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 中创建的备份无法在较旧版本的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]中还原，所以如果主服务器先于辅助服务器升级，将导致日志传送失败。</span><span class="sxs-lookup"><span data-stu-id="914c2-128">If the primary server were upgraded before a secondary server, log shipping would fail because a backup created on a newer version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] cannot be restored on an older version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>

 <span data-ttu-id="914c2-129">由于升级后的辅助服务器继续还原 [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] 或更高版本主服务器的日志备份，因此日志传送在整个升级过程中都不间断。</span><span class="sxs-lookup"><span data-stu-id="914c2-129">Log shipping continues throughout the upgrade process because the upgraded secondary servers continue to restore the log backups from the [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] or higher primary server.</span></span> <span data-ttu-id="914c2-130">升级辅助服务器实例的过程部分取决于日志传送配置是否具有多个辅助服务器。</span><span class="sxs-lookup"><span data-stu-id="914c2-130">The process for upgrading the secondary server instances depends partly on whether the log shipping configuration possesses multiple secondary servers.</span></span> <span data-ttu-id="914c2-131">有关详细信息，请参阅本主题后面的 [升级多个辅助服务器实例](#MultipleSecondaries)。</span><span class="sxs-lookup"><span data-stu-id="914c2-131">For more information, see [Upgrading Multiple Secondary Server Instances](#MultipleSecondaries), later in this topic.</span></span>

 <span data-ttu-id="914c2-132">辅助服务器实例正在升级期间，日志传送复制和还原作业不运行，因此未还原的事务日志备份将累积。</span><span class="sxs-lookup"><span data-stu-id="914c2-132">While the secondary server instance is being upgraded, the log shipping copy and restore jobs do not run, so unrestored transaction log backups will accumulate.</span></span> <span data-ttu-id="914c2-133">累积的数量取决于主服务器上进行计划备份的频率。</span><span class="sxs-lookup"><span data-stu-id="914c2-133">The amount of accumulation depends on the frequency of scheduled backup on the primary server.</span></span> <span data-ttu-id="914c2-134">此外，如果还配置了单独的监视服务器，则若未执行还原的时间超过了所配置的时间间隔，就会引发警报。</span><span class="sxs-lookup"><span data-stu-id="914c2-134">Also, if a separate monitor server has been configured, alerts might be raised indicating restores have not been performed for longer than the configured interval.</span></span>

 <span data-ttu-id="914c2-135">辅助服务器升级完毕后，日志传送代理作业即开始继续复制和还原主服务器实例（服务器 A）的日志备份。辅助服务器使辅助数据库达到最新所需的时间会有所不同，具体情况取决于升级辅助服务器占用的时间和主服务器上进行备份的频率。</span><span class="sxs-lookup"><span data-stu-id="914c2-135">Once the secondary server has been upgraded, the log shipping agents jobs resume and continue to copy and restore log backups from the primary server instance, server A. The amount of time required for the secondary server to bring the secondary database up to date varies, depending on the time taken to upgrade the secondary server and the frequency of the backups on the primary server.</span></span>

> [!NOTE]
>  <span data-ttu-id="914c2-136">服务器升级期间，辅助数据库不会升级到 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 数据库。</span><span class="sxs-lookup"><span data-stu-id="914c2-136">During the server upgrade, the secondary database is not upgraded to a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] database.</span></span> <span data-ttu-id="914c2-137">只有联机时它才会升级。</span><span class="sxs-lookup"><span data-stu-id="914c2-137">It will get upgraded only if it is brought online.</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="914c2-138">对于要求升级的数据库，不支持 RESTORE WITH STANDBY 选项。</span><span class="sxs-lookup"><span data-stu-id="914c2-138">The RESTORE WITH STANDBY option is not supported for a database that requires upgrading.</span></span> <span data-ttu-id="914c2-139">如果已使用 RESTORE WITH STANDBY 配置了升级的辅助数据库，则在升级后可能不再能够还原事务日志。</span><span class="sxs-lookup"><span data-stu-id="914c2-139">If an upgraded secondary database has been configured by using RESTORE WITH STANDBY, transaction logs can no longer be restored after upgrade.</span></span> <span data-ttu-id="914c2-140">要对该辅助数据库恢复日志传送，您需要再次对该备用服务器设置日志传送。</span><span class="sxs-lookup"><span data-stu-id="914c2-140">To resume log shipping on that secondary database, you will need to set up log shipping again on that standby server.</span></span> <span data-ttu-id="914c2-141">有关 "备用" 选项的详细信息，请参阅[RESTORE Arguments &#40;transact-sql&#41;](/sql/t-sql/statements/restore-statements-arguments-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="914c2-141">For more information about the STANDBY option, see [RESTORE Arguments &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-arguments-transact-sql).</span></span>

###  <a name="upgrading-the-primary-server-instance"></a><a name="UpgradePrimary"></a> <span data-ttu-id="914c2-142">升级主服务器实例</span><span class="sxs-lookup"><span data-stu-id="914c2-142">Upgrading the Primary Server Instance</span></span>
 <span data-ttu-id="914c2-143">计划升级时，需要考虑的一个重要事项是数据库将处于不可用状态的时间。</span><span class="sxs-lookup"><span data-stu-id="914c2-143">When planning an upgrade, a significant consideration is the amount of time that your database will be unavailable.</span></span> <span data-ttu-id="914c2-144">最简单的升级方案（下文的方案 1）将使得数据库在主服务器升级期间不可用。</span><span class="sxs-lookup"><span data-stu-id="914c2-144">The simplest upgrade scenario involves the database being unavailable while you upgrade the primary server (scenario 1, below).</span></span>

 <span data-ttu-id="914c2-145">如果能在升级原始主服务器之前，将 [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] 或更高版本主服务器故障转移到 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 辅助服务器（下文的方案 2），则可以最大限度地提高数据库的可用性，但这样做会加大升级过程的复杂程度。</span><span class="sxs-lookup"><span data-stu-id="914c2-145">At the cost of a more complicated upgrade process, you can maximize your database availability by failing over the [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] or higher primary server to a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] secondary server before upgrading the original primary server (scenario 2, below).</span></span> <span data-ttu-id="914c2-146">故障转移方案有两种不同的形式。</span><span class="sxs-lookup"><span data-stu-id="914c2-146">There are two variants of the failover scenario.</span></span> <span data-ttu-id="914c2-147">一种是切换回原始主服务器并保持原始日志传送配置。</span><span class="sxs-lookup"><span data-stu-id="914c2-147">You can switch back to the original primary server and keep the original log shipping configuration.</span></span> <span data-ttu-id="914c2-148">另一种是在升级原始主服务器之前删除原始日志传送配置，随后使用新的主服务器创建新配置。</span><span class="sxs-lookup"><span data-stu-id="914c2-148">Alternatively, you can remove the original log shipping configuration before upgrading the original primary server and later create a new configuration using the new primary server.</span></span> <span data-ttu-id="914c2-149">本节介绍这两种方案。</span><span class="sxs-lookup"><span data-stu-id="914c2-149">This section describes both these scenarios.</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="914c2-150">一定要先升级辅助服务器实例，然后再升级主服务器实例。</span><span class="sxs-lookup"><span data-stu-id="914c2-150">Be sure to upgrade the secondary server instance before upgrading the primary server instance.</span></span> <span data-ttu-id="914c2-151">有关详细信息，请参阅本主题前面的 [升级辅助服务器实例](#UpgradeSecondary)。</span><span class="sxs-lookup"><span data-stu-id="914c2-151">For more information, see [Upgrading the Secondary Server Instance](#UpgradeSecondary), earlier in this topic.</span></span>


####  <a name="scenario-1-upgrade-primary-server-instance-without-failover"></a><a name="Scenario1"></a><span data-ttu-id="914c2-152">方案1：在没有故障转移的情况下升级主服务器实例</span><span class="sxs-lookup"><span data-stu-id="914c2-152">Scenario 1: Upgrade Primary Server Instance Without Failover</span></span>
 <span data-ttu-id="914c2-153">这个方案比较简单，但导致的停机时间要比使用故障转移时间长。</span><span class="sxs-lookup"><span data-stu-id="914c2-153">This is the simpler scenario, but it causes more downtime than using failover.</span></span> <span data-ttu-id="914c2-154">主服务器实例进行简单的升级，数据库在升级期间不可用。</span><span class="sxs-lookup"><span data-stu-id="914c2-154">The primary server instance is simply upgraded and the database is unavailable during this upgrade.</span></span>

 <span data-ttu-id="914c2-155">服务器升级完毕后，数据库即自动回到联机状态，随即进行升级。</span><span class="sxs-lookup"><span data-stu-id="914c2-155">Once the server is upgraded, the database is automatically brought back online, which causes it to be upgraded.</span></span> <span data-ttu-id="914c2-156">数据库升级完毕后，日志传送作业将继续进行。</span><span class="sxs-lookup"><span data-stu-id="914c2-156">After the database is upgraded, the log shipping jobs resume.</span></span>

#### <a name="scenario-2-upgrade-primary-server-instance-with-failover"></a><span data-ttu-id="914c2-157">方案 2：借助故障转移升级主服务器实例</span><span class="sxs-lookup"><span data-stu-id="914c2-157">Scenario 2: Upgrade Primary Server Instance with Failover</span></span>
 <span data-ttu-id="914c2-158">此方案最大限度地提高了可用性，同时使停机时间降低到最短。</span><span class="sxs-lookup"><span data-stu-id="914c2-158">This scenario maximizes availability and minimizes downtime.</span></span> <span data-ttu-id="914c2-159">此方案采取向辅助服务器实例实行受控故障转移的方式，使数据库在原始主服务器实例升级期间保持可用状态。</span><span class="sxs-lookup"><span data-stu-id="914c2-159">It utilizes a controlled failover to the secondary server instance, which keeps the database available while the original primary server instance is upgraded.</span></span> <span data-ttu-id="914c2-160">停机时间限于故障转移所需的相对短的时间，而不是升级主服务器实例所需的时间。</span><span class="sxs-lookup"><span data-stu-id="914c2-160">Downtime is limited to the relatively short time required to fail over, rather than the time required to upgrade the primary server instance.</span></span>

 <span data-ttu-id="914c2-161">借助故障转移升级主服务器实例一般需要三个过程：执行到辅助服务器的受控故障转移，将原始主服务器实例升级到 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]，在 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 主服务器实例上设置日志传送。</span><span class="sxs-lookup"><span data-stu-id="914c2-161">Upgrading the primary server instance with failover involves three general procedures: performing a controlled failover to the secondary server, upgrading the original primary server instance to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)], and setting up log shipping on a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] primary server instance.</span></span> <span data-ttu-id="914c2-162">本节后面将对这三个过程进行介绍。</span><span class="sxs-lookup"><span data-stu-id="914c2-162">These procedures are described in this section.</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="914c2-163">如果计划使辅助服务器实例成为新的主服务器实例，则需要删除日志传送配置。</span><span class="sxs-lookup"><span data-stu-id="914c2-163">If you plan to have the secondary server instance as the new primary server instance, you need to remove the log shipping configuration.</span></span> <span data-ttu-id="914c2-164">原始主服务器实例升级完毕后，需要重新配置从新的主服务器实例到新的辅助服务器实例的日志传送。</span><span class="sxs-lookup"><span data-stu-id="914c2-164">Log shipping will need to be reconfigured from the new primary to the new secondary, after the original primary server instance has been upgraded.</span></span> <span data-ttu-id="914c2-165">有关详细信息，请参阅[&#40;SQL Server&#41;中删除日志传送](remove-log-shipping-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="914c2-165">For more information, see [Remove Log Shipping &#40;SQL Server&#41;](remove-log-shipping-sql-server.md).</span></span>


#####  <a name="procedure-1-perform-a-controlled-failover-to-the-secondary-server"></a><a name="Procedure1"></a><span data-ttu-id="914c2-166">步骤1：执行到辅助服务器的受控故障转移</span><span class="sxs-lookup"><span data-stu-id="914c2-166">Procedure 1: Perform a Controlled Failover to the Secondary Server</span></span>
 <span data-ttu-id="914c2-167">到辅助服务器的受控故障转移：</span><span class="sxs-lookup"><span data-stu-id="914c2-167">Controlled failover to the secondary server:</span></span>

1.  <span data-ttu-id="914c2-168">在使用 NORECOVERY 指定的主数据库上手动执行事务日志的[结尾日志备份](../../relational-databases/backup-restore/tail-log-backups-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="914c2-168">Manually perform a [tail-log backup](../../relational-databases/backup-restore/tail-log-backups-sql-server.md) of the transaction log on the primary database specifying WITH NORECOVERY.</span></span> <span data-ttu-id="914c2-169">此日志备份捕获任何尚未备份的日志记录并使数据库脱机。</span><span class="sxs-lookup"><span data-stu-id="914c2-169">This log backup captures any log records that have not been backed up yet and takes the database offline.</span></span> <span data-ttu-id="914c2-170">请注意：数据库脱机期间，日志传送备份作业将失败。</span><span class="sxs-lookup"><span data-stu-id="914c2-170">Note that while the database is offline, the log shipping backup job will fail.</span></span>

     <span data-ttu-id="914c2-171">下面的示例在主服务器上创建 `AdventureWorks` 数据库的一个结尾日志备份。</span><span class="sxs-lookup"><span data-stu-id="914c2-171">The following example creates a tail log backup of the `AdventureWorks` database on the primary server.</span></span> <span data-ttu-id="914c2-172">此备份文件名为 `Failover_AW_20080315.trn`：</span><span class="sxs-lookup"><span data-stu-id="914c2-172">The backup file is named `Failover_AW_20080315.trn`:</span></span>

    ```
    BACKUP LOG AdventureWorks 
      TO DISK = N'\\FileServer\LogShipping\AdventureWorks\Failover_AW_20080315.trn' 
       WITH NORECOVERY;
    GO
    ```

     <span data-ttu-id="914c2-173">建议您使用非重复的文件命名约定区分手动创建的备份文件和日志传送备份作业创建的备份文件。</span><span class="sxs-lookup"><span data-stu-id="914c2-173">We recommend that you use a distinct file naming convention to differentiate the manually-created backup file from the backup files created by the log shipping backup job.</span></span>

2.  <span data-ttu-id="914c2-174">在辅助服务器上：</span><span class="sxs-lookup"><span data-stu-id="914c2-174">On the secondary server:</span></span>

    1.  <span data-ttu-id="914c2-175">确保日志传送备份作业自动进行的所有备份都已应用。</span><span class="sxs-lookup"><span data-stu-id="914c2-175">Ensure that all backups taken automatically by the log shipping backup jobs have been applied.</span></span> <span data-ttu-id="914c2-176">若要检查哪些备份作业已应用，请使用监视服务器或主服务器和辅助服务器上的[sp_help_log_shipping_monitor](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-monitor-transact-sql)系统存储过程。</span><span class="sxs-lookup"><span data-stu-id="914c2-176">To check which backup jobs have been applied, use the [sp_help_log_shipping_monitor](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-monitor-transact-sql) system stored procedure on the monitor server or on the primary and secondary servers.</span></span> <span data-ttu-id="914c2-177">同一文件应在 " **last_backup_file**"、" **last_copied_file**" 和 " **last_restored_file** " 列中列出。</span><span class="sxs-lookup"><span data-stu-id="914c2-177">The same file should be listed in the **last_backup_file**, **last_copied_file**, and **last_restored_file** columns.</span></span> <span data-ttu-id="914c2-178">如果尚未复制和还原任何备份文件，则请手动调用代理复制和还原作业以进行日志传送配置。</span><span class="sxs-lookup"><span data-stu-id="914c2-178">If any of the backup files have not been copied and restored, manually invoke the agent copy and restore jobs for the log shipping configuration.</span></span>

         <span data-ttu-id="914c2-179">有关启动作业的信息，请参阅 [Start a Job](../../ssms/agent/start-a-job.md)。</span><span class="sxs-lookup"><span data-stu-id="914c2-179">For information about starting a job, see [Start a Job](../../ssms/agent/start-a-job.md).</span></span>

    2.  <span data-ttu-id="914c2-180">将您在第一步中创建的最后一个日志备份文件从文件共享复制到辅助服务器上的日志传送使用的本地位置。</span><span class="sxs-lookup"><span data-stu-id="914c2-180">Copy your the final log backup file that you created in step 1 from the file share to the local location that is used by log shipping on the secondary server.</span></span>

    3.  <span data-ttu-id="914c2-181">还原指定 WITH RECOVERY 的最后一个日志备份以使数据库联机。</span><span class="sxs-lookup"><span data-stu-id="914c2-181">Restore the final log backup specifying WITH RECOVERY to bring the database online.</span></span> <span data-ttu-id="914c2-182">数据库联机的同时将升级到 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="914c2-182">As part of being brought online, the database will upgraded to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span>

         <span data-ttu-id="914c2-183">下面的示例还原辅助数据库中的 `AdventureWorks` 数据库的结尾日志备份。</span><span class="sxs-lookup"><span data-stu-id="914c2-183">The following example restores the tail log backup of the `AdventureWorks` database on the secondary database.</span></span> <span data-ttu-id="914c2-184">此示例使用 WITH RECOVERY 选项，该选项将使数据库联机：</span><span class="sxs-lookup"><span data-stu-id="914c2-184">The example uses the WITH RECOVERY option, which brings the database online:</span></span>

        ```
        RESTORE LOG AdventureWorks 
          FROM DISK = N'c:\logshipping\Failover_AW_20080315.trn' 
           WITH RECOVERY;
        GO
        ```

        > [!NOTE]
        >  <span data-ttu-id="914c2-185">对于包含多个辅助服务器的配置，还有额外的注意事项。</span><span class="sxs-lookup"><span data-stu-id="914c2-185">For a configuration that contains more than one secondary server, there are additional considerations.</span></span> <span data-ttu-id="914c2-186">有关详细信息，请参阅本主题后面的 [升级多个辅助服务器实例](#MultipleSecondaries)。</span><span class="sxs-lookup"><span data-stu-id="914c2-186">For more information, see [Upgrading Multiple Secondary Server Instances](#MultipleSecondaries), later in this topic.</span></span>

    4.  <span data-ttu-id="914c2-187">将客户端从原始主服务器（服务器 A）重定向到联机辅助服务器（服务器 B），以对数据库进行故障转移。</span><span class="sxs-lookup"><span data-stu-id="914c2-187">Fail over the database by redirecting clients from the original primary server (server A) to the online secondary server (server B).</span></span>

    5.  <span data-ttu-id="914c2-188">请注意：辅助数据库在处于联机状态时，它的事务日志并未填满。</span><span class="sxs-lookup"><span data-stu-id="914c2-188">Take care that the transaction log of the secondary database does not fill while the database is online.</span></span> <span data-ttu-id="914c2-189">若要阻止事务日志填满，可能需要备份此日志。</span><span class="sxs-lookup"><span data-stu-id="914c2-189">To prevent the transaction log from filling, you might need to back it up.</span></span> <span data-ttu-id="914c2-190">如果是这样，建议您将它备份到共享位置，即备份到“备份共享” \*\*，以便在其他服务器实例上可以还原这些备份。</span><span class="sxs-lookup"><span data-stu-id="914c2-190">If so, we recommend that you back it up to a shared location, a *backup share*, to make the backups available for restoring on the other server instance.</span></span>

#####  <a name="procedure-2-upgrade-the-original-primary-server-instance-to-sscurrent"></a><a name="Procedure2"></a><span data-ttu-id="914c2-191">过程2：将原始主服务器实例升级到[!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]</span><span class="sxs-lookup"><span data-stu-id="914c2-191">Procedure 2: Upgrade the Original Primary Server Instance to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]</span></span>
 <span data-ttu-id="914c2-192">将原始主服务器实例升级到 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]后，数据库仍将处于脱机状态且仍采用该格式。</span><span class="sxs-lookup"><span data-stu-id="914c2-192">After you upgrade the original primary server instance to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)], the database will still be offline and in the format.</span></span>

#####  <a name="procedure-3-set-up-log-shipping-on-sscurrent"></a><a name="Procedure3"></a><span data-ttu-id="914c2-193">步骤3：在上设置日志传送[!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]</span><span class="sxs-lookup"><span data-stu-id="914c2-193">Procedure 3: Set Up Log Shipping on [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]</span></span>
 <span data-ttu-id="914c2-194">剩余的升级过程取决于是否仍配置日志传送，如下所述：</span><span class="sxs-lookup"><span data-stu-id="914c2-194">The rest of the upgrade process depends on whether log shipping is still configured, as follows:</span></span>

-   <span data-ttu-id="914c2-195">如果保留了 [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)]或更高版本日志传送配置，则请切换回原始主服务器实例。</span><span class="sxs-lookup"><span data-stu-id="914c2-195">If you have kept the [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)]or higher log shipping configuration, switch back to the original primary server instance.</span></span> <span data-ttu-id="914c2-196">有关详细信息，请参阅本节后面的 [切换回原始主服务器实例](#SwitchToOrigPrimary)。</span><span class="sxs-lookup"><span data-stu-id="914c2-196">For more information, see [To Switch Back to the Original Primary Server Instance](#SwitchToOrigPrimary), later in this section.</span></span>

-   <span data-ttu-id="914c2-197">如果在进行故障转移之前删除了日志传送配置，则请创建一个新的日志传送配置，其中原始辅助服务器实例是新的主服务器实例。</span><span class="sxs-lookup"><span data-stu-id="914c2-197">If you removed the log shipping configuration before failing over, create a new log shipping configuration in which the original secondary server instance is the new primary server instance.</span></span> <span data-ttu-id="914c2-198">有关详细信息，请参阅本节后面的 [将原来的辅助服务器实例作为新的主服务器实例](#KeepOldSecondaryAsNewPrimary)。</span><span class="sxs-lookup"><span data-stu-id="914c2-198">For more information, see [To Keep the Old Secondary Server Instance As the New Primary Server Instance](#KeepOldSecondaryAsNewPrimary), later in this section.</span></span>

######  <a name="to-switch-back-to-the-original-primary-server-instance"></a><a name="SwitchToOrigPrimary"></a><span data-ttu-id="914c2-199">切换回原始主服务器实例</span><span class="sxs-lookup"><span data-stu-id="914c2-199">To Switch Back to the Original Primary Server Instance</span></span>

1.  <span data-ttu-id="914c2-200">在临时主服务器（服务器 B）上使用 WITH NORECOVERY 备份日志尾部，以创建结尾日志备份并使数据库脱机。</span><span class="sxs-lookup"><span data-stu-id="914c2-200">On the interim primary server (server B), back up the tail of the log using WITH NORECOVERY to create a tail-log backup and take the database offline.</span></span> <span data-ttu-id="914c2-201">该结尾日志备份命名为 `Switchback_AW_20080315.trn`。例如：</span><span class="sxs-lookup"><span data-stu-id="914c2-201">The tail log backup is named `Switchback_AW_20080315.trn`.For example:</span></span>

    ```
    BACKUP LOG AdventureWorks 
      TO DISK = N'\\FileServer\LogShipping\AdventureWorks\Switchback_AW_20080315.trn' 
       WITH NORECOVERY;
    GO
    ```

2.  <span data-ttu-id="914c2-202">如果任何事务日志备份都是在临时主数据库上进行的，则将那些使用 WITH NORECOVERY 的日志备份（不包括在第一步中创建的结尾备份）还原到原始主服务器（服务器 A）上的脱机数据库。</span><span class="sxs-lookup"><span data-stu-id="914c2-202">If any transaction log backups were taken on the interim primary database, other than the tail backup that you created in step 1, restore those log backups using WITH NORECOVERY to the offline database on the original primary server (server A).</span></span> <span data-ttu-id="914c2-203">第一个日志备份还原后，数据库即升级到 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 格式。</span><span class="sxs-lookup"><span data-stu-id="914c2-203">The database is upgraded to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] format when the first log backup is restored.</span></span>

3.  <span data-ttu-id="914c2-204">在原始主数据库上（即在服务器 A 上）使用 WITH RECOVERY 还原结尾日志备份 `Switchback_AW_20080315.trn`，从而使数据库联机。</span><span class="sxs-lookup"><span data-stu-id="914c2-204">Restore the tail-log backup, `Switchback_AW_20080315.trn`, on the original primary database (on server A) using WITH RECOVERY to bring the database online.</span></span>

4.  <span data-ttu-id="914c2-205">将客户端从原始主服务器重定向到联机辅助服务器，从而故障转移回原始主数据库（位于服务器 A 上）。</span><span class="sxs-lookup"><span data-stu-id="914c2-205">Fail over back to the original primary database (on server A) by redirecting clients to the online secondary server from the original primary server.</span></span>

 <span data-ttu-id="914c2-206">数据库联机后，原始日志传送配置将恢复。</span><span class="sxs-lookup"><span data-stu-id="914c2-206">After the database comes online, the original log shipping configuration will resume.</span></span>

######  <a name="to-keep-the-old-secondary-server-instance-as-the-new-primary-server-instance"></a><a name="KeepOldSecondaryAsNewPrimary"></a><span data-ttu-id="914c2-207">保留旧的辅助服务器实例作为新的主服务器实例</span><span class="sxs-lookup"><span data-stu-id="914c2-207">To Keep the Old Secondary Server Instance As the New Primary Server Instance</span></span>
 <span data-ttu-id="914c2-208">按照下面所述建立新的日志传送配置，其中原来的辅助服务器实例 B 用作主服务器，而原来的主服务器实例 A 用作新的辅助服务器：</span><span class="sxs-lookup"><span data-stu-id="914c2-208">Establish a new log shipping configuration using the old secondary server instance, B, as the primary server and the old primary server instance, A, as the new secondary server, as follows:</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="914c2-209">在此过程开始时且在进行使数据库脱机的手动事务日志备份之前，应该已从原始主服务器上删除原来的日志传送配置。</span><span class="sxs-lookup"><span data-stu-id="914c2-209">The old log shipping configuration should have been removed from the original primary server at the start of the process before taking the manual transaction log backup that took the database offline.</span></span>

1.  <span data-ttu-id="914c2-210">若要避免对新的辅助服务器（服务器 A）上的数据库执行完整的备份和还原，请将新的主数据库的日志备份应用到新的辅助数据库。</span><span class="sxs-lookup"><span data-stu-id="914c2-210">To avoid performing a complete backup and restore of the database on the new secondary server (server A), apply the log backups from the new primary database to the new secondary database.</span></span> <span data-ttu-id="914c2-211">在示例配置中，这包括将在服务器 B 上进行的日志备份还原到服务器 A 上的数据库。</span><span class="sxs-lookup"><span data-stu-id="914c2-211">In the example configuration, this involves restoring the log backups taken on server B to the database on server A.</span></span>

2.  <span data-ttu-id="914c2-212">备份新的主数据库（位于服务器 B 上）的日志。</span><span class="sxs-lookup"><span data-stu-id="914c2-212">Back up the log from the new primary database (on server B).</span></span>

3.  <span data-ttu-id="914c2-213">使用 WITH NORECOVERY 将日志备份还原到新的辅助服务器实例（服务器 A）。</span><span class="sxs-lookup"><span data-stu-id="914c2-213">Restore the log backups to the new secondary server instance (server A) using WITH NORECOVERY.</span></span> <span data-ttu-id="914c2-214">第一个还原操作将数据库升级到 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="914c2-214">The first restore operation updates the database to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span>

4.  <span data-ttu-id="914c2-215">配置日志传送，使原来的辅助服务器（服务器 B）作为主服务器实例。</span><span class="sxs-lookup"><span data-stu-id="914c2-215">Configure log shipping with the former secondary server (server B) as the primary server instance.</span></span>

    > [!IMPORTANT]
    >  <span data-ttu-id="914c2-216">如果使用 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]，请指定辅助数据库已初始化。</span><span class="sxs-lookup"><span data-stu-id="914c2-216">If you use [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], specify that the secondary database is already initialized.</span></span>

     <span data-ttu-id="914c2-217">有关详细信息，请参阅[配置日志传送 (SQL Server)](configure-log-shipping-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="914c2-217">For more information, see [Configure Log Shipping &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span></span>

5.  <span data-ttu-id="914c2-218">将客户端从原始主服务器（服务器 A）重定向到联机辅助服务器（服务器 B），以对数据库进行故障转移。</span><span class="sxs-lookup"><span data-stu-id="914c2-218">Fail over the database by redirecting clients from the original primary server (server A) to the online secondary server (server B).</span></span>

    > [!IMPORTANT]
    >  <span data-ttu-id="914c2-219">故障转移到新的主数据库时，应确保其元数据与原始主数据库的元数据一致。</span><span class="sxs-lookup"><span data-stu-id="914c2-219">When you failover to a new primary database, you should ensure that its metadata is consistent with the metadata of the original primary database.</span></span> <span data-ttu-id="914c2-220">有关详细信息，请参阅 [当数据库在其他服务器实例上可用时管理元数据 (SQL Server)](../../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md)。</span><span class="sxs-lookup"><span data-stu-id="914c2-220">For more information, see [Manage Metadata When Making a Database Available on Another Server Instance &#40;SQL Server&#41;](../../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md).</span></span>

##  <a name="upgrading-multiple-secondary-server-instances"></a><a name="MultipleSecondaries"></a><span data-ttu-id="914c2-221">升级多个辅助服务器实例</span><span class="sxs-lookup"><span data-stu-id="914c2-221">Upgrading Multiple Secondary Server Instances</span></span>
 <span data-ttu-id="914c2-222">下图显示了此配置，其中 A 为主服务器实例，B 和 C 都是辅助服务器实例。</span><span class="sxs-lookup"><span data-stu-id="914c2-222">This configuration is represented in the following illustration, which shows a primary server instance, A, and two secondary server instances, B and C.</span></span>

 <span data-ttu-id="914c2-223">![两台辅助服务器，无监视服务器](../media/ls-3-wayconfig-nomonitor.gif "两台辅助服务器，无监视服务器")</span><span class="sxs-lookup"><span data-stu-id="914c2-223">![Two secondary servers and no monitor server](../media/ls-3-wayconfig-nomonitor.gif "Two secondary servers and no monitor server")</span></span>

 <span data-ttu-id="914c2-224">本节讨论如何使用故障转移进行升级，然后再切换回原始主服务器。</span><span class="sxs-lookup"><span data-stu-id="914c2-224">This section discusses how to upgrade using a failover and then switching back to the original primary server.</span></span> <span data-ttu-id="914c2-225">如果有多个辅助服务器实例，则借助故障转移升级主实例的过程将更加复杂。</span><span class="sxs-lookup"><span data-stu-id="914c2-225">When upgrading the primary instance with failover the process is more complex when there are multiple secondary server instances.</span></span> <span data-ttu-id="914c2-226">在下面的过程中，所有辅助服务器升级完毕后，主服务器故障转移到其中一个已升级的辅助数据库。</span><span class="sxs-lookup"><span data-stu-id="914c2-226">In the following procedure, after all the secondary servers are upgraded, the primary server is failed over to one of the upgraded secondary databases.</span></span> <span data-ttu-id="914c2-227">原始主服务器得到升级，然后日志传送重新故障转移到原始主服务器。</span><span class="sxs-lookup"><span data-stu-id="914c2-227">The original primary server is upgraded, and log shipping is failed over back to it.</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="914c2-228">必须先对所有辅助服务器实例进行升级，然后再升级主服务器。</span><span class="sxs-lookup"><span data-stu-id="914c2-228">Always upgrade all the secondary server instances before you upgrade the primary server.</span></span>

 <span data-ttu-id="914c2-229">**借助故障转移进行升级，然后切换回原始主服务器**</span><span class="sxs-lookup"><span data-stu-id="914c2-229">**To upgrade using a failover and then switching back to original primary server**</span></span>

1.  <span data-ttu-id="914c2-230">升级全部辅助服务器实例（服务器 B 和服务器 C）。</span><span class="sxs-lookup"><span data-stu-id="914c2-230">Upgrade all the secondary server instances (server B and server C).</span></span>

2.  <span data-ttu-id="914c2-231">获取主数据库（位于服务器 A 上）的事务日志尾部，并使用 WITH NORECOVERY 备份此事务日志，以使该数据库脱机。</span><span class="sxs-lookup"><span data-stu-id="914c2-231">Obtain the tail of the transaction log of the primary database (on server A), and take the database offline, by backing up the transaction log using WITH NORECOVERY.</span></span>

3.  <span data-ttu-id="914c2-232">通过使用 WITH RECOVERY 还原日志备份，使您计划故障转移到的辅助服务器（服务器 B）上的辅助数据库联机。</span><span class="sxs-lookup"><span data-stu-id="914c2-232">On the secondary server to which you plan to fail over (server B), bring the secondary database online, by restoring the log backup using WITH RECOVERY.</span></span>

4.  <span data-ttu-id="914c2-233">在所有其他辅助服务器（服务器 C）上，通过使用 WITH NORECOVERY 还原日志备份，使辅助数据库仍处于脱机状态。</span><span class="sxs-lookup"><span data-stu-id="914c2-233">On every other secondary server (server C), leave the secondary database offline by restoring the log backup using WITH NORECOVERY.</span></span>

    > [!NOTE]
    >  <span data-ttu-id="914c2-234">日志传送复制和还原作业将在辅助服务器上运行，但由于新的日志备份文件不会放在备份共享中，因此这些作业不执行任何操作。</span><span class="sxs-lookup"><span data-stu-id="914c2-234">The log shipping copy and restore jobs will run on the secondary servers, but the jobs will do nothing because new log-backup files will not be placed on the backup share.</span></span>

5.  <span data-ttu-id="914c2-235">将客户端从原始主服务器（服务器 A）重定向到联机辅助服务器（服务器 B），以对数据库进行故障转移。</span><span class="sxs-lookup"><span data-stu-id="914c2-235">Fail over the database by redirecting clients from the original primary server (server A) to the online secondary server (server B).</span></span> <span data-ttu-id="914c2-236">联机数据库将成为临时主服务器，从而保持该数据库在原始主服务器（服务器 A）脱机期间仍可用。</span><span class="sxs-lookup"><span data-stu-id="914c2-236">The online database becomes an interim primary server, keeping the database available while the original primary server is offline (server A).</span></span>

6.  <span data-ttu-id="914c2-237">升级原始主服务器（服务器 A）。</span><span class="sxs-lookup"><span data-stu-id="914c2-237">Upgrade the original primary server (server A).</span></span>

7.  <span data-ttu-id="914c2-238">在对其进行故障转移的数据库上-临时主数据库 (服务器 B 上) 上，使用 WITH NORECOVERY 手动备份事务日志。</span><span class="sxs-lookup"><span data-stu-id="914c2-238">On the database to which you failed over-the interim primary database (on server B), manually back up the transaction log using WITH NORECOVERY.</span></span> <span data-ttu-id="914c2-239">这将使该数据库脱机。</span><span class="sxs-lookup"><span data-stu-id="914c2-239">This takes the database offline.</span></span>

8.  <span data-ttu-id="914c2-240">将使用 WITH NORECOVERY 在临时主数据库（位于服务器 B 上）上创建的所有事务日志备份还原到所有其他辅助数据库（位于服务器 C 上）。</span><span class="sxs-lookup"><span data-stu-id="914c2-240">Restore all transaction log backups that you created on the interim primary database (on server B) to every other secondary database (on server C) using WITH NORECOVERY.</span></span> <span data-ttu-id="914c2-241">从而在原始主数据库升级后，可以继续从其进行日志传送，而无需对每个辅助数据库进行完全的数据库还原。</span><span class="sxs-lookup"><span data-stu-id="914c2-241">This allows log shipping to continue from the original primary database after its upgrade, without requiring a full database restore on each secondary database.</span></span>

9. <span data-ttu-id="914c2-242">使用 WITH RECOVERY 将临时主服务器（服务器 B）上的事务日志还原到的原始主数据库（位于服务器 A 上）。</span><span class="sxs-lookup"><span data-stu-id="914c2-242">Restore the transaction log from the interim primary server (server B) to the original primary database (on server A) using WITH RECOVERY.</span></span>

##  <a name="redeploying-log-shipping"></a><a name="Redeploying"></a><span data-ttu-id="914c2-243">重新部署日志传送</span><span class="sxs-lookup"><span data-stu-id="914c2-243">Redeploying Log Shipping</span></span>
 <span data-ttu-id="914c2-244">如果不想使用上述过程之一迁移日志传送配置，可以通过使用主数据库的完整备份和恢复来重新初始化辅助数据库，从而从头开始重新部署日志传送。</span><span class="sxs-lookup"><span data-stu-id="914c2-244">If you do not want to migrate your log shipping configuration using one of the procedures shown above, you can redeploy log shipping from scratch by reinitializing your secondary database with a full backup and restore of the primary database.</span></span> <span data-ttu-id="914c2-245">如果数据库较小，或者在升级过程中高可用性并不是至关重要的，此方法将是个不错的选择。</span><span class="sxs-lookup"><span data-stu-id="914c2-245">This may be a desirable option if you have a small database or if high availability is not crucial during the upgrade procedure.</span></span>

 <span data-ttu-id="914c2-246">有关启用日志传送的信息，请参阅[配置日志传送 &#40;SQL Server&#41;](configure-log-shipping-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="914c2-246">For information about enabling log shipping, see [Configure Log Shipping &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="914c2-247">另请参阅</span><span class="sxs-lookup"><span data-stu-id="914c2-247">See Also</span></span>
 <span data-ttu-id="914c2-248">[事务日志备份 &#40;SQL Server&#41;](../../relational-databases/backup-restore/transaction-log-backups-sql-server.md) [应用事务日志备份 &#40;SQL Server&#41;](../../relational-databases/backup-restore/apply-transaction-log-backups-sql-server.md) [日志传送表和存储过程](log-shipping-tables-and-stored-procedures.md)</span><span class="sxs-lookup"><span data-stu-id="914c2-248">[Transaction Log Backups &#40;SQL Server&#41;](../../relational-databases/backup-restore/transaction-log-backups-sql-server.md) [Apply Transaction Log Backups &#40;SQL Server&#41;](../../relational-databases/backup-restore/apply-transaction-log-backups-sql-server.md) [Log Shipping Tables and Stored Procedures](log-shipping-tables-and-stored-procedures.md)</span></span>
