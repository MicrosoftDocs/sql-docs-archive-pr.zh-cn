---
title: SQL Server 2014 中数据库引擎功能的重大更改 |Microsoft Docs
ms.custom: ''
ms.date: 01/19/2019
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: release-landing
ms.topic: conceptual
helpviewer_keywords:
- Database Engine [SQL Server], what's new
- breaking changes [SQL Server]
ms.assetid: 47edefbd-a09b-4087-937a-453cd5c6e061
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: bf1a25aabde1e684407218da7365ae7a2b4265a7
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87694130"
---
# <a name="breaking-changes-to-database-engine-features-in-sql-server-2014"></a><span data-ttu-id="521f9-102">SQL Server 2014 中数据库引擎功能的重大更改</span><span class="sxs-lookup"><span data-stu-id="521f9-102">Breaking Changes to Database Engine Features in SQL Server 2014</span></span>
  <span data-ttu-id="521f9-103">本主题介绍 [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)] [!INCLUDE[ssDE](../includes/ssde-md.md)] 和早期版本中的重大更改 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="521f9-103">This topic describes breaking changes in the [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)] [!INCLUDE[ssDE](../includes/ssde-md.md)] and earlier versions of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="521f9-104">这些更改可能导致基于 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]的早期版本的应用程序、脚本或功能无法继续使用。</span><span class="sxs-lookup"><span data-stu-id="521f9-104">These changes might break applications, scripts, or functionalities that are based on earlier versions of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="521f9-105">在进行升级时可能会遇到这些问题。</span><span class="sxs-lookup"><span data-stu-id="521f9-105">You might encounter these issues when you upgrade.</span></span> <span data-ttu-id="521f9-106">有关详细信息，请参阅 [Use Upgrade Advisor to Prepare for Upgrades](../sql-server/install/use-upgrade-advisor-to-prepare-for-upgrades.md)。</span><span class="sxs-lookup"><span data-stu-id="521f9-106">For more information, see [Use Upgrade Advisor to Prepare for Upgrades](../sql-server/install/use-upgrade-advisor-to-prepare-for-upgrades.md).</span></span>  
  
##  <a name="breaking-changes-in-sssql14"></a><a name="SQL14"></a><span data-ttu-id="521f9-107">[!INCLUDE[ssSQL14](../includes/sssql14-md.md)] 中的重大更改</span><span class="sxs-lookup"><span data-stu-id="521f9-107">Breaking Changes in [!INCLUDE[ssSQL14](../includes/sssql14-md.md)]</span></span>  
 <span data-ttu-id="521f9-108">没有新问题。</span><span class="sxs-lookup"><span data-stu-id="521f9-108">No new issues.</span></span>  
  
##  <a name="breaking-changes-in-sssql11"></a><a name="Denali"></a><span data-ttu-id="521f9-109">中的重大更改[!INCLUDE[ssSQL11](../includes/sssql11-md.md)]</span><span class="sxs-lookup"><span data-stu-id="521f9-109">Breaking Changes in [!INCLUDE[ssSQL11](../includes/sssql11-md.md)]</span></span>  
  
### <a name="transact-sql"></a><span data-ttu-id="521f9-110">Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="521f9-110">Transact-SQL</span></span>  
  
|<span data-ttu-id="521f9-111">功能</span><span class="sxs-lookup"><span data-stu-id="521f9-111">Feature</span></span>|<span data-ttu-id="521f9-112">说明</span><span class="sxs-lookup"><span data-stu-id="521f9-112">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="521f9-113">从名为 NEXT 的列或表中进行选择</span><span class="sxs-lookup"><span data-stu-id="521f9-113">Selecting from columns or tables named NEXT</span></span>|<span data-ttu-id="521f9-114">序列使用 ANSI 标准 NEXT VALUE FOR 函数。</span><span class="sxs-lookup"><span data-stu-id="521f9-114">Sequences use the ANSI standard NEXT VALUE FOR function.</span></span> <span data-ttu-id="521f9-115">如果表或列的名称为 NEXT，并且表或列的别名为值，并且省略了 ANSI 标准，则结果语句可能会导致错误。</span><span class="sxs-lookup"><span data-stu-id="521f9-115">If a table or a column is named NEXT and the table or column is aliased as VALUE, and if the ANSI standard AS is omitted, the resultant statement can cause an error.</span></span> <span data-ttu-id="521f9-116">若要解决这个问题，请包括 ANSI 标准 AS 关键字。</span><span class="sxs-lookup"><span data-stu-id="521f9-116">To work around, include the ANSI standard AS keyword.</span></span> <span data-ttu-id="521f9-117">例如，`SELECT NEXT VALUE FROM Table` 应被重写为 `SELECT NEXT AS VALUE FROM Table`，`SELECT Col1 FROM NEXT VALUE` 应被重写为 `SELECT Col1 FROM NEXT AS VALUE`。</span><span class="sxs-lookup"><span data-stu-id="521f9-117">For example, `SELECT NEXT VALUE FROM Table` should be rewritten as `SELECT NEXT AS VALUE FROM Table` and `SELECT Col1 FROM NEXT VALUE` should be rewritten as `SELECT Col1 FROM NEXT AS VALUE`.</span></span>|  
|<span data-ttu-id="521f9-118">PIVOT 运算符</span><span class="sxs-lookup"><span data-stu-id="521f9-118">PIVOT operator</span></span>|<span data-ttu-id="521f9-119">当数据库兼容性级别设置为 110 时，不允许在递归公用表表达式 (CTE) 查询中使用 PIVOT 运算符。</span><span class="sxs-lookup"><span data-stu-id="521f9-119">The PIVOT operator is not allowed in a recursive common table expression (CTE) query when the database compatibility level is set to 110.</span></span> <span data-ttu-id="521f9-120">重写该查询，或将兼容性级别设置为 100 或更低。</span><span class="sxs-lookup"><span data-stu-id="521f9-120">Rewrite the query, or change the compatibility level to 100 or lower.</span></span> <span data-ttu-id="521f9-121">当每个分组有多个行时，在递归 CTE 查询中使用 PIVOT 会产生不正确的结果。</span><span class="sxs-lookup"><span data-stu-id="521f9-121">Using PIVOT in a recursive CTE query produces incorrect results when there is more than a single row per grouping.</span></span>|  
|<span data-ttu-id="521f9-122">sp_setapprole 和 sp_unsetapprole</span><span class="sxs-lookup"><span data-stu-id="521f9-122">sp_setapprole and sp_unsetapprole</span></span>|<span data-ttu-id="521f9-123">`OUTPUT` 的 cookie `sp_setapprole` 参数当前记载为 `varbinary(8000)`，这是正确的最大长度。</span><span class="sxs-lookup"><span data-stu-id="521f9-123">The cookie `OUTPUT` parameter for `sp_setapprole` is currently documented as `varbinary(8000)` which is the correct maximum length.</span></span> <span data-ttu-id="521f9-124">但是，当前实现返回 `varbinary(50)`。</span><span class="sxs-lookup"><span data-stu-id="521f9-124">However the current implementation returns `varbinary(50)`.</span></span> <span data-ttu-id="521f9-125">应用程序应继续保留 `varbinary(8000)`，以便当 cookie 在将来的版本中返回大小增量时，应用程序可继续正确运行。</span><span class="sxs-lookup"><span data-stu-id="521f9-125">Applications should continue to reserve `varbinary(8000)` so that the application continues to operate correctly if the cookie return size increases in a future release.</span></span> <span data-ttu-id="521f9-126">有关详细信息，请参阅 [sp_setapprole (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-setapprole-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="521f9-126">For more information, see [sp_setapprole &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-setapprole-transact-sql).</span></span>|  
|<span data-ttu-id="521f9-127">EXECUTE AS</span><span class="sxs-lookup"><span data-stu-id="521f9-127">EXECUTE AS</span></span>|<span data-ttu-id="521f9-128">EXECUTE AS 的 cookie OUTPUT 参数当前记载为 `varbinary(8000)`，这是正确的最大长度。</span><span class="sxs-lookup"><span data-stu-id="521f9-128">The cookie OUTPUT parameter for EXECUTE AS is currently documented as `varbinary(8000)` which is the correct maximum length.</span></span> <span data-ttu-id="521f9-129">但是，当前实现返回 `varbinary(100)`。</span><span class="sxs-lookup"><span data-stu-id="521f9-129">However the current implementation returns `varbinary(100)`.</span></span> <span data-ttu-id="521f9-130">应用程序应继续保留 `varbinary(8000)`，以便当 cookie 在将来的版本中返回大小增量时，应用程序可继续正确运行。</span><span class="sxs-lookup"><span data-stu-id="521f9-130">Applications should continue to reserve `varbinary(8000)` so that the application continues to operate correctly if the cookie return size increases in a future release.</span></span> <span data-ttu-id="521f9-131">有关详细信息，请参阅 [EXECUTE AS (Transact SQL)](/sql/t-sql/statements/execute-as-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="521f9-131">For more information, see [EXECUTE AS &#40;Transact-SQL&#41;](/sql/t-sql/statements/execute-as-transact-sql).</span></span>|  
|<span data-ttu-id="521f9-132">sys.fn_get_audit_file 函数</span><span class="sxs-lookup"><span data-stu-id="521f9-132">sys.fn_get_audit_file function</span></span>|<span data-ttu-id="521f9-133">添加了另外两个列 (**user_defined_event_id**和**user_defined_information**) ，以支持用户定义的审核事件。</span><span class="sxs-lookup"><span data-stu-id="521f9-133">Two additional columns (**user_defined_event_id** and **user_defined_information**) have been added to support user-defined audit events.</span></span> <span data-ttu-id="521f9-134">不按名称选择列的应用程序可能会返回比预期更多的列。</span><span class="sxs-lookup"><span data-stu-id="521f9-134">Applications that do not select columns by name might return more columns than expected.</span></span> <span data-ttu-id="521f9-135">请按名称选择列，或调整应用程序以接受这些额外的列。</span><span class="sxs-lookup"><span data-stu-id="521f9-135">Either select columns by name, or adjust the application to accept these additional columns.</span></span>|  
|<span data-ttu-id="521f9-136">WITHIN 保留关键字</span><span class="sxs-lookup"><span data-stu-id="521f9-136">WITHIN reserved keyword</span></span>|<span data-ttu-id="521f9-137">WITHIN 现在是保留关键字。</span><span class="sxs-lookup"><span data-stu-id="521f9-137">WITHIN is now a reserved keyword.</span></span> <span data-ttu-id="521f9-138">引用名为“within”的对象或列将失败。</span><span class="sxs-lookup"><span data-stu-id="521f9-138">References to objects or columns named 'within' will fail.</span></span> <span data-ttu-id="521f9-139">重命名对象或列，或通过使用括号或引号来分隔名称。</span><span class="sxs-lookup"><span data-stu-id="521f9-139">Rename the object or column name or delimit the name by using brackets or quotes.</span></span>  <span data-ttu-id="521f9-140">例如，`SELECT * FROM [within]`。</span><span class="sxs-lookup"><span data-stu-id="521f9-140">For example, `SELECT * FROM [within]`.</span></span>|  
|<span data-ttu-id="521f9-141">对类型为 `time` 或 `datetime2` 的计算列的 CAST 和 CONVERT 操作</span><span class="sxs-lookup"><span data-stu-id="521f9-141">CAST and CONVERT operations on computed columns of type `time` or `datetime2`</span></span>|<span data-ttu-id="521f9-142">在 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 的早期版本中，对 `time` 或 `datetime2` 数据类型的 CAST 和 CONVERT 操作的默认样式为 121，当在计算列表达式中使用这些类型时除外。</span><span class="sxs-lookup"><span data-stu-id="521f9-142">In earlier versions of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], the default style for CAST and CONVERT operations on `time` and `datetime2` data types is 121 except when either type is used in a computed column expression.</span></span> <span data-ttu-id="521f9-143">对于计算列，默认样式为 0。</span><span class="sxs-lookup"><span data-stu-id="521f9-143">For computed columns, the default style is 0.</span></span> <span data-ttu-id="521f9-144">当创建用于涉及自动参数化的查询中或约束定义中的计算列时，此行为会影响计算列。</span><span class="sxs-lookup"><span data-stu-id="521f9-144">This behavior impacts computed columns when they are created, used in queries involving auto-parameterization, or used in constraint definitions.</span></span><br /><br /> <span data-ttu-id="521f9-145">兼容性级别为 110 时，对 `time` 和 `datetime2` 数据类型的 CAST 和 CONVERT 操作的默认样式始终为 121。</span><span class="sxs-lookup"><span data-stu-id="521f9-145">Under compatibility level 110, the default style for CAST and CONVERT operations on `time` and `datetime2` data types is always 121.</span></span> <span data-ttu-id="521f9-146">如果您的查询依赖旧行为，请使用低于 110 的兼容性级别或在受影响的查询中显式指定 0 样式。</span><span class="sxs-lookup"><span data-stu-id="521f9-146">If your query relies on the old behavior, use a compatibility level less than 110, or explicitly specify the 0 style in the affected query.</span></span><br /><br /> <span data-ttu-id="521f9-147">将数据库升级到兼容性级别 110 将不更改已存储到磁盘的用户数据。</span><span class="sxs-lookup"><span data-stu-id="521f9-147">Upgrading the database to compatibility level 110 will not change user data that has been stored to disk.</span></span> <span data-ttu-id="521f9-148">您必须相应手动更正此数据。</span><span class="sxs-lookup"><span data-stu-id="521f9-148">You must manually correct this data as appropriate.</span></span> <span data-ttu-id="521f9-149">例如，如果您使用了 SELECT INTO 来从包含上述计算列表达式的源创建表，将存储数据（使用样式 0）而非存储计算列定义本身。</span><span class="sxs-lookup"><span data-stu-id="521f9-149">For example, if you used SELECT INTO to create a table from a source that contained a computed column expression described above, the data (using style 0) would be stored rather than the computed column definition itself.</span></span> <span data-ttu-id="521f9-150">您需要手动更新此数据，以匹配样式 121。</span><span class="sxs-lookup"><span data-stu-id="521f9-150">You would need to manually update this data to match style 121.</span></span>|  
|<span data-ttu-id="521f9-151">ALTER TABLE</span><span class="sxs-lookup"><span data-stu-id="521f9-151">ALTER TABLE</span></span>|<span data-ttu-id="521f9-152">ALTER TABLE 语句只允许两部分的表名称 (schema.object)。</span><span class="sxs-lookup"><span data-stu-id="521f9-152">The ALTER TABLE statement allows only two-part (schema.object) table names.</span></span> <span data-ttu-id="521f9-153">使用以下格式指定表名现在会在编译时失败，并出现错误117：</span><span class="sxs-lookup"><span data-stu-id="521f9-153">Specifying a table name using the following formats now fails at compile time with error 117:</span></span><br /><br /> <span data-ttu-id="521f9-154">server.database.schema.table</span><span class="sxs-lookup"><span data-stu-id="521f9-154">server.database.schema.table</span></span><br /><br /> <span data-ttu-id="521f9-155">.database.schema.table</span><span class="sxs-lookup"><span data-stu-id="521f9-155">.database.schema.table</span></span><br /><br /> <span data-ttu-id="521f9-156">..schema.table</span><span class="sxs-lookup"><span data-stu-id="521f9-156">..schema.table</span></span><br /><br /> <span data-ttu-id="521f9-157">在早期版本中指定格式 server.database.schema.table 会返回错误 4902。</span><span class="sxs-lookup"><span data-stu-id="521f9-157">In earlier versions specifying the format server.database.schema.table returned error 4902.</span></span> <span data-ttu-id="521f9-158">指定格式 .database.schema.table 或 ..schema.table 则会成功。</span><span class="sxs-lookup"><span data-stu-id="521f9-158">Specifying the format .database.schema.table or the format ..schema.table succeeded.</span></span> <span data-ttu-id="521f9-159">要解决此问题，请不要使用 4 部分的前缀。</span><span class="sxs-lookup"><span data-stu-id="521f9-159">To resolve the problem, remove the use of a 4-part prefix.</span></span>|  
|<span data-ttu-id="521f9-160">浏览元数据</span><span class="sxs-lookup"><span data-stu-id="521f9-160">Browsing metadata</span></span>|<span data-ttu-id="521f9-161">使用 FOR BROWSE 或 SET NO_BROWSETABLE ON 查询视图时，现在会返回视图的元数据而非基础对象的元数据。</span><span class="sxs-lookup"><span data-stu-id="521f9-161">Querying a view using FOR BROWSE or SET NO_BROWSETABLE ON now returns the metadata of the view, not the metadata of the underlying object.</span></span> <span data-ttu-id="521f9-162">此行为现在匹配浏览元数据的其他方法。</span><span class="sxs-lookup"><span data-stu-id="521f9-162">This behavior now matches other methods of browsing metadata.</span></span>|  
|<span data-ttu-id="521f9-163">SOUNDEX</span><span class="sxs-lookup"><span data-stu-id="521f9-163">SOUNDEX</span></span>|<span data-ttu-id="521f9-164">数据库兼容级别为 110 时，SOUNDEX 函数实现的新规则可能导致由该函数计算的值不同于更低兼容级别时计算的值。</span><span class="sxs-lookup"><span data-stu-id="521f9-164">Under database compatibility level 110, the SOUNDEX function implements new rules that may cause the values computed by the function to be different than the values computed under earlier compatibility levels.</span></span> <span data-ttu-id="521f9-165">在升级到兼容性级别 110 后，可能需要重新生成使用 SOUNDEX 函数的索引、堆或 CHECK 约束。</span><span class="sxs-lookup"><span data-stu-id="521f9-165">After upgrading to compatibility level 110, you may need to rebuild the indexes, heaps, or CHECK constraints that use the SOUNDEX function.</span></span> <span data-ttu-id="521f9-166">有关详细信息，请参阅 [SOUNDEX (Transact-SQL)](/sql/t-sql/functions/soundex-transact-sql)</span><span class="sxs-lookup"><span data-stu-id="521f9-166">For more information, see [SOUNDEX &#40;Transact-SQL&#41;](/sql/t-sql/functions/soundex-transact-sql)</span></span>
|<span data-ttu-id="521f9-167">失败的 DML 语句的行计数消息</span><span class="sxs-lookup"><span data-stu-id="521f9-167">Row count message for failed DML statements</span></span>|<span data-ttu-id="521f9-168">在 [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] 中，DML 语句失败时，[!INCLUDE[ssDE](../includes/ssde-md.md)]将以一致方式将包含 RowCount: 0 的 TDS DONE 令牌发送到客户端。</span><span class="sxs-lookup"><span data-stu-id="521f9-168">In [!INCLUDE[ssSQL11](../includes/sssql11-md.md)], the [!INCLUDE[ssDE](../includes/ssde-md.md)] will consistently send the TDS DONE token with RowCount: 0 to clients when a DML statement fails.</span></span> <span data-ttu-id="521f9-169">在 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 的早期版本中，当 TRY-CATCH 块包含失败的 DML 语句并且该语句由[!INCLUDE[ssDE](../includes/ssde-md.md)]自动参数化或 TRY-CATCH 块所处的级别不同于失败语句的级别时，会向客户端发送不正确的值 -1。</span><span class="sxs-lookup"><span data-stu-id="521f9-169">In earlier versions of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], an incorrect value of -1 is sent to the client when the DML statement that fails is contained in a TRY-CATCH block and is either autoparameterized by the [!INCLUDE[ssDE](../includes/ssde-md.md)] or the TRY-CATCH block is not on the same level as the failed statement.</span></span> <span data-ttu-id="521f9-170">例如，如果 TRY-CATCH 块调用存储过程且该过程中的 DML 语句失败，客户端将错误地收到 -1 值。</span><span class="sxs-lookup"><span data-stu-id="521f9-170">For example, if a TRY-CATCH block calls a stored procedure and a DML statement in the procedure fails, the client will incorrectly receive a -1 value.</span></span><br /><br /> <span data-ttu-id="521f9-171">依赖这种不正确行为的应用程序将失败。</span><span class="sxs-lookup"><span data-stu-id="521f9-171">Applications that rely on this incorrect behavior will fail.</span></span>|  
|<span data-ttu-id="521f9-172">SERVERPROPERTY ( "Edition" ) </span><span class="sxs-lookup"><span data-stu-id="521f9-172">SERVERPROPERTY ('Edition')</span></span>|<span data-ttu-id="521f9-173">所安装的 [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] 实例的产品版本。</span><span class="sxs-lookup"><span data-stu-id="521f9-173">Installed product edition of the instance of [!INCLUDE[ssSQL11](../includes/sssql11-md.md)].</span></span> <span data-ttu-id="521f9-174">使用该属性的值确定已安装的产品支持的功能和限制（如最大 CPU 数）。</span><span class="sxs-lookup"><span data-stu-id="521f9-174">Use the value of this property to determine the features and the limits, such as maximum number of CPUs that are supported by the installed product.</span></span><br /><br /> <span data-ttu-id="521f9-175">根据已安装的 Enterprise edition，此操作可以返回 "Enterprise Edition" 或 "Enterprise Edition：基于内核的许可"。</span><span class="sxs-lookup"><span data-stu-id="521f9-175">Based on the installed Enterprise edition, this can return 'Enterprise Edition' or 'Enterprise Edition: Core-based Licensing'.</span></span> <span data-ttu-id="521f9-176">根据单个 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 实例的最大计算能力来区分 Enterprise 版本。</span><span class="sxs-lookup"><span data-stu-id="521f9-176">The Enterprise editions are differentiated based on the maximum compute capacity by a single instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="521f9-177">有关中计算容量限制的详细信息 [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] ，请参阅[按版本 SQL Server 计算容量限制](../sql-server/compute-capacity-limits-by-edition-of-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="521f9-177">For more information on Compute capacity limits in [!INCLUDE[ssSQL11](../includes/sssql11-md.md)], see [Compute Capacity Limits by Edition of SQL Server](../sql-server/compute-capacity-limits-by-edition-of-sql-server.md).</span></span>|  
|<span data-ttu-id="521f9-178">CREATE LOGIN</span><span class="sxs-lookup"><span data-stu-id="521f9-178">CREATE LOGIN</span></span>|<span data-ttu-id="521f9-179">`CREATE LOGIN WITH PASSWORD = '` *Password* `' HASHED` 选项不能用于 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 7 或更早版本创建的哈希。</span><span class="sxs-lookup"><span data-stu-id="521f9-179">The `CREATE LOGIN WITH PASSWORD = '`*password*`' HASHED` option cannot be used with hashes created by [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 7 or earlier.</span></span>|  
|<span data-ttu-id="521f9-180"> 的 CAST 和 CONVERT 转换</span><span class="sxs-lookup"><span data-stu-id="521f9-180">CAST and CONVERT operations for `datetimeoffset`</span></span>|<span data-ttu-id="521f9-181">在从日期和数据类型转换为 `datetimeoffset` 时，只支持样式 0 或 1。</span><span class="sxs-lookup"><span data-stu-id="521f9-181">The only styles that are supported when converting from date and time types to `datetimeoffset` are 0 or 1.</span></span> <span data-ttu-id="521f9-182">所有其他转换样式均返回错误 9809。</span><span class="sxs-lookup"><span data-stu-id="521f9-182">All other conversion styles return error 9809.</span></span> <span data-ttu-id="521f9-183">例如，下面的代码将返回错误 9809。</span><span class="sxs-lookup"><span data-stu-id="521f9-183">For example, the following code returns error 9809.</span></span><br /><br /> `SELECT CONVERT(date, CAST('7070-11-25 16:25:01.00986 -02:07' as datetimeoffset(5)), 107);`|  
  
### <a name="dynamic-management-views"></a><span data-ttu-id="521f9-184">动态管理视图</span><span class="sxs-lookup"><span data-stu-id="521f9-184">Dynamic Management Views</span></span>  
  
|<span data-ttu-id="521f9-185">查看</span><span class="sxs-lookup"><span data-stu-id="521f9-185">View</span></span>|<span data-ttu-id="521f9-186">说明</span><span class="sxs-lookup"><span data-stu-id="521f9-186">Description</span></span>|  
|----------|-----------------|  
|<span data-ttu-id="521f9-187">sys.dm_exec_requests</span><span class="sxs-lookup"><span data-stu-id="521f9-187">sys.dm_exec_requests</span></span>|<span data-ttu-id="521f9-188">该命令列从 `nvarchar(16)` 更改为 `nvarchar(32)`。</span><span class="sxs-lookup"><span data-stu-id="521f9-188">The command column changes from `nvarchar(16)` to `nvarchar(32)`.</span></span>|  
|<span data-ttu-id="521f9-189">sys.dm_os_memory_cache_counters</span><span class="sxs-lookup"><span data-stu-id="521f9-189">sys.dm_os_memory_cache_counters</span></span>|<span data-ttu-id="521f9-190">以下列已重命名：</span><span class="sxs-lookup"><span data-stu-id="521f9-190">The following columns have been renamed:</span></span><br /><br /> <span data-ttu-id="521f9-191">现在 single_pages_kb：</span><span class="sxs-lookup"><span data-stu-id="521f9-191">single_pages_kb is now:</span></span> <br />                          <span data-ttu-id="521f9-192">pages_kb</span><span class="sxs-lookup"><span data-stu-id="521f9-192">pages_kb</span></span><br /><br /> <span data-ttu-id="521f9-193">multi_pages_kb</span><span class="sxs-lookup"><span data-stu-id="521f9-193">multi_pages_kb</span></span><br />                           <span data-ttu-id="521f9-194">现在为： pages_in_use_kb</span><span class="sxs-lookup"><span data-stu-id="521f9-194">is now: pages_in_use_kb</span></span>|  
|<span data-ttu-id="521f9-195">sys.dm_os_memory_cache_entries</span><span class="sxs-lookup"><span data-stu-id="521f9-195">sys.dm_os_memory_cache_entries</span></span>|<span data-ttu-id="521f9-196">列 pages_allocated_count 列已重命名 pages_kb。</span><span class="sxs-lookup"><span data-stu-id="521f9-196">The column pages_allocated_count column has been renamed pages_kb.</span></span>|  
|<span data-ttu-id="521f9-197">sys.dm_os_memory_clerks</span><span class="sxs-lookup"><span data-stu-id="521f9-197">sys.dm_os_memory_clerks</span></span>|<span data-ttu-id="521f9-198">列 multi_pages_kb 已被移除。</span><span class="sxs-lookup"><span data-stu-id="521f9-198">The column multi_pages_kb has been removed.</span></span><br /><br /> <span data-ttu-id="521f9-199">列 single_pages_kb 列已重命名 pages_kb。</span><span class="sxs-lookup"><span data-stu-id="521f9-199">The column single_pages_kb column has been renamed pages_kb.</span></span>|  
|<span data-ttu-id="521f9-200">sys.dm_os_memory_nodes</span><span class="sxs-lookup"><span data-stu-id="521f9-200">sys.dm_os_memory_nodes</span></span>|<span data-ttu-id="521f9-201">以下列已重命名：</span><span class="sxs-lookup"><span data-stu-id="521f9-201">The following columns have been renamed:</span></span><br /><br /> <span data-ttu-id="521f9-202">现在 single_pages_kb：</span><span class="sxs-lookup"><span data-stu-id="521f9-202">single_pages_kb is now:</span></span> <br />                            <span data-ttu-id="521f9-203">pages_kb</span><span class="sxs-lookup"><span data-stu-id="521f9-203">pages_kb</span></span><br /><br /> <span data-ttu-id="521f9-204">现在 multi_pages_kb：</span><span class="sxs-lookup"><span data-stu-id="521f9-204">multi_pages_kb is now:</span></span> <br />                            <span data-ttu-id="521f9-205">foreign_committed_kb</span><span class="sxs-lookup"><span data-stu-id="521f9-205">foreign_committed_kb</span></span>|  
|<span data-ttu-id="521f9-206">sys.dm_os_memory_objects</span><span class="sxs-lookup"><span data-stu-id="521f9-206">sys.dm_os_memory_objects</span></span>|<span data-ttu-id="521f9-207">以下列已重命名。</span><span class="sxs-lookup"><span data-stu-id="521f9-207">The following columns have been renamed.</span></span><br /><br /> <span data-ttu-id="521f9-208">现在 pages_allocated_count：</span><span class="sxs-lookup"><span data-stu-id="521f9-208">pages_allocated_count is now:</span></span><br />                            <span data-ttu-id="521f9-209">pages_in_bytes</span><span class="sxs-lookup"><span data-stu-id="521f9-209">pages_in_bytes</span></span><br /><br /> <span data-ttu-id="521f9-210">现在 max_pages_allocated_count： max_pages_in_bytes</span><span class="sxs-lookup"><span data-stu-id="521f9-210">max_pages_allocated_count is now: max_pages_in_bytes</span></span>|  
|<span data-ttu-id="521f9-211">sys.dm_os_sys_info</span><span class="sxs-lookup"><span data-stu-id="521f9-211">sys.dm_os_sys_info</span></span>|<span data-ttu-id="521f9-212">以下列已重命名：</span><span class="sxs-lookup"><span data-stu-id="521f9-212">The following columns have been renamed:</span></span><br /><br /> <span data-ttu-id="521f9-213">现在 physical_memory_in_bytes：</span><span class="sxs-lookup"><span data-stu-id="521f9-213">physical_memory_in_bytes is now:</span></span> <br />                            <span data-ttu-id="521f9-214">physical_memory_kb</span><span class="sxs-lookup"><span data-stu-id="521f9-214">physical_memory_kb</span></span><br /><br /> <span data-ttu-id="521f9-215">现在 bpool_commit_target：</span><span class="sxs-lookup"><span data-stu-id="521f9-215">bpool_commit_target is now:</span></span> <br />                            <span data-ttu-id="521f9-216">committed_target_kb</span><span class="sxs-lookup"><span data-stu-id="521f9-216">committed_target_kb</span></span><br /><br /> <span data-ttu-id="521f9-217">现在 bpool_visible：</span><span class="sxs-lookup"><span data-stu-id="521f9-217">bpool_visible is now:</span></span> <br />                            <span data-ttu-id="521f9-218">visible_target_kb</span><span class="sxs-lookup"><span data-stu-id="521f9-218">visible_target_kb</span></span><br /><br /> <span data-ttu-id="521f9-219">现在 virtual_memory_in_bytes：</span><span class="sxs-lookup"><span data-stu-id="521f9-219">virtual_memory_in_bytes is now:</span></span> <br />                            <span data-ttu-id="521f9-220">virtual_memory_kb</span><span class="sxs-lookup"><span data-stu-id="521f9-220">virtual_memory_kb</span></span><br /><br /> <span data-ttu-id="521f9-221">现在 bpool_commited：</span><span class="sxs-lookup"><span data-stu-id="521f9-221">bpool_commited is now:</span></span><br />                            <span data-ttu-id="521f9-222">committed_kb</span><span class="sxs-lookup"><span data-stu-id="521f9-222">committed_kb</span></span>|  
|<span data-ttu-id="521f9-223">sys.dm_os_workers</span><span class="sxs-lookup"><span data-stu-id="521f9-223">sys.dm_os_workers</span></span>|<span data-ttu-id="521f9-224">区域设置列已删除。</span><span class="sxs-lookup"><span data-stu-id="521f9-224">The locale column has been removed.</span></span>|  
  
### <a name="catalog-views"></a><span data-ttu-id="521f9-225">目录视图</span><span class="sxs-lookup"><span data-stu-id="521f9-225">Catalog Views</span></span>  
  
|<span data-ttu-id="521f9-226">查看</span><span class="sxs-lookup"><span data-stu-id="521f9-226">View</span></span>|<span data-ttu-id="521f9-227">说明</span><span class="sxs-lookup"><span data-stu-id="521f9-227">Description</span></span>|  
|----------|-----------------|  
|<span data-ttu-id="521f9-228">sys.data_spaces</span><span class="sxs-lookup"><span data-stu-id="521f9-228">sys.data_spaces</span></span><br /><br /> <span data-ttu-id="521f9-229">sys.partition_schemes</span><span class="sxs-lookup"><span data-stu-id="521f9-229">sys.partition_schemes</span></span><br /><br /> <span data-ttu-id="521f9-230">sys.filegroups</span><span class="sxs-lookup"><span data-stu-id="521f9-230">sys.filegroups</span></span><br /><br /> <span data-ttu-id="521f9-231">sys.partition_functions</span><span class="sxs-lookup"><span data-stu-id="521f9-231">sys.partition_functions</span></span>|<span data-ttu-id="521f9-232">已将新列 is_system 添加到 sys.data_spaces 和 sys.partition_functions。</span><span class="sxs-lookup"><span data-stu-id="521f9-232">A new column, is_system, has been added to sys.data_spaces and sys.partition_functions.</span></span> <span data-ttu-id="521f9-233">（sys.partition_schemes 和 sys.filegroups 将继承 sys.data_spaces 的列。）</span><span class="sxs-lookup"><span data-stu-id="521f9-233">(sys.partition_schemes and sys.filegroups inherit the columns of sys.data_spaces.)</span></span><br /><br /> <span data-ttu-id="521f9-234">此列中的值 1 指示该对象用于全文检索片段。</span><span class="sxs-lookup"><span data-stu-id="521f9-234">A value of 1 in this column indicates that the object is used for full-text index fragments.</span></span><br /><br /> <span data-ttu-id="521f9-235">在 sys.partition_functions、sys.partition_schemes 和 sys.filegroups 中，新列不是最后一列。</span><span class="sxs-lookup"><span data-stu-id="521f9-235">In sys.partition_functions, sys.partition_schemes, and sys.filegroups, the new column is not the last column.</span></span> <span data-ttu-id="521f9-236">请修改依赖于从这些目录视图中返回的列顺序的现有查询。</span><span class="sxs-lookup"><span data-stu-id="521f9-236">Revise existing queries that rely on the order of columns returned from these catalog views.</span></span>|  
  
### <a name="sql-clr-data-types-geometry-geography-and-hierarchyid"></a><span data-ttu-id="521f9-237">SQL CLR 数据类型（geometry、geography 和 hierarchyid）</span><span class="sxs-lookup"><span data-stu-id="521f9-237">SQL CLR Data Types (geometry, geography, and hierarchyid)</span></span>  
 <span data-ttu-id="521f9-238">包含空间数据类型和 hierarchyid 类型的程序集**Microsoft.SqlServer.Types.dll**已从版本10.0 升级到11.0 版。</span><span class="sxs-lookup"><span data-stu-id="521f9-238">The assembly **Microsoft.SqlServer.Types.dll**, which contains the spatial data types and the hierarchyid type, has been upgraded from version 10.0 to version 11.0.</span></span> <span data-ttu-id="521f9-239">满足以下条件时，引用此程序集的自定义应用程序可能失败：</span><span class="sxs-lookup"><span data-stu-id="521f9-239">Custom applications that reference this assembly may fail when the following conditions are true.</span></span>  
  
-   <span data-ttu-id="521f9-240">将自定义应用程序从安装了的计算机移 [!INCLUDE[ssKilimanjaro](../includes/sskilimanjaro-md.md)] 到仅安装了的计算机时 [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)] ，应用程序将失败，因为**SqlTypes**程序集的引用版本10.0 不存在。</span><span class="sxs-lookup"><span data-stu-id="521f9-240">When you move a custom application from a computer on which [!INCLUDE[ssKilimanjaro](../includes/sskilimanjaro-md.md)] was installed to a computer on which only [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)] is installed, the application will fail because the referenced version 10.0 of the **SqlTypes** assembly is not present.</span></span> <span data-ttu-id="521f9-241">您可能会看到此错误消息：`"Could not load file or assembly 'Microsoft.SqlServer.Types, Version=10.0.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91' or one of its dependencies. The system cannot find the file specified."`</span><span class="sxs-lookup"><span data-stu-id="521f9-241">You may see this error message: `"Could not load file or assembly 'Microsoft.SqlServer.Types, Version=10.0.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91' or one of its dependencies. The system cannot find the file specified."`</span></span>  
  
-   <span data-ttu-id="521f9-242">当引用**SqlTypes**程序集版本11.0 时，还安装了版本10.0，你可能会看到以下错误消息：`"System.InvalidCastException: Unable to cast object of type 'Microsoft.SqlServer.Types.SqlGeometry' to type 'Microsoft.SqlServer.Types.SqlGeometry'."`</span><span class="sxs-lookup"><span data-stu-id="521f9-242">When you reference the **SqlTypes** assembly version 11.0, and version 10.0 is also installed, you may see this error message: `"System.InvalidCastException: Unable to cast object of type 'Microsoft.SqlServer.Types.SqlGeometry' to type 'Microsoft.SqlServer.Types.SqlGeometry'."`</span></span>  
  
-   <span data-ttu-id="521f9-243">如果从以 .NET 3.5、4或4.5 为目标的自定义应用程序引用**SqlTypes**程序集版本11.0，则该应用程序将失败，因为 SqlClient 按设计加载程序集的版本10.0。</span><span class="sxs-lookup"><span data-stu-id="521f9-243">When you reference the **SqlTypes** assembly version 11.0 from a custom application that targets .NET 3.5, 4, or 4.5, the application will fail because SqlClient by design loads version 10.0 of the assembly.</span></span> <span data-ttu-id="521f9-244">当应用程序调用以下方法之一时，将出现此失败：</span><span class="sxs-lookup"><span data-stu-id="521f9-244">This failure occurs when the application calls one of the following methods:</span></span>  
  
    -   <span data-ttu-id="521f9-245">`GetValue` 类的 `SqlDataReader` 方法</span><span class="sxs-lookup"><span data-stu-id="521f9-245">`GetValue` method of the `SqlDataReader` class</span></span>  
  
    -   <span data-ttu-id="521f9-246">`GetValues` 类的 `SqlDataReader` 方法</span><span class="sxs-lookup"><span data-stu-id="521f9-246">`GetValues` method of the `SqlDataReader` class</span></span>  
  
    -   <span data-ttu-id="521f9-247">`SqlDataReader` 类的方括号索引运算符 []</span><span class="sxs-lookup"><span data-stu-id="521f9-247">bracket index operator [] of the `SqlDataReader` class</span></span>  
  
    -   <span data-ttu-id="521f9-248">`ExecuteScalar` 类的 `SqlCommand` 方法</span><span class="sxs-lookup"><span data-stu-id="521f9-248">`ExecuteScalar` method of the `SqlCommand` class</span></span>  
  
 <span data-ttu-id="521f9-249">您可以使用以下方法之一来解决此问题：</span><span class="sxs-lookup"><span data-stu-id="521f9-249">You can work around this issue by using one of the following methods:</span></span>  
  
-   <span data-ttu-id="521f9-250">您可以通过调用 `GetSqlBytes` 方法替代以上所列的 Get 方法来检索 CLR [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 系统类型，在您的代码中解决此问题，如以下示例中所示：</span><span class="sxs-lookup"><span data-stu-id="521f9-250">You can work around this issue in your code by calling the `GetSqlBytes` method, instead of the Get methods listed above, to retrieve CLR [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] system types, as shown in the following example:</span></span>  
  
    ```csharp  
    string query = "SELECT [SpatialColumn] FROM [SpatialTable]";  
          using (SqlConnection conn = new SqlConnection("..."))  
          {  
                SqlCommand cmd = new SqlCommand(query, conn);  
  
                conn.Open();  
                SqlDataReader reader = cmd.ExecuteReader();  
  
                while (reader.Read())  
                {  
                      // In version 11.0 only  
                      SqlGeometry g =   
    SqlGeometry.Deserialize(reader.GetSqlBytes(0));  
  
                      // In version 10.0 or 11.0  
                      SqlGeometry g2 = new SqlGeometry();  
                      g.Read(new BinaryReader(reader.GetSqlBytes(0).Stream));  
                }  
          }  
    ```  
  
-   <span data-ttu-id="521f9-251">您可以通过在应用程序配置文件中使用程序集重定向来解决此问题，如以下示例中所示：</span><span class="sxs-lookup"><span data-stu-id="521f9-251">You can work around this issue by using assembly redirection in the application configuration file, as shown in the following example:</span></span>  
  
    ```xml  
    <runtime>  
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">  
        ...  
        <dependentAssembly>  
            <assemblyIdentity name="Microsoft.SqlServer.Types" publicKeyToken="89845dcd8080cc91" culture="neutral" />  
            <bindingRedirect oldVersion="10.0.0.0" newVersion="11.0.0.0" />  
        </dependentAssembly>  
        ...  
    </assemblyBinding>  
    <runtime>  
    ```  
  
-   <span data-ttu-id="521f9-252">您可以通过为“类型系统版本”属性指定值“SQL Server 2012”以强制 SqlClient 加载程序集的版本 11.0，解决此问题。</span><span class="sxs-lookup"><span data-stu-id="521f9-252">You can work around this issue in your connection string by specifying a value of "SQL Server 2012" for the "Type System Version" attribute to force SqlClient to load version 11.0 of the assembly.</span></span> <span data-ttu-id="521f9-253">此连接字符串属性仅在 .NET 4.5 和更高版本中使用。</span><span class="sxs-lookup"><span data-stu-id="521f9-253">This connection string attribute is available only in .NET 4.5 and above.</span></span>  
  
-   <span data-ttu-id="521f9-254"> 标记必须包装在  标记下。</span><span class="sxs-lookup"><span data-stu-id="521f9-254">The `assemblyBinding` tag should be wrapped under the `runtime` tag.</span></span>  
  
### <a name="support-for-awe"></a><span data-ttu-id="521f9-255">对 AWE 的支持</span><span class="sxs-lookup"><span data-stu-id="521f9-255">Support for AWE</span></span>  
 <span data-ttu-id="521f9-256">32 位地址窗口化扩展插件 (AWE) 已不受支持。</span><span class="sxs-lookup"><span data-stu-id="521f9-256">32-bit Address Windowing Extensions (AWE) support is discontinued.</span></span> <span data-ttu-id="521f9-257">这可能会导致在 32 位操作系统上性能下降。</span><span class="sxs-lookup"><span data-stu-id="521f9-257">This might result in slower performance on 32-bit operating systems.</span></span> <span data-ttu-id="521f9-258">对于占用大量内存的安装，请迁移到 64 位操作系统。</span><span class="sxs-lookup"><span data-stu-id="521f9-258">For installations using large amounts of memory, migrate to a 64-bit operating system.</span></span>  
  
### <a name="xquery-functions-are-surrogate-aware"></a><span data-ttu-id="521f9-259">XQuery 函数可识别代理项</span><span class="sxs-lookup"><span data-stu-id="521f9-259">XQuery Functions Are Surrogate-Aware</span></span>  
 <span data-ttu-id="521f9-260">XQuery 函数和运算符的 W3C 建议要求它们对代理项对进行计数，该代理项对用 UTF-16 编码将大范围 Unicode 字符表示单个符号。</span><span class="sxs-lookup"><span data-stu-id="521f9-260">The W3C recommendation for XQuery functions and operators requires them to count a surrogate pair that represents a high-range Unicode character as a single glyph in UTF-16 encoding.</span></span> <span data-ttu-id="521f9-261">但是，在 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 之前的 [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] 版本中，字符串函数不能将代理对识别为单个字符。</span><span class="sxs-lookup"><span data-stu-id="521f9-261">However, in versions of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] prior to [!INCLUDE[ssSQL11](../includes/sssql11-md.md)], string functions did not recognize surrogate pairs as a single character.</span></span> <span data-ttu-id="521f9-262">一些字符串操作，例如字符串长度计算和子字符串提取-返回了错误的结果。</span><span class="sxs-lookup"><span data-stu-id="521f9-262">Some string operations - such as string length calculations and substring extractions - returned incorrect results.</span></span> [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] <span data-ttu-id="521f9-263">现在完全支持 UTF-16，可正确处理代理项对。</span><span class="sxs-lookup"><span data-stu-id="521f9-263">now fully supports UTF-16 and the correct handling of surrogate pairs.</span></span>  
  
 <span data-ttu-id="521f9-264"> 中的 XML 数据类型只允许格式正确的代理项对。</span><span class="sxs-lookup"><span data-stu-id="521f9-264">The XML data type in [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] only allows well-formed surrogate pairs.</span></span> <span data-ttu-id="521f9-265">但在某些情况下，一些函数仍会返回未定义的结果或意外结果，这是因为可能会将无效的或部分代理项对作为字符串值传递给 XQuery 函数。</span><span class="sxs-lookup"><span data-stu-id="521f9-265">However, some functions can still return undefined or unexpected results in certain circumstances, since it is possible to pass invalid or partial surrogate pairs to XQuery functions as string values.</span></span> <span data-ttu-id="521f9-266">在 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 中使用 XQuery 时，请考虑以下生成字符串值的方法：</span><span class="sxs-lookup"><span data-stu-id="521f9-266">Consider the following methods for generating string values when using XQuery in [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]:</span></span>  
  
-   <span data-ttu-id="521f9-267">提供常量字符串值作为二进制值。 </span><span class="sxs-lookup"><span data-stu-id="521f9-267">Provide a constant string value as a binary value.</span></span> <span data-ttu-id="521f9-268">在使用此方法时，仍可能传递无效的或部分代理项对。</span><span class="sxs-lookup"><span data-stu-id="521f9-268">When using this method, it remains possible to pass invalid or partial surrogate pairs.</span></span>  
  
-   <span data-ttu-id="521f9-269">通过提供字符实体来提供常量字符串值。 </span><span class="sxs-lookup"><span data-stu-id="521f9-269">Provide a constant string value by providing character entities.</span></span> <span data-ttu-id="521f9-270">使用此方法时，仍可能传递无效或不完整代理对。</span><span class="sxs-lookup"><span data-stu-id="521f9-270">When using this method, it is not possible to pass invalid surrogate pairs.</span></span> <span data-ttu-id="521f9-271">XQuery 函数需要高级字符的单字符实体。</span><span class="sxs-lookup"><span data-stu-id="521f9-271">The XQuery functions require a single character entity for the high-level character.</span></span> <span data-ttu-id="521f9-272">如果提供代理项对字符的字符实体，这些函数将引发错误。</span><span class="sxs-lookup"><span data-stu-id="521f9-272">These functions raise an error if the character entities for the surrogate pair characters are provided.</span></span>  
  
-   <span data-ttu-id="521f9-273">使用**sql： column**或**sql： variable**导入外部值。</span><span class="sxs-lookup"><span data-stu-id="521f9-273">Import external values by using **sql:column** or **sql:variable**.</span></span> <span data-ttu-id="521f9-274">在使用这些方法时，仍可能引入无效的或部分代理项对。</span><span class="sxs-lookup"><span data-stu-id="521f9-274">When using these methods, it remains possible to introduce invalid or partial surrogate pairs.</span></span>  
  
#### <a name="affected-xquery-functions-and-operators"></a><span data-ttu-id="521f9-275">受影响的 XQuery 函数和运算符</span><span class="sxs-lookup"><span data-stu-id="521f9-275">Affected XQuery Functions and Operators</span></span>  
 <span data-ttu-id="521f9-276">以下 XQuery 函数和运算符现在可在 [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] 中正确处理 UTF-16 代理项对：</span><span class="sxs-lookup"><span data-stu-id="521f9-276">The following XQuery functions and operators now handle UTF-16 surrogate pairs correctly in [!INCLUDE[ssSQL11](../includes/sssql11-md.md)]:</span></span>  
  
-   <span data-ttu-id="521f9-277">**fn：字符串长度**。</span><span class="sxs-lookup"><span data-stu-id="521f9-277">**fn:string-length**.</span></span> <span data-ttu-id="521f9-278">但是，如果将无效或部分代理项对作为参数传递，则**字符串长度**的行为不确定。</span><span class="sxs-lookup"><span data-stu-id="521f9-278">However, if an invalid or partial surrogate pair is passed as an argument, the behavior of **string-length** is undefined.</span></span>  
  
-   <span data-ttu-id="521f9-279">**fn： substring**。</span><span class="sxs-lookup"><span data-stu-id="521f9-279">**fn:substring**.</span></span>  
  
-   <span data-ttu-id="521f9-280">**fn： contains**。</span><span class="sxs-lookup"><span data-stu-id="521f9-280">**fn:contains**.</span></span> <span data-ttu-id="521f9-281">但是，如果将部分代理项对作为值传递，则**contains**可能会返回意外结果，因为它可能会找到包含在格式正确的代理项对中的部分代理项对。</span><span class="sxs-lookup"><span data-stu-id="521f9-281">However, if a partial surrogate pair is passed as a value, **contains** may return unexpected results, since it may find the partial surrogate pair contained in well-formed surrogate pair.</span></span>  
  
-   <span data-ttu-id="521f9-282">**fn： concat**。</span><span class="sxs-lookup"><span data-stu-id="521f9-282">**fn:concat**.</span></span> <span data-ttu-id="521f9-283">但是，如果将部分代理项对作为值传递，则**concat**可能会产生不正确的代理项对或部分代理项对。</span><span class="sxs-lookup"><span data-stu-id="521f9-283">However, if a partial surrogate pair is passed as a value, **concat** can produce incorrect surrogate pairs or partial surrogate pairs.</span></span>  
  
-   <span data-ttu-id="521f9-284">比较运算符和**order by**子句。</span><span class="sxs-lookup"><span data-stu-id="521f9-284">Comparison operators and the **order by** clause.</span></span> <span data-ttu-id="521f9-285">比较运算符包括 +、 \<, > 、 \<=, > =、 `eq` 、、、 `lt` `gt` `le` 和 `ge` 。</span><span class="sxs-lookup"><span data-stu-id="521f9-285">Comparison operators include +, \<, >, \<=, >=, `eq`, `lt`, `gt`, `le`, and `ge`.</span></span>  
  
#### <a name="distributed-query-calls-to-a-system-procedure"></a><span data-ttu-id="521f9-286">对系统过程的分布式查询调用</span><span class="sxs-lookup"><span data-stu-id="521f9-286">Distributed Query Calls to a System Procedure</span></span>  
 <span data-ttu-id="521f9-287">在从一个 [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] 服务器对另一个服务器进行调用时，通过 `OPENQUERY` 对某些系统过程进行的分布式查询调用将失败。</span><span class="sxs-lookup"><span data-stu-id="521f9-287">Distributed query calls through `OPENQUERY` to some system procedures will fail when called from one [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] server to another.</span></span> <span data-ttu-id="521f9-288">在 [!INCLUDE[ssDE](../includes/ssde-md.md)] 无法发现某个过程的元数据时将出现此情况。</span><span class="sxs-lookup"><span data-stu-id="521f9-288">This occurs when the [!INCLUDE[ssDE](../includes/ssde-md.md)] cannot discovery metadata for a procedure.</span></span> <span data-ttu-id="521f9-289">例如，`SELECT * FROM OPENQUERY(..., 'EXEC xp_loginfo')`。</span><span class="sxs-lookup"><span data-stu-id="521f9-289">For example, `SELECT * FROM OPENQUERY(..., 'EXEC xp_loginfo')`.</span></span>  
  
#### <a name="isolation-level-and-sp_reset_connection"></a><span data-ttu-id="521f9-290">隔离级别和 sp_reset_connection</span><span class="sxs-lookup"><span data-stu-id="521f9-290">Isolation Level and sp_reset_connection</span></span>  
 <span data-ttu-id="521f9-291">连接用隔离级别由客户端驱动程序按照如下方法处理：</span><span class="sxs-lookup"><span data-stu-id="521f9-291">The isolation level for connections is handled in the following way by client drivers:</span></span>  
  
-   <span data-ttu-id="521f9-292">所有的本机驱动程序（SNAC、MDAC、ODBC）都根据 sp_reset_connection 设置隔离级别（基于应用设置）。</span><span class="sxs-lookup"><span data-stu-id="521f9-292">All of the native drivers (SNAC, MDAC, ODBC) set the isolation level (based on app setting) upon sp_reset_connection.</span></span>  
  
-   <span data-ttu-id="521f9-293">对于 ADO.NET，你实质上会获得一个随机的隔离级别，这取决于你从池中获取的连接（以及应用程序是否使用不同的隔离级别）。</span><span class="sxs-lookup"><span data-stu-id="521f9-293">For ADO.NET you will essentially get a random isolation level depending on which connection you get from the pool (and if the application uses different isolation level).</span></span> <span data-ttu-id="521f9-294">由于 ADO.NET 池可在内部以透明方式回收连接，你无法预测将从池中得到什么结果。</span><span class="sxs-lookup"><span data-stu-id="521f9-294">Since ADO.NET pool can recycle connections internally and transparently, you cannot predict what will come out of the pool.</span></span>  
  
-   <span data-ttu-id="521f9-295">对于 JDBC 驱动程序，你获得与 ADO.NET 相同的行为</span><span class="sxs-lookup"><span data-stu-id="521f9-295">For the JDBC driver you get same behavior as ADO.NET</span></span>  
  
     <span data-ttu-id="521f9-296">打开连接以获取所需之后，应用程序必须始终显式设置隔离级别。</span><span class="sxs-lookup"><span data-stu-id="521f9-296">The application must always explicitly set isolation level after opening the connection to get what it wants.</span></span>  
  
     <span data-ttu-id="521f9-297">JDBC 连接可以共用，从而应用程序可获取一个随机隔离级别但并不知情。</span><span class="sxs-lookup"><span data-stu-id="521f9-297">The JDBC connection can be pooled, so the application may get a random isolation level and not know about it.</span></span>  
  
 <span data-ttu-id="521f9-298">若要保留向后兼容性，这种新行为仅适用于以 TDS 7.4 开头的较新的客户端。</span><span class="sxs-lookup"><span data-stu-id="521f9-298">To preserve backward compatibility this new behavior only applies for recent clients beginning with TDS 7.4.</span></span>  
  
#### <a name="backward-compatibility"></a><span data-ttu-id="521f9-299">Backward Compatibility</span><span class="sxs-lookup"><span data-stu-id="521f9-299">Backward Compatibility</span></span>  
 <span data-ttu-id="521f9-300">**新行为取决于兼容性级别**</span><span class="sxs-lookup"><span data-stu-id="521f9-300">**New behavior depends on compatibility level**</span></span>  
  
 <span data-ttu-id="521f9-301">仅当数据库兼容性级别为 110 或更高时，以下函数和运算符才具有上述新行为：</span><span class="sxs-lookup"><span data-stu-id="521f9-301">The following functions and operators demonstrate the new behavior described above only when the compatibility level is 110 or higher:</span></span>  
  
-   <span data-ttu-id="521f9-302">**fn： contains**。</span><span class="sxs-lookup"><span data-stu-id="521f9-302">**fn:contains**.</span></span>  
  
-   <span data-ttu-id="521f9-303">**fn： concat**。</span><span class="sxs-lookup"><span data-stu-id="521f9-303">**fn:concat**.</span></span>  
  
-   <span data-ttu-id="521f9-304">比较运算符和**order by**子句</span><span class="sxs-lookup"><span data-stu-id="521f9-304">comparison operators and **order by** clause</span></span>  
  
 <span data-ttu-id="521f9-305">**新行为取决于函数的默认命名空间 URI**</span><span class="sxs-lookup"><span data-stu-id="521f9-305">**New behavior depends on default namespace URI for functions**</span></span>  
  
 <span data-ttu-id="521f9-306">仅当默认命名空间 URI 对应于最终建议中的命名空间（即）时，以下函数才会演示上面所述的新行为 [http://www.w3.org/2005/xpath-functions](http://www.w3.org/2005/xpath-functions) 。</span><span class="sxs-lookup"><span data-stu-id="521f9-306">The following functions demonstrate the new behavior described above only when the default namespace URI corresponds to the namespace in the final recommendation, that is, [http://www.w3.org/2005/xpath-functions](http://www.w3.org/2005/xpath-functions).</span></span> <span data-ttu-id="521f9-307">数据库兼容性级别为 110 或更高时，默认情况下 [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] 将默认函数命名空间绑定到此命名空间。</span><span class="sxs-lookup"><span data-stu-id="521f9-307">When the compatibility level is 110 or higher, then by default [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] binds the default function namespace to this namespace.</span></span> <span data-ttu-id="521f9-308">但是，无论兼容性级别如何，使用此命名空间时，这些函数都将具有新行为。</span><span class="sxs-lookup"><span data-stu-id="521f9-308">However these functions demonstrate the new behavior when this namespace is used regardless of the compatibility level.</span></span>  
  
-   <span data-ttu-id="521f9-309">**fn:string-length**</span><span class="sxs-lookup"><span data-stu-id="521f9-309">**fn:string-length**</span></span>  
  
-   <span data-ttu-id="521f9-310">**fn： substring**</span><span class="sxs-lookup"><span data-stu-id="521f9-310">**fn:substring**</span></span>  
  
##  <a name="breaking-changes-in-sql-server-2008sql-server-2008r2"></a><a name="KJKatmai"></a><span data-ttu-id="521f9-311">SQL Server 2008/SQL Server 2008R2 中的重大更改</span><span class="sxs-lookup"><span data-stu-id="521f9-311">Breaking Changes in SQL Server 2008/SQL Server 2008R2</span></span>  
 <span data-ttu-id="521f9-312">本节包含 [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] 中引入的重大更改。</span><span class="sxs-lookup"><span data-stu-id="521f9-312">This section contains the breaking changes introduced in [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)].</span></span> <span data-ttu-id="521f9-313">[!INCLUDE[ssKilimanjaro](../includes/sskilimanjaro-md.md)] 中未引入任何更改。</span><span class="sxs-lookup"><span data-stu-id="521f9-313">No changes were introduced in [!INCLUDE[ssKilimanjaro](../includes/sskilimanjaro-md.md)].</span></span>  
  
### <a name="collations"></a><span data-ttu-id="521f9-314">排序规则</span><span class="sxs-lookup"><span data-stu-id="521f9-314">Collations</span></span>  
  
|<span data-ttu-id="521f9-315">功能</span><span class="sxs-lookup"><span data-stu-id="521f9-315">Feature</span></span>|<span data-ttu-id="521f9-316">说明</span><span class="sxs-lookup"><span data-stu-id="521f9-316">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="521f9-317">新排序规则</span><span class="sxs-lookup"><span data-stu-id="521f9-317">New collations</span></span>|[!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] <span data-ttu-id="521f9-318">引入了新的排序规则，这些规则完全符合 Windows Server 2008 提供的排序规则。</span><span class="sxs-lookup"><span data-stu-id="521f9-318">introduces new collations that are in full alignment with the collations provided by Windows Server 2008.</span></span> <span data-ttu-id="521f9-319">这 80 个新排序规则以 \*_100 版本引用表示，它们的语言准确性得到了改善。</span><span class="sxs-lookup"><span data-stu-id="521f9-319">These 80 new collations have improved linguistic accuracy and are denoted by \*_100 version references.</span></span> <span data-ttu-id="521f9-320">如果为服务器或数据库选择新排序规则，请注意，具有旧客户端驱动程序的客户端可能无法识别新排序规则。</span><span class="sxs-lookup"><span data-stu-id="521f9-320">If you choose a new collation for your server or database, be aware that the collation may not be recognized by clients with older client drivers.</span></span> <span data-ttu-id="521f9-321">未被识别的排序规则可能会导致应用程序返回错误并失败。</span><span class="sxs-lookup"><span data-stu-id="521f9-321">Unrecognized collations can cause the application to return errors and fail.</span></span> <span data-ttu-id="521f9-322">请考虑以下解决方案：</span><span class="sxs-lookup"><span data-stu-id="521f9-322">Consider the following solutions:</span></span><br /><br /> <span data-ttu-id="521f9-323">升级客户端操作系统，以更新基础系统排序规则。</span><span class="sxs-lookup"><span data-stu-id="521f9-323">Upgrade the client operating system so that the underlying system collations are updated.</span></span><br /><br /> <span data-ttu-id="521f9-324">如果客户端上安装了数据库客户端软件，则可以考虑对数据库客户端软件应用服务更新。</span><span class="sxs-lookup"><span data-stu-id="521f9-324">If your client has database client software installed, consider applying a service update to the database client software.</span></span><br /><br /> <span data-ttu-id="521f9-325">选择一个现有排序规则，该排序规则会映射到客户端上的一个代码页。</span><span class="sxs-lookup"><span data-stu-id="521f9-325">Choose an existing collation that maps to a code page on the client.</span></span>|  
  
### <a name="common-language-runtime-clr"></a><span data-ttu-id="521f9-326">公共语言运行时 (CLR)</span><span class="sxs-lookup"><span data-stu-id="521f9-326">Common Language Runtime (CLR)</span></span>  
  
|<span data-ttu-id="521f9-327">功能</span><span class="sxs-lookup"><span data-stu-id="521f9-327">Feature</span></span>|<span data-ttu-id="521f9-328">说明</span><span class="sxs-lookup"><span data-stu-id="521f9-328">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="521f9-329">CLR 程序集</span><span class="sxs-lookup"><span data-stu-id="521f9-329">CLR Assemblies</span></span>|<span data-ttu-id="521f9-330">当数据库升级到 [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] 后，将自动安装 `Microsoft.SqlServer.Types` 程序集以支持新数据类型。</span><span class="sxs-lookup"><span data-stu-id="521f9-330">When a database is upgraded to [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)], the `Microsoft.SqlServer.Types` assembly to support new data types is automatically installed.</span></span> <span data-ttu-id="521f9-331">升级顾问规则将检测存在名称冲突的任何用户类型或程序集。</span><span class="sxs-lookup"><span data-stu-id="521f9-331">Upgrade Advisor rules detect any user type or assemblies with conflicting names.</span></span> <span data-ttu-id="521f9-332">升级顾问将建议您重命名所有冲突的程序集，并重命名所有冲突的类型或在代码中使用由两部分组成的名称来引用该预先存在的用户类型。</span><span class="sxs-lookup"><span data-stu-id="521f9-332">The Upgrade Advisor will advise renaming of any conflicting assembly, and either renaming any conflicting type, or using two-part names in the code to refer to that preexisting user type.</span></span><br /><br /> <span data-ttu-id="521f9-333">如果数据库升级检测到某个用户程序集具有冲突名称，它将自动重命名该程序集，并将数据库置于可疑模式下。</span><span class="sxs-lookup"><span data-stu-id="521f9-333">If a database upgrade detects a user assembly with a conflicting name, it will automatically rename that assembly and put the database into suspect mode.</span></span><br /><br /> <span data-ttu-id="521f9-334">如果在升级过程中存在具有冲突名称的用户类型，则不会采取特殊步骤。</span><span class="sxs-lookup"><span data-stu-id="521f9-334">If a user type with conflicting name exists during the upgrade, no special steps are taken.</span></span> <span data-ttu-id="521f9-335">升级后，旧的用户类型和新的系统类型将同时存在。</span><span class="sxs-lookup"><span data-stu-id="521f9-335">After the upgrade, both the old user type, and the new system type, will exist.</span></span> <span data-ttu-id="521f9-336">用户类型将只能通过由两部分组成的名称使用。</span><span class="sxs-lookup"><span data-stu-id="521f9-336">The user type will be available only through two-part names.</span></span>|  
|<span data-ttu-id="521f9-337">CLR 程序集</span><span class="sxs-lookup"><span data-stu-id="521f9-337">CLR Assemblies</span></span>|[!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] <span data-ttu-id="521f9-338">会安装 .NET Framework 3.5 SP1，以更新全局程序集缓存 (GAC) 中的库。</span><span class="sxs-lookup"><span data-stu-id="521f9-338">installs .NET Framework 3.5 SP1, which updates libraries in the Global Assembly Cache (GAC).</span></span> <span data-ttu-id="521f9-339">如果在 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 数据库中注册了不支持的库，则在升级到 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 后，[!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] 应用程序可能会停止工作。</span><span class="sxs-lookup"><span data-stu-id="521f9-339">If you have unsupported libraries registered in a [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] database, your [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] application may stop working after upgrading to [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)].</span></span> <span data-ttu-id="521f9-340">这是因为，在 GAC 中为库提供服务或升级库时并不会更新 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 中的程序集。</span><span class="sxs-lookup"><span data-stu-id="521f9-340">This is because servicing or upgrading libraries in the GAC does not update assemblies inside [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="521f9-341">如果某一程序集存在于 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 数据库和 GAC 中，该程序集的两个副本必须完全匹配。</span><span class="sxs-lookup"><span data-stu-id="521f9-341">If an assembly exists both in a [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] database and in the GAC, the two copies of the assembly must exactly match.</span></span> <span data-ttu-id="521f9-342">如果不一致，当 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] CLR 集成功能使用该程序集时，将发生错误。</span><span class="sxs-lookup"><span data-stu-id="521f9-342">If they do not match, an error will occur when the assembly is used by [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] CLR integration.</span></span> <span data-ttu-id="521f9-343">有关详细信息，请参阅[支持的 .NET Framework 库](../relational-databases/clr-integration/database-objects/supported-net-framework-libraries.md)。</span><span class="sxs-lookup"><span data-stu-id="521f9-343">For more information, see [Supported .NET Framework Libraries](../relational-databases/clr-integration/database-objects/supported-net-framework-libraries.md).</span></span><br /><br /> <span data-ttu-id="521f9-344">升级数据库之后，请使用 ALTER ASSEMBLY 语句对该程序集在 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 数据库中的副本提供服务或进行升级。</span><span class="sxs-lookup"><span data-stu-id="521f9-344">After upgrading your database, service or upgrade the copy of the assembly inside your [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] databases with the ALTER ASSEMBLY statement.</span></span> <span data-ttu-id="521f9-345">有关详细信息，请参阅[知识库文章 949080](https://go.microsoft.com/fwlink/?LinkId=154563)。</span><span class="sxs-lookup"><span data-stu-id="521f9-345">For more information, see [Knowledge Base article 949080](https://go.microsoft.com/fwlink/?LinkId=154563).</span></span><br /><br /> <span data-ttu-id="521f9-346">若要检测是否在应用程序中使用了任何不支持的 .NET Framework 库，请在数据库中运行以下查询。</span><span class="sxs-lookup"><span data-stu-id="521f9-346">To detect whether you are using any unsupported .NET framework library in your application, run the following query in your database.</span></span><br /><br /> `SELECT name FROM sys.assemblies WHERE clr_name LIKE '%publickeytoken=b03f5f7f11d50a3a,%';`|  
|<span data-ttu-id="521f9-347">CLR 例程</span><span class="sxs-lookup"><span data-stu-id="521f9-347">CLR Routines</span></span>|<span data-ttu-id="521f9-348">在 CLR 用户定义函数、用户定义聚合或用户定义类型 (UDT) 内使用模拟可导致应用程序在升级到 [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] 后因出现错误 6522 而失败。</span><span class="sxs-lookup"><span data-stu-id="521f9-348">Using impersonation inside CLR user-defined functions, user-defined aggregates, or user-defined types (UDTs) may cause your application to fail with error 6522 after upgrading to [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)].</span></span> <span data-ttu-id="521f9-349">下列情况在 [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)] 中成功，而在 [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] 中则失败。</span><span class="sxs-lookup"><span data-stu-id="521f9-349">The following scenarios succeed in [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)] but fail in [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)].</span></span> <span data-ttu-id="521f9-350">针对每种情况提供了相应的解决方案。</span><span class="sxs-lookup"><span data-stu-id="521f9-350">Resolutions are provided for each scenario.</span></span><br /><br /> <span data-ttu-id="521f9-351">使用模拟的 CLR 用户定义函数、用户定义聚合或 UDT 方法具有类型为、、、、、 `nvarchar(max)` `varchar(max)` `varbinary(max)` `ntext` `text` `image` 或大型 udt 的参数，并且没有方法的**dataaccesskind.read**属性。</span><span class="sxs-lookup"><span data-stu-id="521f9-351">A CLR user-defined function, user-defined aggregate, or UDT method that uses impersonation has a parameter of type `nvarchar(max)`, `varchar(max)`, `varbinary(max)`, `ntext`, `text`, `image`, or a large UDT, and does not have the **DataAccessKind.Read** attribute on the method.</span></span> <span data-ttu-id="521f9-352">若要解决此问题，请在方法中添加**dataaccesskind.read**属性，重新编译该程序集，然后重新部署例程和程序集。</span><span class="sxs-lookup"><span data-stu-id="521f9-352">To resolve this issue, add the **DataAccessKind.Read** attribute on the method, recompile the assembly, and re-deploy the routine and the assembly.</span></span><br /><br /> <span data-ttu-id="521f9-353">具有执行模拟的**Init**方法的 CLR 表值函数。</span><span class="sxs-lookup"><span data-stu-id="521f9-353">A CLR table-valued function that has an **Init** method that performs impersonation.</span></span> <span data-ttu-id="521f9-354">若要解决此问题，请在方法中添加**dataaccesskind.read**属性，重新编译该程序集，然后重新部署例程和程序集。</span><span class="sxs-lookup"><span data-stu-id="521f9-354">To resolve this issue add the **DataAccessKind.Read** attribute on the method, recompile the assembly, and re-deploy the routine and the assembly.</span></span><br /><br /> <span data-ttu-id="521f9-355">具有执行模拟的**FillRow**方法的 CLR 表值函数。</span><span class="sxs-lookup"><span data-stu-id="521f9-355">A CLR table-valued function that has a **FillRow** method that performs impersonation.</span></span> <span data-ttu-id="521f9-356">若要解决此问题，请从**FillRow**方法中删除模拟。</span><span class="sxs-lookup"><span data-stu-id="521f9-356">To resolve this issue, remove impersonation from the **FillRow** method.</span></span> <span data-ttu-id="521f9-357">不要使用**FillRow**方法访问外部资源。</span><span class="sxs-lookup"><span data-stu-id="521f9-357">Do not access external resources by using the **FillRow** method.</span></span> <span data-ttu-id="521f9-358">相反，从**Init**方法访问外部资源。</span><span class="sxs-lookup"><span data-stu-id="521f9-358">Instead, access external resources from the **Init** method.</span></span>|  
  
### <a name="dynamic-management-views"></a><span data-ttu-id="521f9-359">动态管理视图</span><span class="sxs-lookup"><span data-stu-id="521f9-359">Dynamic Management Views</span></span>  
  
|<span data-ttu-id="521f9-360">查看</span><span class="sxs-lookup"><span data-stu-id="521f9-360">View</span></span>|<span data-ttu-id="521f9-361">说明</span><span class="sxs-lookup"><span data-stu-id="521f9-361">Description</span></span>|  
|----------|-----------------|  
|<span data-ttu-id="521f9-362">sys.dm_os_sys_info</span><span class="sxs-lookup"><span data-stu-id="521f9-362">sys.dm_os_sys_info</span></span>|<span data-ttu-id="521f9-363">删除了 cpu_ticks_in_ms 和 sqlserver_start_time_cpu_ticks 列。</span><span class="sxs-lookup"><span data-stu-id="521f9-363">Removed the cpu_ticks_in_ms and sqlserver_start_time_cpu_ticks columns.</span></span>|  
|<span data-ttu-id="521f9-364">sys. dm_exec_query_resource_semaphoressys dm_exec_query_memory_grants</span><span class="sxs-lookup"><span data-stu-id="521f9-364">sys.dm_exec_query_resource_semaphoressys.dm_exec_query_memory_grants</span></span>|<span data-ttu-id="521f9-365">resource_semaphore_id 列不是 [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] 中的唯一 ID。</span><span class="sxs-lookup"><span data-stu-id="521f9-365">The resource_semaphore_id column is not a unique ID in [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)].</span></span> <span data-ttu-id="521f9-366">此更改会对故障排除查询执行造成影响。</span><span class="sxs-lookup"><span data-stu-id="521f9-366">This change can affect troubleshooting query execution.</span></span> <span data-ttu-id="521f9-367">有关详细信息，请参阅[sys.databases&#41;dm_exec_query_resource_semaphores &#40;](/sql/relational-databases/system-dynamic-management-views/sys-dm-exec-query-resource-semaphores-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="521f9-367">For more information, see [sys.dm_exec_query_resource_semaphores &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-exec-query-resource-semaphores-transact-sql).</span></span>|  
  
### <a name="errors-and-events"></a><span data-ttu-id="521f9-368">错误和事件</span><span class="sxs-lookup"><span data-stu-id="521f9-368">Errors and Events</span></span>  
  
|<span data-ttu-id="521f9-369">功能</span><span class="sxs-lookup"><span data-stu-id="521f9-369">Feature</span></span>|<span data-ttu-id="521f9-370">说明</span><span class="sxs-lookup"><span data-stu-id="521f9-370">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="521f9-371">登录错误</span><span class="sxs-lookup"><span data-stu-id="521f9-371">Login errors</span></span>|<span data-ttu-id="521f9-372">在 [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)] 中，当使用 SQL 登录名连接到配置为仅使用 Windows 身份验证的服务器时，会返回错误 18452。</span><span class="sxs-lookup"><span data-stu-id="521f9-372">In [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)], error 18452 is returned when a SQL login is used to connect to a server configured to use only Windows Authentication.</span></span> <span data-ttu-id="521f9-373">在 [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] 中，则会返回错误 18456。</span><span class="sxs-lookup"><span data-stu-id="521f9-373">In [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)], error 18456 is returned instead.</span></span>|  
  
### <a name="showplan"></a><span data-ttu-id="521f9-374">Showplan</span><span class="sxs-lookup"><span data-stu-id="521f9-374">Showplan</span></span>  
  
|<span data-ttu-id="521f9-375">功能</span><span class="sxs-lookup"><span data-stu-id="521f9-375">Feature</span></span>|<span data-ttu-id="521f9-376">说明</span><span class="sxs-lookup"><span data-stu-id="521f9-376">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="521f9-377">显示计划 XML 架构</span><span class="sxs-lookup"><span data-stu-id="521f9-377">Showplan XML schema</span></span>|<span data-ttu-id="521f9-378">将一个新的**SeekPredicateNew**元素添加到显示计划 XML 架构，并将 (**SqlPredicatesType**) 的封闭 xsd 序列转换为 **\<xsd:choice>** 项。</span><span class="sxs-lookup"><span data-stu-id="521f9-378">A new **SeekPredicateNew** element is added to the Showplan XML schema, and the enclosing xsd sequence (**SqlPredicatesType**) is converted into an **\<xsd:choice>** item.</span></span> <span data-ttu-id="521f9-379">一个**或多个** **SeekPredicate**元素不能出现在显示计划 XML 中。</span><span class="sxs-lookup"><span data-stu-id="521f9-379">Instead of one or more **SeekPredicate** elements, one or more **SeekPredicateNew** elements may now appear in the Showplan XML.</span></span> <span data-ttu-id="521f9-380">这两种元素是相互排斥的。</span><span class="sxs-lookup"><span data-stu-id="521f9-380">The two elements are mutually exclusive.</span></span> <span data-ttu-id="521f9-381">**SeekPredicate**在显示计划 XML 架构中进行维护，以便向后兼容;但是，在中创建的查询计划 [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] 可能包含**SeekPredicateNew**元素。</span><span class="sxs-lookup"><span data-stu-id="521f9-381">**SeekPredicate** is maintained in the Showplan XML schema for backwards compatibility; however, query plans created in [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] may contain the **SeekPredicateNew** element.</span></span> <span data-ttu-id="521f9-382">如果**QueryPlan**元素不存在，预计仅从节点 ShowPlanXML/BatchSequence/Batch//StmtSimple/RelOp/IndexScan/SeekPredicates 中检索**SeekPredicate**子元素的应用程序可能会失败。</span><span class="sxs-lookup"><span data-stu-id="521f9-382">Applications that expect to retrieve only the **SeekPredicate** child from the node ShowPlanXML/BatchSequence/Batch/Statements/StmtSimple/QueryPlan/RelOp/IndexScan/SeekPredicates may fail if the **SeekPredicate** element does not exist.</span></span> <span data-ttu-id="521f9-383">重写应用程序以预期此节点中的**SeekPredicate**或**SeekPredicateNew**元素。</span><span class="sxs-lookup"><span data-stu-id="521f9-383">Rewrite the application to expect either the **SeekPredicate** or **SeekPredicateNew** element in this node.</span></span> <span data-ttu-id="521f9-384">有关更多信息，请参见 。</span><span class="sxs-lookup"><span data-stu-id="521f9-384">For more information, see .</span></span>|  
|<span data-ttu-id="521f9-385">显示计划 XML 架构</span><span class="sxs-lookup"><span data-stu-id="521f9-385">Showplan XML schema</span></span>|<span data-ttu-id="521f9-386">新的**indexkind.range**特性将添加到显示计划 XML 架构中的**ObjectType**复杂类型。</span><span class="sxs-lookup"><span data-stu-id="521f9-386">A new **IndexKind** attribute is added to the **ObjectType** complex type in the Showplan XML schema.</span></span> <span data-ttu-id="521f9-387">根据 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 架构严格验证 [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)] 计划的应用程序将失败。</span><span class="sxs-lookup"><span data-stu-id="521f9-387">Applications that strictly validate [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] plans against the [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)] schema will fail.</span></span>|  
  
### <a name="transact-sql"></a><span data-ttu-id="521f9-388">Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="521f9-388">Transact-SQL</span></span>  
  
|<span data-ttu-id="521f9-389">功能</span><span class="sxs-lookup"><span data-stu-id="521f9-389">Feature</span></span>|<span data-ttu-id="521f9-390">说明</span><span class="sxs-lookup"><span data-stu-id="521f9-390">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="521f9-391">ALTER_AUTHORIZATION_DATABASE DDL 事件</span><span class="sxs-lookup"><span data-stu-id="521f9-391">ALTER_AUTHORIZATION_DATABASE DDL event</span></span>|<span data-ttu-id="521f9-392">在中 [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)] ，当 ddl 事件 ALTER_AUTHORIZATION_DATABASE 激发时，如果数据定义语言中的安全对象的实体类型 (DDL) 操作是一个对象，则会在此事件的 EVENTDATA xml 的**ObjectType**元素中返回值 "object"。</span><span class="sxs-lookup"><span data-stu-id="521f9-392">In [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)], when the DDL event ALTER_AUTHORIZATION_DATABASE fires, the value 'object' is returned in the **ObjectType** element of the EVENTDATA xml for this event when the entity type of the securable in the data definition language (DDL) operation is an object.</span></span> <span data-ttu-id="521f9-393">在 [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] 中，则返回实际类型（例如，“table”或“function”）。</span><span class="sxs-lookup"><span data-stu-id="521f9-393">In [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)], the actual type (for example, 'table', or 'function') is returned.</span></span>|  
|<span data-ttu-id="521f9-394">CONVERT</span><span class="sxs-lookup"><span data-stu-id="521f9-394">CONVERT</span></span>|<span data-ttu-id="521f9-395">如果传递到 CONVERT 函数的样式无效，则会在二进制转换为字符或字符转换为二进制时，返回一个错误。</span><span class="sxs-lookup"><span data-stu-id="521f9-395">If an invalid style is passed to the CONVERT function, an error is returned when the type of conversion is binary to character or character to binary.</span></span> <span data-ttu-id="521f9-396">在早期版本的 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 中，该无效样式会设置为二进制与字符间相互转换时的默认样式。</span><span class="sxs-lookup"><span data-stu-id="521f9-396">In earlier versions of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], the invalid style is set to the default style for binary-to-character and character-to-binary conversions.</span></span>|  
|<span data-ttu-id="521f9-397">对程序集 GRANT/DENY/REVOKE EXECUTE</span><span class="sxs-lookup"><span data-stu-id="521f9-397">GRANT/DENY/REVOKE EXECUTE on assemblies</span></span>|<span data-ttu-id="521f9-398">不能对程序集授予、拒绝或撤消“EXECUTE”权限。</span><span class="sxs-lookup"><span data-stu-id="521f9-398">EXECUTE permission cannot be granted, denied, or revoked to assemblies.</span></span> <span data-ttu-id="521f9-399">此权限不起任何作用，并且现在会导致一个错误。</span><span class="sxs-lookup"><span data-stu-id="521f9-399">This permission has no affect and now causes an error.</span></span> <span data-ttu-id="521f9-400">可以对引用程序集方法的存储过程或函数授予、拒绝或撤消“EXECUTE”权限。</span><span class="sxs-lookup"><span data-stu-id="521f9-400">Grant, deny, or revoke EXECUTE permission on the stored procedures or functions that reference the assembly method instead.</span></span>|  
|<span data-ttu-id="521f9-401">对系统类型 GRANT/DENY/REVOKE 权限</span><span class="sxs-lookup"><span data-stu-id="521f9-401">GRANT/DENY/REVOKE permissions on system types</span></span>|<span data-ttu-id="521f9-402">不能对系统类型授予、拒绝或撤消权限。</span><span class="sxs-lookup"><span data-stu-id="521f9-402">Permissions cannot be granted, denied, or revoked to system types.</span></span> <span data-ttu-id="521f9-403">在早期版本的 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 中，这些语句会成功，但是不起任何作用。</span><span class="sxs-lookup"><span data-stu-id="521f9-403">In earlier versions of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], these statements succeed but have no effect.</span></span> <span data-ttu-id="521f9-404">在 [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] 中，则会返回错误。</span><span class="sxs-lookup"><span data-stu-id="521f9-404">In [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)], an error is returned.</span></span>|  
|<span data-ttu-id="521f9-405">GROUP BY</span><span class="sxs-lookup"><span data-stu-id="521f9-405">GROUP BY</span></span>|<span data-ttu-id="521f9-406">GROUP BY 子句在用于分组依据列表的表达式中不能包含子查询。</span><span class="sxs-lookup"><span data-stu-id="521f9-406">The GROUP BY clause cannot contain a subquery in an expression that is used for the group by list.</span></span> <span data-ttu-id="521f9-407">在早期版本的 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 中，允许这样做。</span><span class="sxs-lookup"><span data-stu-id="521f9-407">In earlier versions of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], this was allowed.</span></span> <span data-ttu-id="521f9-408">在 [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] 中，则会返回错误 144。</span><span class="sxs-lookup"><span data-stu-id="521f9-408">In [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)], error 144 is returned.</span></span><br /><br /> <span data-ttu-id="521f9-409">例如，以下代码在 SQL Server 2005 中运行成功而在 SQL Server 2008 中运行失败：</span><span class="sxs-lookup"><span data-stu-id="521f9-409">For example, the following code will succeed in SQL Server 2005 and fail in SQL Server 2008.</span></span><br /><br /> `DECLARE @Test TABLE(a int NOT NULL);` <br /> `INSERT INTO @Test SELECT 1 union ALL SELECT 2;` <br /> `SELECT COUNT(*)` <br /> `FROM @Test` <br /> `GROUP BY CASE WHEN a IN (SELECT t.a FROM @Test AS t)` <br /> `THEN 1 ELSE 0` <br /> `END;`|  
|<span data-ttu-id="521f9-410">OUTPUT 子句</span><span class="sxs-lookup"><span data-stu-id="521f9-410">OUTPUT clause</span></span>|<span data-ttu-id="521f9-411">为了防止出现不确定的行为，当某个列是通过下列方法之一定义时，OUTPUT 子句不能通过视图或内联表值函数引用该列：</span><span class="sxs-lookup"><span data-stu-id="521f9-411">To prevent nondeterministic behavior, the OUTPUT clause cannot reference a column from a view or inline table-valued function when that column is defined by one of the following methods:</span></span><br /><br /> <span data-ttu-id="521f9-412">子查询。</span><span class="sxs-lookup"><span data-stu-id="521f9-412">A subquery.</span></span><br /><br /> <span data-ttu-id="521f9-413">执行用户数据访问或系统数据访问（或者被认为执行此类访问）的用户定义函数。</span><span class="sxs-lookup"><span data-stu-id="521f9-413">A user-defined function that performs user- or system-data access, or is assumed to perform such access.</span></span><br /><br /> <span data-ttu-id="521f9-414">在定义中包含执行用户数据访问或系统数据访问的用户定义函数的计算列。</span><span class="sxs-lookup"><span data-stu-id="521f9-414">A computed column that contains in its definition a user-defined function that performs user- or system-data access.</span></span><br /><br /> <br /><br /> <span data-ttu-id="521f9-415">如果 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 在 OUTPUT 子句中检测到了此类列，将引发错误 4186。</span><span class="sxs-lookup"><span data-stu-id="521f9-415">When [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] detects such a column in the OUTPUT clause, error 4186 is raised.</span></span> <span data-ttu-id="521f9-416">有关详细信息，请参阅[MSSQLSERVER_4186](../relational-databases/errors-events/mssqlserver-4186-database-engine-error.md)。</span><span class="sxs-lookup"><span data-stu-id="521f9-416">For more information, see [MSSQLSERVER_4186](../relational-databases/errors-events/mssqlserver-4186-database-engine-error.md).</span></span>|  
|<span data-ttu-id="521f9-417">OUTPUT INTO 子句</span><span class="sxs-lookup"><span data-stu-id="521f9-417">OUTPUT INTO clause</span></span>|<span data-ttu-id="521f9-418">OUTPUT INTO 子句的目标表不能有任何已启用的触发器。</span><span class="sxs-lookup"><span data-stu-id="521f9-418">The target table of the OUTPUT INTO clause cannot have any enabled triggers.</span></span>|  
|<span data-ttu-id="521f9-419">precompute rank 服务器级选项</span><span class="sxs-lookup"><span data-stu-id="521f9-419">precompute rank server-level option</span></span>|<span data-ttu-id="521f9-420">[!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] 不支持此选项。</span><span class="sxs-lookup"><span data-stu-id="521f9-420">This option is not supported in [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)].</span></span> <span data-ttu-id="521f9-421">请尽快修改当前使用此功能的应用程序。</span><span class="sxs-lookup"><span data-stu-id="521f9-421">Modify applications that currently use this feature as soon as possible.</span></span>|  
|<span data-ttu-id="521f9-422">READPAST 表提示</span><span class="sxs-lookup"><span data-stu-id="521f9-422">READPAST table hint</span></span>|<span data-ttu-id="521f9-423">您不能在快照隔离下指定 READPAST 提示。</span><span class="sxs-lookup"><span data-stu-id="521f9-423">You cannot specify the READPAST hint under Snapshot Isolation.</span></span><br /><br /> <span data-ttu-id="521f9-424">在将 READ_COMMITED_SNAPSHOT 或 ALLOW_SNAPSHOT_ISOLATION 数据库选项设置为 ON 时，将忽略 READPAST 提示。</span><span class="sxs-lookup"><span data-stu-id="521f9-424">The READPAST hint is ignored when either the READ_COMMITED_SNAPSHOT or ALLOW_SNAPSHOT_ISOLATION database option is set to ON.</span></span> <span data-ttu-id="521f9-425">但是，如果您将 READPAST 提示与 READCOMMITTEDLOCK 相结合，则 READPAST 行为与阻止 READCOMMITTED 提示等效。</span><span class="sxs-lookup"><span data-stu-id="521f9-425">However, if you combine the READPAST hint with READCOMMITTEDLOCK, the READPAST behavior is same as with the blocking READCOMMITTED hint.</span></span>|  
|<span data-ttu-id="521f9-426">sp_helpuser</span><span class="sxs-lookup"><span data-stu-id="521f9-426">sp_helpuser</span></span>|<span data-ttu-id="521f9-427">Sp_helpuser 存储过程的结果集中返回的以下列名发生了更改：</span><span class="sxs-lookup"><span data-stu-id="521f9-427">The following column names that are returned in the result set of the sp_helpuser stored procedure have changed:</span></span><br /><br /> <span data-ttu-id="521f9-428">目前的 "名" 是：</span><span class="sxs-lookup"><span data-stu-id="521f9-428">GroupName is now:</span></span><br />                            <span data-ttu-id="521f9-429">RoleName</span><span class="sxs-lookup"><span data-stu-id="521f9-429">RoleName</span></span><br /><br /> <span data-ttu-id="521f9-430">现在 Group_name：</span><span class="sxs-lookup"><span data-stu-id="521f9-430">Group_name is now:</span></span><br />                            <span data-ttu-id="521f9-431">Role_name</span><span class="sxs-lookup"><span data-stu-id="521f9-431">Role_name</span></span><br /><br /> <span data-ttu-id="521f9-432">现在 Group_id：</span><span class="sxs-lookup"><span data-stu-id="521f9-432">Group_id is now:</span></span><br />                            <span data-ttu-id="521f9-433">Role_id</span><span class="sxs-lookup"><span data-stu-id="521f9-433">Role_id</span></span><br /><br /> <span data-ttu-id="521f9-434">现在 Users_in_group：</span><span class="sxs-lookup"><span data-stu-id="521f9-434">Users_in_group is now:</span></span><br />                            <span data-ttu-id="521f9-435">Users_in_role</span><span class="sxs-lookup"><span data-stu-id="521f9-435">Users_in_role</span></span>|  
|<span data-ttu-id="521f9-436">透明数据加密</span><span class="sxs-lookup"><span data-stu-id="521f9-436">Transparent Data Encryption</span></span>|<span data-ttu-id="521f9-437">在 I/O 级别执行透明数据加密 (TDE)：页结构在内存中不加密，而仅在将页写入到磁盘后才对页结构进行加密。</span><span class="sxs-lookup"><span data-stu-id="521f9-437">Transparent data encryption (TDE) is performed at the I/O level: the page structure is unencrypted in memory and is encrypted only when the page is written to disk.</span></span> <span data-ttu-id="521f9-438">数据库文件和日志文件均加密。</span><span class="sxs-lookup"><span data-stu-id="521f9-438">Both the database files and log files are encrypted.</span></span> <span data-ttu-id="521f9-439">当数据库使用 TDE 时，那些跳过常规 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 机制来访问页面（例如，通过直接扫描数据或日志文件）的第三方应用程序将失败，因为文件中的数据已被加密。</span><span class="sxs-lookup"><span data-stu-id="521f9-439">Third-party applications that bypass the regular [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] mechanism for accessing pages (for example, by scanning the data or log files directly), will fail when a database uses TDE because the data is encrypted in the files.</span></span> <span data-ttu-id="521f9-440">此类应用程序可以利用 Windows 加密 API 来开发用来在 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 外部对数据进行解密的解决方案。</span><span class="sxs-lookup"><span data-stu-id="521f9-440">Such applications can leverage the Window Cryptographic API to develop a solution for decrypting the data outside of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span>|  
  
### <a name="xquery"></a><span data-ttu-id="521f9-441">XQuery</span><span class="sxs-lookup"><span data-stu-id="521f9-441">XQuery</span></span>  
  
|<span data-ttu-id="521f9-442">功能</span><span class="sxs-lookup"><span data-stu-id="521f9-442">Feature</span></span>|<span data-ttu-id="521f9-443">说明</span><span class="sxs-lookup"><span data-stu-id="521f9-443">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="521f9-444">Datetime 支持</span><span class="sxs-lookup"><span data-stu-id="521f9-444">Datetime support</span></span>|<span data-ttu-id="521f9-445">在中 [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)] ，数据类型 `xs:time` 、 `xs:date` 和 `xs:dateTime` 不支持时区。</span><span class="sxs-lookup"><span data-stu-id="521f9-445">In [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)], the data types `xs:time`, `xs:date`, and `xs:dateTime` do not have timezone support.</span></span> <span data-ttu-id="521f9-446">时区数据会映射到 UTC 时区。</span><span class="sxs-lookup"><span data-stu-id="521f9-446">Timezone data is mapped to the UTC timezone.</span></span> [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] <span data-ttu-id="521f9-447">提供了符合标准的行为，从而导致了以下变化：</span><span class="sxs-lookup"><span data-stu-id="521f9-447">, provides standard conformant behavior, resulting in the following changes:</span></span><br /><br /> <span data-ttu-id="521f9-448">将验证没有时区的值。</span><span class="sxs-lookup"><span data-stu-id="521f9-448">Values without timezone are validated.</span></span><br /><br /> <span data-ttu-id="521f9-449">将保留提供的时区或缺少的时区。</span><span class="sxs-lookup"><span data-stu-id="521f9-449">The provided timezone or the absence of a timezone is preserved.</span></span><br /><br /> <span data-ttu-id="521f9-450">修改了内部存储表示形式。</span><span class="sxs-lookup"><span data-stu-id="521f9-450">The internal storage representation is modified.</span></span><br /><br /> <span data-ttu-id="521f9-451">增加了存储值的分辨率。</span><span class="sxs-lookup"><span data-stu-id="521f9-451">Resolution of stored values is increased.</span></span><br /><br /> <span data-ttu-id="521f9-452">不允许使用负年份。</span><span class="sxs-lookup"><span data-stu-id="521f9-452">Negative years are disallowed.</span></span><br /><br /> <br /><br /> <span data-ttu-id="521f9-453">注意：修改应用程序和 XQuery 表达式，以考虑新的类型值。</span><span class="sxs-lookup"><span data-stu-id="521f9-453">Note: Modify applications and XQuery expressions to account for the new type values.</span></span>|  
|<span data-ttu-id="521f9-454">XQuery 和 Xpath 表达式</span><span class="sxs-lookup"><span data-stu-id="521f9-454">XQuery and Xpath expressions</span></span>|<span data-ttu-id="521f9-455">在中 [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)] ，允许使用以冒号 ( "：" ) 开头的 XQuery 或 XPath 表达式中的步骤。</span><span class="sxs-lookup"><span data-stu-id="521f9-455">In [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)], steps in an XQuery or XPath expression that begin with a colon (':') are allowed.</span></span> <span data-ttu-id="521f9-456">例如，下面的语句在路径表达式中包含以冒号开头的名称测试 (`CTR02)`。</span><span class="sxs-lookup"><span data-stu-id="521f9-456">For example, the following statement contains a name test (`CTR02)` within the path expression that begins with a colon.</span></span><br /><br /> `SELECT FileContext.query('for n$ in //CTR return <C>{data )(n$/:CTR02)} </C>) AS Files FROM dbo.MyTable;`<br /><br /> <span data-ttu-id="521f9-457">在 [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] 中，这种用法是不允许的，因为它不符合 XML 标准。</span><span class="sxs-lookup"><span data-stu-id="521f9-457">In [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)], this usage is disallowed because it does not conform to XML standards.</span></span> <span data-ttu-id="521f9-458">返回错误 9341。</span><span class="sxs-lookup"><span data-stu-id="521f9-458">Error 9341 is returned.</span></span> <span data-ttu-id="521f9-459">请删除前导冒号或为名称测试指定一个前缀，例如 (n$/CTR02) 或 (n$/p1:CTR02)。</span><span class="sxs-lookup"><span data-stu-id="521f9-459">Remove the leading colon or specify a prefix for the name test--for example, (n$/CTR02) or (n$/p1:CTR02).</span></span>|  
  
### <a name="connecting"></a><span data-ttu-id="521f9-460">Connecting</span><span class="sxs-lookup"><span data-stu-id="521f9-460">Connecting</span></span>  
  
|<span data-ttu-id="521f9-461">功能</span><span class="sxs-lookup"><span data-stu-id="521f9-461">Feature</span></span>|<span data-ttu-id="521f9-462">说明</span><span class="sxs-lookup"><span data-stu-id="521f9-462">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="521f9-463">使用 SSL 从 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Native Client 进行连接</span><span class="sxs-lookup"><span data-stu-id="521f9-463">Connecting from [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Native Client using SSL</span></span>|<span data-ttu-id="521f9-464">当使用 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Native Client 进行连接时，将 "SERVER=shortname; FORCE ENCRYPTION=true" 用于其主题指定完全限定域名 (FQDN) 的证书的应用程序在过去由于放宽的验证而已进行了连接。</span><span class="sxs-lookup"><span data-stu-id="521f9-464">When connecting with [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Native Client, applications that use "SERVER=shortname; FORCE ENCRYPTION=true" with certificate whose Subjects specify Fully Qualified Domain Names (FQDN's) have connected in the past due to relaxed validation.</span></span> <span data-ttu-id="521f9-465">SQL Server 2008 R2 通过为证书实现 FQDN 主题增强安全性。</span><span class="sxs-lookup"><span data-stu-id="521f9-465">SQL Server 2008 R2 enhances security by enforcing FQDN subjects for certificates.</span></span> <span data-ttu-id="521f9-466">依赖于已放宽验证的应用程序必须采取以下措施之一：</span><span class="sxs-lookup"><span data-stu-id="521f9-466">Applications that rely upon relaxed validation must take one of the following actions:</span></span><br /><br /> <span data-ttu-id="521f9-467">在连接字符串中使用 FQDN。</span><span class="sxs-lookup"><span data-stu-id="521f9-467">Use the FQDN in the connection string.</span></span><br /><br /> <span data-ttu-id="521f9-468">-如果在应用程序外部配置了连接字符串的 SERVER 关键字，则此选项不要求重新编译应用程序。</span><span class="sxs-lookup"><span data-stu-id="521f9-468">-This option does not require recompiling the application if the SERVER keyword of the connection string is configured outside the application.</span></span><br /><br /> <span data-ttu-id="521f9-469">-如果应用程序的连接字符串具有硬编码，则此选项不起作用。</span><span class="sxs-lookup"><span data-stu-id="521f9-469">-This option does not work for applications that have their connection strings hardcoded.</span></span><br /><br /> <span data-ttu-id="521f9-470">-对于使用数据库镜像的应用程序，此选项不适用于使用数据库镜像的应用程序，因为镜像服务器使用简单名称进行回复。</span><span class="sxs-lookup"><span data-stu-id="521f9-470">-This option does not work for applications that use Database Mirroring since the mirrored server replies with a simple name.</span></span>|  
||<span data-ttu-id="521f9-471">为映射到 FQDN 的短名称添加别名。</span><span class="sxs-lookup"><span data-stu-id="521f9-471">Add an alias for the shortname to map to the FQDN.</span></span><br /><br /> <span data-ttu-id="521f9-472">-即使应用程序的连接字符串具有硬编码，此选项也适用。</span><span class="sxs-lookup"><span data-stu-id="521f9-472">-This option works even for applications that have their connection strings hardcoded.</span></span><br /><br /> <span data-ttu-id="521f9-473">-此选项不适用于使用数据库镜像的应用程序，因为提供程序不会查找收到的故障转移伙伴名称的别名。</span><span class="sxs-lookup"><span data-stu-id="521f9-473">-This option does not work for applications that use Database Mirroring since the providers don't look up aliases for received failover partner names.</span></span>|  
||<span data-ttu-id="521f9-474">为短名称签发一个证书。</span><span class="sxs-lookup"><span data-stu-id="521f9-474">Have a certificate issued for shortname.</span></span><br /><br /> <span data-ttu-id="521f9-475">-此选项适用于所有应用程序。</span><span class="sxs-lookup"><span data-stu-id="521f9-475">-This option works for all applications.</span></span>|  

## <a name="breaking-changes-in-sql-server-2005"></a><a name="Yukon"></a><span data-ttu-id="521f9-476">SQL Server 2005 中的重大更改</span><span class="sxs-lookup"><span data-stu-id="521f9-476">Breaking Changes in SQL Server 2005</span></span>  

[!INCLUDE[Archived documentation for very old versions of SQL Server](../includes/paragraph-content/previous-versions-archive-documentation-sql-server.md)]

## <a name="see-also"></a><span data-ttu-id="521f9-477">另请参阅</span><span class="sxs-lookup"><span data-stu-id="521f9-477">See Also</span></span>  
 <span data-ttu-id="521f9-478">[SQL Server 2014 中不推荐使用的数据库引擎功能](deprecated-database-engine-features-in-sql-server-2016.md?view=sql-server-2014) </span><span class="sxs-lookup"><span data-stu-id="521f9-478">[Deprecated Database Engine Features in SQL Server 2014](deprecated-database-engine-features-in-sql-server-2016.md?view=sql-server-2014) </span></span>  
 <span data-ttu-id="521f9-479">[SQL Server 2014 中数据库引擎功能的行为更改](../../2014/database-engine/behavior-changes-to-database-engine-features-in-sql-server-2014.md?view=sql-server-2014) </span><span class="sxs-lookup"><span data-stu-id="521f9-479">[Behavior Changes to Database Engine Features in SQL Server 2014](../../2014/database-engine/behavior-changes-to-database-engine-features-in-sql-server-2014.md?view=sql-server-2014) </span></span>  
 <span data-ttu-id="521f9-480">[SQL Server 2014 中废止数据库引擎功能](discontinued-database-engine-functionality-in-sql-server-2016.md?view=sql-server-2014) </span><span class="sxs-lookup"><span data-stu-id="521f9-480">[Discontinued Database Engine Functionality in SQL Server 2014](discontinued-database-engine-functionality-in-sql-server-2016.md?view=sql-server-2014) </span></span>  
 <span data-ttu-id="521f9-481">[SQL Server 数据库引擎的向后兼容性](sql-server-database-engine-backward-compatibility.md) </span><span class="sxs-lookup"><span data-stu-id="521f9-481">[SQL Server Database Engine Backward Compatibility](sql-server-database-engine-backward-compatibility.md) </span></span>  
 [<span data-ttu-id="521f9-482">ALTER DATABASE 兼容级别 (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="521f9-482">ALTER DATABASE Compatibility Level &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-database-transact-sql-compatibility-level)  
 [<span data-ttu-id="521f9-483">SQL Server 2014 中管理工具功能的重大更改</span><span class="sxs-lookup"><span data-stu-id="521f9-483">Breaking Changes to Management Tools Features in SQL Server 2014</span></span>](breaking-changes-to-management-tools-features-in-sql-server-2014.md?view=sql-server-2014)  
  
