---
title: 故障转移群集和 AlwaysOn 可用性组 (SQL Server) |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- clustering [SQL Server]
- Availability Groups [SQL Server], WSFC clusters
- Failover Cluster Instances [SQL Server], see failover clustering [SQL Server]
- quorum [SQL Server]
- failover clustering [SQL Server], AlwaysOn Availability Groups
- Availability Groups [SQL Server], Failover Cluster Instances
ms.assetid: 613bfbf1-9958-477b-a6be-c6d4f18785c3
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 64ee815c2b852849d9506ca6c3fc114d3d0e4935
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87585976"
---
# <a name="failover-clustering-and-alwayson-availability-groups-sql-server"></a><span data-ttu-id="8c804-102">故障转移群集和 AlwaysOn 可用性组 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="8c804-102">Failover Clustering and AlwaysOn Availability Groups (SQL Server)</span></span>
  [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]<span data-ttu-id="8c804-103">是在 [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] 中引入的高可用性和灾难恢复解决方案，它要求 Windows Server 故障转移群集 (WSFC)。</span><span class="sxs-lookup"><span data-stu-id="8c804-103">, the high availability and disaster recovery solution introduced in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)], requires Windows Server Failover Clustering (WSFC).</span></span> <span data-ttu-id="8c804-104">此外，尽管 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 不依赖于 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 故障转移群集，但您可以使用故障转移群集实例 (FCI) 来为可用性组承载可用性副本。</span><span class="sxs-lookup"><span data-stu-id="8c804-104">Also, though [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] is not dependent upon [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Failover Clustering, you can use a failover clustering instance (FCI) to host an availability replica for an availability group.</span></span> <span data-ttu-id="8c804-105">因此，了解每种群集技术所扮演的角色以及设计您的 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 环境所需的注意事项十分重要。</span><span class="sxs-lookup"><span data-stu-id="8c804-105">It is important to know the role of each clustering technology, and to know what considerations are necessary as you design your [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] environment.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="8c804-106">有关 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 概念的详细信息，请参阅 [AlwaysOn 可用性组概述 (SQL Server)](overview-of-always-on-availability-groups-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="8c804-106">For information about [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] concepts, see [Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md).</span></span>  
  

  
##  <a name="windows-server-failover-clustering-and-availability-groups"></a><a name="WSFC"></a><span data-ttu-id="8c804-107">Windows Server 故障转移群集和可用性组</span><span class="sxs-lookup"><span data-stu-id="8c804-107">Windows Server Failover Clustering and Availability Groups</span></span>  
 <span data-ttu-id="8c804-108">部署 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 需要一个 Windows Server 故障转移群集 (WSFC) 群集。</span><span class="sxs-lookup"><span data-stu-id="8c804-108">Deploying [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] requires a Windows Server Failover Clustering (WSFC) cluster.</span></span> <span data-ttu-id="8c804-109">若要启用 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]，一个 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例必须驻留在某一 WSFC 节点上，并且该 WSFC 群集和节点必须处于联机状态。</span><span class="sxs-lookup"><span data-stu-id="8c804-109">To be enabled for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], an instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] must reside on a WSFC node, and the WSFC cluster and node must be online.</span></span> <span data-ttu-id="8c804-110">此外，给定可用性组的每个可用性副本必须位于相同 WSFC 群集的不同节点上。</span><span class="sxs-lookup"><span data-stu-id="8c804-110">Furthermore, each availability replica of a given availability group must reside on a different node of the same WSFC cluster.</span></span> <span data-ttu-id="8c804-111">唯一的例外是在迁移到另一个 WSFC 群集时，此时一个可用性组可能会暂时跨两个群集。</span><span class="sxs-lookup"><span data-stu-id="8c804-111">The only exception is that while being migrated to another WSFC cluster, an availability group can temporarily straddle two clusters.</span></span>  
  
 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] <span data-ttu-id="8c804-112">依赖 Windows 故障转移群集 (WSFC) 群集来监视和管理属于某一指定可用性组的可用性副本的当前角色，并且确定故障转移事件是如何影响可用性副本的。</span><span class="sxs-lookup"><span data-stu-id="8c804-112">relies on the Windows Failover Clustering (WSFC) cluster to monitor and manage the current roles of the availability replicas that belong to a given availability group and to determine how a failover event affects the availability replicas.</span></span> <span data-ttu-id="8c804-113">为您创建的每个可用性组创建一个 WSFC 资源组。</span><span class="sxs-lookup"><span data-stu-id="8c804-113">A WSFC resource group is created for every availability group that you create.</span></span> <span data-ttu-id="8c804-114">WSFC 群集将监视此资源组，以便评估主副本的运行状况。</span><span class="sxs-lookup"><span data-stu-id="8c804-114">The WSFC cluster monitors this resource group to evaluate the health of the primary replica.</span></span>  
  
 <span data-ttu-id="8c804-115">针对 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 的仲裁基于 WSFC 群集中的所有节点，而与某一给定群集节点是否承载任何可用性副本无关。</span><span class="sxs-lookup"><span data-stu-id="8c804-115">The quorum for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] is based on all nodes in the WSFC cluster regardless of whether a given cluster node hosts any availability replicas.</span></span> <span data-ttu-id="8c804-116">与数据库镜像相反，在 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]中没有见证服务器角色。</span><span class="sxs-lookup"><span data-stu-id="8c804-116">In contrast to database mirroring, there is no witness role in [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span>  
  
 <span data-ttu-id="8c804-117">WSFC 群集的总体运行状况是由群集中节点仲裁的投票决定。</span><span class="sxs-lookup"><span data-stu-id="8c804-117">The overall health of a WSFC cluster is determined by the votes of quorum of nodes in the cluster.</span></span> <span data-ttu-id="8c804-118">如果 WSFC 群集由于计划外灾难或由于持续的硬件或通信故障而导致脱机，则需要管理员手动干预。</span><span class="sxs-lookup"><span data-stu-id="8c804-118">If the WSFC cluster goes offline because of an unplanned disaster, or due to a persistent hardware or communications failure, manual administrative intervention is required.</span></span> <span data-ttu-id="8c804-119">Windows Server 或 WSFC 群集管理员将需要“强制仲裁”，并在非容错配置中将仍有效的群集节点变为联机状态。</span><span class="sxs-lookup"><span data-stu-id="8c804-119">A Windows Server or WSFC cluster administrator will need to force a quorum and then bring the surviving cluster nodes back online in a non-fault-tolerant configuration.</span></span>  
  
> [!IMPORTANT]  
>  [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] <span data-ttu-id="8c804-120">注册表项是 WSFC 群集的子项。</span><span class="sxs-lookup"><span data-stu-id="8c804-120">registry keys are subkeys of the WSFC cluster.</span></span> <span data-ttu-id="8c804-121">如果您删除后重新创建了 WSFC 群集，则必须在其原始 WSFC 群集上承载可用性副本的每个 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 实例上都禁用然后重新启用 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 功能。</span><span class="sxs-lookup"><span data-stu-id="8c804-121">If you delete and re-create a WSFC cluster, you must disable and re-enable the [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] feature on each instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] that hosted an availability replica on the original WSFC cluster.</span></span>  
  
 <span data-ttu-id="8c804-122">有关在 Windows Server 故障转移群集 (WSFC) 节点上运行 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 的信息以及有关 WSFC 仲裁的信息，请参阅 [Windows Server 故障转移群集 (WSFC) 与 SQL Server](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="8c804-122">For information about running [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] on Windows Server Failover Clustering (WSFC) nodes and about WSFC quorum, see [Windows Server Failover Clustering &#40;WSFC&#41; with SQL Server](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md).</span></span>  
  
### <a name="cross-cluster-migration-of-alwayson-availability-groups-for-os-upgrade"></a><span data-ttu-id="8c804-123">针对操作系统升级的 AlwaysOn 可用性组的跨群集迁移</span><span class="sxs-lookup"><span data-stu-id="8c804-123">Cross-Cluster Migration of AlwaysOn Availability Groups for OS Upgrade</span></span>  
 <span data-ttu-id="8c804-124">从 [!INCLUDE[ssSQL11SP1](../../../includes/sssql11sp1-md.md)]开始， [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 支持部署的可用性组跨群集迁移到新的 Windows Server 故障转移群集 (WSFC) 群集。</span><span class="sxs-lookup"><span data-stu-id="8c804-124">Beginning with [!INCLUDE[ssSQL11SP1](../../../includes/sssql11sp1-md.md)], [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] supports cross-cluster migration of availability groups for deployments to a new Windows Server Failover Clustering (WSFC) cluster.</span></span> <span data-ttu-id="8c804-125">跨群集迁移将一个可用性组或一批可用性组移到新的目标 WSFC 群集，并且所用的停机时间最短。</span><span class="sxs-lookup"><span data-stu-id="8c804-125">A cross-cluster migration moves one availability group or a batch of availability groups to the new, destination WSFC cluster with minimal downtime.</span></span> <span data-ttu-id="8c804-126">通过跨群集迁移过程，您可以在升级到 [!INCLUDE[win8srv](../../../includes/win8srv-md.md)] 群集时维护您的服务级别协议 (SLA)。</span><span class="sxs-lookup"><span data-stu-id="8c804-126">The cross-cluster migration process enables you to maintain your service level agreements (SLAs) when upgrading to a [!INCLUDE[win8srv](../../../includes/win8srv-md.md)] cluster.</span></span> [!INCLUDE[ssSQL11SP1](../../../includes/sssql11sp1-md.md)]<span data-ttu-id="8c804-127">（或更高版本）必须安装并且为目标 WSFC 群集上的 AlwaysOn 启用。</span><span class="sxs-lookup"><span data-stu-id="8c804-127">(or a later version) must be installed and enabled for AlwaysOn on the destination WSFC cluster.</span></span> <span data-ttu-id="8c804-128">跨群集迁移能否成功取决于对目标 WSFC 群集的详尽计划和准备。</span><span class="sxs-lookup"><span data-stu-id="8c804-128">The success of a cross-cluster migration depends on thorough planning and preparation of the destination WSFC cluster.</span></span>  
  
 <span data-ttu-id="8c804-129">有关详细信息，请参阅[针对操作系统升级的 AlwaysOn 可用性组的跨群集迁移](https://msdn.microsoft.com/library/jj873730.aspx)。</span><span class="sxs-lookup"><span data-stu-id="8c804-129">For more information, see [Cross-Cluster Migration of AlwaysOn Availability Groups for OS Upgrade](https://msdn.microsoft.com/library/jj873730.aspx).</span></span>  
  
##  <a name="ssnoversion-failover-cluster-instances-fcis-and-availability-groups"></a><a name="SQLServerFC"></a> <span data-ttu-id="8c804-130">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 故障转移群集实例 (FCI) 和可用性组</span><span class="sxs-lookup"><span data-stu-id="8c804-130">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Failover Cluster Instances (FCIs) and Availability Groups</span></span>  
 <span data-ttu-id="8c804-131">您可以通过将 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 故障转移群集与 WSFC 群集一起实现，在服务器-实例级别设置第二层的故障转移。</span><span class="sxs-lookup"><span data-stu-id="8c804-131">You can set up a second layer of failover at the server-instance level by implementing [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover clustering together with the WSFC cluster.</span></span> <span data-ttu-id="8c804-132">可用性副本可由 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 的独立实例或 FCI 实例承载。</span><span class="sxs-lookup"><span data-stu-id="8c804-132">An availability replica can be hosted by either a standalone instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] or an FCI instance.</span></span> <span data-ttu-id="8c804-133">对于某一给定可用性组，一个 FCI 伙伴只能承载一个副本。</span><span class="sxs-lookup"><span data-stu-id="8c804-133">Only one FCI partner can host a replica for a given availability group.</span></span> <span data-ttu-id="8c804-134">当某一可用性副本正在一个 FCI 上运行时，可用性组的可能所有者列表将只包含活动的 FCI 节点。</span><span class="sxs-lookup"><span data-stu-id="8c804-134">When an availability replica is running on an FCI, the possible owners list for the availability group will contain only the active FCI node.</span></span>  
  
 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] <span data-ttu-id="8c804-135">不依赖于任何共享存储形式。</span><span class="sxs-lookup"><span data-stu-id="8c804-135">does not depend on any form of shared storage.</span></span> <span data-ttu-id="8c804-136">但是，如果使用 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 故障转移群集实例 (FCI) 来承载一个或多个可用性副本，每个 FCI 将需要标准 SQL Server 故障转移群集实例安装所要求的共享存储。</span><span class="sxs-lookup"><span data-stu-id="8c804-136">However, if you use a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover cluster instance (FCI) to host one or more availability replicas, each of those FCIs will require shared storage as per standard SQL Server failover cluster instance installation.</span></span>  
  
 <span data-ttu-id="8c804-137">有关其它先决条件的详细信息，请参阅[针对 AlwaysOn 可用性组的先决条件、限制和建议 (SQL Server)](prereqs-restrictions-recommendations-always-on-availability.md) 的“使用 SQL Server 故障转移群集实例 (FCI) 承载可用性副本的先决条件和限制”部分。</span><span class="sxs-lookup"><span data-stu-id="8c804-137">For more information about additional prerequisites, see the "Prerequisites and Restrictions for Using a SQL Server Failover Cluster Instance (FCI) to Host an Availability Replica" section of [Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md).</span></span>  
  
### <a name="comparison-of-failover-cluster-instances-and-availability-groups"></a><span data-ttu-id="8c804-138">比较故障转移群集实例和可用性组</span><span class="sxs-lookup"><span data-stu-id="8c804-138">Comparison of Failover Cluster Instances and Availability Groups</span></span>  
 <span data-ttu-id="8c804-139">无论 FCI 中的节点数是多少，整个 FCI 都只承载可用性组内的一个副本。</span><span class="sxs-lookup"><span data-stu-id="8c804-139">Regardless of the number of nodes in the FCI, an entire FCI hosts a single replica within an availability group.</span></span> <span data-ttu-id="8c804-140">下表说明 FCI 中的节点和可用性组内的副本的概念区别。</span><span class="sxs-lookup"><span data-stu-id="8c804-140">The following table describes the distinctions in concepts between nodes in an FCI and replicas within an availability group.</span></span>  
  
||<span data-ttu-id="8c804-141">FCI 内的节点</span><span class="sxs-lookup"><span data-stu-id="8c804-141">Nodes within an FCI</span></span>|<span data-ttu-id="8c804-142">可用性组内的副本</span><span class="sxs-lookup"><span data-stu-id="8c804-142">Replicas within an availability group</span></span>|  
|-|-------------------------|-------------------------------------------|  
|<span data-ttu-id="8c804-143">**使用 WSFC 群集**</span><span class="sxs-lookup"><span data-stu-id="8c804-143">**Uses WSFC cluster**</span></span>|<span data-ttu-id="8c804-144">是</span><span class="sxs-lookup"><span data-stu-id="8c804-144">Yes</span></span>|<span data-ttu-id="8c804-145">是</span><span class="sxs-lookup"><span data-stu-id="8c804-145">Yes</span></span>|  
|<span data-ttu-id="8c804-146">**保护级别**</span><span class="sxs-lookup"><span data-stu-id="8c804-146">**Protection level**</span></span>|<span data-ttu-id="8c804-147">实例</span><span class="sxs-lookup"><span data-stu-id="8c804-147">Instance</span></span>|<span data-ttu-id="8c804-148">数据库</span><span class="sxs-lookup"><span data-stu-id="8c804-148">Database</span></span>|  
|<span data-ttu-id="8c804-149">**存储类型**</span><span class="sxs-lookup"><span data-stu-id="8c804-149">**Storage type**</span></span>|<span data-ttu-id="8c804-150">共享</span><span class="sxs-lookup"><span data-stu-id="8c804-150">Shared</span></span>|<span data-ttu-id="8c804-151">非共享</span><span class="sxs-lookup"><span data-stu-id="8c804-151">Non-shared</span></span><br /><br /> <span data-ttu-id="8c804-152">请注意，尽管可用性组中的副本不共享存储，但是，由 FCI 承载的副本将使用该 FCI 所要求的共享存储解决方案。</span><span class="sxs-lookup"><span data-stu-id="8c804-152">Note that while the replicas in an availability group do not share storage, a replica that is hosted by an FCI uses a shared storage solution as required by that FCI.</span></span> <span data-ttu-id="8c804-153">该存储解决方案仅由 FCI 内的节点共享，不在可用性组的副本之间共享。</span><span class="sxs-lookup"><span data-stu-id="8c804-153">The storage solution is shared only by nodes within the FCI and not between replicas of the availability group.</span></span>|  
|<span data-ttu-id="8c804-154">**存储解决方案**</span><span class="sxs-lookup"><span data-stu-id="8c804-154">**Storage solutions**</span></span>|<span data-ttu-id="8c804-155">直连、SAN、装入点、SMB</span><span class="sxs-lookup"><span data-stu-id="8c804-155">Direct attached, SAN, mount points, SMB</span></span>|<span data-ttu-id="8c804-156">取决于节点类型</span><span class="sxs-lookup"><span data-stu-id="8c804-156">Depends on node type</span></span>|  
|<span data-ttu-id="8c804-157">**可读次要副本**</span><span class="sxs-lookup"><span data-stu-id="8c804-157">**Readable secondaries**</span></span>|<span data-ttu-id="8c804-158">否\*</span><span class="sxs-lookup"><span data-stu-id="8c804-158">No\*</span></span>|<span data-ttu-id="8c804-159">是</span><span class="sxs-lookup"><span data-stu-id="8c804-159">Yes</span></span>|  
|<span data-ttu-id="8c804-160">**适用的故障转移策略设置**</span><span class="sxs-lookup"><span data-stu-id="8c804-160">**Applicable failover policy settings**</span></span>|<span data-ttu-id="8c804-161">WSFC 仲裁</span><span class="sxs-lookup"><span data-stu-id="8c804-161">WSFC quorum</span></span><br /><br /> <span data-ttu-id="8c804-162">FCI 特有的</span><span class="sxs-lookup"><span data-stu-id="8c804-162">FCI-specific</span></span><br /><br /> <span data-ttu-id="8c804-163">可用性组设置\*\*</span><span class="sxs-lookup"><span data-stu-id="8c804-163">Availability group settings\*\*</span></span>|<span data-ttu-id="8c804-164">WSFC 仲裁</span><span class="sxs-lookup"><span data-stu-id="8c804-164">WSFC quorum</span></span><br /><br /> <span data-ttu-id="8c804-165">可用性组设置</span><span class="sxs-lookup"><span data-stu-id="8c804-165">Availability group settings</span></span>|  
|<span data-ttu-id="8c804-166">**故障转移资源**</span><span class="sxs-lookup"><span data-stu-id="8c804-166">**Failed-over resources**</span></span>|<span data-ttu-id="8c804-167">服务器、实例和数据库</span><span class="sxs-lookup"><span data-stu-id="8c804-167">Server, instance, and database</span></span>|<span data-ttu-id="8c804-168">仅数据库</span><span class="sxs-lookup"><span data-stu-id="8c804-168">Database only</span></span>|  
  
 <span data-ttu-id="8c804-169">\*尽管可用性组中的同步次要副本始终在相应的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例上运行，但 FCI 内的辅助节点实际未启动相应的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例，因此不可读。</span><span class="sxs-lookup"><span data-stu-id="8c804-169">\*Whereas synchronous secondary replicas in an availability group are always running on their respective [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instances, secondary nodes in an FCI actually have not started their respective [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instances and are therefore not readable.</span></span> <span data-ttu-id="8c804-170">在 FCI 中，仅在 FCI 故障转移期间资源组所有权转移给辅助节点时，辅助节点才启动其 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例。</span><span class="sxs-lookup"><span data-stu-id="8c804-170">In an FCI, a secondary node starts its [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance only when the resource group ownership is transferred to it during an FCI failover.</span></span> <span data-ttu-id="8c804-171">但是，在活动 FCI 节点上，当 FCI 承载的数据库属于可用性组时，如果本地可用性副本正在作为可读辅助副本运行，则数据库是可读的。</span><span class="sxs-lookup"><span data-stu-id="8c804-171">However, on the active FCI node, when an FCI-hosted database belongs to an availability group, if the local availability replica is running as a readable secondary replica, the database is readable.</span></span>  
  
 <span data-ttu-id="8c804-172">\*\*可用性组的故障转移策略设置应用于所有副本，无论它位于独立实例还是 FCI 实例中。</span><span class="sxs-lookup"><span data-stu-id="8c804-172">\*\*Failover policy settings for the availability group apply to all replicas, whether it is hosted in a standalone instance or an FCI instance.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="8c804-173">有关不同版本的故障转移群集中**的节点数**和**AlwaysOn 可用性组**的详细信息 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] ，请参阅[SQL Server 2012 (各个版本支持](https://go.microsoft.com/fwlink/?linkid=232473)的功能 https://go.microsoft.com/fwlink/?linkid=232473) 。</span><span class="sxs-lookup"><span data-stu-id="8c804-173">For more information about **Number of nodes** within Failover Clustering and **AlwaysOn Availability Groups** for different editions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], see [Features Supported by the Editions of SQL Server 2012](https://go.microsoft.com/fwlink/?linkid=232473) (https://go.microsoft.com/fwlink/?linkid=232473).</span></span>  
  
### <a name="considerations-for-hosting-an-availability-replica-on-an-fci"></a><span data-ttu-id="8c804-174">FCI 上承载可用性副本的注意事项</span><span class="sxs-lookup"><span data-stu-id="8c804-174">Considerations for hosting an Availability Replica on an FCI</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="8c804-175">如果计划在 SQL Server 故障转移群集实例 (FCI) 上承载可用性副本，请确保 Windows Server 2008 主机节点满足故障转移群集实例 (FCI) 的 AlwaysOn 先决条件和限制。</span><span class="sxs-lookup"><span data-stu-id="8c804-175">If you plan to host an availability replica on a SQL Server Failover Cluster Instance (FCI), ensure that the Windows Server 2008 host nodes meet the AlwaysOn prerequisites and restrictions for Failover Cluster Instances (FCIs).</span></span> <span data-ttu-id="8c804-176">有关详细信息，请参阅[针对 AlwaysOn 可用性组的先决条件、限制和建议 (SQL Server)](prereqs-restrictions-recommendations-always-on-availability.md)。</span><span class="sxs-lookup"><span data-stu-id="8c804-176">For more information, see [Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md).</span></span>  
  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="8c804-177">故障转移群集实例 (FCI) 不支持通过可用性组来自动进行故障转移，因此只能为手动故障转移配置任何由 FCI 承载的可用性副本。</span><span class="sxs-lookup"><span data-stu-id="8c804-177">Failover Cluster Instances (FCIs) do not support automatic failover by availability groups, so any availability replica that is hosted by an FCI can only be configured for manual failover.</span></span>  
  
 <span data-ttu-id="8c804-178">您可能需要配置 Windows Server 故障转移群集 (WSFC) 群集以包含所有节点上不可用的共享磁盘。</span><span class="sxs-lookup"><span data-stu-id="8c804-178">You might need to configure a Windows Server Failover Clustering (WSFC) cluster to include shared disks that are not available on all nodes.</span></span> <span data-ttu-id="8c804-179">例如，考虑一个跨两个数据中心、包含三个节点的 WSFC 群集。</span><span class="sxs-lookup"><span data-stu-id="8c804-179">For example, consider a WSFC cluster across two data centers with three nodes.</span></span> <span data-ttu-id="8c804-180">其中的两个节点在主数据中心中承载 SQL Server 故障转移群集实例 (FCI)，并且有权访问相同的共享磁盘。</span><span class="sxs-lookup"><span data-stu-id="8c804-180">Two of the nodes host a SQL Server failover clustering instance (FCI) in the primary data center and have access to the same shared disks.</span></span> <span data-ttu-id="8c804-181">第三个节点在另一个数据中心中承载独立 SQL Server 实例，并且无权访问主数据中心的共享磁盘。</span><span class="sxs-lookup"><span data-stu-id="8c804-181">The third node hosts a stand-alone instance of SQL Server in a different data center and does not have access to the shared disks from the primary data center.</span></span> <span data-ttu-id="8c804-182">如果 FCI 承载主副本且独立实例承载辅助副本，则此 WSFC 群集配置支持部署可用性组。</span><span class="sxs-lookup"><span data-stu-id="8c804-182">This WSFC cluster configuration supports the deployment of an availability group if the FCI hosts the primary replica and the stand-alone instance hosts the secondary replica.</span></span>  
  
 <span data-ttu-id="8c804-183">选择 FCI 承载给定可用性组的可用性副本时，请确保 FCI 故障转移不会导致单个 WSFC 节点尝试承载同一可用性组的两个可用性副本。</span><span class="sxs-lookup"><span data-stu-id="8c804-183">When choosing an FCI to host an availability replica for a given availability group, ensure that an FCI failover could not potentially cause a single WSFC node to attempt to host two availability replicas for the same availability group.</span></span>  
  
 <span data-ttu-id="8c804-184">下面的示例方案说明此配置是如何导致问题的：</span><span class="sxs-lookup"><span data-stu-id="8c804-184">The following example scenario illustrates how this configuration could lead to problems:</span></span>  
  
 <span data-ttu-id="8c804-185">Marcel 配置具有两个节点 `NODE01` 和 `NODE02`的一个 WSFC 群集。</span><span class="sxs-lookup"><span data-stu-id="8c804-185">Marcel configures two a WSFC cluster with two nodes, `NODE01` and `NODE02`.</span></span> <span data-ttu-id="8c804-186">他在 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 和 `fciInstance1`上安装一个 `NODE01` 故障转移群集实例 `NODE02` ，其中 `NODE01` 是 `fciInstance1`的当前所有者。</span><span class="sxs-lookup"><span data-stu-id="8c804-186">He installs a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover cluster instance, `fciInstance1`, on both `NODE01` and `NODE02` where `NODE01` is the current owner for `fciInstance1`.</span></span>  
 <span data-ttu-id="8c804-187">在 `NODE02`上，Marcel 安装了另一个 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]实例 `Instance3`，该实例是一个独立实例。</span><span class="sxs-lookup"><span data-stu-id="8c804-187">On `NODE02`, Marcel installs another instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], `Instance3`, which is a stand-alone instance.</span></span>  
 <span data-ttu-id="8c804-188">在 `NODE01`上，Marcel 为 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]启用了 fciInstance1。</span><span class="sxs-lookup"><span data-stu-id="8c804-188">On `NODE01`, Marcel enables fciInstance1 for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="8c804-189">在 `NODE02`上，他为 `Instance3` 启用了 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="8c804-189">On `NODE02`, he enables `Instance3` for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="8c804-190">然后，他设置了一个可用性组，其中 `fciInstance1` 承载主副本， `Instance3` 承载辅助副本。</span><span class="sxs-lookup"><span data-stu-id="8c804-190">Then he sets up an availability group for which `fciInstance1` hosts the primary replica, and `Instance3` hosts the secondary replica.</span></span>  
 <span data-ttu-id="8c804-191">在某些时候， `fciInstance1` 在 `NODE01`上将变得不可用，并且 WSFC 群集导致 `fciInstance1` 故障转移到 `NODE02`。</span><span class="sxs-lookup"><span data-stu-id="8c804-191">At some point `fciInstance1` becomes unavailable on `NODE01`, and the WSFC cluster causes a failover of `fciInstance1` to `NODE02`.</span></span> <span data-ttu-id="8c804-192">在故障转移后， `fciInstance1` 将是启用了 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]的实例并且在 `NODE02`上以主角色运行。</span><span class="sxs-lookup"><span data-stu-id="8c804-192">After the failover, `fciInstance1` is a [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]-enabled instance running under the primary role on `NODE02`.</span></span> <span data-ttu-id="8c804-193">但是， `Instance3` 现在驻留在与 `fciInstance1`相同的 WSFC 节点上。</span><span class="sxs-lookup"><span data-stu-id="8c804-193">However, `Instance3` now resides on the same WSFC node as `fciInstance1`.</span></span> <span data-ttu-id="8c804-194">这违反了 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 约束。</span><span class="sxs-lookup"><span data-stu-id="8c804-194">This violates the [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] constraint.</span></span>  
 <span data-ttu-id="8c804-195">为了纠正此应用场景产生的问题，独立实例 `Instance3`必须驻留在与 `NODE01` 和 `NODE02`处于相同 WSFC 群集中的另一个节点上。</span><span class="sxs-lookup"><span data-stu-id="8c804-195">To correct the problem that this scenario presents, the stand-alone instance, `Instance3`, must reside on another node in the same WSFC cluster as `NODE01` and `NODE02`.</span></span>  
  
 <span data-ttu-id="8c804-196">有关 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 故障转移群集的详细信息，请参阅 [AlwaysOn 故障转移群集实例 (SQL Server)](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="8c804-196">For more information about [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover clustering, see [AlwaysOn Failover Cluster Instances &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md).</span></span>  
  
##  <a name="restrictions-on-using-the-wsfc-failover-cluster-manager-with-availability-groups"></a><a name="FCMrestrictions"></a><span data-ttu-id="8c804-197">在可用性组中使用 WSFC 故障转移群集管理器的限制</span><span class="sxs-lookup"><span data-stu-id="8c804-197">Restrictions on Using The WSFC Failover Cluster Manager with Availability Groups</span></span>  
 <span data-ttu-id="8c804-198">不要使用故障转移群集管理器来操作可用性组，例如：</span><span class="sxs-lookup"><span data-stu-id="8c804-198">Do not use the Failover Cluster Manager to manipulate availability groups, for example:</span></span>  
  
-   <span data-ttu-id="8c804-199">不要在可用性组的群集服务（资源组）中添加或删除资源。</span><span class="sxs-lookup"><span data-stu-id="8c804-199">Do not add or remove resources in the clustered service (resource group) for the availability group.</span></span>  
  
-   <span data-ttu-id="8c804-200">不要更改任何可用性组属性，例如可能的所有者和首选所有者。</span><span class="sxs-lookup"><span data-stu-id="8c804-200">Do not change any availability group properties, such as the possible owners and preferred owners.</span></span> <span data-ttu-id="8c804-201">这些属性由可用性组自动设置。</span><span class="sxs-lookup"><span data-stu-id="8c804-201">These properties are set automatically by the availability group.</span></span>  
  
-   <span data-ttu-id="8c804-202">不要使用故障转移群集管理器将可用性组移到不同节点或者故障转移可用性组。</span><span class="sxs-lookup"><span data-stu-id="8c804-202">Do not use the Failover Cluster Manager to move availability groups to different nodes or to fail over availability groups.</span></span> <span data-ttu-id="8c804-203">故障转移群集管理器不知道可用性副本的同步状态，因此，这样做可能会导致延长停机时间。</span><span class="sxs-lookup"><span data-stu-id="8c804-203">The Failover Cluster Manager is not aware of the synchronization status of the availability replicas, and doing so can lead to extended downtime.</span></span> <span data-ttu-id="8c804-204">必须使用 [!INCLUDE[tsql](../../../includes/tsql-md.md)] 或 [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="8c804-204">You must use [!INCLUDE[tsql](../../../includes/tsql-md.md)] or [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)].</span></span>  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="8c804-205">相关内容</span><span class="sxs-lookup"><span data-stu-id="8c804-205">Related Content</span></span>  
  
-   <span data-ttu-id="8c804-206">**博客：**</span><span class="sxs-lookup"><span data-stu-id="8c804-206">**Blogs:**</span></span>  
  
     [<span data-ttu-id="8c804-207">将 SQL Server 的 Windows 故障转移群集（可用性组或 FCI）配置为有限安全</span><span class="sxs-lookup"><span data-stu-id="8c804-207">Configure Windows Failover Clustering for SQL Server (Availability Group or FCI) with Limited Security</span></span>](https://blogs.msdn.com/b/sqlalwayson/archive/2012/06/05/configure-windows-failover-clustering-for-sql-server-availability-group-or-fci-with-limited-security.aspx)  
  
     [<span data-ttu-id="8c804-208">SQL Server AlwaysOn 团队博客：SQL Server AlwaysOn 官方团队博客</span><span class="sxs-lookup"><span data-stu-id="8c804-208">SQL Server AlwaysOn Team Blogs: The official SQL Server AlwaysOn Team Blog</span></span>](https://blogs.msdn.com/b/sqlalwayson/)  
  
     [<span data-ttu-id="8c804-209">CSS SQL Server 工程师博客</span><span class="sxs-lookup"><span data-stu-id="8c804-209">CSS SQL Server Engineers Blogs</span></span>](https://blogs.msdn.com/b/psssql/)  
  
-   <span data-ttu-id="8c804-210">**白皮书：**</span><span class="sxs-lookup"><span data-stu-id="8c804-210">**Whitepapers:**</span></span>  
  
     [<span data-ttu-id="8c804-211">AlwaysOn 体系结构指南：使用故障转移群集实例和可用性组绑定高可用性和灾难恢复解决方案</span><span class="sxs-lookup"><span data-stu-id="8c804-211">AlwaysOn Architecture Guide: Building a High Availability and Disaster Recovery Solution by Using Failover Cluster Instances and Availability Groups</span></span>](https://msdn.microsoft.com/library/jj215886.aspx)  
  
     [<span data-ttu-id="8c804-212">用于高可用性和灾难恢复的 Microsoft SQL Server AlwaysOn 解决方案指南</span><span class="sxs-lookup"><span data-stu-id="8c804-212">Microsoft SQL Server AlwaysOn Solutions Guide for High Availability and Disaster Recovery</span></span>](https://go.microsoft.com/fwlink/?LinkId=227600)  
  
     [<span data-ttu-id="8c804-213">针对 SQL Server 2012 的 Microsoft 白皮书</span><span class="sxs-lookup"><span data-stu-id="8c804-213">Microsoft White Papers for SQL Server 2012</span></span>](https://msdn.microsoft.com/library/hh403491.aspx)  
  
     [<span data-ttu-id="8c804-214">SQL Server 客户咨询团队白皮书</span><span class="sxs-lookup"><span data-stu-id="8c804-214">SQL Server Customer Advisory Team Whitepapers</span></span>](http://sqlcat.com/)  
  
## <a name="see-also"></a><span data-ttu-id="8c804-215">另请参阅</span><span class="sxs-lookup"><span data-stu-id="8c804-215">See Also</span></span>  
 <span data-ttu-id="8c804-216">[AlwaysOn 可用性组 &#40;SQL Server 概述&#41;](overview-of-always-on-availability-groups-sql-server.md) [启用和禁用 AlwaysOn 可用性组](enable-and-disable-always-on-availability-groups-sql-server.md)&#40;SQL Server&#41;&#40;[监视可用性组&#41;transact-sql](monitor-availability-groups-transact-sql.md)</span><span class="sxs-lookup"><span data-stu-id="8c804-216">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) [Enable and Disable AlwaysOn Availability Groups &#40;SQL Server&#41;](enable-and-disable-always-on-availability-groups-sql-server.md) [Monitor Availability Groups &#40;Transact-SQL&#41;](monitor-availability-groups-transact-sql.md)</span></span>  
 [<span data-ttu-id="8c804-217">AlwaysOn 故障转移群集实例 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="8c804-217">AlwaysOn Failover Cluster Instances &#40;SQL Server&#41;</span></span>](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md) 
  
  
