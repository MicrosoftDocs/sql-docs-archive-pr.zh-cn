---
title: Reporting Services，AlwaysOn 可用性组 (SQL Server) |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- Reporting Services, AlwaysOn Availability Groups
- Availability Groups [SQL Server], interoperability
ms.assetid: edeb5c75-fb13-467e-873a-ab3aad88ab72
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: dcaafcf3cac177ccad4a4b7712bda04a1fc932a8
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87693109"
---
# <a name="reporting-services-with-alwayson-availability-groups-sql-server"></a><span data-ttu-id="421f1-102">Reporting Services 与 AlwaysOn 可用性组 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="421f1-102">Reporting Services with AlwaysOn Availability Groups (SQL Server)</span></span>
  <span data-ttu-id="421f1-103">本主题包含有关配置 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 以便用于 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 中的 [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)](AG) 的信息。</span><span class="sxs-lookup"><span data-stu-id="421f1-103">This topic contains information about configuring [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] to work with [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] (AG) in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="421f1-104">使用 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 和 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 的三种方案为用于报表数据源的数据库、报表服务器数据库和报表设计。</span><span class="sxs-lookup"><span data-stu-id="421f1-104">The three scenarios for using [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] and [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] are databases for report data sources, report server databases, and report design.</span></span> <span data-ttu-id="421f1-105">这三种方案支持的功能和所需的配置各不相同。</span><span class="sxs-lookup"><span data-stu-id="421f1-105">The supported functionality and required configuration is different for the three scenarios.</span></span>

 <span data-ttu-id="421f1-106">将 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 用于 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 数据源的一个重要好处是利用可读的辅助副本作为报表数据源，同时辅助副本为主数据库提供故障转移功能。</span><span class="sxs-lookup"><span data-stu-id="421f1-106">A key benefit of using [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] with [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] data sources is to leverage readable secondary replicas as a reporting data source while, at the same time the secondary replicas are providing a failover for a primary database.</span></span>

 <span data-ttu-id="421f1-107">有关的常规信息 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] ，请参阅[ https://msdn.microsoft.com/sqlserver/gg508768) SQL Server 2012 (的 AlwaysOn 常见问题解答](https://msdn.microsoft.com/sqlserver/gg508768)。</span><span class="sxs-lookup"><span data-stu-id="421f1-107">For general information on [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], see [AlwaysOn FAQ for SQL Server 2012 (https://msdn.microsoft.com/sqlserver/gg508768)](https://msdn.microsoft.com/sqlserver/gg508768).</span></span>

 

##  <a name="requirements-for-using-reporting-services-and-alwayson-availability-groups"></a><a name="bkmk_requirements"></a><span data-ttu-id="421f1-108">使用 Reporting Services 和 AlwaysOn 可用性组的要求</span><span class="sxs-lookup"><span data-stu-id="421f1-108">Requirements for using Reporting Services and AlwaysOn Availability Groups</span></span>
 <span data-ttu-id="421f1-109">若要将用于 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] ，需要下载并安装用于 .net 3.5 SP1 的修补程序。</span><span class="sxs-lookup"><span data-stu-id="421f1-109">To use [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] with [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)], you need to download and install a hotfix for .Net 3.5 SP1.</span></span> <span data-ttu-id="421f1-110">该修补程序添加对 SQL Client for AG 功能的支持以及对连接字符串属性 **ApplicationIntent** 和 **MultiSubnetFailover**的支持。</span><span class="sxs-lookup"><span data-stu-id="421f1-110">The hotfix adds support to SQL Client for AG features and support of the connection string properties **ApplicationIntent** and **MultiSubnetFailover**.</span></span> <span data-ttu-id="421f1-111">如果未在承载报表服务器的每台计算机上安装该修补程序，尝试预览报表的用户将看到类似以下内容的错误消息并将错误消息写入报表服务器跟踪日志：</span><span class="sxs-lookup"><span data-stu-id="421f1-111">If the Hotfix is not installed on each computer that hosts a report server, then users attempting to preview reports will see an error message similar to the following, and the error message will be written to the report server trace log:</span></span>

> <span data-ttu-id="421f1-112">**错误消息：** “关键字不受支持的 "applicationintent"”</span><span class="sxs-lookup"><span data-stu-id="421f1-112">**Error message:** "Keyword not supported 'applicationintent'"</span></span>

 <span data-ttu-id="421f1-113">当在 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 连接字符串中包含一个 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 属性但是服务器无法识别该属性时，显示此消息。</span><span class="sxs-lookup"><span data-stu-id="421f1-113">The message occurs when you include one of the [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] properties in the [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] connection string, but the server does not recognize the property.</span></span> <span data-ttu-id="421f1-114">在 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 用户界面中单击“测试连接”按钮以及预览报表（如果在报表服务器上启用远程错误）时，将显示所述的错误消息。</span><span class="sxs-lookup"><span data-stu-id="421f1-114">The noted error message will be seen when you click the 'Test Connection' button in [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] user interfaces and when you preview the report if remote errors are enabled on the report servers.</span></span>

 <span data-ttu-id="421f1-115">有关所需修补程序的详细信息，请参阅 [KB 2654347A 修补程序将 SQL Server 2012 中对 AlwaysOn 功能的支持引入 .NET Framework 3.5 SP1](https://go.microsoft.com/fwlink/?LinkId=242896)。</span><span class="sxs-lookup"><span data-stu-id="421f1-115">For more information on the required hotfix, see [KB 2654347A hotfix introduces support for the AlwaysOn features from SQL Server 2012 to the .NET Framework 3.5 SP1](https://go.microsoft.com/fwlink/?LinkId=242896).</span></span>

 <span data-ttu-id="421f1-116">有关其他 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 要求的信息，请参阅[针对 AlwaysOn 可用性组的先决条件、限制和建议 (SQL Server)](prereqs-restrictions-recommendations-always-on-availability.md)。</span><span class="sxs-lookup"><span data-stu-id="421f1-116">For information on other [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] requirements, see [Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md).</span></span>

> [!NOTE]
>  [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] <span data-ttu-id="421f1-117">配置文件（如 RSreportserver.config），它们不包括在 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 功能中。</span><span class="sxs-lookup"><span data-stu-id="421f1-117">configuration files such as **RSreportserver.config** are not supported as part of [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] functionality.</span></span> <span data-ttu-id="421f1-118">如果手动更改某一报表服务器上的配置文件，将需要手动更新副本。</span><span class="sxs-lookup"><span data-stu-id="421f1-118">If you manually make changes to a configuration file on one of the report servers, you will need to manually update the replicas.</span></span>

##  <a name="report-data-sources-and-availability-groups"></a><a name="bkmk_reportdatasources"></a> <span data-ttu-id="421f1-119">报表数据源和可用性组</span><span class="sxs-lookup"><span data-stu-id="421f1-119">Report Data Sources and Availability Groups</span></span>
 <span data-ttu-id="421f1-120">基于 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 的 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 数据源行为会根据管理员配置 AG 环境的方式不同而变化。</span><span class="sxs-lookup"><span data-stu-id="421f1-120">The behavior of [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] data sources based on [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] can vary depending on how your administrator has configured the AG environment.</span></span>

 <span data-ttu-id="421f1-121">要将 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 用于报表数据源，您需要配置报表数据源连接字符串以使用可用性组“侦听器 DNS 名称” 。</span><span class="sxs-lookup"><span data-stu-id="421f1-121">To utilize [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] for report data sources you need to configure the report data source connection string is to use the availability group *Listener DNS name*.</span></span> <span data-ttu-id="421f1-122">支持以下数据源：</span><span class="sxs-lookup"><span data-stu-id="421f1-122">Supported data sources are the following:</span></span>

-   <span data-ttu-id="421f1-123">使用 SQL Native Client 的 ODBC 数据源。</span><span class="sxs-lookup"><span data-stu-id="421f1-123">ODBC data source using SQL Native Client.</span></span>

-   <span data-ttu-id="421f1-124">SQL Client，已将 .Net 修补程序应用到报表服务器。</span><span class="sxs-lookup"><span data-stu-id="421f1-124">SQL Client, with the .Net hotfix applied to the report server.</span></span>

 <span data-ttu-id="421f1-125">连接字符串还可以包含新的 AlwaysOn 连接属性，这些属性配置报表查询请求以将辅助副本用于只读报表。</span><span class="sxs-lookup"><span data-stu-id="421f1-125">The connection string can also contain new AlwaysOn connection properties that configure the report query requests to use secondary replica for read-only reporting.</span></span> <span data-ttu-id="421f1-126">将辅助副本用于报表请求将减少读-写主副本上的负载。</span><span class="sxs-lookup"><span data-stu-id="421f1-126">Use of secondary replica for reporting requests will reduce the load on a read-write primary replica.</span></span> <span data-ttu-id="421f1-127">下图显示包含三个副本 AG 配置的示例，其中 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 数据源连接字符串已使用 ApplicationIntent=ReadOnly 配置。</span><span class="sxs-lookup"><span data-stu-id="421f1-127">The following illustration is an example of a three replica AG configuration where the [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] data source connection strings have been configured with ApplicationIntent=ReadOnly.</span></span> <span data-ttu-id="421f1-128">在此示例中，将报表查询请求发送到辅助副本而非主副本。</span><span class="sxs-lookup"><span data-stu-id="421f1-128">In this example the report query requests are sent to a secondary replica and not the primary replica.</span></span>

 <span data-ttu-id="421f1-129">![使用 AG 组的 SSRS 数据源](../../media/rs-alwayson-basic.gif "使用 AG 组的 SSRS 数据源")</span><span class="sxs-lookup"><span data-stu-id="421f1-129">![SSRS Datasource using AG groups](../../media/rs-alwayson-basic.gif "SSRS Datasource using AG groups")</span></span>

 <span data-ttu-id="421f1-130">以下是示例连接字符串，其中 [AvailabilityGroupListenerName] 为创建副本时配置的 **侦听器 DNS 名称** ：</span><span class="sxs-lookup"><span data-stu-id="421f1-130">The following is an example connection string, where the [AvailabilityGroupListenerName] is the **Listener DNS Name** that was configured when replicas were created:</span></span>

 `Data Source=[AvailabilityGroupListenerName];Initial Catalog = AdventureWorks2008R2; ApplicationIntent=ReadOnly`

 <span data-ttu-id="421f1-131">**用户界面中的** “测试连接” [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 按钮将验证是否可以建立连接，但是不验证 AG 配置。</span><span class="sxs-lookup"><span data-stu-id="421f1-131">The **Test Connection** button in [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] user interfaces will validate if a connection can be established but it will not validate AG configuration.</span></span> <span data-ttu-id="421f1-132">例如，如果将连接字符串中包含的 ApplicationIntent 指向不是 AG 一部分的服务器，将忽略此额外参数， **“测试连接”** 按钮将只验证是否可以建立到指定服务器的连接。</span><span class="sxs-lookup"><span data-stu-id="421f1-132">For example if you include ApplicationIntent in a connection string to a server that is not part of AG, the extra parameter is ignored and the **Test Connection** button will only validate a connection can be established to the specified server.</span></span>

 <span data-ttu-id="421f1-133">创建和发布报表的方式将决定您在何处编辑连接字符串：</span><span class="sxs-lookup"><span data-stu-id="421f1-133">Depending on how your reports are created and published will determine where you edit the connection string:</span></span>

-   <span data-ttu-id="421f1-134">**本机模式：** 对于共享数据源和已发布到本机模式报表服务器的报表，使用报表管理器。</span><span class="sxs-lookup"><span data-stu-id="421f1-134">**Native mode:** Use Report Manager for shared data sources and reports that are already published to a native mode report server.</span></span>

-   <span data-ttu-id="421f1-135">**SharePoint 模式：** 对于已发布到 SharePoint 服务器的报表，使用文档库内的 SharePoint 配置页。</span><span class="sxs-lookup"><span data-stu-id="421f1-135">**SharePoint Mode:** Use SharePoint configuration pages within the document libraries for reports that are already published to a SharePoint server.</span></span>

-   <span data-ttu-id="421f1-136">**报表设计：** 创建新报表时，请使用 [!INCLUDE[ssRBDenali](../../../includes/ssrbdenali-md.md)] 或 [!INCLUDE[ssBIDevStudioFull](../../../includes/ssbidevstudiofull-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="421f1-136">**Report Design:** [!INCLUDE[ssRBDenali](../../../includes/ssrbdenali-md.md)] or [!INCLUDE[ssBIDevStudioFull](../../../includes/ssbidevstudiofull-md.md)] when you are creating new reports.</span></span> <span data-ttu-id="421f1-137">有关详细信息，请参阅本主题中的“报表设计”部分。</span><span class="sxs-lookup"><span data-stu-id="421f1-137">See the 'Report Design' section in this topic or more information.</span></span>

 <span data-ttu-id="421f1-138">**其他资源：**</span><span class="sxs-lookup"><span data-stu-id="421f1-138">**Additional Resources:**</span></span>

-   [<span data-ttu-id="421f1-139">管理报表数据源</span><span class="sxs-lookup"><span data-stu-id="421f1-139">Manage Report Data Sources</span></span>](../../../reporting-services/report-data/manage-report-data-sources.md)

-   <span data-ttu-id="421f1-140">有关可用连接字符串属性的详细信息，请参阅 [Using Connection String Keywords with SQL Server Native Client](../../../relational-databases/native-client/applications/using-connection-string-keywords-with-sql-server-native-client.md)。</span><span class="sxs-lookup"><span data-stu-id="421f1-140">For more information on the available connection string properties, see [Using Connection String Keywords with SQL Server Native Client](../../../relational-databases/native-client/applications/using-connection-string-keywords-with-sql-server-native-client.md).</span></span>

-   <span data-ttu-id="421f1-141">有关可用性组侦听程序的详细信息，请参阅[创建或配置可用性组侦听程序 (SQL Server)](create-or-configure-an-availability-group-listener-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="421f1-141">For more information on availability group listeners, see [Create or Configure an Availability Group Listener &#40;SQL Server&#41;](create-or-configure-an-availability-group-listener-sql-server.md).</span></span>

 <span data-ttu-id="421f1-142">**注意事项：** 在从主要副本接收数据更改时，次要副本一般会有延迟。</span><span class="sxs-lookup"><span data-stu-id="421f1-142">**Considerations:** Secondary replicas will typically experience a delay in receiving data changes from the primary replica.</span></span> <span data-ttu-id="421f1-143">以下因素可能影响主副本和辅助副本之间的更新滞后时间：</span><span class="sxs-lookup"><span data-stu-id="421f1-143">The following factors can affect the update latency between the primary and secondary replicas:</span></span>

-   <span data-ttu-id="421f1-144">辅助副本数目。</span><span class="sxs-lookup"><span data-stu-id="421f1-144">The number of secondary replicas.</span></span> <span data-ttu-id="421f1-145">向配置中每增加一个辅助副本，延迟时间将增加。</span><span class="sxs-lookup"><span data-stu-id="421f1-145">The delay increases with each secondary replica added to the configuration.</span></span>

-   <span data-ttu-id="421f1-146">地理位置以及主副本和辅助副本之间的距离。</span><span class="sxs-lookup"><span data-stu-id="421f1-146">Geographic location and distance between the primary and secondary replicas.</span></span> <span data-ttu-id="421f1-147">例如，辅助副本位于单独的数据中心与它们位于与主副本相同的大楼中相比，前者的延迟时间通常更长。</span><span class="sxs-lookup"><span data-stu-id="421f1-147">For example the delay is typically larger if the secondary replicas are in a different data center than if they were in the same building as the primary replica.</span></span>

-   <span data-ttu-id="421f1-148">每个副本的可用性模式的配置。</span><span class="sxs-lookup"><span data-stu-id="421f1-148">Configuration of the availability mode for each replica.</span></span> <span data-ttu-id="421f1-149">可用性模式确定主副本是否在辅助副本将事务写入磁盘之前，等待提交数据库上的事务。</span><span class="sxs-lookup"><span data-stu-id="421f1-149">The availability mode determines whether the primary replica waits to commit transactions on a database until a secondary replica has written the transaction to disk.</span></span> <span data-ttu-id="421f1-150">有关详细信息，请参阅[AlwaysOn 可用性组 &#40;SQL Server 概述的](overview-of-always-on-availability-groups-sql-server.md)"可用性模式" 部分&#41;。</span><span class="sxs-lookup"><span data-stu-id="421f1-150">For more information, see the 'Availability Modes' section of [Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md).</span></span>

 <span data-ttu-id="421f1-151">将只读辅助副本作为 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 数据源时，确保数据更新滞后时间满足报表用户的要求很重要。</span><span class="sxs-lookup"><span data-stu-id="421f1-151">When using a read-only secondary as a [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] data source, it is important to ensure that data update latency meets the needs of the report users.</span></span>

##  <a name="report-design-and-availability-groups"></a><a name="bkmk_reportdesign"></a> <span data-ttu-id="421f1-152">报表设计和可用性组</span><span class="sxs-lookup"><span data-stu-id="421f1-152">Report Design and Availability Groups</span></span>
 <span data-ttu-id="421f1-153">在 [!INCLUDE[ssRBDenali](../../../includes/ssrbdenali-md.md)] 中设计报表或在 [!INCLUDE[ssBIDevStudioFull](../../../includes/ssbidevstudiofull-md.md)]中创建报表项目时，用户可以配置报表数据源连接字符串以包含 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]提供的新连接属性。</span><span class="sxs-lookup"><span data-stu-id="421f1-153">When designing reports in [!INCLUDE[ssRBDenali](../../../includes/ssrbdenali-md.md)] or a report project in [!INCLUDE[ssBIDevStudioFull](../../../includes/ssbidevstudiofull-md.md)], a user can configure a report data source connection string to contain new connection properties provided by [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="421f1-154">对连接属性的支持取决于用户在何处预览报表。</span><span class="sxs-lookup"><span data-stu-id="421f1-154">Support for the new connection properties depends on where a user previews the report.</span></span>

-   <span data-ttu-id="421f1-155">**本地预览：** [!INCLUDE[ssRBDenali](../../../includes/ssrbdenali-md.md)] 和 [!INCLUDE[ssBIDevStudioFull](../../../includes/ssbidevstudiofull-md.md)] 使用 .NET Framework 4.0，并支持 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 连接字符串属性。</span><span class="sxs-lookup"><span data-stu-id="421f1-155">**Local preview:** [!INCLUDE[ssRBDenali](../../../includes/ssrbdenali-md.md)] and [!INCLUDE[ssBIDevStudioFull](../../../includes/ssbidevstudiofull-md.md)] use the .Net framework 4.0 and support [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] connection string properties.</span></span>

-   <span data-ttu-id="421f1-156">**远程或服务器模式预览：** 在将报表发布到报表服务器后，或在 [!INCLUDE[ssRBDenali](../../../includes/ssrbdenali-md.md)] 中使用预览后，你看到与以下内容相似的错误，指出你正在对报表服务器预览报表，且报表服务器上尚未安装用于 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 的 .Net Framework 3.5 SP1 修补程序。</span><span class="sxs-lookup"><span data-stu-id="421f1-156">**Remote or server mode preview:** If after publishing reports to the report server or using preview in [!INCLUDE[ssRBDenali](../../../includes/ssrbdenali-md.md)], you see an error similar to the following, it is an indication you are previewing reports against the report server and the .Net Framework 3.5 SP1 Hotfix for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] has not been installed on the report server.</span></span>

> <span data-ttu-id="421f1-157">**错误消息：** “关键字不受支持的 "applicationintent"”</span><span class="sxs-lookup"><span data-stu-id="421f1-157">**Error message:** "Keyword not supported 'applicationintent'"</span></span>

##  <a name="report-server-databases-and-availability-groups"></a><a name="bkmk_reportserverdatabases"></a> <span data-ttu-id="421f1-158">报表服务器数据库和可用性组</span><span class="sxs-lookup"><span data-stu-id="421f1-158">Report Server Databases and Availability Groups</span></span>
 <span data-ttu-id="421f1-159">Reporting Services 为将 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 和报表服务器数据库结合使用提供了有限的支持。</span><span class="sxs-lookup"><span data-stu-id="421f1-159">Reporting Services offers limited support for using [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] with report server databases.</span></span> <span data-ttu-id="421f1-160">可以在 AG 中将报表服务器数据库配置为副本的一部分；但是 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 在发生故障转移时不会自动将另一副本用于报表服务器数据库。</span><span class="sxs-lookup"><span data-stu-id="421f1-160">The report server databases can be configured in AG to be part of a replica; however [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] will not automatically use a different replica for the report server databases when a failover occurs.</span></span>

 <span data-ttu-id="421f1-161">需要使用手动操作或自定义自动化脚本来完成故障转移和恢复。</span><span class="sxs-lookup"><span data-stu-id="421f1-161">Manual actions or custom automation scripts need to be used to complete the failover and recovery.</span></span> <span data-ttu-id="421f1-162">在完成这些操作前，在 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 故障转移后报表服务器的某些功能可能不能正常工作。</span><span class="sxs-lookup"><span data-stu-id="421f1-162">Until these actions are completed, some features of the report server may not work correctly after the [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] failover.</span></span>

> [!NOTE]
>  <span data-ttu-id="421f1-163">规划报表服务器数据库的故障转移和灾难恢复时，建议您始终备份报表服务器加密密钥的副本。</span><span class="sxs-lookup"><span data-stu-id="421f1-163">When planning failover and disaster recovery for the report server databases, it is advised you always backup a copy of the report server encryption key.</span></span>

###  <a name="differences-between-sharepoint-native-mode"></a><a name="bkmk_differences_in_server_mode"></a> <span data-ttu-id="421f1-164">SharePoint 模式和本机模式之间的区别</span><span class="sxs-lookup"><span data-stu-id="421f1-164">Differences between SharePoint Native Mode</span></span>
 <span data-ttu-id="421f1-165">本节总结了 SharePoint 模式和本机模式的报表服务器与 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]交互方式的区别。</span><span class="sxs-lookup"><span data-stu-id="421f1-165">This section summarizes the differences between how SharePoint mode and Native mode report servers interact with [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span>

 <span data-ttu-id="421f1-166">SharePoint 报表服务器将为您创建的每个 **服务应用程序创建** 3 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 个数据库。</span><span class="sxs-lookup"><span data-stu-id="421f1-166">A SharePoint report server creates **3** databases for each [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] service application you create.</span></span> <span data-ttu-id="421f1-167">创建服务应用程序时，SharePoint 模式下与报表服务器数据库的连接在 SharePoint 管理中心中配置。</span><span class="sxs-lookup"><span data-stu-id="421f1-167">The connection to the report server databases in SharePoint mode is configured in SharePoint Central Administration when you create the service application.</span></span> <span data-ttu-id="421f1-168">这些数据库的默认名称包含与服务应用程序相关联的 GUID。</span><span class="sxs-lookup"><span data-stu-id="421f1-168">The default names of the databases include a GUID that is associated with the service application.</span></span> <span data-ttu-id="421f1-169">以下是 SharePoint 模式报表服务器的示例数据库名称：</span><span class="sxs-lookup"><span data-stu-id="421f1-169">The following are example database names, for a SharePoint mode report server:</span></span>

-   <span data-ttu-id="421f1-170">ReportingService_85c08ac3c8e64d3cb400ad06ed5da5d6</span><span class="sxs-lookup"><span data-stu-id="421f1-170">ReportingService_85c08ac3c8e64d3cb400ad06ed5da5d6</span></span>

-   <span data-ttu-id="421f1-171">ReportingService_85c08ac3c8e64d3cb400ad06ed5da5d6TempDB</span><span class="sxs-lookup"><span data-stu-id="421f1-171">ReportingService_85c08ac3c8e64d3cb400ad06ed5da5d6TempDB</span></span>

-   <span data-ttu-id="421f1-172">ReportingService_85c08ac3c8e64d3cb400ad06ed5da5d6_Alerting</span><span class="sxs-lookup"><span data-stu-id="421f1-172">ReportingService_85c08ac3c8e64d3cb400ad06ed5da5d6_Alerting</span></span>

 <span data-ttu-id="421f1-173">本机模式报表服务器使用 **2** 个数据库。</span><span class="sxs-lookup"><span data-stu-id="421f1-173">Native mode report servers use **2** databases.</span></span> <span data-ttu-id="421f1-174">以下是本机模式报表服务器的示例数据库名称：</span><span class="sxs-lookup"><span data-stu-id="421f1-174">The following are example database names, for a native mode report server:</span></span>

-   <span data-ttu-id="421f1-175">ReportServer</span><span class="sxs-lookup"><span data-stu-id="421f1-175">ReportServer</span></span>

-   <span data-ttu-id="421f1-176">ReportServerTempDB</span><span class="sxs-lookup"><span data-stu-id="421f1-176">ReportServerTempDB</span></span>

 <span data-ttu-id="421f1-177">本机模式不支持或使用警报数据库以及相关功能。</span><span class="sxs-lookup"><span data-stu-id="421f1-177">Native mode does not support or use the Alerting databases and related features.</span></span> <span data-ttu-id="421f1-178">在 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 配置管理器中配置本机模式的报表服务器。</span><span class="sxs-lookup"><span data-stu-id="421f1-178">You configure native mode report servers in the [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] Configuration Manager.</span></span> <span data-ttu-id="421f1-179">对于 SharePoint 模式，将服务应用程序数据库名称配置为作为 SharePoint 配置一部分创建的 "客户端访问点" 的名称。</span><span class="sxs-lookup"><span data-stu-id="421f1-179">For SharePoint mode you configure the service application database name to be the name of the "client access point" you created as part of the SharePoint configuration.</span></span> <span data-ttu-id="421f1-180">有关将 SharePoint 配置用于 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 的详细信息，请参阅[为 SharePoint 服务器配置和管理 SQL Server 可用性组 (](https://go.microsoft.com/fwlink/?LinkId=245165)https://go.microsoft.com/fwlink/?LinkId=245165) 。</span><span class="sxs-lookup"><span data-stu-id="421f1-180">For more information on configuring SharePoint with [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], see [Configure and manage SQL Server availability groups for SharePoint Server (https://go.microsoft.com/fwlink/?LinkId=245165)](https://go.microsoft.com/fwlink/?LinkId=245165).</span></span>

> [!NOTE]
>  <span data-ttu-id="421f1-181">SharePoint 模式的报表服务器使用 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 服务应用程序数据库和 SharePoint 内容数据库之间的同步过程。</span><span class="sxs-lookup"><span data-stu-id="421f1-181">SharePoint mode report servers use a synchronization process between the [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] service application databases and the SharePoint content databases.</span></span> <span data-ttu-id="421f1-182">将报表服务器数据库和内容数据库一起维护很重要。</span><span class="sxs-lookup"><span data-stu-id="421f1-182">It is important to maintain the report server databases and content databases together.</span></span> <span data-ttu-id="421f1-183">您应考虑在同一可用性组中配置它们以便它们作为一个整体进行故障转移和恢复。</span><span class="sxs-lookup"><span data-stu-id="421f1-183">You should consider configuring them in the same availability groups so they failover and recover as a set.</span></span> <span data-ttu-id="421f1-184">请考虑下列方案：</span><span class="sxs-lookup"><span data-stu-id="421f1-184">Consider the following scenario:</span></span>
> 
>  -   <span data-ttu-id="421f1-185">您还原或故障转移到一个内容数据库副本，该数据库未收到与报表服务器数据库所收到内容相同的最近更新。</span><span class="sxs-lookup"><span data-stu-id="421f1-185">You restore or failover to a copy of the content database that has not received the same recent updates that the report server database has received.</span></span>
> -   <span data-ttu-id="421f1-186">[!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 同步过程将检测内容数据库中项列表与报表服务器数据库中项列表的差异。</span><span class="sxs-lookup"><span data-stu-id="421f1-186">The [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] synchronization process will detect differences between the list of items in the content database and the report server databases.</span></span>
> -   <span data-ttu-id="421f1-187">同步过程将删除或更新内容数据库中的项。</span><span class="sxs-lookup"><span data-stu-id="421f1-187">The synchronization process will delete or update items in the content database.</span></span>

###  <a name="prepare-report-server-databases-for-availability-groups"></a><a name="bkmk_prepare_databases"></a> <span data-ttu-id="421f1-188">为可用性组准备报表服务器数据库</span><span class="sxs-lookup"><span data-stu-id="421f1-188">Prepare Report Server Databases for Availability Groups</span></span>
 <span data-ttu-id="421f1-189">以下是用于准备并将报表服务器数据库添加到 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]的基本步骤：</span><span class="sxs-lookup"><span data-stu-id="421f1-189">The following are the basic steps of preparing and adding the report server databases to an [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]:</span></span>

-   <span data-ttu-id="421f1-190">创建可用性组并配置“侦听器 DNS 名称” 。</span><span class="sxs-lookup"><span data-stu-id="421f1-190">Create your Availability Group and configure a *Listener DNS name*.</span></span>

-   <span data-ttu-id="421f1-191">**主要副本：** 将报表服务器数据库配置为单个可用性组的一部分，并创建包含所有报表服务器数据库的主要副本。</span><span class="sxs-lookup"><span data-stu-id="421f1-191">**Primary Replica:** Configure the report server databases to be part of a single availability group and create a primary replica that includes all of the report server databases.</span></span>

-   <span data-ttu-id="421f1-192">**次要副本：** 创建一个或多个次要副本。</span><span class="sxs-lookup"><span data-stu-id="421f1-192">**Secondary Replicas:** Create one or more secondary replicas.</span></span> <span data-ttu-id="421f1-193">将数据库从主副本复制到辅助副本的常用方法为使用“RESTORE WITH NORECOVERY”将数据库恢复到每个辅助副本。</span><span class="sxs-lookup"><span data-stu-id="421f1-193">The common approach to copying the databases from the primary replica to the secondary replica(s) is to restore the databases to each secondary replica using 'RESTORE WITH NORECOVERY'.</span></span> <span data-ttu-id="421f1-194">有关创建次要副本和验证数据同步是否正常工作的详细信息，请参阅[启动 AlwaysOn 辅助数据库的数据移动 (SQL Server)](start-data-movement-on-an-always-on-secondary-database-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="421f1-194">For more information on creating secondary replicas and verifying data synchronization is working, see [Start Data Movement on an AlwaysOn Secondary Database &#40;SQL Server&#41;](start-data-movement-on-an-always-on-secondary-database-sql-server.md).</span></span>

-   <span data-ttu-id="421f1-195">**报表服务器凭据：** 需要在针对主要副本创建的次要副本上，创建相应的报表服务器凭据。</span><span class="sxs-lookup"><span data-stu-id="421f1-195">**Report Server Credentials:** You need to create the appropriate report server credentials on the secondary replicas that you created on the primary.</span></span> <span data-ttu-id="421f1-196">具体的步骤取决于您在 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 环境中使用什么类型的身份验证以及 Window [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 服务帐户、Windows 用户帐户或 SQL Server 身份验证。</span><span class="sxs-lookup"><span data-stu-id="421f1-196">The exact steps depend on what type of authentication you are using in your [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] environment; Window [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] service account, Windows user account, or SQL Server authentication.</span></span> <span data-ttu-id="421f1-197">有关详细信息，请参阅[配置报表服务器数据库连接（SSRS 配置管理器）](../../../sql-server/install/configure-a-report-server-database-connection-ssrs-configuration-manager.md)</span><span class="sxs-lookup"><span data-stu-id="421f1-197">For more information, see [Configure a Report Server Database Connection  &#40;SSRS Configuration Manager&#41;](../../../sql-server/install/configure-a-report-server-database-connection-ssrs-configuration-manager.md)</span></span>

-   <span data-ttu-id="421f1-198">更新数据库连接以使用侦听器 DNS 名称。</span><span class="sxs-lookup"><span data-stu-id="421f1-198">Update the database connection to use the Lister DNS Name.</span></span> <span data-ttu-id="421f1-199">对于本机模式的报表服务器，在 **配置管理器中更改** “报表服务器数据库名称” [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="421f1-199">for native mode report servers, change the **Report Server Database Name** in [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] configuration manager.</span></span> <span data-ttu-id="421f1-200">对于 SharePoint 模式，为 **服务应用程序更改** 数据库服务器名称 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="421f1-200">For SharePoint mode, change the **Database server name** for the [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] service application(s).</span></span>

###  <a name="steps-to-complete-disaster-recovery-of-report-server-databases"></a><a name="bkmk_steps_to_complete_failover"></a> <span data-ttu-id="421f1-201">完成报表服务器数据库的灾难恢复所需的步骤</span><span class="sxs-lookup"><span data-stu-id="421f1-201">Steps to complete disaster recovery of Report Server Databases</span></span>
 <span data-ttu-id="421f1-202">在 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 故障转移到辅助副本后，需要完成以下步骤：</span><span class="sxs-lookup"><span data-stu-id="421f1-202">The following steps need to be completed after a [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] failover to a secondary replica:</span></span>

1.  <span data-ttu-id="421f1-203">停止 SQL 代理服务实例，该实例由承载 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 数据库的主数据库引擎使用。</span><span class="sxs-lookup"><span data-stu-id="421f1-203">Stop the instance of the SQL Agent service that was being used by the primary database engine hosting the [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] databases.</span></span>

2.  <span data-ttu-id="421f1-204">在作为新主副本的计算机上启动 SQL 代理服务。</span><span class="sxs-lookup"><span data-stu-id="421f1-204">Start SQL Agent service on the computer that is the new primary replica.</span></span>

3.  <span data-ttu-id="421f1-205">停止报表服务器服务。</span><span class="sxs-lookup"><span data-stu-id="421f1-205">Stop the Report Server service.</span></span>

     <span data-ttu-id="421f1-206">如果报表服务器处于本机模式，则使用 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 配置管理器停止报表服务器的 Windows 服务器。</span><span class="sxs-lookup"><span data-stu-id="421f1-206">If the report server is in native mode, stop the report server Windows server using [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] configuration manager.</span></span>

     <span data-ttu-id="421f1-207">如果将报表服务器配置为用于 SharePoint 模式，请在 SharePoint 管理中心中停止 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 共享服务。</span><span class="sxs-lookup"><span data-stu-id="421f1-207">If the report server is configured for SharePoint mode, stop the [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] shared service in SharePoint Central Administration.</span></span>

4.  <span data-ttu-id="421f1-208">启动报表服务器服务或 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] SharePoint 服务。</span><span class="sxs-lookup"><span data-stu-id="421f1-208">Start the report server service or [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] SharePoint service.</span></span>

5.  <span data-ttu-id="421f1-209">验证报表可以针对新主副本运行。</span><span class="sxs-lookup"><span data-stu-id="421f1-209">Verify that reports can run against the new primary replica.</span></span>

###  <a name="report-server-behavior-when-a-failover-occurs"></a><a name="bkmk_failover_behavior"></a> <span data-ttu-id="421f1-210">发生故障转移时的报表服务器行为</span><span class="sxs-lookup"><span data-stu-id="421f1-210">Report Server Behavior When a Failover Occurs</span></span>
 <span data-ttu-id="421f1-211">当报表服务器数据库发生故障转移且您已更新该报表服务器环境以使用新主副本时，故障转移和恢复过程中会出现一些操作问题。</span><span class="sxs-lookup"><span data-stu-id="421f1-211">When report server databases failover and you have updated the report server environment to use the new primary replica, there are some operational issues that result from the failover and recovery process.</span></span> <span data-ttu-id="421f1-212">这些问题的影响各不相同，具体取决于故障转移时 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 的负载、 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 故障转移到辅助副本所花的时间以及报表服务器管理员更新报表环境以使用新主副本所花的时间。</span><span class="sxs-lookup"><span data-stu-id="421f1-212">The impact of these issues will vary depending on the [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] load at the time of failover as well as the length of time it takes for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] to failover to a secondary replica and for the report server administrator to update the reporting environment to use the new primary replica.</span></span>

-   <span data-ttu-id="421f1-213">由于重试逻辑和报表服务器无法在故障转移期间将预定工作标记为“已完成”，可能多次执行后台处理。</span><span class="sxs-lookup"><span data-stu-id="421f1-213">The execution of background processing may occur more than once due to retry logic and the inability of the report server to mark scheduled work as completed during the failover period.</span></span>

-   <span data-ttu-id="421f1-214">在故障转移期间正常触发运行的后台处理将不执行，因为 SQL Server 代理无法将数据写入报表服务器数据库且该数据将不同步到新主副本。</span><span class="sxs-lookup"><span data-stu-id="421f1-214">The execution of background processing that would have normally been triggered to run during the period of the failover will not occur because SQL Server Agent will not be able to write data into the report server database and this data will not be synchronized to the new primary replica.</span></span>

-   <span data-ttu-id="421f1-215">数据库故障转移完成且报表服务器服务重新启动后，将自动重新创建 SQL Server 代理作业。</span><span class="sxs-lookup"><span data-stu-id="421f1-215">After the database failover completes and after the report server service is re-started, SQL Server Agent jobs will be re-created automatically.</span></span> <span data-ttu-id="421f1-216">在重新创建 SQL 代理作业前，将不处理与 SQL Server 代理作业关联的所有后台执行任务。</span><span class="sxs-lookup"><span data-stu-id="421f1-216">Until the SQL agent jobs are recreated, any background executions associated with SQL Server Agent jobs will not be processed.</span></span> <span data-ttu-id="421f1-217">这包括 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 订阅、计划和快照。</span><span class="sxs-lookup"><span data-stu-id="421f1-217">This includes [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] subscriptions, schedules, an snapshots.</span></span>

## <a name="see-also"></a><span data-ttu-id="421f1-218">另请参阅</span><span class="sxs-lookup"><span data-stu-id="421f1-218">See Also</span></span>
 <span data-ttu-id="421f1-219">[SQL Server Native Client 对高可用性、灾难恢复](../../../relational-databases/native-client/features/sql-server-native-client-support-for-high-availability-disaster-recovery.md) [AlwaysOn 可用性组 (SQL Server) ](always-on-availability-groups-sql-server.md) [入门 AlwaysOn 可用性组](getting-started-with-always-on-availability-groups-sql-server.md)&#40;SQL Server&#41;SQL Server Native Client SQL Server Native Client &#40;SQL Server[使用连接字符串关键字与](../../../relational-databases/native-client/applications/using-connection-string-keywords-with-sql-server-native-client.md)&#41;[支持的高可用性、灾难恢复（](../../../relational-databases/native-client/features/sql-server-native-client-support-for-high-availability-disaster-recovery.md) [关于对可用性副本的客户端连接访问](about-client-connection-access-to-availability-replicas-sql-server.md)</span><span class="sxs-lookup"><span data-stu-id="421f1-219">[SQL Server Native Client Support for High Availability, Disaster Recovery](../../../relational-databases/native-client/features/sql-server-native-client-support-for-high-availability-disaster-recovery.md) [AlwaysOn Availability Groups (SQL Server)](always-on-availability-groups-sql-server.md) [Getting Started with AlwaysOn Availability Groups &#40;SQL Server&#41;](getting-started-with-always-on-availability-groups-sql-server.md) [Using Connection String Keywords with SQL Server Native Client](../../../relational-databases/native-client/applications/using-connection-string-keywords-with-sql-server-native-client.md) [SQL Server Native Client Support for High Availability, Disaster Recovery](../../../relational-databases/native-client/features/sql-server-native-client-support-for-high-availability-disaster-recovery.md) [About Client Connection Access to Availability Replicas &#40;SQL Server&#41;](about-client-connection-access-to-availability-replicas-sql-server.md)</span></span>


