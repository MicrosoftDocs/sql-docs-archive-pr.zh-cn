---
title: AlwaysOn 可用性组 (SQL Server) 的先决条件、限制和建议 |Microsoft Docs
ms.custom: ''
ms.date: 06/14/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- Availability Groups [SQL Server], server instance
- Availability Groups [SQL Server], deploying
- Availability Groups [SQL Server], WSFC clusters
- Availability Groups [SQL Server], about
- Availability Groups [SQL Server], prerequisites and restrictions
- Availability Groups [SQL Server], Failover Cluster Instances
- Availability Groups [SQL Server], databases
- Availability Groups [SQL Server]
ms.assetid: edbab896-42bb-4d17-8d75-e92ca11f7abb
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 078f38058c612037a8013f7955349e94d6db610e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87693113"
---
# <a name="prerequisites-restrictions-and-recommendations-for-alwayson-availability-groups-sql-server"></a><span data-ttu-id="3641a-102">针对 AlwaysOn 可用性组的先决条件、限制和建议 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="3641a-102">Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups (SQL Server)</span></span>
  <span data-ttu-id="3641a-103">本主题介绍在部署 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]时的注意事项，包括针对主机、Windows Server 故障转移群集 (WSFC) 群集、服务器实例和可用性组的先决条件、限制和建议。</span><span class="sxs-lookup"><span data-stu-id="3641a-103">This topic describes considerations for deploying [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], including prerequisites, restrictions, and recommendations for host computers, Windows Server Failover Clustering (WSFC) clusters, server instances, and availability groups.</span></span> <span data-ttu-id="3641a-104">对于上述各组件，还指出了安全注意事项和所需权限（如果有）。</span><span class="sxs-lookup"><span data-stu-id="3641a-104">For each of these components security considerations and required permissions, if any, are indicated.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="3641a-105">在部署 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]之前，强烈建议您阅读本主题的每个章节。</span><span class="sxs-lookup"><span data-stu-id="3641a-105">Before you deploy [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], we strongly recommend that you read every section of this topic.</span></span>  
  
 
  
##  <a name="net-hotfixes-that-support-alwayson-availability-groups"></a><a name="DotNetHotfixes"></a><span data-ttu-id="3641a-106">支持 AlwaysOn 可用性组的 .NET 修补程序</span><span class="sxs-lookup"><span data-stu-id="3641a-106">.NET Hotfixes that Support AlwaysOn Availability Groups</span></span>  
 <span data-ttu-id="3641a-107">根据 [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] 你将用于的组件和功能 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] ，可能需要安装下表中标识的其他 .net 修补程序。</span><span class="sxs-lookup"><span data-stu-id="3641a-107">Depending on the [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] components and features you will use with [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], you may need to install additional .NET hotfixes identified in the following table.</span></span> <span data-ttu-id="3641a-108">可以按任意顺序安装这些修补程序。</span><span class="sxs-lookup"><span data-stu-id="3641a-108">The hotfixes can be installed in any order.</span></span>  
  
||<span data-ttu-id="3641a-109">依赖功能</span><span class="sxs-lookup"><span data-stu-id="3641a-109">Dependent Feature</span></span>|<span data-ttu-id="3641a-110">修补程序</span><span class="sxs-lookup"><span data-stu-id="3641a-110">Hotfix</span></span>|<span data-ttu-id="3641a-111">链接</span><span class="sxs-lookup"><span data-stu-id="3641a-111">Link</span></span>|  
|------|-----------------------|------------|----------|  
|<span data-ttu-id="3641a-112">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-112">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|[!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)]|<span data-ttu-id="3641a-113">.NET 3.5 SP1 修补程序增加了对 SQL Client for Read 意向、readonly 和 multisubnetfailover 的 AlwaysOn 功能的支持。</span><span class="sxs-lookup"><span data-stu-id="3641a-113">Hotfix for .NET 3.5 SP1 adds support to SQL Client for AlwaysOn features of Read-intent, readonly, and multisubnetfailover.</span></span> <span data-ttu-id="3641a-114">此修补程序需要安装在每个 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 报表服务器上。</span><span class="sxs-lookup"><span data-stu-id="3641a-114">The hotfix needs to be installed on each [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] report server.</span></span>|<span data-ttu-id="3641a-115">KB 2654347： [.net 3.5 SP1 修补程序添加对 AlwaysOn 功能的支持](https://go.microsoft.com/fwlink/?LinkId=242896)</span><span class="sxs-lookup"><span data-stu-id="3641a-115">KB 2654347: [Hotfix for .NET 3.5 SP1 to add support for AlwaysOn features](https://go.microsoft.com/fwlink/?LinkId=242896)</span></span>|  
  
##  <a name="windows-system-requirements-and-recommendations"></a><a name="SystemReqsForAOAG"></a><span data-ttu-id="3641a-116">Windows 系统要求和建议</span><span class="sxs-lookup"><span data-stu-id="3641a-116">Windows System Requirements and Recommendations</span></span>  
  
  
###  <a name="checklist-requirements-windows-system"></a><a name="SystemRequirements"></a><span data-ttu-id="3641a-117">清单：要求（Windows 系统）</span><span class="sxs-lookup"><span data-stu-id="3641a-117">Checklist: Requirements (Windows System)</span></span>  
 <span data-ttu-id="3641a-118">为了支持 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 功能，请确保要参与一个或多个可用性组的每台计算机都满足以下基本要求：</span><span class="sxs-lookup"><span data-stu-id="3641a-118">To support the [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] feature, ensure that every computer that is to participate in one or more availability groups meets the following fundamental requirements:</span></span>  
  
||<span data-ttu-id="3641a-119">要求</span><span class="sxs-lookup"><span data-stu-id="3641a-119">Requirement</span></span>|<span data-ttu-id="3641a-120">链接</span><span class="sxs-lookup"><span data-stu-id="3641a-120">Link</span></span>|  
|------|-----------------|----------|  
|<span data-ttu-id="3641a-121">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-121">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-122">确保此系统不是域控制器。</span><span class="sxs-lookup"><span data-stu-id="3641a-122">Ensure that the system is not a domain controller.</span></span>|<span data-ttu-id="3641a-123">域控制器上不支持可用性组。</span><span class="sxs-lookup"><span data-stu-id="3641a-123">Availability groups are not supported on domain controllers.</span></span>|  
|<span data-ttu-id="3641a-124">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-124">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-125">确保每台计算机正在运行 x86（非 WOW64）或 x64 Windows Server 2008 或更高版本。</span><span class="sxs-lookup"><span data-stu-id="3641a-125">Ensure that each computer is running either x86 (non-WOW64) or x64 Windows Server 2008 or later versions.</span></span>|<span data-ttu-id="3641a-126">WOW64（Windows 64 位上的 Windows 32 位）不支持 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="3641a-126">WOW64 (Windows 32-bit on Windows 64-bit) does not support [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span>|  
|<span data-ttu-id="3641a-127">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-127">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-128">确保每台计算机都是 Windows Server 故障转移群集 (WSFC) 群集中的节点。</span><span class="sxs-lookup"><span data-stu-id="3641a-128">Ensure that each computer is a node in a Windows Server Failover Clustering (WSFC) cluster.</span></span>|[<span data-ttu-id="3641a-129">Windows Server 故障转移群集 (WSFC) 与 SQL Server</span><span class="sxs-lookup"><span data-stu-id="3641a-129">Windows Server Failover Clustering &#40;WSFC&#41; with SQL Server</span></span>](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md)|  
|<span data-ttu-id="3641a-130">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-130">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-131">请确保 WSFC 群集包含足够多的节点来支持您的可用性组配置。</span><span class="sxs-lookup"><span data-stu-id="3641a-131">Ensure that the WSFC cluster contains sufficient nodes to support your availability group configurations.</span></span>|<span data-ttu-id="3641a-132">对于某一给定可用性组，一个 WSFC 节点只能承载一个可用性副本。</span><span class="sxs-lookup"><span data-stu-id="3641a-132">A WSFC node can host only one availability replica for a given availability group.</span></span> <span data-ttu-id="3641a-133">在某一给定 WSFC 节点上， [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 的一个或多个实例可为许多可用性组承载可用性副本。</span><span class="sxs-lookup"><span data-stu-id="3641a-133">On a given WSFC node, one or more instances of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] can host availability replicas for many availability groups.</span></span><br /><br /> <span data-ttu-id="3641a-134">询问您的数据库管理员，了解为支持计划的可用性组的可用性副本，需要多少个 WSFC 节点。</span><span class="sxs-lookup"><span data-stu-id="3641a-134">Ask your database administrators how many WSFC nodes are required for to support the availability replicas of the planned availability groups.</span></span><br /><br /> <span data-ttu-id="3641a-135">[AlwaysOn 可用性组概述 (SQL Server)](overview-of-always-on-availability-groups-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="3641a-135">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md).</span></span>|  
|<span data-ttu-id="3641a-136">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-136">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-137">确保 WSFC 群集中的每个节点上都安装了所有适用的 Window 修补程序。</span><span class="sxs-lookup"><span data-stu-id="3641a-137">Ensure that all applicable Window hotfixes have been installed on every node in the WSFC cluster.</span></span>|<span data-ttu-id="3641a-138">\*\* \* \* 重要 \* 提示 \* \*\*对于正在部署的 WSFC 群集的节点，需要或建议使用许多修补程序 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="3641a-138">**\*\* Important \*\*** A number of hotfixes are required or recommended for the nodes of a WSFC cluster on which [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] is being deployed.</span></span> <span data-ttu-id="3641a-139">有关详细信息，请参阅本节后面的[支持 AlwaysOn 可用性组的 Windows 修补程序（Windows 系统）](#WinHotfixes)。</span><span class="sxs-lookup"><span data-stu-id="3641a-139">For more information, see [Windows Hotfixes that Support AlwaysOn Availability Groups (Windows System)](#WinHotfixes), later in this section.</span></span>|  
  
> [!IMPORTANT]  
>  <span data-ttu-id="3641a-140">另外，确保已正确配置了您的环境以连接到可用性组。</span><span class="sxs-lookup"><span data-stu-id="3641a-140">Also ensure that your environment is correctly configured for connecting to an availability group.</span></span> <span data-ttu-id="3641a-141">有关详细信息，请参阅[AlwaysOn 客户端连接 (SQL Server) ](always-on-client-connectivity-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="3641a-141">For more information, see [AlwaysOn Client Connectivity (SQL Server)](always-on-client-connectivity-sql-server.md).</span></span>  
  
####  <a name="windows-hotfixes-that-support-alwayson-availability-groups-windows-system"></a><a name="WinHotfixes"></a><span data-ttu-id="3641a-142">支持 windows 系统 (AlwaysOn 可用性组的 windows 修补程序) </span><span class="sxs-lookup"><span data-stu-id="3641a-142">Windows Hotfixes that Support AlwaysOn Availability Groups (Windows System)</span></span>  
 <span data-ttu-id="3641a-143">根据您的群集拓扑，可能还需要应用其他几个 Windows Server 2008 Service Pack 2 (SP2) 或 Windows Server 2008 R2 修补程序才能支持 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="3641a-143">Depending on your cluster topology, several additional Windows Server 2008 Service Pack 2 (SP2) or Windows Server 2008 R2 hotfixes might be applicable for supporting [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="3641a-144">下表列出了这些修补程序。</span><span class="sxs-lookup"><span data-stu-id="3641a-144">The following table identifies these hotfixes.</span></span> <span data-ttu-id="3641a-145">可以按任意顺序安装这些修补程序。</span><span class="sxs-lookup"><span data-stu-id="3641a-145">They hotfixes can be installed in any order.</span></span>  
  
||<span data-ttu-id="3641a-146">适用于 Windows 2008 SP2</span><span class="sxs-lookup"><span data-stu-id="3641a-146">Applies to Windows 2008 SP2</span></span>|<span data-ttu-id="3641a-147">适用于 Windows 2008 R2 SP1</span><span class="sxs-lookup"><span data-stu-id="3641a-147">Applies to Windows 2008 R2 SP1</span></span>|<span data-ttu-id="3641a-148">包括在 Windows 2012 中</span><span class="sxs-lookup"><span data-stu-id="3641a-148">Included in Windows 2012</span></span>|<span data-ttu-id="3641a-149">若要支持 .。。</span><span class="sxs-lookup"><span data-stu-id="3641a-149">To Support...</span></span>|<span data-ttu-id="3641a-150">修补程序</span><span class="sxs-lookup"><span data-stu-id="3641a-150">Hotfix</span></span>|<span data-ttu-id="3641a-151">链接</span><span class="sxs-lookup"><span data-stu-id="3641a-151">Link</span></span>|  
|------|---------------------------------|------------------------------------|------------------------------|-----------------|------------|----------|  
|<span data-ttu-id="3641a-152">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-152">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-153">是</span><span class="sxs-lookup"><span data-stu-id="3641a-153">Yes</span></span>|<span data-ttu-id="3641a-154">是</span><span class="sxs-lookup"><span data-stu-id="3641a-154">Yes</span></span>|<span data-ttu-id="3641a-155">是</span><span class="sxs-lookup"><span data-stu-id="3641a-155">Yes</span></span>|<span data-ttu-id="3641a-156">**配置最佳 WSFC 仲裁**</span><span class="sxs-lookup"><span data-stu-id="3641a-156">**Configuring optimal WSFC quorum**</span></span>|<span data-ttu-id="3641a-157">在每个 WSFC 节点上，确保安装了在知识库文章 2494036 中介绍的修补程序。</span><span class="sxs-lookup"><span data-stu-id="3641a-157">On each WSFC node, ensure that the hotfix described in Knowledge Base article 2494036 is installed.</span></span><br /><br /> <span data-ttu-id="3641a-158">此修补程序支持使用非自动故障转移目标配置最佳仲裁。</span><span class="sxs-lookup"><span data-stu-id="3641a-158">This hotfix supports configuring optimal quorum with non-automatic failover targets.</span></span> <span data-ttu-id="3641a-159">此功能通过使您可以选择哪些节点进行投票，改进了多站点群集。</span><span class="sxs-lookup"><span data-stu-id="3641a-159">This functionality improves multi-site clusters by enabling you to select which nodes vote.</span></span>|<span data-ttu-id="3641a-160">KB 2494036：  [提供了一个修补程序，使您可以在 Windows Server 2008 和 Windows Server 2008 R2 中配置不具有仲裁投票的群集节点](https://support.microsoft.com/kb/2494036)</span><span class="sxs-lookup"><span data-stu-id="3641a-160">KB 2494036:  [A hotfix is available to let you configure a cluster node that does not have quorum votes in Windows Server 2008 and in Windows Server 2008 R2](https://support.microsoft.com/kb/2494036)</span></span><br /><br /> <span data-ttu-id="3641a-161">有关仲裁投票的信息，请参阅 [WSFC 仲裁模式和投票配置 (SQL Server)](../../../sql-server/failover-clusters/windows/wsfc-quorum-modes-and-voting-configuration-sql-server.md)</span><span class="sxs-lookup"><span data-stu-id="3641a-161">For information about quorum voting, see [WSFC Quorum Modes and Voting Configuration &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-quorum-modes-and-voting-configuration-sql-server.md)</span></span>|  
|<span data-ttu-id="3641a-162">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-162">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-163">是</span><span class="sxs-lookup"><span data-stu-id="3641a-163">Yes</span></span>|<span data-ttu-id="3641a-164">是</span><span class="sxs-lookup"><span data-stu-id="3641a-164">Yes</span></span>|<span data-ttu-id="3641a-165">是</span><span class="sxs-lookup"><span data-stu-id="3641a-165">Yes</span></span>|<span data-ttu-id="3641a-166">**更有效地使用网络带宽**</span><span class="sxs-lookup"><span data-stu-id="3641a-166">**More efficient use of network bandwidth**</span></span>|<span data-ttu-id="3641a-167">在每个 WSFC 节点上，确保安装了在知识库文章 2616514 中介绍的修补程序。</span><span class="sxs-lookup"><span data-stu-id="3641a-167">On each WSFC node, ensure that the hotfix described in Knowledge Base article 2616514 is installed.</span></span><br /><br /> <span data-ttu-id="3641a-168">如果没有安装此修补程序，群集服务将在群集节点间发送不必要的注册表通知。</span><span class="sxs-lookup"><span data-stu-id="3641a-168">Without this hotfix, the Cluster service sends unnecessary registry notifications among cluster nodes.</span></span> <span data-ttu-id="3641a-169">此行为会限制网络带宽，这对于 [!INCLUDE[ssHADRc](../../../includes/sshadrc-md.md)]是很严重的问题。</span><span class="sxs-lookup"><span data-stu-id="3641a-169">This behavior limits network bandwidth, which is a serious issue for [!INCLUDE[ssHADRc](../../../includes/sshadrc-md.md)].</span></span>|<span data-ttu-id="3641a-170">KB 2616514：  [在 Windows Server 2008 或 Windows Server 2008 R2 中，群集服务在群集节点间发送不必要的注册表项更改通知](https://support.microsoft.com/kb/2616514)</span><span class="sxs-lookup"><span data-stu-id="3641a-170">KB 2616514:  [Cluster service sends unnecessary registry key change notifications among cluster nodes in Windows Server 2008 or in Windows Server 2008 R2](https://support.microsoft.com/kb/2616514)</span></span>|  
|<span data-ttu-id="3641a-171">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-171">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>||<span data-ttu-id="3641a-172">是</span><span class="sxs-lookup"><span data-stu-id="3641a-172">Yes</span></span>|<span data-ttu-id="3641a-173">不适用</span><span class="sxs-lookup"><span data-stu-id="3641a-173">Not applicable</span></span>|<span data-ttu-id="3641a-174">**在不可用于所有 WSFC 节点的磁盘上执行 VPD 存储测试**</span><span class="sxs-lookup"><span data-stu-id="3641a-174">**VPD storage testing on disks that are not available to all WSFC nodes**</span></span>|<span data-ttu-id="3641a-175">如果某一 WSFC 节点正在运行 Windows Server 2008 R2 Service Pack 1 (SP1)，并且在未正确在处于联机状态的磁盘上运行且不可用于 WSFC 群集中的所有节点后“验证 SCSI 设备关键产品数据 (VPD)”存储测试失败，则安装在知识库文章 2531907 中介绍的修补程序。</span><span class="sxs-lookup"><span data-stu-id="3641a-175">If a WSFC node is running Windows Server 2008 R2 Service Pack 1 (SP1) and the Validate SCSI Device Vital Product Data (VPD) storage test fails after incorrectly running on disks that are online and not available to all nodes in the WSFC cluster, install the hotfix described in Knowledge Base article 2531907.</span></span><br /><br /> <span data-ttu-id="3641a-176">此修补程序可避免在磁盘处于联机状态时在验证报告中出现不恰当的警告或错误。</span><span class="sxs-lookup"><span data-stu-id="3641a-176">This hotfix eliminates incorrect warnings or errors in the validation report when disks are online.</span></span>|<span data-ttu-id="3641a-177">KB 2531907：[安装 Windows Server 2008 R2 SP1 后验证 SCSI 设备关键产品数据 (VPD) 测试失败](https://support.microsoft.com/kb/2531907)</span><span class="sxs-lookup"><span data-stu-id="3641a-177">KB 2531907:  [Validate SCSI Device Vital Product Data (VPD) test fails after you install Windows Server 2008 R2 SP1](https://support.microsoft.com/kb/2531907)</span></span>|  
|<span data-ttu-id="3641a-178">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-178">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>||<span data-ttu-id="3641a-179">是</span><span class="sxs-lookup"><span data-stu-id="3641a-179">Yes</span></span>|<span data-ttu-id="3641a-180">是</span><span class="sxs-lookup"><span data-stu-id="3641a-180">Yes</span></span>|<span data-ttu-id="3641a-181">**更快地故障转移到本地副本**</span><span class="sxs-lookup"><span data-stu-id="3641a-181">**Faster failover to local replicas**</span></span>|<span data-ttu-id="3641a-182">如果某个 WSFC 节点正在运行 Windows Server 2008 R2 Service Pack 1 (SP1)，请确保安装了在知识库文章 2687741 中介绍的修补程序。</span><span class="sxs-lookup"><span data-stu-id="3641a-182">If a WSFC node is running Windows Server 2008 R2 Service Pack 1 (SP1), ensure that the hotfix described in Knowledge Base article 2687741 is installed.</span></span><br /><br /> <span data-ttu-id="3641a-183">此修补程序可以改进 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 故障转移到本地副本的性能。</span><span class="sxs-lookup"><span data-stu-id="3641a-183">This hotfix improves the performance of [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] failover to local replicas.</span></span>|<span data-ttu-id="3641a-184">KB 2687741：  [为 Windows Server 2008 R2 提供了一个修补程序，可改进 SQL Server 2012 中“AlwaysOn 可用性组”功能的性能](https://support.microsoft.com/KB/2687741)</span><span class="sxs-lookup"><span data-stu-id="3641a-184">KB 2687741:  [A hotfix that improves the performance of the "AlwaysOn Availability Group" feature in SQL Server 2012 is available for Windows Server 2008 R2](https://support.microsoft.com/KB/2687741)</span></span>|  
|<span data-ttu-id="3641a-185">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-185">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-186">是</span><span class="sxs-lookup"><span data-stu-id="3641a-186">Yes</span></span>|<span data-ttu-id="3641a-187">是</span><span class="sxs-lookup"><span data-stu-id="3641a-187">Yes</span></span>|<span data-ttu-id="3641a-188">是</span><span class="sxs-lookup"><span data-stu-id="3641a-188">Yes</span></span>|<span data-ttu-id="3641a-189">**非对称存储- (Fci) 的故障转移群集实例**</span><span class="sxs-lookup"><span data-stu-id="3641a-189">**Asymmetric storage-for Failover Cluster Instances (FCIs)**</span></span>|<span data-ttu-id="3641a-190">如果将为 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 启用任何故障转移群集实例 (FCI)，则安装 Windows Server 2008 修补程序 976097。</span><span class="sxs-lookup"><span data-stu-id="3641a-190">If any Failover Cluster Instance (FCI) will be enabled for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], install the Windows Server 2008 hotfix 976097.</span></span><br /><br /> <span data-ttu-id="3641a-191">此修补程序使故障转移群集管理 Microsoft 管理控制台 (MMC) 管理单元支持仅在某些 WSFC 节点上提供的非对称存储共享磁盘。</span><span class="sxs-lookup"><span data-stu-id="3641a-191">This hotfix enables the Failover Cluster Management Microsoft Management Console (MMC) snap-in to support asymmetric storage-shared disks that are available on only some of the WSFC nodes.</span></span>|<span data-ttu-id="3641a-192">KB 976097：[向异步存储添加了修补程序以便支持运行 Windows Server 2008 或 Windows Server 2008 R2 的故障转移群集的故障转移群集管理 MMC 管理单元](https://support.microsoft.com/kb/976097)</span><span class="sxs-lookup"><span data-stu-id="3641a-192">KB 976097:  [Hotfix to add support for asymmetric storages to the Failover Cluster Management MMC snap-in for a failover cluster that is running Windows Server 2008 or Windows Server 2008 R2](https://support.microsoft.com/kb/976097)</span></span><br /><br /> [<span data-ttu-id="3641a-193">AlwaysOn 体系结构指南：使用故障转移群集实例和可用性组绑定高可用性和灾难恢复解决方案</span><span class="sxs-lookup"><span data-stu-id="3641a-193">AlwaysOn Architecture Guide: Building a High Availability and Disaster Recovery Solution by Using Failover Cluster Instances and Availability Groups</span></span>](https://technet.microsoft.com/library/jj215886.aspx)|  
|<span data-ttu-id="3641a-194">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-194">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-195">是</span><span class="sxs-lookup"><span data-stu-id="3641a-195">Yes</span></span>|<span data-ttu-id="3641a-196">是</span><span class="sxs-lookup"><span data-stu-id="3641a-196">Yes</span></span>|<span data-ttu-id="3641a-197">不适用</span><span class="sxs-lookup"><span data-stu-id="3641a-197">Not applicable</span></span>|<span data-ttu-id="3641a-198">\*\*Internet 协议安全 (IPsec) \*\*</span><span class="sxs-lookup"><span data-stu-id="3641a-198">**Internet Protocol Security (IPsec)**</span></span>|<span data-ttu-id="3641a-199">如果您的环境使用 IPsec 连接，则当客户端计算机与虚拟网络名称重新建立 IPsec 连接（在此上下文中将连接到可用性组侦听器）时，可能会出现长时间的延迟（约两到三分钟）。</span><span class="sxs-lookup"><span data-stu-id="3641a-199">If your environment uses IPsec connections, you could experience a long time delay (about two or three minutes) when a client computer reestablishes the IPsec connection to a virtual network name (in this context, to connect to the availability group listener).</span></span> <span data-ttu-id="3641a-200">如果使用 IPsec 连接，我们建议您查看知识库文章 (KB 980915) 中详述的特定应用场景。</span><span class="sxs-lookup"><span data-stu-id="3641a-200">If you use IPsec connections, we recommend that you review the specific scenarios detailed in Knowledge Base article (KB 980915).</span></span>|<span data-ttu-id="3641a-201">KB 980915：  [从运行 Windows Server 2003、Windows Vista、Windows Server 2008、Windows 7 或 Windows Server 2008 R2 的计算机重新建立 IPSec 连接时出现长时间延迟](https://support.microsoft.com/kb/980915)</span><span class="sxs-lookup"><span data-stu-id="3641a-201">KB 980915:  [A long time delay occurs when you reconnect an IPSec connection from a computer that is running Windows Server 2003, Windows Vista, Windows Server 2008, Windows 7, or Windows Server 2008 R2](https://support.microsoft.com/kb/980915)</span></span>|  
|<span data-ttu-id="3641a-202">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-202">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-203">是</span><span class="sxs-lookup"><span data-stu-id="3641a-203">Yes</span></span>|<span data-ttu-id="3641a-204">是</span><span class="sxs-lookup"><span data-stu-id="3641a-204">Yes</span></span>|<span data-ttu-id="3641a-205">是</span><span class="sxs-lookup"><span data-stu-id="3641a-205">Yes</span></span>|<span data-ttu-id="3641a-206">**IPv6**</span><span class="sxs-lookup"><span data-stu-id="3641a-206">**IPv6**</span></span>|<span data-ttu-id="3641a-207">如果使用 IPv6，根据您的 Windows Server 操作系统，我们建议您查看知识库文章 2578103 或 2578113 中详述的特定应用场景。</span><span class="sxs-lookup"><span data-stu-id="3641a-207">If you use IPv6, we recommend that you review the specific scenarios detailed in Knowledge Base article 2578103 or 2578113, depending on your Windows Server operating system.</span></span><br /><br /> <span data-ttu-id="3641a-208">如果 Windows Server 拓扑使用 IP 版本 6 (IPv6)，则 WSFC 群集服务需要大约 30 秒的时间来对 IPv6 IP 地址进行故障转移。</span><span class="sxs-lookup"><span data-stu-id="3641a-208">If your Windows Server topology uses IP version 6 (IPv6), the WSFC Cluster service requires about 30 seconds to fail over the IPv6 IP address.</span></span> <span data-ttu-id="3641a-209">这会导致客户端等待约 30 秒来重新连接该 IPv6 IP 地址。</span><span class="sxs-lookup"><span data-stu-id="3641a-209">This causes clients to wait for about 30 seconds to reconnect to the IPv6 IP address.</span></span>|<span data-ttu-id="3641a-210">KB 2578103 (Windows Server 2008)：[群集服务需要大约 30 秒对 Windows Server 2008 中的 IPv6 IP 地址进行故障转移](https://support.microsoft.com/kb/2578103)</span><span class="sxs-lookup"><span data-stu-id="3641a-210">KB 2578103 (Windows Server 2008):  [The Cluster service takes about 30 seconds to fail over IPv6 IP addresses in Windows Server 2008](https://support.microsoft.com/kb/2578103)</span></span><br /><br /> <span data-ttu-id="3641a-211">KB 2578113 (Windows Server 2008 R2)：**Windows Server 2008 R2：** [群集服务需要大约 30 秒才能对 Windows Server 2008 R2 中的 IPv6 IP 地址进行故障转移](https://support.microsoft.com/kb/2578113)</span><span class="sxs-lookup"><span data-stu-id="3641a-211">KB 2578113 (Windows Server 2008 R2):  **Windows Server 2008 R2:** [The Cluster service takes about 30 seconds to fail over IPv6 IP addresses in Windows Server 2008 R2](https://support.microsoft.com/kb/2578113)</span></span>|  
|<span data-ttu-id="3641a-212">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-212">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-213">是</span><span class="sxs-lookup"><span data-stu-id="3641a-213">Yes</span></span>|<span data-ttu-id="3641a-214">是</span><span class="sxs-lookup"><span data-stu-id="3641a-214">Yes</span></span>|<span data-ttu-id="3641a-215">是</span><span class="sxs-lookup"><span data-stu-id="3641a-215">Yes</span></span>|<span data-ttu-id="3641a-216">**群集和应用程序服务器之间没有路由器**</span><span class="sxs-lookup"><span data-stu-id="3641a-216">**No Router Between cluster and application server**</span></span>|<span data-ttu-id="3641a-217">如果故障转移群集与应用程序服务器之间不存在路由器，则群集服务对网络相关资源进行故障转移的速度会很慢。</span><span class="sxs-lookup"><span data-stu-id="3641a-217">If no router exists between the failover cluster and the application server, the Cluster service fails over network-related resources slowly.</span></span> <span data-ttu-id="3641a-218">这在可用性组执行故障转移之后会延迟客户端重新连接。</span><span class="sxs-lookup"><span data-stu-id="3641a-218">This delays client reconnections after an availability group fails over.</span></span> <span data-ttu-id="3641a-219">在缺少路由器时，我们建议您查看知识库文章 2582281 中详述的特定应用场景并安装该修补程序（如果适用于您的环境）。</span><span class="sxs-lookup"><span data-stu-id="3641a-219">In the absence of a router, we recommend that you review the specific scenarios detailed in Knowledge Base article 2582281 and install the hotfix, if applicable to your environment.</span></span>|<span data-ttu-id="3641a-220">KB 2582281：  [如果群集与应用程序服务器之间不存在路由器，则故障转移操作的速度会很慢](https://support.microsoft.com/kb/2582281)</span><span class="sxs-lookup"><span data-stu-id="3641a-220">KB 2582281:  [Slow failover operation if no router exists between the cluster and an application server](https://support.microsoft.com/kb/2582281)</span></span>|  
  
###  <a name="recommendations-for-computers-that-host-availability-replicas-windows-system"></a><a name="ComputerRecommendations"></a> <span data-ttu-id="3641a-221">针对承载可用性副本的计算机的建议（Windows 系统）</span><span class="sxs-lookup"><span data-stu-id="3641a-221">Recommendations for Computers That Host Availability Replicas (Windows System)</span></span>  
  
-   <span data-ttu-id="3641a-222">**的系统：** 对于给定的可用性组，所有可用性副本都应在可处理同样的工作负荷的相当的系统上运行。</span><span class="sxs-lookup"><span data-stu-id="3641a-222">**Comparable systems:**  For a given availability group, all the availability replicas should run on comparable systems that can handle identical workloads.</span></span>  
  
-   <span data-ttu-id="3641a-223">**专用网络适配器：** 为获得最佳性能，请将专用的网络适配器（网络接口卡）用于 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="3641a-223">**Dedicated network adapters:**  For best performance, use a dedicated network adapter (network interface card) for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span>  
  
-   <span data-ttu-id="3641a-224">**足够的磁盘空间：** 服务器实例在其上承载可用性副本的每个计算机都必须为该可用性组中的所有数据库拥有足够的磁盘空间。</span><span class="sxs-lookup"><span data-stu-id="3641a-224">**Sufficient disk space:**  Every computer on which a server instance hosts an availability replica must possess sufficient disk space for all the databases in the availability group.</span></span> <span data-ttu-id="3641a-225">请记住，在主数据库增长时，其相应的辅助数据库也增长相同量。</span><span class="sxs-lookup"><span data-stu-id="3641a-225">Keep in mind that as primary databases grow, their corresponding secondary databases grow the same amount.</span></span>  
  
###  <a name="permissions-windows-system"></a><a name="PermissionsWindows"></a> <span data-ttu-id="3641a-226">权限（Windows 系统）</span><span class="sxs-lookup"><span data-stu-id="3641a-226">Permissions (Windows System)</span></span>  
 <span data-ttu-id="3641a-227">若要管理 WSFC 群集，用户必须是每个群集节点上的系统管理员。</span><span class="sxs-lookup"><span data-stu-id="3641a-227">To administer a WSFC cluster, the user must be a system administrator on every cluster node.</span></span>  
  
 <span data-ttu-id="3641a-228">有关用于管理群集的帐户的详细信息，请参阅[附录 A：故障转移群集要求](https://technet.microsoft.com/library/dd197454\(WS.10\).aspx)。</span><span class="sxs-lookup"><span data-stu-id="3641a-228">For more information about the account for administering the cluster, see [Appendix A: Failover Cluster Requirements](https://technet.microsoft.com/library/dd197454\(WS.10\).aspx).</span></span>  
  
###  <a name="related-tasks-windows-system"></a><a name="RelatedTasksWindows"></a> <span data-ttu-id="3641a-229">相关任务（Windows 系统）</span><span class="sxs-lookup"><span data-stu-id="3641a-229">Related Tasks (Windows System)</span></span>  
  
|<span data-ttu-id="3641a-230">任务</span><span class="sxs-lookup"><span data-stu-id="3641a-230">Task</span></span>|<span data-ttu-id="3641a-231">链接</span><span class="sxs-lookup"><span data-stu-id="3641a-231">Link</span></span>|  
|----------|----------|  
|<span data-ttu-id="3641a-232">设置 HostRecordTTL 值。</span><span class="sxs-lookup"><span data-stu-id="3641a-232">Set the HostRecordTTL value.</span></span>|[<span data-ttu-id="3641a-233">更改 HostRecordTTL（使用 Windows PowerShell）</span><span class="sxs-lookup"><span data-stu-id="3641a-233">Change the HostRecordTTL (Using Windows PowerShell)</span></span>](#ChangeHostRecordTTLps)|  
  
####  <a name="change-the-hostrecordttl-using-windows-powershell"></a><a name="ChangeHostRecordTTLps"></a> <span data-ttu-id="3641a-234">更改 HostRecordTTL（使用 Windows PowerShell）</span><span class="sxs-lookup"><span data-stu-id="3641a-234">Change the HostRecordTTL (Using Windows PowerShell)</span></span>  
  
1.  <span data-ttu-id="3641a-235">通过 **“以管理员身份运行”** 打开 PowerShell 窗口。</span><span class="sxs-lookup"><span data-stu-id="3641a-235">Open PowerShell window via **Run as Administrator**.</span></span>  
  
2.  <span data-ttu-id="3641a-236">导入 FailoverClusters 模块。</span><span class="sxs-lookup"><span data-stu-id="3641a-236">Import the FailoverClusters module.</span></span>  
  
3.  <span data-ttu-id="3641a-237">使用 `Get-ClusterResource` cmdlet 查找网络名称资源，然后使用 `Set-ClusterParameter` cmdlet 设置 `HostRecordTTL` 值，如下所示：</span><span class="sxs-lookup"><span data-stu-id="3641a-237">Use the `Get-ClusterResource` cmdlet to find the Network Name resource, then use `Set-ClusterParameter` cmdlet to set the `HostRecordTTL` value, as follows:</span></span>  
  
     <span data-ttu-id="3641a-238">Get-ClusterResource "\<NetworkResourceName>" | Set-ClusterParameter HostRecordTTL \<TimeInSeconds></span><span class="sxs-lookup"><span data-stu-id="3641a-238">Get-ClusterResource "*\<NetworkResourceName>*" | Set-ClusterParameter HostRecordTTL *\<TimeInSeconds>*</span></span>  
  
     <span data-ttu-id="3641a-239">下面的 PowerShell 示例为名为“`SQL Network Name (SQL35)`”的网络名称资源将 HostRecordTTL 设置为 300 秒。</span><span class="sxs-lookup"><span data-stu-id="3641a-239">The following PowerShell example sets the HostRecordTTL to 300 seconds for a Network Name resource named "`SQL Network Name (SQL35)`".</span></span>  
  
    ```powershell
    Import-Module FailoverClusters  
  
    $nameResource = "SQL Network Name (SQL35)"  
    Get-ClusterResource $nameResource | Set-ClusterParameter ClusterParameter HostRecordTTL 300  
    ```  
  
    > [!TIP]  
    >  <span data-ttu-id="3641a-240">每次您打开新的 PowerShell 窗口时，都需要导入 `FailoverClusters` 模块。</span><span class="sxs-lookup"><span data-stu-id="3641a-240">Every time you open a new PowerShell window, you need to import the `FailoverClusters` module.</span></span>  
  
##### <a name="related-content-powershell"></a><span data-ttu-id="3641a-241">相关内容 (PowerShell)</span><span class="sxs-lookup"><span data-stu-id="3641a-241">Related Content (PowerShell)</span></span>  
  
-   <span data-ttu-id="3641a-242">[群集和高可用性](https://techcommunity.microsoft.com/t5/failover-clustering/bg-p/FailoverClustering) （故障转移群集和网络负载平衡团队博客）</span><span class="sxs-lookup"><span data-stu-id="3641a-242">[Clustering and High-Availability](https://techcommunity.microsoft.com/t5/failover-clustering/bg-p/FailoverClustering) (Failover Clustering and Network Load Balancing Team Blog)</span></span>  
  
-   <span data-ttu-id="3641a-243">[故障转移群集上的 Windows PowerShell 入门](https://technet.microsoft.com/library/ee619762\(WS.10\).aspx)</span><span class="sxs-lookup"><span data-stu-id="3641a-243">[Getting Started with Windows PowerShell on a Failover Cluster](https://technet.microsoft.com/library/ee619762\(WS.10\).aspx)</span></span>  
  
-   [<span data-ttu-id="3641a-244">群集资源命令和等效的 Windows PowerShell cmdlet</span><span class="sxs-lookup"><span data-stu-id="3641a-244">Cluster resource commands and equivalent Windows PowerShell cmdlets</span></span>](https://msdn.microsoft.com/library/ee619744.aspx#BKMK_resource)  
  
###  <a name="related-content-windows-system"></a><a name="RelatedContentWS"></a> <span data-ttu-id="3641a-245">相关内容（Windows 系统）</span><span class="sxs-lookup"><span data-stu-id="3641a-245">Related Content (Windows System)</span></span>  
  
-   <span data-ttu-id="3641a-246">[在多站点故障转移群集中配置 DNS 设置](https://technet.microsoft.com/library/dd197562\(WS.10\).aspx)</span><span class="sxs-lookup"><span data-stu-id="3641a-246">[Configure DNS settings in a Multi-Site Failover Cluster](https://technet.microsoft.com/library/dd197562\(WS.10\).aspx)</span></span>  
  
-   [<span data-ttu-id="3641a-247">向网络名称资源注册 DNS</span><span class="sxs-lookup"><span data-stu-id="3641a-247">DNS Registration with Network Name Resource</span></span>](https://techcommunity.microsoft.com/t5/failover-clustering/dns-registration-with-the-network-name-resource/ba-p/371482)  
  
-   [<span data-ttu-id="3641a-248">Windows 2008 R2 故障转移多站点群集</span><span class="sxs-lookup"><span data-stu-id="3641a-248">Windows 2008 R2 Failover Multi-Site Clustering</span></span>](https://kiruba4u.blogspot.com/2012/03/failover-clustering-in-windows-server.html)  
  
##  <a name="sql-server-instance-prerequisites-and-restrictions"></a><a name="ServerInstance"></a> <span data-ttu-id="3641a-249">SQL Server 实例先决条件和限制</span><span class="sxs-lookup"><span data-stu-id="3641a-249">SQL Server Instance Prerequisites and Restrictions</span></span>  
 <span data-ttu-id="3641a-250">每个可用性组均要求称作“可用性副本” [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]的一组故障转移伙伴，它们由  的实例承载。</span><span class="sxs-lookup"><span data-stu-id="3641a-250">Each availability group requires a set of failover partners, known as *availability replicas*, which are hosted by instances of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="3641a-251">给定的服务器实例可以是独立实例或 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 故障转移群集实例 (FCI)。</span><span class="sxs-lookup"><span data-stu-id="3641a-251">A given server instance can be a *stand-alone instance* or a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]*failover cluster instance* (FCI).</span></span>  
  
 
  
###  <a name="checklist-prerequisites-server-instance"></a><a name="PrerequisitesSI"></a><span data-ttu-id="3641a-252">清单：先决条件（服务器实例）</span><span class="sxs-lookup"><span data-stu-id="3641a-252">Checklist: Prerequisites (Server Instance)</span></span>  
  
||<span data-ttu-id="3641a-253">先决条件</span><span class="sxs-lookup"><span data-stu-id="3641a-253">Prerequisite</span></span>|<span data-ttu-id="3641a-254">链接</span><span class="sxs-lookup"><span data-stu-id="3641a-254">Links</span></span>|  
|-|------------------|-----------|  
|<span data-ttu-id="3641a-255">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-255">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-256">主机必须是 Windows Server 故障转移群集 (WSFC) 节点。</span><span class="sxs-lookup"><span data-stu-id="3641a-256">The host computer must be a Windows Server Failover Clustering (WSFC) node.</span></span> <span data-ttu-id="3641a-257">承载给定可用性组的可用性副本的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例必须位于单个 WSFC 群集的单独节点上。</span><span class="sxs-lookup"><span data-stu-id="3641a-257">The instances of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] that host availability replicas for a given availability group must reside on separate nodes of a single WSFC cluster.</span></span> <span data-ttu-id="3641a-258">唯一的例外是在迁移到另一个 WSFC 群集时，此时一个可用性组可能会暂时跨两个群集。</span><span class="sxs-lookup"><span data-stu-id="3641a-258">The only exception is that while being migrated to another WSFC cluster, an availability group can temporarily straddle two clusters.</span></span>|[<span data-ttu-id="3641a-259">Windows Server 故障转移群集 (WSFC) 与 SQL Server</span><span class="sxs-lookup"><span data-stu-id="3641a-259">Windows Server Failover Clustering &#40;WSFC&#41; with SQL Server</span></span>](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md)<br /><br /> [<span data-ttu-id="3641a-260">故障转移群集和 AlwaysOn 可用性组 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="3641a-260">Failover Clustering and AlwaysOn Availability Groups &#40;SQL Server&#41;</span></span>](failover-clustering-and-always-on-availability-groups-sql-server.md)|  
|<span data-ttu-id="3641a-261">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-261">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-262">如果您希望将可用性组与 Kerberos 一起使用：</span><span class="sxs-lookup"><span data-stu-id="3641a-262">If you want an availability group to work with Kerberos:</span></span><br /><br /> <span data-ttu-id="3641a-263">承载可用性组的可用性副本的所有服务器实例都必须使用相同的 SQL Server 服务帐户。</span><span class="sxs-lookup"><span data-stu-id="3641a-263">All server instances that host an availability replica for the availability group must use the same SQL Server service account.</span></span><br /><br /> <span data-ttu-id="3641a-264">域管理员需要在可用性组侦听器的虚拟网络名称 (VNN) 的 SQL Server 服务帐户上使用 Active Directory 手动注册服务主体名称 (SPN)。</span><span class="sxs-lookup"><span data-stu-id="3641a-264">The domain administrator needs to manually register a Service Principal Name (SPN) with Active Directory on the SQL Server service account for the virtual network name (VNN) of the availability group listener.</span></span> <span data-ttu-id="3641a-265">如果在 SQL Server 服务帐户之外的帐户上注册 SPN，则身份验证将失败。</span><span class="sxs-lookup"><span data-stu-id="3641a-265">If the SPN is registered on an account other than the SQL Server service account, authentication will fail.</span></span><br /><br /> <span data-ttu-id="3641a-266">**\*\* 重要提示 \*\*** 如果你更改 SQL Server 服务帐户，则域管理员必须重新手动注册 SPN。</span><span class="sxs-lookup"><span data-stu-id="3641a-266">**\*\* Important \*\*** If you change the SQL Server service account, the domain administrator will need to manually re-register the SPN.</span></span>|[<span data-ttu-id="3641a-267">为 Kerberos 连接注册服务主体名称</span><span class="sxs-lookup"><span data-stu-id="3641a-267">Register a Service Principal Name for Kerberos Connections</span></span>](../../configure-windows/register-a-service-principal-name-for-kerberos-connections.md)<br /><br /> <span data-ttu-id="3641a-268">**简要说明：**</span><span class="sxs-lookup"><span data-stu-id="3641a-268">**Brief explanation:**</span></span><br /><br /> <span data-ttu-id="3641a-269">Kerberos 和 SPN 强制实施相互身份验证。</span><span class="sxs-lookup"><span data-stu-id="3641a-269">Kerberos and SPNs enforce mutual authentication.</span></span> <span data-ttu-id="3641a-270">SPN 将映射到启动 SQL Server 服务的 Windows 帐户。</span><span class="sxs-lookup"><span data-stu-id="3641a-270">The SPN maps to the Windows account that starts the SQL Server services.</span></span> <span data-ttu-id="3641a-271">如果未正确注册 SPN 或注册失败，则 Windows 安全层将无法确定与 SPN 关联的帐户，因而无法使用 Kerberos 身份验证。</span><span class="sxs-lookup"><span data-stu-id="3641a-271">If the SPN is not registered correctly or if it fails, the Windows security layer cannot determine the account associated with the SPN, and Kerberos authentication cannot be used.</span></span><br /><br /> <span data-ttu-id="3641a-272">注意：NTLM 没有此要求。</span><span class="sxs-lookup"><span data-stu-id="3641a-272">Note: NTLM does not have this requirement.</span></span>|  
|<span data-ttu-id="3641a-273">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-273">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-274">如果您计划使用 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 故障转移群集实例 (FCI) 承载可用性副本，则请确保您理解 FCI 限制并且满足 FCI 要求。</span><span class="sxs-lookup"><span data-stu-id="3641a-274">If you plan to use a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover cluster instance (FCI) to host an availability replica, ensure that you understand the FCI restrictions and that the FCI requirements are met.</span></span>|<span data-ttu-id="3641a-275">[使用 SQL Server 故障转移群集实例 (FCI) 承载可用性副本的先决条件和要求](#FciArLimitations) （本主题的后面将介绍）</span><span class="sxs-lookup"><span data-stu-id="3641a-275">[Prerequisites and Requirements on Using a SQL Server Failover Cluster Instance (FCI) to Host an Availability Replica](#FciArLimitations) (later in this topic)</span></span>|  
|<span data-ttu-id="3641a-276">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-276">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-277">每个服务器实例都必须正在运行 [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)]的 Enterprise Edition。</span><span class="sxs-lookup"><span data-stu-id="3641a-277">Each server instance must be running the Enterprise Edition of [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span></span>|[<span data-ttu-id="3641a-278">SQL Server 2014 各个版本支持的功能</span><span class="sxs-lookup"><span data-stu-id="3641a-278">Features Supported by the Editions of SQL Server 2014</span></span>](../../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md)|  
|<span data-ttu-id="3641a-279">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-279">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-280">为某一可用性组承载可用性副本的所有服务器实例必须都使用相同的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 排序规则。</span><span class="sxs-lookup"><span data-stu-id="3641a-280">All the server instances that host availability replicas for an availability group must use the same [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] collation.</span></span>|[<span data-ttu-id="3641a-281">设置或更改服务器排序规则</span><span class="sxs-lookup"><span data-stu-id="3641a-281">Set or Change the Server Collation</span></span>](../../../relational-databases/collations/set-or-change-the-server-collation.md)|  
|<span data-ttu-id="3641a-282">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-282">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-283">对将为任何可用性组承载可用性副本的每个服务器实例都启用 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 功能。</span><span class="sxs-lookup"><span data-stu-id="3641a-283">Enable the [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] feature on each server instance that will host an availability replica for any availability group.</span></span> <span data-ttu-id="3641a-284">在某一给定计算机上，您可为 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 启用您的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 安装支持的任意多的服务器实例。</span><span class="sxs-lookup"><span data-stu-id="3641a-284">On a given computer, you can enable as many server instances for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] as your [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] installation supports.</span></span>|[<span data-ttu-id="3641a-285">启用和禁用 AlwaysOn 可用性组 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="3641a-285">Enable and Disable AlwaysOn Availability Groups &#40;SQL Server&#41;</span></span>](enable-and-disable-always-on-availability-groups-sql-server.md)<br /><br /> <span data-ttu-id="3641a-286">\*\* \* \* 重要 \* 提示 \* \*\*如果你删除并重新创建了 WSFC 群集，则必须在 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 原始 WSFC 群集上启用了的每个服务器实例上禁用并重新启用该功能。</span><span class="sxs-lookup"><span data-stu-id="3641a-286">**\*\* Important \*\*** If you delete and re-create a WSFC cluster, you must disable and re-enable the [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] feature on each server instance that was enabled for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] on the original WSFC cluster.</span></span>|  
|<span data-ttu-id="3641a-287">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-287">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-288">每个服务器实例都要求数据库镜像端点。</span><span class="sxs-lookup"><span data-stu-id="3641a-288">Each server instance requires a database mirroring endpoint.</span></span> <span data-ttu-id="3641a-289">请注意，此端点由服务器实例上的所有可用性副本以及数据库镜像伙伴和见证服务器共享。</span><span class="sxs-lookup"><span data-stu-id="3641a-289">Note that this endpoint is shared by all the availability replicas and database mirroring partners and witnesses on the server instance.</span></span><br /><br /> <span data-ttu-id="3641a-290">如果你选择承载可用性副本的服务器实例正在某一域用户帐户下运行并且尚不具有数据库镜像端点，则 [新建可用性组向导](use-the-availability-group-wizard-sql-server-management-studio.md) （或者 [将副本添加到可用性组向导](use-the-add-replica-to-availability-group-wizard-sql-server-management-studio.md)）可以创建该端点并将 CONNECT 权限授予服务器实例的服务帐户。</span><span class="sxs-lookup"><span data-stu-id="3641a-290">If a server instance that you select to host an availability replica is running under a domain user account and does not yet have a database mirroring endpoint, the [New Availability Group Wizard](use-the-availability-group-wizard-sql-server-management-studio.md) (or [Add Replica to Availability Group Wizard](use-the-add-replica-to-availability-group-wizard-sql-server-management-studio.md)) can create the endpoint and grant CONNECT permission to the server instance service account.</span></span> <span data-ttu-id="3641a-291">但是，如果 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 服务正在以内置帐户（例如 Local System、Local Service 或 Network Service）或非域帐户运行，您必须使用证书来进行端点身份验证，并且该向导将无法在服务器实例上创建数据库镜像端点。</span><span class="sxs-lookup"><span data-stu-id="3641a-291">However, if the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] service is running as a built-in account, such as Local System, Local Service, or Network Service, or a nondomain account, you must use certificates for endpoint authentication, and the wizard will be unable to create a database mirroring endpoint on the server instance.</span></span> <span data-ttu-id="3641a-292">在此情况下，我们建议您首先手动创建数据库镜像端点，然后启动该向导。</span><span class="sxs-lookup"><span data-stu-id="3641a-292">In this case, we recommend that you create the database mirroring endpoints manually before you launch the wizard.</span></span><br /><br /> <span data-ttu-id="3641a-293">**\*\* 安全说明 \*\***[!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 的传输安全性与数据库镜像的传输安全性相同。</span><span class="sxs-lookup"><span data-stu-id="3641a-293">**\*\* Security Note \*\*** Transport security for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] is the same as for database mirroring.</span></span>|[<span data-ttu-id="3641a-294">数据库镜像终结点 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="3641a-294">The Database Mirroring Endpoint &#40;SQL Server&#41;</span></span>](../../database-mirroring/the-database-mirroring-endpoint-sql-server.md)<br /><br /> [<span data-ttu-id="3641a-295">用于数据库镜像和 AlwaysOn 可用性组 &#40;SQL Server 的传输安全&#41;</span><span class="sxs-lookup"><span data-stu-id="3641a-295">Transport Security for Database Mirroring and AlwaysOn Availability Groups &#40;SQL Server&#41;</span></span>](../../database-mirroring/transport-security-database-mirroring-always-on-availability.md)|  
|<span data-ttu-id="3641a-296">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-296">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-297">如果使用 FILESTREAM 的任何数据库将添加到某一可用性组，请确保在将承载该可用性组的可用性副本的每个服务器实例上都启用 FILESTREAM。</span><span class="sxs-lookup"><span data-stu-id="3641a-297">If any databases that use FILESTREAM will be added to an availability group, ensure that FILESTREAM is enabled on every server instance that will host an availability replica for the availability group.</span></span>|[<span data-ttu-id="3641a-298">启用和配置 FILESTREAM</span><span class="sxs-lookup"><span data-stu-id="3641a-298">Enable and Configure FILESTREAM</span></span>](../../../relational-databases/blob/enable-and-configure-filestream.md)|  
|<span data-ttu-id="3641a-299">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-299">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-300">如果任何包含的数据库将添加到某一可用性组，请确保在将承载该可用性组的可用性副本的每个服务器实例上将 `contained database authentication` 服务器选项都设置为 `1`。</span><span class="sxs-lookup"><span data-stu-id="3641a-300">If any contained databases will be added to an availability group, ensure that the `contained database authentication` server option is set to `1` on every server instance that will host an availability replica for the availability group.</span></span>|[<span data-ttu-id="3641a-301">contained database authentication 服务器配置选项</span><span class="sxs-lookup"><span data-stu-id="3641a-301">contained database authentication Server Configuration Option</span></span>](../../configure-windows/contained-database-authentication-server-configuration-option.md)<br /><br /> [<span data-ttu-id="3641a-302">服务器配置选项 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="3641a-302">Server Configuration Options &#40;SQL Server&#41;</span></span>](../../configure-windows/server-configuration-options-sql-server.md)|  
  
###  <a name="thread-usage-by-availability-groups"></a><a name="ThreadUsage"></a> <span data-ttu-id="3641a-303">可用性组的线程使用情况</span><span class="sxs-lookup"><span data-stu-id="3641a-303">Thread Usage by Availability Groups</span></span>  
 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] <span data-ttu-id="3641a-304">的工作线程具有以下要求：</span><span class="sxs-lookup"><span data-stu-id="3641a-304">has the following requirements for worker threads:</span></span>  
  
-   <span data-ttu-id="3641a-305">在 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]的一个空闲实例上， [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 使用 0 线程。</span><span class="sxs-lookup"><span data-stu-id="3641a-305">On an idle instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] uses 0 threads.</span></span>  
  
-   <span data-ttu-id="3641a-306">可用性组使用的最大线程数为配置的最大服务器线程数（“`max worker threads`”）减去 40。</span><span class="sxs-lookup"><span data-stu-id="3641a-306">The maximum number of threads used by availability groups is the configured setting for the maximum number of server threads ('`max worker threads`') minus 40.</span></span>  
  
-   <span data-ttu-id="3641a-307">给定服务器实例上承载的可用性副本共享一个线程池。</span><span class="sxs-lookup"><span data-stu-id="3641a-307">The availability replicas hosted on a given server instance share a single thread pool.</span></span>  
  
     <span data-ttu-id="3641a-308">线程是按需共享的，如下所示：</span><span class="sxs-lookup"><span data-stu-id="3641a-308">Threads are shared on an on-demand basis, as follows:</span></span>  
  
    -   <span data-ttu-id="3641a-309">一般情况下，存在 3–10 个共享线程，但此数目会根据主副本工作负荷增加。</span><span class="sxs-lookup"><span data-stu-id="3641a-309">Typically, there are 3-10 shared threads, but this number can increase depending on the primary replica workload.</span></span>  
  
    -   <span data-ttu-id="3641a-310">如果给定线程空闲一段时间，则将释放回常规 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 线程池。</span><span class="sxs-lookup"><span data-stu-id="3641a-310">If a given thread is idle for a while, it is released back into the general [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] thread pool.</span></span> <span data-ttu-id="3641a-311">正常情况下，不活动线程在处于不活动状态 15 秒后释放。</span><span class="sxs-lookup"><span data-stu-id="3641a-311">Normally, an inactive thread is released after ~15 seconds of inactivity.</span></span> <span data-ttu-id="3641a-312">但是，根据上一次活动，空闲线程可能保留更长时间。</span><span class="sxs-lookup"><span data-stu-id="3641a-312">However, depending on the last activity, an idle thread might be retained longer.</span></span>  
  
-   <span data-ttu-id="3641a-313">此外，可用性组使用未共享的线程，如下所示：</span><span class="sxs-lookup"><span data-stu-id="3641a-313">In addition, availability groups use unshared threads, as follows:</span></span>  
  
    -   <span data-ttu-id="3641a-314">每个主副本为每个主数据库使用 1 个日志捕获线程。</span><span class="sxs-lookup"><span data-stu-id="3641a-314">Each primary replica uses 1 Log Capture thread for each primary database.</span></span> <span data-ttu-id="3641a-315">此外，它为每个辅助数据库使用 1 个日志发送线程。</span><span class="sxs-lookup"><span data-stu-id="3641a-315">In addition, it uses 1 Log Send thread for each secondary database.</span></span> <span data-ttu-id="3641a-316">日志发送线程将在处于不活动状态 15 秒后释放。</span><span class="sxs-lookup"><span data-stu-id="3641a-316">Log send threads are released after ~15 seconds of inactivity.</span></span>  
  
    -   <span data-ttu-id="3641a-317">每个辅助副本为每个辅助数据库使用 1 个恢复线程。</span><span class="sxs-lookup"><span data-stu-id="3641a-317">Each secondary replica uses 1 redo thread for each secondary database.</span></span> <span data-ttu-id="3641a-318">恢复线程将在处于不活动状态 15 秒后释放。</span><span class="sxs-lookup"><span data-stu-id="3641a-318">Redo threads are released after ~15 seconds of inactivity.</span></span>  
  
    -   <span data-ttu-id="3641a-319">辅助副本上的备份将在备份操作持续时间内包含主副本上的一个线程。</span><span class="sxs-lookup"><span data-stu-id="3641a-319">A backup on a secondary replica holds a thread on the primary replica for the duration of the backup operation.</span></span>  
  
 <span data-ttu-id="3641a-320">有关详细信息，请参阅 [AlwaysON - HADRON 学习系列：启用了 HADRON 的数据库的工作线程池用法](https://blogs.msdn.com/b/psssql/archive/2012/05/17/alwayson-hadron-learning-series-worker-pool-usage-for-hadron-enabled-databases.aspx)（CSS [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 工程师的一篇博客）。</span><span class="sxs-lookup"><span data-stu-id="3641a-320">For more information, see [AlwaysON - HADRON Learning Series: Worker Pool Usage for HADRON Enabled Databases](https://blogs.msdn.com/b/psssql/archive/2012/05/17/alwayson-hadron-learning-series-worker-pool-usage-for-hadron-enabled-databases.aspx) (a CSS [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Engineers Blog).</span></span>  
  
###  <a name="permissions-server-instance"></a><a name="PermissionsSI"></a> <span data-ttu-id="3641a-321">权限（服务器实例）</span><span class="sxs-lookup"><span data-stu-id="3641a-321">Permissions (Server Instance)</span></span>  
  
|<span data-ttu-id="3641a-322">任务</span><span class="sxs-lookup"><span data-stu-id="3641a-322">Task</span></span>|<span data-ttu-id="3641a-323">所需的权限</span><span class="sxs-lookup"><span data-stu-id="3641a-323">Required Permissions</span></span>|  
|----------|--------------------------|  
|<span data-ttu-id="3641a-324">创建数据库镜像端点</span><span class="sxs-lookup"><span data-stu-id="3641a-324">Creating the database mirroring endpoint</span></span>|<span data-ttu-id="3641a-325">要求具有 CREATE ENDPOINT 权限，或者具有 **sysadmin** 固定服务器角色的成员身份。</span><span class="sxs-lookup"><span data-stu-id="3641a-325">Requires CREATE ENDPOINT permission, or membership in the **sysadmin** fixed server role.</span></span>  <span data-ttu-id="3641a-326">此外，还要求 CONTROL ON ENDPOINT 权限。</span><span class="sxs-lookup"><span data-stu-id="3641a-326">Also requires CONTROL ON ENDPOINT permission.</span></span> <span data-ttu-id="3641a-327">有关详细信息，请参阅 [GRANT 终结点权限 (Transact-SQL)](/sql/t-sql/statements/grant-endpoint-permissions-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="3641a-327">For more information, see [GRANT Endpoint Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/grant-endpoint-permissions-transact-sql).</span></span>|  
|<span data-ttu-id="3641a-328">启用 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]</span><span class="sxs-lookup"><span data-stu-id="3641a-328">Enabling [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]</span></span>|<span data-ttu-id="3641a-329">要求本地计算机上 **Administrator** 组中的成员身份以及对 WSFC 群集的完全控制。</span><span class="sxs-lookup"><span data-stu-id="3641a-329">Requires membership in the **Administrator** group on the local computer and full control on the WSFC cluster.</span></span>|  
  
###  <a name="related-tasks-server-instance"></a><a name="RelatedTasksSI"></a> <span data-ttu-id="3641a-330">相关任务（服务器实例）</span><span class="sxs-lookup"><span data-stu-id="3641a-330">Related Tasks (Server Instance)</span></span>  
  
|<span data-ttu-id="3641a-331">任务</span><span class="sxs-lookup"><span data-stu-id="3641a-331">Task</span></span>|<span data-ttu-id="3641a-332">主题</span><span class="sxs-lookup"><span data-stu-id="3641a-332">Topic</span></span>|  
|----------|-----------|  
|<span data-ttu-id="3641a-333">确定数据库镜像端点是否存在</span><span class="sxs-lookup"><span data-stu-id="3641a-333">Determining whether database mirroring endpoint exists</span></span>|[<span data-ttu-id="3641a-334">sys.database_mirroring_endpoints (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="3641a-334">sys.database_mirroring_endpoints &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-database-mirroring-endpoints-transact-sql)|  
|<span data-ttu-id="3641a-335">创建数据库镜像端点（如果它尚不存在）</span><span class="sxs-lookup"><span data-stu-id="3641a-335">Creating the database mirroring endpoint (if it does not yet exist)</span></span>|[<span data-ttu-id="3641a-336">为 Windows 身份验证创建数据库镜像终结点 (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="3641a-336">Create a Database Mirroring Endpoint for Windows Authentication &#40;Transact-SQL&#41;</span></span>](../../database-mirroring/create-a-database-mirroring-endpoint-for-windows-authentication-transact-sql.md)<br /><br /> [<span data-ttu-id="3641a-337">使用数据库镜像终结点证书 (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="3641a-337">Use Certificates for a Database Mirroring Endpoint &#40;Transact-SQL&#41;</span></span>](../../database-mirroring/use-certificates-for-a-database-mirroring-endpoint-transact-sql.md)<br /><br /> [<span data-ttu-id="3641a-338">为 AlwaysOn 可用性组 &#40;SQL Server PowerShell 创建数据库镜像端点&#41;</span><span class="sxs-lookup"><span data-stu-id="3641a-338">Create a Database Mirroring Endpoint for AlwaysOn Availability Groups &#40;SQL Server PowerShell&#41;</span></span>](database-mirroring-always-on-availability-groups-powershell.md)|  
|<span data-ttu-id="3641a-339">启用 AlwaysOn 可用性组</span><span class="sxs-lookup"><span data-stu-id="3641a-339">Enabling AlwaysOn Availability Groups</span></span>|[<span data-ttu-id="3641a-340">启用和禁用 AlwaysOn 可用性组 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="3641a-340">Enable and Disable AlwaysOn Availability Groups &#40;SQL Server&#41;</span></span>](enable-and-disable-always-on-availability-groups-sql-server.md)|  
  
###  <a name="related-content-server-instance"></a><a name="RelatedContentSI"></a> <span data-ttu-id="3641a-341">相关内容（服务器实例）</span><span class="sxs-lookup"><span data-stu-id="3641a-341">Related Content (Server Instance)</span></span>  
  
-   [<span data-ttu-id="3641a-342">AlwaysON - HADRON 学习系列：启用了 HADRON 的数据库的工作线程池用法</span><span class="sxs-lookup"><span data-stu-id="3641a-342">AlwaysON - HADRON Learning Series: Worker Pool Usage for HADRON Enabled Databases</span></span>](https://blogs.msdn.com/b/psssql/archive/2012/05/17/alwayson-hadron-learning-series-worker-pool-usage-for-hadron-enabled-databases.aspx)  
  
##  <a name="network-connectivity-recommendations"></a><a name="NetworkConnect"></a> <span data-ttu-id="3641a-343">网络连接建议</span><span class="sxs-lookup"><span data-stu-id="3641a-343">Network Connectivity Recommendations</span></span>  
 <span data-ttu-id="3641a-344">强烈建议您为 WSFC 群集成员之间的通信和可用性副本之间的通信使用相同的网络链接。</span><span class="sxs-lookup"><span data-stu-id="3641a-344">We strongly recommend that you use the same network links for communications between WSFC cluster members and communications between availability replicas.</span></span>  <span data-ttu-id="3641a-345">如果某些链接失败（甚至间歇性断开），使用单独的网络链接可能会导致意外行为。</span><span class="sxs-lookup"><span data-stu-id="3641a-345">Using separate network links can cause unexpected behaviors if some of links fail (even intermittently).</span></span>  
  
 <span data-ttu-id="3641a-346">例如，要使可用性组支持自动故障转移，作为自动故障转移伙伴的辅助副本必须处于 SYNCHRONIZED 状态。</span><span class="sxs-lookup"><span data-stu-id="3641a-346">For example, for an availability group to support automatic failover, the secondary replica that is the automatic-failover partner must be in the SYNCHRONIZED state.</span></span> <span data-ttu-id="3641a-347">如果到此辅助副本的网络链接失败（甚至间歇性断开），副本将进入 UNSYNCHRONIZED 状态，并且在该链接恢复之前无法重新同步。</span><span class="sxs-lookup"><span data-stu-id="3641a-347">If the network link to this secondary replica fails (even intermittently), the replica enters the UNSYNCHRONIZED state and cannot begin to resynchronize until the link is restored.</span></span> <span data-ttu-id="3641a-348">如果在该辅助副本不同步时，WSFC 群集请求自动故障转移，则不会发生自动故障转移。</span><span class="sxs-lookup"><span data-stu-id="3641a-348">If the WSFC cluster requests an automatic failover while the secondary replica is unsynchronized, automatic failover will not occur.</span></span>  
  
##  <a name="client-connectivity-support"></a><a name="ClientConnSupport"></a> <span data-ttu-id="3641a-349">客户端连接支持</span><span class="sxs-lookup"><span data-stu-id="3641a-349">Client Connectivity Support</span></span>  
 <span data-ttu-id="3641a-350">有关 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 客户端连接支持的信息，请参阅[AlwaysOn 客户端连接 (SQL Server) ](always-on-client-connectivity-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="3641a-350">For information about [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] support for client connectivity, see [AlwaysOn Client Connectivity (SQL Server)](always-on-client-connectivity-sql-server.md).</span></span>  
  
##  <a name="prerequisites-and-restrictions-for-using-a-sql-server-failover-cluster-instance-fci-to-host-an-availability-replica"></a><a name="FciArLimitations"></a> <span data-ttu-id="3641a-351">使用 SQL Server 故障转移群集实例 (FCI) 承载可用性副本的先决条件和限制</span><span class="sxs-lookup"><span data-stu-id="3641a-351">Prerequisites and Restrictions for Using a SQL Server Failover Cluster Instance (FCI) to Host an Availability Replica</span></span>  
 
  
###  <a name="restrictions-fcis"></a><a name="RestrictionsFCI"></a> <span data-ttu-id="3641a-352">限制 (FCI)</span><span class="sxs-lookup"><span data-stu-id="3641a-352">Restrictions (FCIs)</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="3641a-353">从 [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] 中开始，AlwaysOn 故障转移群集实例支持 [!INCLUDE[winserver2008r2](../../../includes/winserver2008r2-md.md)] 和 [!INCLUDE[win8srv](../../../includes/win8srv-md.md)] 中的群集共享卷 (CSV)。</span><span class="sxs-lookup"><span data-stu-id="3641a-353">Beginning in [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)], AlwaysOn Failover Cluster Instances supports Clustered Shared Volumes (CSV) in both [!INCLUDE[winserver2008r2](../../../includes/winserver2008r2-md.md)] and [!INCLUDE[win8srv](../../../includes/win8srv-md.md)].</span></span> <span data-ttu-id="3641a-354">有关 CSV 的详细信息，请参阅 [了解故障转移群集中的群集共享卷](https://technet.microsoft.com/library/dd759255.aspx)。</span><span class="sxs-lookup"><span data-stu-id="3641a-354">For more information on CSV, see [Understanding Cluster Shared Volumes in a Failover Cluster](https://technet.microsoft.com/library/dd759255.aspx).</span></span>  
  
-   <span data-ttu-id="3641a-355">**FCI 的群集节点只能承载给定可用性组的一个副本：**  如果在 FCI 上添加可用性副本，作为 FCI 的可能所有者的 WSFC 群集节点不能承载同一个可用性组的另一个副本。</span><span class="sxs-lookup"><span data-stu-id="3641a-355">**The cluster nodes of an FCI can host only one replica for a given availability group:**  If you add an availability replica on an FCI, the WSFC cluster nodes that are possible FCI owners cannot host another replica for the same availability group.</span></span>  
  
     <span data-ttu-id="3641a-356">此外，其他每个副本都必须由同一个 WSFC 群集中不同 WSFC 节点上驻留的 SQL Server 2012 实例承载。</span><span class="sxs-lookup"><span data-stu-id="3641a-356">Furthermore, every other replica must be hosted by an instance of SQL Server 2012 that resides on a different WSFC node in the same WSFC cluster.</span></span> <span data-ttu-id="3641a-357">唯一的例外是在迁移到另一个 WSFC 群集时，此时一个可用性组可能会暂时跨两个群集。</span><span class="sxs-lookup"><span data-stu-id="3641a-357">The only exception is that while being migrated to another WSFC cluster, an availability group can temporarily straddle two clusters.</span></span>  
  
-   <span data-ttu-id="3641a-358">FCI 不支持可用性组自动故障转移：FCI 不支持通过可用性组来自动进行故障转移，因此只能为手动故障转移配置任何由 FCI 承载的可用性副本。</span><span class="sxs-lookup"><span data-stu-id="3641a-358">**FCIs do not support automatic failover by availability groups:**  FCIs do not support automatic failover by availability groups, so any availability replica that is hosted by an FCI can be configured for manual failover only.</span></span>  
  
-   <span data-ttu-id="3641a-359">**更改 FCI 网络名称：** 如果你需要更改托管可用性副本的 FCI 的网络名称，则需要从副本的可用性组中删除它，然后将它添加回可用性组中。</span><span class="sxs-lookup"><span data-stu-id="3641a-359">**Changing FCI network name:**  If you need to change the network name of an FCI that hosts an availability replica, you will need to remove the replica from its availability group and then add the replica back into the availability group.</span></span> <span data-ttu-id="3641a-360">您不能删除主副本，因此，如果您在重命名承载主副本的 FCI，则应故障转移到某一辅助副本，然后删除之前的主副本并将其添加回去。</span><span class="sxs-lookup"><span data-stu-id="3641a-360">You cannot remove the primary replica, so if you are renaming an FCI that is hosting the primary replica, you should fail over to a secondary replica and then remove the former primary replica and add it back.</span></span> <span data-ttu-id="3641a-361">请注意，重命名 FCI 可能会更改其数据库镜像端点的 URL。</span><span class="sxs-lookup"><span data-stu-id="3641a-361">Note that renaming an FCI might alter the URL of its database mirroring endpoint.</span></span> <span data-ttu-id="3641a-362">当您添加副本时，请确保指定当前端点的 URL。</span><span class="sxs-lookup"><span data-stu-id="3641a-362">When you add the replica ensure that you specify the current endpoint URL.</span></span>  
  
###  <a name="checklist-prerequisites-fcis"></a><a name="PrerequisitesFCI"></a><span data-ttu-id="3641a-363">清单：先决条件 (FCI)</span><span class="sxs-lookup"><span data-stu-id="3641a-363">Checklist: Prerequisites (FCIs)</span></span>  
  
||<span data-ttu-id="3641a-364">先决条件</span><span class="sxs-lookup"><span data-stu-id="3641a-364">Prerequisite</span></span>|<span data-ttu-id="3641a-365">链接</span><span class="sxs-lookup"><span data-stu-id="3641a-365">Link</span></span>|  
|-|------------------|----------|  
|<span data-ttu-id="3641a-366">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-366">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-367">在您使用 FCI 承载某一可用性副本之前，请确保系统管理员已安装了知识库文章 KB 976097 中介绍的 Windows Server 2008 修补程序。</span><span class="sxs-lookup"><span data-stu-id="3641a-367">Before you use an FCI to host an availability replica, ensure that your system administrator has installed the Windows Server 2008 hotfix described in Knowledge Base article KB 976097.</span></span> <span data-ttu-id="3641a-368">此修补程序使故障转移群集管理 Microsoft 管理控制台 (MMC) 管理单元支持仅在某些 WSFC 节点上提供的非对称存储共享磁盘。</span><span class="sxs-lookup"><span data-stu-id="3641a-368">This hotfix enables the Failover Cluster Management Microsoft Management Console (MMC) snap-in to support asymmetric storage-shared disks that are available on only some of the WSFC nodes.</span></span>|<span data-ttu-id="3641a-369">KB 976097：[向异步存储添加了修补程序以便支持运行 Windows Server 2008 或 Windows Server 2008 R2 的故障转移群集的故障转移群集管理 MMC 管理单元](https://support.microsoft.com/kb/976097)</span><span class="sxs-lookup"><span data-stu-id="3641a-369">KB 976097:  [Hotfix to add support for asymmetric storages to the Failover Cluster Management MMC snap-in for a failover cluster that is running Windows Server 2008 or Windows Server 2008 R2](https://support.microsoft.com/kb/976097)</span></span>|  
|<span data-ttu-id="3641a-370">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-370">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-371">请确保每个 SQL Server 故障转移群集实例 (FCI) 都拥有标准 SQL Server 故障转移群集实例安装所要求的共享存储。</span><span class="sxs-lookup"><span data-stu-id="3641a-371">Ensure that each SQL Server failover cluster instance (FCI) possesses the required shared storage as per standard SQL Server failover cluster instance installation.</span></span>||  
  
###  <a name="related-tasks-fcis"></a><a name="RelatedTasksFCIs"></a> <span data-ttu-id="3641a-372">相关任务 (FCI)</span><span class="sxs-lookup"><span data-stu-id="3641a-372">Related Tasks (FCIs)</span></span>  
  
|<span data-ttu-id="3641a-373">任务</span><span class="sxs-lookup"><span data-stu-id="3641a-373">Task</span></span>|<span data-ttu-id="3641a-374">主题</span><span class="sxs-lookup"><span data-stu-id="3641a-374">Topic</span></span>|  
|----------|-----------|  
|<span data-ttu-id="3641a-375">安装 SQL Server 故障转移群集</span><span class="sxs-lookup"><span data-stu-id="3641a-375">Installing a SQL Server Failover Cluster</span></span>|[<span data-ttu-id="3641a-376">创建新的 SQL Server 故障转移群集（安装程序）</span><span class="sxs-lookup"><span data-stu-id="3641a-376">Create a New SQL Server Failover Cluster &#40;Setup&#41;</span></span>](../../../sql-server/failover-clusters/install/create-a-new-sql-server-failover-cluster-setup.md)|  
|<span data-ttu-id="3641a-377">您的现有 SQL Server 故障转移群集的就地升级</span><span class="sxs-lookup"><span data-stu-id="3641a-377">In-place upgrade of your existing SQL Server Failover Cluster</span></span>|[<span data-ttu-id="3641a-378">升级 SQL Server 故障转移群集实例（安装程序）</span><span class="sxs-lookup"><span data-stu-id="3641a-378">Upgrade a SQL Server Failover Cluster Instance &#40;Setup&#41;</span></span>](../../../sql-server/failover-clusters/windows/upgrade-a-sql-server-failover-cluster-instance-setup.md)|  
|<span data-ttu-id="3641a-379">维护您的现有 SQL Server 故障转移群集</span><span class="sxs-lookup"><span data-stu-id="3641a-379">Maintaining your existing SQL Server Failover Cluster</span></span>|[<span data-ttu-id="3641a-380">在 SQL Server 故障转移群集中添加或删除节点（安装程序）</span><span class="sxs-lookup"><span data-stu-id="3641a-380">Add or Remove Nodes in a SQL Server Failover Cluster &#40;Setup&#41;</span></span>](../../../sql-server/failover-clusters/install/add-or-remove-nodes-in-a-sql-server-failover-cluster-setup.md)|  
  
###  <a name="related-content-fcis"></a><a name="RelatedContentFCIs"></a> <span data-ttu-id="3641a-381">相关内容 (FCI)</span><span class="sxs-lookup"><span data-stu-id="3641a-381">Related Content (FCIs)</span></span>  
  
-   [<span data-ttu-id="3641a-382">故障转移群集和 AlwaysOn 可用性组 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="3641a-382">Failover Clustering and AlwaysOn Availability Groups &#40;SQL Server&#41;</span></span>](failover-clustering-and-always-on-availability-groups-sql-server.md)  
  
-   [<span data-ttu-id="3641a-383">AlwaysOn 体系结构指南：使用故障转移群集实例和可用性组绑定高可用性和灾难恢复解决方案</span><span class="sxs-lookup"><span data-stu-id="3641a-383">AlwaysOn Architecture Guide: Building a High Availability and Disaster Recovery Solution by Using Failover Cluster Instances and Availability Groups</span></span>](https://technet.microsoft.com/library/jj215886.aspx)  
  
##  <a name="availability-group-prerequisites-and-restrictions"></a><a name="PrerequisitesForAGs"></a> <span data-ttu-id="3641a-384">可用性组先决条件和限制</span><span class="sxs-lookup"><span data-stu-id="3641a-384">Availability Group Prerequisites and Restrictions</span></span>  

  
###  <a name="restrictions-availability-groups"></a><a name="RestrictionsAG"></a> <span data-ttu-id="3641a-385">限制（可用性组）</span><span class="sxs-lookup"><span data-stu-id="3641a-385">Restrictions (Availability Groups)</span></span>  
  
-   <span data-ttu-id="3641a-386">**可用性副本必须由一个 WSFC 群集的不同节点承载：**  对于某个给定可用性组，可用性副本必须由在同一 WSFC 群集的不同节点上运行的服务器实例承载。</span><span class="sxs-lookup"><span data-stu-id="3641a-386">**Availability replicas must be hosted by different nodes of one WSFC cluster:**  For a given availability group, availability replicas must be hosted by server instances running on different nodes of the same WSFC cluster.</span></span> <span data-ttu-id="3641a-387">唯一的例外是在迁移到另一个 WSFC 群集时，此时一个可用性组可能会暂时跨两个群集。</span><span class="sxs-lookup"><span data-stu-id="3641a-387">The only exception is that while being migrated to another WSFC cluster, an availability group can temporarily straddle two clusters.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="3641a-388">同一物理计算机上的多个虚拟机可分别为同一可用性组承载可用性副本，因为每个虚拟机都充当一个单独的计算机。</span><span class="sxs-lookup"><span data-stu-id="3641a-388">Virtual machines on the same physical computer can each host an availability replica for the same availability group because each virtual machine acts as a separate computer.</span></span>  
  
-   <span data-ttu-id="3641a-389">**唯一的可用性组名称：**  每个可用性组名称在 WSFC 故障转移群集上必须唯一。</span><span class="sxs-lookup"><span data-stu-id="3641a-389">**Unique availability group name:**  Each availability group name must be unique on the WSFC cluster.</span></span> <span data-ttu-id="3641a-390">可用性组名称的最大长度为 128 个字符。</span><span class="sxs-lookup"><span data-stu-id="3641a-390">The maximum length for an availability group name is 128 characters.</span></span>  
  
-   <span data-ttu-id="3641a-391">**可用性副本：** 每个可用性组都支持一个主副本和最多八个辅助副本。</span><span class="sxs-lookup"><span data-stu-id="3641a-391">**Availability replicas:**  Each availability group supports one primary replica and up to eight secondary replicas.</span></span> <span data-ttu-id="3641a-392">所有副本都可在异步提交模式下运行，或最多三个副本可在同步提交模式下运行（具有两个同步辅助副本的一个主副本）。</span><span class="sxs-lookup"><span data-stu-id="3641a-392">All of the replicas can run under asynchronous-commit mode, or up to three of them can run under synchronous-commit mode (one primary replica with two synchronous secondary replicas).</span></span>  
  
-   <span data-ttu-id="3641a-393">每台计算机的可用性组和可用性数据库的最大数目：可以在计算机（VM 或物理机）上放置的数据库和可用性组的实际数目取决于硬件和工作负荷，但是没有强制限制。</span><span class="sxs-lookup"><span data-stu-id="3641a-393">**Maximum number of availability groups and availability databases per computer:** The actual number of databases and availability groups you can put on a computer (VM or physical) depends on the hardware and workload, but there is no enforced limit.</span></span> <span data-ttu-id="3641a-394">Microsoft 对每个物理计算机承载 10 个可用性组和 100 个数据库进行了广泛测试。</span><span class="sxs-lookup"><span data-stu-id="3641a-394">Microsoft has extensively tested with 10 AGs and 100 DBs per physical machine.</span></span> <span data-ttu-id="3641a-395">系统过载的信号可能包括但不限于工作线程用尽、AlwaysOn 系统视图和 DMV 响应时间很长和/或调度程序系统转储停滞。</span><span class="sxs-lookup"><span data-stu-id="3641a-395">Signs of overloaded systems can include, but are not limited to, worker thread exhaustion, slow response times for AlwaysOn system views and DMVs, and/or stalled dispatcher system dumps.</span></span> <span data-ttu-id="3641a-396">请务必用接近生产的工作负荷彻底测试您的环境，确保它可以应对您的应用程序 SLA 内的工作负荷蜂值。</span><span class="sxs-lookup"><span data-stu-id="3641a-396">Please make sure to thoroughly test your environment with a production-like workload to ensure it can handle peak workload capacity within your application SLAs.</span></span> <span data-ttu-id="3641a-397">考虑 SLA 时，确保考虑故障条件下的负荷以及期望的响应时间。</span><span class="sxs-lookup"><span data-stu-id="3641a-397">When considering SLAs be sure to consider load under failure conditions as well as expected response times.</span></span>  
  
-   <span data-ttu-id="3641a-398">**不要使用故障转移群集管理器来操作可用性组：**</span><span class="sxs-lookup"><span data-stu-id="3641a-398">**Do not use the Failover Cluster Manager to manipulate availability groups:**</span></span>  
  
     <span data-ttu-id="3641a-399">例如：</span><span class="sxs-lookup"><span data-stu-id="3641a-399">For example:</span></span>  
  
    -   <span data-ttu-id="3641a-400">不要更改任何可用性组属性，例如可能的所有者。</span><span class="sxs-lookup"><span data-stu-id="3641a-400">Do not change any availability group properties, such as the possible owners.</span></span>  
  
    -   <span data-ttu-id="3641a-401">不要使用故障转移群集管理器来故障转移可用性组。</span><span class="sxs-lookup"><span data-stu-id="3641a-401">Do not use the Failover Cluster Manager to fail over availability groups.</span></span> <span data-ttu-id="3641a-402">必须使用 [!INCLUDE[tsql](../../../includes/tsql-md.md)] 或 [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="3641a-402">You must use [!INCLUDE[tsql](../../../includes/tsql-md.md)] or [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)].</span></span>  
  
###  <a name="prerequisites-availability-groups"></a><a name="RequirementsAG"></a> <span data-ttu-id="3641a-403">先决条件（可用性组）</span><span class="sxs-lookup"><span data-stu-id="3641a-403">Prerequisites (Availability Groups)</span></span>  
 <span data-ttu-id="3641a-404">在创建或重新配置可用性组配置时，请确保您遵守以下要求。</span><span class="sxs-lookup"><span data-stu-id="3641a-404">When creating or reconfiguring an availability group configuration, ensure that you adhere to the following requirements.</span></span>  
  
||<span data-ttu-id="3641a-405">先决条件</span><span class="sxs-lookup"><span data-stu-id="3641a-405">Prerequisite</span></span>|<span data-ttu-id="3641a-406">说明</span><span class="sxs-lookup"><span data-stu-id="3641a-406">Description</span></span>|  
|-|------------------|-----------------|  
|<span data-ttu-id="3641a-407">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-407">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-408">如果您计划使用 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 故障转移群集实例 (FCI) 承载可用性副本，则请确保您理解 FCI 限制并且满足 FCI 要求。</span><span class="sxs-lookup"><span data-stu-id="3641a-408">If you plan to use a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover cluster instance (FCI) to host an availability replica, ensure that you understand the FCI restrictions and that the FCI requirements are met.</span></span>|<span data-ttu-id="3641a-409">[有关使用 SQL Server 故障转移群集实例 (FCI) 承载可用性副本的先决条件和限制](#FciArLimitations) （本主题的前面予以介绍）</span><span class="sxs-lookup"><span data-stu-id="3641a-409">[Prerequisites and Restrictions for Using a SQL Server Failover Cluster Instance (FCI) to Host an Availability Replica](#FciArLimitations) (earlier in this topic)</span></span>|  
  
###  <a name="security-availability-groups"></a><a name="SecurityAG"></a> <span data-ttu-id="3641a-410">安全性（可用性组）</span><span class="sxs-lookup"><span data-stu-id="3641a-410">Security (Availability Groups)</span></span>  
  
-   <span data-ttu-id="3641a-411">安全性是从 Windows Server 故障转移群集 (WSFC) 群集继承的。</span><span class="sxs-lookup"><span data-stu-id="3641a-411">Security is inherited from the Windows Server Failover Clustering (WSFC) cluster.</span></span> <span data-ttu-id="3641a-412">WSFC 在整个 WSFC 群集 API 粒度上提供了两个级别的用户安全性：</span><span class="sxs-lookup"><span data-stu-id="3641a-412">WSFC provides two levels of user security at granularity of entire WSFC cluster APIs:</span></span>  
  
    -   <span data-ttu-id="3641a-413">只读访问</span><span class="sxs-lookup"><span data-stu-id="3641a-413">Read-only access</span></span>  
  
    -   <span data-ttu-id="3641a-414">完全控制</span><span class="sxs-lookup"><span data-stu-id="3641a-414">Full control</span></span>  
  
         [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] <span data-ttu-id="3641a-415">需要完全控制，并且在 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 实例上启用 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 将向其提供对 WSFC 群集的完全控制（通过服务 SID）。</span><span class="sxs-lookup"><span data-stu-id="3641a-415">needs full control, and enabling [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] on an instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] gives it full control of the WSFC cluster (through Service SID).</span></span>  
  
         <span data-ttu-id="3641a-416">不能在 WSFC 故障转移群集管理器中直接添加或删除某一服务器实例的安全性。</span><span class="sxs-lookup"><span data-stu-id="3641a-416">You cannot directly add or remove security for a server instance in the WSFC Failover Cluster Manager.</span></span> <span data-ttu-id="3641a-417">若要管理 WSFC 安全性会话，请使用 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 配置管理器或 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]中等效的 WMI。</span><span class="sxs-lookup"><span data-stu-id="3641a-417">To manage WSFC security sessions, use the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Configuration Manager or the WMI equivalent from [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
-   <span data-ttu-id="3641a-418">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 的每个实例都必须具有访问注册表、群集等的权限。</span><span class="sxs-lookup"><span data-stu-id="3641a-418">Each instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] must have permissions to access the registry, cluster, and soforth.</span></span>  
  
-   <span data-ttu-id="3641a-419">我们建议您为承载 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 可用性副本的服务器实例之间的连接使用加密。</span><span class="sxs-lookup"><span data-stu-id="3641a-419">We recommend that you use encryption for connections between server instances that host [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] availability replicas.</span></span>  
  
#### <a name="permissions-availability-groups"></a><span data-ttu-id="3641a-420">权限（可用性组）</span><span class="sxs-lookup"><span data-stu-id="3641a-420">Permissions (Availability Groups)</span></span>  
  
|<span data-ttu-id="3641a-421">任务</span><span class="sxs-lookup"><span data-stu-id="3641a-421">Task</span></span>|<span data-ttu-id="3641a-422">所需的权限</span><span class="sxs-lookup"><span data-stu-id="3641a-422">Required Permissions</span></span>|  
|----------|--------------------------|  
|<span data-ttu-id="3641a-423">创建可用性组</span><span class="sxs-lookup"><span data-stu-id="3641a-423">Creating an availability group</span></span>|<span data-ttu-id="3641a-424">需要 **sysadmin** 固定服务器角色的成员资格，以及 CREATE AVAILABILITY GROUP 服务器权限、ALTER ANY AVAILABILITY GROUP 权限或 CONTROL SERVER 权限。</span><span class="sxs-lookup"><span data-stu-id="3641a-424">Requires membership in the **sysadmin** fixed server role and either CREATE AVAILABILITY GROUP server permission, ALTER ANY AVAILABILITY GROUP permission, or CONTROL SERVER permission.</span></span>|  
|<span data-ttu-id="3641a-425">更改可用性组</span><span class="sxs-lookup"><span data-stu-id="3641a-425">Altering an  availability group</span></span>|<span data-ttu-id="3641a-426">对可用性组要求 ALTER AVAILABILITY GROUP 权限、CONTROL AVAILABILITY GROUP 权限、ALTER ANY AVAILABILITY GROUP 权限或 CONTROL SERVER 权限。</span><span class="sxs-lookup"><span data-stu-id="3641a-426">Requires ALTER AVAILABILITY GROUP permission on the availability group, CONTROL AVAILABILITY GROUP permission, ALTER ANY AVAILABILITY GROUP permission, or CONTROL SERVER permission.</span></span><br /><br /> <span data-ttu-id="3641a-427">此外，将数据库联接到可用性组要求具有 **db_owner** 固定服务器角色的成员身份。</span><span class="sxs-lookup"><span data-stu-id="3641a-427">In addition, joining a database to an availability group requires membership in the **db_owner** fixed database role.</span></span>|  
|<span data-ttu-id="3641a-428">删除可用性组</span><span class="sxs-lookup"><span data-stu-id="3641a-428">Dropping/deleting an availability group</span></span>|<span data-ttu-id="3641a-429">对可用性组要求 ALTER AVAILABILITY GROUP 权限、CONTROL AVAILABILITY GROUP 权限、ALTER ANY AVAILABILITY GROUP 权限或 CONTROL SERVER 权限。</span><span class="sxs-lookup"><span data-stu-id="3641a-429">Requires ALTER AVAILABILITY GROUP permission on the availability group, CONTROL AVAILABILITY GROUP permission, ALTER ANY AVAILABILITY GROUP permission, or CONTROL SERVER permission.</span></span> <span data-ttu-id="3641a-430">若要删除并非在本地副本位置上承载的某一可用性组，您需要针对该可用性组的 CONTROL SERVER 权限或 CONTROL 权限。</span><span class="sxs-lookup"><span data-stu-id="3641a-430">To drop an availability group that is not hosted on the local replica location you need CONTROL SERVER permission or CONTROL permission on that Availability Group.</span></span>|  
  
###  <a name="related-tasks-availability-groups"></a><a name="RelatedTasksAGs"></a> <span data-ttu-id="3641a-431">相关任务（可用性组）</span><span class="sxs-lookup"><span data-stu-id="3641a-431">Related Tasks (Availability Groups)</span></span>  
  
|<span data-ttu-id="3641a-432">任务</span><span class="sxs-lookup"><span data-stu-id="3641a-432">Task</span></span>|<span data-ttu-id="3641a-433">主题</span><span class="sxs-lookup"><span data-stu-id="3641a-433">Topic</span></span>|  
|----------|-----------|  
|<span data-ttu-id="3641a-434">创建可用性组</span><span class="sxs-lookup"><span data-stu-id="3641a-434">Creating an availability group</span></span>|[<span data-ttu-id="3641a-435">使用可用性组（“新建可用性组”向导）</span><span class="sxs-lookup"><span data-stu-id="3641a-435">Use the Availability Group (New Availability Group Wizard)</span></span>](use-the-availability-group-wizard-sql-server-management-studio.md)<br /><br /> [<span data-ttu-id="3641a-436">创建可用性组 (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="3641a-436">Create an Availability Group (Transact-SQL)</span></span>](create-an-availability-group-transact-sql.md)<br /><br /> [<span data-ttu-id="3641a-437">创建可用性组 (SQL Server PowerShell)</span><span class="sxs-lookup"><span data-stu-id="3641a-437">Create an Availability Group (SQL Server PowerShell)</span></span>](../../../powershell/sql-server-powershell.md)<br /><br /> [<span data-ttu-id="3641a-438">在添加或修改可用性副本时指定终结点 URL (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="3641a-438">Specify the Endpoint URL When Adding or Modifying an Availability Replica &#40;SQL Server&#41;</span></span>](specify-endpoint-url-adding-or-modifying-availability-replica.md)|  
|<span data-ttu-id="3641a-439">修改可用性副本的数目</span><span class="sxs-lookup"><span data-stu-id="3641a-439">Modifying the number of availability replicas</span></span>|[<span data-ttu-id="3641a-440">将辅助副本添加到可用性组 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="3641a-440">Add a Secondary Replica to an Availability Group &#40;SQL Server&#41;</span></span>](add-a-secondary-replica-to-an-availability-group-sql-server.md)<br /><br /> [<span data-ttu-id="3641a-441">将辅助副本联接到可用性组 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="3641a-441">Join a Secondary Replica to an Availability Group &#40;SQL Server&#41;</span></span>](join-a-secondary-replica-to-an-availability-group-sql-server.md)<br /><br /> [<span data-ttu-id="3641a-442">将次要副本从可用性组删除 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="3641a-442">Remove a Secondary Replica from an Availability Group &#40;SQL Server&#41;</span></span>](remove-a-secondary-replica-from-an-availability-group-sql-server.md)|  
|<span data-ttu-id="3641a-443">创建可用性组侦听器</span><span class="sxs-lookup"><span data-stu-id="3641a-443">Creating an  availability group listener</span></span>|[<span data-ttu-id="3641a-444">创建或配置可用性组侦听程序 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="3641a-444">Create or Configure an Availability Group Listener &#40;SQL Server&#41;</span></span>](create-or-configure-an-availability-group-listener-sql-server.md)|  
|<span data-ttu-id="3641a-445">删除可用性组</span><span class="sxs-lookup"><span data-stu-id="3641a-445">Dropping an  availability group</span></span>|[<span data-ttu-id="3641a-446">删除可用性组 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="3641a-446">Remove an Availability Group &#40;SQL Server&#41;</span></span>](remove-an-availability-group-sql-server.md)|  
  
##  <a name="availability-database-prerequisites-and-restrictions"></a><a name="PrerequisitesForDbs"></a> <span data-ttu-id="3641a-447">可用性数据库先决条件和限制</span><span class="sxs-lookup"><span data-stu-id="3641a-447">Availability Database Prerequisites and Restrictions</span></span>  
 <span data-ttu-id="3641a-448">若要符合添加到可用性组的条件，数据库必须满足以下先决条件和限制。</span><span class="sxs-lookup"><span data-stu-id="3641a-448">To be eligible to be added to an availability group, a database must meet the following prerequisites and restrictions.</span></span>  
  
 
  
###  <a name="checklist-requirements-availability-databases"></a><a name="RequirementsDb"></a><span data-ttu-id="3641a-449">清单：要求（可用性数据库）</span><span class="sxs-lookup"><span data-stu-id="3641a-449">Checklist: Requirements (Availability Databases)</span></span>  
 <span data-ttu-id="3641a-450">为了符合添加到可用性组的条件，数据库必须：</span><span class="sxs-lookup"><span data-stu-id="3641a-450">To be eligible to be added to an availability group, a database must:</span></span>  
  
||<span data-ttu-id="3641a-451">要求</span><span class="sxs-lookup"><span data-stu-id="3641a-451">Requirements</span></span>|<span data-ttu-id="3641a-452">链接</span><span class="sxs-lookup"><span data-stu-id="3641a-452">Link</span></span>|  
|-|------------------|----------|  
|<span data-ttu-id="3641a-453">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-453">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-454">是用户数据库。</span><span class="sxs-lookup"><span data-stu-id="3641a-454">Be a user database.</span></span> <span data-ttu-id="3641a-455">系统数据库无法属于可用性组。</span><span class="sxs-lookup"><span data-stu-id="3641a-455">System databases cannot belong to an availability group.</span></span>||  
|<span data-ttu-id="3641a-456">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-456">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-457">驻留在您在其中创建可用性组并且对于服务器实例可访问的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例上。</span><span class="sxs-lookup"><span data-stu-id="3641a-457">Reside on the instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] where you create the availability group and be accessible to the server instance.</span></span>||  
|<span data-ttu-id="3641a-458">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-458">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-459">是读写数据库。</span><span class="sxs-lookup"><span data-stu-id="3641a-459">Be a read-write database.</span></span> <span data-ttu-id="3641a-460">只读数据库不能添加到可用性组。</span><span class="sxs-lookup"><span data-stu-id="3641a-460">Read-only databases cannot be added to an availability group.</span></span>|<span data-ttu-id="3641a-461">[sys.databases](/sql/relational-databases/system-catalog-views/sys-databases-transact-sql) (**is_read_only** = 0)</span><span class="sxs-lookup"><span data-stu-id="3641a-461">[sys.databases](/sql/relational-databases/system-catalog-views/sys-databases-transact-sql) (**is_read_only** = 0)</span></span>|  
|<span data-ttu-id="3641a-462">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-462">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-463">是多用户数据库。</span><span class="sxs-lookup"><span data-stu-id="3641a-463">Be a multi-user database.</span></span>|<span data-ttu-id="3641a-464">[sys.databases](/sql/relational-databases/system-catalog-views/sys-databases-transact-sql) (**user_access** = 0)</span><span class="sxs-lookup"><span data-stu-id="3641a-464">[sys.databases](/sql/relational-databases/system-catalog-views/sys-databases-transact-sql) (**user_access** = 0)</span></span>|  
|<span data-ttu-id="3641a-465">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-465">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-466">未使用 AUTO_CLOSE。</span><span class="sxs-lookup"><span data-stu-id="3641a-466">Not use AUTO_CLOSE.</span></span>|<span data-ttu-id="3641a-467">[sys.databases](/sql/relational-databases/system-catalog-views/sys-databases-transact-sql) (**is_auto_close_on** = 0)</span><span class="sxs-lookup"><span data-stu-id="3641a-467">[sys.databases](/sql/relational-databases/system-catalog-views/sys-databases-transact-sql) (**is_auto_close_on** = 0)</span></span>|  
|<span data-ttu-id="3641a-468">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-468">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-469">使用完整恢复模式。</span><span class="sxs-lookup"><span data-stu-id="3641a-469">Use the full recovery model (also known as, full recovery mode).</span></span>|<span data-ttu-id="3641a-470">[sys.databases](/sql/relational-databases/system-catalog-views/sys-databases-transact-sql) (**recovery_model** = 1)</span><span class="sxs-lookup"><span data-stu-id="3641a-470">[sys.databases](/sql/relational-databases/system-catalog-views/sys-databases-transact-sql) (**recovery_model** = 1)</span></span>|  
|<span data-ttu-id="3641a-471">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-471">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-472">拥有至少一个完整的数据库备份。</span><span class="sxs-lookup"><span data-stu-id="3641a-472">Possess at least one full database backup.</span></span><br /><br /> <span data-ttu-id="3641a-473">注意：将数据库设置为完整恢复模式之后，将需要一个完整的备份来启动完整恢复日志链。</span><span class="sxs-lookup"><span data-stu-id="3641a-473">Note: After setting a database to full recovery mode, a full backup is required to initiate the full-recovery log chain.</span></span>|[<span data-ttu-id="3641a-474">创建完整数据库备份 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="3641a-474">Create a Full Database Backup &#40;SQL Server&#41;</span></span>](../../../relational-databases/backup-restore/create-a-full-database-backup-sql-server.md)|  
|<span data-ttu-id="3641a-475">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-475">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-476">不属于任何现有可用性组。</span><span class="sxs-lookup"><span data-stu-id="3641a-476">Not belong to any existing availability group.</span></span>|<span data-ttu-id="3641a-477">[sys.databases](/sql/relational-databases/system-catalog-views/sys-databases-transact-sql) (**group_database_id** = NULL)</span><span class="sxs-lookup"><span data-stu-id="3641a-477">[sys.databases](/sql/relational-databases/system-catalog-views/sys-databases-transact-sql) (**group_database_id** = NULL)</span></span>|  
|<span data-ttu-id="3641a-478">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-478">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-479">不是为数据库镜像配置的。</span><span class="sxs-lookup"><span data-stu-id="3641a-479">Not be configured for database mirroring.</span></span>|<span data-ttu-id="3641a-480">[sys.database_mirroring](/sql/relational-databases/system-catalog-views/sys-database-mirroring-transact-sql) （如果数据库未参与镜像，则所有带有“mirroring_”前缀的列将为 NULL。）</span><span class="sxs-lookup"><span data-stu-id="3641a-480">[sys.database_mirroring](/sql/relational-databases/system-catalog-views/sys-database-mirroring-transact-sql) (If the database does not participate in mirroring, all columns prefixed with "mirroring_" are NULL.)</span></span>|  
|<span data-ttu-id="3641a-481">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-481">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-482">在将使用 FILESTREAM 的数据库添加到某一可用性组之前，请确保在承载或将承载该可用性组的可用性副本的每个服务器实例上都启用 FILESTREAM。</span><span class="sxs-lookup"><span data-stu-id="3641a-482">Before adding a database that uses FILESTREAM to an availability group, ensure that FILESTREAM is enabled on every server instance that hosts or will host an availability replica for the availability group.</span></span>|[<span data-ttu-id="3641a-483">启用和配置 FILESTREAM</span><span class="sxs-lookup"><span data-stu-id="3641a-483">Enable and Configure FILESTREAM</span></span>](../../../relational-databases/blob/enable-and-configure-filestream.md)|  
|<span data-ttu-id="3641a-484">![复选框](../../media/checkboxemptycenterxtraspacetopandright.gif "复选框")</span><span class="sxs-lookup"><span data-stu-id="3641a-484">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="3641a-485">在将包含的数据库添加到某一可用性组之前，请确保在将承载该可用性组的可用性副本的每个服务器实例上 `contained database authentication` 服务器选项都设置为 `1`。</span><span class="sxs-lookup"><span data-stu-id="3641a-485">Before adding a contained database to an availability group, ensure that the `contained database authentication` server option is set to `1` on every server instance that hosts or will host an availability replica for the availability group.</span></span>|[<span data-ttu-id="3641a-486">contained database authentication 服务器配置选项</span><span class="sxs-lookup"><span data-stu-id="3641a-486">contained database authentication Server Configuration Option</span></span>](../../configure-windows/contained-database-authentication-server-configuration-option.md)<br /><br /> [<span data-ttu-id="3641a-487">服务器配置选项 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="3641a-487">Server Configuration Options &#40;SQL Server&#41;</span></span>](../../configure-windows/server-configuration-options-sql-server.md)|  
  
> [!NOTE]  
>  [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]<span data-ttu-id="3641a-488">可使用任何受支持的数据库兼容性级别。</span><span class="sxs-lookup"><span data-stu-id="3641a-488">works with any supported database compatibility level.</span></span>  
  
###  <a name="restrictions-availability-databases"></a><a name="RestrictionsDb"></a> <span data-ttu-id="3641a-489">限制（可用性数据库）</span><span class="sxs-lookup"><span data-stu-id="3641a-489">Restrictions (Availability Databases)</span></span>  
  
-   <span data-ttu-id="3641a-490">如果辅助数据库的文件路径（包括驱动器号）不同于相应主数据库的路径，则以下限制适用：</span><span class="sxs-lookup"><span data-stu-id="3641a-490">If the file path (including the drive letter) of a secondary database differs from the path of the corresponding primary database, the following restrictions apply:</span></span>  
  
    -   <span data-ttu-id="3641a-491">[!INCLUDE[ssAoNewAgWiz](../../../includes/ssaonewagwiz-md.md)]/[!INCLUDE[ssAoAddDbWiz](../../../includes/ssaoadddbwiz-md.md)]：不支持“完全”选项（在[选择初始数据同步页](select-initial-data-synchronization-page-always-on-availability-group-wizards.md)页面上），</span><span class="sxs-lookup"><span data-stu-id="3641a-491">**[!INCLUDE[ssAoNewAgWiz](../../../includes/ssaonewagwiz-md.md)]/[!INCLUDE[ssAoAddDbWiz](../../../includes/ssaoadddbwiz-md.md)]:**  The **Full** option is not supported (on the[Select Initial Data Synchronization Page](select-initial-data-synchronization-page-always-on-availability-group-wizards.md) page),</span></span>  
  
    -   <span data-ttu-id="3641a-492">**RESTORE WITH MOVE：** 若要创建辅助数据库，在承载辅助副本的每个 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例上数据库文件必须是 RESTORED WITH MOVE。</span><span class="sxs-lookup"><span data-stu-id="3641a-492">**RESTORE WITH MOVE:**  To create the secondary databases, the database files must be RESTORED WITH MOVE on each instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] that hosts a secondary replica.</span></span>  
  
    -   <span data-ttu-id="3641a-493">对添加文件操作的影响：以后针对主要副本的添加文件操作在辅助数据库上可能会失败。</span><span class="sxs-lookup"><span data-stu-id="3641a-493">**Impact on add-file operations:**  A later add-file operation on the primary replica might fail on the secondary databases.</span></span> <span data-ttu-id="3641a-494">此失败可能导致辅助数据库暂停。</span><span class="sxs-lookup"><span data-stu-id="3641a-494">This failure could cause the secondary databases to be suspended.</span></span> <span data-ttu-id="3641a-495">而这又会导致辅助副本进入“非同步”状态。</span><span class="sxs-lookup"><span data-stu-id="3641a-495">This, in turn, causes the secondary replicas to enter the NOT SYNCHRONIZING state.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="3641a-496">有关如何处理失败的添加文件操作的详细信息，请参阅[解决失败的添加文件操作问题（AlwaysOn 可用性组）](troubleshoot-a-failed-add-file-operation-always-on-availability-groups.md)。</span><span class="sxs-lookup"><span data-stu-id="3641a-496">For information about responding to a failed ad-file operation, see [Troubleshoot a Failed Add-File Operation &#40;AlwaysOn Availability Groups&#41;](troubleshoot-a-failed-add-file-operation-always-on-availability-groups.md).</span></span>  
  
-   <span data-ttu-id="3641a-497">您不能删除当前属于可用性组的数据库。</span><span class="sxs-lookup"><span data-stu-id="3641a-497">You cannot drop a database that currently belongs to an availability group.</span></span>  
  
###  <a name="follow-up-for-tde-protected-databases"></a><a name="TDEdbs"></a> <span data-ttu-id="3641a-498">关注受 TDE 保护的数据库</span><span class="sxs-lookup"><span data-stu-id="3641a-498">Follow Up for TDE Protected Databases</span></span>  
 <span data-ttu-id="3641a-499">如果使用透明数据加密 (TDE)，则用于创建和解密其他密钥的证书或非对称密钥在承载可用性组的可用性副本的每个服务器实例上必须相同。</span><span class="sxs-lookup"><span data-stu-id="3641a-499">If you use transparent data encryption (TDE), the certificate or asymmetric key for creating and decrypting other keys must be the same on every server instance that hosts an availability replica for the availability group.</span></span> <span data-ttu-id="3641a-500">有关详细信息，请参阅 [将受 TDE 保护的数据库移到其他 SQL Server](../../../relational-databases/security/encryption/move-a-tde-protected-database-to-another-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="3641a-500">For more information, see [Move a TDE Protected Database to Another SQL Server](../../../relational-databases/security/encryption/move-a-tde-protected-database-to-another-sql-server.md).</span></span>  
  
###  <a name="permissions-availability-databases"></a><a name="PermissionsDbs"></a> <span data-ttu-id="3641a-501">权限（可用性数据库）</span><span class="sxs-lookup"><span data-stu-id="3641a-501">Permissions (Availability Databases)</span></span>  
 <span data-ttu-id="3641a-502">需要对数据库拥有 ALTER 权限。</span><span class="sxs-lookup"><span data-stu-id="3641a-502">Requires ALTER permission on the database.</span></span>  
  
###  <a name="related-tasks-availability-databases"></a><a name="RelatedTasksADb"></a> <span data-ttu-id="3641a-503">相关任务（可用性数据库）</span><span class="sxs-lookup"><span data-stu-id="3641a-503">Related Tasks (Availability Databases)</span></span>  
  
|<span data-ttu-id="3641a-504">任务</span><span class="sxs-lookup"><span data-stu-id="3641a-504">Task</span></span>|<span data-ttu-id="3641a-505">主题</span><span class="sxs-lookup"><span data-stu-id="3641a-505">Topic</span></span>|  
|----------|-----------|  
|<span data-ttu-id="3641a-506">准备辅助数据库（手动）</span><span class="sxs-lookup"><span data-stu-id="3641a-506">Preparing a secondary database (manually)</span></span>|[<span data-ttu-id="3641a-507">为可用性组手动准备辅助数据库 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="3641a-507">Manually Prepare a Secondary Database for an Availability Group &#40;SQL Server&#41;</span></span>](manually-prepare-a-secondary-database-for-an-availability-group-sql-server.md)|  
|<span data-ttu-id="3641a-508">将辅助数据库联接到可用性组（手动）</span><span class="sxs-lookup"><span data-stu-id="3641a-508">Joining a secondary database to availability group (manually)</span></span>|[<span data-ttu-id="3641a-509">将辅助数据库联接到可用性组 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="3641a-509">Join a Secondary Database to an Availability Group &#40;SQL Server&#41;</span></span>](join-a-secondary-database-to-an-availability-group-sql-server.md)|  
|<span data-ttu-id="3641a-510">修改可用性数据库的数目</span><span class="sxs-lookup"><span data-stu-id="3641a-510">Modifying the number of availability databases</span></span>|[<span data-ttu-id="3641a-511">将数据库添加到可用性组 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="3641a-511">Add a Database to an Availability Group &#40;SQL Server&#41;</span></span>](availability-group-add-a-database.md)<br /><br /> [<span data-ttu-id="3641a-512">将辅助数据库从可用性组删除 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="3641a-512">Remove a Secondary Database from an Availability Group &#40;SQL Server&#41;</span></span>](remove-a-secondary-database-from-an-availability-group-sql-server.md)<br /><br /> [<span data-ttu-id="3641a-513">将主数据库从可用性组删除 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="3641a-513">Remove a Primary Database from an Availability Group &#40;SQL Server&#41;</span></span>](remove-a-primary-database-from-an-availability-group-sql-server.md)|  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="3641a-514">相关内容</span><span class="sxs-lookup"><span data-stu-id="3641a-514">Related Content</span></span>  
  
-   [<span data-ttu-id="3641a-515">用于高可用性和灾难恢复的 Microsoft SQL Server AlwaysOn 解决方案指南</span><span class="sxs-lookup"><span data-stu-id="3641a-515">Microsoft SQL Server AlwaysOn Solutions Guide for High Availability and Disaster Recovery</span></span>](https://go.microsoft.com/fwlink/?LinkId=227600)  
  
-   [<span data-ttu-id="3641a-516">SQL Server AlwaysOn 团队博客：SQL Server AlwaysOn 官方团队博客</span><span class="sxs-lookup"><span data-stu-id="3641a-516">SQL Server AlwaysOn Team Blog: The official SQL Server AlwaysOn Team Blog</span></span>](https://blogs.msdn.com/b/sqlalwayson/)  
  
-   [<span data-ttu-id="3641a-517">AlwaysON - HADRON 学习系列：启用了 HADRON 的数据库的工作线程池用法</span><span class="sxs-lookup"><span data-stu-id="3641a-517">AlwaysON - HADRON Learning Series: Worker Pool Usage for HADRON Enabled Databases</span></span>](https://blogs.msdn.com/b/psssql/archive/2012/05/17/alwayson-hadron-learning-series-worker-pool-usage-for-hadron-enabled-databases.aspx)  
  
## <a name="see-also"></a><span data-ttu-id="3641a-518">另请参阅</span><span class="sxs-lookup"><span data-stu-id="3641a-518">See Also</span></span>  
 <span data-ttu-id="3641a-519">[AlwaysOn 可用性组 &#40;SQL Server 概述&#41;](overview-of-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="3641a-519">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) </span></span>  
 <span data-ttu-id="3641a-520">[故障转移群集和 AlwaysOn 可用性组 &#40;SQL Server&#41;](failover-clustering-and-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="3641a-520">[Failover Clustering and AlwaysOn Availability Groups &#40;SQL Server&#41;](failover-clustering-and-always-on-availability-groups-sql-server.md) </span></span>  
 [<span data-ttu-id="3641a-521">AlwaysOn 客户端连接 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="3641a-521">AlwaysOn Client Connectivity (SQL Server)</span></span>](always-on-client-connectivity-sql-server.md)  
  
  
