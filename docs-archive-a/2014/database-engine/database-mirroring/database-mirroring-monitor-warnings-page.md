---
title: 数据库镜像监视器（“警告”页）| Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
f1_keywords:
- sql12.swb.dbmmonitor.warningsandalerts.f1
ms.assetid: 01936122-961d-436b-ba3c-5f79fefe5469
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: e7afc4ff0e6b69c70535ef39677f3d834edbee15
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87694127"
---
# <a name="database-mirroring-monitor-warnings-page"></a><span data-ttu-id="a53fc-102">数据库镜像监视器（警告页）</span><span class="sxs-lookup"><span data-stu-id="a53fc-102">Database Mirroring Monitor (Warnings Page)</span></span>
  <span data-ttu-id="a53fc-103">显示数据库镜像事件所支持警告的只读列表和指定的警告阈值（如果有）。</span><span class="sxs-lookup"><span data-stu-id="a53fc-103">Displays a read-only list of warnings supported on database mirroring events and the specified warning threshold values, if available.</span></span>  
  
 <span data-ttu-id="a53fc-104">**使用 SQL Server Management Studio 监视数据库镜像**</span><span class="sxs-lookup"><span data-stu-id="a53fc-104">**To use SQL Server Management Studio to monitor database mirroring**</span></span>  
  
-   [<span data-ttu-id="a53fc-105">启动数据库镜像监视器 (SQL Server Management Studio)</span><span class="sxs-lookup"><span data-stu-id="a53fc-105">Start Database Mirroring Monitor &#40;SQL Server Management Studio&#41;</span></span>](../database-mirroring/start-database-mirroring-monitor-sql-server-management-studio.md)  
  
## <a name="columns"></a><span data-ttu-id="a53fc-106">列</span><span class="sxs-lookup"><span data-stu-id="a53fc-106">Columns</span></span>  
 <span data-ttu-id="a53fc-107">**警告**</span><span class="sxs-lookup"><span data-stu-id="a53fc-107">**Warning**</span></span>  
 <span data-ttu-id="a53fc-108">可以定义阈值的警告包括：</span><span class="sxs-lookup"><span data-stu-id="a53fc-108">The warnings for which you can define a threshold include:</span></span>  
  
|<span data-ttu-id="a53fc-109">警告</span><span class="sxs-lookup"><span data-stu-id="a53fc-109">Warning</span></span>|<span data-ttu-id="a53fc-110">阈值</span><span class="sxs-lookup"><span data-stu-id="a53fc-110">Threshold</span></span>|  
|-------------|---------------|  
|<span data-ttu-id="a53fc-111">**如果未发送日志超出了阈值，则发出警告**</span><span class="sxs-lookup"><span data-stu-id="a53fc-111">**Warn if the unsent log exceeds the threshold**</span></span>|<span data-ttu-id="a53fc-112">指定未发送日志达到多少 KB 后，会在主体服务器实例上生成一个警告。</span><span class="sxs-lookup"><span data-stu-id="a53fc-112">Specifies how many kilobytes (KB) of unsent log will generate a warning on the principal server instance.</span></span> <span data-ttu-id="a53fc-113">该警告有助于测量数据丢失的可能性（以 KB 计），并且特别适用于高性能模式。</span><span class="sxs-lookup"><span data-stu-id="a53fc-113">This warning helps measure the potential for data loss in terms of KB, and is particularly relevant for high-performance mode.</span></span> <span data-ttu-id="a53fc-114">但是，当镜像因伙伴断开连接而暂停或挂起时，该警告也适用于高安全模式。</span><span class="sxs-lookup"><span data-stu-id="a53fc-114">However, the warning is also relevant for high-safety mode when mirroring is paused or suspended because the partners become disconnected.</span></span>|  
|<span data-ttu-id="a53fc-115">**如果未还原日志超出了阈值，则发出警告**</span><span class="sxs-lookup"><span data-stu-id="a53fc-115">**Warn if the unrestored log exceeds the threshold**</span></span>|<span data-ttu-id="a53fc-116">指定未还原日志达到多少 KB 后，会在镜像服务器实例上生成一个警告。</span><span class="sxs-lookup"><span data-stu-id="a53fc-116">Specifies how many KB of unrestored log will generate a warning on the mirror server instance.</span></span> <span data-ttu-id="a53fc-117">该警告可用于测量故障转移时间（以 KB 计）。</span><span class="sxs-lookup"><span data-stu-id="a53fc-117">This warning is useful for measuring failover time in terms of kilobytes.</span></span> <span data-ttu-id="a53fc-118">“故障转移时间 ”主要包括前一个镜像服务器前滚其重做队列中剩余的任意日志所需的时间，以及一小段额外时间。</span><span class="sxs-lookup"><span data-stu-id="a53fc-118">*Failover time* consists mainly of the time that the former mirror server requires to roll forward any log remaining in its redo queue, plus a short additional time.</span></span><br /><br /> <span data-ttu-id="a53fc-119">注意：对于自动故障转移，系统识别错误所需的时间与故障转移时间无关。</span><span class="sxs-lookup"><span data-stu-id="a53fc-119">Note: For an automatic failover, the time for the system to notice the error is independent of the failover time.</span></span><br /><br /> <span data-ttu-id="a53fc-120">有关详细信息，请参阅 [估计在角色切换期间服务的中断（数据库镜像）](estimate-the-interruption-of-service-during-role-switching-database-mirroring.md)。</span><span class="sxs-lookup"><span data-stu-id="a53fc-120">For more information, see [Estimate the Interruption of Service During Role Switching &#40;Database Mirroring&#41;](estimate-the-interruption-of-service-during-role-switching-database-mirroring.md).</span></span>|  
|<span data-ttu-id="a53fc-121">**如果最早的未发送事务的保留时间超出了阈值，则发出警告**</span><span class="sxs-lookup"><span data-stu-id="a53fc-121">**Warn if the age of the oldest unsent transaction exceeds the threshold**</span></span>|<span data-ttu-id="a53fc-122">指定在主体服务器实例上生成警告之前，发送队列中可以累积的事务的分钟数。</span><span class="sxs-lookup"><span data-stu-id="a53fc-122">Specifies the number of minutes worth of transactions that can accumulate in the send queue before a warning is generated on the principal server instance.</span></span> <span data-ttu-id="a53fc-123">该警告有助于测量数据丢失的可能性（以时间计），并且特别适用于高性能模式。</span><span class="sxs-lookup"><span data-stu-id="a53fc-123">This warning helps measure the potential for data loss in terms of time, and is particularly relevant for high-performance mode.</span></span> <span data-ttu-id="a53fc-124">但是，当镜像因伙伴断开连接而暂停或挂起时，该警告也适用于高安全模式。</span><span class="sxs-lookup"><span data-stu-id="a53fc-124">However, the warning is also relevant for high-safety mode when mirroring is paused or suspended because the partners become disconnected.</span></span>|  
|<span data-ttu-id="a53fc-125">**如果镜像提交开销超过了阈值则发出警告**</span><span class="sxs-lookup"><span data-stu-id="a53fc-125">**Warn if the mirror commit overhead exceeds the threshold**</span></span>|<span data-ttu-id="a53fc-126">指定在主体服务器上生成警告之前，每个事务可允许的平均延迟的毫秒数。</span><span class="sxs-lookup"><span data-stu-id="a53fc-126">Specifies the number of milliseconds of average delay per transaction tolerated before a warning is generated on the principal server.</span></span> <span data-ttu-id="a53fc-127">此延迟是主体服务器实例等待镜像服务器实例将事务日志记录写入重做队列时，所发生的开销量。</span><span class="sxs-lookup"><span data-stu-id="a53fc-127">This delay is the amount of overhead incurred while the principal server instance waits for the mirror server instance to write the transaction's log record into the redo queue.</span></span> <span data-ttu-id="a53fc-128">该值只适用于高安全模式。</span><span class="sxs-lookup"><span data-stu-id="a53fc-128">This value is relevant only in high-safety mode.</span></span>|  
  
 <span data-ttu-id="a53fc-129">**“** _<server_instance>_ **”处的阈值**</span><span class="sxs-lookup"><span data-stu-id="a53fc-129">**Threshold at '** _<server_instance>_ **'**</span></span>  
 <span data-ttu-id="a53fc-130">针对每个警告，显示一个服务器实例的当前的用户指定阈值（如果存在）。</span><span class="sxs-lookup"><span data-stu-id="a53fc-130">For each of the warnings, displays the current user-specified threshold, if any, for one of the server instances.</span></span> <span data-ttu-id="a53fc-131">该服务器实例的完整实例名在对应的列标题中指定。</span><span class="sxs-lookup"><span data-stu-id="a53fc-131">The full instance name of the server instance is indicated in the corresponding column heading.</span></span>  
  
 <span data-ttu-id="a53fc-132">有关详细信息，请参阅本主题后面的“备注”。</span><span class="sxs-lookup"><span data-stu-id="a53fc-132">For more information, see "Remarks," later in this topic.</span></span>  
  
 <span data-ttu-id="a53fc-133">**设置阈值**</span><span class="sxs-lookup"><span data-stu-id="a53fc-133">**Set Thresholds**</span></span>  
 <span data-ttu-id="a53fc-134">单击此按钮可为每个故障转移合作伙伴的一个警告设置阈值。</span><span class="sxs-lookup"><span data-stu-id="a53fc-134">Click this button to set a threshold for one warning on each of the failover partners.</span></span>  
  
 <span data-ttu-id="a53fc-135">有关详细信息，请参阅本主题后面的“备注”。</span><span class="sxs-lookup"><span data-stu-id="a53fc-135">For more information, see "Remarks," later in this topic.</span></span>  
  
## <a name="remarks"></a><span data-ttu-id="a53fc-136">备注</span><span class="sxs-lookup"><span data-stu-id="a53fc-136">Remarks</span></span>  
 <span data-ttu-id="a53fc-137">如果服务器实例的信息目前不可用，则相应 **“阈值”** 列的单元格将显示灰色背景和水印文本。</span><span class="sxs-lookup"><span data-stu-id="a53fc-137">If information is currently unavailable for a server instance, the cells of the corresponding **Threshold at** column display a gray background and watermark text.</span></span> <span data-ttu-id="a53fc-138">如果监视器未与服务器实例连接，则网格将根据实例是默认实例还是命名实例，在每个单元格中显示“未连接到 _<SYSTEM_NAME>_ ”或“未连接到 _<SYSTEM_NAME>_ \\ _<instance_name>_ ”  。</span><span class="sxs-lookup"><span data-stu-id="a53fc-138">If the monitor is not connected to the server instance, in every cell the grid displays either **Not connected to** _<SYSTEM_NAME>_ or **Not connected to** _<SYSTEM_NAME>_**\\**_<instance_name>_, depending on whether the instance is the default instance or a named instance.</span></span> <span data-ttu-id="a53fc-139">如果监视器正在等待返回查询，那么每个单元格中的网格都将显示“等待数据...”。</span><span class="sxs-lookup"><span data-stu-id="a53fc-139">If the monitor is waiting for a query to return, the grid displays **Waiting for data...** in every cell.</span></span>  
  
 <span data-ttu-id="a53fc-140">当信息可用时，每个警告的单元格将会显示指定的阈值（和度量单位）或“未启用”。</span><span class="sxs-lookup"><span data-stu-id="a53fc-140">When information is available, the cell for each warning displays either a specified threshold value (and unit of measurement), or **Not enabled**.</span></span>  
  
 <span data-ttu-id="a53fc-141">如果在状态表刷新时超出阈值，则会在记录状态行时将一个事件记录到 Windows 事件日志中。</span><span class="sxs-lookup"><span data-stu-id="a53fc-141">If a threshold is exceeded at the time the status table is refreshed, an event is logged to the Windows event log when the status row is recorded.</span></span> <span data-ttu-id="a53fc-142">默认情况下，如果监视器未运行，则每分钟记录一次状态行。</span><span class="sxs-lookup"><span data-stu-id="a53fc-142">By default, the status row is recorded once a minute if the monitor is not running.</span></span> <span data-ttu-id="a53fc-143">可以使用 SQL Server 代理或其他程序（如 Microsoft Management Operations Manager (MOM)）对每种类型的记录事件配置警报。</span><span class="sxs-lookup"><span data-stu-id="a53fc-143">You can configure an alert on each type of logged event by using the SQL Server Agent or another program, such as Microsoft Management Operations Manager (MOM).</span></span>  
  
 <span data-ttu-id="a53fc-144">在给定的伙伴上，记录的事件取决于它当前的角色，即主体或镜像。</span><span class="sxs-lookup"><span data-stu-id="a53fc-144">On a given partner, the events logged depend on its current role, principal or mirror.</span></span> <span data-ttu-id="a53fc-145">但是，我们建议您在两个伙伴中都为给定的事件设置警告阈值，以确保数据库进行故障转移时警告仍然存在。</span><span class="sxs-lookup"><span data-stu-id="a53fc-145">However, we recommend that you set a warning threshold for a given event on both partners to ensure that the warning persists if the database fails over.</span></span> <span data-ttu-id="a53fc-146">每个伙伴的相应阈值取决于伙伴系统的性能。</span><span class="sxs-lookup"><span data-stu-id="a53fc-146">The appropriate threshold for each partner depends on the performance capabilities of that partner's system.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="a53fc-147">也可以使用“sp_dbmmonitorchangealertt”系统存储过程来为等价的事件（如未发送日志、未恢复日志、最早的未发送事务和镜像提交开销）配置阈值。</span><span class="sxs-lookup"><span data-stu-id="a53fc-147">You can also use the **sp_dbmmonitorchangealert** system stored procedure to configure thresholds for the equivalent events-unsent log, unrecovered log, oldest unsent transaction, and mirror commit overhead.</span></span> <span data-ttu-id="a53fc-148">有关详细信息，请参阅 [sp_dbmmonitorchangealert & #40;Transact SQL & #41;](/sql/relational-databases/system-stored-procedures/sp-dbmmonitorchangealert-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="a53fc-148">For more information, see [sp_dbmmonitorchangealert &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-dbmmonitorchangealert-transact-sql).</span></span>  
  
 <span data-ttu-id="a53fc-149">下表显示与每个警告关联的事件 ID。</span><span class="sxs-lookup"><span data-stu-id="a53fc-149">The following table shows the event ID associated with each warning.</span></span>  
  
|<span data-ttu-id="a53fc-150">数据库镜像监视器警告</span><span class="sxs-lookup"><span data-stu-id="a53fc-150">Database Mirroring Monitor warning</span></span>|<span data-ttu-id="a53fc-151">事件名称</span><span class="sxs-lookup"><span data-stu-id="a53fc-151">Event name</span></span>|<span data-ttu-id="a53fc-152">事件 ID</span><span class="sxs-lookup"><span data-stu-id="a53fc-152">Event ID</span></span>|  
|----------------------------------------|----------------|--------------|  
|<span data-ttu-id="a53fc-153">**如果未发送日志超出了阈值，则发出警告**</span><span class="sxs-lookup"><span data-stu-id="a53fc-153">**Warn if the unsent log exceeds the threshold**</span></span>|<span data-ttu-id="a53fc-154">未发送日志</span><span class="sxs-lookup"><span data-stu-id="a53fc-154">Unsent log</span></span>|<span data-ttu-id="a53fc-155">32042</span><span class="sxs-lookup"><span data-stu-id="a53fc-155">32042</span></span>|  
|<span data-ttu-id="a53fc-156">**如果未还原日志超出了阈值，则发出警告**</span><span class="sxs-lookup"><span data-stu-id="a53fc-156">**Warn if the unrestored log exceeds the threshold**</span></span>|<span data-ttu-id="a53fc-157">未还原日志</span><span class="sxs-lookup"><span data-stu-id="a53fc-157">Unrestored log</span></span>|<span data-ttu-id="a53fc-158">32043</span><span class="sxs-lookup"><span data-stu-id="a53fc-158">32043</span></span>|  
|<span data-ttu-id="a53fc-159">**如果最早的未发送事务的保留时间超出了阈值，则发出警告**</span><span class="sxs-lookup"><span data-stu-id="a53fc-159">**Warn if the age of the oldest unsent transaction exceeds the threshold**</span></span>|<span data-ttu-id="a53fc-160">最早的未发送事务</span><span class="sxs-lookup"><span data-stu-id="a53fc-160">Oldest unsent transaction</span></span>|<span data-ttu-id="a53fc-161">32044</span><span class="sxs-lookup"><span data-stu-id="a53fc-161">32044</span></span>|  
|<span data-ttu-id="a53fc-162">**如果镜像提交开销超过了阈值则发出警告**</span><span class="sxs-lookup"><span data-stu-id="a53fc-162">**Warn if the mirror commit overhead exceeds the threshold**</span></span>|<span data-ttu-id="a53fc-163">镜像提交开销</span><span class="sxs-lookup"><span data-stu-id="a53fc-163">Mirror commit overhead</span></span>|<span data-ttu-id="a53fc-164">32045</span><span class="sxs-lookup"><span data-stu-id="a53fc-164">32045</span></span>|  
  
## <a name="permissions"></a><span data-ttu-id="a53fc-165">权限</span><span class="sxs-lookup"><span data-stu-id="a53fc-165">Permissions</span></span>  
 <span data-ttu-id="a53fc-166">若要拥有完全访问权限，需要具有 **sysadmin** 固定服务器角色的成员身份。</span><span class="sxs-lookup"><span data-stu-id="a53fc-166">For full access, requires membership in the **sysadmin** fixed server role.</span></span> <span data-ttu-id="a53fc-167">只有 **sysadmin** 的成员才可以配置和查看关键绩效指标的警告阈值。</span><span class="sxs-lookup"><span data-stu-id="a53fc-167">Only members of **sysadmin** can configure and view warning thresholds for key performance metrics.</span></span>  
  
 <span data-ttu-id="a53fc-168">如果是 **dbm_monitor** 角色中的成员，则只能查看“警告”页上最新的状态行。</span><span class="sxs-lookup"><span data-stu-id="a53fc-168">Membership in the **dbm_monitor** role enables you to view only the most recent status row on the **Warnings** Page.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a53fc-169">另请参阅</span><span class="sxs-lookup"><span data-stu-id="a53fc-169">See Also</span></span>  
 <span data-ttu-id="a53fc-170">[启动数据库镜像监视器 (SQL Server Management Studio)](../database-mirroring/start-database-mirroring-monitor-sql-server-management-studio.md) </span><span class="sxs-lookup"><span data-stu-id="a53fc-170">[Start Database Mirroring Monitor &#40;SQL Server Management Studio&#41;](../database-mirroring/start-database-mirroring-monitor-sql-server-management-studio.md) </span></span>  
 <span data-ttu-id="a53fc-171">[监视数据库镜像 (SQL Server)](database-mirroring-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="a53fc-171">[Monitoring Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md) </span></span>  
 [<span data-ttu-id="a53fc-172">启动配置数据库镜像安全向导 (SQL Server Management Studio)</span><span class="sxs-lookup"><span data-stu-id="a53fc-172">Start the Configuring Database Mirroring Security Wizard &#40;SQL Server Management Studio&#41;</span></span>](start-the-configuring-database-mirroring-security-wizard.md)  
  
  
