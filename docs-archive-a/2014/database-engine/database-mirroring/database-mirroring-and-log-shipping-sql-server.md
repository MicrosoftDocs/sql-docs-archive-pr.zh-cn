---
title: 数据库镜像和日志传送 (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- database mirroring [SQL Server], interoperability
- log shipping [SQL Server], database mirroring
ms.assetid: 53e98134-e274-4dfd-8b72-0cc0fd5c800e
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: fe11f4244eff98923a6f4ee291caca9c094237f4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87579763"
---
# <a name="database-mirroring-and-log-shipping-sql-server"></a><span data-ttu-id="f859a-102">数据库镜像和日志传送 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="f859a-102">Database Mirroring and Log Shipping (SQL Server)</span></span>
  <span data-ttu-id="f859a-103">可以镜像或使用日志传送给定的数据库；也可以同时镜像并使用日志传送该数据库。</span><span class="sxs-lookup"><span data-stu-id="f859a-103">A given database can be mirrored or log shipped; it can also be simultaneously mirrored and log shipped.</span></span> <span data-ttu-id="f859a-104">若要选择使用的方法，请考虑下列事项：</span><span class="sxs-lookup"><span data-stu-id="f859a-104">To choose what approach to use, consider the following:</span></span>  
  
-   <span data-ttu-id="f859a-105">需要多少个目标服务器？</span><span class="sxs-lookup"><span data-stu-id="f859a-105">How many destination servers do you require?</span></span>  
  
     <span data-ttu-id="f859a-106">如果只需要一个目标数据库，建议使用数据库镜像解决方案。</span><span class="sxs-lookup"><span data-stu-id="f859a-106">If you require only a single destination database, database mirroring is the recommended solution.</span></span>  
  
     <span data-ttu-id="f859a-107">如果需要多个目标数据库，则需要使用日志传送（可以单独使用，也可以与数据库镜像一起使用）。</span><span class="sxs-lookup"><span data-stu-id="f859a-107">If you require more than one destination database, you need to use log shipping, either alone or with database mirroring.</span></span> <span data-ttu-id="f859a-108">如果将这两种方法组合使用，就既能享有数据库镜像的好处，又能获得日志传送提供的多个目标数据库的支持。</span><span class="sxs-lookup"><span data-stu-id="f859a-108">Combining these approaches gives you the benefits of database mirroring along with the support for multiple destinations provided by log shipping.</span></span>  
  
-   <span data-ttu-id="f859a-109">如果需要延迟还原目标数据库的日志（通常是为了防止逻辑错误），请使用日志传送（可以单独使用，也可以与数据库镜像一起使用）。</span><span class="sxs-lookup"><span data-stu-id="f859a-109">If you need to delay restoring log on the destination database (typically, to protect against logical errors), use log shipping, alone or with database mirroring.</span></span>  
  
 <span data-ttu-id="f859a-110">本主题讨论组合使用日志传送和数据库镜像时的注意事项。</span><span class="sxs-lookup"><span data-stu-id="f859a-110">This topic discusses considerations for combining log shipping and database mirroring.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="f859a-111">有关这些技术的介绍，请参阅[数据库镜像 (SQL Server)](database-mirroring-sql-server.md) 和 [关于日志传送 (SQL Server)](../log-shipping/about-log-shipping-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="f859a-111">For introductions to these technologies, see [Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md) and [About Log Shipping &#40;SQL Server&#41;](../log-shipping/about-log-shipping-sql-server.md).</span></span>  
  
## <a name="combining-log-shipping-and-database-mirroring"></a><span data-ttu-id="f859a-112">组合使用日志传送和数据库镜像</span><span class="sxs-lookup"><span data-stu-id="f859a-112">Combining Log Shipping and Database Mirroring</span></span>  
 <span data-ttu-id="f859a-113">当日志传送备份共享保持不变时，镜像会话中的主体数据库也可以担当日志传送配置中的主数据库，反之亦然。</span><span class="sxs-lookup"><span data-stu-id="f859a-113">The principal database in a mirroring session can also act as the primary database in a log shipping configuration, or vice versa, as the log shipping backup share is intact.</span></span> <span data-ttu-id="f859a-114">数据库镜像会话可以在任何操作模式下运行，同步（将事务安全性设置为 FULL）或异步（将事务安全性设置为 OFF）模式均可。</span><span class="sxs-lookup"><span data-stu-id="f859a-114">The database mirroring session run in any operating mode, whether synchronous (with transaction safety set to FULL) or asynchronous (with transaction safety set to OFF).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="f859a-115">若要在数据库中使用数据库镜像，始终需要完整恢复模式。</span><span class="sxs-lookup"><span data-stu-id="f859a-115">To use database mirroring on a database, the full recovery model is always required.</span></span>  
  
 <span data-ttu-id="f859a-116">通常，组合使用日志传送和数据库镜像时，会先建立镜像会话，然后再建立日志传送（尽管这并不是必需的）。</span><span class="sxs-lookup"><span data-stu-id="f859a-116">Typically, when combining log shipping and database mirroring, the mirroring session is established before log shipping, although this is not required.</span></span> <span data-ttu-id="f859a-117">然后，当前主体数据库将被配置为日志传送主数据库（ *主体/主数据库*），并与一个或多个远程辅助数据库一起使用。</span><span class="sxs-lookup"><span data-stu-id="f859a-117">Then the current principal database is configured as the log shipping primary (the *principal/primary database*), along with one or more remote secondary databases.</span></span> <span data-ttu-id="f859a-118">而且，镜像数据库也必须被配置为日志传送主数据库（ *镜像/主数据库*）。</span><span class="sxs-lookup"><span data-stu-id="f859a-118">Also, the mirror database must be configured as a log shipping primary (the *mirror/primary database*).</span></span> <span data-ttu-id="f859a-119">日志传送辅助数据库应该位于非主体/主服务器或非镜像/主服务器的服务器实例上。</span><span class="sxs-lookup"><span data-stu-id="f859a-119">The log shipping secondary databases should be on different server instances than either the principal/primary server or mirror/primary server.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="f859a-120">日志传送中所涉及的服务器的区分大小写设置应当匹配。</span><span class="sxs-lookup"><span data-stu-id="f859a-120">The case sensitivity settings of the servers involved in log shipping should match.</span></span>  
  
 <span data-ttu-id="f859a-121">在日志传送会话期间，主数据库上的备份作业将在备份文件夹中创建日志备份。</span><span class="sxs-lookup"><span data-stu-id="f859a-121">During a log shipping session, backup jobs on the primary database create log backups in a backup folder.</span></span> <span data-ttu-id="f859a-122">辅助服务器的复制作业将从该位置复制备份。</span><span class="sxs-lookup"><span data-stu-id="f859a-122">From there, the backups are copied by the copy jobs of the secondary servers.</span></span> <span data-ttu-id="f859a-123">若要使备份作业和复制作业成功，它们必须都能访问日志传送备份文件夹。</span><span class="sxs-lookup"><span data-stu-id="f859a-123">For the backup jobs and copy jobs to succeed, they must have access to the log shipping backup folder.</span></span> <span data-ttu-id="f859a-124">若要使主服务器达到最大可用性，我们建议在独立主机上的共享备份位置建立备份文件夹。</span><span class="sxs-lookup"><span data-stu-id="f859a-124">To maximize availability of the primary server, we recommend that you establish the backup folder in a shared backup location on a separate host computer.</span></span> <span data-ttu-id="f859a-125">确保所有日志传送服务器（包括镜像/主服务器）都能访问共享备份位置（称为“备份共享”）。</span><span class="sxs-lookup"><span data-stu-id="f859a-125">Ensure that all the log shipping servers, including the mirror/primary server, can access the shared backup location (known as a *backup share*).</span></span>  
  
 <span data-ttu-id="f859a-126">若要使日志传送在数据库镜像故障转移后仍能继续进行，还必须使用主体数据库上用于主服务器的配置将镜像服务器配置为主服务器。</span><span class="sxs-lookup"><span data-stu-id="f859a-126">To allow log shipping to continue after database mirroring fails over, you must also configure the mirror server as a primary server, using the same configuration you use for the primary on the principal database.</span></span> <span data-ttu-id="f859a-127">镜像数据库处于还原状态，这样可以防止备份作业备份镜像数据库中的日志。</span><span class="sxs-lookup"><span data-stu-id="f859a-127">The mirror database is in the restoring state, which prevents the backup jobs from backing up the log on the mirror database.</span></span> <span data-ttu-id="f859a-128">这将确保镜像/主数据库不会影响主体/主数据库，后者的日志备份当前正被辅助服务器复制。</span><span class="sxs-lookup"><span data-stu-id="f859a-128">This ensures that the mirror/primary database does not interfere with the principal/primary database whose log backups are currently being copied by secondary servers.</span></span> <span data-ttu-id="f859a-129">为了防止虚假警报，在镜像/主数据库上执行备份作业之后，备份作业将向**log_shipping_monitor_history_detail** 表中记录一条消息，然后代理作业将返回成功状态。</span><span class="sxs-lookup"><span data-stu-id="f859a-129">To prevent spurious alerts, after the backup job executes on the mirror/primary database, the backup job logs a message to the l**og_shipping_monitor_history_detail** table, and the agent job returns a status of success.</span></span>  
  
 <span data-ttu-id="f859a-130">镜像/主数据库在日志传送会话中处于非活动状态。</span><span class="sxs-lookup"><span data-stu-id="f859a-130">The mirror/primary database is inactive in the log shipping session.</span></span> <span data-ttu-id="f859a-131">但是，如果镜像进行故障转移，则以前的镜像数据库将作为主体数据库联机。</span><span class="sxs-lookup"><span data-stu-id="f859a-131">However, if mirroring fails over, the former mirror database comes online as the principal database.</span></span> <span data-ttu-id="f859a-132">此时，该数据库也将作为日志传送主数据库变为活动状态。</span><span class="sxs-lookup"><span data-stu-id="f859a-132">At that point, that database also becomes active as the log shipping primary database.</span></span> <span data-ttu-id="f859a-133">以前无法在该数据库中传送日志的日志传送备份作业也将开始传送日志。</span><span class="sxs-lookup"><span data-stu-id="f859a-133">The log shipping backup jobs that were previously unable to ship log on that database, begin shipping log.</span></span> <span data-ttu-id="f859a-134">相反，故障转移将使以前的主体/主数据库成为新的镜像/主数据库并进入还原状态，同时该数据库上的备份作业也将停止备份日志。</span><span class="sxs-lookup"><span data-stu-id="f859a-134">Conversely, a failover causes the former principal/primary database to become the new mirror/primary database and enter the restoring state, and backup jobs on that database cease to backup log.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="f859a-135">如果是自动故障转移，当以前的主体/主数据库重新加入镜像会话时，它将切换到镜像的角色。</span><span class="sxs-lookup"><span data-stu-id="f859a-135">In the event of an automatic failover, the switch to the mirror role occurs when the former principal/primary database rejoins the mirroring session.</span></span>  
  
 <span data-ttu-id="f859a-136">若要在具有自动故障转移功能的高安全性模式下运行，请为镜像会话配置称为“见证服务器”的附加服务器实例。</span><span class="sxs-lookup"><span data-stu-id="f859a-136">To run in high-safety mode with automatic failover the mirroring session is configured with an additional server instance known as the *witness*.</span></span> <span data-ttu-id="f859a-137">如果因为某种原因主体数据库在数据库同步之后丢失，而镜像服务器和见证服务器仍可以互相通信，就会进行自动故障转移。</span><span class="sxs-lookup"><span data-stu-id="f859a-137">If the principal database is lost for any reason after the database is synchronized and if the mirror server and witness can still communicate with each other, automatic failover occurs.</span></span> <span data-ttu-id="f859a-138">自动故障转移将导致镜像服务器成为主体角色，并将其数据库作为主体数据库联机。</span><span class="sxs-lookup"><span data-stu-id="f859a-138">An automatic failover causes mirror server to assume the principal role and bring its database online as the principal database.</span></span> <span data-ttu-id="f859a-139">如果新的主体/主服务器可以访问日志传送备份位置，则其备份作业将开始向该位置传送日志备份。</span><span class="sxs-lookup"><span data-stu-id="f859a-139">If the log shipping backup location is accessible to the new principal/primary server, its backup jobs begin to ship log backups to that location.</span></span> <span data-ttu-id="f859a-140">数据库镜像同步模式可以保证日志链不受镜像故障转移的影响，也可以保证只还原有效的日志。</span><span class="sxs-lookup"><span data-stu-id="f859a-140">The database mirroring synchronous mode guarantees that the log chain is unaffected by a mirroring failover and that only valid log is restored.</span></span> <span data-ttu-id="f859a-141">辅助服务器将继续复制日志备份，而不知道主服务器已经变为不同的服务器实例。</span><span class="sxs-lookup"><span data-stu-id="f859a-141">The secondary servers continue to copy log backups without knowing that a different server instance has become the primary server.</span></span>  
  
 <span data-ttu-id="f859a-142">使用本地日志传送监视器时，此方案没有特别的注意事项。</span><span class="sxs-lookup"><span data-stu-id="f859a-142">When using a local log shipping monitor, no special considerations are necessary to accommodate this scenario.</span></span> <span data-ttu-id="f859a-143">有关如何对此方案使用远程监视实例的信息，请参阅本主题后面介绍的“数据库镜像对远程监视实例的影响”。</span><span class="sxs-lookup"><span data-stu-id="f859a-143">For information about using a remote monitoring instance with this scenario, see, "The Impact of Database Mirroring on a Remote Monitoring Instance," later in this topic.</span></span>  
  
## <a name="failing-over-from-the-principal-to-the-mirror-database"></a><span data-ttu-id="f859a-144">从主体数据库向镜像数据库进行故障转移</span><span class="sxs-lookup"><span data-stu-id="f859a-144">Failing over from the Principal to the Mirror database</span></span>  
 <span data-ttu-id="f859a-145">下图显示了镜像在具有自动故障转移功能的高安全性模式下运行时日志传送和数据库镜像如何一起工作。</span><span class="sxs-lookup"><span data-stu-id="f859a-145">The following figure shows how log shipping and database mirroring work together when mirroring is running in high-safety mode with automatic failover.</span></span> <span data-ttu-id="f859a-146">开始时， **Server_A** 既是用于镜像的主体服务器，也是日志传送的主服务器。</span><span class="sxs-lookup"><span data-stu-id="f859a-146">Initially, **Server_A** is both the principal server for mirroring and the primary server for log shipping.</span></span> <span data-ttu-id="f859a-147">**Server_B** 既是镜像服务器，也被配置为主服务器（当前处于非活动状态）。</span><span class="sxs-lookup"><span data-stu-id="f859a-147">**Server_B** is the mirror server and is also configured as a primary server, which is currently inactive.</span></span> <span data-ttu-id="f859a-148">**Server_C** 和 **Server_D** 为日志传送辅助服务器。</span><span class="sxs-lookup"><span data-stu-id="f859a-148">**Server_C** and **Server_D** are log shipping secondary servers.</span></span> <span data-ttu-id="f859a-149">为了使日志传送会话达到最大可用性，备份位置位于独立主机上的共享目录中。</span><span class="sxs-lookup"><span data-stu-id="f859a-149">To maximize availability of the log shipping session, the backup location is on a share directory on a separate host computer.</span></span>  
  
 <span data-ttu-id="f859a-150">![日志传送和数据库镜像](../media/logshipping-and-dbm-automatic-failover.gif "日志传送和数据库镜像")</span><span class="sxs-lookup"><span data-stu-id="f859a-150">![Log shipping and database mirroring](../media/logshipping-and-dbm-automatic-failover.gif "Log shipping and database mirroring")</span></span>  
  
 <span data-ttu-id="f859a-151">完成镜像故障转移之后，辅助服务器上定义的主服务器名称保持不变。</span><span class="sxs-lookup"><span data-stu-id="f859a-151">After a mirroring failover, the primary server name defined on the secondary server is unchanged.</span></span> <span data-ttu-id="f859a-152">.</span><span class="sxs-lookup"><span data-stu-id="f859a-152">.</span></span>  
  
## <a name="the-impact-of-database-mirroring-on-a-remote-monitoring-instance"></a><span data-ttu-id="f859a-153">数据库镜像对远程监视实例的影响</span><span class="sxs-lookup"><span data-stu-id="f859a-153">The Impact of Database Mirroring on a Remote Monitoring Instance</span></span>  
 <span data-ttu-id="f859a-154">当日志传送与远程监视实例一起使用时，组合使用日志传送会话和数据库镜像会影响监视器表中的信息。</span><span class="sxs-lookup"><span data-stu-id="f859a-154">When log shipping uses with a remote monitoring instance, combining the log shipping session and database mirroring affects the information in the monitor tables.</span></span> <span data-ttu-id="f859a-155">有关主服务器的信息是在主体/主服务器上配置的监视器与在每个辅助服务器上配置的监视器的组合。</span><span class="sxs-lookup"><span data-stu-id="f859a-155">The information about the primary is a combination of the one configured at the principal/primary and the monitor configured on each secondary.</span></span>  
  
 <span data-ttu-id="f859a-156">若要尽可能地保持无缝监视，在使用远程监视器时，我们建议您在辅助服务器上配置主服务器时指定原来的主服务器名称。</span><span class="sxs-lookup"><span data-stu-id="f859a-156">To keep monitoring as seamless as possible, when you use a remote monitor, we recommend that you specify the original primary name when configuring the primary at the secondary.</span></span> <span data-ttu-id="f859a-157">此方法也可以使更改 Microsoft [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理中的日志传送配置变得更加方便。</span><span class="sxs-lookup"><span data-stu-id="f859a-157">This approach also facilitates changing the log shipping configuration from Microsoft [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent.</span></span> <span data-ttu-id="f859a-158">有关监视的详细信息，请参阅[监视日志传送 (Transact-SQL)](../log-shipping/monitor-log-shipping-transact-sql.md)。</span><span class="sxs-lookup"><span data-stu-id="f859a-158">For more information about monitoring, see [Monitor Log Shipping &#40;Transact-SQL&#41;](../log-shipping/monitor-log-shipping-transact-sql.md).</span></span>  
  
## <a name="setting-up-mirroring-and-log-shipping-together"></a><span data-ttu-id="f859a-159">同时设置镜像和日志传送</span><span class="sxs-lookup"><span data-stu-id="f859a-159">Setting Up Mirroring and Log Shipping Together</span></span>  
 <span data-ttu-id="f859a-160">若要同时设置数据库镜像和日志传送，需要执行下列步骤：</span><span class="sxs-lookup"><span data-stu-id="f859a-160">To set up database mirroring and log shipping together, the following steps are required:</span></span>  
  
1.  <span data-ttu-id="f859a-161">使用 NORECOVERY 将主体/主数据库的备份还原到其他服务器实例，从而在以后作为经过数据库镜像实现的主体/主数据库的镜像数据库使用。</span><span class="sxs-lookup"><span data-stu-id="f859a-161">Restore backups of the principal/primary database with NORECOVERY onto another server instance to be later used as database mirroring mirror database for the principal/primary database.</span></span> <span data-ttu-id="f859a-162">有关详细信息，请参阅 [为镜像准备镜像数据库 (SQL Server)](prepare-a-mirror-database-for-mirroring-sql-server.md)的各版本中均未提供见证服务器实例。</span><span class="sxs-lookup"><span data-stu-id="f859a-162">For more information, see [Prepare a Mirror Database for Mirroring &#40;SQL Server&#41;](prepare-a-mirror-database-for-mirroring-sql-server.md).</span></span>  
  
2.  <span data-ttu-id="f859a-163">设置数据库镜像。</span><span class="sxs-lookup"><span data-stu-id="f859a-163">Set up database mirroring.</span></span> <span data-ttu-id="f859a-164">有关详细信息，请参阅[使用 Windows 身份验证建立数据库镜像会话 (SQL Server Management Studio)](establish-database-mirroring-session-windows-authentication.md) 或 [设置数据库镜像 (SQL Server)](setting-up-database-mirroring-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="f859a-164">For more information, see [Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md) or [Setting Up Database Mirroring &#40;SQL Server&#41;](setting-up-database-mirroring-sql-server.md).</span></span>  
  
3.  <span data-ttu-id="f859a-165">将主体/主数据库的备份还原到其他服务器实例，后者以后将用作主数据库的日志传送辅助数据库。</span><span class="sxs-lookup"><span data-stu-id="f859a-165">Restore backups of the principal/primary database to other server instances to be later used as log shipping secondary databases for the primary database.</span></span>  
  
4.  <span data-ttu-id="f859a-166">在用作一个或多个辅助数据库的主数据库的主体数据库上设置日志传送。</span><span class="sxs-lookup"><span data-stu-id="f859a-166">Set up log shipping on the principal database as the primary database for one or more secondary databases.</span></span>  
  
     <span data-ttu-id="f859a-167">应当将单个共享设置为备份目录（一个备份共享）。</span><span class="sxs-lookup"><span data-stu-id="f859a-167">You should set up a single share as the backup directory (a backup share).</span></span> <span data-ttu-id="f859a-168">这可以确保主体服务器和镜像服务器之间进行角色切换后，备份作业能够继续像以前一样写入到同一目录。</span><span class="sxs-lookup"><span data-stu-id="f859a-168">This ensures that after role switching between the principal and mirror servers, backup jobs continue to write to the same directory as before.</span></span> <span data-ttu-id="f859a-169">最佳方法是确保此共享与镜像和日志传送中所涉及的数据库位于不同的物理服务器上。</span><span class="sxs-lookup"><span data-stu-id="f859a-169">A best practice is to ensure that this share is located on a different physical server from the servers hosting the databases involved in mirroring and log shipping.</span></span>  
  
     <span data-ttu-id="f859a-170">有关详细信息，请参阅[配置日志传送 (SQL Server)](../log-shipping/configure-log-shipping-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="f859a-170">For more information, see [Configure Log Shipping &#40;SQL Server&#41;](../log-shipping/configure-log-shipping-sql-server.md).</span></span>  
  
5.  <span data-ttu-id="f859a-171">从主体数据库向镜像数据库手动进行故障转移。</span><span class="sxs-lookup"><span data-stu-id="f859a-171">Manually failover from the principal to the mirror.</span></span>  
  
     <span data-ttu-id="f859a-172">执行手动故障转移：</span><span class="sxs-lookup"><span data-stu-id="f859a-172">To perform a manual failover:</span></span>  
  
    -   [<span data-ttu-id="f859a-173">手动故障转移数据库镜像会话 (SQL Server Management Studio)</span><span class="sxs-lookup"><span data-stu-id="f859a-173">Manually Fail Over a Database Mirroring Session &#40;SQL Server Management Studio&#41;</span></span>](manually-fail-over-a-database-mirroring-session-sql-server-management-studio.md)  
  
    -   [<span data-ttu-id="f859a-174">手动故障转移数据库镜像会话 (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="f859a-174">Manually Fail Over a Database Mirroring Session &#40;Transact-SQL&#41;</span></span>](manually-fail-over-a-database-mirroring-session-transact-sql.md)  
  
6.  <span data-ttu-id="f859a-175">在用作主数据库的新主体数据库（以前为镜像数据库）上设置日志传送。</span><span class="sxs-lookup"><span data-stu-id="f859a-175">Set up log shipping on the new principal (previously mirror) as the primary database.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="f859a-176">请不要在辅助数据库上执行任何设置。</span><span class="sxs-lookup"><span data-stu-id="f859a-176">Do not perform any setup from a secondary.</span></span>  
  
     <span data-ttu-id="f859a-177">必须使用在步骤 4 中使用的同一备份共享。</span><span class="sxs-lookup"><span data-stu-id="f859a-177">You must use the same backup share that you used in step 4.</span></span>  
  
     <span data-ttu-id="f859a-178">**中的** “事务日志传送” [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] 接口对于每个日志传送配置仅支持一个主数据库。</span><span class="sxs-lookup"><span data-stu-id="f859a-178">The **Transaction Log Shipping** interface in [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] supports only one primary database per log shipping configuration.</span></span> <span data-ttu-id="f859a-179">因此，必须使用存储过程来将新主体设置为主数据库。</span><span class="sxs-lookup"><span data-stu-id="f859a-179">Therefore, you must use stored procedures to set up the new principal as primary.</span></span>  
  
7.  <span data-ttu-id="f859a-180">执行另一手动故障转移以回到原始主体。</span><span class="sxs-lookup"><span data-stu-id="f859a-180">Perform another manual failover to fail back to the original principal.</span></span>  
  
  
