---
title: 数据匹配 | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: data-quality-services
ms.topic: conceptual
ms.assetid: fe66d098-bec3-4258-b42a-479ae460feb3
author: lrtoyou1223
ms.author: lle
ms.openlocfilehash: 42fcb346e46229d28c62b256d328d6af4fc6cfec
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87579072"
---
# <a name="data-matching"></a><span data-ttu-id="7e8e9-102">数据匹配</span><span class="sxs-lookup"><span data-stu-id="7e8e9-102">Data Matching</span></span>
  <span data-ttu-id="7e8e9-103">借助 [!INCLUDE[ssDQSnoversion](../includes/ssdqsnoversion-md.md)] (DQS) 数据匹配过程，您可以减少数据源中的数据重复并改善数据准确性。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-103">The [!INCLUDE[ssDQSnoversion](../includes/ssdqsnoversion-md.md)] (DQS) data matching process enables you to reduce data duplication and improve data accuracy in a data source.</span></span> <span data-ttu-id="7e8e9-104">匹配可分析单个数据源的所有记录中的重复程度，同时返回所比较的每组记录之间的加权概率。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-104">Matching analyzes the degree of duplication in all records of a single data source, returning weighted probabilities of a match between each set of records compared.</span></span> <span data-ttu-id="7e8e9-105">然后，您可以决定哪些记录匹配，并对源数据采取适当的措施。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-105">You can then decide which records are matches and take the appropriate action on the source data.</span></span>

 <span data-ttu-id="7e8e9-106">DQS 过程具有下列优点：</span><span class="sxs-lookup"><span data-stu-id="7e8e9-106">The DQS matching process has the following benefits:</span></span>

-   <span data-ttu-id="7e8e9-107">通过匹配，您可以消除应相等的数据值之间的差异、确定正确值并减少数据差异可能导致的错误。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-107">Matching enables you to eliminate differences between data values that should be equal, determining the correct value and reducing the errors that data differences can cause.</span></span> <span data-ttu-id="7e8e9-108">例如，名称和地址通常是数据源的标识数据（尤其是客户数据），但随着时间推移，这些数据可能变脏和损坏。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-108">For example, names and addresses are often the identifying data for a data source, particularly customer data, but the data can become dirty and deteriorate over time.</span></span> <span data-ttu-id="7e8e9-109">执行匹配可确定并更正这些错误，使数据的使用和维护变得容易得多。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-109">Performing matching to identify and correct these errors can make data use and maintenance much easier.</span></span>

-   <span data-ttu-id="7e8e9-110">借助于匹配，您可以确保等效但以不同格式或样式输入的值以一致的方式呈现。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-110">Matching enables you to ensure that values that are equivalent, but were entered in a different format or style, are rendered uniform.</span></span>

-   <span data-ttu-id="7e8e9-111">匹配可确定精确匹配和近似匹配，使您能够按照您的定义删除重复数据。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-111">Matching identifies exact and approximate matches, enabling you to remove duplicate data as you define it.</span></span> <span data-ttu-id="7e8e9-112">近似匹配成为实际匹配的点是由您定义的。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-112">You define the point at which an approximate match is in fact a match.</span></span> <span data-ttu-id="7e8e9-113">您定义对哪些字段评估匹配，以及不对哪些字段评估匹配。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-113">You define which fields are assessed for matching, and which are not.</span></span>

-   <span data-ttu-id="7e8e9-114">DQS 可让您使用计算机辅助过程创建匹配策略，基于匹配结果以交互方式修改此策略，并将其添加到可重用的知识库。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-114">DQS enables you to create a matching policy using a computer-assisted process, modify it interactively based upon matching results, and add it to a knowledge base that is reusable.</span></span>

-   <span data-ttu-id="7e8e9-115">您可以对从源复制到临时表的数据重新编制索引，也可以不重新编制索引，具体取决于匹配策略和源数据的状态。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-115">You can re-index data copied from the source to the staging table, or not re-index, depending on the state of the matching policy and the source data.</span></span> <span data-ttu-id="7e8e9-116">不重新编制索引可以提高性能。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-116">Not re-indexing can improve performance.</span></span>

 <span data-ttu-id="7e8e9-117">您可以执行匹配过程以及其他数据清理过程来提高总体数据质量。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-117">You can perform the matching process in conjunction with other data cleansing processes to improve overall data quality.</span></span> <span data-ttu-id="7e8e9-118">还可以使用 Master Data Services 中内置的 DQS 功能执行消除数据重复操作。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-118">You can also perform data de-duplication using DQS functionality built into Master Data Services.</span></span> <span data-ttu-id="7e8e9-119">有关详细信息，请参阅 [Master Data Services Overview](../master-data-services/master-data-services-overview-mds.md)。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-119">For more information, see [Master Data Services Overview](../master-data-services/master-data-services-overview-mds.md).</span></span>

 <span data-ttu-id="7e8e9-120">下面的插图显示如何在 DQS 中执行数据匹配：</span><span class="sxs-lookup"><span data-stu-id="7e8e9-120">The following illustration displays how data matching is done in DQS:</span></span>

 <span data-ttu-id="7e8e9-121">![DQS 中的映射过程](../../2014/data-quality-services/media/dqs-matchingprocess.gif "DQS 中的映射过程")</span><span class="sxs-lookup"><span data-stu-id="7e8e9-121">![Matching Process in DQS](../../2014/data-quality-services/media/dqs-matchingprocess.gif "Matching Process in DQS")</span></span>

##  <a name="how-to-perform-data-matching"></a><a name="How"></a> <span data-ttu-id="7e8e9-122">如何执行数据匹配</span><span class="sxs-lookup"><span data-stu-id="7e8e9-122">How to Perform Data Matching</span></span>
 <span data-ttu-id="7e8e9-123">针对 DQS 中的其他数据质量过程，您可以通过建立知识库并在数据质量项目中执行匹配活动来执行匹配，步骤如下：</span><span class="sxs-lookup"><span data-stu-id="7e8e9-123">As with other data quality processes in DQS, you perform matching by building a knowledge base and executing a matching activity in a data quality project in the following steps:</span></span>

1.  <span data-ttu-id="7e8e9-124">在知识库中创建匹配策略</span><span class="sxs-lookup"><span data-stu-id="7e8e9-124">Create a matching policy in the knowledge base</span></span>

2.  <span data-ttu-id="7e8e9-125">在作为数据质量项目一部分的匹配活动中执行重复数据消除过程。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-125">Perform a de-duplication process in a matching activity that is part of a data quality project.</span></span>

###  <a name="building-a-matching-policy"></a><a name="Policy"></a> <span data-ttu-id="7e8e9-126">建立匹配策略</span><span class="sxs-lookup"><span data-stu-id="7e8e9-126">Building a Matching Policy</span></span>
 <span data-ttu-id="7e8e9-127">通过在知识库中创建匹配策略来定义 DQS 如何分配匹配概率，准备知识库以执行匹配。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-127">You prepare the knowledge base for performing matching by creating a matching policy in the knowledge base to define how DQS assigns matching probability.</span></span> <span data-ttu-id="7e8e9-128">匹配策略由一个或多个匹配规则组成，这些规则确定当 DQS 评估一条记录与另一条记录的匹配程度时将使用哪些域，以及指定每个域值在匹配评估过程中所具有的权重。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-128">A matching policy consists of one or more matching rules that identify which domains will be used when DQS assesses how well one record matches to another, and specify the weight that each domain value carries in the matching assessment.</span></span> <span data-ttu-id="7e8e9-129">您可以在规则中指定阈值必须是精确匹配或仅仅是相似匹配以及相似度。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-129">You specify in the rule whether domain values have to be an exact match or can just be similar, and to what degree of similarity.</span></span> <span data-ttu-id="7e8e9-130">还指定域匹配是否为先决条件。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-130">You also specify whether a domain match is a prerequisite.</span></span>

 <span data-ttu-id="7e8e9-131">“知识库管理”向导中的匹配策略活动通过应用每个匹配规则，以便对整组记录中某一个时刻的两条记录进行比较，从而分析示例数据。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-131">The matching policy activity in the Knowledge Base Management wizard analyzes sample data by applying each matching rule to compare two records at a time throughout the range of records.</span></span> <span data-ttu-id="7e8e9-132">其匹配分数大于指定最小值的记录将在匹配结果中进行分组。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-132">Records whose matching scores are greater than a specified minimum are grouped in clusters in the matching results.</span></span> <span data-ttu-id="7e8e9-133">这些匹配结果不会添加到知识库；您使用它们来优化匹配规则。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-133">These matching results are not added to the knowledge base; you use them to tune the matching rules.</span></span> <span data-ttu-id="7e8e9-134">创建匹配规则可能是一个迭代过程，您需要根据匹配规则或分析统计信息修改匹配规则。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-134">Creating a matching policy can be an iterative process in which you modify matching rules based on the matching results or profiling statistics.</span></span>

 <span data-ttu-id="7e8e9-135">当您将数据源中的数据加载到域时，可以为域指定将对数据字符串进行规范化。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-135">You can specify for a domain that data strings will be normalized when you load data from the data source into the domain.</span></span> <span data-ttu-id="7e8e9-136">此过程包括将特殊字符替换为 Null 或空格，这通常会消除两个字符串之间的差异。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-136">This process consists of replacing special characters with a null or a space, which often removes the difference between two strings.</span></span> <span data-ttu-id="7e8e9-137">这可能会提高匹配精确度，并经常使匹配结果超过最低匹配阈值；但在不进行规范化时将无法成功。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-137">This can increase matching accuracy, and can often enable a matching result to surpass the minimum matching threshold, when without normalization it would not pass.</span></span>

> [!NOTE]
>  <span data-ttu-id="7e8e9-138">两条记录的相应字段中的 Null 值将被视为匹配。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-138">Null values in the corresponding fields of two records will be considered a match.</span></span>

 <span data-ttu-id="7e8e9-139">针对映射到示例数据的域运行匹配策略。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-139">The matching policy is run on domains mapped to the sample data.</span></span> <span data-ttu-id="7e8e9-140">您可以指定在运行匹配策略时是否从数据源将数据复制到临时表以及是否重新编制索引。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-140">You can specify whether data is copied from the data source into the staging table and re-indexed when you run the matching policy, or not.</span></span> <span data-ttu-id="7e8e9-141">在建立知识库和运行匹配项目时，您都可以执行上述操作。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-141">You can do so both when building the knowledge base and when running the matching project.</span></span> <span data-ttu-id="7e8e9-142">不重新编制索引可能导致性能改进。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-142">Not re-indexing could result in improved performance.</span></span> <span data-ttu-id="7e8e9-143">如果满足以下条件，则不需要重新编制索引：匹配策略未发生变化，并且您尚未更新数据源、重新映射策略、选择新数据源或映射一个或多个新域。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-143">Re-indexing is not necessary if the following is true: the matching policy has not changed, and you have not updated the data source, remapped the policy, selected a new data source, or mapped one or more new domains.</span></span>

 <span data-ttu-id="7e8e9-144">创建每个匹配规则时，该规则都会被保存在知识库中。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-144">Each matching rule is saved in the knowledge base when it is created.</span></span> <span data-ttu-id="7e8e9-145">但仅在发布后，知识库才用于数据质量项目中。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-145">However, a knowledge base is available for use in a data quality project only when it is published.</span></span> <span data-ttu-id="7e8e9-146">此外，在发布知识库之前，除创建者之外，其他用户无法更改其中的匹配规则。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-146">In addition, until the knowledge base is published, the matching rules in it cannot be changed by a user other than the person who created it.</span></span>

###  <a name="running-a-matching-project"></a><a name="Project"></a> <span data-ttu-id="7e8e9-147">运行匹配项目</span><span class="sxs-lookup"><span data-stu-id="7e8e9-147">Running a Matching Project</span></span>
 <span data-ttu-id="7e8e9-148">DQS 通过将数据源中的每行与每个其他行进行比较、使用数据库中定义的匹配策略并生成行是匹配项的概率，以执行消除数据重复操作。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-148">DQS performs data de-duplication by comparing each row in the source data to every other row, using the matching policy defined in the knowledge base, and producing a probability that the rows are a match.</span></span> <span data-ttu-id="7e8e9-149">这是通过类型“匹配”在数据质量项目中完成的。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-149">This is done in a data quality project with a type of Matching.</span></span> <span data-ttu-id="7e8e9-150">匹配是数据质量项目中的主要步骤之一。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-150">Matching is one of the major steps in a data quality project.</span></span> <span data-ttu-id="7e8e9-151">最好是在数据清理之后执行匹配，这样，要匹配的数据无任何错误。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-151">It is best performed after data cleansing, so that the data to be matched is free from error.</span></span> <span data-ttu-id="7e8e9-152">在运行匹配过程之前，您可以将清理项目的结果导出到数据表或 .csv 文件，然后创建一个匹配项目，在此项目中，您将清理结果映射到匹配项目中的域。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-152">Before running a matching process, you can export the results of the cleansing project into a data table or .csv file, and then create a matching project in which you map the cleansing results to domains in the matching project.</span></span>

 <span data-ttu-id="7e8e9-153">数据匹配项目由一个计算机辅助过程和一个交互式过程组成。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-153">A data matching project consists of a computer-assisted process and an interactive process.</span></span> <span data-ttu-id="7e8e9-154">匹配项目将匹配策略中的匹配规则应用到要进行评估的数据源。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-154">The matching project applies the matching rules in the matching policy to the data source to be assessed.</span></span> <span data-ttu-id="7e8e9-155">这一过程评估在匹配分数中任何两行是匹配项的可能性。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-155">This process assesses the likelihood that any two rows are matches in a matching score.</span></span> <span data-ttu-id="7e8e9-156">只有匹配概率大于由数据专员在匹配策略中设置的值的记录才被视为匹配。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-156">Only those records with a probability of a match greater than a value set by the data steward in the matching policy will be considered a match.</span></span>

 <span data-ttu-id="7e8e9-157">当 DQS 执行匹配分析时，它会创建 DQS 认为是匹配的分类。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-157">When DQS performs the matching analysis, it creates clusters of records that DQS considers matches.</span></span> <span data-ttu-id="7e8e9-158">DQS 随机将每个群集中的一条记录确定为透视记录或前导记录。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-158">DQS randomly identifies one of the records in each cluster as the pivot, or leading, record.</span></span> <span data-ttu-id="7e8e9-159">数据专员验证匹配结果，并拒绝任何对群集而言不是适当匹配的记录。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-159">The data steward verifies the matching results, and rejects any record that is not an appropriate match for a cluster.</span></span> <span data-ttu-id="7e8e9-160">然后，数据专员选择一条存活规则，DQS 将使用此规则来确定在匹配过程中存活的记录并替换匹配记录。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-160">The data steward then selects a survivorship rule that DQS will use to determine the record that will survive the matching process and replace the matching records.</span></span> <span data-ttu-id="7e8e9-161">存活规则可以是“透视记录”（默认设置）、“最完整且最长的记录”、“最完整记录”或“最长记录”。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-161">The survivorship rule can be "Pivot record" (the default), "most complete and longest record", "most complete record", or "longest record".</span></span> <span data-ttu-id="7e8e9-162">DQS 根据哪条记录与存活规则中的条件的匹配最密切，以确定每个群集中的存活（前导）记录。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-162">DQS determines the survivor (leading) record in each cluster based upon which record most closely matches the criteria or criterion in the survivorship rule.</span></span> <span data-ttu-id="7e8e9-163">如果给定群集中的多个记录符合存活规则，DQS 将随机选择其中一条记录。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-163">If multiple records in a given cluster comply with the survivorship rule, DQS selects one of those records randomly.</span></span> <span data-ttu-id="7e8e9-164">DQS 可让你通过选择“显示不重叠的群集”，选择显示将共有记录作为单个群集的群集。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-164">DQS gives you the choice of displaying clusters that have records in common as a single cluster by selecting "show non-overlapping clusters".</span></span> <span data-ttu-id="7e8e9-165">为了根据此设置显示结果，您必须执行匹配过程。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-165">You must execute the matching process in order to display the results according to this setting.</span></span>

 <span data-ttu-id="7e8e9-166">您可以将匹配过程的结果导出到 SQL Server 表或 .csv 文件。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-166">You can export the results of the matching process either to a SQL Server table or a .csv file.</span></span> <span data-ttu-id="7e8e9-167">您可以按两种格式导出匹配结果：第一，匹配记录和未匹配记录；或者第二，存活记录（只包括群集的存活记录和未匹配记录）。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-167">You can export matching results in two forms: first, the matched records and the unmatched records, or second, survivorship records that include only the survivor record for a cluster and the unmatched results.</span></span> <span data-ttu-id="7e8e9-168">在存活记录中，如果同一条记录被标识为多个群集的存活记录，则该记录只能导出一次。</span><span class="sxs-lookup"><span data-stu-id="7e8e9-168">In the survivorship records, if the same record is identified as the survivor for multiple clusters, that record will only be exported once.</span></span>

## <a name="in-this-section"></a><span data-ttu-id="7e8e9-169">本节内容</span><span class="sxs-lookup"><span data-stu-id="7e8e9-169">In This Section</span></span>
 <span data-ttu-id="7e8e9-170">可以在 DQS 中执行以下与匹配相关的任务：</span><span class="sxs-lookup"><span data-stu-id="7e8e9-170">You can perform the following tasks related to matching in DQS:</span></span>

|||
|-|-|
|<span data-ttu-id="7e8e9-171">在匹配策略中创建和测试匹配规则</span><span class="sxs-lookup"><span data-stu-id="7e8e9-171">Create and test matching rules in a matching policy</span></span>|[<span data-ttu-id="7e8e9-172">创建匹配策略</span><span class="sxs-lookup"><span data-stu-id="7e8e9-172">Create a Matching Policy</span></span>](../../2014/data-quality-services/create-a-matching-policy.md)|
|<span data-ttu-id="7e8e9-173">在数据质量项目中运行匹配</span><span class="sxs-lookup"><span data-stu-id="7e8e9-173">Run matching in a data quality project</span></span>|[<span data-ttu-id="7e8e9-174">运行匹配项目</span><span class="sxs-lookup"><span data-stu-id="7e8e9-174">Run a Matching Project</span></span>](../../2014/data-quality-services/run-a-matching-project.md)|


