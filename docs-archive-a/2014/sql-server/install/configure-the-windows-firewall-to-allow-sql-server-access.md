---
title: 配置 Windows 防火墙以允许 SQL Server 访问 | Microsoft Docs
ms.custom: ''
ms.date: 06/22/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: install
ms.topic: conceptual
helpviewer_keywords:
- Windows Firewall ports
- WMI firewall ports
- Windows Firewall [Database Engine]
- firewall systems, configuring
- advfirewall
- firewall systems
- rules firewall
- firewall systems, overview and port list
- 1433 TCP port
- portopening using netsh
- ports [SQL Server], TCP
- netsh to open firewall ports
ms.assetid: f55c6a0e-b6bd-4803-b51a-f3a419803024
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: d1a0bc32040fc90e5f73faa708f314722bc8f3b5
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87579979"
---
# <a name="configure-the-windows-firewall-to-allow-sql-server-access"></a><span data-ttu-id="47729-102">Configure the Windows Firewall to Allow SQL Server Access</span><span class="sxs-lookup"><span data-stu-id="47729-102">Configure the Windows Firewall to Allow SQL Server Access</span></span>
  <span data-ttu-id="47729-103">防火墙系统有助于阻止对计算机资源进行未经授权的访问。</span><span class="sxs-lookup"><span data-stu-id="47729-103">Firewall systems help prevent unauthorized access to computer resources.</span></span> <span data-ttu-id="47729-104">如果防火墙已打开但却未正确配置，则可能会阻止连接 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="47729-104">If a firewall is turned on but not correctly configured, attempts to connect to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] might be blocked.</span></span>  
  
 <span data-ttu-id="47729-105">若要通过防火墙访问 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例，必须在运行 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的计算机上配置防火墙以允许访问。</span><span class="sxs-lookup"><span data-stu-id="47729-105">To access an instance of the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] through a firewall, you must configure the firewall on the computer that is running [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to allow access.</span></span> <span data-ttu-id="47729-106">防火墙是 [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows 的一个组件。</span><span class="sxs-lookup"><span data-stu-id="47729-106">The firewall is a component of [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows.</span></span> <span data-ttu-id="47729-107">也可以安装其他公司的防火墙。</span><span class="sxs-lookup"><span data-stu-id="47729-107">You can also install a firewall from another company.</span></span> <span data-ttu-id="47729-108">本主题讨论如何配置 Windows 防火墙，不过所述基本原理也适用于其他防火墙程序。</span><span class="sxs-lookup"><span data-stu-id="47729-108">This topic discusses how to configure the Windows firewall, but the basic principles apply to other firewall programs.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="47729-109">本主题概述了防火墙配置并汇总了 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 管理员所需的信息。</span><span class="sxs-lookup"><span data-stu-id="47729-109">This topic provides an overview of firewall configuration and summarizes information of interest to a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] administrator.</span></span> <span data-ttu-id="47729-110">有关防火墙的详细信息以及权威防火墙信息，请参阅防火墙文档，例如 [高级安全 Windows 防火墙和 IPsec](https://go.microsoft.com/fwlink/?LinkID=116904)。</span><span class="sxs-lookup"><span data-stu-id="47729-110">For more information about the firewall and for authoritative firewall information, see the firewall documentation, such as [Windows Firewall with Advanced Security and IPsec](https://go.microsoft.com/fwlink/?LinkID=116904).</span></span>  
  
 <span data-ttu-id="47729-111">用户如果熟悉控制面板中的“Windows 防火墙”\*\*\*\* 项，熟悉高级安全 Windows 防火墙的 Microsoft 管理控制台 (MMC) 管理单元，以及知道要配置哪些防火墙设置，可以直接转至以下列表中的主题：</span><span class="sxs-lookup"><span data-stu-id="47729-111">Users familiar with the **Windows Firewall** item in Control Panel and with the Windows Firewall with Advanced Security Microsoft Management Console (MMC) snap-in and who know which firewall settings they want to configure can move directly to the topics in the following list:</span></span>  
  
-   [<span data-ttu-id="47729-112">为数据库引擎访问配置 Windows 防火墙</span><span class="sxs-lookup"><span data-stu-id="47729-112">Configure a Windows Firewall for Database Engine Access</span></span>](../../database-engine/configure-windows/configure-a-windows-firewall-for-database-engine-access.md)  
  
-   [<span data-ttu-id="47729-113">配置 Windows 防火墙以允许 Analysis Services 访问</span><span class="sxs-lookup"><span data-stu-id="47729-113">Configure the Windows Firewall to Allow Analysis Services Access</span></span>](../../../2014/analysis-services/instances/configure-the-windows-firewall-to-allow-analysis-services-access.md)  
  
-   [<span data-ttu-id="47729-114">将防火墙配置为允许报表服务器访问</span><span class="sxs-lookup"><span data-stu-id="47729-114">Configure a Firewall for Report Server Access</span></span>](../../reporting-services/report-server/configure-a-firewall-for-report-server-access.md)  
  

  
##  <a name="basic-firewall-information"></a><a name="BKMK_basic"></a> <span data-ttu-id="47729-115">基本防火墙信息</span><span class="sxs-lookup"><span data-stu-id="47729-115">Basic Firewall Information</span></span>  
 <span data-ttu-id="47729-116">防火墙的工作原理是检查传入的数据包并将其与一组规则进行比较。</span><span class="sxs-lookup"><span data-stu-id="47729-116">Firewalls work by inspecting incoming packets, and comparing them against a set of rules.</span></span> <span data-ttu-id="47729-117">如果规则允许数据包通过，则防火墙将把该数据包传递给 TCP/IP 协议以进行其他处理。</span><span class="sxs-lookup"><span data-stu-id="47729-117">If the rules allow the packet, the firewall passes the packet to the TCP/IP protocol for additional processing.</span></span> <span data-ttu-id="47729-118">如果规则不允许数据包通过，则防火墙将丢弃该数据包，此外，如果已启用日志记录，防火墙还将在防火墙日志文件中创建一个条目。</span><span class="sxs-lookup"><span data-stu-id="47729-118">If the rules do not allow the packet, the firewall discards the packet and, if logging is enabled, creates an entry in the firewall logging file.</span></span>  
  
 <span data-ttu-id="47729-119">允许的通信的列表采用以下某种方式进行填充：</span><span class="sxs-lookup"><span data-stu-id="47729-119">The list of allowed traffic is populated in one of the following ways:</span></span>  
  
-   <span data-ttu-id="47729-120">当启用了防火墙的计算机开始通信时，防火墙会在列表中创建一个条目以便允许响应。</span><span class="sxs-lookup"><span data-stu-id="47729-120">When the computer that has the firewall enabled initiates communication, the firewall creates an entry in the list so that the response is allowed.</span></span> <span data-ttu-id="47729-121">传入响应将被视为请求的通信，并且您不必对此进行配置。</span><span class="sxs-lookup"><span data-stu-id="47729-121">The incoming response is considered solicited traffic and you do not have to configure this.</span></span>  
  
-   <span data-ttu-id="47729-122">管理员可配置防火墙例外。</span><span class="sxs-lookup"><span data-stu-id="47729-122">An administrator configures exceptions to the firewall.</span></span> <span data-ttu-id="47729-123">这样将允许访问计算机上运行的指定程序，或访问计算机上的指定连接端口。</span><span class="sxs-lookup"><span data-stu-id="47729-123">This allows either access to specified programs running on your computer, or access to specified connection ports on your computer.</span></span> <span data-ttu-id="47729-124">在此情况下，当计算机充当服务器、侦听器或对等方时，将会接受未经请求的传入通信。</span><span class="sxs-lookup"><span data-stu-id="47729-124">In this case, the computer accepts unsolicited incoming traffic when acting as a server, a listener, or a peer.</span></span> <span data-ttu-id="47729-125">必须完成此类配置才能连接到 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="47729-125">This is the type of configuration that must be completed to connect to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
 <span data-ttu-id="47729-126">选择防火墙策略远较只是确定应打开还是关闭给定端口复杂。</span><span class="sxs-lookup"><span data-stu-id="47729-126">Choosing a firewall strategy is more complex than just deciding if a given port should be open or closed.</span></span> <span data-ttu-id="47729-127">当为企业设计防火墙策略时，请确保考虑所有可供使用的规则和配置选项。</span><span class="sxs-lookup"><span data-stu-id="47729-127">When designing a firewall strategy for your enterprise, make sure that you consider all the rules and configuration options available to you.</span></span> <span data-ttu-id="47729-128">本主题不讨论所有可能的防火墙选项。</span><span class="sxs-lookup"><span data-stu-id="47729-128">This topic does not review all the possible firewall options.</span></span> <span data-ttu-id="47729-129">建议您查看以下文档：</span><span class="sxs-lookup"><span data-stu-id="47729-129">We recommend that you review the following documents:</span></span>  
  
 [<span data-ttu-id="47729-130">Windows Firewall with Advanced Security Getting Started Guide（高级安全 Windows 防火墙入门指南）</span><span class="sxs-lookup"><span data-stu-id="47729-130">Windows Firewall with Advanced Security Getting Started Guide</span></span>](https://go.microsoft.com/fwlink/?LinkId=116080)  
  
 [<span data-ttu-id="47729-131">Windows Firewall with Advanced Security Design Guide（高级安全 Windows 防火墙设计指南）</span><span class="sxs-lookup"><span data-stu-id="47729-131">Windows Firewall with Advanced Security Design Guide</span></span>](https://go.microsoft.com/fwlink/?LinkId=116904)  
  
 [<span data-ttu-id="47729-132">Introduction to Server and Domain Isolation（服务器和域隔离简介）</span><span class="sxs-lookup"><span data-stu-id="47729-132">Introduction to Server and Domain Isolation</span></span>](https://go.microsoft.com/fwlink/?LinkId=116081)  
  
##  <a name="default-firewall-settings"></a><a name="BKMK_default"></a> <span data-ttu-id="47729-133">默认防火墙设置</span><span class="sxs-lookup"><span data-stu-id="47729-133">Default Firewall Settings</span></span>  
 <span data-ttu-id="47729-134">规划防火墙配置的第一步是确定操作系统的防火墙的当前状态。</span><span class="sxs-lookup"><span data-stu-id="47729-134">The first step in planning your firewall configuration is to determine the current status of the firewall for your operating system.</span></span> <span data-ttu-id="47729-135">如果操作系统是从早期版本升级而来，则可能已保留以前的防火墙设置。</span><span class="sxs-lookup"><span data-stu-id="47729-135">If the operating system was upgraded from a previous version, the earlier firewall settings may have been preserved.</span></span> <span data-ttu-id="47729-136">此外，防火墙设置可能已由其他管理员或域中的组策略更改。</span><span class="sxs-lookup"><span data-stu-id="47729-136">Also, the firewall settings could have been changed by another administrator or by a Group Policy in your domain.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="47729-137">打开防火墙将影响访问此计算机的其他程序，例如文件和打印共享以及远程桌面连接。</span><span class="sxs-lookup"><span data-stu-id="47729-137">Turning on the firewall will affect other programs that access this computer, such as file and print sharing, and remote desktop connections.</span></span> <span data-ttu-id="47729-138">在调整防火墙设置之前，管理员应对计算机上运行的所有应用程序加以考虑。</span><span class="sxs-lookup"><span data-stu-id="47729-138">Administrators should consider all applications that are running on the computer before adjusting the firewall settings.</span></span>  
  
##  <a name="programs-to-configure-the-firewall"></a><a name="BKMK_programs"></a> <span data-ttu-id="47729-139">用于配置防火墙的程序</span><span class="sxs-lookup"><span data-stu-id="47729-139">Programs to Configure the Firewall</span></span>  
 <span data-ttu-id="47729-140">有三种配置 Windows 防火墙设置的方式。</span><span class="sxs-lookup"><span data-stu-id="47729-140">There are three ways to configure the Windows Firewall settings.</span></span>  
  
-   <span data-ttu-id="47729-141">**“控制面板”中的“Windows 防火墙”项**</span><span class="sxs-lookup"><span data-stu-id="47729-141">**Windows Firewall item in Control Panel**</span></span>  
  
     <span data-ttu-id="47729-142">可以从“控制面板”打开 **“Windows 防火墙”** 项。</span><span class="sxs-lookup"><span data-stu-id="47729-142">The **Windows Firewall** item can be opened from Control Panel.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="47729-143">在“控制面板”中的 **“Windows 防火墙”** 项中所做的更改只会影响当前配置文件。</span><span class="sxs-lookup"><span data-stu-id="47729-143">Changes made in the **Windows Firewall** item in Control Panel only affect the current profile.</span></span> <span data-ttu-id="47729-144">诸如便携式计算机之类的移动设备不应使用“控制面板”中的 **“Windows 防火墙”** 项，因为当以其他配置连接设备时配置文件可能会更改。</span><span class="sxs-lookup"><span data-stu-id="47729-144">Mobile devices, for example a laptop, should not use the **Windows Firewall** item in Control Panel as the profile might change when it is connected in a different configuration.</span></span> <span data-ttu-id="47729-145">这样以前配置的配置文件将失效。</span><span class="sxs-lookup"><span data-stu-id="47729-145">Then the previously-configured profile will not be in effect.</span></span> <span data-ttu-id="47729-146">有关配置文件的详细信息，请参阅 [高级安全 Windows 防火墙入门指南](https://go.microsoft.com/fwlink/?LinkId=116080)。</span><span class="sxs-lookup"><span data-stu-id="47729-146">For more information about profiles, see [Windows Firewall with Advanced Security Getting Started Guide](https://go.microsoft.com/fwlink/?LinkId=116080).</span></span>  
  
     <span data-ttu-id="47729-147">使用“控制面板”中的 **“Windows 防火墙”** 项可配置基本选项。</span><span class="sxs-lookup"><span data-stu-id="47729-147">The **Windows Firewall** item in Control Panel allows you to configure basic options.</span></span> <span data-ttu-id="47729-148">其中包括：</span><span class="sxs-lookup"><span data-stu-id="47729-148">These include the following:</span></span>  
  
    -   <span data-ttu-id="47729-149">打开或关闭“控制面板”中的 **“Windows 防火墙”** 项</span><span class="sxs-lookup"><span data-stu-id="47729-149">Turning the **Windows Firewall** item in Control Panel on or off</span></span>  
  
    -   <span data-ttu-id="47729-150">启用和禁用规则</span><span class="sxs-lookup"><span data-stu-id="47729-150">Enabling and disabling rules</span></span>  
  
    -   <span data-ttu-id="47729-151">配置例外的端口和程序</span><span class="sxs-lookup"><span data-stu-id="47729-151">Granting exceptions for ports and programs</span></span>  
  
    -   <span data-ttu-id="47729-152">设置一些范围限制</span><span class="sxs-lookup"><span data-stu-id="47729-152">Setting some scope restrictions</span></span>  
  
     <span data-ttu-id="47729-153">“控制面板”中的 **“Windows 防火墙”** 项最适合于防火墙配置经验不足的用户以及要为非移动的计算机配置基本防火墙选项的用户。</span><span class="sxs-lookup"><span data-stu-id="47729-153">The **Windows Firewall** item in Control Panel is most appropriate for users who are not experienced in firewall configuration, and who are configuring basic firewall options for computers that are not mobile.</span></span> <span data-ttu-id="47729-154">还可以通过使用以下过程，从命令打开 "控制面板" 中的 " **Windows 防火墙**" 项 `run` ：</span><span class="sxs-lookup"><span data-stu-id="47729-154">You can also open the **Windows Firewall** item in Control Panel from the `run` command by using the following procedure:</span></span>  
  
    #### <a name="to-open-the-windows-firewall-item"></a><span data-ttu-id="47729-155">打开“Windows 防火墙”项</span><span class="sxs-lookup"><span data-stu-id="47729-155">To open the Windows Firewall item</span></span>  
  
    1.  <span data-ttu-id="47729-156">在 **“开始”** 菜单上，单击 **“运行”**，然后输入 `firewall.cpl`。</span><span class="sxs-lookup"><span data-stu-id="47729-156">On the **Start** menu, click **Run**, and then enter `firewall.cpl`.</span></span>  
  
    2.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
-   <span data-ttu-id="47729-157">**Microsoft 管理控制台 (MMC)**</span><span class="sxs-lookup"><span data-stu-id="47729-157">**Microsoft Management Console (MMC)**</span></span>  
  
     <span data-ttu-id="47729-158">使用高级安全 Windows 防火墙 MMC 管理单元可以配置更高级的防火墙设置。</span><span class="sxs-lookup"><span data-stu-id="47729-158">The Windows Firewall with Advanced Security MMC snap-in lets you configure more advanced firewall settings.</span></span> <span data-ttu-id="47729-159">此管理单元以一种易于使用的方式呈现大多数防火墙选项，并且会显示所有防火墙配置文件。</span><span class="sxs-lookup"><span data-stu-id="47729-159">This snap-in presents most of the firewall options in an easy-to-use manner, and presents all firewall profiles.</span></span> <span data-ttu-id="47729-160">有关详细信息，请参阅本主题后面的[使用高级安全 Windows 防火墙管理单元](#BKMK_WF_msc)。</span><span class="sxs-lookup"><span data-stu-id="47729-160">For more information, see [Using the Windows Firewall with Advanced Security Snap-in](#BKMK_WF_msc) later in this topic.</span></span>  
  
-   <span data-ttu-id="47729-161">**netsh**</span><span class="sxs-lookup"><span data-stu-id="47729-161">**netsh**</span></span>  
  
     <span data-ttu-id="47729-162">管理员可以在命令提示符下使用 **netsh.exe** 工具配置和监视基于 Windows 的计算机，也可以使用批处理文件执行此操作 **。**</span><span class="sxs-lookup"><span data-stu-id="47729-162">The **netsh.exe** tool can be used by an administrator to configure and monitor Windows-based computers at a command prompt or using a batch file **.**</span></span> <span data-ttu-id="47729-163">通过使用 **netsh** 工具，可以将输入的上下文命令定向到相应帮助器，然后由帮助器执行此命令。</span><span class="sxs-lookup"><span data-stu-id="47729-163">By using the **netsh** tool, you can direct the context commands you enter to the appropriate helper, and the helper then performs the command.</span></span> <span data-ttu-id="47729-164">帮助器是一个动态链接库 (.dll) 文件，它通过对一种或多种服务、实用工具或协议提供配置、监视和支持来扩展 **netsh** 工具的功能。</span><span class="sxs-lookup"><span data-stu-id="47729-164">A helper is a Dynamic Link Library (.dll) file that extends the functionality of the **netsh** tool by providing configuration, monitoring, and support for one or more services, utilities, or protocols.</span></span> <span data-ttu-id="47729-165">所有支持 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的操作系统都具有防火墙帮助器。</span><span class="sxs-lookup"><span data-stu-id="47729-165">All operating systems that support [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] have a firewall helper.</span></span> [!INCLUDE[firstref_longhorn](../../includes/firstref-longhorn-md.md)] <span data-ttu-id="47729-166">也具有称作 **advfirewall**的高级防火墙帮助器。</span><span class="sxs-lookup"><span data-stu-id="47729-166">also has an advanced firewall helper called **advfirewall**.</span></span> <span data-ttu-id="47729-167">本主题不讨论有关使用 **netsh** 的详细信息。</span><span class="sxs-lookup"><span data-stu-id="47729-167">The details of using **netsh** are not discussed in this topic.</span></span> <span data-ttu-id="47729-168">不过，所述配置选项中的许多选项都可以通过使用 **netsh**加以配置。</span><span class="sxs-lookup"><span data-stu-id="47729-168">However, many of the configuration options described can be configured by using **netsh**.</span></span> <span data-ttu-id="47729-169">例如，在命令提示符下运行以下脚本，以打开 TCP 端口 1433：</span><span class="sxs-lookup"><span data-stu-id="47729-169">For example, run the following script at a command prompt to open TCP port 1433:</span></span>  
  
    ```  
    netsh firewall set portopening protocol = TCP port = 1433 name = SQLPort mode = ENABLE scope = SUBNET profile = CURRENT  
    ```  
  
     <span data-ttu-id="47729-170">使用高级安全 Windows 防火墙帮助器的一个类似示例：</span><span class="sxs-lookup"><span data-stu-id="47729-170">A similar example using the Windows Firewall for Advanced Security helper:</span></span>  
  
    ```  
    netsh advfirewall firewall add rule name = SQLPort dir = in protocol = tcp action = allow localport = 1433 remoteip = localsubnet profile = DOMAIN  
    ```  
  
     <span data-ttu-id="47729-171">有关 **netsh**的详细信息，请参阅以下链接：</span><span class="sxs-lookup"><span data-stu-id="47729-171">For more information about **netsh**, see the following links:</span></span>  
  
    -   [<span data-ttu-id="47729-172">如何使用 Netsh.exe 工具和命令行开关</span><span class="sxs-lookup"><span data-stu-id="47729-172">How to Use the Netsh.exe Tool and Command-Line Switches</span></span>](https://support.microsoft.com/kb/242468)  
  
    -   [<span data-ttu-id="47729-173">如何使用“netsh advfirewall firewall”上下文而非“netsh firewall”上下文控制 Windows Server 2008 和 Windows Vista 中的 Windows 防火墙行为</span><span class="sxs-lookup"><span data-stu-id="47729-173">How to use the "netsh advfirewall firewall" context instead of the "netsh firewall" context to control Windows Firewall behavior in Windows Server 2008 and in Windows Vista</span></span>](https://support.microsoft.com/kb/947709)  
  
    -   [<span data-ttu-id="47729-174">“netsh firewall”命令及“profile=all”参数不配置基于 Windows Vista 的计算机上的公共配置文件</span><span class="sxs-lookup"><span data-stu-id="47729-174">The "netsh firewall" command together with the "profile=all" parameter does not configure the public profile on a Windows Vista-based computer</span></span>](https://support.microsoft.com/kb/947213)  
  
## <a name="ports-used-by-ssnoversion"></a><span data-ttu-id="47729-175">使用的端口 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]</span><span class="sxs-lookup"><span data-stu-id="47729-175">Ports Used By [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]</span></span>  
 <span data-ttu-id="47729-176">下面几个表可有助于您确定 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]所使用的端口。</span><span class="sxs-lookup"><span data-stu-id="47729-176">The following tables can help you identify the ports being used by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
###  <a name="ports-used-by-the-database-engine"></a><a name="BKMK_ssde"></a> <span data-ttu-id="47729-177">Ports Used By the Database Engine</span><span class="sxs-lookup"><span data-stu-id="47729-177">Ports Used By the Database Engine</span></span>  
 <span data-ttu-id="47729-178">下表列出了 [!INCLUDE[ssDE](../../includes/ssde-md.md)]经常使用的端口。</span><span class="sxs-lookup"><span data-stu-id="47729-178">The following table lists the ports that are frequently used by the [!INCLUDE[ssDE](../../includes/ssde-md.md)].</span></span>  
  
|<span data-ttu-id="47729-179">场景</span><span class="sxs-lookup"><span data-stu-id="47729-179">Scenario</span></span>|<span data-ttu-id="47729-180">端口</span><span class="sxs-lookup"><span data-stu-id="47729-180">Port</span></span>|<span data-ttu-id="47729-181">注释</span><span class="sxs-lookup"><span data-stu-id="47729-181">Comments</span></span>|  
|--------------|----------|--------------|  
|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="47729-182">默认实例</span><span class="sxs-lookup"><span data-stu-id="47729-182">default instance running over TCP</span></span>|<span data-ttu-id="47729-183">TCP 端口 1433</span><span class="sxs-lookup"><span data-stu-id="47729-183">TCP port 1433</span></span>|<span data-ttu-id="47729-184">这是允许通过防火墙的最常用端口。</span><span class="sxs-lookup"><span data-stu-id="47729-184">This is the most common port allowed through the firewall.</span></span> <span data-ttu-id="47729-185">它适用于与默认 [!INCLUDE[ssDE](../../includes/ssde-md.md)]安装或作为计算机上唯一运行实例的命名实例之间的例行连接。</span><span class="sxs-lookup"><span data-stu-id="47729-185">It applies to routine connections to the default installation of the [!INCLUDE[ssDE](../../includes/ssde-md.md)], or a named instance that is the only instance running on the computer.</span></span> <span data-ttu-id="47729-186">（命名实例具有特殊的注意事项。</span><span class="sxs-lookup"><span data-stu-id="47729-186">(Named instances have special considerations.</span></span> <span data-ttu-id="47729-187">请参阅本主题后面的[动态端口](#BKMK_dynamic_ports)。 ) </span><span class="sxs-lookup"><span data-stu-id="47729-187">See [Dynamic Ports](#BKMK_dynamic_ports) later in this topic.)</span></span>|  
|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="47729-188">命名实例</span><span class="sxs-lookup"><span data-stu-id="47729-188">named instances in the default configuration</span></span>|<span data-ttu-id="47729-189">此 TCP 端口是在启动 [!INCLUDE[ssDE](../../includes/ssde-md.md)] 时确定的动态端口。</span><span class="sxs-lookup"><span data-stu-id="47729-189">The TCP port is a dynamic port determined at the time the [!INCLUDE[ssDE](../../includes/ssde-md.md)] starts.</span></span>|<span data-ttu-id="47729-190">请参阅下面 [动态端口](#BKMK_dynamic_ports)部分中的描述。</span><span class="sxs-lookup"><span data-stu-id="47729-190">See the discussion below in the section [Dynamic Ports](#BKMK_dynamic_ports).</span></span> <span data-ttu-id="47729-191">当使用命名实例时， [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Browser 服务可能需要 UDP 端口 1434。</span><span class="sxs-lookup"><span data-stu-id="47729-191">UDP port 1434 might be required for the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Browser Service when you are using named instances.</span></span>|  
|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="47729-192">命名实例</span><span class="sxs-lookup"><span data-stu-id="47729-192">named instances when they are configured to use a fixed port</span></span>|<span data-ttu-id="47729-193">由管理员配置的端口号。</span><span class="sxs-lookup"><span data-stu-id="47729-193">The port number configured by the administrator.</span></span>|<span data-ttu-id="47729-194">请参阅下面 [动态端口](#BKMK_dynamic_ports)部分中的描述。</span><span class="sxs-lookup"><span data-stu-id="47729-194">See the discussion below in the section [Dynamic Ports](#BKMK_dynamic_ports).</span></span>|  
|<span data-ttu-id="47729-195">专用管理连接</span><span class="sxs-lookup"><span data-stu-id="47729-195">Dedicated Admin Connection</span></span>|<span data-ttu-id="47729-196">对于默认实例，为 TCP 端口 1434。</span><span class="sxs-lookup"><span data-stu-id="47729-196">TCP port 1434 for the default instance.</span></span> <span data-ttu-id="47729-197">其他端口用于命名实例。</span><span class="sxs-lookup"><span data-stu-id="47729-197">Other ports are used for named instances.</span></span> <span data-ttu-id="47729-198">有关端口号，请查看错误日志。</span><span class="sxs-lookup"><span data-stu-id="47729-198">Check the error log for the port number.</span></span>|<span data-ttu-id="47729-199">默认情况下，不会启用与专用管理员连接 (DAC) 的远程连接。</span><span class="sxs-lookup"><span data-stu-id="47729-199">By default, remote connections to the Dedicated Administrator Connection (DAC) are not enabled.</span></span> <span data-ttu-id="47729-200">若要启用远程 DAC，请使用外围应用配置器方面。</span><span class="sxs-lookup"><span data-stu-id="47729-200">To enable remote DAC, use the Surface Area Configuration facet.</span></span> <span data-ttu-id="47729-201">有关详细信息，请参阅 [Surface Area Configuration](../../relational-databases/security/surface-area-configuration.md)。</span><span class="sxs-lookup"><span data-stu-id="47729-201">For more information, see [Surface Area Configuration](../../relational-databases/security/surface-area-configuration.md).</span></span>|  
|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="47729-202">Browser 服务</span><span class="sxs-lookup"><span data-stu-id="47729-202">Browser service</span></span>|<span data-ttu-id="47729-203">UDP 端口 1434</span><span class="sxs-lookup"><span data-stu-id="47729-203">UDP port 1434</span></span>|<span data-ttu-id="47729-204">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Browser 服务用于侦听指向命名实例的传入连接，并为客户端提供与此命名实例对应的 TCP 端口号。</span><span class="sxs-lookup"><span data-stu-id="47729-204">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Browser service listens for incoming connections to a named instance and provides the client the TCP port number that corresponds to that named instance.</span></span> <span data-ttu-id="47729-205">通常，只要使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的命名实例，就会启动 [!INCLUDE[ssDE](../../includes/ssde-md.md)] Browser 服务。</span><span class="sxs-lookup"><span data-stu-id="47729-205">Normally the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Browser service is started whenever named instances of the [!INCLUDE[ssDE](../../includes/ssde-md.md)] are used.</span></span> <span data-ttu-id="47729-206">如果客户端配置为连接到命名实例的特定端口，则不必启动 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Browser 服务。</span><span class="sxs-lookup"><span data-stu-id="47729-206">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Browser service does not have to be started if the client is configured to connect to the specific port of the named instance.</span></span>|  
|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="47729-207">实例。</span><span class="sxs-lookup"><span data-stu-id="47729-207">instance running over an HTTP endpoint.</span></span>|<span data-ttu-id="47729-208">可以在创建 HTTP 端点时指定。</span><span class="sxs-lookup"><span data-stu-id="47729-208">Can be specified when an HTTP endpoint is created.</span></span> <span data-ttu-id="47729-209">对于 CLEAR_PORT 通信，默认端口为 TCP 端口 80，对于 SSL_PORT 通信，默认端口为 443。</span><span class="sxs-lookup"><span data-stu-id="47729-209">The default is TCP port 80 for CLEAR_PORT traffic and 443 for SSL_PORT traffic.</span></span>|<span data-ttu-id="47729-210">用于通过 URL 实现的 HTTP 连接。</span><span class="sxs-lookup"><span data-stu-id="47729-210">Used for an HTTP connection through a URL.</span></span>|  
|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="47729-211">默认实例。</span><span class="sxs-lookup"><span data-stu-id="47729-211">default instance running over an HTTPS endpoint.</span></span>|<span data-ttu-id="47729-212">TCP 端口 443</span><span class="sxs-lookup"><span data-stu-id="47729-212">TCP port 443</span></span>|<span data-ttu-id="47729-213">用于通过 URL 实现的 HTTPS 连接。</span><span class="sxs-lookup"><span data-stu-id="47729-213">Used for an HTTPS connection through a URL.</span></span> <span data-ttu-id="47729-214">HTTPS 是使用安全套接字层 (SSL) 的 HTTP 连接。</span><span class="sxs-lookup"><span data-stu-id="47729-214">HTTPS is an HTTP connection that uses secure sockets layer (SSL).</span></span>|  
|[!INCLUDE[ssSB](../../includes/sssb-md.md)]|<span data-ttu-id="47729-215">TCP 端口 4022。</span><span class="sxs-lookup"><span data-stu-id="47729-215">TCP port 4022.</span></span> <span data-ttu-id="47729-216">若要验证使用的端口，请执行下面的查询：</span><span class="sxs-lookup"><span data-stu-id="47729-216">To verify the port used, execute the following query:</span></span><br /><br /> `SELECT name, protocol_desc, port, state_desc`<br /><br /> `FROM sys.tcp_endpoints`<br /><br /> `WHERE type_desc = 'SERVICE_BROKER'`|<span data-ttu-id="47729-217">对于 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)][!INCLUDE[ssSB](../../includes/sssb-md.md)]，没有默认端口，不过这是联机丛书示例中使用的常规配置。</span><span class="sxs-lookup"><span data-stu-id="47729-217">There is no default port for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)][!INCLUDE[ssSB](../../includes/sssb-md.md)], but this is the conventional configuration used in Books Online examples.</span></span>|  
|<span data-ttu-id="47729-218">数据库镜像</span><span class="sxs-lookup"><span data-stu-id="47729-218">Database Mirroring</span></span>|<span data-ttu-id="47729-219">管理员选择的端口。</span><span class="sxs-lookup"><span data-stu-id="47729-219">Administrator chosen port.</span></span> <span data-ttu-id="47729-220">若要确定此端口，请执行以下查询：</span><span class="sxs-lookup"><span data-stu-id="47729-220">To determine the port, execute the following query:</span></span><br /><br /> `SELECT name, protocol_desc, port, state_desc FROM sys.tcp_endpoints`<br /><br /> `WHERE type_desc = 'DATABASE_MIRRORING'`|<span data-ttu-id="47729-221">对于数据库镜像，没有默认端口，不过联机丛书示例使用 TCP 端口 7022。</span><span class="sxs-lookup"><span data-stu-id="47729-221">There is no default port for database mirroring however Books Online examples use TCP port 7022.</span></span> <span data-ttu-id="47729-222">务必避免中断正在使用的镜像端点，尤其是处于带有自动故障转移功能的高安全模式下时。</span><span class="sxs-lookup"><span data-stu-id="47729-222">It is very important to avoid interrupting an in-use mirroring endpoint, especially in high-safety mode with automatic failover.</span></span> <span data-ttu-id="47729-223">防火墙配置必须避免破坏仲裁。</span><span class="sxs-lookup"><span data-stu-id="47729-223">Your firewall configuration must avoid breaking quorum.</span></span> <span data-ttu-id="47729-224">有关详细信息，请参阅 [指定服务器网络地址（数据库镜像）](../../database-engine/database-mirroring/specify-a-server-network-address-database-mirroring.md)。</span><span class="sxs-lookup"><span data-stu-id="47729-224">For more information, see [Specify a Server Network Address &#40;Database Mirroring&#41;](../../database-engine/database-mirroring/specify-a-server-network-address-database-mirroring.md).</span></span>|  
|<span data-ttu-id="47729-225">复制</span><span class="sxs-lookup"><span data-stu-id="47729-225">Replication</span></span>|<span data-ttu-id="47729-226">与 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的复制连接使用典型的常规 [!INCLUDE[ssDE](../../includes/ssde-md.md)] 端口（供默认实例使用的 TCP 端口 1433 等）</span><span class="sxs-lookup"><span data-stu-id="47729-226">Replication connections to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] use the typical regular [!INCLUDE[ssDE](../../includes/ssde-md.md)] ports (TCP port 1433 for the default instance, etc.)</span></span><br /><br /> <span data-ttu-id="47729-227">复制快照的 Web 同步和 FTP/UNC 访问要求在防火墙上打开其他端口。</span><span class="sxs-lookup"><span data-stu-id="47729-227">Web synchronization and FTP/UNC access for replication snapshot require additional ports to be opened on the firewall.</span></span> <span data-ttu-id="47729-228">为了将初始数据和架构从一个位置传输到另一个位置，复制可以使用 FTP（TCP 端口 21）或者通过 HTTP（TCP 端口 80）或文件共享进行的同步。</span><span class="sxs-lookup"><span data-stu-id="47729-228">To transfer initial data and schema from one location to another, replication can use FTP (TCP port 21), or sync over HTTP (TCP port 80) or File Sharing.</span></span> <span data-ttu-id="47729-229">文件共享使用 UDP 端口 137 和 138，如果使用 NetBIOS，则还有 TCP 端口 139。</span><span class="sxs-lookup"><span data-stu-id="47729-229">File sharing uses UDP port 137 and 138, and TCP port 139 if it using NetBIOS.</span></span> <span data-ttu-id="47729-230">文件共享使用 TCP 端口 445。</span><span class="sxs-lookup"><span data-stu-id="47729-230">File Sharing uses TCP port 445.</span></span>|<span data-ttu-id="47729-231">对于通过 HTTP 进行的同步，复制使用 IIS 端点（其端口可配置，但默认情况下为端口 80），不过 IIS 进程通过标准端口（对于默认实例为 1433）连接到后端 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="47729-231">For sync over HTTP, replication uses the IIS endpoint (ports for which are configurable but is port 80 by default), but the IIS process connects to the backend [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] through the standard ports (1433 for the default instance.</span></span><br /><br /> <span data-ttu-id="47729-232">在使用 FTP 进行 Web 同步期间，FTP 传输是在 IIS 和 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 发布服务器之间进行，而非在订阅服务器和 IIS 之间进行。</span><span class="sxs-lookup"><span data-stu-id="47729-232">During Web synchronization using FTP, the FTP transfer is between IIS and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] publisher, not between subscriber and IIS.</span></span>|  
|[!INCLUDE[tsql](../../includes/tsql-md.md)] <span data-ttu-id="47729-233">调试器</span><span class="sxs-lookup"><span data-stu-id="47729-233">debugger</span></span>|<span data-ttu-id="47729-234">TCP 端口 135</span><span class="sxs-lookup"><span data-stu-id="47729-234">TCP port 135</span></span><br /><br /> <span data-ttu-id="47729-235">请参阅 [端口 135 的特殊注意事项](#BKMK_port_135)</span><span class="sxs-lookup"><span data-stu-id="47729-235">See [Special Considerations for Port 135](#BKMK_port_135)</span></span><br /><br /> <span data-ttu-id="47729-236">可能还需要 [IPsec](#BKMK_additional_ports) 例外。</span><span class="sxs-lookup"><span data-stu-id="47729-236">The [IPsec](#BKMK_additional_ports) exception might also be required.</span></span>|<span data-ttu-id="47729-237">如果使用 [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)]，则在 [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] 主机计算机上，还必须将 **Devenv.exe** 添加到“例外”列表中并打开 TCP 端口 135。</span><span class="sxs-lookup"><span data-stu-id="47729-237">If using [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)], on the [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] host computer, you must also add **Devenv.exe** to the Exceptions list and open TCP port 135.</span></span><br /><br /> <span data-ttu-id="47729-238">如果使用 [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)]，则在 [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] 主机计算机上，还必须将 **ssms.exe** 添加到“例外”列表中并打开 TCP 端口 135。</span><span class="sxs-lookup"><span data-stu-id="47729-238">If using [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)], on the [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] host computer, you must also add **ssms.exe** to the Exceptions list and open TCP port 135.</span></span> <span data-ttu-id="47729-239">有关详细信息，请参阅[配置 Transact-sql 调试器](../../relational-databases/scripting/configure-firewall-rules-before-running-the-tsql-debugger.md)。</span><span class="sxs-lookup"><span data-stu-id="47729-239">For more information, see [Configure the Transact-SQL Debugger](../../relational-databases/scripting/configure-firewall-rules-before-running-the-tsql-debugger.md).</span></span>|  
  
 <span data-ttu-id="47729-240">有关为 [!INCLUDE[ssDE](../../includes/ssde-md.md)]配置 Windows 防火墙的分步说明，请参阅 [为数据库引擎访问配置 Windows 防火墙](../../database-engine/configure-windows/configure-a-windows-firewall-for-database-engine-access.md)。</span><span class="sxs-lookup"><span data-stu-id="47729-240">For step by step instructions to configure the Windows Firewall for the [!INCLUDE[ssDE](../../includes/ssde-md.md)], see [Configure a Windows Firewall for Database Engine Access](../../database-engine/configure-windows/configure-a-windows-firewall-for-database-engine-access.md).</span></span>  
  
####  <a name="dynamic-ports"></a><a name="BKMK_dynamic_ports"></a> <span data-ttu-id="47729-241">动态端口</span><span class="sxs-lookup"><span data-stu-id="47729-241">Dynamic Ports</span></span>  
 <span data-ttu-id="47729-242">默认情况下，命名实例（包括 [!INCLUDE[ssExpress](../../includes/ssexpress-md.md)]）使用动态端口。</span><span class="sxs-lookup"><span data-stu-id="47729-242">By default, named instances (including [!INCLUDE[ssExpress](../../includes/ssexpress-md.md)]) use dynamic ports.</span></span> <span data-ttu-id="47729-243">也就是说，每次启动 [!INCLUDE[ssDE](../../includes/ssde-md.md)] 时，它都将确定一个可用端口并使用此端口号。</span><span class="sxs-lookup"><span data-stu-id="47729-243">That means that every time that the [!INCLUDE[ssDE](../../includes/ssde-md.md)] starts, it identifies an available port and uses that port number.</span></span> <span data-ttu-id="47729-244">如果命名实例是安装的唯一 [!INCLUDE[ssDE](../../includes/ssde-md.md)] 实例，则它可能使用 TCP 端口 1433。</span><span class="sxs-lookup"><span data-stu-id="47729-244">If the named instance is the only instance of the [!INCLUDE[ssDE](../../includes/ssde-md.md)] installed, it will probably use TCP port 1433.</span></span> <span data-ttu-id="47729-245">如果还安装了其他 [!INCLUDE[ssDE](../../includes/ssde-md.md)] 实例，则它可能会使用其他 TCP 端口。</span><span class="sxs-lookup"><span data-stu-id="47729-245">If other instances of the [!INCLUDE[ssDE](../../includes/ssde-md.md)] are installed, it will probably use a different TCP port.</span></span> <span data-ttu-id="47729-246">由于所选端口可能会在每次启动 [!INCLUDE[ssDE](../../includes/ssde-md.md)] 时更改，因而很难配置防火墙以启用对正确端口号的访问。</span><span class="sxs-lookup"><span data-stu-id="47729-246">Because the port selected might change every time that the [!INCLUDE[ssDE](../../includes/ssde-md.md)] is started, it is difficult to configure the firewall to enable access to the correct port number.</span></span> <span data-ttu-id="47729-247">因此，如果使用防火墙，则建议重新配置 [!INCLUDE[ssDE](../../includes/ssde-md.md)] 以每次都使用同一端口号。</span><span class="sxs-lookup"><span data-stu-id="47729-247">Therefore, if a firewall is used, we recommend reconfiguring the [!INCLUDE[ssDE](../../includes/ssde-md.md)] to use the same port number every time.</span></span> <span data-ttu-id="47729-248">这称为固定端口或静态端口。</span><span class="sxs-lookup"><span data-stu-id="47729-248">This is called a fixed port or a static port.</span></span> <span data-ttu-id="47729-249">有关详细信息，请参阅[将服务器配置为侦听特定 TCP 端口（SQL Sever 配置管理器）](../../database-engine/configure-windows/configure-a-server-to-listen-on-a-specific-tcp-port.md)。</span><span class="sxs-lookup"><span data-stu-id="47729-249">For more information, see [Configure a Server to Listen on a Specific TCP Port &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/configure-a-server-to-listen-on-a-specific-tcp-port.md).</span></span>  
  
 <span data-ttu-id="47729-250">另一种配置命名实例以侦听固定端口的方法是在防火墙中为诸如 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] sqlservr.exe **之类的** 程序创建例外（针对 [!INCLUDE[ssDE](../../includes/ssde-md.md)]）。</span><span class="sxs-lookup"><span data-stu-id="47729-250">An alternative to configuring a named instance to listen on a fixed port is to create an exception in the firewall for a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] program such as **sqlservr.exe** (for the [!INCLUDE[ssDE](../../includes/ssde-md.md)]).</span></span> <span data-ttu-id="47729-251">这会非常方便，但当使用高级安全 Windows 防火墙 MMC 管理单元时，端口号将不会显示在“入站规则”  页的“本地端口”  列中。</span><span class="sxs-lookup"><span data-stu-id="47729-251">This can be convenient, but the port number will not appear in the **Local Port** column of the **Inbound Rules** page when you are using the Windows Firewall with Advanced Security MMC snap-in.</span></span> <span data-ttu-id="47729-252">这会使审核哪些端口处于打开状态变得更为困难。</span><span class="sxs-lookup"><span data-stu-id="47729-252">This can make it more difficult to audit which ports are open.</span></span> <span data-ttu-id="47729-253">另一个注意事项是，Service Pack 或累积更新可能会更改 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 可执行文件的路径，这将使防火墙规则作废。</span><span class="sxs-lookup"><span data-stu-id="47729-253">Another consideration is that a service pack or cumulative update can change the path to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] executable which will invalidate the firewall rule.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="47729-254">下面的过程将使用“控制面板”中的 **“Windows 防火墙”** 项。</span><span class="sxs-lookup"><span data-stu-id="47729-254">The following procedure uses the **Windows Firewall** item in Control Panel.</span></span> <span data-ttu-id="47729-255">高级安全 Windows 防火墙 MMC 管理单元可以配置更复杂的规则。</span><span class="sxs-lookup"><span data-stu-id="47729-255">The Windows Firewall with Advanced Security MMC snap-in can configure a more complex rule.</span></span> <span data-ttu-id="47729-256">其中包括配置服务例外，这对于提供深度防御会非常有用。</span><span class="sxs-lookup"><span data-stu-id="47729-256">This includes configuring a service exception which can be useful for providing defense in depth.</span></span> <span data-ttu-id="47729-257">请参阅下面的 [使用高级安全 Windows 防火墙管理单元](#BKMK_WF_msc) 。</span><span class="sxs-lookup"><span data-stu-id="47729-257">See [Using the Windows Firewall with Advanced Security Snap-in](#BKMK_WF_msc) below.</span></span>  
  
###### <a name="to-add-a-program-exception-to-the-firewall-using-the-windows-firewall-item-in-control-panel"></a><span data-ttu-id="47729-258">使用“控制面板”中的“Windows 防火墙”项向防火墙添加程序例外。</span><span class="sxs-lookup"><span data-stu-id="47729-258">To add a program exception to the firewall using the Windows Firewall item in Control Panel.</span></span>  
  
1.  <span data-ttu-id="47729-259">在“控制面板”中的 **“Windows 防火墙”** 项的 **“例外”** 选项卡上，单击 **“添加程序”**。</span><span class="sxs-lookup"><span data-stu-id="47729-259">On the **Exceptions** tab of the **Windows Firewall** item in Control Panel, click **Add a program**.</span></span>  
  
2.  <span data-ttu-id="47729-260">浏览到 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 要允许通过防火墙的实例的位置，例如**C:\PROGRAM Files\Microsoft SQL Server\MSSQL12. <instance_name> \mssql\binn**，选择**sqlservr.exe**，然后单击 "**打开**"。</span><span class="sxs-lookup"><span data-stu-id="47729-260">Browse to the location of the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that you want to allow through the firewall, for example **C:\Program Files\Microsoft SQL Server\MSSQL12.<instance_name>\MSSQL\Binn**, select **sqlservr.exe**, and then click **Open**.</span></span>  
  
3.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
 <span data-ttu-id="47729-261">有关终结点的详细信息，请参阅[将数据库引擎配置为侦听多个 TCP 端口](../../database-engine/configure-windows/configure-the-database-engine-to-listen-on-multiple-tcp-ports.md)和[终结点目录视图 (Transact-SQL)](/sql/relational-databases/system-catalog-views/endpoints-catalog-views-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="47729-261">For more information about endpoints, see [Configure the Database Engine to Listen on Multiple TCP Ports](../../database-engine/configure-windows/configure-the-database-engine-to-listen-on-multiple-tcp-ports.md) and [Endpoints Catalog Views &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/endpoints-catalog-views-transact-sql).</span></span>  
  
###  <a name="ports-used-by-analysis-services"></a><a name="BKMK_ssas"></a> <span data-ttu-id="47729-262">Analysis Services 使用的端口</span><span class="sxs-lookup"><span data-stu-id="47729-262">Ports Used By Analysis Services</span></span>  
 <span data-ttu-id="47729-263">下表列出了 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]经常使用的端口。</span><span class="sxs-lookup"><span data-stu-id="47729-263">The following table lists the ports that are frequently used by [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)].</span></span>  
  
|<span data-ttu-id="47729-264">Feature</span><span class="sxs-lookup"><span data-stu-id="47729-264">Feature</span></span>|<span data-ttu-id="47729-265">端口</span><span class="sxs-lookup"><span data-stu-id="47729-265">Port</span></span>|<span data-ttu-id="47729-266">注释</span><span class="sxs-lookup"><span data-stu-id="47729-266">Comments</span></span>|  
|-------------|----------|--------------|  
|[!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]|<span data-ttu-id="47729-267">对于默认实例，为 TCP 端口 2383。</span><span class="sxs-lookup"><span data-stu-id="47729-267">TCP port 2383 for the default instance</span></span>|<span data-ttu-id="47729-268">默认 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]实例的标准端口。</span><span class="sxs-lookup"><span data-stu-id="47729-268">The standard port for the default instance of [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)].</span></span>|  
|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="47729-269">Browser 服务</span><span class="sxs-lookup"><span data-stu-id="47729-269">Browser service</span></span>|<span data-ttu-id="47729-270">仅 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 命名实例需要的 TCP 端口 2382</span><span class="sxs-lookup"><span data-stu-id="47729-270">TCP port 2382 only needed for an [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] named instance</span></span>|<span data-ttu-id="47729-271">客户端向 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 命名实例发出不指定端口号的连接请求时，该连接请求将被转到端口 2382，即 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Browser 侦听的端口。</span><span class="sxs-lookup"><span data-stu-id="47729-271">Client connection requests for a named instance of [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] that do not specify a port number are directed to port 2382, the port on which [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Browser listens.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="47729-272">Browser 将此请求重定向到该命名实例所使用的端口。</span><span class="sxs-lookup"><span data-stu-id="47729-272">Browser then redirects the request to the port that the named instance uses.</span></span>|  
|[!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] <span data-ttu-id="47729-273">配置为通过 IIS/HTTP 使用</span><span class="sxs-lookup"><span data-stu-id="47729-273">configured for use through IIS/HTTP</span></span><br /><br /> <span data-ttu-id="47729-274"> (数据透视表？</span><span class="sxs-lookup"><span data-stu-id="47729-274">(The PivotTable??</span></span> <span data-ttu-id="47729-275">服务使用 HTTP 或 HTTPS) </span><span class="sxs-lookup"><span data-stu-id="47729-275">Service uses HTTP or HTTPS)</span></span>|<span data-ttu-id="47729-276">TCP 端口 80</span><span class="sxs-lookup"><span data-stu-id="47729-276">TCP port 80</span></span>|<span data-ttu-id="47729-277">用于通过 URL 实现的 HTTP 连接。</span><span class="sxs-lookup"><span data-stu-id="47729-277">Used for an HTTP connection through a URL.</span></span>|  
|[!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] <span data-ttu-id="47729-278">配置为通过 IIS/HTTPS 使用</span><span class="sxs-lookup"><span data-stu-id="47729-278">configured for use through IIS/HTTPS</span></span><br /><br /> <span data-ttu-id="47729-279"> (数据透视表？</span><span class="sxs-lookup"><span data-stu-id="47729-279">(The PivotTable??</span></span> <span data-ttu-id="47729-280">服务使用 HTTP 或 HTTPS) </span><span class="sxs-lookup"><span data-stu-id="47729-280">Service uses HTTP or HTTPS)</span></span>|<span data-ttu-id="47729-281">TCP 端口 443</span><span class="sxs-lookup"><span data-stu-id="47729-281">TCP port 443</span></span>|<span data-ttu-id="47729-282">用于通过 URL 实现的 HTTPS 连接。</span><span class="sxs-lookup"><span data-stu-id="47729-282">Used for an HTTPS connection through a URL.</span></span> <span data-ttu-id="47729-283">HTTPS 是使用安全套接字层 (SSL) 的 HTTP 连接。</span><span class="sxs-lookup"><span data-stu-id="47729-283">HTTPS is an HTTP connection that uses secure sockets layer (SSL).</span></span>|  
  
 <span data-ttu-id="47729-284">如果用户通过 IIS 和 Internet 访问 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] ，则必须打开 IIS 侦听的端口，并在客户端连接字符串中指定该端口。</span><span class="sxs-lookup"><span data-stu-id="47729-284">If users access [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] through IIS and the Internet, you must open the port on which IIS is listening and specify that port in the client connection string.</span></span> <span data-ttu-id="47729-285">在这种情况下，不需要打开任何端口就能直接访问 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="47729-285">In this case, no ports have to be open for direct access to [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)].</span></span> <span data-ttu-id="47729-286">默认端口 2389 和端口 2382 应当与所有其他并非必需的端口一起受到限制。</span><span class="sxs-lookup"><span data-stu-id="47729-286">The default port 2389, and port 2382, should be restricted together with all other ports that are not required.</span></span>  
  
 <span data-ttu-id="47729-287">有关为 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]配置 Windows 防火墙的分步说明，请参阅 [将 Windows 防火墙配置为允许 Analysis Services 访问](../../../2014/analysis-services/instances/configure-the-windows-firewall-to-allow-analysis-services-access.md)。</span><span class="sxs-lookup"><span data-stu-id="47729-287">For step by step instructions to configure the Windows Firewall for [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)], see [Configure the Windows Firewall to Allow Analysis Services Access](../../../2014/analysis-services/instances/configure-the-windows-firewall-to-allow-analysis-services-access.md).</span></span>  
  
###  <a name="ports-used-by-reporting-services"></a><a name="BKMK_ssrs"></a> <span data-ttu-id="47729-288">Reporting Services 使用的端口</span><span class="sxs-lookup"><span data-stu-id="47729-288">Ports Used By Reporting Services</span></span>  
 <span data-ttu-id="47729-289">下表列出了 [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)]经常使用的端口。</span><span class="sxs-lookup"><span data-stu-id="47729-289">The following table lists the ports that are frequently used by [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)].</span></span>  
  
|<span data-ttu-id="47729-290">Feature</span><span class="sxs-lookup"><span data-stu-id="47729-290">Feature</span></span>|<span data-ttu-id="47729-291">端口</span><span class="sxs-lookup"><span data-stu-id="47729-291">Port</span></span>|<span data-ttu-id="47729-292">注释</span><span class="sxs-lookup"><span data-stu-id="47729-292">Comments</span></span>|  
|-------------|----------|--------------|  
|[!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] <span data-ttu-id="47729-293">Web 服务</span><span class="sxs-lookup"><span data-stu-id="47729-293">Web Services</span></span>|<span data-ttu-id="47729-294">TCP 端口 80</span><span class="sxs-lookup"><span data-stu-id="47729-294">TCP port 80</span></span>|<span data-ttu-id="47729-295">用于通过 URL 实现的与 [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] 之间的 HTTP 连接。</span><span class="sxs-lookup"><span data-stu-id="47729-295">Used for an HTTP connection to [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] through a URL.</span></span> <span data-ttu-id="47729-296">建议不要使用预配置规则 **万维网服务(HTTP)** 。</span><span class="sxs-lookup"><span data-stu-id="47729-296">We recommend that you do not use the preconfigured rule **World Wide Web Services (HTTP)**.</span></span> <span data-ttu-id="47729-297">有关详细信息，请参阅下面的 [与其他防火墙规则的交互](#BKMK_other_rules) 部分。</span><span class="sxs-lookup"><span data-stu-id="47729-297">For more information, see the [Interaction with Other Firewall Rules](#BKMK_other_rules) section below.</span></span>|  
|[!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] <span data-ttu-id="47729-298">配置为通过 HTTPS 使用</span><span class="sxs-lookup"><span data-stu-id="47729-298">configured for use through HTTPS</span></span>|<span data-ttu-id="47729-299">TCP 端口 443</span><span class="sxs-lookup"><span data-stu-id="47729-299">TCP port 443</span></span>|<span data-ttu-id="47729-300">用于通过 URL 实现的 HTTPS 连接。</span><span class="sxs-lookup"><span data-stu-id="47729-300">Used for an HTTPS connection through a URL.</span></span> <span data-ttu-id="47729-301">HTTPS 是使用安全套接字层 (SSL) 的 HTTP 连接。</span><span class="sxs-lookup"><span data-stu-id="47729-301">HTTPS is an HTTP connection that uses secure sockets layer (SSL).</span></span> <span data-ttu-id="47729-302">建议不要使用预配置规则“安全万维网服务(HTTPS)”  。</span><span class="sxs-lookup"><span data-stu-id="47729-302">We recommend that you do not use the preconfigured rule **Secure World Wide Web Services (HTTPS)**.</span></span> <span data-ttu-id="47729-303">有关详细信息，请参阅下面的 [与其他防火墙规则的交互](#BKMK_other_rules) 部分。</span><span class="sxs-lookup"><span data-stu-id="47729-303">For more information, see the [Interaction with Other Firewall Rules](#BKMK_other_rules) section below.</span></span>|  
  
 <span data-ttu-id="47729-304">当 [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] 连接到 [!INCLUDE[ssDE](../../includes/ssde-md.md)] 或 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]实例时，还必须为这些服务打开相应的端口。</span><span class="sxs-lookup"><span data-stu-id="47729-304">When [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] connects to an instance of the [!INCLUDE[ssDE](../../includes/ssde-md.md)] or [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)], you must also open the appropriate ports for those services.</span></span> <span data-ttu-id="47729-305">有关为 [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)]配置 Windows 防火墙的分步说明，请参阅 [将防火墙配置为允许报表服务器访问](../../reporting-services/report-server/configure-a-firewall-for-report-server-access.md)。</span><span class="sxs-lookup"><span data-stu-id="47729-305">For step-by-step instructions to configure the Windows Firewall for [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)], [Configure a Firewall for Report Server Access](../../reporting-services/report-server/configure-a-firewall-for-report-server-access.md).</span></span>  
  
###  <a name="ports-used-by-integration-services"></a><a name="BKMK_ssis"></a> <span data-ttu-id="47729-306">Integration Services 使用的端口</span><span class="sxs-lookup"><span data-stu-id="47729-306">Ports Used By Integration Services</span></span>  
 <span data-ttu-id="47729-307">下表列出了 [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] 服务经常使用的端口。</span><span class="sxs-lookup"><span data-stu-id="47729-307">The following table lists the ports that are used by the [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] service.</span></span>  
  
|<span data-ttu-id="47729-308">Feature</span><span class="sxs-lookup"><span data-stu-id="47729-308">Feature</span></span>|<span data-ttu-id="47729-309">端口</span><span class="sxs-lookup"><span data-stu-id="47729-309">Port</span></span>|<span data-ttu-id="47729-310">注释</span><span class="sxs-lookup"><span data-stu-id="47729-310">Comments</span></span>|  
|-------------|----------|--------------|  
|[!INCLUDE[msCoName](../../includes/msconame-md.md)] <span data-ttu-id="47729-311">远程过程调用 (MS RPC)</span><span class="sxs-lookup"><span data-stu-id="47729-311">remote procedure calls (MS RPC)</span></span><br /><br /> <span data-ttu-id="47729-312">由 [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] 运行时使用。</span><span class="sxs-lookup"><span data-stu-id="47729-312">Used by the [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] runtime.</span></span>|<span data-ttu-id="47729-313">TCP 端口 135</span><span class="sxs-lookup"><span data-stu-id="47729-313">TCP port 135</span></span><br /><br /> <span data-ttu-id="47729-314">请参阅 [端口 135 的特殊注意事项](#BKMK_port_135)</span><span class="sxs-lookup"><span data-stu-id="47729-314">See [Special Considerations for Port 135](#BKMK_port_135)</span></span>|<span data-ttu-id="47729-315">[!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] 服务在端口 135 上使用 DCOM。</span><span class="sxs-lookup"><span data-stu-id="47729-315">The [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] service uses DCOM on port 135.</span></span> <span data-ttu-id="47729-316">服务控制管理器使用端口 135 执行诸如启动和停止 [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] 服务以及将控制请求传送到正在运行的服务等任务。</span><span class="sxs-lookup"><span data-stu-id="47729-316">The Service Control Manager uses port 135 to perform tasks such as starting and stopping the [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] service and transmitting control requests to the running service.</span></span> <span data-ttu-id="47729-317">此端口号无法更改。</span><span class="sxs-lookup"><span data-stu-id="47729-317">The port number cannot be changed.</span></span><br /><br /> <span data-ttu-id="47729-318">仅当从 [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] 或自定义应用程序连接到远程 [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] 服务实例时，才需要打开此端口。</span><span class="sxs-lookup"><span data-stu-id="47729-318">This port is only required to be open if you are connecting to a remote instance of the [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] service from [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] or a custom application.</span></span>|  
  
 <span data-ttu-id="47729-319">有关为 [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)]配置 Windows 防火墙的分步说明，请参阅 [为访问 SSIS 服务配置 Windows 防火墙](../../../2014/integration-services/configure-a-windows-firewall-for-access-to-the-ssis-service.md)。</span><span class="sxs-lookup"><span data-stu-id="47729-319">For step-by-step instructions to configure the Windows Firewall for [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)], see [Configure a Windows Firewall for Access to the SSIS Service](../../../2014/integration-services/configure-a-windows-firewall-for-access-to-the-ssis-service.md).</span></span>  
  
###  <a name="additional-ports-and-services"></a><a name="BKMK_additional_ports"></a> <span data-ttu-id="47729-320">其他端口和服务</span><span class="sxs-lookup"><span data-stu-id="47729-320">Additional Ports and Services</span></span>  
 <span data-ttu-id="47729-321">下表列出了 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 可能依赖的一些端口和服务。</span><span class="sxs-lookup"><span data-stu-id="47729-321">The following table lists ports and services that [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] might depend on.</span></span>  
  
|<span data-ttu-id="47729-322">场景</span><span class="sxs-lookup"><span data-stu-id="47729-322">Scenario</span></span>|<span data-ttu-id="47729-323">端口</span><span class="sxs-lookup"><span data-stu-id="47729-323">Port</span></span>|<span data-ttu-id="47729-324">注释</span><span class="sxs-lookup"><span data-stu-id="47729-324">Comments</span></span>|  
|--------------|----------|--------------|  
|<span data-ttu-id="47729-325">Windows Management Instrumentation</span><span class="sxs-lookup"><span data-stu-id="47729-325">Windows Management Instrumentation</span></span><br /><br /> <span data-ttu-id="47729-326">有关 WMI 的详细信息，请参阅 [WMI Provider for Configuration Management Concepts](../../relational-databases/wmi-provider-configuration/wmi-provider-for-configuration-management.md)。</span><span class="sxs-lookup"><span data-stu-id="47729-326">For more information about WMI, see [WMI Provider for Configuration Management Concepts](../../relational-databases/wmi-provider-configuration/wmi-provider-for-configuration-management.md)</span></span>|<span data-ttu-id="47729-327">WMI 作为共享服务主机的一部分使用通过 DCOM 分配的端口运行。</span><span class="sxs-lookup"><span data-stu-id="47729-327">WMI runs as part of a shared service host with ports assigned through DCOM.</span></span> <span data-ttu-id="47729-328">WMI 可能使用 TCP 端口 135。</span><span class="sxs-lookup"><span data-stu-id="47729-328">WMI might be using TCP port 135.</span></span><br /><br /> <span data-ttu-id="47729-329">请参阅 [端口 135 的特殊注意事项](#BKMK_port_135)</span><span class="sxs-lookup"><span data-stu-id="47729-329">See [Special Considerations for Port 135](#BKMK_port_135)</span></span>|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="47729-330">配置管理器使用 WMI 列出和管理各个服务。</span><span class="sxs-lookup"><span data-stu-id="47729-330">Configuration Manager uses WMI to list and manage services.</span></span> <span data-ttu-id="47729-331">建议使用预配置规则组 **Windows 管理规范 (WMI)** 。</span><span class="sxs-lookup"><span data-stu-id="47729-331">We recommend that you use the preconfigured rule group **Windows Management Instrumentation (WMI)**.</span></span> <span data-ttu-id="47729-332">有关详细信息，请参阅下面的 [与其他防火墙规则的交互](#BKMK_other_rules) 部分。</span><span class="sxs-lookup"><span data-stu-id="47729-332">For more information, see the [Interaction with Other Firewall Rules](#BKMK_other_rules) section below.</span></span>|  
|[!INCLUDE[msCoName](../../includes/msconame-md.md)] <span data-ttu-id="47729-333">分布式事务处理协调器 (MS DTC)</span><span class="sxs-lookup"><span data-stu-id="47729-333">Distributed Transaction Coordinator (MS DTC)</span></span>|<span data-ttu-id="47729-334">TCP 端口 135</span><span class="sxs-lookup"><span data-stu-id="47729-334">TCP port 135</span></span><br /><br /> <span data-ttu-id="47729-335">请参阅 [端口 135 的特殊注意事项](#BKMK_port_135)</span><span class="sxs-lookup"><span data-stu-id="47729-335">See [Special Considerations for Port 135](#BKMK_port_135)</span></span>|<span data-ttu-id="47729-336">如果应用程序使用分布式事务处理，可能必须要将防火墙配置为允许 [!INCLUDE[msCoName](../../includes/msconame-md.md)] 分布式事务处理协调器 (MS DTC) 在不同的 MS DTC 实例之间以及在 MS DTC 和资源管理器（如 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]）之间进行通信。</span><span class="sxs-lookup"><span data-stu-id="47729-336">If your application uses distributed transactions, you might have to configure the firewall to allow [!INCLUDE[msCoName](../../includes/msconame-md.md)] Distributed Transaction Coordinator (MS DTC) traffic to flow between separate MS DTC instances, and between the MS DTC and resource managers such as [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="47729-337">建议使用预配置的 **“分布式事务处理协调器”** 规则组。</span><span class="sxs-lookup"><span data-stu-id="47729-337">We recommend that you use the preconfigured **Distributed Transaction Coordinator** rule group.</span></span><br /><br /> <span data-ttu-id="47729-338">当在单独的资源组中为整个群集配置单个共享 MS DTC 时，应当将 sqlservr.exe 作为异常添加到防火墙。</span><span class="sxs-lookup"><span data-stu-id="47729-338">When a single shared MS DTC is configured for the entire cluster in a separate resource group you should add sqlservr.exe as an exception to the firewall.</span></span>|  
|<span data-ttu-id="47729-339">[!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] 中的浏览按钮使用 UDP 连接到 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Browser 服务。</span><span class="sxs-lookup"><span data-stu-id="47729-339">The browse button in [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] uses UDP to connect to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Browser Service.</span></span> <span data-ttu-id="47729-340">有关详细信息，请参阅 [SQL Server Browser 服务（数据库引擎和 SSAS）](../../database-engine/configure-windows/sql-server-browser-service-database-engine-and-ssas.md)。</span><span class="sxs-lookup"><span data-stu-id="47729-340">For more information, see [SQL Server Browser Service &#40;Database Engine and SSAS&#41;](../../database-engine/configure-windows/sql-server-browser-service-database-engine-and-ssas.md).</span></span>|<span data-ttu-id="47729-341">UDP 端口 1434</span><span class="sxs-lookup"><span data-stu-id="47729-341">UDP port 1434</span></span>|<span data-ttu-id="47729-342">UDP 是一种无连接协议。</span><span class="sxs-lookup"><span data-stu-id="47729-342">UDP is a connectionless protocol.</span></span><br /><br /> <span data-ttu-id="47729-343">防火墙具有一个名为 [INetFwProfile 接口的 UnicastResponsesToMulticastBroadcastDisabled 属性](https://go.microsoft.com/fwlink/?LinkId=118371) 的设置，用于控制防火墙在对广播（或多播）UDP 请求的单播响应方面的行为。</span><span class="sxs-lookup"><span data-stu-id="47729-343">The firewall has a setting, which is named [UnicastResponsesToMulticastBroadcastDisabled Property of the INetFwProfile Interface](https://go.microsoft.com/fwlink/?LinkId=118371) which controls the behavior of the firewall with respect to unicast responses to a broadcast (or multicast) UDP request.</span></span>  <span data-ttu-id="47729-344">它有以下两种行为：</span><span class="sxs-lookup"><span data-stu-id="47729-344">It has two behaviors:</span></span><br /><br /> <span data-ttu-id="47729-345">如果此设置为 TRUE，则根本不允许对广播进行任何单播响应。</span><span class="sxs-lookup"><span data-stu-id="47729-345">If the setting is TRUE, no unicast responses to a broadcast are permitted at all.</span></span> <span data-ttu-id="47729-346">枚举服务将失败。</span><span class="sxs-lookup"><span data-stu-id="47729-346">Enumerating services will fail.</span></span><br /><br /> <span data-ttu-id="47729-347">如果此设置为 FALSE（默认值），则允许单播响应 3 秒钟。</span><span class="sxs-lookup"><span data-stu-id="47729-347">If the setting is FALSE (default), unicast responses are permitted for 3 seconds.</span></span> <span data-ttu-id="47729-348">此时间长度不可配置。</span><span class="sxs-lookup"><span data-stu-id="47729-348">The length of time is not configurable.</span></span> <span data-ttu-id="47729-349">在堵塞或长时间滞后的网络中，或者对于负载很重的服务器，尝试枚举 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例可能会返回部分列表，这可能会误导用户。</span><span class="sxs-lookup"><span data-stu-id="47729-349">in a congested or high-latency network, or for heavily loaded servers, tries to enumerate instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] might return a partial list, which might mislead users.</span></span>|  
|<span data-ttu-id="47729-350">IPsec 通信</span><span class="sxs-lookup"><span data-stu-id="47729-350">IPsec traffic</span></span>|<span data-ttu-id="47729-351">UDP 端口 500 和 UDP 端口 4500</span><span class="sxs-lookup"><span data-stu-id="47729-351">UDP port 500 and UDP port 4500</span></span>|<span data-ttu-id="47729-352">如果域策略要求通过 IPSec 进行网络通信，还必须将 UDP 端口 4500 和 UDP 端口 500 添加到例外列表。</span><span class="sxs-lookup"><span data-stu-id="47729-352">If the domain policy requires network communications to be done through IPsec, you must also add UDP port 4500 and UDP port 500 to the exception list.</span></span> <span data-ttu-id="47729-353">使用 Windows 防火墙管理单元中的“新建入站规则向导”  可以选择 IPsec。</span><span class="sxs-lookup"><span data-stu-id="47729-353">IPsec is an option using the **New Inbound Rule Wizard** in the Windows Firewall snap-in.</span></span> <span data-ttu-id="47729-354">有关详细信息，请参阅下面的 [使用高级安全 Windows 防火墙管理单元](#BKMK_WF_msc) 。</span><span class="sxs-lookup"><span data-stu-id="47729-354">For more information, see [Using the Windows Firewall with Advanced Security Snap-in](#BKMK_WF_msc) below.</span></span>|  
|<span data-ttu-id="47729-355">将 Windows 身份验证用于可信域</span><span class="sxs-lookup"><span data-stu-id="47729-355">Using Windows Authentication with Trusted Domains</span></span>|<span data-ttu-id="47729-356">必须将防火墙配置为允许身份验证请求。</span><span class="sxs-lookup"><span data-stu-id="47729-356">Firewalls must be configured to allow authentication requests.</span></span>|<span data-ttu-id="47729-357">有关详细信息，请参阅 [如何为域和信任关系配置防火墙](https://support.microsoft.com/kb/179442/)。</span><span class="sxs-lookup"><span data-stu-id="47729-357">For more information, see [How to configure a firewall for domains and trusts](https://support.microsoft.com/kb/179442/).</span></span>|  
|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="47729-358">和 Windows 群集</span><span class="sxs-lookup"><span data-stu-id="47729-358">and Windows Clustering</span></span>|<span data-ttu-id="47729-359">群集需要与 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]不直接相关的其他端口。</span><span class="sxs-lookup"><span data-stu-id="47729-359">Clustering requires additional ports that are not directly related to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>|<span data-ttu-id="47729-360">有关详细信息，请参阅 [Enable a network for cluster use](https://go.microsoft.com/fwlink/?LinkId=118372)（启用网络以供群集使用）。</span><span class="sxs-lookup"><span data-stu-id="47729-360">For more information, see [Enable a network for cluster use](https://go.microsoft.com/fwlink/?LinkId=118372).</span></span>|  
|<span data-ttu-id="47729-361">HTTP 服务器 API (HTTP.SYS) 中保留的 URL 命名空间</span><span class="sxs-lookup"><span data-stu-id="47729-361">URL namespaces reserved in the HTTP Server API (HTTP.SYS)</span></span>|<span data-ttu-id="47729-362">很可能为 TCP 端口 80，但可以配置为其他端口。</span><span class="sxs-lookup"><span data-stu-id="47729-362">Probably TCP port 80, but can be configured to other ports.</span></span> <span data-ttu-id="47729-363">有关常规信息，请参阅 [配置 HTTP 和 HTTPS](https://go.microsoft.com/fwlink/?LinkId=118373)。</span><span class="sxs-lookup"><span data-stu-id="47729-363">For general information, see [Configuring HTTP and HTTPS](https://go.microsoft.com/fwlink/?LinkId=118373).</span></span>|<span data-ttu-id="47729-364">有关使用 HttpCfg.exe 预留 HTTP.SYS 端点的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 特定信息，请参阅[关于 URL 预留和注册（SSRS 配置管理器）](../../reporting-services/install-windows/about-url-reservations-and-registration-ssrs-configuration-manager.md)。</span><span class="sxs-lookup"><span data-stu-id="47729-364">For [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] specific information about reserving an HTTP.SYS endpoint using HttpCfg.exe, see [About URL Reservations and Registration  &#40;SSRS Configuration Manager&#41;](../../reporting-services/install-windows/about-url-reservations-and-registration-ssrs-configuration-manager.md).</span></span>|  
  
##  <a name="special-considerations-for-port-135"></a><a name="BKMK_port_135"></a> <span data-ttu-id="47729-365">端口 135 的特殊注意事项</span><span class="sxs-lookup"><span data-stu-id="47729-365">Special Considerations for Port 135</span></span>  
 <span data-ttu-id="47729-366">将 RPC 与 TCP/IP 或 UDP/IP 一起用作传输方式时，通常会根据需要为系统服务动态分配入站端口。将使用端口号大于 1024 的 TCP/IP 和 UDP/IP 端口。</span><span class="sxs-lookup"><span data-stu-id="47729-366">When you use RPC with TCP/IP or with UDP/IP as the transport, inbound ports are frequently dynamically assigned to system services as required; TCP/IP and UDP/IP ports that are larger than port 1024 are used.</span></span> <span data-ttu-id="47729-367">这些端口通常被不正式地称为“随机 RPC 端口”。</span><span class="sxs-lookup"><span data-stu-id="47729-367">These are frequently informally referred to as "random RPC ports."</span></span> <span data-ttu-id="47729-368">在这些情况下，RPC 客户端依赖 RPC 端点映射程序来通知它们为服务器分配了哪些动态端口。</span><span class="sxs-lookup"><span data-stu-id="47729-368">In these cases, RPC clients rely on the RPC endpoint mapper to tell them which dynamic ports were assigned to the server.</span></span> <span data-ttu-id="47729-369">对于一些基于 RPC 的服务，可以配置特定端口，而非让 RPC 动态分配一个端口。</span><span class="sxs-lookup"><span data-stu-id="47729-369">For some RPC-based services, you can configure a specific port instead of letting RPC assign one dynamically.</span></span> <span data-ttu-id="47729-370">此外，还可以将 RPC 动态分配的端口范围限制为一个较小的范围，不管何种服务均可如此。</span><span class="sxs-lookup"><span data-stu-id="47729-370">You can also restrict the range of ports that RPC dynamically assigns to a small range, regardless of the service.</span></span> <span data-ttu-id="47729-371">由于许多服务都使用端口 135，它经常受到恶意用户的攻击。</span><span class="sxs-lookup"><span data-stu-id="47729-371">Because port 135 is used for many services it is frequently attacked by malicious users.</span></span> <span data-ttu-id="47729-372">当打开端口 135 时，请考虑限制防火墙规则的作用范围。</span><span class="sxs-lookup"><span data-stu-id="47729-372">When opening port 135, consider restricting the scope of the firewall rule.</span></span>  
  
 <span data-ttu-id="47729-373">有关端口 135 的详细信息，请参阅以下参考内容：</span><span class="sxs-lookup"><span data-stu-id="47729-373">For more information about port 135, see the following references:</span></span>  
  
-   [<span data-ttu-id="47729-374">Windows Server 系统的服务概述和网络端口要求</span><span class="sxs-lookup"><span data-stu-id="47729-374">Service overview and network port requirements for the Windows Server system</span></span>](https://support.microsoft.com/kb/832017)  
  
-   [<span data-ttu-id="47729-375">如何排除 RPC 端点映射程序错误</span><span class="sxs-lookup"><span data-stu-id="47729-375">Troubleshooting RPC Endpoint Mapper errors using the Windows Server 2003 Support Tools from the product CD</span></span>](https://support.microsoft.com/kb/839880)  
  
-   [<span data-ttu-id="47729-376">Remote procedure call (RPC)（远程过程调用 (RPC)）</span><span class="sxs-lookup"><span data-stu-id="47729-376">Remote procedure call (RPC)</span></span>](https://go.microsoft.com/fwlink/?LinkId=118375)  
  
-   [<span data-ttu-id="47729-377">如何配置与防火墙一起使用的 RPC 动态端口分配</span><span class="sxs-lookup"><span data-stu-id="47729-377">How to configure RPC dynamic port allocation to work with firewalls</span></span>](https://support.microsoft.com/kb/154596/)  
  
##  <a name="interaction-with-other-firewall-rules"></a><a name="BKMK_other_rules"></a> <span data-ttu-id="47729-378">与其他防火墙规则的交互</span><span class="sxs-lookup"><span data-stu-id="47729-378">Interaction with Other Firewall Rules</span></span>  
 <span data-ttu-id="47729-379">Windows 防火墙使用规则和规则组建立其配置。</span><span class="sxs-lookup"><span data-stu-id="47729-379">The Windows Firewall uses rules and rule groups to establish its configuration.</span></span> <span data-ttu-id="47729-380">每个规则或规则组通常与特定程序或服务相关，并且该程序和服务可以在您不知道的情况下修改或删除相应规则。</span><span class="sxs-lookup"><span data-stu-id="47729-380">Each rule or rule group is generally associated with a particular program or service, and that program or service might modify or delete that rule without your knowledge.</span></span> <span data-ttu-id="47729-381">例如，规则组“万维网服务 (HTTP)”  和“万维网服务 (HTTPS)”  与 IIS 相关。</span><span class="sxs-lookup"><span data-stu-id="47729-381">For example, the rule groups **World Wide Web Services (HTTP)** and **World Wide Web Services (HTTPS)** are associated with IIS.</span></span> <span data-ttu-id="47729-382">启用这些规则将打开端口 80 和 443，并且如果启用这些规则，则依赖端口 80 和 443 的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 功能将能正常工作。</span><span class="sxs-lookup"><span data-stu-id="47729-382">Enabling those rules will open ports 80 and 443, and [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] features that depend on ports 80 and 443 will function if those rules are enabled.</span></span> <span data-ttu-id="47729-383">不过，配置 IIS 的管理员可能会修改或禁用这些规则。</span><span class="sxs-lookup"><span data-stu-id="47729-383">However, administrators configuring IIS might modify or disable those rules.</span></span> <span data-ttu-id="47729-384">因此，如果您为 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]使用端口 80 或端口 443，则应创建您自己的规则或规则组，这样可以独立于其他 IIS 规则之外维护您的所需端口配置。</span><span class="sxs-lookup"><span data-stu-id="47729-384">Therefore, if you are using port 80 or port 443 for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], you should create your own rule or rule group that maintains your desired port configuration independently of the other IIS rules.</span></span>  
  
 <span data-ttu-id="47729-385">高级安全 Windows 防火墙 MMC 管理单元允许符合任何适用允许规则的所有通信。</span><span class="sxs-lookup"><span data-stu-id="47729-385">The Windows Firewall with Advanced Security MMC snap-in allows any traffic that matches any applicable allow rule.</span></span> <span data-ttu-id="47729-386">因此，如果有两个均应用于端口 80 的规则（具有不同的参数），则符合任一规则的通信都将得到允许。</span><span class="sxs-lookup"><span data-stu-id="47729-386">So if there are two rules that both apply to port 80 (with different parameters), traffic that matches either rule will be permitted.</span></span> <span data-ttu-id="47729-387">因此，如果一个规则允许来自本地子网的通过端口 80 的通信而另一个规则允许来自任意地址的通信，则实际结果是不管通信来源是什么，所有通向端口 80 的通信都将得到允许。</span><span class="sxs-lookup"><span data-stu-id="47729-387">So if one rule allows traffic over port 80 from local subnet and one rule allows traffic from any address, the net effect is that all traffic to port 80 is permitted regardless of the source.</span></span> <span data-ttu-id="47729-388">若要有效地管理对 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]的访问，管理员应定期查看服务器上启用的所有防火墙规则。</span><span class="sxs-lookup"><span data-stu-id="47729-388">To effectively manage access to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], administrators should periodically review all firewall rules enabled on the server.</span></span>  
  
##  <a name="overview-of-firewall-profiles"></a><a name="BKMK_profiles"></a> <span data-ttu-id="47729-389">防火墙配置文件概述</span><span class="sxs-lookup"><span data-stu-id="47729-389">Overview of Firewall Profiles</span></span>  
 <span data-ttu-id="47729-390">[高级安全 Windows 防火墙入门指南](https://go.microsoft.com/fwlink/?LinkId=116080) 中的 **识别网络位置的主机防火墙**部分介绍了防火墙配置文件。</span><span class="sxs-lookup"><span data-stu-id="47729-390">Firewall profiles are discussed in [Windows Firewall with Advanced Security Getting Started Guide](https://go.microsoft.com/fwlink/?LinkId=116080) in the section **Network location-aware host firewall**.</span></span> <span data-ttu-id="47729-391">总之，操作系统可按照连接性、连接数和类别来识别并记住与它们连接的每个网络。</span><span class="sxs-lookup"><span data-stu-id="47729-391">To summarize, the operating systems identify and remember each of the networks to which they connect with regard to connectivity, connections, and category.</span></span>  
  
 <span data-ttu-id="47729-392">在高级安全 Windows 防火墙中有三种网络位置类型：</span><span class="sxs-lookup"><span data-stu-id="47729-392">There are three network location types in Windows Firewall with Advanced Security:</span></span>  
  
-   <span data-ttu-id="47729-393">域。</span><span class="sxs-lookup"><span data-stu-id="47729-393">Domain.</span></span> <span data-ttu-id="47729-394">Windows 可以验证对计算机所联接域的域控制器的访问。</span><span class="sxs-lookup"><span data-stu-id="47729-394">Windows can authenticate access to the domain controller for the domain to which the computer is joined.</span></span>  
  
-   <span data-ttu-id="47729-395">Public。</span><span class="sxs-lookup"><span data-stu-id="47729-395">Public.</span></span> <span data-ttu-id="47729-396">除域网络之外，其他所有网络最初都归为公共网络一类。</span><span class="sxs-lookup"><span data-stu-id="47729-396">Other than domain networks, all networks are initially categorized as public.</span></span> <span data-ttu-id="47729-397">直接连到 Internet 的网络或者位于公共场所（如机场和咖啡店）的网络应保留为公共网络。</span><span class="sxs-lookup"><span data-stu-id="47729-397">Networks that represent direct connections to the Internet or are in public locations, such as airports and coffee shops should be left public.</span></span>  
  
-   <span data-ttu-id="47729-398">Private。</span><span class="sxs-lookup"><span data-stu-id="47729-398">Private.</span></span> <span data-ttu-id="47729-399">由用户或应用程序标识为专用的网络。</span><span class="sxs-lookup"><span data-stu-id="47729-399">A network identified by a user or application as private.</span></span> <span data-ttu-id="47729-400">只应将可信网络标识为专用网络。</span><span class="sxs-lookup"><span data-stu-id="47729-400">Only trusted networks should be identified as private networks.</span></span> <span data-ttu-id="47729-401">用户很可能希望将家庭网络或小型企业网络标识为专用网络。</span><span class="sxs-lookup"><span data-stu-id="47729-401">Users will likely want to identify home or small business networks as private.</span></span>  
  
 <span data-ttu-id="47729-402">管理员可以为每种网络位置类型创建一个配置文件，每个配置文件均包含不同的防火墙策略。</span><span class="sxs-lookup"><span data-stu-id="47729-402">The administrator can create a profile for each network location type, with each profile containing different firewall policies.</span></span> <span data-ttu-id="47729-403">在任何时候只能应用一个配置文件。</span><span class="sxs-lookup"><span data-stu-id="47729-403">Only one profile is applied at any time.</span></span> <span data-ttu-id="47729-404">应用配置文件的顺序如下：</span><span class="sxs-lookup"><span data-stu-id="47729-404">Profile order is applied as follows:</span></span>  
  
1.  <span data-ttu-id="47729-405">如果要向计算机所属域的域控制器验证所有接口，则应用域配置文件。</span><span class="sxs-lookup"><span data-stu-id="47729-405">If all interfaces are authenticated to the domain controller for the domain of which the computer is a member, the domain profile is applied.</span></span>  
  
2.  <span data-ttu-id="47729-406">如果要向域控制器验证所有接口或者所有接口均连接到归为专用网络位置一类的网络，则应用专用配置文件。</span><span class="sxs-lookup"><span data-stu-id="47729-406">If all interfaces are either authenticated to the domain controller or are connected to networks that are classified as private network locations, the private profile is applied.</span></span>  
  
3.  <span data-ttu-id="47729-407">否则，应用公共配置文件。</span><span class="sxs-lookup"><span data-stu-id="47729-407">Otherwise, the public profile is applied.</span></span>  
  
 <span data-ttu-id="47729-408">使用高级安全 Windows 防火墙 MMC 管理单元查看和配置所有防火墙配置文件。</span><span class="sxs-lookup"><span data-stu-id="47729-408">Use the Windows Firewall with Advanced Security MMC snap-in to view and configure all firewall profiles.</span></span> <span data-ttu-id="47729-409">“控制面板”中的 **“Windows 防火墙”** 项仅可配置当前配置文件。</span><span class="sxs-lookup"><span data-stu-id="47729-409">The **Windows Firewall** item in Control Panel only configures the current profile.</span></span>  
  
##  <a name="additional-firewall-settings-using-the-windows-firewall-item-in-control-panel"></a><a name="BKMK_additional_settings"></a> <span data-ttu-id="47729-410">使用“控制面板”中的“Windows 防火墙”项进行其他防火墙设置</span><span class="sxs-lookup"><span data-stu-id="47729-410">Additional Firewall Settings Using the Windows Firewall Item in Control Panel</span></span>  
 <span data-ttu-id="47729-411">添加到防火墙的例外可以限制端口仅对来自特定计算机或本地子网的传入连接打开。</span><span class="sxs-lookup"><span data-stu-id="47729-411">Exceptions that you add to the firewall can restrict the opening of the port to incoming connections from specific computers or the local subnet.</span></span> <span data-ttu-id="47729-412">这种对端口打开范围的限制可以大大减少计算机对恶意用户的暴露程度，因此建议采用此类限制。</span><span class="sxs-lookup"><span data-stu-id="47729-412">This restriction of the scope of the port opening can reduce how much your computer is exposed to malicious users, and is recommended.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="47729-413">使用控制面板中的“Windows 防火墙”  项仅可配置当前防火墙配置文件。</span><span class="sxs-lookup"><span data-stu-id="47729-413">Using the **Windows Firewall** item in Control Panel only configures the current firewall profile.</span></span>  
  
#### <a name="to-change-the-scope-of-a-firewall-exception-using-the-windows-firewall-item-in-control-panel"></a><span data-ttu-id="47729-414">使用“控制面板”中的“Windows 防火墙”项更改防火墙例外的范围</span><span class="sxs-lookup"><span data-stu-id="47729-414">To change the scope of a firewall exception using the Windows Firewall item in Control Panel</span></span>  
  
1.  <span data-ttu-id="47729-415">在“控制面板”中的 **“Windows 防火墙”** 项的 **“例外”** 选项卡上，选择一个程序或端口，然后单击 **“属性”** 或 **“编辑”** 。</span><span class="sxs-lookup"><span data-stu-id="47729-415">In the **Windows Firewall** item in Control Panel, select a program or port on the **Exceptions** tab, and then click **Properties** or **Edit**.</span></span>  
  
2.  <span data-ttu-id="47729-416">在 **“编辑程序”** 或 **“编辑端口”** 对话框中，单击 **“更改范围”** 。</span><span class="sxs-lookup"><span data-stu-id="47729-416">In the **Edit a Program** or **Edit a Port** dialog box, click **Change Scope**.</span></span>  
  
3.  <span data-ttu-id="47729-417">选择以下选项之一：</span><span class="sxs-lookup"><span data-stu-id="47729-417">Choose one of the following options:</span></span>  
  
    -   <span data-ttu-id="47729-418">**任何计算机(包括 Internet 上的计算机)**</span><span class="sxs-lookup"><span data-stu-id="47729-418">**Any computer (including those on the Internet)**</span></span>  
  
         <span data-ttu-id="47729-419">建议不要使用。</span><span class="sxs-lookup"><span data-stu-id="47729-419">Not recommended.</span></span> <span data-ttu-id="47729-420">这将使任何可寻址到您计算机的计算机都可以连接到指定程序或端口。</span><span class="sxs-lookup"><span data-stu-id="47729-420">This will allow any computer that can address your computer to connect to the specified program or port.</span></span> <span data-ttu-id="47729-421">如果要允许向 Internet 上的匿名用户呈现信息，则此设置可能是必需的，不过这会增加您对于恶意用户的暴露程度。</span><span class="sxs-lookup"><span data-stu-id="47729-421">This setting might be necessary to allow information to be presented to anonymous users on the internet, but increases your exposure to malicious users.</span></span> <span data-ttu-id="47729-422">如果启用此设置，同时还允许网络地址转换 (NAT) 遍历（例如“允许边缘遍历”选项），则会进一步增加您的暴露程度。</span><span class="sxs-lookup"><span data-stu-id="47729-422">Your exposure can be further increased if you enable this setting and also allow Network Address Translation (NAT) traversal, such as the Allow edge traversal option.</span></span>  
  
    -   <span data-ttu-id="47729-423">**仅我的网络(子网)**</span><span class="sxs-lookup"><span data-stu-id="47729-423">**My network (subnet) only**</span></span>  
  
         <span data-ttu-id="47729-424">这是比 **“任何计算机”** 更安全的设置。</span><span class="sxs-lookup"><span data-stu-id="47729-424">This is a more secure setting than **Any computer**.</span></span> <span data-ttu-id="47729-425">只有网络的本地子网中的计算机可以连接到相应程序或端口。</span><span class="sxs-lookup"><span data-stu-id="47729-425">Only computers on the local subnet of your network can connect to the program or port.</span></span>  
  
    -   <span data-ttu-id="47729-426">**自定义列表：**</span><span class="sxs-lookup"><span data-stu-id="47729-426">**Custom list:**</span></span>  
  
     <span data-ttu-id="47729-427">只有具有列表中的 IP 地址的计算机可以连接。</span><span class="sxs-lookup"><span data-stu-id="47729-427">Only computers that have the IP addresses you list can connect.</span></span> <span data-ttu-id="47729-428">这是比“仅我的网络(子网)”  更安全的设置，不过，使用 DHCP 的客户端计算机有时候会更改它们的 IP 地址。</span><span class="sxs-lookup"><span data-stu-id="47729-428">This can be a more secure setting than **My network (subnet) only**, however, client computers using DHCP can occasionally change their IP address.</span></span> <span data-ttu-id="47729-429">这样的话，目标计算机将无法连接。</span><span class="sxs-lookup"><span data-stu-id="47729-429">Then the intended computer will not be able to connect.</span></span> <span data-ttu-id="47729-430">另一台您未打算授权的计算机可能接受这一列出的 IP 地址，从而能够连接。</span><span class="sxs-lookup"><span data-stu-id="47729-430">Another computer, which you had not intended to authorize, might accept the listed IP address and then be able to connect.</span></span> <span data-ttu-id="47729-431">如果希望列出其他配置为使用固定 IP 地址的服务器，则可能最好选择 **“自定义列表”** 选项；不过，入侵者可能会假冒 IP 地址。</span><span class="sxs-lookup"><span data-stu-id="47729-431">The **Custom list** option might be appropriate for listing other servers which are configured to use a fixed IP address; however, IP addresses might be spoofed by an intruder.</span></span> <span data-ttu-id="47729-432">限制防火墙规则的作用大小取决于网络基础结构的优劣。</span><span class="sxs-lookup"><span data-stu-id="47729-432">Restricting firewall rules are only as strong as your network infrastructure.</span></span>  
  
##  <a name="using-the-windows-firewall-with-advanced-security-snap-in"></a><a name="BKMK_WF_msc"></a> <span data-ttu-id="47729-433">使用高级安全 Windows 防火墙管理单元</span><span class="sxs-lookup"><span data-stu-id="47729-433">Using the Windows Firewall with Advanced Security Snap-in</span></span>  
 <span data-ttu-id="47729-434">可以通过使用高级安全 Windows 防火墙 MMC 管理单元来配置其他高级防火墙设置。</span><span class="sxs-lookup"><span data-stu-id="47729-434">Additional advanced firewall settings can be configured by using the Windows Firewall with Advanced Security MMC snap-in.</span></span> <span data-ttu-id="47729-435">此管理单元包括规则向导，并提供“控制面板”中的“Windows 防火墙”  项中未提供的附加设置。</span><span class="sxs-lookup"><span data-stu-id="47729-435">The snap-in includes a rule wizard and exposes additional settings that are not available in the **Windows Firewall** item in Control Panel.</span></span> <span data-ttu-id="47729-436">这些设置包括：</span><span class="sxs-lookup"><span data-stu-id="47729-436">These settings include the following:</span></span>  
  
-   <span data-ttu-id="47729-437">加密设置</span><span class="sxs-lookup"><span data-stu-id="47729-437">Encryption settings</span></span>  
  
-   <span data-ttu-id="47729-438">服务限制</span><span class="sxs-lookup"><span data-stu-id="47729-438">Services restrictions</span></span>  
  
-   <span data-ttu-id="47729-439">按名称限制计算机的连接</span><span class="sxs-lookup"><span data-stu-id="47729-439">Restricting connections for computers by name</span></span>  
  
-   <span data-ttu-id="47729-440">限制连接到特定用户或配置文件</span><span class="sxs-lookup"><span data-stu-id="47729-440">Restricting connections to specific users or profiles</span></span>  
  
-   <span data-ttu-id="47729-441">边缘遍历允许通信绕过网络地址转换 (NAT) 路由器</span><span class="sxs-lookup"><span data-stu-id="47729-441">Edge traversal allowing traffic to bypass Network Address Translation (NAT) routers</span></span>  
  
-   <span data-ttu-id="47729-442">配置出站规则</span><span class="sxs-lookup"><span data-stu-id="47729-442">Configuring outbound rules</span></span>  
  
-   <span data-ttu-id="47729-443">配置安全规则</span><span class="sxs-lookup"><span data-stu-id="47729-443">Configuring security rules</span></span>  
  
-   <span data-ttu-id="47729-444">传入连接需要 IPsec</span><span class="sxs-lookup"><span data-stu-id="47729-444">Requiring IPsec for incoming connections</span></span>  
  
#### <a name="to-create-a-new-firewall-rule-using-the-new-rule-wizard"></a><span data-ttu-id="47729-445">使用新建规则向导创建新防火墙规则</span><span class="sxs-lookup"><span data-stu-id="47729-445">To create a new firewall rule using the New Rule wizard</span></span>  
  
1.  <span data-ttu-id="47729-446">在 “开始” 菜单上，单击 **“运行”** ，键入 **WF.msc**，然后单击 **“确定”** 。</span><span class="sxs-lookup"><span data-stu-id="47729-446">On the Start menu, click **Run**, type **WF.msc**, and then click **OK**.</span></span>  
  
2.  <span data-ttu-id="47729-447">在“高级安全 Windows 防火墙”\*\*\*\* 的左窗格中，右键单击“入站规则”\*\*\*\*，然后单击“新建规则”\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="47729-447">In the **Windows Firewall with Advanced Security**, in the left pane, right-click **Inbound Rules**, and then click **New Rule**.</span></span>  
  
3.  <span data-ttu-id="47729-448">使用所需设置完成 **“新建入站规则向导”** 。</span><span class="sxs-lookup"><span data-stu-id="47729-448">Complete the **New Inbound Rule Wizard** using the settings that you want.</span></span>  
  
##  <a name="troubleshooting-firewall-settings"></a><a name="BKMK_troubleshooting"></a> <span data-ttu-id="47729-449">解决防火墙设置问题</span><span class="sxs-lookup"><span data-stu-id="47729-449">Troubleshooting Firewall Settings</span></span>  
 <span data-ttu-id="47729-450">以下工具和方法对于解决防火墙问题会非常有用：</span><span class="sxs-lookup"><span data-stu-id="47729-450">The following tools and techniques can be useful in troubleshooting firewall issues:</span></span>  
  
-   <span data-ttu-id="47729-451">有效端口状态是与端口相关的所有规则的总体作用结果。</span><span class="sxs-lookup"><span data-stu-id="47729-451">The effective port status is the union of all rules related to the port.</span></span> <span data-ttu-id="47729-452">当试图禁止通过某一端口访问时，查看引用该端口号的所有规则将会非常有用。</span><span class="sxs-lookup"><span data-stu-id="47729-452">When trying to block access through a port, it can be helpful to review all the rules which cite the port number.</span></span> <span data-ttu-id="47729-453">为此，请使用高级安全 Windows 防火墙 MMC 管理单元，并按端口号对入站和出站规则进行排序。</span><span class="sxs-lookup"><span data-stu-id="47729-453">To do this, use the Windows Firewall with Advanced Security MMC snap-in and sort the inbound and outbound rules by port number.</span></span>  
  
-   <span data-ttu-id="47729-454">查看在运行 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的计算机上处于活动状态的端口。</span><span class="sxs-lookup"><span data-stu-id="47729-454">Review the ports that are active on the computer on which [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is running.</span></span> <span data-ttu-id="47729-455">此检查过程包括确认正在侦听的 TCP/IP 端口，同时确认这些端口的状态。</span><span class="sxs-lookup"><span data-stu-id="47729-455">This review process includes verifying which TCP/IP ports are listening and also verifying the status of the ports.</span></span>  
  
     <span data-ttu-id="47729-456">若要验证哪些端口正在侦听，请使用 **netstat** 命令行实用工具。</span><span class="sxs-lookup"><span data-stu-id="47729-456">To verify which ports are listening, use the **netstat** command-line utility.</span></span> <span data-ttu-id="47729-457">除了显示活动 TCP 连接以外， **netstat** 实用工具还将显示多种 IP 统计信息和其他信息。</span><span class="sxs-lookup"><span data-stu-id="47729-457">In addition to displaying active TCP connections, the **netstat** utility also displays a variety of IP statistics and information.</span></span>  
  
    #### <a name="to-list-which-tcpip-ports-are-listening"></a><span data-ttu-id="47729-458">列出正在侦听的 TCP/IP 端口</span><span class="sxs-lookup"><span data-stu-id="47729-458">To list which TCP/IP ports are listening</span></span>  
  
    1.  <span data-ttu-id="47729-459">打开命令提示符窗口。</span><span class="sxs-lookup"><span data-stu-id="47729-459">Open the Command Prompt window.</span></span>  
  
    2.  <span data-ttu-id="47729-460">在命令提示符处，键入 `netstat -n -a`。</span><span class="sxs-lookup"><span data-stu-id="47729-460">At the command prompt, type `netstat -n -a`.</span></span>  
  
         <span data-ttu-id="47729-461">**-n** 开关指示 **netstat** 以数字方式显示活动 TCP 连接的地址和端口号。</span><span class="sxs-lookup"><span data-stu-id="47729-461">The **-n** switch instructs **netstat** to numerically display the address and port number of active TCP connections.</span></span> <span data-ttu-id="47729-462">**-a** 开关指示 **netstat** 显示计算机正在侦听的 TCP 和 UDP 端口。</span><span class="sxs-lookup"><span data-stu-id="47729-462">The **-a** switch instructs **netstat** to display the TCP and UDP ports on which the computer is listening.</span></span>  
  
-   <span data-ttu-id="47729-463">**PortQry** 实用工具可用于报告 TCP/IP 端口的状态（正在侦听、未在侦听或已筛选）。</span><span class="sxs-lookup"><span data-stu-id="47729-463">The **PortQry** utility can be used to report the status of TCP/IP ports as listening, not listening, or filtered.</span></span> <span data-ttu-id="47729-464">（对于已筛选状态，端口可能正在侦听，也可能未在侦听；此状态指示实用工具没有收到端口的响应。）**PortQry** 实用工具可以从 [Microsoft 下载中心](https://www.microsoft.com/download/details.aspx?id=17148)下载。</span><span class="sxs-lookup"><span data-stu-id="47729-464">(With a filtered status, the port might or might not be listening; this status indicates that the utility did not receive a response from the port.) The **PortQry** utility is available for download from the [Microsoft Download Center](https://www.microsoft.com/download/details.aspx?id=17148).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="47729-465">另请参阅</span><span class="sxs-lookup"><span data-stu-id="47729-465">See Also</span></span>  
 [<span data-ttu-id="47729-466">Windows Server 系统的服务概述和网络端口要求</span><span class="sxs-lookup"><span data-stu-id="47729-466">Service overview and network port requirements for the Windows Server system</span></span>](https://support.microsoft.com/kb/832017)  
