---
title: AlwaysOn 故障转移群集实例 (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- clustering [SQL Server]
- high availability [SQL Server], failover clustering
- virtual servers [SQL Server], about virtual servers
- clusters [SQL Server]
- servers [SQL Server], failover clustering
- resource groups [SQL Server]
- availability [SQL Server]
- failover clustering [SQL Server]
- AlwaysOn [SQL Server], see failover clustering [SQL Server]
ms.assetid: 86a15b33-4d03-4549-8ea2-b45e4f1baad7
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 6adc173560fd83d00616eb00c63651ef667c2a00
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87586274"
---
# <a name="always-on-failover-cluster-instances-sql-server"></a><span data-ttu-id="70cfb-102">AlwaysOn 故障转移群集实例 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="70cfb-102">Always On Failover Cluster Instances (SQL Server)</span></span>
  <span data-ttu-id="70cfb-103">作为 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Always On 产品/服务的一部分，Always On 故障转移群集实例利用 Windows Server 故障转移群集 (WSFC) 功能通过冗余在实例级别（故障转移群集实例 (FCI)）提供了本地高可用性\*\*。</span><span class="sxs-lookup"><span data-stu-id="70cfb-103">As part of the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Always On offering, Always On Failover Cluster Instances leverages Windows Server Failover Clustering (WSFC) functionality to provide local high availability through redundancy at the server-instance level-a *failover cluster instance* (FCI).</span></span> <span data-ttu-id="70cfb-104">FCI 是在 Windows Server 故障转移群集 (WSFC) 节点上和（可能）多个子网中安装的单个 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例。</span><span class="sxs-lookup"><span data-stu-id="70cfb-104">An FCI is a single instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] that is installed across Windows Server Failover Clustering (WSFC) nodes and, possibly, across multiple subnets.</span></span> <span data-ttu-id="70cfb-105">在网络中，FCI 显示为在单台计算机上运行的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例，不过它提供了从一个 WSFC 节点到另一个 WSFC 节点的故障转移（如果当前节点不可用）。</span><span class="sxs-lookup"><span data-stu-id="70cfb-105">On the network, an FCI appears to be an instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] running on a single computer, but the FCI provides failover from one WSFC node to another if the current node becomes unavailable.</span></span>  
  
 <span data-ttu-id="70cfb-106">FCI 可利用 [AlwaysOn 可用性组](../../../database-engine/availability-groups/windows/always-on-availability-groups-sql-server.md)提供数据库级别的远程灾难恢复。</span><span class="sxs-lookup"><span data-stu-id="70cfb-106">An FCI can leverage [Always On Availability Groups](../../../database-engine/availability-groups/windows/always-on-availability-groups-sql-server.md)to provide remote disaster recovery at the database level.</span></span> <span data-ttu-id="70cfb-107">有关详细信息，请参阅[故障转移群集和 AlwaysOn 可用性组 (SQL Server)](../../../database-engine/availability-groups/windows/failover-clustering-and-always-on-availability-groups-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="70cfb-107">For more information, see [Failover Clustering and Always On Availability Groups (;SQL Server);](../../../database-engine/availability-groups/windows/failover-clustering-and-always-on-availability-groups-sql-server.md).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="70cfb-108">从 [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] 中开始，AlwaysOn 故障转移群集实例支持 [!INCLUDE[winserver2008r2](../../../includes/winserver2008r2-md.md)] 和 [!INCLUDE[win8srv](../../../includes/win8srv-md.md)] 中的群集共享卷 (CSV)。</span><span class="sxs-lookup"><span data-stu-id="70cfb-108">Beginning in [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)], Always On Failover Cluster Instances supports Clustered Shared Volumes (CSV) in both [!INCLUDE[winserver2008r2](../../../includes/winserver2008r2-md.md)] and [!INCLUDE[win8srv](../../../includes/win8srv-md.md)].</span></span> <span data-ttu-id="70cfb-109">有关 CSV 的详细信息，请参阅 [了解故障转移群集中的群集共享卷](https://technet.microsoft.com/library/dd759255.aspx)。</span><span class="sxs-lookup"><span data-stu-id="70cfb-109">For more information on CSV, see [Understanding Cluster Shared Volumes in a Failover Cluster](https://technet.microsoft.com/library/dd759255.aspx).</span></span>  
  
 <span data-ttu-id="70cfb-110">**本主题内容：**</span><span class="sxs-lookup"><span data-stu-id="70cfb-110">**In this Topic:**</span></span>  
  
-   [<span data-ttu-id="70cfb-111">优点</span><span class="sxs-lookup"><span data-stu-id="70cfb-111">Benefits</span></span>](#Benefits)  
  
-   [<span data-ttu-id="70cfb-112">建议</span><span class="sxs-lookup"><span data-stu-id="70cfb-112">Recommendations</span></span>](#Recommendations)  
  
-   [<span data-ttu-id="70cfb-113">故障转移群集实例概述</span><span class="sxs-lookup"><span data-stu-id="70cfb-113">Failover Cluster Instance Overview</span></span>](#Overview)  
  
-   [<span data-ttu-id="70cfb-114">故障转移群集实例的元素</span><span class="sxs-lookup"><span data-stu-id="70cfb-114">Elements of a Failover Cluster Instance</span></span>](#FCIelements)  
  
-   [<span data-ttu-id="70cfb-115">SQL Server 故障转移的概念和任务</span><span class="sxs-lookup"><span data-stu-id="70cfb-115">SQL Server Failover Concepts and Tasks</span></span>](#ConceptsAndTasks)  
  
-   [<span data-ttu-id="70cfb-116">相关主题</span><span class="sxs-lookup"><span data-stu-id="70cfb-116">Related Topics</span></span>](#RelatedTopics)  
  
##  <a name="benefits-of-a-failover-cluster-instance"></a><a name="Benefits"></a> <span data-ttu-id="70cfb-117">故障转移群集实例的优点</span><span class="sxs-lookup"><span data-stu-id="70cfb-117">Benefits of a Failover Cluster Instance</span></span>  
 <span data-ttu-id="70cfb-118">当服务器上出现硬件或软件故障时，连接到该服务器的应用程序或客户端将会停机。</span><span class="sxs-lookup"><span data-stu-id="70cfb-118">When there is hardware or software failure of a server, the applications or clients connecting to the server will experience downtime.</span></span> <span data-ttu-id="70cfb-119">在将 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例配置为 FCI（而非独立实例）时，该 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例的高可用性受到 FCI 中提供的冗余节点的保护。</span><span class="sxs-lookup"><span data-stu-id="70cfb-119">When a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance is configured to be an FCI (instead of a standalone instance), the high availability of that [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance is protected by the presence of redundant nodes in the FCI.</span></span> <span data-ttu-id="70cfb-120">在 FCI 中，一次只能有一个节点拥有 WSFC 资源组。</span><span class="sxs-lookup"><span data-stu-id="70cfb-120">Only one of the nodes in the FCI owns the WSFC resource group at a time.</span></span> <span data-ttu-id="70cfb-121">在出现故障（硬件故障、操作系统故障、应用程序或服务故障）或进行计划的升级时，该资源组的所有权就会转移至另一个 WSFC 节点。</span><span class="sxs-lookup"><span data-stu-id="70cfb-121">In case of a failure (hardware failures, operating system failures, application or service failures), or a planned upgrade, the resource group ownership is moved to another WSFC node.</span></span> <span data-ttu-id="70cfb-122">此过程对于连接到 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 的客户端或应用程序是透明的，可以最大限度地缩短出现故障时应用程序或客户端的停机时间。</span><span class="sxs-lookup"><span data-stu-id="70cfb-122">This process is transparent to the client or application connecting to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and this minimize the downtime the application or clients experience during a failure.</span></span> <span data-ttu-id="70cfb-123">以下列出了 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 故障转移群集实例提供的一些主要优点：</span><span class="sxs-lookup"><span data-stu-id="70cfb-123">The following lists some key benefits that [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover cluster instances provide:</span></span>  
  
-   <span data-ttu-id="70cfb-124">通过冗余提供实例级的保护</span><span class="sxs-lookup"><span data-stu-id="70cfb-124">Protection at the instance level through redundancy</span></span>  
  
-   <span data-ttu-id="70cfb-125">在出现故障（硬件故障、操作系统故障、应用程序或服务故障）时自动进行故障转移</span><span class="sxs-lookup"><span data-stu-id="70cfb-125">Automatic failover in the event of a failure (hardware failures, operating system failures, application or service failures)</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="70cfb-126">在 Always On 可用性组中，不支持从 FCI 到可用性组中其他节点的自动故障转移。</span><span class="sxs-lookup"><span data-stu-id="70cfb-126">In an Always On availability group, automatic failover from an FCI to other nodes within the availability group is not supported.</span></span> <span data-ttu-id="70cfb-127">这意味着，如果自动故障转移是高可用性解决方案的一个重要组成部分，则 FCI 和独立节点不应在某一可用性组中结合在一起使用。</span><span class="sxs-lookup"><span data-stu-id="70cfb-127">This means that FCIs and standalone nodes should not be coupled together within an availability group if automatic failover is an important component your high availability solution.</span></span> <span data-ttu-id="70cfb-128">\*\* 不过，对于灾难恢复解决方案而言，可以进行此类结合使用。</span><span class="sxs-lookup"><span data-stu-id="70cfb-128">However, this coupling can be made for your *disaster recovery* solution.</span></span>  
  
-   <span data-ttu-id="70cfb-129">支持多种存储解决方案，包括 WSFC 群集磁盘（iSCSI、光纤信道等）和服务器消息块 (SMB) 文件共享。</span><span class="sxs-lookup"><span data-stu-id="70cfb-129">Support for a broad array of storage solutions, including WSFC cluster disks (iSCSI, Fiber Channel, and so on) and server message block (SMB) file shares.</span></span>  
  
-   <span data-ttu-id="70cfb-130">使用多子网 FCI 或在 Always On 可用性组中运行 FCI 托管数据库的灾难恢复解决方案。</span><span class="sxs-lookup"><span data-stu-id="70cfb-130">Disaster recovery solution using a multi-subnet FCI or running an FCI-hosted database inside an Always On availability group.</span></span> <span data-ttu-id="70cfb-131">利用 [!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)]中的新的多子网支持功能，多子网 FCI 不再需要虚拟 LAN，因此可提高多子网 FCI 的可管理性和安全性。</span><span class="sxs-lookup"><span data-stu-id="70cfb-131">With the new multi-subnet support in [!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)], a multi-subnet FCI no longer requires a virtual LAN, increasing the manageability and security of a multi-subnet FCI.</span></span>  
  
-   <span data-ttu-id="70cfb-132">故障转移过程中无需重新配置应用程序和客户端</span><span class="sxs-lookup"><span data-stu-id="70cfb-132">Zero reconfiguration of applications and clients during failovers</span></span>  
  
-   <span data-ttu-id="70cfb-133">用于实现自动故障转移的针对具体触发器事件的灵活的故障转移策略</span><span class="sxs-lookup"><span data-stu-id="70cfb-133">Flexible failover policy for granular trigger events for automatic failovers</span></span>  
  
-   <span data-ttu-id="70cfb-134">通过使用专用和持久的连接执行定期的详细运行状况检测，实现可靠的故障转移</span><span class="sxs-lookup"><span data-stu-id="70cfb-134">Reliable failovers through periodic and detailed health detection using dedicated and persisted connections</span></span>  
  
-   <span data-ttu-id="70cfb-135">通过间接后台检查点在故障转移期间实现可配置性和可预测性</span><span class="sxs-lookup"><span data-stu-id="70cfb-135">Configurability and predictability in failover time through indirect background checkpoints</span></span>  
  
-   <span data-ttu-id="70cfb-136">故障转移期间限制对资源的使用</span><span class="sxs-lookup"><span data-stu-id="70cfb-136">Throttled resource usage during failovers</span></span>  
  
##  <a name="recommendations"></a><a name="Recommendations"></a> <span data-ttu-id="70cfb-137">建议</span><span class="sxs-lookup"><span data-stu-id="70cfb-137">Recommendations</span></span>  
 <span data-ttu-id="70cfb-138">在生产环境中，我们建议将静态 IP 地址与故障转移群集实例的虚拟 IP 地址结合使用。</span><span class="sxs-lookup"><span data-stu-id="70cfb-138">In a production environment, we recommend that you use static IP addresses in conjunction the virtual IP address of a Failover Cluster Instance.</span></span>  <span data-ttu-id="70cfb-139">我们不建议在生产环境中使用 DHCP。</span><span class="sxs-lookup"><span data-stu-id="70cfb-139">We recommend against using DHCP in a production environment.</span></span> <span data-ttu-id="70cfb-140">在停机情况下，如果 DHCP IP 租期已到，则它需要额外的时间重新注册与 DNS 名称关联的新 DHCP IP 地址。</span><span class="sxs-lookup"><span data-stu-id="70cfb-140">In the event of down time, if the DHCP IP lease expires, extra time is required to re-register the new DHCP IP address associated with the DNS name.</span></span>  
  
##  <a name="failover-cluster-instance-overview"></a><a name="Overview"></a><span data-ttu-id="70cfb-141">故障转移群集实例概述</span><span class="sxs-lookup"><span data-stu-id="70cfb-141">Failover Cluster Instance Overview</span></span>  
 <span data-ttu-id="70cfb-142">FCI 会在具有一个或多个 WSFC 节点的 WSFC 资源组中运行。</span><span class="sxs-lookup"><span data-stu-id="70cfb-142">An FCI runs in a WSFC resource group with one or more WSFC nodes.</span></span> <span data-ttu-id="70cfb-143">当 FCI 启动时，这些节点中的某个节点将获取该资源组的所有权并使其 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例处于联机状态。</span><span class="sxs-lookup"><span data-stu-id="70cfb-143">When the FCI starts up, one of the nodes assume ownership of the resource group and brings its [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance online.</span></span> <span data-ttu-id="70cfb-144">此节点拥有的资源包括：</span><span class="sxs-lookup"><span data-stu-id="70cfb-144">The resources owned by this node include:</span></span>  
  
-   <span data-ttu-id="70cfb-145">网络名称</span><span class="sxs-lookup"><span data-stu-id="70cfb-145">Network name</span></span>  
  
-   <span data-ttu-id="70cfb-146">IP 地址</span><span class="sxs-lookup"><span data-stu-id="70cfb-146">IP address</span></span>  
  
-   <span data-ttu-id="70cfb-147">共享磁盘</span><span class="sxs-lookup"><span data-stu-id="70cfb-147">Shared disks</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="70cfb-148">数据库引擎服务</span><span class="sxs-lookup"><span data-stu-id="70cfb-148">Database Engine service</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="70cfb-149">代理服务</span><span class="sxs-lookup"><span data-stu-id="70cfb-149">Agent service</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="70cfb-150">Analysis Services 服务（如果已安装）</span><span class="sxs-lookup"><span data-stu-id="70cfb-150">Analysis Services service, if installed</span></span>  
  
-   <span data-ttu-id="70cfb-151">一个文件共享资源（如果安装了 FILESTREAM 功能）</span><span class="sxs-lookup"><span data-stu-id="70cfb-151">One file share resource, if the FILESTREAM feature is installed</span></span>  
  
 <span data-ttu-id="70cfb-152">任何时候，只有资源组所有者（而非 FCI 中的任何其他节点）将在资源组中运行各自的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 服务。</span><span class="sxs-lookup"><span data-stu-id="70cfb-152">At any time, only the resource group owner (and no other node in the FCI) is running its respective [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] services in the resource group.</span></span> <span data-ttu-id="70cfb-153">在出现故障转移（无论是自动故障转移还是计划的故障转移）时，将发生以下事件序列：</span><span class="sxs-lookup"><span data-stu-id="70cfb-153">When a failover occurs, whether it be an automatic failover or a planned failover, the following sequence of events happen:</span></span>  
  
1.  <span data-ttu-id="70cfb-154">除非出现硬件或系统故障，否则会将缓冲区缓存中的所有脏页写入磁盘。</span><span class="sxs-lookup"><span data-stu-id="70cfb-154">Unless a hardware or system failure occurs, all dirty pages in the buffer cache are written to disk.</span></span>  
  
2.  <span data-ttu-id="70cfb-155">资源组中所有相应的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 服务都将在活动节点上停止。</span><span class="sxs-lookup"><span data-stu-id="70cfb-155">All respective [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] services in the resource group are stopped on the active node.</span></span>  
  
3.  <span data-ttu-id="70cfb-156">资源组所有权将转移到 FCI 中的另一个节点。</span><span class="sxs-lookup"><span data-stu-id="70cfb-156">The resource group ownership is transferred to another node in the FCI.</span></span>  
  
4.  <span data-ttu-id="70cfb-157">新资源组所有者将启动其 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 服务。</span><span class="sxs-lookup"><span data-stu-id="70cfb-157">The new resource group owner starts its [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] services.</span></span>  
  
5.  <span data-ttu-id="70cfb-158">客户端应用程序连接请求将自动定向到使用相同虚拟网络名称 (VNN) 的新活动节点。</span><span class="sxs-lookup"><span data-stu-id="70cfb-158">Client application connection requests are automatically directed to the new active node using the same virtual network name (VNN).</span></span>  
  
 <span data-ttu-id="70cfb-159">只要 FCI 的基础 WSFC 群集处于良好的仲裁运行状况（大多数仲裁 WSFC 节点可用作自动故障转移目标），FCI 就将处于联机状态。</span><span class="sxs-lookup"><span data-stu-id="70cfb-159">The FCI is online as long as its underlying WSFC cluster is in good quorum health (the majority of the quorum WSFC nodes are available as automatic failover targets).</span></span> <span data-ttu-id="70cfb-160">当 WSFC 群集丢失其仲裁时（无论此情况是因硬件、软件、网络故障还是不适当的仲裁配置导致的），整个 WSCF 群集以及 FCI 将脱机。</span><span class="sxs-lookup"><span data-stu-id="70cfb-160">When the WSFC cluster loses its quorum, whether due to hardware, software, network failure, or improper quorum configuration, the entire WSFC cluster, along with the FCI, is brought offline.</span></span> <span data-ttu-id="70cfb-161">在此计划外故障转移方案中，需要手动干预以在剩余可用节点中重新建立仲裁，以使 WSFC 群集和 FCI 重新联机。</span><span class="sxs-lookup"><span data-stu-id="70cfb-161">Manual intervention is then required in this unplanned failover scenario to reestablish quorum in the remaining available nodes in order to bring the WSFC cluster and FCI back online.</span></span> <span data-ttu-id="70cfb-162">有关详细信息，请参阅[WSFC 仲裁模式和投票配置 (;SQL Server) ;](wsfc-quorum-modes-and-voting-configuration-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="70cfb-162">For more information, see [WSFC Quorum Modes and Voting Configuration (;SQL Server);](wsfc-quorum-modes-and-voting-configuration-sql-server.md).</span></span>  
  
### <a name="predictable-failover-time"></a><span data-ttu-id="70cfb-163">可预测的故障转移时间</span><span class="sxs-lookup"><span data-stu-id="70cfb-163">Predictable Failover Time</span></span>  
 <span data-ttu-id="70cfb-164">根据 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例上次执行检查点操作的时间，缓冲区缓存中可能存在大量脏页。</span><span class="sxs-lookup"><span data-stu-id="70cfb-164">Depending on when your [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance last performed a checkpoint operation, there can be a substantial amount of dirty pages in the buffer cache.</span></span> <span data-ttu-id="70cfb-165">因此，故障转移持续的时间取决于将剩余脏页写入磁盘的时间，这会导致不可预测的较长的故障转移时间。</span><span class="sxs-lookup"><span data-stu-id="70cfb-165">Consequently, failovers last as long as it takes to write the remaining dirty pages to disk, which can lead to long and unpredictable failover time.</span></span> <span data-ttu-id="70cfb-166">从 [!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)]开始，FCI 可以使用间接检查点来限制保存在缓冲区缓存中的脏页数。</span><span class="sxs-lookup"><span data-stu-id="70cfb-166">Beginning with [!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)], the FCI can use indirect checkpoints to throttle the amount of dirty pages kept in the buffer cache.</span></span> <span data-ttu-id="70cfb-167">虽然这样做会导致在常规工作负荷下占用额外资源，但将提高故障转移时间的可预测性和可配置性。</span><span class="sxs-lookup"><span data-stu-id="70cfb-167">While this does consume additional resources under regular workload, it makes the failover time more predictable as well as more configurable.</span></span> <span data-ttu-id="70cfb-168">这在组织中的服务级协议指定高可用性解决方案的还原时间目标 (RPO) 时很有用。</span><span class="sxs-lookup"><span data-stu-id="70cfb-168">This is very useful when the service-level agreement in your organization specifies the recovery time objective (RTO) for your high availability solution.</span></span> <span data-ttu-id="70cfb-169">有关间接检查点的详细信息，请参阅 [Indirect Checkpoints](../../../relational-databases/logs/database-checkpoints-sql-server.md#IndirectChkpt)。</span><span class="sxs-lookup"><span data-stu-id="70cfb-169">For more information on indirect checkpoints, see [Indirect Checkpoints](../../../relational-databases/logs/database-checkpoints-sql-server.md#IndirectChkpt).</span></span>  
  
### <a name="reliable-health-monitoring-and-flexible-failover-policy"></a><span data-ttu-id="70cfb-170">可靠的运行状况监视和灵活的故障转移策略</span><span class="sxs-lookup"><span data-stu-id="70cfb-170">Reliable Health Monitoring and Flexible Failover Policy</span></span>  
 <span data-ttu-id="70cfb-171">成功启动 FCI 后，WSFC 服务将监视基础 WSFC 群集的运行状况和 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例的运行状况。</span><span class="sxs-lookup"><span data-stu-id="70cfb-171">After the FCI starts successfully, the WSFC service monitors both the health of the underlying WSFC cluster, as well as the health of the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="70cfb-172">从 [!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)]开始，WSFC 服务使用专用连接来轮询活动 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例，以便通过系统存储过程获取详细的组件诊断信息。</span><span class="sxs-lookup"><span data-stu-id="70cfb-172">Beginning with [!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)], the WSFC service uses a dedicated connection to poll the active [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance for detailed component diagnostics through a system stored procedure.</span></span> <span data-ttu-id="70cfb-173">这蕴含了三方面的含义：</span><span class="sxs-lookup"><span data-stu-id="70cfb-173">The implication of this is three-fold:</span></span>  
  
-   <span data-ttu-id="70cfb-174">利用与 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例的专用连接，始终能够对组件诊断信息进行可靠轮询，即使在 FCI 负荷较重时也是如此。</span><span class="sxs-lookup"><span data-stu-id="70cfb-174">The dedicated connection to the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance makes it possible to reliably poll for component diagnostics all the time, even when the FCI is under heavy load.</span></span> <span data-ttu-id="70cfb-175">这样一来，便能够区分负荷较重的系统与实际具有故障条件的系统，从而阻止出现诸如错误故障转移这样的问题。</span><span class="sxs-lookup"><span data-stu-id="70cfb-175">This makes it possible to distinguish between a system that is under heavy load and a system that actually has failure conditions, thus preventing issues such as false failovers.</span></span>  
  
-   <span data-ttu-id="70cfb-176">利用详细组件诊断信息，可以配置更灵活的故障转移策略，由此您便能选择哪些故障条件将触发故障转移以及哪些故障条件将不触发故障转移。</span><span class="sxs-lookup"><span data-stu-id="70cfb-176">The detailed component diagnostics makes it possible to configure a more flexible failover policy, whereby you can choose what failure conditions trigger failovers and which failure conditions do not.</span></span>  
  
-   <span data-ttu-id="70cfb-177">利用详细组件诊断信息，还可以通过追溯方式更好地对自动故障转移进行故障排除。</span><span class="sxs-lookup"><span data-stu-id="70cfb-177">The detailed component diagnostics also enables better troubleshooting of automatic failovers retroactively.</span></span> <span data-ttu-id="70cfb-178">诊断信息将存储到与 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 错误日志并置的日志文件中。</span><span class="sxs-lookup"><span data-stu-id="70cfb-178">The diagnostic information is stored to log files, which are collocated with the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] error logs.</span></span> <span data-ttu-id="70cfb-179">可以将这些日志文件加载到日志文件查看器中以检查导致出现故障转移的组件状态，从而确定导致该故障转移的原因。</span><span class="sxs-lookup"><span data-stu-id="70cfb-179">You can load them into the Log File Viewer to inspect the component states leading up to the failover occurrence in order to determine what cause that failover.</span></span>  
  
 <span data-ttu-id="70cfb-180">有关详细信息，请参阅[故障转移群集实例的故障转移策略](failover-policy-for-failover-cluster-instances.md)</span><span class="sxs-lookup"><span data-stu-id="70cfb-180">For more information, see [Failover Policy for Failover Cluster Instances](failover-policy-for-failover-cluster-instances.md)</span></span>  
  
##  <a name="elements-of-a-failover-cluster-instance"></a><a name="FCIelements"></a><span data-ttu-id="70cfb-181">故障转移群集实例的元素</span><span class="sxs-lookup"><span data-stu-id="70cfb-181">Elements of a Failover Cluster Instance</span></span>  
 <span data-ttu-id="70cfb-182">FCI 由一组物理服务器（节点）构成，这些服务器包含类似的硬件配置以及相同的软件配置，其中包括操作系统版本和修补程序级别，以及 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 版本、修补程序级别、组件和实例名称。</span><span class="sxs-lookup"><span data-stu-id="70cfb-182">An FCI consists of a set of physical servers (nodes) that contain similar hardware configuration as well as identical software configuration that includes operating system version and patch level, and [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] version, patch level, components, and instance name.</span></span> <span data-ttu-id="70cfb-183">相同的软件配置是确保 FCI 在节点间进行故障转移时能够正常运行所必需的。</span><span class="sxs-lookup"><span data-stu-id="70cfb-183">Identical software configuration is necessary to ensure that the FCI can be fully functional as it fails over between the nodes.</span></span>  
  
 <span data-ttu-id="70cfb-184">WSFC 资源组</span><span class="sxs-lookup"><span data-stu-id="70cfb-184">WSFC Resource Group</span></span>  
 <span data-ttu-id="70cfb-185">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] FCI 在 WSFC 资源组中运行。</span><span class="sxs-lookup"><span data-stu-id="70cfb-185">A [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] FCI runs in a WSFC resource group.</span></span> <span data-ttu-id="70cfb-186">该资源组中的每个节点均维护配置设置和检查点注册表项的同步副本，以确保 FCI 在故障转移后可完全正常运行，并且群集中一次只有一个节点（活动节点）拥有该资源组。</span><span class="sxs-lookup"><span data-stu-id="70cfb-186">Each node in the resource group maintains a synchronized copy of the configuration settings and check-pointed registry keys to ensure full functionality of the FCI after a failover, and only one of the nodes in the cluster owns the resource group at a time (the active node).</span></span> <span data-ttu-id="70cfb-187">WSFC 服务可管理服务器群集、仲裁配置、故障转移策略和故障转移操作以及 FCI 的 VNN 和虚拟 IP 地址。</span><span class="sxs-lookup"><span data-stu-id="70cfb-187">The WSFC service manages the server cluster, quorum configuration, failover policy, and failover operations, as well as the VNN and virtual IP addresses for the FCI.</span></span> <span data-ttu-id="70cfb-188">在出现故障（硬件故障、操作系统故障、应用程序或服务故障）或进行计划的升级时，资源组所有权就转移至 FCI 中的另一个节点。WSFC 资源组中支持的节点数取决于 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 版本。</span><span class="sxs-lookup"><span data-stu-id="70cfb-188">In case of a failure (hardware failures, operating system failures, application or service failures) or a planned upgrade, the resource group ownership is moved to another node in the FCI.The number of nodes that are supported in a WSFC resource group depends on your [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] edition.</span></span> <span data-ttu-id="70cfb-189">另外，同一个 WSFC 群集可运行多个 FCI（多个资源组），具体取决于您的硬件能力（如 CPU、内存和磁盘数）。</span><span class="sxs-lookup"><span data-stu-id="70cfb-189">Also, the same WSFC cluster can run multiple FCIs (multiple resource groups), depending on your hardware capacity, such as CPUs, memory, and number of disks.</span></span>  
  
 <span data-ttu-id="70cfb-190">SQL Server 二进制文件</span><span class="sxs-lookup"><span data-stu-id="70cfb-190">SQL Server Binaries</span></span>  
 <span data-ttu-id="70cfb-191">产品二进制文件本地安装在 FCI 的每个节点上，此过程类似于 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 独立安装。</span><span class="sxs-lookup"><span data-stu-id="70cfb-191">The product binaries are installed locally on each node of the FCI, a process similar to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] stand-alone installations.</span></span> <span data-ttu-id="70cfb-192">但是，在启动过程中，服务将不会自动启动，而是由 WSFC 管理。</span><span class="sxs-lookup"><span data-stu-id="70cfb-192">However, during startup, the services are not started automatically, but managed by WSFC.</span></span>  
  
 <span data-ttu-id="70cfb-193">存储</span><span class="sxs-lookup"><span data-stu-id="70cfb-193">Storage</span></span>  
 <span data-ttu-id="70cfb-194">与 Always On 可用性组相反，对于数据库和日志存储，FCI 必须在 FCI 的所有节点之间使用共享存储。</span><span class="sxs-lookup"><span data-stu-id="70cfb-194">Contrary to the Always On availability group, an FCI must use shared storage between all nodes of the FCI for database and log storage.</span></span> <span data-ttu-id="70cfb-195">共享存储的形式可以为 WSFC 群集磁盘、SAN 上的磁盘或 SMB 上的文件共享。</span><span class="sxs-lookup"><span data-stu-id="70cfb-195">The shared storage can be in the form of WSFC cluster disks, disks on a SAN, or file shares on an SMB.</span></span> <span data-ttu-id="70cfb-196">这样一来，当发生故障转移时，FCI 中的所有节点都会具有相同的实例数据视图。</span><span class="sxs-lookup"><span data-stu-id="70cfb-196">This way, all nodes in the FCI have the same view of instance data whenever a failover occurs.</span></span> <span data-ttu-id="70cfb-197">但这意味着，共享存储有可能成为单个故障点，并且 FCI 依赖于基本存储解决方案来确保数据保护。</span><span class="sxs-lookup"><span data-stu-id="70cfb-197">This does mean, however, that the shared storage has the potential of being the single point of failure, and FCI depends on the underlying storage solution to ensure data protection.</span></span>  
  
 <span data-ttu-id="70cfb-198">网络名称</span><span class="sxs-lookup"><span data-stu-id="70cfb-198">Network Name</span></span>  
 <span data-ttu-id="70cfb-199">FCI 的 VNN 为 FCI 提供了一个统一连接点。</span><span class="sxs-lookup"><span data-stu-id="70cfb-199">The VNN for the FCI provides a unified connection point for the FCI.</span></span> <span data-ttu-id="70cfb-200">这将允许应用程序连接到 VNN，而无需知道当前活动节点。</span><span class="sxs-lookup"><span data-stu-id="70cfb-200">This allows applications to connect to the VNN without the need to know the currently active node.</span></span> <span data-ttu-id="70cfb-201">当发生故障转移时，VNN 会在新的活动节点启动后注册到该节点。</span><span class="sxs-lookup"><span data-stu-id="70cfb-201">When a failover occurs, the VNN is registered to the new active node after it starts.</span></span> <span data-ttu-id="70cfb-202">此过程对于连接到 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 的客户端或应用程序是透明的，可以最大限度地缩短出现故障时应用程序或客户端的停机时间。</span><span class="sxs-lookup"><span data-stu-id="70cfb-202">This process is transparent to the client or application connecting to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and this minimize the downtime the application or clients experience during a failure.</span></span>  
  
 <span data-ttu-id="70cfb-203">虚拟 IP</span><span class="sxs-lookup"><span data-stu-id="70cfb-203">Virtual IPs</span></span>  
 <span data-ttu-id="70cfb-204">对于多子网 FCI，将为 FCI 中的每个子网分配一个虚拟 IP 地址。</span><span class="sxs-lookup"><span data-stu-id="70cfb-204">In the case of a multi-subnet FCI, a virtual IP address is assigned to each subnet in the FCI.</span></span> <span data-ttu-id="70cfb-205">在故障转移期间，将更新 DNS 服务器上的 VNN 以指向各自子网的虚拟 IP 地址。</span><span class="sxs-lookup"><span data-stu-id="70cfb-205">During a failover, the VNN on the DNS server is updated to point to the virtual IP address for the respective subnet.</span></span> <span data-ttu-id="70cfb-206">在发生多子网故障转移后，应用程序和客户端可使用同一 VNN 连接到 FCI。</span><span class="sxs-lookup"><span data-stu-id="70cfb-206">Applications and clients can then connect to the FCI using the same VNN after a multi-subnet failover.</span></span>  
  
##  <a name="sql-server-failover-concepts-and-tasks"></a><a name="ConceptsAndTasks"></a> <span data-ttu-id="70cfb-207">SQL Server 故障转移的概念和任务</span><span class="sxs-lookup"><span data-stu-id="70cfb-207">SQL Server Failover Concepts and Tasks</span></span>  
  
|<span data-ttu-id="70cfb-208">概念和任务</span><span class="sxs-lookup"><span data-stu-id="70cfb-208">Concepts and Tasks</span></span>|<span data-ttu-id="70cfb-209">主题</span><span class="sxs-lookup"><span data-stu-id="70cfb-209">Topic</span></span>|  
|------------------------|-----------|  
|<span data-ttu-id="70cfb-210">介绍故障检测机制和灵活的故障转移策略。</span><span class="sxs-lookup"><span data-stu-id="70cfb-210">Describes the failure detection mechanism and the flexible failover policy.</span></span>|[<span data-ttu-id="70cfb-211">Failover Policy for Failover Cluster Instances</span><span class="sxs-lookup"><span data-stu-id="70cfb-211">Failover Policy for Failover Cluster Instances</span></span>](failover-policy-for-failover-cluster-instances.md)|  
|<span data-ttu-id="70cfb-212">介绍 FCI 管理和维护概念。</span><span class="sxs-lookup"><span data-stu-id="70cfb-212">Describes concepts in FCI administration and maintenance.</span></span>|[<span data-ttu-id="70cfb-213">故障转移群集实例管理和维护</span><span class="sxs-lookup"><span data-stu-id="70cfb-213">Failover Cluster Instance Administration and Maintenance</span></span>](failover-cluster-instance-administration-and-maintenance.md)|  
|<span data-ttu-id="70cfb-214">介绍多子网配置和概念</span><span class="sxs-lookup"><span data-stu-id="70cfb-214">Describes multi-subnet configuration and concepts</span></span>|[<span data-ttu-id="70cfb-215">SQL Server 多子网群集 (;SQL Server) ;</span><span class="sxs-lookup"><span data-stu-id="70cfb-215">SQL Server Multi-Subnet Clustering (;SQL Server);</span></span>](sql-server-multi-subnet-clustering-sql-server.md)|  
  
##  <a name="related-topics"></a><a name="RelatedTopics"></a><span data-ttu-id="70cfb-216">相关主题</span><span class="sxs-lookup"><span data-stu-id="70cfb-216">Related Topics</span></span>  
  
|<span data-ttu-id="70cfb-217">**主题说明**</span><span class="sxs-lookup"><span data-stu-id="70cfb-217">**Topic descriptions**</span></span>|<span data-ttu-id="70cfb-218">**主题**</span><span class="sxs-lookup"><span data-stu-id="70cfb-218">**Topic**</span></span>|  
|----------------------------|---------------|  
|<span data-ttu-id="70cfb-219">介绍如何安装新的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] FCI。</span><span class="sxs-lookup"><span data-stu-id="70cfb-219">Describes how to install a new [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] FCI.</span></span>|[<span data-ttu-id="70cfb-220">创建新的 SQL Server 故障转移群集 (;安装) ;</span><span class="sxs-lookup"><span data-stu-id="70cfb-220">Create a New SQL Server Failover Cluster (;Setup);</span></span>](../install/create-a-new-sql-server-failover-cluster-setup.md)|  
|<span data-ttu-id="70cfb-221">介绍如何升级到 [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] 故障转移群集。</span><span class="sxs-lookup"><span data-stu-id="70cfb-221">Describes how to upgrade to a [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] failover cluster.</span></span>|[<span data-ttu-id="70cfb-222">升级 SQL Server 故障转移群集</span><span class="sxs-lookup"><span data-stu-id="70cfb-222">Upgrade a SQL Server Failover Cluster</span></span>](upgrade-a-sql-server-failover-cluster-instance.md)|  
|<span data-ttu-id="70cfb-223">介绍 Windows 故障转移群集的概念并提供指向 Windows 故障转移群集相关任务的链接</span><span class="sxs-lookup"><span data-stu-id="70cfb-223">Describes Windows Failover Clustering Concepts and provides links to tasks related to Windows Failover Clustering</span></span>|[!INCLUDE[nextref_longhorn](../../../includes/nextref-longhorn-md.md)]<span data-ttu-id="70cfb-224">：[故障转移群集概述](https://go.microsoft.com/fwlink/?LinkId=177878)</span><span class="sxs-lookup"><span data-stu-id="70cfb-224">: [Overview of Failover Clusters](https://go.microsoft.com/fwlink/?LinkId=177878)</span></span><br /><br /> [!INCLUDE[nextref_longhorn](../../../includes/nextref-longhorn-md.md)]<span data-ttu-id="70cfb-225">R2：[故障转移群集概述](https://go.microsoft.com/fwlink/?LinkId=177879)</span><span class="sxs-lookup"><span data-stu-id="70cfb-225">R2: [Overview of Failover Clusters](https://go.microsoft.com/fwlink/?LinkId=177879)</span></span>|  
|<span data-ttu-id="70cfb-226">介绍 FCI 中的节点和可用性组中的副本的概念区别以及有关使用 FCI 承载可用性组的副本的注意事项。</span><span class="sxs-lookup"><span data-stu-id="70cfb-226">Describes the distinctions in concepts between nodes in an FCI and replicas within an availability group and considerations for using an FCI to host a replica for an availability group.</span></span>|[<span data-ttu-id="70cfb-227">故障转移群集和 AlwaysOn 可用性组 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="70cfb-227">Failover Clustering and Always On Availability Groups (SQL Server)</span></span>](../../../database-engine/availability-groups/windows/failover-clustering-and-always-on-availability-groups-sql-server.md)|  
  
  
