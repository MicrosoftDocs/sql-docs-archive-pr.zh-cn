---
title: 向 SQL Server 资源添加依赖项 | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- resource dependencies [SQL Server]
- failover clustering [SQL Server], dependencies
- clusters [SQL Server], dependencies
- dependencies [SQL Server], clustering
ms.assetid: 25dbb751-139b-4c8e-ac62-3ec23110611f
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 8610d3dc847d0d2b8dd6f570aa543d766adf68c0
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87586275"
---
# <a name="add-dependencies-to-a-sql-server-resource"></a><span data-ttu-id="f504c-102">向 SQL Server 资源添加依赖项</span><span class="sxs-lookup"><span data-stu-id="f504c-102">Add Dependencies to a SQL Server Resource</span></span>
  <span data-ttu-id="f504c-103">本主题说明如何使用故障转移群集管理器管理单元向 AlwaysOn 故障转移群集实例 (FCI) 资源添加依赖项。</span><span class="sxs-lookup"><span data-stu-id="f504c-103">This topic describes how to add dependencies to an AlwaysOn Failover Cluster Instance (FCI) resource by using the Failover Cluster Manager snap-in.</span></span> <span data-ttu-id="f504c-104">故障转移群集管理器管理单元是用于 Windows Server 故障转移群集 (WSFC) 服务的群集管理应用程序。</span><span class="sxs-lookup"><span data-stu-id="f504c-104">The Failover Cluster Manager snap-in is the cluster management application for the Windows Server Failover Clustering (WSFC) service.</span></span>  
  
-   <span data-ttu-id="f504c-105">**开始之前：** [限制和局限](#Restrictions)、[先决条件](#Prerequisites)</span><span class="sxs-lookup"><span data-stu-id="f504c-105">**Before you begin:**  [Limitations and Restrictions](#Restrictions), [Prerequisites](#Prerequisites)</span></span>  
  
-   <span data-ttu-id="f504c-106">**若要为 SQL Server 资源添加依赖关系，请使用：** [Windows 故障转移群集管理器](#WinClusManager)</span><span class="sxs-lookup"><span data-stu-id="f504c-106">**To add a dependency to a SQL Server resource, using:** [Windows Failover Cluster Manager](#WinClusManager)</span></span>  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="f504c-107">开始之前</span><span class="sxs-lookup"><span data-stu-id="f504c-107">Before You Begin</span></span>  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="f504c-108">限制和局限</span><span class="sxs-lookup"><span data-stu-id="f504c-108">Limitations and Restrictions</span></span>  
 <span data-ttu-id="f504c-109">需要特别注意的是：如果要将其他任何资源添加到 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 组中，这些资源必须始终具有自身的唯一 SQL 网络名称资源以及自身的 SQL IP 地址资源。</span><span class="sxs-lookup"><span data-stu-id="f504c-109">It is important to note that if you add any other resources to the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] group, those resources must always have their own unique SQL network name resources and their own SQL IP address resources.</span></span>  
  
 <span data-ttu-id="f504c-110">不要将现有的 SQL 网络名称资源和 SQL IP 地址资源用于 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]以外的任何资源。</span><span class="sxs-lookup"><span data-stu-id="f504c-110">Do not use the existing SQL network name resources and SQL IP address resources for anything other than [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="f504c-111">如果将 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 资源与其他资源共享，可能会发生下列问题：</span><span class="sxs-lookup"><span data-stu-id="f504c-111">If [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] resources are shared with other resources, the following problems may occur:</span></span>  
  
-   <span data-ttu-id="f504c-112">可能会发生意外停用。</span><span class="sxs-lookup"><span data-stu-id="f504c-112">Outages that are not expected may occur.</span></span>  
  
-   <span data-ttu-id="f504c-113">Service Pack 安装可能会失败。</span><span class="sxs-lookup"><span data-stu-id="f504c-113">Service pack installations may not be successful.</span></span>  
  
-   <span data-ttu-id="f504c-114">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 安装程序可能会失败。</span><span class="sxs-lookup"><span data-stu-id="f504c-114">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Setup program may not be successful.</span></span> <span data-ttu-id="f504c-115">如果出现此问题，将无法安装更多的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例，也不能执行例程维护。</span><span class="sxs-lookup"><span data-stu-id="f504c-115">If this problem occurs, you cannot install additional instances of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] or perform routine maintenance.</span></span>  
  
 <span data-ttu-id="f504c-116">还需要考虑下列问题：</span><span class="sxs-lookup"><span data-stu-id="f504c-116">Consider these additional issues:</span></span>  
  
-   <span data-ttu-id="f504c-117">使用 FTP 进行 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 复制：如果 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例使用 FTP 进行 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 复制，则 FTP 服务必须与设置为使用 FTP 服务的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 安装位于同一个物理磁盘。</span><span class="sxs-lookup"><span data-stu-id="f504c-117">FTP with [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] replication: For instances of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] that use FTP with [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] replication, your FTP service must use one of the same physical disks as the installation of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] that is set up to use the FTP service.</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="f504c-118">资源依赖关系：如果将某个资源添加到 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 组中，并且你具有与 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 资源的依赖关系来确保 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 可用，则 [!INCLUDE[msCoName](../../../includes/msconame-md.md)] 建议你添加与 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 代理资源的依赖关系。</span><span class="sxs-lookup"><span data-stu-id="f504c-118">resource dependencies: If you add a resource to a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] group and you have a dependency on the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] resource to make sure that [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is available, [!INCLUDE[msCoName](../../../includes/msconame-md.md)] recommends that you add a dependency on the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent resource.</span></span> <span data-ttu-id="f504c-119">不要添加与 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 资源的依赖关系。</span><span class="sxs-lookup"><span data-stu-id="f504c-119">Do not add a dependency on the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] resource.</span></span> <span data-ttu-id="f504c-120">若要确保运行 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 的计算机保持高可用性，请对 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 代理资源进行合理配置以使 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 代理资源的失败不会对 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 组带来影响。</span><span class="sxs-lookup"><span data-stu-id="f504c-120">To make sure that the computer that is running [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] remains highly available, configure the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent resource so that it does not affect the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] group if the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent resource fails.</span></span>  
  
-   <span data-ttu-id="f504c-121">文件共享和打印机资源：安装文件共享资源或打印机群集资源时，不应将它们置于运行 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 的计算机的同一物理磁盘资源上。</span><span class="sxs-lookup"><span data-stu-id="f504c-121">File shares and printer resources: When you install File Share resources or Printer cluster resources, they should not be put on the same physical disk resources as the computer that is running [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="f504c-122">如果将它们放在相同的物理磁盘资源上，可能导致运行 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]的计算机的性能降低或该计算机上的服务丢失。</span><span class="sxs-lookup"><span data-stu-id="f504c-122">If they are put on the same physical disk resources, you may experience performance degradation and loss of service to the computer that is running [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
-   <span data-ttu-id="f504c-123">MS DTC 注意事项：安装操作系统和配置 FCI 后，必须使用故障转移群集管理器管理单元将 [!INCLUDE[msCoName](../../../includes/msconame-md.md)] 分布式事务处理协调器 (MS DTC) 配置为在群集中使用。</span><span class="sxs-lookup"><span data-stu-id="f504c-123">MS DTC considerations: After you install the operating system and configure your FCI, you must configure [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Distributed Transaction Coordinator (MS DTC) to work in a cluster by using the Failover Cluster Manager snap-in.</span></span> <span data-ttu-id="f504c-124">群集 MS DTC 失败不会导致 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 安装程序停止运行，但如果未能正确配置 MS DTC，则 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 应用程序功能可能会受影响。</span><span class="sxs-lookup"><span data-stu-id="f504c-124">Failure to cluster MS DTC will not block [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Setup, but [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] application functionality may be affected if MS DTC is not properly configured.</span></span>  
  
     <span data-ttu-id="f504c-125">如果在 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 组中安装 MS DTC，并且具有依赖于 MS DTC 的其他资源，则在此组脱机时或者处于故障转移期间的情况下，MS DTC 将不可用。</span><span class="sxs-lookup"><span data-stu-id="f504c-125">If you install MS DTC in your [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] group and you have other resources that are dependent on MS DTC, MS DTC will not be available if this group is offline or during a failover.</span></span> [!INCLUDE[msCoName](../../../includes/msconame-md.md)] <span data-ttu-id="f504c-126">建议您尽可能将 MS DTC 放入单独的组中且占用单独的物理磁盘资源。</span><span class="sxs-lookup"><span data-stu-id="f504c-126">recommends that you put MS DTC in its own group with its own physical disk resource, if it is possible.</span></span>  
  
###  <a name="prerequisites"></a><a name="Prerequisites"></a><span data-ttu-id="f504c-127">先决条件</span><span class="sxs-lookup"><span data-stu-id="f504c-127">Prerequisites</span></span>  
 <span data-ttu-id="f504c-128">如果将 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 安装到具有多个磁盘驱动器的 WSFC 资源组，并选择将数据置于其中一个驱动器上，则 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 资源将被设置为只依赖于该驱动器。</span><span class="sxs-lookup"><span data-stu-id="f504c-128">If you install [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] into a WSFC resource group with multiple disk drives and choose to place your data on one of the drives, the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] resource will be set to be dependent only on that drive.</span></span> <span data-ttu-id="f504c-129">若要将数据或日志放到另一个磁盘上，必须先为相应磁盘添加与 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 资源的依赖关系。</span><span class="sxs-lookup"><span data-stu-id="f504c-129">To put data or logs on another disk, you must first add a dependency to the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] resource for the additional disk.</span></span>  
  
##  <a name="using-the-failover-cluster-manager-snap-in"></a><a name="WinClusManager"></a> <span data-ttu-id="f504c-130">使用故障转移群集管理器管理单元</span><span class="sxs-lookup"><span data-stu-id="f504c-130">Using the Failover Cluster Manager Snap-in</span></span>  
 <span data-ttu-id="f504c-131">**为 SQL Server 资源添加依赖关系**</span><span class="sxs-lookup"><span data-stu-id="f504c-131">**To add a dependency to a SQL Server resource**</span></span>  
  
-   <span data-ttu-id="f504c-132">打开故障转移群集管理器管理单元。</span><span class="sxs-lookup"><span data-stu-id="f504c-132">Open the Failover Cluster Manager snap-in.</span></span>  
  
-   <span data-ttu-id="f504c-133">查找包含要添加依赖关系的可用 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 资源的组。</span><span class="sxs-lookup"><span data-stu-id="f504c-133">Locate the group that contains the applicable [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] resource that you would like to make dependent.</span></span>  
  
-   <span data-ttu-id="f504c-134">如果磁盘资源已经位于此组中，请转到步骤 4。</span><span class="sxs-lookup"><span data-stu-id="f504c-134">If the resource for the disk is already in this group, go to step 4.</span></span> <span data-ttu-id="f504c-135">否则，请查找包含该磁盘的组。</span><span class="sxs-lookup"><span data-stu-id="f504c-135">Otherwise, locate the group that contains the disk.</span></span> <span data-ttu-id="f504c-136">如果该组与包含 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 的组不属于同一节点，请将包含磁盘资源的组移到包含 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 组的节点中。</span><span class="sxs-lookup"><span data-stu-id="f504c-136">If that group and the group that contains [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] are not owned by the same node, move the group containing the resource for the disk to the node that owns the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] group.</span></span>  
  
-   <span data-ttu-id="f504c-137">选择 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 资源，打开 **“属性”** 对话框，然后使用 **“依赖项”** 选项卡将磁盘添加到 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 依赖项集中。</span><span class="sxs-lookup"><span data-stu-id="f504c-137">Select the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] resource, open the **Properties** dialog box, and use the **Dependencies** tab to add the disk to the set of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] dependencies.</span></span>  
  
  
