---
title: 升级 SQL Server 故障转移群集实例（安装程序）| Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- upgrading clusters
- clusters [SQL Server], upgrading
- failover clustering [SQL Server], creating clusters
- clusters [SQL Server], creating
- failover clustering [SQL Server], upgrading
ms.assetid: ea8b7d66-e5a1-402f-9928-8f7310e84f5c
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: a45628055ee12f5d771c863dec7a3368cdae5940
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87693212"
---
# <a name="upgrade-a-sql-server-failover-cluster-instance-setup"></a><span data-ttu-id="46664-102">升级 SQL Server 故障转移群集实例（安装程序）</span><span class="sxs-lookup"><span data-stu-id="46664-102">Upgrade a SQL Server Failover Cluster Instance (Setup)</span></span>
  <span data-ttu-id="46664-103">可以使用 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 安装向导或者命令提示符将 [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] 故障转移群集升级为 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 故障转移群集。</span><span class="sxs-lookup"><span data-stu-id="46664-103">You can upgrade a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover cluster to a [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] failover cluster by using the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Installation Wizard or a command prompt.</span></span>  
  
 <span data-ttu-id="46664-104">在故障转移群集升级过程中，停机时间限制为故障转移时间和运行升级脚本所需的时间。</span><span class="sxs-lookup"><span data-stu-id="46664-104">During the failover cluster upgrade, downtime is limited to failover time and the time that is required for upgrade scripts to run.</span></span> <span data-ttu-id="46664-105">如果您遵循故障转移群集滚动升级过程，停机时间将最短。</span><span class="sxs-lookup"><span data-stu-id="46664-105">If you follow the failover cluster rolling upgrade process, your downtime is minimal.</span></span> <span data-ttu-id="46664-106">根据您是否在故障转移群集节点上具备了所有必备组件，安装这些必备组件时可能会产生额外的停机时间。</span><span class="sxs-lookup"><span data-stu-id="46664-106">Depending on whether you have all the prerequisites on the failover cluster nodes, you might incur additional downtime while you install these prerequisites.</span></span> <span data-ttu-id="46664-107">有关如何在升级过程中最大程度地减少停机时间的详细信息，请参阅此页上的[升级故障转移群集前的最佳做法](#BestPractices)部分。</span><span class="sxs-lookup"><span data-stu-id="46664-107">For more information about how to minimize the downtime during upgrade, see the [Best Practices Before Upgrading Failover Cluster](#BestPractices) section on this page.</span></span>  
  
 <span data-ttu-id="46664-108">有关如何升级的详细信息，请参阅[支持的版本和](../../../database-engine/install-windows/supported-version-and-edition-upgrades.md)版本升级和[升级到 SQL Server 2014](../../../database-engine/install-windows/upgrade-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="46664-108">For more information about how to upgrade, see [Supported Version and Edition Upgrades](../../../database-engine/install-windows/supported-version-and-edition-upgrades.md) and [Upgrade to SQL Server 2014](../../../database-engine/install-windows/upgrade-sql-server.md).</span></span>  
  
 <span data-ttu-id="46664-109">有关命令提示符用法的示例语法的详细信息，请参阅[从命令提示符安装 SQL Server 2014](../../../database-engine/install-windows/install-sql-server-from-the-command-prompt.md)。</span><span class="sxs-lookup"><span data-stu-id="46664-109">For more information about sample syntax for command prompt usage, see [Install SQL Server 2014 from the Command Prompt](../../../database-engine/install-windows/install-sql-server-from-the-command-prompt.md).</span></span>  
  
## <a name="prerequisites"></a><span data-ttu-id="46664-110">先决条件</span><span class="sxs-lookup"><span data-stu-id="46664-110">Prerequisites</span></span>  
 <span data-ttu-id="46664-111">开始之前，请仔细阅读以下重要信息：</span><span class="sxs-lookup"><span data-stu-id="46664-111">Before you begin, review the following important information:</span></span>  
  
-   [<span data-ttu-id="46664-112">安装故障转移群集前的准备工作</span><span class="sxs-lookup"><span data-stu-id="46664-112">Before Installing Failover Clustering</span></span>](../install/before-installing-failover-clustering.md)  
  
-   <span data-ttu-id="46664-113">[使用升级顾问来准备升级](../../install/use-upgrade-advisor-to-prepare-for-upgrades.md)。</span><span class="sxs-lookup"><span data-stu-id="46664-113">[Use Upgrade Advisor to Prepare for Upgrades](../../install/use-upgrade-advisor-to-prepare-for-upgrades.md).</span></span>  
  
-   [<span data-ttu-id="46664-114">升级数据库引擎</span><span class="sxs-lookup"><span data-stu-id="46664-114">Upgrade Database Engine</span></span>](../../../database-engine/install-windows/upgrade-database-engine.md)  
  
-   <span data-ttu-id="46664-115">安装程序在群集化的操作系统上安装 .NET Framework 4.0。</span><span class="sxs-lookup"><span data-stu-id="46664-115">Setup installs .NET Framework 4.0 on a clustered operating system.</span></span> <span data-ttu-id="46664-116">若要最大程度地缩短任何可能的停机时间，请考虑在运行安装程序之前安装 .NET Framework 4.0。</span><span class="sxs-lookup"><span data-stu-id="46664-116">To minimize any possible downtime, consider installing .NET Framework 4.0 before you run Setup.</span></span>  
  
-   <span data-ttu-id="46664-117">为了确保 Visual Studio 组件可以正确安装， [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 要求您安装更新。</span><span class="sxs-lookup"><span data-stu-id="46664-117">To make sure that the Visual Studio component can be installed correctly, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] requires you to install an update.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="46664-118">安装程序会检查此更新是否存在，然后要求您先下载并安装此更新，接下来才能继续 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 安装。</span><span class="sxs-lookup"><span data-stu-id="46664-118">Setup checks for the presence of this update and then requires you to download and install the update before you can continue with the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] installation.</span></span> <span data-ttu-id="46664-119">若要避免在 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 安装期间中断，可在运行 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 安装程序之前先按下面所述下载并安装此更新（或安装 Windows Update 上提供的 .NET 3.5 SP1 的所有更新）：</span><span class="sxs-lookup"><span data-stu-id="46664-119">To avoid the interruption during [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Setup, you can download and install the update before running [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Setup as described below (or install all the updates for .NET 3.5 SP1 available on Windows Update):</span></span>  
  
     <span data-ttu-id="46664-120">如果在安装了 [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] Windows Server 2008 SP2 操作系统的计算机上安装，则可以从[此处](https://go.microsoft.com/fwlink/?LinkId=198093)获取所需的更新</span><span class="sxs-lookup"><span data-stu-id="46664-120">If you install [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] on a computer with the Windows Server 2008 SP2 operating system, you can get the required update from [here](https://go.microsoft.com/fwlink/?LinkId=198093)</span></span>  
  
     <span data-ttu-id="46664-121">如果您在使用 [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] SP1 或 [!INCLUDE[win7](../../../includes/win7-md.md)] SP1 操作系统的计算机上安装 [!INCLUDE[winserver2008r2](../../../includes/winserver2008r2-md.md)]，则已包含此更新。</span><span class="sxs-lookup"><span data-stu-id="46664-121">If you install [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] on a computer with the [!INCLUDE[win7](../../../includes/win7-md.md)] SP1 or [!INCLUDE[winserver2008r2](../../../includes/winserver2008r2-md.md)] SP1 operating system, this update in included.</span></span>  
  
-   <span data-ttu-id="46664-122">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 安装程序不再安装 .NET Framework 3.5 SP1，但是在 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 上安装 [!INCLUDE[firstref_longhorn](../../../includes/firstref-longhorn-md.md)] 时可能需要该软件。</span><span class="sxs-lookup"><span data-stu-id="46664-122">.NET Framework 3.5 SP1 is no longer installed by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Setup, but may be required while installing [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] on [!INCLUDE[firstref_longhorn](../../../includes/firstref-longhorn-md.md)].</span></span> <span data-ttu-id="46664-123">有关详细信息，请参阅 [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] [发行说明](https://go.microsoft.com/fwlink/?LinkId=296445)。</span><span class="sxs-lookup"><span data-stu-id="46664-123">For more information, see [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)][Release Notes](https://go.microsoft.com/fwlink/?LinkId=296445).</span></span>  
  
-   <span data-ttu-id="46664-124">对于本地安装，必须以管理员身份运行 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 安装程序。</span><span class="sxs-lookup"><span data-stu-id="46664-124">For local installations, you must run [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Setup as an administrator.</span></span> <span data-ttu-id="46664-125">如果从远程共享安装 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] ，则必须使用对远程共享具有读取权限的域帐户。</span><span class="sxs-lookup"><span data-stu-id="46664-125">If you install [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] from a remote share, you must use a domain account that has read permissions on the remote share.</span></span>  
  
-   <span data-ttu-id="46664-126">若要将实例升级 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 到 [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] 故障转移群集，要升级的实例必须是故障转移群集。</span><span class="sxs-lookup"><span data-stu-id="46664-126">To upgrade an instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] to a [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] failover cluster, the instance being upgraded must be a failover cluster.</span></span>  
  
     <span data-ttu-id="46664-127">若要将 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 的独立实例移至 [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] 故障转移群集，请安装新的 [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] 故障转移群集，然后使用复制数据库向导迁移独立实例中的用户数据库。</span><span class="sxs-lookup"><span data-stu-id="46664-127">To move a stand-alone instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] to a [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] failover cluster, install a new [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] failover cluster, and then migrate user databases from the stand-alone instance by using the Copy Database Wizard.</span></span> <span data-ttu-id="46664-128">有关详细信息，请参阅 [Use the Copy Database Wizard](../../../relational-databases/databases/use-the-copy-database-wizard.md)。</span><span class="sxs-lookup"><span data-stu-id="46664-128">For more information, see [Use the Copy Database Wizard](../../../relational-databases/databases/use-the-copy-database-wizard.md).</span></span>  
  
## <a name="rolling-upgrades"></a><span data-ttu-id="46664-129">滚动升级</span><span class="sxs-lookup"><span data-stu-id="46664-129">Rolling Upgrades</span></span>  
 <span data-ttu-id="46664-130">若要将 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 故障转移群集升级到 [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)]，必须从被动节点开始逐个在每个故障转移群集节点上运行具有升级操作的安装程序。</span><span class="sxs-lookup"><span data-stu-id="46664-130">To upgrade a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover cluster to [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)], you must run setup with upgrade action on each failover cluster node, one at a time, starting with the passive nodes.</span></span> <span data-ttu-id="46664-131">升级每个节点时，节点被放在故障转移群集的可能所有者之外。</span><span class="sxs-lookup"><span data-stu-id="46664-131">As you upgrade each node, it is left out of the possible owners of the failover cluster.</span></span> <span data-ttu-id="46664-132">如果发生意外故障转移，已升级的节点将不参与故障转移，直到 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 安装程序将群集资源组的所有权转移给已升级的节点。</span><span class="sxs-lookup"><span data-stu-id="46664-132">If there is an unexpected failover, the upgraded nodes do not participate in the failover until cluster resource group ownership is moved to an upgraded node by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Setup.</span></span>  
  
 <span data-ttu-id="46664-133">默认情况下，安装程序自动确定发生故障后何时由已升级的节点接替工作。</span><span class="sxs-lookup"><span data-stu-id="46664-133">By default, Setup automatically determines when to fail over to an upgraded node.</span></span> <span data-ttu-id="46664-134">这取决于故障转移群集实例中节点的总数和已经升级的节点数。</span><span class="sxs-lookup"><span data-stu-id="46664-134">This depends on the total number of nodes in the failover cluster instance and the number of nodes that have already been upgraded.</span></span> <span data-ttu-id="46664-135">如果有一半或更多节点已经升级，则当您在下一个节点上执行升级时，如果发生故障，安装程序会让已升级的节点接替工作。</span><span class="sxs-lookup"><span data-stu-id="46664-135">When half of the nodes or more have already been upgraded, Setup causes a failover to an upgraded node when you perform upgrade on the next node.</span></span> <span data-ttu-id="46664-136">在故障转移到已升级的节点后，群集组将移至已升级的节点。</span><span class="sxs-lookup"><span data-stu-id="46664-136">Upon failover to an upgraded node, the cluster group is moved to an upgraded node.</span></span> <span data-ttu-id="46664-137">所有已升级的节点都放在可能的所有者列表中，所有尚未升级的节点都将从可能的所有者列表中删除。</span><span class="sxs-lookup"><span data-stu-id="46664-137">All the upgraded nodes are put in the possible owners list and all the nodes that are not yet upgraded are removed from the possible owners list.</span></span> <span data-ttu-id="46664-138">升级剩余的每个节点时，节点被添加到故障转移群集的可能所有者那里。</span><span class="sxs-lookup"><span data-stu-id="46664-138">As you upgrade each remaining node, it is added to the possible owners of the failover cluster.</span></span>  
  
 <span data-ttu-id="46664-139">此过程使停机时间限制为整个故障转移群集升级过程中的一次故障转移时间和数据库升级脚本执行时间。</span><span class="sxs-lookup"><span data-stu-id="46664-139">This process results in downtime limited to one failover time and database upgrade script execution time during the whole failover cluster upgrade.</span></span>  
  
 <span data-ttu-id="46664-140">若要控制升级过程中群集节点的故障转移行为，请从命令提示符运行升级操作，并使用 /FAILOVERCLUSTERROLLOWNERSHIP 参数。</span><span class="sxs-lookup"><span data-stu-id="46664-140">To control the failover behavior of cluster nodes during the upgrade process, run the upgrade operation at the command prompt and use the /FAILOVERCLUSTERROLLOWNERSHIP parameter.</span></span> <span data-ttu-id="46664-141">有关详细信息，请参阅 [从命令提示符安装 SQL Server 2014](../../../database-engine/install-windows/install-sql-server-from-the-command-prompt.md)。</span><span class="sxs-lookup"><span data-stu-id="46664-141">For more information, see [Install SQL Server 2014 from the Command Prompt](../../../database-engine/install-windows/install-sql-server-from-the-command-prompt.md).</span></span>  
  
 <span data-ttu-id="46664-142">**注意**如果有单节点故障转移群集，则 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 安装程序会使 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 资源组脱机。</span><span class="sxs-lookup"><span data-stu-id="46664-142">**Note** If there is a single-node failover cluster, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Setup takes the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] resource group offline.</span></span>  
  
## <a name="considerations-when-upgrading-from-ssversion2005"></a><span data-ttu-id="46664-143">从 [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] 升级时的注意事项</span><span class="sxs-lookup"><span data-stu-id="46664-143">Considerations when Upgrading from [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)]</span></span>  
 <span data-ttu-id="46664-144">如果为群集安全策略指定了域组，则不能在 [!INCLUDE[nextref_longhorn](../../../includes/nextref-longhorn-md.md)] 上指定服务 SID。</span><span class="sxs-lookup"><span data-stu-id="46664-144">If you specified domain groups for the cluster security policy, you cannot specify service SID on [!INCLUDE[nextref_longhorn](../../../includes/nextref-longhorn-md.md)].</span></span> <span data-ttu-id="46664-145">如果要使用服务 SID，则需要执行并行升级。</span><span class="sxs-lookup"><span data-stu-id="46664-145">If you want to use the service SID, you need to perform a side by side upgrade.</span></span>  
  
 <span data-ttu-id="46664-146">选择[!INCLUDE[ssDE](../../../includes/ssde-md.md)]进行升级时，无论是否在 [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] 中安装了全文搜索，安装程序中都将包括全文搜索。</span><span class="sxs-lookup"><span data-stu-id="46664-146">When you select [!INCLUDE[ssDE](../../../includes/ssde-md.md)] for upgrade, full-text search is included in the setup regardless of whether it was installed in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span>  
  
 <span data-ttu-id="46664-147">如果在 [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] 中启用了全文搜索，则安装程序将重新生成全文搜索目录，而与有哪些可用的选项无关。</span><span class="sxs-lookup"><span data-stu-id="46664-147">If full-text search was enabled in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], Setup rebuilds the full-text search catalog regardless of the options available to you.</span></span>  
  
## <a name="upgrading-to-a-sssql14-multi-subnet-failover-cluster"></a><span data-ttu-id="46664-148">升级到 [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] 多子网故障转移群集</span><span class="sxs-lookup"><span data-stu-id="46664-148">Upgrading to a [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] Multi-Subnet Failover Cluster</span></span>  
 <span data-ttu-id="46664-149">有两个可能的升级方案：</span><span class="sxs-lookup"><span data-stu-id="46664-149">There are two possible scenarios for upgrades:</span></span>  
  
1.  [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="46664-150">故障转移群集当前在单个子网上配置：您必须首先通过启动安装程序并遵循升级过程将现有群集升级到 [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="46664-150">failover cluster is currently configured on a single subnet: You must first upgrade the existing cluster to [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] by launching Setup and following the upgrade process.</span></span> <span data-ttu-id="46664-151">完成现有故障转移群集的升级后，使用 AddNode 功能添加位于不同子网的节点。</span><span class="sxs-lookup"><span data-stu-id="46664-151">After completing the upgrade of the existing failover cluster, add a node that is on a different subnet using the AddNode functionality.</span></span> <span data-ttu-id="46664-152">确认在群集网络配置页将 IP 地址资源依赖关系更改为 OR。</span><span class="sxs-lookup"><span data-stu-id="46664-152">Confirm the IP address resource dependency change to OR in the cluster network configuration page.</span></span> <span data-ttu-id="46664-153">您现在有了一个 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 多子网故障转移群集。</span><span class="sxs-lookup"><span data-stu-id="46664-153">You now have a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] multi-subnet failover cluster.</span></span>  
  
2.  <span data-ttu-id="46664-154">当前使用拉伸 V-LAN 技术在多个子网配置 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 故障转移群集：您必须首先将现有的群集升级到 [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="46664-154">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover cluster is currently configured on multiple subnets using the stretch V-LAN technology: You must first upgrade the existing cluster to [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)].</span></span> <span data-ttu-id="46664-155">由于拉伸 V-LAN 技术配置单个子网，因此必须将网络配置更改为多个子网，使用 Windows 故障转移群集管理工具更改 IP 地址资源依赖关系，将 IP 依赖关系更改为 OR。</span><span class="sxs-lookup"><span data-stu-id="46664-155">Because stretch V-LAN technology configures a single subnet, the network configuration must to be changed to multiple subnets, and change the IP address resource dependency using the Windows Failover Cluster administration tool and change the IP dependency to OR.</span></span>  
  
###  <a name="best-practices-before-upgrading-a-ssnoversion-failover-cluster"></a><a name="BestPractices"></a><span data-ttu-id="46664-156">升级故障转移群集前的最佳做法 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]</span><span class="sxs-lookup"><span data-stu-id="46664-156">Best Practices Before Upgrading a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Failover Cluster</span></span>  
 <span data-ttu-id="46664-157">若要避免出现由于重新启动而产生的意外停机时间，在群集节点上运行升级之前，请在所有故障转移群集节点上预安装 .NET Framework 4.0 的不重新引导包。</span><span class="sxs-lookup"><span data-stu-id="46664-157">To eliminate unexpected downtime caused by a restart, preinstall the no-reboot package for .NET Framework 4.0 on all the failover cluster nodes before you run the upgrade on the cluster nodes.</span></span> <span data-ttu-id="46664-158">建议使用以下步骤预安装必备组件：</span><span class="sxs-lookup"><span data-stu-id="46664-158">We recommend the following steps to preinstall the prerequisites:</span></span>  
  
-   <span data-ttu-id="46664-159">安装 .NET Framework 4.0 的不重新引导包，从被动节点开始仅升级共享组件。</span><span class="sxs-lookup"><span data-stu-id="46664-159">Install the no-reboot package for .NET Framework 4.0, and upgrade only the shared components starting with the passive nodes.</span></span> <span data-ttu-id="46664-160">这将安装 [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] 4.0、Windows Installer 4.5 和 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 支持文件。</span><span class="sxs-lookup"><span data-stu-id="46664-160">This installs [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] 4.0, Windows Installer 4.5, and [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] support files.</span></span>  
  
-   <span data-ttu-id="46664-161">重新启动一次或多次（根据需要）。</span><span class="sxs-lookup"><span data-stu-id="46664-161">Restart one or more times, as required.</span></span>  
  
-   <span data-ttu-id="46664-162">将故障转移到已升级的节点。</span><span class="sxs-lookup"><span data-stu-id="46664-162">Fail over to an upgraded node.</span></span>  
  
-   <span data-ttu-id="46664-163">在剩余的最后一个节点上升级共享组件。</span><span class="sxs-lookup"><span data-stu-id="46664-163">Upgrade the shared components on the last remaining node.</span></span>  
  
 <span data-ttu-id="46664-164">在所有共享组件都已升级且必备组件都已安装后，开始故障转移群集升级过程。</span><span class="sxs-lookup"><span data-stu-id="46664-164">After all the shared components are upgraded and prerequisites are installed, start the failover cluster upgrade process.</span></span> <span data-ttu-id="46664-165">必须在每个故障转移群集节点上运行升级，首先从被动节点开始并向着拥有群集资源组的节点进行。</span><span class="sxs-lookup"><span data-stu-id="46664-165">You have to run upgrade on each failover cluster node, starting with the passive nodes first and making your way toward the node that owns the cluster resource group.</span></span>  
  
-   <span data-ttu-id="46664-166">不能向现有故障转移群集中添加功能。</span><span class="sxs-lookup"><span data-stu-id="46664-166">You cannot add features to an existing failover cluster.</span></span>  
  
-   <span data-ttu-id="46664-167">仅允许在某些方案中更改故障转移群集的版本。</span><span class="sxs-lookup"><span data-stu-id="46664-167">Changing the edition of the failover cluster is limited to certain scenarios.</span></span> <span data-ttu-id="46664-168">有关详细信息，请参阅 [支持的版本升级](../../../database-engine/install-windows/supported-version-and-edition-upgrades.md)。</span><span class="sxs-lookup"><span data-stu-id="46664-168">For more information, see [Supported Version and Edition Upgrades](../../../database-engine/install-windows/supported-version-and-edition-upgrades.md).</span></span>  
  
##  <a name="to-upgrade-a-ssnoversion-failover-cluster"></a><a name="UpgradeSteps"></a> <span data-ttu-id="46664-169">升级 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 故障转移群集</span><span class="sxs-lookup"><span data-stu-id="46664-169">To Upgrade a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Failover Cluster</span></span>  
  
#### <a name="to-upgrade-a-ssnoversion-failover-cluster"></a><span data-ttu-id="46664-170">升级 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 故障转移群集</span><span class="sxs-lookup"><span data-stu-id="46664-170">To upgrade a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover cluster</span></span>  
  
1.  <span data-ttu-id="46664-171">插入 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 安装介质，然后双击根文件夹中的 Setup.exe。</span><span class="sxs-lookup"><span data-stu-id="46664-171">Insert the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] installation media, and from the root folder, double-click Setup.exe.</span></span> <span data-ttu-id="46664-172">若要从网络共享进行安装，请移动到共享中的根文件夹，然后双击 Setup.exe。</span><span class="sxs-lookup"><span data-stu-id="46664-172">To install from a network share, move to the root folder on the share, and then double-click Setup.exe.</span></span> <span data-ttu-id="46664-173">如果之前未安装必备组件，可能会要求您安装它们。</span><span class="sxs-lookup"><span data-stu-id="46664-173">You may be asked to install the prerequisites, if they are not previously installed.</span></span>  
  
2.  > [!IMPORTANT]  
    >  <span data-ttu-id="46664-174">有关步骤3和步骤4的详细信息，请参阅[升级故障转移群集前的最佳做法](#BestPractices)部分。</span><span class="sxs-lookup"><span data-stu-id="46664-174">For more information about steps 3 and 4, see the [Best Practices Before Upgrading Failover Cluster](#BestPractices) section.</span></span>  
  
3.  <span data-ttu-id="46664-175">必备组件安装完成后，安装向导会启动 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 安装中心。</span><span class="sxs-lookup"><span data-stu-id="46664-175">After prerequisites are installed, the Installation Wizard starts the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Installation Center.</span></span> <span data-ttu-id="46664-176">若要升级的现有实例 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] ，请单击 **"从、、或升级" [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] [!INCLUDE[ssKatmai](../../../includes/sskatmai-md.md)] [!INCLUDE[ssKilimanjaro](../../../includes/sskilimanjaro-md.md)] [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)] 。**</span><span class="sxs-lookup"><span data-stu-id="46664-176">To upgrade an existing instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], click **Upgrade from [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], [!INCLUDE[ssKatmai](../../../includes/sskatmai-md.md)], [!INCLUDE[ssKilimanjaro](../../../includes/sskilimanjaro-md.md)], or [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)].**</span></span>  
  
4.  <span data-ttu-id="46664-177">如果需要使用安装程序支持文件， [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 安装程序将安装它们。</span><span class="sxs-lookup"><span data-stu-id="46664-177">If Setup support files are required, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Setup installs them.</span></span> <span data-ttu-id="46664-178">如果安装程序指示您重新启动计算机，请在继续操作之前重新启动。</span><span class="sxs-lookup"><span data-stu-id="46664-178">If you are instructed to restart your computer, restart before you continue.</span></span>  
  
5.  <span data-ttu-id="46664-179">系统配置检查器将在您的计算机上运行发现操作。</span><span class="sxs-lookup"><span data-stu-id="46664-179">The System Configuration Checker runs a discovery operation on your computer.</span></span> <span data-ttu-id="46664-180">若要继续， [!INCLUDE[clickOK](../../../includes/clickok-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="46664-180">To continue, [!INCLUDE[clickOK](../../../includes/clickok-md.md)].</span></span>  
  
6.  <span data-ttu-id="46664-181">在“产品密钥”页上输入与旧产品版本匹配的新版本的 PID 密钥。</span><span class="sxs-lookup"><span data-stu-id="46664-181">On the Product Key page, enter the PID key for the new version edition that matches the edition of the old product version.</span></span> <span data-ttu-id="46664-182">例如，若要升级 Enterprise 故障转移群集，必须提供 [!INCLUDE[ssEnterprise](../../../includes/ssenterprise-md.md)]的 PID 密钥。</span><span class="sxs-lookup"><span data-stu-id="46664-182">For example, to upgrade an Enterprise failover cluster, you must supply a PID key for [!INCLUDE[ssEnterprise](../../../includes/ssenterprise-md.md)].</span></span> <span data-ttu-id="46664-183">单击“下一步”以继续。</span><span class="sxs-lookup"><span data-stu-id="46664-183">Click **Next** to continue.</span></span> <span data-ttu-id="46664-184">请注意，对于同一 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例中的所有故障转移群集节点，用于故障转移群集升级的 PID 密钥必须一致。</span><span class="sxs-lookup"><span data-stu-id="46664-184">Be aware that the PID key that you use for a failover cluster upgrade must be consistent across all failover cluster nodes in the same [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="46664-185">有关详细信息，请参阅[SQL Server 2014 的版本和组件](../../editions-and-components-of-sql-server-2016.md)和[支持的版本和版本升级](../../../database-engine/install-windows/supported-version-and-edition-upgrades.md)。</span><span class="sxs-lookup"><span data-stu-id="46664-185">For more information, see [Editions and Components of SQL Server 2014](../../editions-and-components-of-sql-server-2016.md) and [Supported Version and Edition Upgrades](../../../database-engine/install-windows/supported-version-and-edition-upgrades.md).</span></span>  
  
7.  <span data-ttu-id="46664-186">在“许可条款”页上阅读许可协议，然后选中相应的复选框以接受许可条款和条件。</span><span class="sxs-lookup"><span data-stu-id="46664-186">On the License Terms page, read the license agreement, and then select the check box to accept the license terms and conditions.</span></span> <span data-ttu-id="46664-187">为了帮助改进 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]，您还可以启用功能使用情况选项并将报告发送给 [!INCLUDE[msCoName](../../../includes/msconame-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="46664-187">To help improve [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], you can also enable the feature usage option and send reports to [!INCLUDE[msCoName](../../../includes/msconame-md.md)].</span></span> <span data-ttu-id="46664-188">**单击 "下一步" 继续**。</span><span class="sxs-lookup"><span data-stu-id="46664-188">**Click Next to continue**.</span></span> <span data-ttu-id="46664-189">若要结束安装程序，请单击 **“取消”** 。</span><span class="sxs-lookup"><span data-stu-id="46664-189">To end Setup, click **Cancel**.</span></span>  
  
8.  <span data-ttu-id="46664-190">在“选择实例”页上指定要升级到 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 的 [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)]实例。</span><span class="sxs-lookup"><span data-stu-id="46664-190">On the Select Instance page, specify the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance to upgrade to [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)].</span></span> <span data-ttu-id="46664-191">**单击 "下一步" 继续**。</span><span class="sxs-lookup"><span data-stu-id="46664-191">**Click Next to continue**.</span></span>  
  
9. <span data-ttu-id="46664-192">在“功能选择”页上会预先选择要升级的功能。</span><span class="sxs-lookup"><span data-stu-id="46664-192">On the Feature Selection page, the features to upgrade are preselected.</span></span> <span data-ttu-id="46664-193">选择功能名称后，右侧窗格中会显示每个组件组的说明。</span><span class="sxs-lookup"><span data-stu-id="46664-193">A description for each component group appears in the right pane after you select the feature name.</span></span> <span data-ttu-id="46664-194">请注意，您不能更改要升级的功能，并且不能在升级操作过程中添加功能。</span><span class="sxs-lookup"><span data-stu-id="46664-194">Be aware that you cannot change the features to be upgraded, and you cannot add features during the upgrade operation.</span></span> <span data-ttu-id="46664-195">若要在升级操作完成后向的已升级实例添加功能 [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] ，请参阅[将功能添加到 SQL Server 2014 &#40;安装&#41;的实例](../../../database-engine/install-windows/add-features-to-an-instance-of-sql-server-setup.md)。</span><span class="sxs-lookup"><span data-stu-id="46664-195">To add features to an upgraded instance of [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] after the upgrade operation is complete, see [Add Features to an Instance of SQL Server 2014 &#40;Setup&#41;](../../../database-engine/install-windows/add-features-to-an-instance-of-sql-server-setup.md).</span></span>  
  
     <span data-ttu-id="46664-196">在右侧窗格中显示所选功能的必备组件。</span><span class="sxs-lookup"><span data-stu-id="46664-196">The prerequisites for the selected features are displayed on the right-hand pane.</span></span> <span data-ttu-id="46664-197">SQL Server 安装程序将在本过程后面所述的安装步骤中安装尚未安装的必备组件。</span><span class="sxs-lookup"><span data-stu-id="46664-197">SQL Server Setup will install the prerequisite that are not already installed during the installation step described later in this procedure.</span></span>  
  
10. <span data-ttu-id="46664-198">在“实例配置”页上，那些字段自动从旧实例进行填充。</span><span class="sxs-lookup"><span data-stu-id="46664-198">On the Instance Configuration page, fields are automatically populated from the old instance.</span></span> <span data-ttu-id="46664-199">您可以选择指定新的 InstanceID 值。</span><span class="sxs-lookup"><span data-stu-id="46664-199">You can choose to specify the new InstanceID value.</span></span>  
  
     <span data-ttu-id="46664-200">**实例 ID** - 默认情况下，实例名称用作实例 ID。</span><span class="sxs-lookup"><span data-stu-id="46664-200">**Instance ID** - By default, the instance name is used as the Instance ID.</span></span> <span data-ttu-id="46664-201">这用于标识 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]实例的安装目录和注册表项。</span><span class="sxs-lookup"><span data-stu-id="46664-201">This is used to identify installation directories and registry keys for your instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="46664-202">默认实例和命名实例都是如此。</span><span class="sxs-lookup"><span data-stu-id="46664-202">This is the case for default instances and named instances.</span></span> <span data-ttu-id="46664-203">对于默认实例，实例名称和实例 ID 为 MSSQLSERVER。</span><span class="sxs-lookup"><span data-stu-id="46664-203">For a default instance, the instance name and instance ID would be MSSQLSERVER.</span></span> <span data-ttu-id="46664-204">若要使用非默认的实例 ID，请选中 **“实例 ID”** 复选框，并提供一个值。</span><span class="sxs-lookup"><span data-stu-id="46664-204">To use a nondefault instance ID, select the **Instance ID** check box and provide a value.</span></span> <span data-ttu-id="46664-205">如果覆盖默认值，则必须为所有故障转移群集节点上要升级的实例指定相同的实例 ID。</span><span class="sxs-lookup"><span data-stu-id="46664-205">If you override the default value, you must specify the same Instance ID for the instance being upgraded on all the failover cluster nodes.</span></span> <span data-ttu-id="46664-206">已升级的实例的实例 ID 必须在所有节点上匹配。</span><span class="sxs-lookup"><span data-stu-id="46664-206">The Instance ID for the upgraded instance must match across the nodes.</span></span>  
  
     <span data-ttu-id="46664-207">**检测到的实例和功能**-该网格显示 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 运行安装程序的计算机上的实例。</span><span class="sxs-lookup"><span data-stu-id="46664-207">**Detected instances and features** - The grid shows instances of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] that are on the computer where Setup is running.</span></span> <span data-ttu-id="46664-208">**单击 "下一步" 继续**。</span><span class="sxs-lookup"><span data-stu-id="46664-208">**Click Next to continue**.</span></span>  
  
11. <span data-ttu-id="46664-209">“磁盘空间要求”页计算指定的功能所需的磁盘空间，并将磁盘空间要求与正在运行安装程序的计算机上的可用磁盘空间进行比较。</span><span class="sxs-lookup"><span data-stu-id="46664-209">The Disk Space Requirements page calculates the required disk space for the features that you specify, and compares requirements to the available disk space on the computer where Setup is running.</span></span>  
  
12. <span data-ttu-id="46664-210">在“全文搜索升级”页上为所升级的数据库指定升级选项。</span><span class="sxs-lookup"><span data-stu-id="46664-210">On the Full-Text Search Upgrade page, specify the upgrade options for the databases being upgraded.</span></span> <span data-ttu-id="46664-211">有关详细信息，请参阅 [全文搜索升级选项](../../install/full-text-search-upgrade-options.md)。</span><span class="sxs-lookup"><span data-stu-id="46664-211">For more information, see [Full-Text Search Upgrade Options](../../install/full-text-search-upgrade-options.md).</span></span>  
  
13. <span data-ttu-id="46664-212">在 **“错误报告”** 页上，指定要发送到 [!INCLUDE[msCoName](../../../includes/msconame-md.md)] 以帮助改进 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]的信息。</span><span class="sxs-lookup"><span data-stu-id="46664-212">On the **Error Reporting** page, specify the information that you want to send to [!INCLUDE[msCoName](../../../includes/msconame-md.md)] that will help improve [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="46664-213">默认情况下，将启用用于错误报告的选项。</span><span class="sxs-lookup"><span data-stu-id="46664-213">By default, options for error reporting is enabled.</span></span>  
  
14. <span data-ttu-id="46664-214">在升级操作开始之前，系统配置检查器将运行多组规则来针对您指定的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 功能验证您的计算机配置。</span><span class="sxs-lookup"><span data-stu-id="46664-214">The System Configuration Checker runs one more set of rules to validate your computer configuration with the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] features that you have specified, before the upgrade operation begins.</span></span>  
  
15. <span data-ttu-id="46664-215">“群集升级报告”页显示故障转移群集实例中的节点列表和每个节点上的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 组件的实例版本信息。</span><span class="sxs-lookup"><span data-stu-id="46664-215">The Cluster Upgrade Report page displays the list of nodes in the failover cluster instance and the instance version information for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] components on each node.</span></span> <span data-ttu-id="46664-216">它显示数据库脚本状态和复制脚本状态。</span><span class="sxs-lookup"><span data-stu-id="46664-216">It displays the database script status and replication script status.</span></span> <span data-ttu-id="46664-217">此外，还会显示有关单击 **“下一步”** 时会发生的情况的信息性消息。</span><span class="sxs-lookup"><span data-stu-id="46664-217">In addition, it also displays informational messages on what will occur when you click **Next**.</span></span> <span data-ttu-id="46664-218">根据已升级的故障转移群集节点数和节点总数，安装程序会显示单击 "**下一步**" 时发生的故障转移行为。</span><span class="sxs-lookup"><span data-stu-id="46664-218">Depending on the number of failover cluster nodes that have already been upgraded and total number of nodes, Setup displays the failover behavior that happens when you click **Next**.</span></span> <span data-ttu-id="46664-219">如果您尚未安装必备组件，还会就潜在的不必要停机时间向您发出警告。</span><span class="sxs-lookup"><span data-stu-id="46664-219">It also warns about potential unnecessary downtime if you have not installed the prerequisites already.</span></span>  
  
16. <span data-ttu-id="46664-220">“准备升级”页显示您在安装过程中指定的安装选项的树视图。</span><span class="sxs-lookup"><span data-stu-id="46664-220">The Ready to Upgrade page displays a tree view of installation options that were specified during Setup.</span></span> <span data-ttu-id="46664-221">若要继续，请单击 **“升级”** 。</span><span class="sxs-lookup"><span data-stu-id="46664-221">To continue, click **Upgrade**.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="46664-222">安装程序将首先安装所选功能的必备组件，然后安装所选功能。</span><span class="sxs-lookup"><span data-stu-id="46664-222">Setup will first install the required prerequisites for the selected features followed by the feature installation.</span></span>  
  
17. <span data-ttu-id="46664-223">在升级过程中，“进度”页会提供相应的状态，因此您可以在安装程序进行的过程中监视当前节点上的升级进度。</span><span class="sxs-lookup"><span data-stu-id="46664-223">During upgrade, the Progress page provides status so that you can monitor the upgrade progress on the current node as Setup continues.</span></span>  
  
18. <span data-ttu-id="46664-224">完成当前节点的升级后，“群集升级报告”页将显示所有故障转移群集节点的升级状态信息、每个故障转移群集节点上的功能及其版本信息。</span><span class="sxs-lookup"><span data-stu-id="46664-224">After the upgrade of the current node, the Cluster Upgrade Report page displays an upgrade status information for all the failover cluster nodes, features on each failover cluster node, and their version information.</span></span> <span data-ttu-id="46664-225">确认显示的版本信息正确，然后继续对剩余节点进行升级。</span><span class="sxs-lookup"><span data-stu-id="46664-225">Confirm the version information that is displayed and continue with the upgrade of the remaining nodes.</span></span> <span data-ttu-id="46664-226">如果发生了向已升级的节点进行的故障转移，则也会显示在状态页上。</span><span class="sxs-lookup"><span data-stu-id="46664-226">If the failover to upgraded nodes occurred, this is also apparent on the status page.</span></span> <span data-ttu-id="46664-227">您还可以登入 Windows 群集管理员工具以进行确认。</span><span class="sxs-lookup"><span data-stu-id="46664-227">You can also check in the Windows Cluster administrator tool to confirm.</span></span>  
  
19. <span data-ttu-id="46664-228">升级完成后，“完成”页会提供指向安装摘要日志文件以及其他重要说明的链接。</span><span class="sxs-lookup"><span data-stu-id="46664-228">After upgrade, the Complete page provides a link to the summary log file for the installation and other important notes.</span></span> <span data-ttu-id="46664-229">若要完成 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 安装过程，请单击 **“关闭”** 。</span><span class="sxs-lookup"><span data-stu-id="46664-229">To complete the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] installation process, click **Close**.</span></span>  
  
20. <span data-ttu-id="46664-230">如果安装程序指示您重新启动计算机，请立即重新启动。</span><span class="sxs-lookup"><span data-stu-id="46664-230">If you are instructed to restart the computer, do so now.</span></span> <span data-ttu-id="46664-231">安装完成后，请务必阅读来自安装向导的消息。</span><span class="sxs-lookup"><span data-stu-id="46664-231">It is important to read the message from the Installation Wizard when you have finished with Setup.</span></span> <span data-ttu-id="46664-232">有关安装程序日志文件的详细信息，请参阅 [查看和阅读 SQL Server 安装程序日志文件](../../../database-engine/install-windows/view-and-read-sql-server-setup-log-files.md)。</span><span class="sxs-lookup"><span data-stu-id="46664-232">For more information about Setup log files, see [View and Read SQL Server Setup Log Files](../../../database-engine/install-windows/view-and-read-sql-server-setup-log-files.md).</span></span>  
  
21. <span data-ttu-id="46664-233">若要完成升级过程，请在 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 故障转移群集的所有其他节点上重复步骤 1 到步骤 21。</span><span class="sxs-lookup"><span data-stu-id="46664-233">To complete the upgrade process, repeat steps 1 to 21 on all the other nodes on the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover cluster.</span></span>  
  
## <a name="to-upgrade-a-ssnoversion-multi-subnet-failover-cluster"></a><span data-ttu-id="46664-234">升级 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 多子网故障转移群集</span><span class="sxs-lookup"><span data-stu-id="46664-234">To upgrade a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Multi-Subnet Failover Cluster</span></span>  
  
#### <a name="to-upgrade-to-a-ssnoversion-multi-subnet-failover-cluster-existing-ssnoversion-cluster-is-a-non-multi-subnet-cluster"></a><span data-ttu-id="46664-235">升级到 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 多子网故障转移群集（现有 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 群集是非多子网群集）。</span><span class="sxs-lookup"><span data-stu-id="46664-235">To upgrade to a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] multi-subnet failover Cluster (Existing [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] cluster is a non multi-subnet cluster).</span></span>  
  
1.  <span data-ttu-id="46664-236">按照上面的[升级 SQL Server 故障转移群集](#UpgradeSteps)部分中所述的步骤1到步骤24将群集升级到 [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="46664-236">Follow the steps 1 through 24 described in the [To upgrade a SQL Server failover cluster](#UpgradeSteps) section above to upgrade your cluster to [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)].</span></span>  
  
2.  <span data-ttu-id="46664-237">使用 AddNode 安装程序操作添加不同子网上的节点，并确认在 **“群集网络配置”** 页将 IP 地址资源依赖关系更改为 OR。</span><span class="sxs-lookup"><span data-stu-id="46664-237">Add a node on a different subnet using the AddNode Setup action and confirm the IP address resource dependency to OR on the **Cluster Network Configuration** page.</span></span> <span data-ttu-id="46664-238">有关详细信息，请参阅[在 SQL Server 故障转移群集中添加或删除节点 &#40;安装程序&#41;](../install/add-or-remove-nodes-in-a-sql-server-failover-cluster-setup.md)。</span><span class="sxs-lookup"><span data-stu-id="46664-238">For more information, see [Add or Remove Nodes in a SQL Server Failover Cluster &#40;Setup&#41;](../install/add-or-remove-nodes-in-a-sql-server-failover-cluster-setup.md).</span></span>  
  
#### <a name="to-upgrade-a-multi-subnet-cluster-currently-using-stretch-v-lan"></a><span data-ttu-id="46664-239">当前使用拉伸 V-LAN 升级多子网群集。</span><span class="sxs-lookup"><span data-stu-id="46664-239">To upgrade a multi-subnet cluster currently using Stretch V-Lan.</span></span>  
  
1.  <span data-ttu-id="46664-240">按照上面的[升级 SQL Server 故障转移群集](#UpgradeSteps)部分中所述的步骤1到步骤24将群集升级到 [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="46664-240">Follow the steps 1 through 24 described in the [To upgrade a SQL Server failover cluster](#UpgradeSteps) section above to upgrade your cluster to [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span></span>  
  
2.  <span data-ttu-id="46664-241">更改网络设置以将远程节点移到不同的子网。</span><span class="sxs-lookup"><span data-stu-id="46664-241">Change the network settings to move the remote node to a different subnet.</span></span>  
  
3.  <span data-ttu-id="46664-242">使用 Windows 故障转移群集管理工具添加新子网的新 IP 地址，将 IP 地址资源依赖关系设置为 OR。</span><span class="sxs-lookup"><span data-stu-id="46664-242">Using the Windows Failover Cluster management tool, add a new IP address for the new subnet set the IP address resource dependency to OR.</span></span>  
  
## <a name="next-steps"></a><span data-ttu-id="46664-243">后续步骤</span><span class="sxs-lookup"><span data-stu-id="46664-243">Next Steps</span></span>  
 <span data-ttu-id="46664-244">升级到 [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)]后，请完成下列任务：</span><span class="sxs-lookup"><span data-stu-id="46664-244">After you upgrade to [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)], complete the following tasks:</span></span>  
  
-   <span data-ttu-id="46664-245">注册服务器</span><span class="sxs-lookup"><span data-stu-id="46664-245">Register your servers</span></span>  
  
     <span data-ttu-id="46664-246">升级会删除早期的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例的注册表设置。</span><span class="sxs-lookup"><span data-stu-id="46664-246">Upgrade removes registry settings for the previous [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="46664-247">升级之后，必须重新注册服务器。</span><span class="sxs-lookup"><span data-stu-id="46664-247">After you upgrade, you must reregister your servers.</span></span>  
  
-   <span data-ttu-id="46664-248">更新统计信息</span><span class="sxs-lookup"><span data-stu-id="46664-248">Update statistics</span></span>  
  
     <span data-ttu-id="46664-249">建议您在升级之后对所有数据库更新统计信息，以便优化查询性能。</span><span class="sxs-lookup"><span data-stu-id="46664-249">To help optimize query performance, we recommend that you update statistics on all databases following upgrade.</span></span> <span data-ttu-id="46664-250">使用 **sp_updatestats** 存储过程可以更新 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 数据库中用户定义的表中的统计信息。</span><span class="sxs-lookup"><span data-stu-id="46664-250">Use the **sp_updatestats** stored procedure to update statistics in user-defined tables in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] databases.</span></span>  
  
-   <span data-ttu-id="46664-251">配置新安装的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]</span><span class="sxs-lookup"><span data-stu-id="46664-251">Configure your new [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] installation</span></span>  
  
     <span data-ttu-id="46664-252">为了减少系统的可攻击外围应用， [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 有选择地安装和启用了一些关键服务和功能。</span><span class="sxs-lookup"><span data-stu-id="46664-252">To reduce the attackable surface area of a system, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] selectively installs and enables key services and features.</span></span> <span data-ttu-id="46664-253">有关外围应用配置器工具的详细信息，请参阅此版本的自述文件。</span><span class="sxs-lookup"><span data-stu-id="46664-253">For more information about surface area configuration, see the readme file for this release.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="46664-254">另请参阅</span><span class="sxs-lookup"><span data-stu-id="46664-254">See Also</span></span>  
 <span data-ttu-id="46664-255">[从命令提示符安装 SQL Server 2014](../../../database-engine/install-windows/install-sql-server-from-the-command-prompt.md) </span><span class="sxs-lookup"><span data-stu-id="46664-255">[Install SQL Server 2014 from the Command Prompt](../../../database-engine/install-windows/install-sql-server-from-the-command-prompt.md) </span></span>  
 [<span data-ttu-id="46664-256">查看和读取 SQL Server 安装程序日志文件</span><span class="sxs-lookup"><span data-stu-id="46664-256">View and Read SQL Server Setup Log Files</span></span>](../../../database-engine/install-windows/view-and-read-sql-server-setup-log-files.md)  
  
  
