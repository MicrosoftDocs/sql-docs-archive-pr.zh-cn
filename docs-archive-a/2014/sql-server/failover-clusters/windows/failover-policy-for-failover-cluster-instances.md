---
title: 故障转移群集实例的故障转移策略 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- flexible failover policy
ms.assetid: 39ceaac5-42fa-4b5d-bfb6-54403d7f0dc9
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 8d441e5627280cb46168d9ff187d7f43da8b26a6
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87586263"
---
# <a name="failover-policy-for-failover-cluster-instances"></a><span data-ttu-id="86915-102">Failover Policy for Failover Cluster Instances</span><span class="sxs-lookup"><span data-stu-id="86915-102">Failover Policy for Failover Cluster Instances</span></span>
  <span data-ttu-id="86915-103">在 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 故障转移群集实例 (FCI) 中，在给定的时间只有一个节点可以拥有 Windows Server 故障转移群集 (WSFC) 群集资源组。</span><span class="sxs-lookup"><span data-stu-id="86915-103">In a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover cluster instance (FCI), only one node can own the Windows Server Failover Cluster (WSFC) cluster resource group at a given time.</span></span> <span data-ttu-id="86915-104">客户端请求通过 FCI 中的此节点进行处理。</span><span class="sxs-lookup"><span data-stu-id="86915-104">The client requests are served through this node in the FCI.</span></span> <span data-ttu-id="86915-105">在发生故障和重新启动失败时，组的所有权将转移给 FCI 中的另一个 WSFC 节点。</span><span class="sxs-lookup"><span data-stu-id="86915-105">In the case of a failure and an unsuccessful restart, the group ownership is moved to another WSFC node in the FCI.</span></span> <span data-ttu-id="86915-106">此过程称为故障转移。</span><span class="sxs-lookup"><span data-stu-id="86915-106">This process is called failover.</span></span> [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] <span data-ttu-id="86915-107">提高了故障检测的可靠性，并提供灵活的故障转移策略。</span><span class="sxs-lookup"><span data-stu-id="86915-107">increases the reliability of failure detection and provides a flexible failover policy.</span></span>  
  
 <span data-ttu-id="86915-108">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] FCI 依赖于基础 WSFC 服务进行故障转移检测。</span><span class="sxs-lookup"><span data-stu-id="86915-108">A [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] FCI depends on the underlying WSFC service for failover detection.</span></span> <span data-ttu-id="86915-109">因此，两个机制决定了 FCI 的故障转移行为：一个是本机 WSFC 功能，一个是 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 安装程序带来的功能。</span><span class="sxs-lookup"><span data-stu-id="86915-109">Therefore, two mechanisms determine the failover behavior for FCI: the former is native WSFC functionality, and the latter is functionality added by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] setup.</span></span>  
  
-   <span data-ttu-id="86915-110">WSFC 群集维护仲裁配置，这确保自动故障转移中的故障转移目标唯一。</span><span class="sxs-lookup"><span data-stu-id="86915-110">The WSFC cluster maintains the quorum configuration, which ensures a unique failover target in an automatic failover.</span></span> <span data-ttu-id="86915-111">WSFC 服务决定群集在任何时间是否处于最佳仲裁状态并相应使资源组联机或脱机。</span><span class="sxs-lookup"><span data-stu-id="86915-111">The WSFC service determines whether the cluster is in optimal quorum health at all times and brings the resource group online and offline accordingly.</span></span>  
  
-   <span data-ttu-id="86915-112">活动的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例通过专用连接定期向 WSFC 资源组报告一组组件诊断信息。</span><span class="sxs-lookup"><span data-stu-id="86915-112">The active [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance periodically reports a set of component diagnostics to the WSFC resource group over a dedicated connection.</span></span> <span data-ttu-id="86915-113">WSFC 资源组维护故障转移策略，该策略定义触发重新启动和故障转移的故障条件。</span><span class="sxs-lookup"><span data-stu-id="86915-113">The WSFC resource group maintains the failover policy, which defines the failure conditions that trigger restarts and failovers.</span></span>  
  
 <span data-ttu-id="86915-114">本主题讨论上面的第二个机制。</span><span class="sxs-lookup"><span data-stu-id="86915-114">This topic discusses the second mechanism above.</span></span> <span data-ttu-id="86915-115">有关仲裁配置和运行状况检测的 WSFC 行为的详细信息，请参阅 [WSFC 仲裁模式和投票配置 (SQL Server)](wsfc-quorum-modes-and-voting-configuration-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="86915-115">For more information on the WSFC behavior for quorum configuration and health detection, see [WSFC Quorum Modes and Voting Configuration &#40;SQL Server&#41;](wsfc-quorum-modes-and-voting-configuration-sql-server.md).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="86915-116">AlwaysOn 可用性组中不允许自动故障转移到 FCI 或从 FCI 自动故障转移。</span><span class="sxs-lookup"><span data-stu-id="86915-116">Automatic failovers to and from an FCI are not allowed in an AlwaysOn availability group.</span></span> <span data-ttu-id="86915-117">但是，可以在 AlwaysOn 可用性组中手动故障转移到 FCI 或从 FCI 手动故障转移。</span><span class="sxs-lookup"><span data-stu-id="86915-117">However, manual failovers to and from and FCI are allowed in an AlwaysOn availability group.</span></span>  
  
##  <a name="failover-policy-overview"></a><a name="Concepts"></a> <span data-ttu-id="86915-118">故障转移策略概述</span><span class="sxs-lookup"><span data-stu-id="86915-118">Failover Policy Overview</span></span>  
 <span data-ttu-id="86915-119">故障转移过程可以分为以下步骤：</span><span class="sxs-lookup"><span data-stu-id="86915-119">The failover process can be broken down into the following steps:</span></span>  
  
1.  [<span data-ttu-id="86915-120">监视运行状态</span><span class="sxs-lookup"><span data-stu-id="86915-120">Monitor the Health Status</span></span>](failover-policy-for-failover-cluster-instances.md#monitor)  
  
2.  [<span data-ttu-id="86915-121">确定故障</span><span class="sxs-lookup"><span data-stu-id="86915-121">Determining Failures</span></span>](failover-policy-for-failover-cluster-instances.md#determine)  
  
3.  [<span data-ttu-id="86915-122">响应故障</span><span class="sxs-lookup"><span data-stu-id="86915-122">Responding to Failures</span></span>](failover-policy-for-failover-cluster-instances.md#respond)  
  
###  <a name="monitor-the-health-status"></a><a name="monitor"></a><span data-ttu-id="86915-123">监视运行状况状态</span><span class="sxs-lookup"><span data-stu-id="86915-123">Monitor the Health Status</span></span>  
 <span data-ttu-id="86915-124">为 FCI 监视三种运行状态：</span><span class="sxs-lookup"><span data-stu-id="86915-124">There are three types of health statuses that are monitored for the FCI:</span></span>  
  
-   [<span data-ttu-id="86915-125">SQL Server 服务的状态</span><span class="sxs-lookup"><span data-stu-id="86915-125">State of the SQL Server service</span></span>](failover-policy-for-failover-cluster-instances.md#service)  
  
-   [<span data-ttu-id="86915-126">SQL Server 实例的响应情况</span><span class="sxs-lookup"><span data-stu-id="86915-126">Responsiveness of the SQL Server instance</span></span>](failover-policy-for-failover-cluster-instances.md#instance)  
  
-   [<span data-ttu-id="86915-127">SQL Server 组件诊断</span><span class="sxs-lookup"><span data-stu-id="86915-127">SQL Server component diagnostics</span></span>](failover-policy-for-failover-cluster-instances.md#component)  
  
####  <a name="state-of-the-sql-server-service"></a><a name="service"></a><span data-ttu-id="86915-128">SQL Server 服务的状态</span><span class="sxs-lookup"><span data-stu-id="86915-128">State of the SQL Server service</span></span>  
 <span data-ttu-id="86915-129">WSFC 服务监视活动 FCI 节点上的 SQL Server 服务的启动状态，以检测 SQL Server 服务何时停止。</span><span class="sxs-lookup"><span data-stu-id="86915-129">The WSFC service monitors the start state of the SQL Server service on the active FCI node to detect when the SQL Server service is stopped.</span></span>  
  
####  <a name="responsiveness-of-the-sql-server-instance"></a><a name="instance"></a><span data-ttu-id="86915-130">SQL Server 实例的响应能力</span><span class="sxs-lookup"><span data-stu-id="86915-130">Responsiveness of the SQL Server instance</span></span>  
 <span data-ttu-id="86915-131">在 SQL Server 启动期间，WSFC 服务使用 SQL Server 数据库引擎资源 DLL 在它专用的单独线程上创建一个专门用于监视运行状态的新连接。</span><span class="sxs-lookup"><span data-stu-id="86915-131">During SQL Server startup, the WSFC service uses the SQL Server Database Engine resource DLL to create a new connection to on a separate thread that is used exclusively for monitoring the health status.</span></span> <span data-ttu-id="86915-132">这确保 SQL 实例在负载下有所需的资源来报告其运行状态。</span><span class="sxs-lookup"><span data-stu-id="86915-132">This ensures that there the SQL instance has the required resources to report its health status while under load.</span></span> <span data-ttu-id="86915-133">使用此专用连接，SQL Server 反复运行 [sp_server_diagnostics (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-server-diagnostics-transact-sql) 系统存储过程以定期将 SQL Server 组件的运行状态报告给资源 DLL。</span><span class="sxs-lookup"><span data-stu-id="86915-133">Using this dedicated connection, SQL Server runs the [sp_server_diagnostics &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-server-diagnostics-transact-sql) system stored procedure in repeat mode to periodically report the health status of the SQL Server components to the resource DLL.</span></span>  
  
 <span data-ttu-id="86915-134">资源 DLL 使用运行状况检查超时值确定 SQL 实例的响应情况。</span><span class="sxs-lookup"><span data-stu-id="86915-134">The resource DLL determines the responsiveness of the SQL instance using a health check timeout.</span></span> <span data-ttu-id="86915-135">HealthCheckTimeout 属性定义资源 DLL 在向 WSFC 服务报告 SQL 实例不响应前应等待 sp_server_diagnostics 存储过程多长时间。</span><span class="sxs-lookup"><span data-stu-id="86915-135">The HealthCheckTimeout property defines how long the resource DLL should wait for the sp_server_diagnostics stored procedure before it reports the SQL instance as unresponsive to the WSFC service.</span></span> <span data-ttu-id="86915-136">此属性可使用 T-SQL 和故障转移群集管理器管理单元进行配置。</span><span class="sxs-lookup"><span data-stu-id="86915-136">This property is configurable using T-SQL as well as in the Failover Cluster Manager snap-in.</span></span> <span data-ttu-id="86915-137">有关详细信息，请参阅 [Configure HealthCheckTimeout Property Settings](configure-healthchecktimeout-property-settings.md)。</span><span class="sxs-lookup"><span data-stu-id="86915-137">For more information, see [Configure HealthCheckTimeout Property Settings](configure-healthchecktimeout-property-settings.md).</span></span> <span data-ttu-id="86915-138">以下项描述了此属性如何影响超时和重复间隔设置：</span><span class="sxs-lookup"><span data-stu-id="86915-138">The following items describe how this property affects timeout and repeat interval settings:</span></span>  
  
-   <span data-ttu-id="86915-139">资源 DLL 调用 sp_server_diagnostics 存储过程，并将重复间隔设置为 HealthCheckTimeout 值的三分之一。</span><span class="sxs-lookup"><span data-stu-id="86915-139">The resource DLL calls the sp_server_diagnostics stored procedure and sets the repeat interval to one-third of the HealthCheckTimeout setting.</span></span>  
  
-   <span data-ttu-id="86915-140">如果 sp_server_diagnostics 存储过程运行缓慢或没有返回信息，资源 DLL 将等待 HealthCheckTimeout 所指定的间隔后向 WSFC 服务报告 SQL 实例不响应。</span><span class="sxs-lookup"><span data-stu-id="86915-140">If the sp_server_diagnostics stored procedure is slow or is not returning information, the resource DLL will wait for the interval specified by HealthCheckTimeout before it reports to the WSFC service that the SQL instance is unresponsive.</span></span>  
  
-   <span data-ttu-id="86915-141">如果专用连接丢失，资源 DLL 将在 HealthCheckTimeout 所指定的间隔内重试连接到 SQL 实例，然后向 WSFC 服务报告 SQL 实例不响应。</span><span class="sxs-lookup"><span data-stu-id="86915-141">If the dedicated connection is lost, the resource DLL will retry the connection to the SQL instance for the interval specified by HealthCheckTimeout before it reports to the WSFC service that the SQL instance is unresponsive.</span></span>  
  
####  <a name="sql-server-component-diagnostics"></a><a name="component"></a><span data-ttu-id="86915-142">SQL Server 组件诊断</span><span class="sxs-lookup"><span data-stu-id="86915-142">SQL Server component diagnostics</span></span>  
 <span data-ttu-id="86915-143">系统存储过程 sp_server_diagnostics 定期收集 SQL 实例的组件诊断信息。</span><span class="sxs-lookup"><span data-stu-id="86915-143">The system stored procedure sp_server_diagnostics periodically collects component diagnostics on the SQL instance.</span></span> <span data-ttu-id="86915-144">收集的诊断信息将针对以下每个组件显示一行，并且这些信息将传递给调用线程：</span><span class="sxs-lookup"><span data-stu-id="86915-144">The diagnostic information that is collected is surfaced as a row for each of the following components and passed to the calling thread.</span></span>  
  
1.  <span data-ttu-id="86915-145">system</span><span class="sxs-lookup"><span data-stu-id="86915-145">system</span></span>  
  
2.  <span data-ttu-id="86915-146">resource</span><span class="sxs-lookup"><span data-stu-id="86915-146">resource</span></span>  
  
3.  <span data-ttu-id="86915-147">查询进程</span><span class="sxs-lookup"><span data-stu-id="86915-147">query process</span></span>  
  
4.  <span data-ttu-id="86915-148">io_subsystem</span><span class="sxs-lookup"><span data-stu-id="86915-148">io_subsystem</span></span>  
  
5.  <span data-ttu-id="86915-149">events</span><span class="sxs-lookup"><span data-stu-id="86915-149">events</span></span>  
  
 <span data-ttu-id="86915-150">系统、资源和查询进程组件用于故障检测。</span><span class="sxs-lookup"><span data-stu-id="86915-150">The system, resource, and query process components are used for failure detection.</span></span> <span data-ttu-id="86915-151">io_subsytem 和事件组件仅用于诊断目的。</span><span class="sxs-lookup"><span data-stu-id="86915-151">The io_subsytem and events components are used for diagnostic purposes only.</span></span>  
  
 <span data-ttu-id="86915-152">还将信息的每个行集写入 SQL Server 群集诊断日志。</span><span class="sxs-lookup"><span data-stu-id="86915-152">Each rowset of information is also written to the SQL Server cluster diagnostics log.</span></span> <span data-ttu-id="86915-153">有关详细信息，请参阅 [查看和读取故障转移群集实例诊断日志](view-and-read-failover-cluster-instance-diagnostics-log.md)。</span><span class="sxs-lookup"><span data-stu-id="86915-153">For more information, see [View and Read Failover Cluster Instance Diagnostics Log](view-and-read-failover-cluster-instance-diagnostics-log.md).</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="86915-154">SQL Server AlwaysOn 技术使用 sp_server_diagnostic 存储过程时，该存储过程可用于任何 SQL Server 实例以帮助检测和解决问题。</span><span class="sxs-lookup"><span data-stu-id="86915-154">While the sp_server_diagnostic stored procedure is used by SQL Server AlwaysOn technology, it is available for use in any SQL Server instance to help detect and troubleshoot problems.</span></span>  
  
####  <a name="determining-failures"></a><a name="determine"></a> <span data-ttu-id="86915-155">确定故障</span><span class="sxs-lookup"><span data-stu-id="86915-155">Determining Failures</span></span>  
 <span data-ttu-id="86915-156">SQL Server 数据库引擎资源 DLL 使用 FailureConditionLevel 属性确定检测到的运行状态是否符合故障条件。</span><span class="sxs-lookup"><span data-stu-id="86915-156">The SQL Server Database Engine resource DLL determines whether the detected health status is a condition for failure using the FailureConditionLevel property.</span></span> <span data-ttu-id="86915-157">FailureConditionLevel 属性定义哪些检测到的运行状态导致重新启动或故障转移。</span><span class="sxs-lookup"><span data-stu-id="86915-157">The FailureConditionLevel property defines which detected health statuses cause restarts or failovers.</span></span> <span data-ttu-id="86915-158">提供了多个选项级别，涵盖不自动重新启动或故障转移到导致自动重新启动或故障转移的所有可能故障条件。</span><span class="sxs-lookup"><span data-stu-id="86915-158">Multiple levels of options are available, ranging from no automatic restart or failover to all possible failure conditions resulting in an automatic restart or failover.</span></span> <span data-ttu-id="86915-159">有关如何配置此属性的详细信息，请参阅 [Configure FailureConditionLevel Property Settings](configure-failureconditionlevel-property-settings.md)。</span><span class="sxs-lookup"><span data-stu-id="86915-159">For more information about how to configure this property, see [Configure FailureConditionLevel Property Settings](configure-failureconditionlevel-property-settings.md).</span></span>  
  
 <span data-ttu-id="86915-160">针对递增的级别设置故障条件。</span><span class="sxs-lookup"><span data-stu-id="86915-160">The failure conditions are set on an increasing scale.</span></span> <span data-ttu-id="86915-161">对于级别 1-5，每个级别除了自己的条件外，还包括之前级别的所有条件。</span><span class="sxs-lookup"><span data-stu-id="86915-161">For levels 1-5, each level includes all the conditions from the previous levels in addition to its own conditions.</span></span> <span data-ttu-id="86915-162">这意味着，每个级别越大，故障转移或重新启动的几率不断加大。</span><span class="sxs-lookup"><span data-stu-id="86915-162">This means that with each level, there is an increased probability of a failover or restart.</span></span> <span data-ttu-id="86915-163">下表介绍了这些故障条件级别：</span><span class="sxs-lookup"><span data-stu-id="86915-163">The failure condition levels are described in the following table.</span></span>  
  
 <span data-ttu-id="86915-164">查看 [sp_server_diagnostics (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-server-diagnostics-transact-sql)，因为此系统存储过程在故障条件级别中起重要作用。</span><span class="sxs-lookup"><span data-stu-id="86915-164">Review [sp_server_diagnostics &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-server-diagnostics-transact-sql) as this system stored procedure plays in important role in the failure condition levels.</span></span>  
  
|<span data-ttu-id="86915-165">级别</span><span class="sxs-lookup"><span data-stu-id="86915-165">Level</span></span>|<span data-ttu-id="86915-166">条件</span><span class="sxs-lookup"><span data-stu-id="86915-166">Condition</span></span>|<span data-ttu-id="86915-167">说明</span><span class="sxs-lookup"><span data-stu-id="86915-167">Description</span></span>|  
|-----------|---------------|-----------------|  
|<span data-ttu-id="86915-168">0</span><span class="sxs-lookup"><span data-stu-id="86915-168">0</span></span>|<span data-ttu-id="86915-169">无自动故障转移或重新启动</span><span class="sxs-lookup"><span data-stu-id="86915-169">No automatic failover or restart</span></span>|<span data-ttu-id="86915-170">表示对于任何故障条件将不自动触发故障转移或重新启动。</span><span class="sxs-lookup"><span data-stu-id="86915-170">Indicates that no failover or restart will be triggered automatically on any failure conditions.</span></span> <span data-ttu-id="86915-171">此级别仅适用于系统维护目的。</span><span class="sxs-lookup"><span data-stu-id="86915-171">This level is for system maintenance purposes only.</span></span>|  
|<span data-ttu-id="86915-172">1</span><span class="sxs-lookup"><span data-stu-id="86915-172">1</span></span>|<span data-ttu-id="86915-173">服务器关闭时进行故障转移或重新启动</span><span class="sxs-lookup"><span data-stu-id="86915-173">Failover or restart on server down</span></span>|<span data-ttu-id="86915-174">指示当满足以下条件时将触发服务器重新启动或故障转移：</span><span class="sxs-lookup"><span data-stu-id="86915-174">Indicates that a server restart or failover will be triggered if the following condition is raised:</span></span><br /><br /> <span data-ttu-id="86915-175">SQL Server 服务停止。</span><span class="sxs-lookup"><span data-stu-id="86915-175">SQL Server service is down.</span></span>|  
|<span data-ttu-id="86915-176">2</span><span class="sxs-lookup"><span data-stu-id="86915-176">2</span></span>|<span data-ttu-id="86915-177">服务器不响应时进行故障转移或重新启动</span><span class="sxs-lookup"><span data-stu-id="86915-177">Failover or restart on server unresponsive</span></span>|<span data-ttu-id="86915-178">指示当满足以下任意条件时将触发服务器重新启动或故障转移：</span><span class="sxs-lookup"><span data-stu-id="86915-178">Indicates that a server restart or failover will be triggered if any of the following conditions are raised:</span></span><br /><br /> <span data-ttu-id="86915-179">SQL Server 服务停止。</span><span class="sxs-lookup"><span data-stu-id="86915-179">SQL Server service is down.</span></span><br /><br /> <span data-ttu-id="86915-180">SQL Server 实例不响应（资源 DLL 在 HealthCheckTimeout 设置时间内未收到来自 sp_server_diagnostics 的数据）。</span><span class="sxs-lookup"><span data-stu-id="86915-180">SQL Server instance is not responsive (Resource DLL cannot receive data from sp_server_diagnostics within the HealthCheckTimeout settings).</span></span>|  
|<span data-ttu-id="86915-181">3\*</span><span class="sxs-lookup"><span data-stu-id="86915-181">3\*</span></span>|<span data-ttu-id="86915-182">出现严重服务器错误时进行故障转移或重新启动</span><span class="sxs-lookup"><span data-stu-id="86915-182">Failover or restart on critical server errors</span></span>|<span data-ttu-id="86915-183">指示当满足以下任意条件时将触发服务器重新启动或故障转移：</span><span class="sxs-lookup"><span data-stu-id="86915-183">Indicates that a server restart or failover will be triggered if any of the following conditions are raised:</span></span><br /><br /> <span data-ttu-id="86915-184">SQL Server 服务停止。</span><span class="sxs-lookup"><span data-stu-id="86915-184">SQL Server service is down.</span></span><br /><br /> <span data-ttu-id="86915-185">SQL Server 实例不响应（资源 DLL 在 HealthCheckTimeout 设置时间内未收到来自 sp_server_diagnostics 的数据）。</span><span class="sxs-lookup"><span data-stu-id="86915-185">SQL Server instance is not responsive (Resource DLL cannot receive data from sp_server_diagnostics within the HealthCheckTimeout settings).</span></span><br /><br /> <span data-ttu-id="86915-186">系统存储过程 sp_server_diagnostics 返回“系统错误”。</span><span class="sxs-lookup"><span data-stu-id="86915-186">System stored procedure sp_server_diagnostics returns 'system error'.</span></span>|  
|<span data-ttu-id="86915-187">4</span><span class="sxs-lookup"><span data-stu-id="86915-187">4</span></span>|<span data-ttu-id="86915-188">出现中等服务器错误时进行故障转移或重新启动</span><span class="sxs-lookup"><span data-stu-id="86915-188">Failover or restart on moderate server errors</span></span>|<span data-ttu-id="86915-189">指示当满足以下任意条件时将触发服务器重新启动或故障转移：</span><span class="sxs-lookup"><span data-stu-id="86915-189">Indicates that a server restart or failover will be triggered if any of the following conditions are raised:</span></span><br /><br /> <span data-ttu-id="86915-190">SQL Server 服务停止。</span><span class="sxs-lookup"><span data-stu-id="86915-190">SQL Server service is down.</span></span><br /><br /> <span data-ttu-id="86915-191">SQL Server 实例不响应（资源 DLL 在 HealthCheckTimeout 设置时间内未收到来自 sp_server_diagnostics 的数据）。</span><span class="sxs-lookup"><span data-stu-id="86915-191">SQL Server instance is not responsive (Resource DLL cannot receive data from sp_server_diagnostics within the HealthCheckTimeout settings).</span></span><br /><br /> <span data-ttu-id="86915-192">系统存储过程 sp_server_diagnostics 返回“系统错误”。</span><span class="sxs-lookup"><span data-stu-id="86915-192">System stored procedure sp_server_diagnostics returns 'system error'.</span></span><br /><br /> <span data-ttu-id="86915-193">系统存储过程 sp_server_diagnostics 返回“资源错误”。</span><span class="sxs-lookup"><span data-stu-id="86915-193">System  stored procedure sp_server_diagnostics returns 'resource error'.</span></span>|  
|<span data-ttu-id="86915-194">5</span><span class="sxs-lookup"><span data-stu-id="86915-194">5</span></span>|<span data-ttu-id="86915-195">对于任何合格的故障条件进行故障转移或重新启动</span><span class="sxs-lookup"><span data-stu-id="86915-195">Failover or restart on any qualified failure conditions</span></span>|<span data-ttu-id="86915-196">指示当满足以下任意条件时将触发服务器重新启动或故障转移：</span><span class="sxs-lookup"><span data-stu-id="86915-196">Indicates that a server restart or failover will be triggered if any of the following conditions are raised:</span></span><br /><br /> <span data-ttu-id="86915-197">SQL Server 服务停止。</span><span class="sxs-lookup"><span data-stu-id="86915-197">SQL Server service is down.</span></span><br /><br /> <span data-ttu-id="86915-198">SQL Server 实例不响应（资源 DLL 在 HealthCheckTimeout 设置时间内未收到来自 sp_server_diagnostics 的数据）。</span><span class="sxs-lookup"><span data-stu-id="86915-198">SQL Server instance is not responsive (Resource DLL cannot receive data from sp_server_diagnostics within the HealthCheckTimeout settings).</span></span><br /><br /> <span data-ttu-id="86915-199">系统存储过程 sp_server_diagnostics 返回“系统错误”。</span><span class="sxs-lookup"><span data-stu-id="86915-199">System stored procedure sp_server_diagnostics returns 'system error'.</span></span><br /><br /> <span data-ttu-id="86915-200">系统存储过程 sp_server_diagnostics 返回“资源错误”。</span><span class="sxs-lookup"><span data-stu-id="86915-200">System  stored procedure sp_server_diagnostics returns 'resource error'.</span></span><br /><br /> <span data-ttu-id="86915-201">系统存储过程 sp_server_diagnostics 返回“query_processing 错误”。</span><span class="sxs-lookup"><span data-stu-id="86915-201">System stored procedure sp_server_diagnostics returns 'query_processing error'.</span></span>|  
  
 <span data-ttu-id="86915-202">\*默认值</span><span class="sxs-lookup"><span data-stu-id="86915-202">\*Default Value</span></span>  
  
####  <a name="responding-to-failures"></a><a name="respond"></a><span data-ttu-id="86915-203">响应故障</span><span class="sxs-lookup"><span data-stu-id="86915-203">Responding to Failures</span></span>  
 <span data-ttu-id="86915-204">在检测到一个或多个故障转移条件后，WSFC 服务如何响应故障依赖于 WSFC 仲裁状态以及 FCI 资源组的重新启动和故障转移设置。</span><span class="sxs-lookup"><span data-stu-id="86915-204">After one or more failure conditions are detected, how the WSFC service responds to the failures depends on the WSFC quorum state and the restart and failover settings of the FCI resource group.</span></span> <span data-ttu-id="86915-205">如果 FCI 失去 WSFC 仲裁，则整个 FCI 将脱机并且 FCI 失去高可用性。</span><span class="sxs-lookup"><span data-stu-id="86915-205">If the FCI has lost its WSFC quorum, then the entire FCI is brought offline and the FCI has lost its high availability.</span></span> <span data-ttu-id="86915-206">如果 FCI 仍保留 WSFC 仲裁，则 WSFC 服务可能首次尝试重新启动失败的节点，如果重新启动尝试失败则进行故障转移。</span><span class="sxs-lookup"><span data-stu-id="86915-206">If the FCI still retains its WSFC quorum, then the WSFC service may respond by first attempting to restart the failed node and then failover if the restart attempts are unsuccessful.</span></span> <span data-ttu-id="86915-207">在故障转移群集管理器管理单元中配置重新启动和故障转移设置。</span><span class="sxs-lookup"><span data-stu-id="86915-207">The restart and failover settings are configured in the Failover Cluster Manager snap-in.</span></span> <span data-ttu-id="86915-208">有关这些设置的详细信息，请参阅[ \<Resource> 属性：策略选项卡](https://technet.microsoft.com/library/cc725685.aspx)。</span><span class="sxs-lookup"><span data-stu-id="86915-208">For more information these settings, see [\<Resource> Properties: Policies Tab](https://technet.microsoft.com/library/cc725685.aspx).</span></span>  
  
 <span data-ttu-id="86915-209">有关维护仲裁运行状况的详细信息，请参阅：[WSFC 仲裁模式和投票配置 (SQL Server)](wsfc-quorum-modes-and-voting-configuration-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="86915-209">For more information on maintaining quorum health, see [WSFC Quorum Modes and Voting Configuration &#40;SQL Server&#41;](wsfc-quorum-modes-and-voting-configuration-sql-server.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="86915-210">另请参阅</span><span class="sxs-lookup"><span data-stu-id="86915-210">See Also</span></span>  
 [<span data-ttu-id="86915-211">ALTER SERVER CONFIGURATION (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="86915-211">ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-server-configuration-transact-sql)  
  
  
