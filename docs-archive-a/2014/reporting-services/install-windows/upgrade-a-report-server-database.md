---
title: 升级报表服务器数据库 | Microsoft Docs
ms.custom: ''
ms.date: 08/10/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: database-engine
ms.topic: conceptual
helpviewer_keywords:
- upgrading databases
- report server database
- upgrading Reporting Services
ms.assetid: 4091cf87-9d97-4048-a393-67f1f9207401
author: maggiesMSFT
ms.author: maggies
manager: kfile
ms.openlocfilehash: 28e382de505781f4155204fcc652d1308dacce76
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87591133"
---
# <a name="upgrade-a-report-server-database"></a><span data-ttu-id="8668f-102">升级报表服务器数据库</span><span class="sxs-lookup"><span data-stu-id="8668f-102">Upgrade a Report Server Database</span></span>
  <span data-ttu-id="8668f-103">报表服务器数据库可为一个或多个报表服务器实例提供存储。</span><span class="sxs-lookup"><span data-stu-id="8668f-103">The report server database provides storage for one or more report server instances.</span></span> <span data-ttu-id="8668f-104">因为报表服务器数据库架构可能会因为推出新的 [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)]版本而有所变化，所以要求数据库版本与使用的报表服务器实例的版本相匹配。</span><span class="sxs-lookup"><span data-stu-id="8668f-104">Because the report server database schema can change with each new release of [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)], it is required that the database version match the version of the report server instance you are using.</span></span> <span data-ttu-id="8668f-105">大多数情况下，报表服务器数据库可以自动升级，您不需要执行任何具体操作。</span><span class="sxs-lookup"><span data-stu-id="8668f-105">In most cases, a report server database can be upgraded automatically with no specific action on your part.</span></span>  
  
 <span data-ttu-id="8668f-106">**本机模式：** 在 [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] 纯模式下，Report Server 数据库实际包含两个数据库，其默认名称为 "ReportServer And ReportServerTempDB"。</span><span class="sxs-lookup"><span data-stu-id="8668f-106">**Native Mode:** In [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] Native mode, the report server database is actually comprised of two database that have default names of "ReportServer and ReportServerTempDB".</span></span>  
  
 <span data-ttu-id="8668f-107">**SharePoint 模式：** 在 [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] SharePoint 模式中，Report Server 数据库实际上是为服务应用程序的每个实例创建的数据库的集合 [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="8668f-107">**SharePoint mode:** In [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)][!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] SharePoint mode the report server database is actually a collection of databases that is created for each instance of the [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] service application.</span></span>  
  
## <a name="ways-to-upgrade-a-native-mode-report-server-database"></a><span data-ttu-id="8668f-108">如何升级本机模式报表服务器数据库</span><span class="sxs-lookup"><span data-stu-id="8668f-108">Ways to Upgrade a Native Mode Report Server Database</span></span>  
 <span data-ttu-id="8668f-109">以下列表指出了升级报表服务器数据库的各种情况：</span><span class="sxs-lookup"><span data-stu-id="8668f-109">The following list identifies the conditions under which a report server database is upgraded:</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="8668f-110">安装程序升级报表服务器的单个实例。</span><span class="sxs-lookup"><span data-stu-id="8668f-110">Setup upgrades a single instance of a report server.</span></span> <span data-ttu-id="8668f-111">在服务启动并且报表服务器确定数据库架构版本与服务器版本不匹配之后，将自动升级报表服务器数据库架构。</span><span class="sxs-lookup"><span data-stu-id="8668f-111">The report server database schema is automatically upgraded after service startup and the report server determines that the database schema version does not match the server version.</span></span>  
  
     <span data-ttu-id="8668f-112">服务启动时，报表服务器会检查数据库架构版本以验证它是否与服务器版本相匹配。</span><span class="sxs-lookup"><span data-stu-id="8668f-112">At service startup, the report server checks the database schema version to verify that it matches the server version.</span></span> <span data-ttu-id="8668f-113">如果数据库架构版本较低，该架构将自动升级到报表服务器所需的架构版本。</span><span class="sxs-lookup"><span data-stu-id="8668f-113">If the database schema version is an older version, it is automatically upgraded to the schema version that is required by the report server.</span></span> <span data-ttu-id="8668f-114">如果还原或附加一个较低的报表服务器数据库，则自动升级功能特别有用。</span><span class="sxs-lookup"><span data-stu-id="8668f-114">Automatic upgrade is especially useful if you restored or attached an older report server database.</span></span> <span data-ttu-id="8668f-115">将在报表服务器跟踪日志文件中输入一条消息，指示已升级数据库架构版本。</span><span class="sxs-lookup"><span data-stu-id="8668f-115">A message is entered in the report server trace log file indicating that the database schema version was upgraded.</span></span>  
  
-   <span data-ttu-id="8668f-116">当选择旧版本与新报表服务器实例一起使用时， [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] 配置管理器将升级本地或远程报表服务器数据库。</span><span class="sxs-lookup"><span data-stu-id="8668f-116">The [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] Configuration Manager upgrades a local or remote report server database when you select an older version to use with a newer report server instance.</span></span> <span data-ttu-id="8668f-117">在这种情况下，必须在发生此操作之前确认升级操作。</span><span class="sxs-lookup"><span data-stu-id="8668f-117">In this case, you must confirm the upgrade action before it happens.</span></span>  
  
     <span data-ttu-id="8668f-118">[!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] 配置管理器不再提供单独的“升级”按钮或升级脚本。</span><span class="sxs-lookup"><span data-stu-id="8668f-118">The [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] Configuration Manager no longer provides a separate Upgrade button or upgrade script.</span></span> <span data-ttu-id="8668f-119">鉴于报表服务器服务的自动升级功能，这些功能从 [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] 开始已过时。</span><span class="sxs-lookup"><span data-stu-id="8668f-119">Those features are obsolete starting with [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] due to the automatic upgrade feature of the Report Server service.</span></span>  
  
 <span data-ttu-id="8668f-120">架构更新后，无法再将升级回滚到以前的版本。</span><span class="sxs-lookup"><span data-stu-id="8668f-120">After the schema is updated, you cannot rollback the upgrade to an earlier version.</span></span> <span data-ttu-id="8668f-121">请务必备份报表服务器数据库，以备需要重新创建先前安装。</span><span class="sxs-lookup"><span data-stu-id="8668f-121">Always backup the report server database in case you need to recreate a previous installation.</span></span>  
  
## <a name="how-the-schema-metadata-and-report-server-content-is-updated"></a><span data-ttu-id="8668f-122">如何更新架构、元数据和报表服务器内容</span><span class="sxs-lookup"><span data-stu-id="8668f-122">How the Schema, Metadata, and Report Server Content is Updated</span></span>  
 <span data-ttu-id="8668f-123">升级报表服务器数据库需分三个步骤：</span><span class="sxs-lookup"><span data-stu-id="8668f-123">The report server database is upgraded in three stages:</span></span>  
  
1.  <span data-ttu-id="8668f-124">在安装并启动服务后，或者您在较旧版本的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 配置管理器中选择 [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] 本机模式报表服务器数据库后，架构将自动升级。</span><span class="sxs-lookup"><span data-stu-id="8668f-124">The schema is upgraded automatically after setup and service startup, or when you select a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native mode report server database in the [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] Configuration Manager that is an older version.</span></span> <span data-ttu-id="8668f-125">此外，报表服务器服务会在启动时检查数据库版本。</span><span class="sxs-lookup"><span data-stu-id="8668f-125">In addition, the Report Server service checks the database version at startup.</span></span> <span data-ttu-id="8668f-126">如果报表服务器连接到早期版本的数据库，则报表服务器将在启动过程中更新该数据库。</span><span class="sxs-lookup"><span data-stu-id="8668f-126">If the report server is connected to a database that is an earlier version, the report server will update the database during startup.</span></span>  
  
2.  <span data-ttu-id="8668f-127">在更新架构后首次使用报表服务器数据库时升级安全描述符。</span><span class="sxs-lookup"><span data-stu-id="8668f-127">Security descriptors are upgraded on first use of the report server database after the schema is updated.</span></span>  
  
3.  <span data-ttu-id="8668f-128">首次使用时，升级已发布报表和已编译报表快照。</span><span class="sxs-lookup"><span data-stu-id="8668f-128">Published reports and compiled report snapshots are updated on first use.</span></span> <span data-ttu-id="8668f-129">有关更多信息，请参见 [Upgrade Reports](upgrade-reports.md)。</span><span class="sxs-lookup"><span data-stu-id="8668f-129">For more information, see [Upgrade Reports](upgrade-reports.md).</span></span>  
  
 <span data-ttu-id="8668f-130">除了报表服务器数据库外，报表服务器还会使用临时数据库。</span><span class="sxs-lookup"><span data-stu-id="8668f-130">In addition to the report server database, a report server also uses a temporary database.</span></span> <span data-ttu-id="8668f-131">升级报表服务器数据库时，会自动升级临时数据库。</span><span class="sxs-lookup"><span data-stu-id="8668f-131">The temporary database is upgraded automatically when you upgrade the report server database.</span></span>  
  
## <a name="permissions-required-to-upgrade-a-report-server-database"></a><span data-ttu-id="8668f-132">升级报表服务器数据库所需的权限</span><span class="sxs-lookup"><span data-stu-id="8668f-132">Permissions required to upgrade a Report Server Database</span></span>  
 <span data-ttu-id="8668f-133">如果要升级的 [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] 安装包含报表服务器数据库，而没有足够的权限执行数据库升级，您可能会看到一条错误消息。</span><span class="sxs-lookup"><span data-stu-id="8668f-133">If you are upgrading a [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] installation that includes a report server database, you may see an error message if the database upgrade is performed with insufficient permissions.</span></span> <span data-ttu-id="8668f-134">默认情况下，安装程序会使用运行安装程序的用户的安全令牌连接到远程 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例并更新架构。</span><span class="sxs-lookup"><span data-stu-id="8668f-134">By default, Setup uses the security token of the user who is running the Setup program to connect to the remote [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance and update the schema.</span></span> <span data-ttu-id="8668f-135">如果你拥有对承载报表服务器数据库的数据库服务器的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] **sysadmin** 权限，将会成功升级数据库。</span><span class="sxs-lookup"><span data-stu-id="8668f-135">If you have [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] **sysadmin** permissions on the database server that hosts the report server databases, the database upgrade will succeed.</span></span> <span data-ttu-id="8668f-136">同样，如果从命令提示符运行安装程序，并为拥有 **sysadmin** 权限来修改远程计算机上的架构的帐户指定 RSUPGRADEDATABASEACCOUNT 和 RSUPGRADEPASSWORD 参数，也将成功升级数据库。</span><span class="sxs-lookup"><span data-stu-id="8668f-136">Similarly, if you run Setup from the command prompt and specify the RSUPGRADEDATABASEACCOUNT and RSUPGRADEPASSWORD arguments for an account that has **sysadmin** permission to modify the schema on the remote computer, the database upgrade will succeed.</span></span>  
  
 <span data-ttu-id="8668f-137">但是，如果您没有对远程计算机上的数据库的 **sysadmin** 权限，则系统将拒绝连接，并出现以下错误：</span><span class="sxs-lookup"><span data-stu-id="8668f-137">However, if you do not have **sysadmin** permission to the database on the remote computer, the connection will be refused with the following error:</span></span>  
  
 `"Setup was not able to upgrade the report server database schema. You must update the database schema manually after setup is finished. To update the schema, run the Reporting Services Configuration Manager, open the Database Setup page, re-select the database, and click Apply. The database will be upgraded automatically."`  
  
 <span data-ttu-id="8668f-138">此时，报表服务器程序文件将被升级，但报表服务器数据库将为早期版本的格式。</span><span class="sxs-lookup"><span data-stu-id="8668f-138">At this point, the report server program files will be upgraded, but the report server database will be in the format of the previous version.</span></span> <span data-ttu-id="8668f-139">报表服务器将不可用，直到通过手动升级数据库来完成升级过程为止。</span><span class="sxs-lookup"><span data-stu-id="8668f-139">The report server will be unavailable until you finish the upgrade process by upgrading the database manually.</span></span>  
  
#### <a name="to-upgrade-a-native-mode-database-with-scripts"></a><span data-ttu-id="8668f-140">使用脚本升级本机模式数据库</span><span class="sxs-lookup"><span data-stu-id="8668f-140">To upgrade a Native Mode database With Scripts</span></span>  
 <span data-ttu-id="8668f-141">您可以生成 WMI 脚本来升级报表服务器数据库。</span><span class="sxs-lookup"><span data-stu-id="8668f-141">You can use WMI scripts to upgrade a report server database.</span></span> <span data-ttu-id="8668f-142">有关详细信息，请参阅 [GenerateDatabaseUpgradeScript 方法 (WMI MSReportServer_ConfigurationSetting)](../wmi-provider-library-reference/configurationsetting-method-generatedatabaseupgradescript.md)</span><span class="sxs-lookup"><span data-stu-id="8668f-142">For more information, see [GenerateDatabaseUpgradeScript Method &#40;WMI MSReportServer_ConfigurationSetting&#41;](../wmi-provider-library-reference/configurationsetting-method-generatedatabaseupgradescript.md)</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="8668f-143">另请参阅</span><span class="sxs-lookup"><span data-stu-id="8668f-143">See Also</span></span>  
 <span data-ttu-id="8668f-144">[Reporting Services Configuration Manager（本机模式）](../../sql-server/install/reporting-services-configuration-manager-native-mode.md) </span><span class="sxs-lookup"><span data-stu-id="8668f-144">[Reporting Services Configuration Manager &#40;Native Mode&#41;](../../sql-server/install/reporting-services-configuration-manager-native-mode.md) </span></span>  
 <span data-ttu-id="8668f-145">[&#40;SSRS Configuration Manager 创建报表服务器数据库&#41;](../../sql-server/install/create-a-report-server-database-ssrs-configuration-manager.md) </span><span class="sxs-lookup"><span data-stu-id="8668f-145">[Create a Report Server Database  &#40;SSRS Configuration Manager&#41;](../../sql-server/install/create-a-report-server-database-ssrs-configuration-manager.md) </span></span>  
 <span data-ttu-id="8668f-146">[更改数据库向导 &#40;SSRS 本机模式&#41;](../../sql-server/install/change-database-wizard-ssrs-native-mode.md) </span><span class="sxs-lookup"><span data-stu-id="8668f-146">[Change Database Wizard &#40;SSRS Native Mode&#41;](../../sql-server/install/change-database-wizard-ssrs-native-mode.md) </span></span>  
 <span data-ttu-id="8668f-147">[升级和迁移 Reporting Services](upgrade-and-migrate-reporting-services.md) </span><span class="sxs-lookup"><span data-stu-id="8668f-147">[Upgrade and Migrate Reporting Services](upgrade-and-migrate-reporting-services.md) </span></span>  
 [<span data-ttu-id="8668f-148">迁移 Reporting Services 安装（本机模式）</span><span class="sxs-lookup"><span data-stu-id="8668f-148">Migrate a Reporting Services Installation &#40;Native Mode&#41;</span></span>](migrate-a-reporting-services-installation-native-mode.md)  
  
  
