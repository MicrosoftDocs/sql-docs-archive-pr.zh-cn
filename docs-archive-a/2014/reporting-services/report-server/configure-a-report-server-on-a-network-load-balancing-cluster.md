---
title: 在网络负载均衡群集上配置报表服务器 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: reporting-services-native
ms.topic: conceptual
helpviewer_keywords:
- report servers [Reporting Services], network load balancing
ms.assetid: 6bfa5698-de65-43c3-b940-044f41c162d3
author: maggiesMSFT
ms.author: maggies
manager: kfile
ms.openlocfilehash: 5de36ab620db63294d2a5ec98fad6c45af201d26
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87588303"
---
# <a name="configure-a-report-server-on-a-network-load-balancing-cluster"></a><span data-ttu-id="2f4bc-102">在网络负载平衡群集上配置报表服务器</span><span class="sxs-lookup"><span data-stu-id="2f4bc-102">Configure a Report Server on a Network Load Balancing Cluster</span></span>
  <span data-ttu-id="2f4bc-103">如果要将报表服务器扩展配置为在网络负载平衡 (NLB) 群集上运行，必须执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="2f4bc-103">If you are configuring a report server scale-out to run on a Network Load Balancing (NLB) cluster, you must do the following:</span></span>  
  
-   <span data-ttu-id="2f4bc-104">确保可通过映射到虚拟服务器 IP 地址的虚拟服务器名称来访问 NLB 群集。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-104">Ensure that the NLB cluster is accessible through a virtual server name that maps to the virtual server IP address.</span></span> <span data-ttu-id="2f4bc-105">必须提供虚拟服务器名称，才能配置 NLB 群集的单入口点。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-105">A virtual server name is necessary so that you can configure a single point of entry to the NLB cluster.</span></span> <span data-ttu-id="2f4bc-106">在为每个报表服务器实例配置 URL 时，会将虚拟服务器名称指定为主机。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-106">When you configure a URL for each report server instance, you will specify the virtual server name as the host.</span></span>  
  
-   <span data-ttu-id="2f4bc-107">配置视图状态验证以支持查看交互式报表。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-107">Configure view state validation to support interactive report viewing.</span></span> <span data-ttu-id="2f4bc-108">交互式报表通常会在单个用户会话期间多次呈现，以便为了响应用户操作而对新数据或不同数据进行可视化。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-108">Interactive reports are typically rendered numerous times during a single user session to visualize new or different data in response to user actions.</span></span> <span data-ttu-id="2f4bc-109">通过配置视图状态验证，可以在用户会话期间保持连续性，而与实际请求由哪个报表服务器提供服务无关。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-109">By configuring view state validation, continuity is preserved within the user session regardless of which report server services the actual request.</span></span>  
  
 [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] <span data-ttu-id="2f4bc-110">不支持对扩展部署进行负载平衡，也不支持定义通过共享 URL 进行单点访问。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-110">does not provide functionality for load balancing a scale-out deployment or for defining a single point of access through a shared URL.</span></span> <span data-ttu-id="2f4bc-111">必须实现单独的软件或硬件 NLB 群集解决方案以支持 [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] 扩展部署。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-111">You must implement a separate software or hardware NLB cluster solution to support a [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] scale-out deployment.</span></span>  
  
 <span data-ttu-id="2f4bc-112">可以将 [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] 安装在已经是 NLB 群集一部分的节点上，也可以先配置扩展部署，然后再安装群集软件。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-112">You can install [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] on nodes that are already part of an NLB cluster, or you can configure a scale-out deployment first and then install cluster software.</span></span>  
  
## <a name="steps-for-report-server-deployment-on-an-nlb-cluster"></a><span data-ttu-id="2f4bc-113">报表服务器在 NLB 群集上的部署步骤</span><span class="sxs-lookup"><span data-stu-id="2f4bc-113">Steps for Report Server Deployment on an NLB Cluster</span></span>  
 <span data-ttu-id="2f4bc-114">可以使用下面的指南来安装和配置部署：</span><span class="sxs-lookup"><span data-stu-id="2f4bc-114">Use the following guidelines to install and configure your deployment:</span></span>  
  
|<span data-ttu-id="2f4bc-115">步骤</span><span class="sxs-lookup"><span data-stu-id="2f4bc-115">Step</span></span>|<span data-ttu-id="2f4bc-116">说明</span><span class="sxs-lookup"><span data-stu-id="2f4bc-116">Description</span></span>|<span data-ttu-id="2f4bc-117">详细信息</span><span class="sxs-lookup"><span data-stu-id="2f4bc-117">More information</span></span>|  
|----------|-----------------|----------------------|  
|<span data-ttu-id="2f4bc-118">1</span><span class="sxs-lookup"><span data-stu-id="2f4bc-118">1</span></span>|<span data-ttu-id="2f4bc-119">在将 Reporting Services 安装在 NLB 群集内的服务器节点上之前，请检查扩展部署的要求。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-119">Before you install Reporting Services on server nodes in an NLB cluster, check the requirements for scale-out deployment.</span></span>|<span data-ttu-id="2f4bc-120">[&#40;SSRS Configuration Manager 配置本机模式报表服务器扩展部署&#41;](../install-windows/configure-a-native-mode-report-server-scale-out-deployment.md) [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]联机丛书</span><span class="sxs-lookup"><span data-stu-id="2f4bc-120">[Configure a Native Mode Report Server Scale-Out Deployment &#40;SSRS Configuration Manager&#41;](../install-windows/configure-a-native-mode-report-server-scale-out-deployment.md) [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Books Online</span></span>|  
|<span data-ttu-id="2f4bc-121">2</span><span class="sxs-lookup"><span data-stu-id="2f4bc-121">2</span></span>|<span data-ttu-id="2f4bc-122">配置 NLB 群集并验证它是否正常工作。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-122">Configure the NLB cluster and verify it is working correctly.</span></span><br /><br /> <span data-ttu-id="2f4bc-123">确保将主机标头名称映射到 NLB 群集的虚拟服务器 IP。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-123">Be sure to map a host header name to the virtual server IP of the NLB cluster.</span></span> <span data-ttu-id="2f4bc-124">主机标头名称用在报表服务器 URL 中，它比 IP 地址便于记忆和键入。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-124">The host header name is used in the report server URL, and is easier to remember and type than an IP address.</span></span>|<span data-ttu-id="2f4bc-125">有关详细信息，请参阅您运行的 Windows 操作系统版本的 Windows Server 产品文档。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-125">For more information, see the Windows Server product documentation for the version of the Windows operating system that you run.</span></span>|  
|<span data-ttu-id="2f4bc-126">3</span><span class="sxs-lookup"><span data-stu-id="2f4bc-126">3</span></span>|<span data-ttu-id="2f4bc-127">将主机标头的 NetBIOS 和完全限定域名 (FQDN) 添加到 Windows 注册表中存储的 **BackConnectionHostNames** 列表中。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-127">Add the NetBIOS and Fully Qualified Domain Name (FQDN) for the host header to the list of **BackConnectionHostNames** stored in the Windows Registry.</span></span> <span data-ttu-id="2f4bc-128">使用 [KB 896861](https://support.microsoft.com/kb/896861) (https://support.microsoft.com/kb/896861) 的“方法 2：指定主机名”\*\*\*\* 中的步骤，但进行以下调整。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-128">Use the steps in **Method 2: Specify host names** in [KB 896861](https://support.microsoft.com/kb/896861) (https://support.microsoft.com/kb/896861), with the following adjustment.</span></span> <span data-ttu-id="2f4bc-129">该 KB 文章的**步骤 7** 指出“退出注册表编辑器，然后重新启动 IISAdmin 服务”。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-129">**Step 7** of the KB article says "Quit Registry Editor, and then restart the IISAdmin service."</span></span> <span data-ttu-id="2f4bc-130">改为重新启动计算机以确保更改生效。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-130">Instead, reboot the computer to ensure the changes take effect.</span></span><br /><br /> <span data-ttu-id="2f4bc-131">例如，如果主机标头名称 \<MyServer> 是 Windows 计算机名称 "contoso" 的虚拟名称，则可能会将 FQDN 形式引用为 "contoso.domain.com"。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-131">For example, if the host header name \<MyServer> is a virtual name for the Windows computer name of "contoso", you can probably reference the FQDN form as "contoso.domain.com".</span></span> <span data-ttu-id="2f4bc-132">需要将主机标头名称 (MyServer) 与 FQDN 名称 (contoso.domain.com) 一起添加到 **BackConnectionHostNames**的列表中。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-132">You will need to add both the hostheader name (MyServer ) and FQDN name (contoso.domain.com) to the list in **BackConnectionHostNames**.</span></span>|<span data-ttu-id="2f4bc-133">如果您的服务器环境涉及本地计算机上的 NTLM 身份验证并且造成环回连接，则此步骤是必需的。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-133">This step is required if your server environment involves NTLM authentication on the local computer, creating a loop back connection.</span></span><br /><br /> <span data-ttu-id="2f4bc-134">如果出现这种情况，将会出现报表管理器和报表服务器之间的请求失败，错误号为 401（未经授权）。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-134">If this is the case, you will experience the requests between Report Manager and Report Server to fail with 401 (Unauthorized).</span></span>|  
|<span data-ttu-id="2f4bc-135">4</span><span class="sxs-lookup"><span data-stu-id="2f4bc-135">4</span></span>|<span data-ttu-id="2f4bc-136">在已是 NLB 群集一部分的节点上以“仅文件”模式安装 [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] ，并为扩展部署配置报表服务器实例。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-136">Install [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] in files-only mode on nodes that are already part of a NLB cluster, and configure the report server instances for scale-out deployment.</span></span><br /><br /> <span data-ttu-id="2f4bc-137">所配置的扩展部署将不响应那些定向到虚拟服务器 IP 的请求。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-137">The scale-out that you configure might not respond to requests that are directed to the virtual server IP.</span></span> <span data-ttu-id="2f4bc-138">在配置视图状态验证之后，会在以后的步骤中将扩展部署配置为使用虚拟服务器 IP。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-138">Configuring the scale-out to use the virtual server IP occurs at a later step, after you configure view state validation.</span></span>|[<span data-ttu-id="2f4bc-139">配置本机模式报表服务器扩展部署（SSRS 配置管理器）</span><span class="sxs-lookup"><span data-stu-id="2f4bc-139">Configure a Native Mode Report Server Scale-Out Deployment &#40;SSRS Configuration Manager&#41;</span></span>](../install-windows/configure-a-native-mode-report-server-scale-out-deployment.md)|  
|<span data-ttu-id="2f4bc-140">5</span><span class="sxs-lookup"><span data-stu-id="2f4bc-140">5</span></span>|<span data-ttu-id="2f4bc-141">配置视图状态验证。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-141">Configure view state validation.</span></span><br /><br /> <span data-ttu-id="2f4bc-142">为了达到最佳效果，请在配置扩展部署之后、配置报表服务器实例以使用虚拟服务器 IP 之前执行此步骤。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-142">For best results, perform this step after you configure the scale-out deployment, and before you configure the report server instances to use the virtual server IP.</span></span> <span data-ttu-id="2f4bc-143">通过先配置视图状态验证，可以避免在用户试图访问交互式报表时出现有关状态验证失败的异常。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-143">By configuring view state validation first, you can avoid exceptions about failed state validation when users attempt to access interactive reports.</span></span>|<span data-ttu-id="2f4bc-144">本主题中的[如何配置视图状态验证](#ViewState) 。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-144">[How to Configure View State Validation](#ViewState) in this topic.</span></span>|  
|<span data-ttu-id="2f4bc-145">6</span><span class="sxs-lookup"><span data-stu-id="2f4bc-145">6</span></span>|<span data-ttu-id="2f4bc-146">将 `Hostname` 和 `UrlRoot` 配置为使用 NLB 群集的虚拟服务器 IP。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-146">Configure `Hostname` and `UrlRoot` to use the virtual server IP of the NLB cluster.</span></span>|<span data-ttu-id="2f4bc-147">本主题中的[如何配置 Hostname 和 UrlRoot](#SpecifyingVirtualServerName) 。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-147">[How to Configure Hostname and UrlRoot](#SpecifyingVirtualServerName) in this topic.</span></span>|  
|<span data-ttu-id="2f4bc-148">7</span><span class="sxs-lookup"><span data-stu-id="2f4bc-148">7</span></span>|<span data-ttu-id="2f4bc-149">验证能否通过指定的主机名来访问服务器。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-149">Verify the servers are accessible through the host name you specified.</span></span>|<span data-ttu-id="2f4bc-150">本主题中的[验证报表服务器访问权限](#Verify) 。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-150">[Verify Report Server Access](#Verify) in this topic.</span></span>|  
  
##  <a name="how-to-configure-view-state-validation"></a><a name="ViewState"></a><span data-ttu-id="2f4bc-151">如何配置视图状态验证</span><span class="sxs-lookup"><span data-stu-id="2f4bc-151">How to Configure View State Validation</span></span>  
 <span data-ttu-id="2f4bc-152">若要在 NLB 群集上运行扩展部署，必须配置视图状态验证，以便用户可以查看交互式 HTML 报表。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-152">To run a scale-out deployment on an NLB cluster, you must configure view state validation so that users can view interactive HTML reports.</span></span> <span data-ttu-id="2f4bc-153">您必须针对报表服务器和报表管理器执行此操作。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-153">You must do this for the report server and for Report Manager.</span></span>  
  
 <span data-ttu-id="2f4bc-154">视图状态验证由 ASP.NET 控制。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-154">View state validation is controlled by the ASP.NET.</span></span> <span data-ttu-id="2f4bc-155">默认情况下，将启用视图状态验证并使用 Web 服务的标识来执行验证。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-155">By default, view state validation is enabled and uses the identity of the Web service to perform the validation.</span></span> <span data-ttu-id="2f4bc-156">但是，在 NLB 群集方案中，存在运行于不同计算机上的多个服务实例和 Web 服务标识。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-156">However, in an NLB cluster scenario, there are multiple service instances and web service identities that run on different computers.</span></span> <span data-ttu-id="2f4bc-157">因为每个节点的服务标识都各不相同，所以您无法依赖单个进程标识来执行验证。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-157">Because the service identity varies for each node, you cannot rely on a single process identity to perform the validation.</span></span>  
  
 <span data-ttu-id="2f4bc-158">若要解决此问题，可以生成一个任意验证密钥来支持视图状态验证功能，然后将每个报表服务器节点手动配置为使用同一密钥。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-158">To work around this issue, you can generate an arbitrary validation key to support view state validation, and then manually configure each report server node to use the same key.</span></span> <span data-ttu-id="2f4bc-159">可以使用随机生成的十六进制序列。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-159">You can use any randomly generated hexadecimal sequence.</span></span> <span data-ttu-id="2f4bc-160">十六进制序列的长度由验证算法（如 SHA1）确定。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-160">The validation algorithm (such as SHA1) determines how long the hexadecimal sequence must be.</span></span>  
  
1.  <span data-ttu-id="2f4bc-161">通过使用由 [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)]提供的 autogenerate 功能，生成一个验证密钥和解密密钥。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-161">Generate a validation key and decryption key by using the autogenerate functionality provided by the [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)].</span></span> <span data-ttu-id="2f4bc-162">最后，必须具有单个 <`machineKey`> 条目，你可以将该条目粘贴到扩展部署中每个报表管理器实例的 Web.config 文件中。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-162">In the end, you must have a single <`machineKey`> entry that you can paste into the Web.config file for each Report Manager instance in the scale-out deployment.</span></span>  
  
     <span data-ttu-id="2f4bc-163">下面的示例说明了您必须获得的值。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-163">The following example provides an illustration of the value you must obtain.</span></span> <span data-ttu-id="2f4bc-164">请不要将该示例复制到配置文件中，其中的密钥值是无效的。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-164">Do not copy the example into your configuration files; the key values are not valid.</span></span>  
  
    ```  
    <machineKey validationKey="123455555" decryptionKey="678999999" validation="SHA1" decryption="AES"/>  
    ```  
  
2.  <span data-ttu-id="2f4bc-165">打开报表管理器的 Web.config 文件，并在 "<" `system.web`> 部分粘贴生成的 <`machineKey`> 元素。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-165">Open the Web.config file for Report Manager, and in the <`system.web`> section paste the <`machineKey`> element that you generated.</span></span> <span data-ttu-id="2f4bc-166">默认情况下，报表管理器的 Web.config 文件位于 \Program Files\Microsoft SQL Server\MSRS10_50.MSSQLSERVER\Reporting Services\ReportManager\Web.config 中。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-166">By default, the Report Manager Web.config file is located in \Program Files\Microsoft SQL Server\MSRS10_50.MSSQLSERVER\Reporting Services\ReportManager\Web.config.</span></span>  
  
3.  <span data-ttu-id="2f4bc-167">保存文件。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-167">Save the file.</span></span>  
  
4.  <span data-ttu-id="2f4bc-168">对扩展部署中的每个报表服务器重复上述步骤。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-168">Repeat the previous step for each report server in the scale-out deployment.</span></span>  
  
5.  <span data-ttu-id="2f4bc-169">验证 \Reporting Services\Report Manager 文件夹中的所有 Web.Config 文件在 `machineKey` "<>" 部分中是否包含相同的 <> 元素 `system.web` 。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-169">Verify that all Web.Config files in the \Reporting Services\Report Manager folders contain identical <`machineKey`> elements in the <`system.web`> section.</span></span>  
  
##  <a name="how-to-configure-hostname-and-urlroot"></a><a name="SpecifyingVirtualServerName"></a> <span data-ttu-id="2f4bc-170">如何配置 Hostname 和 UrlRoot</span><span class="sxs-lookup"><span data-stu-id="2f4bc-170">How to Configure Hostname and UrlRoot</span></span>  
 <span data-ttu-id="2f4bc-171">若要在 NLB 群集上配置报表服务器扩展部署，必须定义单个虚拟服务器名称，以提供服务器群集的单访问点。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-171">To configure a report server scale-out deployment on an NLB cluster, you must define a single virtual server name that provides a single point of access to the server cluster.</span></span> <span data-ttu-id="2f4bc-172">然后向您的环境中的域名服务器 (DNS) 注册此虚拟服务器名称。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-172">Then register this virtual server name with the Domain Name Server (DNS) in your environment.</span></span>  
  
 <span data-ttu-id="2f4bc-173">在定义虚拟服务器名称之后，可以在 RSReportServer.config 文件中配置 `Hostname` 和 `UrlRoot` 属性，以在报表服务器 URL 中包括虚拟服务器名称。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-173">After you define the virtual server name, you can configure the `Hostname` and `UrlRoot` properties in the RSReportServer.config file to include the virtual server name in the report server URL.</span></span>  
  
 <span data-ttu-id="2f4bc-174">在报表环境中使用通配符 URL 预留时，配置 `Hostname` 属性。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-174">Configure the `Hostname` property when you are using wildcard URL reservations in your reporting environment.</span></span> <span data-ttu-id="2f4bc-175">将 `Hostname` 属性指定为 NLB 服务器的虚拟服务器名称时，报表环境的网络流量将定向到 NLB 服务器。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-175">When you specify the `Hostname` property to be the virtual server name of the NLB server, network traffic for the reporting environment is directed to the NLB server.</span></span> <span data-ttu-id="2f4bc-176">然后，NLB 将在报表服务器节点之间分发请求。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-176">The NLB then distributes requests among the report server nodes.</span></span>  
  
 <span data-ttu-id="2f4bc-177">此外，配置 `UrlRoot` 属性，以便报表链接处理的是已导出为静态报表的报表（例如 Excel 或 PDF 格式）或由订阅（例如电子邮件订阅）生成的报表。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-177">Additionally, configure the `UrlRoot` property so that report links work in reports that have been exported to static reports, such as in an Excel or PDF format, or in reports that are generated by subscriptions, such as e-mail subscriptions.</span></span>  
  
 <span data-ttu-id="2f4bc-178">如果将 [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] 与 [!INCLUDE[winSPServ](../../includes/winspserv-md.md)] 3.0 或 [!INCLUDE[offSPServ](../../includes/offspserv-md.md)] 2007 集成，或者在自定义 Web 应用程序中承载报表，则可能需要仅配置 `UrlRoot` 属性。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-178">If you integrate [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] with [!INCLUDE[winSPServ](../../includes/winspserv-md.md)] 3.0 or [!INCLUDE[offSPServ](../../includes/offspserv-md.md)] 2007, or you host your reports in a custom Web application, you might need to configure only the `UrlRoot` property.</span></span> <span data-ttu-id="2f4bc-179">在这种情况下，将 `UrlRoot` 属性配置为 SharePoint 站点或 Web 应用程序的 URL。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-179">In this case, configure the `UrlRoot` property to be the URL of the SharePoint site or Web application.</span></span> <span data-ttu-id="2f4bc-180">这会将报表环境的网络流量定位到处理报表的应用程序，而不是报表服务器或 NLB 群集。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-180">This will direct network traffic for the reporting environment to the application that handles the reports rather than to the report server or NLB cluster.</span></span>  
  
 <span data-ttu-id="2f4bc-181">请不要修改 `ReportServerUrl`。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-181">Do not modify `ReportServerUrl`.</span></span> <span data-ttu-id="2f4bc-182">如果修改了此 URL，那么，在每次处理内部请求时，都将额外引入一个通过虚拟服务器的往返过程。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-182">If you modify this URL, you will introduce an extra roundtrip through the virtual server each time an internal request is handled.</span></span> <span data-ttu-id="2f4bc-183">有关详细信息，请参阅[配置文件中的 URL（SSRS 配置管理器）](../install-windows/urls-in-configuration-files-ssrs-configuration-manager.md)。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-183">For more information, see [URLs in Configuration Files  &#40;SSRS Configuration Manager&#41;](../install-windows/urls-in-configuration-files-ssrs-configuration-manager.md).</span></span> <span data-ttu-id="2f4bc-184">有关编辑配置文件的详细信息，请参阅 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 联机丛书中的[修改 Reporting Services 配置文件 (RSreportserver.config)](modify-a-reporting-services-configuration-file-rsreportserver-config.md)。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-184">For more information about editing the configuration file, see [Modify a Reporting Services Configuration File &#40;RSreportserver.config&#41;](modify-a-reporting-services-configuration-file-rsreportserver-config.md) in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Books Online.</span></span>  
  
1.  <span data-ttu-id="2f4bc-185">在文本编辑器中打开 RSReportServer.config。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-185">Open RSReportServer.config in a text editor.</span></span>  
  
2.  <span data-ttu-id="2f4bc-186">找到 **\<Service>** 部分，并将以下信息添加到配置文件，并将值替换为 `Hostname` NLB 服务器的虚拟服务器名称：</span><span class="sxs-lookup"><span data-stu-id="2f4bc-186">Find the **\<Service>** section, and add the following information to the configuration file, replacing the `Hostname` value with the virtual server name for your NLB server:</span></span>  
  
    ```  
    <Hostname>virtual_server</Hostname>  
    ```  
  
3.  <span data-ttu-id="2f4bc-187">查找 `UrlRoot`。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-187">Find `UrlRoot`.</span></span> <span data-ttu-id="2f4bc-188">配置文件中未指定元素，但使用的默认值是采用以下格式的 URL： http://或 https:// \<*computername*> / \<*reportserver*> ，其中 \<*reportserver*> 是报表服务器 Web 服务的虚拟目录名称。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-188">The element is unspecified in the configuration file, but the default value used is a URL in this format: http:// or https://\<*computername*>/\<*reportserver*>, where \<*reportserver*> is the virtual directory name of the Report Server Web service.</span></span>  
  
4.  <span data-ttu-id="2f4bc-189">为此键入一个 `UrlRoot` 包含群集虚拟名称的值，格式为： http://或 https:// \<*virtual_server*> / \<*reportserver*> 。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-189">Type a value for `UrlRoot` that includes the virtual name of the cluster in this format: http:// or https://\<*virtual_server*>/\<*reportserver*>.</span></span>  
  
5.  <span data-ttu-id="2f4bc-190">保存文件。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-190">Save the file.</span></span>  
  
6.  <span data-ttu-id="2f4bc-191">对于扩展部署中的每个报表服务器，在其相应的 RSReportServer.config 文件中重复上述步骤。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-191">Repeat these steps in each RSReportServer.config file for each report server in the scale-out deployment.</span></span>  
  
##  <a name="verify-report-server-access"></a><a name="Verify"></a><span data-ttu-id="2f4bc-192">验证报表服务器访问权限</span><span class="sxs-lookup"><span data-stu-id="2f4bc-192">Verify Report Server Access</span></span>  
 <span data-ttu-id="2f4bc-193">验证是否可通过虚拟服务器名称访问扩展部署 (例如， https://MyVirtualServerName/reportserver 和 https://MyVirtualServerName/reports) 。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-193">Verify that you can access the scale-out deployment through the virtual server name (for example, https://MyVirtualServerName/reportserver and https://MyVirtualServerName/reports).</span></span>  
  
 <span data-ttu-id="2f4bc-194">通过查看报表服务器日志文件或检查 RS 执行日志（该执行日志表包含的 **InstanceName** 列可以显示处理特定请求的实例名称），可以检查哪个节点实际处理报表。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-194">You can check which node actually processes reports by looking at the report server log files or by checking the RS execution log (the execution log table contains a column called **InstanceName** that shows which instance processed a particular request).</span></span> <span data-ttu-id="2f4bc-195">有关详细信息，请参阅 [联机丛书中的](../report-server/reporting-services-log-files-and-sources.md) Reporting Services 日志文件和源 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-195">For more information, see [Reporting Services Log Files and Sources](../report-server/reporting-services-log-files-and-sources.md) in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Books Online.</span></span>  
  
 <span data-ttu-id="2f4bc-196">如果不能连接到报表服务器上，请检查 NLB 以确保请求发送到报表服务器，并查看报表服务器 HTTP 日志，以确保服务器接收请求。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-196">If you cannot connect to the report server, check the NLB to ensure that requests are sent to the report server and view the report server HTTP log to ensure that the server is receiving the requests.</span></span>  
  
#### <a name="troubleshooting-failed-requests"></a><span data-ttu-id="2f4bc-197">对失败的请求进行疑难解答</span><span class="sxs-lookup"><span data-stu-id="2f4bc-197">Troubleshooting Failed Requests</span></span>  
 <span data-ttu-id="2f4bc-198">如果请求未到达报表服务器实例，请检查 RSReportServer.config 文件，验证虚拟服务器名称是否指定为报表服务器 URL 的主机名：</span><span class="sxs-lookup"><span data-stu-id="2f4bc-198">If requests do not reach the report server instances, check the RSReportServer.config file to verify that the virtual server name is specified as the host name for the report server URLs:</span></span>  
  
1.  <span data-ttu-id="2f4bc-199">在文本编辑器中打开 RSReportServer.config 文件。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-199">Open the RSReportServer.config file in a text editor.</span></span>  
  
2.  <span data-ttu-id="2f4bc-200">查找 <`Hostname`>、<`ReportServerUrl`> 和 <> `UrlRoot` ，并检查每个设置的主机名。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-200">Find <`Hostname`>, <`ReportServerUrl`>, and <`UrlRoot`>, and check the host name for each settings.</span></span> <span data-ttu-id="2f4bc-201">如果该值不是预期的主机名，请将其替换为正确的主机名。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-201">If the value is not the host name you expect, replace it with the correct host name.</span></span>  
  
 <span data-ttu-id="2f4bc-202">如果在进行这些更改之后启动 Reporting Services 配置工具，则该工具可能会将 <`ReportServerUrl`> 设置更改为默认值。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-202">If you start the Reporting Services Configuration tool after making these changes, the tool might change the <`ReportServerUrl`> settings to the default value.</span></span> <span data-ttu-id="2f4bc-203">请始终保留一份配置文件的备份副本，以备需要用包含要使用的设置的版本替换该配置文件时使用。</span><span class="sxs-lookup"><span data-stu-id="2f4bc-203">Always keep a backup copy of the configuration files in case you need to replace them with the version that contains the settings you want to use.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="2f4bc-204">另请参阅</span><span class="sxs-lookup"><span data-stu-id="2f4bc-204">See Also</span></span>  
 <span data-ttu-id="2f4bc-205">[Reporting Services Configuration Manager（本机模式）](../../sql-server/install/reporting-services-configuration-manager-native-mode.md) </span><span class="sxs-lookup"><span data-stu-id="2f4bc-205">[Reporting Services Configuration Manager &#40;Native Mode&#41;](../../sql-server/install/reporting-services-configuration-manager-native-mode.md) </span></span>  
 <span data-ttu-id="2f4bc-206">[&#40;SSRS Configuration Manager 配置 URL&#41;](../install-windows/configure-a-url-ssrs-configuration-manager.md) </span><span class="sxs-lookup"><span data-stu-id="2f4bc-206">[Configure a URL  &#40;SSRS Configuration Manager&#41;](../install-windows/configure-a-url-ssrs-configuration-manager.md) </span></span>  
 <span data-ttu-id="2f4bc-207">[&#40;SSRS Configuration Manager 配置本机模式报表服务器扩展部署&#41;](../install-windows/configure-a-native-mode-report-server-scale-out-deployment.md) </span><span class="sxs-lookup"><span data-stu-id="2f4bc-207">[Configure a Native Mode Report Server Scale-Out Deployment &#40;SSRS Configuration Manager&#41;](../install-windows/configure-a-native-mode-report-server-scale-out-deployment.md) </span></span>  
 [<span data-ttu-id="2f4bc-208">管理 Reporting Services 本机模式报表服务器</span><span class="sxs-lookup"><span data-stu-id="2f4bc-208">Manage a Reporting Services Native Mode Report Server</span></span>](manage-a-reporting-services-native-mode-report-server.md)  
  
  
