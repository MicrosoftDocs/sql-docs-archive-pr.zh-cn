---
title: 保护报表和资源 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: reporting-services-native
ms.topic: conceptual
helpviewer_keywords:
- security [Reporting Services], reports
- security [Reporting Services], resources
- reports [Reporting Services], security
- confidential reports [Reporting Services]
- resources [Reporting Services], security
ms.assetid: 63cd55c7-fd2a-49e3-a3f8-59eb1a1c6e83
author: maggiesMSFT
ms.author: maggies
manager: kfile
ms.openlocfilehash: 6c8eef86da2fe9c7dcc92488a08516a73aa37e92
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87587172"
---
# <a name="secure-reports-and-resources"></a><span data-ttu-id="037af-102">保护报表和资源</span><span class="sxs-lookup"><span data-stu-id="037af-102">Secure Reports and Resources</span></span>
  <span data-ttu-id="037af-103">您可以设置各个报表和资源的安全性，以控制用户对这些项的访问权限。</span><span class="sxs-lookup"><span data-stu-id="037af-103">You can set security for individual reports and resources to control the degree of access that users have to these items.</span></span> <span data-ttu-id="037af-104">默认情况下，只有是“管理员”内置组的成员的用户，才能运行报表、查看资源、修改属性以及删除项  。</span><span class="sxs-lookup"><span data-stu-id="037af-104">By default, only users who are members of the **Administrators** built-in group can run reports, view resources, modify properties, and delete the items.</span></span> <span data-ttu-id="037af-105">所有其他用户必须具有为其创建的角色分配才能访问报表或资源。</span><span class="sxs-lookup"><span data-stu-id="037af-105">All other users must have role assignments created for them that allow access to a report or resource.</span></span>  
  
## <a name="role-based-access-to-reports-and-resources"></a><span data-ttu-id="037af-106">对报表和资源的基于角色的访问</span><span class="sxs-lookup"><span data-stu-id="037af-106">Role-based Access to Reports and Resources</span></span>  
 <span data-ttu-id="037af-107">若要授予报表和资源的访问权限，则可以允许用户从父文件夹继承现有的角色分配，也可以针对项本身创建新的角色分配。</span><span class="sxs-lookup"><span data-stu-id="037af-107">To grant access to reports and resources, you can allow users to inherit existing role assignments from a parent folder or create a new role assignment on the item itself.</span></span>  
  
 <span data-ttu-id="037af-108">在大多数情况下，您可能需要使用从父文件夹继承的权限。</span><span class="sxs-lookup"><span data-stu-id="037af-108">In most cases, you will probably want to use the permissions that are inherited from a parent folder.</span></span> <span data-ttu-id="037af-109">只有在需要隐藏报表或资源以防止不需要了解该报表或资源存在与否的用户看到它们，或需要提高报表或项的访问级别时，才有必要对各个报表和资源设置安全性。</span><span class="sxs-lookup"><span data-stu-id="037af-109">Setting security on individual reports and resources should only be necessary if you want to hide the report or resource from users who do not need to know that the report or resource exists, or to increase the level of access for a report or item.</span></span> <span data-ttu-id="037af-110">这些目标并不相互冲突。</span><span class="sxs-lookup"><span data-stu-id="037af-110">These objectives are not mutually exclusive.</span></span> <span data-ttu-id="037af-111">您可以限定只有一小部分用户能够访问报表，并向其中的部分用户或全部用户另外授予管理报表的权限。</span><span class="sxs-lookup"><span data-stu-id="037af-111">You can restrict access to a report to a smaller set of users, and provide all or some of them with additional privileges to manage the report.</span></span>  
  
 <span data-ttu-id="037af-112">您可能需要创建多个角色分配来实现目标。</span><span class="sxs-lookup"><span data-stu-id="037af-112">You may need to create multiple role assignments to achieve your objectives.</span></span> <span data-ttu-id="037af-113">例如，假设您希望两个用户 Ann 和 Fernando 以及人力资源经理组可以访问某个报表。</span><span class="sxs-lookup"><span data-stu-id="037af-113">For example, suppose you have a report that you want to make accessible to two users, Ann and Fernando, and to the Human Resource Managers group.</span></span> <span data-ttu-id="037af-114">Ann 和 Fernando 需要能够管理该报表，而人力资源经理组的成员则只需运行该报表。</span><span class="sxs-lookup"><span data-stu-id="037af-114">Ann and Fernando must be able to manage the report, but the Human Resource Managers members need only to run it.</span></span> <span data-ttu-id="037af-115">为了满足所有这些用户的需要，您可以分别创建三个角色分配，一个角色分配使 Ann 成为报表的内容管理员，另一个使 Fernando 成为报表的内容管理员，第三个则支持人力资源经理组对报表执行只读访问任务。</span><span class="sxs-lookup"><span data-stu-id="037af-115">To accommodate all of these users, you would create three separate role assignments: one to make Ann a content manager of the report, one to make Fernando a content manager of the report, and one to support view-only tasks for the Human Resource Managers group.</span></span>  
  
 <span data-ttu-id="037af-116">在您设置了报表或资源的安全性后，即使这些项移至新位置，也会一直保留这些设置。</span><span class="sxs-lookup"><span data-stu-id="037af-116">Once you set security on a report or resource, those settings stay with the item even if you move the item to a new location.</span></span> <span data-ttu-id="037af-117">例如，如果您移动了只有少数几个人可以访问的报表，那么，即使移动后的新位置是一个安全策略相对开放的文件夹，也只有原来的那几个人才能访问该报表。</span><span class="sxs-lookup"><span data-stu-id="037af-117">For example, if you move a report that only a few people are authorized to access, the report continues to be available to just those users even if you move it to a folder that has a relatively open security policy.</span></span>  
  
## <a name="mitigating-html-injection-attacks-in-a-published-report-or-document"></a><span data-ttu-id="037af-118">减少已发布报表或文档中的 HTML 注入攻击</span><span class="sxs-lookup"><span data-stu-id="037af-118">Mitigating HTML Injection Attacks in a Published Report or Document</span></span>  
 <span data-ttu-id="037af-119">在 [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)]中，报表和资源是在运行报表的用户的安全标识下处理的。</span><span class="sxs-lookup"><span data-stu-id="037af-119">In [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)], reports and resources are processed under the security identity of the user who is running the report.</span></span> <span data-ttu-id="037af-120">如果报表中包含表达式、脚本、自定义报表项或自定义程序集，则代码将在用户的凭据下运行。</span><span class="sxs-lookup"><span data-stu-id="037af-120">If the report contains expressions, script, custom report items, or custom assemblies, the code runs under the user's credentials.</span></span> <span data-ttu-id="037af-121">如果资源是包含脚本的 HTML 文档，则当用户在报表服务器中打开文档时，该脚本即会运行。</span><span class="sxs-lookup"><span data-stu-id="037af-121">If a resource is an HTML document that contains script, the script will run when the user opens the document on the report server.</span></span> <span data-ttu-id="037af-122">尽管运行报表中的脚本或代码的能力是一项强大的功能，但具有一定程度的风险。</span><span class="sxs-lookup"><span data-stu-id="037af-122">The ability to run script or code within a report is a powerful feature that comes with a certain level of risk.</span></span> <span data-ttu-id="037af-123">如果是恶意代码，则报表服务器和运行报表的用户就很容易受到攻击。</span><span class="sxs-lookup"><span data-stu-id="037af-123">If the code is malicious, the report server and the user who is running the report are vulnerable to attack.</span></span>  
  
 <span data-ttu-id="037af-124">授予对以 HTML 格式处理的报表和资源的访问权限时，要注意报表是在完全信任权限下处理的而且可能会将潜在的恶意脚本发送到客户端，这一点非常重要。</span><span class="sxs-lookup"><span data-stu-id="037af-124">When granting access to reports and to resources that are processed as HTML, it is important to remember that reports are processed in full trust and that potentially malicious script might be sent to the client.</span></span> <span data-ttu-id="037af-125">根据浏览器设置，客户端将在浏览器中指定的信任级别执行 HTML。</span><span class="sxs-lookup"><span data-stu-id="037af-125">Depending on browser settings, the client will execute the HTML at the level of trust that is specified in the browser.</span></span>  
  
 <span data-ttu-id="037af-126">可以通过采取以下预防措施来降低运行恶意脚本的风险：</span><span class="sxs-lookup"><span data-stu-id="037af-126">You can mitigate the risk of running malicious script by taking the following precautions:</span></span>  
  
-   <span data-ttu-id="037af-127">决定谁可以将内容发布到报表服务器时，应慎重选择。</span><span class="sxs-lookup"><span data-stu-id="037af-127">Be selective when deciding who can publish content to a report server.</span></span> <span data-ttu-id="037af-128">由于存在发布恶意内容的可能性，因此应将可发布内容的用户限制到少数受信任的用户。</span><span class="sxs-lookup"><span data-stu-id="037af-128">Because the potential for publishing malicious content exists, you should limit users who can publish content to a small number of trusted users.</span></span>  
  
-   <span data-ttu-id="037af-129">所有的发布者都应避免发布来自未知源或不可信源的报表和资源。</span><span class="sxs-lookup"><span data-stu-id="037af-129">All publishers should avoid publishing reports and resources that come from unknown or untrusted sources.</span></span> <span data-ttu-id="037af-130">如果必要，请在文本编辑器中打开文件并查找可疑脚本和 URL。</span><span class="sxs-lookup"><span data-stu-id="037af-130">If necessary, open the file in a text editor and look for suspicious script and URLs.</span></span>  
  
## <a name="report-parameters-and-script-injection"></a><span data-ttu-id="037af-131">报表参数和脚本注入</span><span class="sxs-lookup"><span data-stu-id="037af-131">Report Parameters and Script Injection</span></span>  
 <span data-ttu-id="037af-132">报表参数为报表的总体设计和执行提供灵活性。</span><span class="sxs-lookup"><span data-stu-id="037af-132">Report Parameters provide flexibility for the overall report design and execution.</span></span> <span data-ttu-id="037af-133">但是，在某些情况下，引诱攻击中的攻击者也可以利用这种灵活性。</span><span class="sxs-lookup"><span data-stu-id="037af-133">However, this same flexibility can, in some cases be used by an attacker in luring attacks.</span></span> <span data-ttu-id="037af-134">若要降低无意中运行恶意脚本的风险，请仅从可信来源打开呈现的报表。</span><span class="sxs-lookup"><span data-stu-id="037af-134">To mitigate the risk of inadvertently running malicious scripts, only open rendered reports from trusted sources.</span></span> <span data-ttu-id="037af-135">建议您考虑以下这种潜在 HTML 呈现器脚本注入攻击的情况：</span><span class="sxs-lookup"><span data-stu-id="037af-135">It is recommended you consider the following scenario that is a potential HTML Renderer script injection attack:</span></span>  
  
1.  <span data-ttu-id="037af-136">报表包含一个文本框，该框有一个超链接操作设置为可能包含恶意文本的参数值。</span><span class="sxs-lookup"><span data-stu-id="037af-136">A report contains a text box with the hyperlink action set to the value of a parameter which could contain malicious text.</span></span>  
  
2.  <span data-ttu-id="037af-137">报表将发布到报表服务器，或可能通过这样一种方式提供：可从 Web 页的 URL 控制报表参数值。</span><span class="sxs-lookup"><span data-stu-id="037af-137">The report is published to a report server or otherwise made available in such a way that the report parameter value can be controlled from the URL of a web page.</span></span>  
  
3.  <span data-ttu-id="037af-138">攻击者创建一个链接，该链接指向网页或 Report Server 以 "javascript：" 格式指定参数的值 \<malicious script here> ，并将该链接发送到引诱攻击中的其他人。</span><span class="sxs-lookup"><span data-stu-id="037af-138">An attacker creates a link to the web page or report server specifying the value of the parameter in the form "javascript:\<malicious script here>" and sends that link to someone else in a luring attack.</span></span>  
  
## <a name="mitigating-script-injection-attacks-in-a-hyperlink-in-a-published-report-or-document"></a><span data-ttu-id="037af-139">减少已发布报表或文档中的超链接脚本注入攻击</span><span class="sxs-lookup"><span data-stu-id="037af-139">Mitigating Script Injection Attacks in a Hyperlink in a Published Report or Document</span></span>  
 <span data-ttu-id="037af-140">报表可以在报表项或报表项一部分的 Action 属性的值中包含嵌入的超链接。</span><span class="sxs-lookup"><span data-stu-id="037af-140">Reports can contain embedded hyperlinks in the value of the Action property on a report item or part of a report item.</span></span> <span data-ttu-id="037af-141">在处理报表时，可将超链接绑定到从外部数据源检索的数据。</span><span class="sxs-lookup"><span data-stu-id="037af-141">Hyperlinks can be bound to data that is retrieved from an external data source when the report is processed.</span></span> <span data-ttu-id="037af-142">如果恶意用户修改基础数据，则超链接可能受到脚本攻击危害。</span><span class="sxs-lookup"><span data-stu-id="037af-142">If a malicious user modifies the underlying data, the hyperlink might be at risk for scripting exploits.</span></span> <span data-ttu-id="037af-143">如果用户单击已发布或导出的报表中的链接，则可能会运行恶意脚本。</span><span class="sxs-lookup"><span data-stu-id="037af-143">If a user clicks the link in the published or exported report, malicious script could run.</span></span>  
  
 <span data-ttu-id="037af-144">若要降低报表中包含无意中运行恶意脚本的链接的风险，请仅将超链接绑定到来自可信来源的数据。</span><span class="sxs-lookup"><span data-stu-id="037af-144">To mitigate the risk of including links in a report that inadvertently run malicious scripts, only bind hyperlinks to data from trusted sources.</span></span> <span data-ttu-id="037af-145">验证查询结果中的数据和将数据绑定到超链接的表达式没有创建可被用来进行攻击的链接。</span><span class="sxs-lookup"><span data-stu-id="037af-145">Verify that data from the query results and the expressions that bind data to hyperlinks do not create links that can be exploited.</span></span> <span data-ttu-id="037af-146">例如，不要将超链接基于连接多个数据集字段中的数据的表达式。</span><span class="sxs-lookup"><span data-stu-id="037af-146">For example, do not base a hyperlink on an expression that concatenates data from multiple dataset fields.</span></span> <span data-ttu-id="037af-147">如有必要，浏览到此报表，然后使用“查看源”以检查可疑脚本和 URL。</span><span class="sxs-lookup"><span data-stu-id="037af-147">If necessary, browse to the report and use "View Source" to check for suspicious scripts and URLs.</span></span>  
  
## <a name="mitigating-sql-injection-attacks-in-a-parameterized-report"></a><span data-ttu-id="037af-148">减少参数化报表中的 SQL 注入攻击</span><span class="sxs-lookup"><span data-stu-id="037af-148">Mitigating SQL Injection Attacks in a Parameterized Report</span></span>  
 <span data-ttu-id="037af-149">在包含类型参数的任何报表中 `String` ，请务必使用可用值列表 (也称为有效值列表) 并确保运行报表的任何用户仅具有查看报表中数据所需的权限。</span><span class="sxs-lookup"><span data-stu-id="037af-149">In any report that includes a parameter of type `String`, be sure to use an available values list (also known as a valid values list) and ensure that any user running the report has only the permissions required to view the data in the report.</span></span> <span data-ttu-id="037af-150">定义 `String` 类型的参数时，系统将向用户显示一个可以使用任何值的文本框。</span><span class="sxs-lookup"><span data-stu-id="037af-150">When you define a parameter of type `String`, the user is presented with a text box that can take any value.</span></span> <span data-ttu-id="037af-151">可用值列表限制可以输入的值。</span><span class="sxs-lookup"><span data-stu-id="037af-151">An available values list limits the values that can be entered.</span></span> <span data-ttu-id="037af-152">如果报表参数与查询参数关联，但您没有使用可用值列表，则报表用户可能会在文本框中键入 SQL 语法，从而导致报表和服务器容易受到 SQL 注入攻击。</span><span class="sxs-lookup"><span data-stu-id="037af-152">If the report parameter is tied to a query parameter and you do not use an available values list, it is possible for a report user to type SQL syntax into the text box, potentially opening the report and your server to a SQL injection attack.</span></span> <span data-ttu-id="037af-153">如果用户有足够的权限执行新的 SQL 语句，则可能在服务器上产生意外结果。</span><span class="sxs-lookup"><span data-stu-id="037af-153">If the user has sufficient permissions to execute the new SQL statement, it may produce unwanted results on the server.</span></span>  
  
 <span data-ttu-id="037af-154">如果报表参数与查询参数无关，并且参数值包含在报表中，则报表用户可以在参数值中键入表达式语法或 URL，并将报表呈现为 Excel 或 HTML 格式。</span><span class="sxs-lookup"><span data-stu-id="037af-154">If a report parameter is not tied to a query parameter and the parameter values are included in the report, it is possible for a report user to type expression syntax or a URL into the parameter value and render the report to Excel or HTML.</span></span> <span data-ttu-id="037af-155">如果其他用户查看报表并单击呈现的参数内容，则用户可能会无意中执行恶意脚本或链接。</span><span class="sxs-lookup"><span data-stu-id="037af-155">If another user then views the report and clicks the rendered parameter contents, the user may inadvertently execute the malicious script or link.</span></span>  
  
 <span data-ttu-id="037af-156">若要降低无意中运行恶意脚本的风险，请仅从可信来源打开呈现的报表。</span><span class="sxs-lookup"><span data-stu-id="037af-156">To mitigate the risk of inadvertently running malicious scripts, open rendered reports only from trusted sources.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="037af-157">在早期版本的文档中，包括以表达式形式创建动态查询的示例。</span><span class="sxs-lookup"><span data-stu-id="037af-157">In previous releases of the documentation, an example of creating a dynamic query as an expression was included.</span></span> <span data-ttu-id="037af-158">此类型的查询会产生 SQL 注入攻击漏洞，因而建议不要使用这类查询。</span><span class="sxs-lookup"><span data-stu-id="037af-158">This type of query creates a vulnerability to SQL injection attacks and therefore is not recommended.</span></span>  
  
## <a name="securing-confidential-reports"></a><span data-ttu-id="037af-159">保护机密报表</span><span class="sxs-lookup"><span data-stu-id="037af-159">Securing Confidential Reports</span></span>  
 <span data-ttu-id="037af-160">对于包含机密信息的报表，应通过要求用户在访问敏感数据时提供凭据，在数据访问级别上保护这些报表。</span><span class="sxs-lookup"><span data-stu-id="037af-160">Reports that contain confidential information should be secured at the data-access level, by requiring users to provide credentials to access sensitive data.</span></span> <span data-ttu-id="037af-161">有关详细信息，请参阅[为报表数据源指定凭据和连接信息](../report-data/specify-credential-and-connection-information-for-report-data-sources.md)</span><span class="sxs-lookup"><span data-stu-id="037af-161">For more information, see [Specify Credential and Connection Information for Report Data Sources](../report-data/specify-credential-and-connection-information-for-report-data-sources.md).</span></span> <span data-ttu-id="037af-162">您也可以对文件夹进行保护，以便只有授权用户才能访问文件夹。</span><span class="sxs-lookup"><span data-stu-id="037af-162">You can also secure a folder to make it inaccessible to unauthorized users.</span></span> <span data-ttu-id="037af-163">有关详细信息，请参阅 [保护文件](secure-folders.md)。</span><span class="sxs-lookup"><span data-stu-id="037af-163">For more information, see [Secure Folders](secure-folders.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="037af-164">另请参阅</span><span class="sxs-lookup"><span data-stu-id="037af-164">See Also</span></span>  
 <span data-ttu-id="037af-165"> (create-and-manage-role-assignments.md) </span><span class="sxs-lookup"><span data-stu-id="037af-165">(create-and-manage-role-assignments.md)</span></span>   
 <span data-ttu-id="037af-166">[配置报表生成器访问](../report-server/configure-report-builder-access.md) </span><span class="sxs-lookup"><span data-stu-id="037af-166">[Configure Report Builder Access](../report-server/configure-report-builder-access.md) </span></span>  
 <span data-ttu-id="037af-167">[授予对本机模式报表服务器的权限](granting-permissions-on-a-native-mode-report-server.md) </span><span class="sxs-lookup"><span data-stu-id="037af-167">[Granting Permissions on a Native Mode Report Server](granting-permissions-on-a-native-mode-report-server.md) </span></span>  
 <span data-ttu-id="037af-168">[保护共享数据源项](secure-shared-data-source-items.md) </span><span class="sxs-lookup"><span data-stu-id="037af-168">[Secure Shared Data Source Items](secure-shared-data-source-items.md) </span></span>  
 [<span data-ttu-id="037af-169">在 Reporting Services 数据源中存储凭据</span><span class="sxs-lookup"><span data-stu-id="037af-169">Store Credentials in a Reporting Services Data Source</span></span>](../report-data/store-credentials-in-a-reporting-services-data-source.md)  
  
  
