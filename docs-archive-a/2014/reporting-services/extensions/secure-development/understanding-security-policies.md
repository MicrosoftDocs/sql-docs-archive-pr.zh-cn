---
title: 了解安全策略 | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: reporting-services
ms.topic: reference
helpviewer_keywords:
- code groups [Reporting Services]
- code access security [Reporting Services], security policies
- Execution permission set
- custom assemblies [Reporting Services], security
- permission sets [Reporting Services]
- expressions [Reporting Services], security
- evidence [Reporting Services]
- FullTrust permission set
- security policies [Reporting Services]
- named permission sets [Reporting Services]
ms.assetid: a9bf043a-139a-4929-9a58-244815323df0
author: maggiesMSFT
ms.author: maggies
manager: kfile
ms.openlocfilehash: e03f2ca7aae75f692ba2c888d1fb6bd3f60fb4a4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87591136"
---
# <a name="understanding-security-policies"></a><span data-ttu-id="0965b-102">了解安全策略</span><span class="sxs-lookup"><span data-stu-id="0965b-102">Understanding Security Policies</span></span>
  <span data-ttu-id="0965b-103">由报表服务器执行的任何代码必须是特定的代码访问安全策略的一部分。</span><span class="sxs-lookup"><span data-stu-id="0965b-103">Any code that is executed by a report server must be part of a specific code access security policy.</span></span> <span data-ttu-id="0965b-104">这些安全策略包含多个将证据映射到一组命名权限集的代码组。</span><span class="sxs-lookup"><span data-stu-id="0965b-104">These security policies consist of code groups that map evidence to a set of named permission sets.</span></span> <span data-ttu-id="0965b-105">通常，代码组与在该组中为代码指定可允许权限的命名权限集关联。</span><span class="sxs-lookup"><span data-stu-id="0965b-105">Often, code groups are associated with a named permission set that specifies the allowable permissions for code in that group.</span></span> <span data-ttu-id="0965b-106">运行时使用受信任主机或加载程序所提供的证据来确定代码所属的代码组，从而确定要授予代码的权限。</span><span class="sxs-lookup"><span data-stu-id="0965b-106">The runtime uses evidence provided by a trusted host or by the loader to determine which code groups the code belongs to and, therefore, which permissions to grant the code.</span></span> [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] <span data-ttu-id="0965b-107">遵循由 [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] 公共语言运行时 (CLR) 定义的安全策略体系结构。</span><span class="sxs-lookup"><span data-stu-id="0965b-107">adheres to this security policy architecture as defined by the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] common language runtime (CLR).</span></span> <span data-ttu-id="0965b-108">下面几节介绍了 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 中的各种代码类型以及与它们相关联的策略规则。</span><span class="sxs-lookup"><span data-stu-id="0965b-108">The following sections describe the various types of code in [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] and the policy rules associated with them.</span></span>  
  
## <a name="report-server-assemblies"></a><span data-ttu-id="0965b-109">报表服务器程序集</span><span class="sxs-lookup"><span data-stu-id="0965b-109">Report Server Assemblies</span></span>  
 <span data-ttu-id="0965b-110">报表服务器程序集是指那些包含作为 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 产品的一部分的代码的程序集。</span><span class="sxs-lookup"><span data-stu-id="0965b-110">Report server assemblies are those that contain code that is part of the [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] product.</span></span> [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] <span data-ttu-id="0965b-111">是用托管代码程序集编写的；所有这些程序集都采用了强命名模式（即数字签名模式）。</span><span class="sxs-lookup"><span data-stu-id="0965b-111">is written using managed code assemblies; all of these assemblies are strong-named (that is, digitally signed).</span></span> <span data-ttu-id="0965b-112">这些程序集的代码组是使用 StrongNameMembershipCondition 定义的，StrongNameMembershipCondition 为程序集的强名称提供基于公钥信息的证据  。</span><span class="sxs-lookup"><span data-stu-id="0965b-112">The code groups for these assemblies are defined using the **StrongNameMembershipCondition**, which provides evidence based on public key information for the assembly's strong name.</span></span> <span data-ttu-id="0965b-113">代码组被授予 FullTrust 权限集  。</span><span class="sxs-lookup"><span data-stu-id="0965b-113">The code group is granted the **FullTrust** permission set.</span></span>  
  
## <a name="report-server-extensions-rendering-data-delivery-and-security"></a><span data-ttu-id="0965b-114">报表服务器扩展插件（呈现扩展插件、数据扩展插件、传递扩展插件和安全扩展插件）</span><span class="sxs-lookup"><span data-stu-id="0965b-114">Report Server Extensions (Rendering, Data, Delivery, and Security)</span></span>  
 <span data-ttu-id="0965b-115">报表服务器扩展插件是您或第三方为了扩展 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 的功能而创建的自定义数据扩展插件、传递扩展插件、呈现扩展插件和安全扩展插件。</span><span class="sxs-lookup"><span data-stu-id="0965b-115">Report server extensions are custom data, delivery, rendering, and security extensions that you or other third-parties create in order to extend the functionality of [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)].</span></span> <span data-ttu-id="0965b-116">在与要扩展的 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 组件相关联的策略配置文件中，必须向这些扩展插件或程序集代码授予 FullTrust。</span><span class="sxs-lookup"><span data-stu-id="0965b-116">You must grant **FullTrust** to these extensions or assembly code in the policy configuration files associated with the [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] component you are extending.</span></span> <span data-ttu-id="0965b-117">随 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 提供的扩展插件是用报表服务器公钥签名的，它们将接收 FullTrust 权限集  。</span><span class="sxs-lookup"><span data-stu-id="0965b-117">Extensions shipped as a part of [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] are signed with the report server public key and receive the **FullTrust** permission set.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="0965b-118">必须修改 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 策略配置文件才能允许任何第三方扩展插件获得 FullTrust  。</span><span class="sxs-lookup"><span data-stu-id="0965b-118">You must modify the [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] policy configuration files to allow **FullTrust** for any third-party extensions.</span></span> <span data-ttu-id="0965b-119">如果没有为自定义扩展插件添加具有 FullTrust 的代码组，则这些扩展插件将无法由报表服务器使用  。</span><span class="sxs-lookup"><span data-stu-id="0965b-119">If you do not add a code group with **FullTrust** for your custom extensions, they cannot be used by the report server.</span></span>  
  
 <span data-ttu-id="0965b-120">有关 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 中安全策略配置文件的详细信息，请参阅[使用 Reporting Services 安全策略文件](using-reporting-services-security-policy-files.md)。</span><span class="sxs-lookup"><span data-stu-id="0965b-120">For more information about the policy configuration files in [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)], see [Using Reporting Services Security Policy Files](using-reporting-services-security-policy-files.md).</span></span>  
  
## <a name="expressions-used-in-reports"></a><span data-ttu-id="0965b-121">报表中使用的表达式</span><span class="sxs-lookup"><span data-stu-id="0965b-121">Expressions Used in Reports</span></span>  
 <span data-ttu-id="0965b-122">报表表达式是包含在 Code 元素中的内联代码表达式或用户定义方法，该元素位于报表定义语言文件中  。</span><span class="sxs-lookup"><span data-stu-id="0965b-122">Report expressions are inline code expressions or user-defined methods contained within the **Code** element of a report definition language file.</span></span> <span data-ttu-id="0965b-123">策略配置文件中已经配置了一个代码组，在默认情况下，该代码组向这些表达式授予 Execution 权限集  。</span><span class="sxs-lookup"><span data-stu-id="0965b-123">There is a code group that is already configured in the policy files that grants these expressions the **Execution** permission set by default.</span></span> <span data-ttu-id="0965b-124">该代码组看起来如下所示：</span><span class="sxs-lookup"><span data-stu-id="0965b-124">The code group looks like the following:</span></span>  
  
```  
<CodeGroup  
   class="UnionCodeGroup"  
   version="1"  
   PermissionSetName="Execution"  
   Name="Report_Expressions_Default_Permissions"  
   Description="This code group grants default permissions for code in report expressions and Code element. ">  
    <IMembershipCondition  
       class="StrongNameMembershipCondition"  
       version="1"  
       PublicKeyBlob="002400..."  
    />  
</CodeGroup>  
```  
  
 <span data-ttu-id="0965b-125">Execution 权限集允许运行（执行）代码，但是不使用受保护的资源  。</span><span class="sxs-lookup"><span data-stu-id="0965b-125">**Execution** permission allows code to run (execute), but not to use protected resources.</span></span> <span data-ttu-id="0965b-126">在报表中找到的所有表达式都编译为一个称作“表达式宿主”的程序集，该程序集作为已编译报表的一部分存储。</span><span class="sxs-lookup"><span data-stu-id="0965b-126">All expressions found within a report are compiled into an assembly (called an "expression host" assembly) that is stored as a part of the compiled report.</span></span> <span data-ttu-id="0965b-127">在执行报表时，报表服务器会加载并调用表达式宿主程序集以执行相应的表达式。</span><span class="sxs-lookup"><span data-stu-id="0965b-127">When the report is executed, the report server loads the expression host assembly and makes calls into that assembly to execute expressions.</span></span> <span data-ttu-id="0965b-128">对表达式宿主程序集进行签名所用的密钥与为所有的表达式宿主定义代码组所用的密钥相同。</span><span class="sxs-lookup"><span data-stu-id="0965b-128">Expression host assemblies are signed with a specific key that is used to define the code group for all expression hosts.</span></span>  
  
 <span data-ttu-id="0965b-129">报表表达式引用报表对象模型集合（字段、参数等）并执行简单任务（如算术和字符串运算）。</span><span class="sxs-lookup"><span data-stu-id="0965b-129">Report expressions reference report object model collections (fields, parameters, etc.) and perform simple tasks like arithmetic and string operations.</span></span> <span data-ttu-id="0965b-130">用来执行这些简单操作的代码只需要 Execution 权限  。</span><span class="sxs-lookup"><span data-stu-id="0965b-130">Code that performs these simple operations only requires **Execution** permission.</span></span> <span data-ttu-id="0965b-131">在 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 中，Code 元素中的用户定义方法以及任何自定义程序集在默认情况下都被授予 Execution 权限。</span><span class="sxs-lookup"><span data-stu-id="0965b-131">By default, user-defined methods in the **Code** element and any custom assemblies are granted **Execution** permission in [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)].</span></span> <span data-ttu-id="0965b-132">因此，对于大多数表达式来说，当前的配置不要求您修改任何安全策略文件。</span><span class="sxs-lookup"><span data-stu-id="0965b-132">Thus, for most expressions, the current configuration does not require that you modify any security policy files.</span></span> <span data-ttu-id="0965b-133">若要向表达式宿主程序集授予额外的权限，管理员需要修改报表服务器和报表设计器的策略配置文件，并更改报表表达式代码组。</span><span class="sxs-lookup"><span data-stu-id="0965b-133">To grant additional permissions to expression host assemblies, an administrator needs to modify the policy configuration files of the report server and Report Designer, and change the report expressions code group.</span></span> <span data-ttu-id="0965b-134">由于权限是全局设置，因此更改表达式宿主的默认权限会影响所有报表。</span><span class="sxs-lookup"><span data-stu-id="0965b-134">Because it is a global setting, changing default permissions for the expression hosts affects all reports.</span></span> <span data-ttu-id="0965b-135">因此，极力建议您将需要额外安全性的所有代码放在一个自定义程序集内。</span><span class="sxs-lookup"><span data-stu-id="0965b-135">For this reason, it is highly recommended that you place all code that requires additional security into a custom assembly.</span></span> <span data-ttu-id="0965b-136">只有此程序集将被授予所需的权限。</span><span class="sxs-lookup"><span data-stu-id="0965b-136">Only this assembly will be granted the permissions you need.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="0965b-137">用来调用外部程序集或受保护资源的代码应当合并到一个自定义程序集内以供报表使用，</span><span class="sxs-lookup"><span data-stu-id="0965b-137">Code that calls external assemblies or protected resources should be incorporated into a custom assembly for use in reports.</span></span> <span data-ttu-id="0965b-138">这会使您对代码所请求和断言的权限进行更多的控制。</span><span class="sxs-lookup"><span data-stu-id="0965b-138">Doing so gives you more control over the permissions requested and asserted by your code.</span></span> <span data-ttu-id="0965b-139">不应当为了保护 Code 元素中的方法而进行调用  。</span><span class="sxs-lookup"><span data-stu-id="0965b-139">You should not make calls to secure methods within the **Code** element.</span></span> <span data-ttu-id="0965b-140">因为这样做会要求你向报表表达式宿主授予 FullTrust，并向所有的自定义代码授予对 CLR 的完全访问权限  。</span><span class="sxs-lookup"><span data-stu-id="0965b-140">Doing so requires you to grant **FullTrust** to the report expression host and grants all custom code full access to the CLR.</span></span>  
  
> [!CAUTION]  
>  <span data-ttu-id="0965b-141">请不要向报表表达式宿主的代码组授予 FullTrust  。</span><span class="sxs-lookup"><span data-stu-id="0965b-141">Do not grant **FullTrust** to the code group for a report expression host.</span></span> <span data-ttu-id="0965b-142">否则将允许所有的报表表达式发出受保护的系统调用。</span><span class="sxs-lookup"><span data-stu-id="0965b-142">If you do, you enable all report expressions to make protected system calls.</span></span>  
  
## <a name="custom-assemblies-referenced-in-reports"></a><span data-ttu-id="0965b-143">报表中引用的自定义程序集</span><span class="sxs-lookup"><span data-stu-id="0965b-143">Custom Assemblies Referenced in Reports</span></span>  
 <span data-ttu-id="0965b-144">某些报表表达式可以调用第三方代码程序集（在 [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 中又称为自定义程序集）。</span><span class="sxs-lookup"><span data-stu-id="0965b-144">Some report expressions can call third-party code assemblies, also known in [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] as custom assemblies.</span></span> <span data-ttu-id="0965b-145">报表服务器要求策略配置文件中的这些程序集至少具有 Execution 权限  。</span><span class="sxs-lookup"><span data-stu-id="0965b-145">The report server expects these assemblies to have at least **Execution** permission in the policy configuration files.</span></span> <span data-ttu-id="0965b-146">默认情况下，[!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] 随附的策略文件会从“我的电脑”区域开始，向所有的程序集授予 Execution 权限  。</span><span class="sxs-lookup"><span data-stu-id="0965b-146">By default, policy files that ship with [!INCLUDE[ssRSnoversion](../../../includes/ssrsnoversion-md.md)] grant **Execution** permission to all assemblies starting from the 'My Computer' zone.</span></span> <span data-ttu-id="0965b-147">您可以根据需要向自定义程序集授予额外的权限。</span><span class="sxs-lookup"><span data-stu-id="0965b-147">You can grant additional permissions to custom assemblies as needed.</span></span>  
  
 <span data-ttu-id="0965b-148">在某些情况下，您可能需要执行某个要求报表表达式中具有特定代码权限的操作。</span><span class="sxs-lookup"><span data-stu-id="0965b-148">In some cases, you may need to perform an operation that requires specific code permissions in a report expression.</span></span> <span data-ttu-id="0965b-149">通常，这意味着报表表达式需要调用受保护的 CLR 库方法（如用来访问文件或系统注册表的方法）。</span><span class="sxs-lookup"><span data-stu-id="0965b-149">Typically, this means that a report expression needs to make a call to a secured CLR library method (such as one that accesses files or the system registry).</span></span> <span data-ttu-id="0965b-150">[!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] 文档介绍了发出此安全调用所需的代码权限；若要执行此调用，必须向调用代码授予这些特定的安全权限。</span><span class="sxs-lookup"><span data-stu-id="0965b-150">The [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] documentation describes the code permissions that are required to make this secure call; to execute the call, the calling code must be granted these specific, secure permissions.</span></span> <span data-ttu-id="0965b-151">如果从报表表达式或 Code 元素发出调用，则必须向表达式宿主程序集授予相应的权限  。</span><span class="sxs-lookup"><span data-stu-id="0965b-151">If you make the call from a report expression or the **Code** element, the expression host assembly must be granted the appropriate permissions.</span></span> <span data-ttu-id="0965b-152">但是，在向表达式宿主授予相应的权限之后，在任何报表中的任何表达式中运行的所有代码现在都将被授予此特定权限。</span><span class="sxs-lookup"><span data-stu-id="0965b-152">However, once you grant the expression host the permissions, all code that runs in any expression in any report is now granted that specific permission.</span></span> <span data-ttu-id="0965b-153">从自定义程序集发出调用，并向该自定义程序集授予特定权限的操作要安全得多。</span><span class="sxs-lookup"><span data-stu-id="0965b-153">It is much more secure to make the call from a custom assembly and grant that custom assembly the specific permissions.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="0965b-154">另请参阅</span><span class="sxs-lookup"><span data-stu-id="0965b-154">See Also</span></span>  
 <span data-ttu-id="0965b-155">[Reporting Services 中的代码访问安全性](code-access-security-in-reporting-services.md) </span><span class="sxs-lookup"><span data-stu-id="0965b-155">[Code Access Security in Reporting Services](code-access-security-in-reporting-services.md) </span></span>  
 [<span data-ttu-id="0965b-156">安全开发 (Reporting Services)</span><span class="sxs-lookup"><span data-stu-id="0965b-156">Secure Development &#40;Reporting Services&#41;</span></span>](secure-development-reporting-services.md)  
  
  
