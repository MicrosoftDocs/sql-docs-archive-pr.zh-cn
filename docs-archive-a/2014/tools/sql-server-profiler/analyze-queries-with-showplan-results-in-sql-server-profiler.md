---
title: 在 SQL Server Profiler 中使用 SHOWPLAN 结果来分析查询 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: profiler
ms.topic: conceptual
helpviewer_keywords:
- events [SQL Server], Showplan
- Profiler [SQL Server Profiler], Showplan results
- SQL Server Profiler, Showplan results
ms.assetid: 6a2f7727-141c-4f59-8613-2e452bc78467
author: stevestein
ms.author: sstein
ms.openlocfilehash: 2ada8b565a307bf636e06c7b5acb5fd4da5f30df
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87682514"
---
# <a name="analyze-queries-with-showplan-results-in-sql-server-profiler"></a><span data-ttu-id="b5de9-102">在 SQL Server Profiler 中使用 SHOWPLAN 结果来分析查询</span><span class="sxs-lookup"><span data-stu-id="b5de9-102">Analyze Queries with SHOWPLAN Results in SQL Server Profiler</span></span>
  <span data-ttu-id="b5de9-103">可以将导致 [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] 在跟踪中收集和显示查询计划信息的 Showplan 事件类添加到跟踪定义。</span><span class="sxs-lookup"><span data-stu-id="b5de9-103">You can add Showplan event classes to a trace definition that cause [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] to gather and display query plan information in the trace.</span></span> <span data-ttu-id="b5de9-104">也可能从跟踪中收集的其他事件中提取显示计划事件，并将这些显示计划事件保存在单独的 XML 文件中。</span><span class="sxs-lookup"><span data-stu-id="b5de9-104">It is also possible to extract Showplan events from the other events collected in the trace and to save these Showplan events in a separate XML file.</span></span>  
  
 <span data-ttu-id="b5de9-105">可以用下列一种方法从跟踪中提取显示计划事件：</span><span class="sxs-lookup"><span data-stu-id="b5de9-105">Extracting Showplan events from the trace can be done in any of the following ways:</span></span>  
  
-   <span data-ttu-id="b5de9-106">在配置跟踪时，使用 **“事件提取设置”** 选项卡。注意，此选项卡只有在选择了 **“事件选择”** 选项卡上的一个显示计划事件后才会显示。</span><span class="sxs-lookup"><span data-stu-id="b5de9-106">At trace configuration time, using the **Events Extraction Settings** tab. Note that this tab does not appear until you select a one of the Showplan events on the **Events Selection** tab.</span></span>  
  
-   <span data-ttu-id="b5de9-107">使用 **“文件”** 菜单上的 **“提取 SQL Server 事件”** 选项。</span><span class="sxs-lookup"><span data-stu-id="b5de9-107">Using the **Extract SQL Server Events** option on the **File** menu.</span></span>  
  
-   <span data-ttu-id="b5de9-108">通过右键单击特定事件并选择“提取事件数据”  ，提取并保存单个事件。</span><span class="sxs-lookup"><span data-stu-id="b5de9-108">By extracting and saving individual events by right-clicking a specific event and choosing **Extract Event Data**.</span></span>  
  
## <a name="showplan-events"></a><span data-ttu-id="b5de9-109">显示计划事件</span><span class="sxs-lookup"><span data-stu-id="b5de9-109">Showplan Events</span></span>  
 <span data-ttu-id="b5de9-110">下表中列出并说明了显示计划跟踪事件。</span><span class="sxs-lookup"><span data-stu-id="b5de9-110">The Showplan trace events are listed and described in the following table.</span></span>  
  
|<span data-ttu-id="b5de9-111">事件名称</span><span class="sxs-lookup"><span data-stu-id="b5de9-111">Event name</span></span>|<span data-ttu-id="b5de9-112">说明</span><span class="sxs-lookup"><span data-stu-id="b5de9-112">Description</span></span>|  
|----------------|-----------------|  
|<span data-ttu-id="b5de9-113">**Performance statistics**</span><span class="sxs-lookup"><span data-stu-id="b5de9-113">**Performance statistics**</span></span>|<span data-ttu-id="b5de9-114">指明编写的显示计划第一次保存到缓存中、何时对其重新编写以及何时将其从计划缓存中删除。</span><span class="sxs-lookup"><span data-stu-id="b5de9-114">Indicates the first time a compiled Showplan is cached, when it is recompiled, and when it is dropped from the plan cache.</span></span> <span data-ttu-id="b5de9-115">**TextData** 列包含 XML 格式的显示计划。</span><span class="sxs-lookup"><span data-stu-id="b5de9-115">The **TextData** column contains the Showplan in XML format.</span></span> <span data-ttu-id="b5de9-116">有关详细信息，请参阅 [Performance Statistics 事件类](../../relational-databases/event-classes/performance-statistics-event-class.md)。</span><span class="sxs-lookup"><span data-stu-id="b5de9-116">For more information, see [Performance Statistics Event Class](../../relational-databases/event-classes/performance-statistics-event-class.md).</span></span>|  
|<span data-ttu-id="b5de9-117">**Showplan All**</span><span class="sxs-lookup"><span data-stu-id="b5de9-117">**Showplan All**</span></span>|<span data-ttu-id="b5de9-118">显示查询计划，列出已执行的 [!INCLUDE[tsql](../../includes/tsql-md.md)] 语句的完整编写时详细信息。</span><span class="sxs-lookup"><span data-stu-id="b5de9-118">Displays the query plan with full compilation details of the executed [!INCLUDE[tsql](../../includes/tsql-md.md)] statement.</span></span> <span data-ttu-id="b5de9-119">例如，可能显示估计开销值和列列表。</span><span class="sxs-lookup"><span data-stu-id="b5de9-119">For example, it might display costing estimates and column lists.</span></span> <span data-ttu-id="b5de9-120">有关详细信息，请参阅 [Showplan All Event Class](../../relational-databases/event-classes/showplan-all-event-class.md)。</span><span class="sxs-lookup"><span data-stu-id="b5de9-120">For more information, see [Showplan All Event Class](../../relational-databases/event-classes/showplan-all-event-class.md).</span></span>|  
|<span data-ttu-id="b5de9-121">**Showplan All For Query Compile**</span><span class="sxs-lookup"><span data-stu-id="b5de9-121">**Showplan All For Query Compile**</span></span>|<span data-ttu-id="b5de9-122">当查询在 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]上编译或重新编译时发生。</span><span class="sxs-lookup"><span data-stu-id="b5de9-122">Occurs when a query is compiled or recompiled on [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="b5de9-123">它是 **Showplan All** 事件的编译时对等事件。</span><span class="sxs-lookup"><span data-stu-id="b5de9-123">This is the compile time counterpart of the **Showplan All** event.</span></span> <span data-ttu-id="b5de9-124">**Showplan All** 在执行查询时发生。</span><span class="sxs-lookup"><span data-stu-id="b5de9-124">**Showplan All** occurs when a query is executed.</span></span> <span data-ttu-id="b5de9-125">编写查询时发生**Showplan All For Query Compile** 。</span><span class="sxs-lookup"><span data-stu-id="b5de9-125">**Showplan All For Query Compile** occurs when a query is compiled.</span></span> <span data-ttu-id="b5de9-126">有关详细信息，请参阅 [Showplan All for Query Compile Event Class](../../relational-databases/event-classes/showplan-all-for-query-compile-event-class.md)。</span><span class="sxs-lookup"><span data-stu-id="b5de9-126">For more information, see [Showplan All for Query Compile Event Class](../../relational-databases/event-classes/showplan-all-for-query-compile-event-class.md).</span></span>|  
|<span data-ttu-id="b5de9-127">**Showplan Statistics Profile**</span><span class="sxs-lookup"><span data-stu-id="b5de9-127">**Showplan Statistics Profile**</span></span>|<span data-ttu-id="b5de9-128">显示查询计划，列出正在执行的 [!INCLUDE[tsql](../../includes/tsql-md.md)] 语句的完整运行时详细信息（包括通过每个操作传递的实际行数）。</span><span class="sxs-lookup"><span data-stu-id="b5de9-128">Displays the query plan with full run-time details of the [!INCLUDE[tsql](../../includes/tsql-md.md)] statement being executed, including the actual number of rows passing through each operation.</span></span> <span data-ttu-id="b5de9-129">有关详细信息，请参阅 [Showplan Statistics Profile Event Class](../../relational-databases/event-classes/showplan-statistics-profile-event-class.md)。</span><span class="sxs-lookup"><span data-stu-id="b5de9-129">For more information, see [Showplan Statistics Profile Event Class](../../relational-databases/event-classes/showplan-statistics-profile-event-class.md).</span></span>|  
|<span data-ttu-id="b5de9-130">**Showplan Text**</span><span class="sxs-lookup"><span data-stu-id="b5de9-130">**Showplan Text**</span></span>|<span data-ttu-id="b5de9-131">将正在执行的 [!INCLUDE[tsql](../../includes/tsql-md.md)] 语句的查询计划树显示为二进制数据。</span><span class="sxs-lookup"><span data-stu-id="b5de9-131">Displays as binary data the query plan tree of the [!INCLUDE[tsql](../../includes/tsql-md.md)] statement being executed.</span></span> <span data-ttu-id="b5de9-132">有关详细信息，请参阅 [Showplan Text Event Class](../../relational-databases/event-classes/showplan-text-event-class.md)。</span><span class="sxs-lookup"><span data-stu-id="b5de9-132">For more information, see [Showplan Text Event Class](../../relational-databases/event-classes/showplan-text-event-class.md).</span></span>|  
|<span data-ttu-id="b5de9-133">**Showplan Text (Unencoded)**</span><span class="sxs-lookup"><span data-stu-id="b5de9-133">**Showplan Text (Unencoded)**</span></span>|<span data-ttu-id="b5de9-134">将正在执行的 [!INCLUDE[tsql](../../includes/tsql-md.md)] 语句的查询计划树显示为文本。</span><span class="sxs-lookup"><span data-stu-id="b5de9-134">Displays as text the query plan tree of the [!INCLUDE[tsql](../../includes/tsql-md.md)] statement being executed.</span></span> <span data-ttu-id="b5de9-135">除了此事件类显示文本而不是二进制数据以外，此事件类显示的信息与 Showplan Text 相同。</span><span class="sxs-lookup"><span data-stu-id="b5de9-135">This event class displays the same information as Showplan Text, except that this event class displays text instead of binary data.</span></span> <span data-ttu-id="b5de9-136">有关详细信息，请参阅 [Showplan Text (Unencoded) 事件类](../../relational-databases/event-classes/showplan-text-unencoded-event-class.md)。</span><span class="sxs-lookup"><span data-stu-id="b5de9-136">For more information, see [Showplan Text &#40;Unencoded&#41; Event Class](../../relational-databases/event-classes/showplan-text-unencoded-event-class.md).</span></span>|  
|<span data-ttu-id="b5de9-137">**Showplan XML**</span><span class="sxs-lookup"><span data-stu-id="b5de9-137">**Showplan XML**</span></span>|<span data-ttu-id="b5de9-138">显示查询计划，列出在查询优化期间收集的完整数据。</span><span class="sxs-lookup"><span data-stu-id="b5de9-138">Displays the query plan with full data collected during query optimization.</span></span> <span data-ttu-id="b5de9-139">仅当优化查询计划时才生成此事件。</span><span class="sxs-lookup"><span data-stu-id="b5de9-139">This event is generated only when a query plan is optimized.</span></span> <span data-ttu-id="b5de9-140">有关详细信息，请参阅 [Showplan XML Event Class](../../relational-databases/event-classes/showplan-xml-event-class.md)。</span><span class="sxs-lookup"><span data-stu-id="b5de9-140">For more information, see [Showplan XML Event Class](../../relational-databases/event-classes/showplan-xml-event-class.md).</span></span>|  
|<span data-ttu-id="b5de9-141">**Showplan XML For Query Compile**</span><span class="sxs-lookup"><span data-stu-id="b5de9-141">**Showplan XML For Query Compile**</span></span>|<span data-ttu-id="b5de9-142">编写完查询后，显示查询计划。</span><span class="sxs-lookup"><span data-stu-id="b5de9-142">Displays the query plan when the query is compiled.</span></span> <span data-ttu-id="b5de9-143">有关详细信息，请参阅 [Showplan XML for Query Compile Event Class](../../relational-databases/event-classes/showplan-xml-for-query-compile-event-class.md)。</span><span class="sxs-lookup"><span data-stu-id="b5de9-143">For more information, see [Showplan XML for Query Compile Event Class](../../relational-databases/event-classes/showplan-xml-for-query-compile-event-class.md).</span></span>|  
|<span data-ttu-id="b5de9-144">**Showplan XML Statistics Profile**</span><span class="sxs-lookup"><span data-stu-id="b5de9-144">**Showplan XML Statistics Profile**</span></span>|<span data-ttu-id="b5de9-145">显示查询计划，列出 XML 格式的完整运行时详细信息。</span><span class="sxs-lookup"><span data-stu-id="b5de9-145">Displays the query plan with full run-time details in XML format.</span></span> <span data-ttu-id="b5de9-146">例如，此事件类捕获通过已执行的 [!INCLUDE[tsql](../../includes/tsql-md.md)] 语句的每个运算符的行数。</span><span class="sxs-lookup"><span data-stu-id="b5de9-146">For example, this event class captures the number of rows passing through each operator of the [!INCLUDE[tsql](../../includes/tsql-md.md)] statement that is executed.</span></span> <span data-ttu-id="b5de9-147">有关详细信息，请参阅 [Showplan XML Statistics Profile Event Class](../../relational-databases/event-classes/showplan-xml-statistics-profile-event-class.md)。</span><span class="sxs-lookup"><span data-stu-id="b5de9-147">For more information, see [Showplan XML Statistics Profile Event Class](../../relational-databases/event-classes/showplan-xml-statistics-profile-event-class.md).</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="b5de9-148">另请参阅</span><span class="sxs-lookup"><span data-stu-id="b5de9-148">See Also</span></span>  
 [<span data-ttu-id="b5de9-149">“性能”事件类别</span><span class="sxs-lookup"><span data-stu-id="b5de9-149">Performance Event Category</span></span>](../../relational-databases/event-classes/performance-event-category.md)  
  
  
