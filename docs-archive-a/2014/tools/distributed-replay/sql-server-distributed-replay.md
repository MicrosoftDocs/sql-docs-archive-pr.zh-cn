---
title: SQL Server Distributed Replay |Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: tools-other
ms.topic: conceptual
helpviewer_keywords:
- Distributed Replay
- SQL Server Distributed Replay
ms.assetid: 58ef7016-b105-42c2-90a0-364f411849a4
author: stevestein
ms.author: sstein
ms.openlocfilehash: b832cb8a8d8a38815b13b82a7af8eefc2fb81427
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87682554"
---
# <a name="sql-server-distributed-replay"></a><span data-ttu-id="4b746-102">SQL Server 分布式重播</span><span class="sxs-lookup"><span data-stu-id="4b746-102">SQL Server Distributed Replay</span></span>
  <span data-ttu-id="4b746-103">[!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Distributed Replay 功能可帮助你评估即将进行的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 升级的影响。</span><span class="sxs-lookup"><span data-stu-id="4b746-103">The [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Distributed Replay feature helps you assess the impact of future [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] upgrades.</span></span> <span data-ttu-id="4b746-104">您还可以使用它来帮助评估硬件和操作系统升级以及 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 优化的影响。</span><span class="sxs-lookup"><span data-stu-id="4b746-104">You can also use it to help assess the impact of hardware and operating system upgrades, and [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] tuning.</span></span>

## <a name="benefits-of-distributed-replay"></a><span data-ttu-id="4b746-105">分布式重播的优点</span><span class="sxs-lookup"><span data-stu-id="4b746-105">Benefits of Distributed Replay</span></span>
 <span data-ttu-id="4b746-106">与 [!INCLUDE[ssSqlProfiler](../../../includes/sssqlprofiler-md.md)]类似，您可以使用分布式重播针对升级后的测试环境重播捕获的跟踪。</span><span class="sxs-lookup"><span data-stu-id="4b746-106">Similar to [!INCLUDE[ssSqlProfiler](../../../includes/sssqlprofiler-md.md)], you can use Distributed Replay to replay a captured trace against an upgraded test environment.</span></span> <span data-ttu-id="4b746-107">与 [!INCLUDE[ssSqlProfiler](../../../includes/sssqlprofiler-md.md)]不同的是，分布式重播并不仅限于从单台计算机重播工作负荷。</span><span class="sxs-lookup"><span data-stu-id="4b746-107">Unlike [!INCLUDE[ssSqlProfiler](../../../includes/sssqlprofiler-md.md)], Distributed Replay is not limited to replaying the workload from a single computer.</span></span>

 <span data-ttu-id="4b746-108">与 [!INCLUDE[ssSqlProfiler](../../../includes/sssqlprofiler-md.md)] 相比，分布式重播提供了一个更具伸缩性的解决方案。</span><span class="sxs-lookup"><span data-stu-id="4b746-108">Distributed Replay offers a more scalable solution than [!INCLUDE[ssSqlProfiler](../../../includes/sssqlprofiler-md.md)].</span></span> <span data-ttu-id="4b746-109">使用分布式重播，您可以从多台计算机重播工作负荷，并更好地模拟关键任务型工作负荷。</span><span class="sxs-lookup"><span data-stu-id="4b746-109">With Distributed Replay, you can replay a workload from multiple computers and better simulate a mission-critical workload.</span></span>

 <span data-ttu-id="4b746-110">[!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Distributed Replay 功能可以从多台计算机重播跟踪数据，并模拟关键任务型工作负载。</span><span class="sxs-lookup"><span data-stu-id="4b746-110">The [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Distributed Replay feature can use multiple computers to replay trace data and simulate a mission-critical workload.</span></span> <span data-ttu-id="4b746-111">可使用分布式重播进行应用程序兼容性测试、性能测试或容量规划。</span><span class="sxs-lookup"><span data-stu-id="4b746-111">Use Distributed Replay for application compatibility testing, performance testing, or capacity planning.</span></span>

## <a name="when-to-use-distributed-replay"></a><span data-ttu-id="4b746-112">何时使用分布式重播</span><span class="sxs-lookup"><span data-stu-id="4b746-112">When to Use Distributed Replay</span></span>
 [!INCLUDE[ssSqlProfiler](../../../includes/sssqlprofiler-md.md)] <span data-ttu-id="4b746-113">和分布式重播在功能上有些重复。</span><span class="sxs-lookup"><span data-stu-id="4b746-113">and Distributed Replay provide some overlap in functionality.</span></span>

 <span data-ttu-id="4b746-114">您可以使用 [!INCLUDE[ssSqlProfiler](../../../includes/sssqlprofiler-md.md)] 针对已升级的测试环境重播捕获的跟踪。</span><span class="sxs-lookup"><span data-stu-id="4b746-114">You may use [!INCLUDE[ssSqlProfiler](../../../includes/sssqlprofiler-md.md)] to replay a captured trace against an upgraded test environment.</span></span> <span data-ttu-id="4b746-115">还可以分析重播结果以查找潜在的功能和性能不兼容问题。</span><span class="sxs-lookup"><span data-stu-id="4b746-115">You can also analyze the replay results to look for potential functional and performance incompatibilities.</span></span> <span data-ttu-id="4b746-116">但是， [!INCLUDE[ssSqlProfiler](../../../includes/sssqlprofiler-md.md)] 只能从单台计算机重播工作负荷。</span><span class="sxs-lookup"><span data-stu-id="4b746-116">However, [!INCLUDE[ssSqlProfiler](../../../includes/sssqlprofiler-md.md)] can only replay a workload from a single computer.</span></span> <span data-ttu-id="4b746-117">重播具有许多活动的并发连接或较高吞吐量的密集型 OLTP 应用程序时， [!INCLUDE[ssSqlProfiler](../../../includes/sssqlprofiler-md.md)] 可能会成为资源瓶颈。</span><span class="sxs-lookup"><span data-stu-id="4b746-117">When replaying an intensive OLTP application that has many active concurrent connections or high throughput, [!INCLUDE[ssSqlProfiler](../../../includes/sssqlprofiler-md.md)] can become a resource bottleneck.</span></span>

 <span data-ttu-id="4b746-118">与 [!INCLUDE[ssSqlProfiler](../../../includes/sssqlprofiler-md.md)] 相比，分布式重播提供了一个更具伸缩性的解决方案。</span><span class="sxs-lookup"><span data-stu-id="4b746-118">Distributed Replay offers a more scalable solution than [!INCLUDE[ssSqlProfiler](../../../includes/sssqlprofiler-md.md)].</span></span> <span data-ttu-id="4b746-119">使用分布式重播可以从多台计算机重播工作负荷，并更好地模拟关键任务型工作负荷。</span><span class="sxs-lookup"><span data-stu-id="4b746-119">Use Distributed Replay to replay a workload from multiple computers and better simulate a mission-critical workload.</span></span>

 <span data-ttu-id="4b746-120">下表介绍了适当使用每种工具的情况。</span><span class="sxs-lookup"><span data-stu-id="4b746-120">The following table describes when to use each tool.</span></span>

|<span data-ttu-id="4b746-121">工具</span><span class="sxs-lookup"><span data-stu-id="4b746-121">Tool</span></span>|<span data-ttu-id="4b746-122">使用场景</span><span class="sxs-lookup"><span data-stu-id="4b746-122">Use When...</span></span>|
|----------|---------------|
|[!INCLUDE[ssSqlProfiler](../../../includes/sssqlprofiler-md.md)]|<span data-ttu-id="4b746-123">您希望在单台计算机上使用传统的重播机制。</span><span class="sxs-lookup"><span data-stu-id="4b746-123">You want to use the conventional replay mechanism on a single computer.</span></span> <span data-ttu-id="4b746-124">特别是，你需要逐行调试功能，如“步骤”、“运行至光标处”和“切换断点”命令。</span><span class="sxs-lookup"><span data-stu-id="4b746-124">In particular, you need line-by-line debugging capabilities, such as the **Step**, **Run to Cursor**, and **Toggle Breakpoint** commands.</span></span><br /><br /> <span data-ttu-id="4b746-125">您要重播 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 跟踪。</span><span class="sxs-lookup"><span data-stu-id="4b746-125">You want to replay an [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] trace.</span></span>|
|<span data-ttu-id="4b746-126">分布式重播</span><span class="sxs-lookup"><span data-stu-id="4b746-126">Distributed Replay</span></span>|<span data-ttu-id="4b746-127">您要评估应用程序兼容性。</span><span class="sxs-lookup"><span data-stu-id="4b746-127">You want to evaluate application compatibility.</span></span> <span data-ttu-id="4b746-128">例如，您要测试 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 和操作系统升级方案、硬件升级或索引优化。</span><span class="sxs-lookup"><span data-stu-id="4b746-128">For example, you want to test [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and operating system upgrade scenarios, hardware upgrades, or index tuning.</span></span><br /><br /> <span data-ttu-id="4b746-129">捕获的跟踪中的并发率过高，以致于单个重播客户端不足以对其进行模拟。</span><span class="sxs-lookup"><span data-stu-id="4b746-129">The concurrency in the captured trace is so high that a single replay client cannot sufficiently simulate it.</span></span>|

## <a name="distributed-replay-concepts"></a><span data-ttu-id="4b746-130">分布式重播概念</span><span class="sxs-lookup"><span data-stu-id="4b746-130">Distributed Replay Concepts</span></span>
 <span data-ttu-id="4b746-131">以下组件组成分布式重播环境：</span><span class="sxs-lookup"><span data-stu-id="4b746-131">The following components make up the Distributed Replay environment:</span></span>

-   <span data-ttu-id="4b746-132">**Distributed Replay 管理工具**：一个控制台应用程序， `DReplay.exe` 用于与 Distributed Replay 控制器进行通信。</span><span class="sxs-lookup"><span data-stu-id="4b746-132">**Distributed Replay administration tool**: A console application, `DReplay.exe`, used to communicate with the distributed replay controller.</span></span> <span data-ttu-id="4b746-133">使用管理工具可控制分布式的重播。</span><span class="sxs-lookup"><span data-stu-id="4b746-133">Use the administration tool to control the distributed replay.</span></span>

-   <span data-ttu-id="4b746-134">**Distributed Replay 控制器**：运行名为 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 的 Distributed Replay 控制器的 Windows 服务的一台计算机。</span><span class="sxs-lookup"><span data-stu-id="4b746-134">**Distributed Replay controller**: A computer running the Windows service named [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Distributed Replay controller.</span></span> <span data-ttu-id="4b746-135">Distributed Replay 控制器协调分布式的重播客户端的操作。</span><span class="sxs-lookup"><span data-stu-id="4b746-135">The Distributed Replay controller orchestrates the actions of the distributed replay clients.</span></span> <span data-ttu-id="4b746-136">在每个 Distributed Replay 环境中只能有一个控制器实例。</span><span class="sxs-lookup"><span data-stu-id="4b746-136">There can only be one controller instance in each Distributed Replay environment.</span></span>

-   <span data-ttu-id="4b746-137">**Distributed Replay 客户端**：运行名为 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Distributed Replay 客户端的 Windows 服务的一台或多台计算机（物理或虚拟）。</span><span class="sxs-lookup"><span data-stu-id="4b746-137">**Distributed Replay clients**: One or more computers (physical or virtual) running the Windows service named [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Distributed Replay client.</span></span> <span data-ttu-id="4b746-138">多个 Distributed Replay 客户端一起来模拟 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]实例的工作负荷。</span><span class="sxs-lookup"><span data-stu-id="4b746-138">The Distributed Replay clients work together to simulate workloads against an instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="4b746-139">在每个 Distributed Replay 环境中可以有一个或多个客户端。</span><span class="sxs-lookup"><span data-stu-id="4b746-139">There can be one or more clients in each Distributed Replay environment.</span></span>

-   <span data-ttu-id="4b746-140">**目标服务器**：Distributed Replay 客户端可用于重播跟踪数据的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例。</span><span class="sxs-lookup"><span data-stu-id="4b746-140">**Target server**: An instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] that the Distributed Replay clients can use to replay trace data.</span></span> <span data-ttu-id="4b746-141">建议将目标服务器置于测试环境中。</span><span class="sxs-lookup"><span data-stu-id="4b746-141">We recommend that the target server be located in a test environment.</span></span>

 <span data-ttu-id="4b746-142">分布式重播管理工具、控制器和客户端可安装在不同计算机或同一计算机上。</span><span class="sxs-lookup"><span data-stu-id="4b746-142">The Distributed Replay administration tool, controller, and client can be installed on different computers or the same computer.</span></span> <span data-ttu-id="4b746-143">一台计算机上只能运行分布式重播控制器或客户端服务的一个实例。</span><span class="sxs-lookup"><span data-stu-id="4b746-143">There can be only one instance of the Distributed Replay controller or client service that is running on the same computer.</span></span>

 <span data-ttu-id="4b746-144">下图展示了 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 分布式重播物理体系结构：</span><span class="sxs-lookup"><span data-stu-id="4b746-144">The following figure shows the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Distributed Replay physical architecture:</span></span>

 <span data-ttu-id="4b746-145">![Distributed Replay 体系结构](../../database-engine/media/distributedreplayarch.gif "Distributed Replay 体系结构")</span><span class="sxs-lookup"><span data-stu-id="4b746-145">![Distributed Replay Architecture](../../database-engine/media/distributedreplayarch.gif "Distributed Replay Architecture")</span></span>

## <a name="distributed-replay-tasks"></a><span data-ttu-id="4b746-146">分布式重播任务</span><span class="sxs-lookup"><span data-stu-id="4b746-146">Distributed Replay Tasks</span></span>

|<span data-ttu-id="4b746-147">任务说明</span><span class="sxs-lookup"><span data-stu-id="4b746-147">Task Description</span></span>|<span data-ttu-id="4b746-148">主题</span><span class="sxs-lookup"><span data-stu-id="4b746-148">Topic</span></span>|
|----------------------|-----------|
|<span data-ttu-id="4b746-149">介绍如何配置分布式重播。</span><span class="sxs-lookup"><span data-stu-id="4b746-149">Describes how to configure Distributed Replay.</span></span>|[<span data-ttu-id="4b746-150">配置 Distributed Replay</span><span class="sxs-lookup"><span data-stu-id="4b746-150">Configure Distributed Replay</span></span>](configure-distributed-replay.md)|
|<span data-ttu-id="4b746-151">介绍如何准备输入跟踪数据。</span><span class="sxs-lookup"><span data-stu-id="4b746-151">Describes how to prepare the input trace data.</span></span>|[<span data-ttu-id="4b746-152">准备输入跟踪数据</span><span class="sxs-lookup"><span data-stu-id="4b746-152">Prepare the Input Trace Data</span></span>](prepare-the-input-trace-data.md)|
|<span data-ttu-id="4b746-153">介绍如何重播跟踪数据。</span><span class="sxs-lookup"><span data-stu-id="4b746-153">Describes how to replay trace data.</span></span>|[<span data-ttu-id="4b746-154">重播跟踪数据</span><span class="sxs-lookup"><span data-stu-id="4b746-154">Replay Trace Data</span></span>](replay-trace-data.md)|
|<span data-ttu-id="4b746-155">介绍如何查看分布式重播跟踪数据结果。</span><span class="sxs-lookup"><span data-stu-id="4b746-155">Describes how to review the Distributed Replay trace data results.</span></span>|[<span data-ttu-id="4b746-156">查看重播结果</span><span class="sxs-lookup"><span data-stu-id="4b746-156">Review the Replay Results</span></span>](review-the-replay-results.md)|
|<span data-ttu-id="4b746-157">介绍如何使用管理工具以启动、监视和取消控制器上的操作。</span><span class="sxs-lookup"><span data-stu-id="4b746-157">Describes how to use the administration tool to initiate, monitor, and cancel operations on the controller.</span></span>|[<span data-ttu-id="4b746-158">管理工具命令行选项（Distributed Replay 实用工具）</span><span class="sxs-lookup"><span data-stu-id="4b746-158">Administration Tool Command-line Options &#40;Distributed Replay Utility&#41;</span></span>](administration-tool-command-line-options-distributed-replay-utility.md)|

## <a name="see-also"></a><span data-ttu-id="4b746-159">另请参阅</span><span class="sxs-lookup"><span data-stu-id="4b746-159">See Also</span></span>
 <span data-ttu-id="4b746-160">使用 Distributed Replay [SQL Server Distributed Replay 论坛](https://social.technet.microsoft.com/Forums/sl/sqldru/) [，](https://docs.microsoft.com/archive/blogs/msdn/mspfe/using-distributed-replay-to-load-test-your-sql-serverpart-2) [使用 Distributed Replay](https://docs.microsoft.com/archive/blogs/batuhanyildiz/using-distributed-replay-to-load-test-your-sql-serverpart-1)负载测试 SQL Server 第2部分</span><span class="sxs-lookup"><span data-stu-id="4b746-160">[SQL Server Distributed Replay Forum](https://social.technet.microsoft.com/Forums/sl/sqldru/) [Using Distributed Replay to Load Test Your SQL Server - Part 2](https://docs.microsoft.com/archive/blogs/msdn/mspfe/using-distributed-replay-to-load-test-your-sql-serverpart-2) [Using Distributed Replay to Load Test Your SQL Server - Part 1](https://docs.microsoft.com/archive/blogs/batuhanyildiz/using-distributed-replay-to-load-test-your-sql-serverpart-1)</span></span>


