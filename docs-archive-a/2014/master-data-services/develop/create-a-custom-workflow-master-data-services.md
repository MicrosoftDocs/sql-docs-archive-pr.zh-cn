---
title: 创建自定义工作流 (Master Data Services) | Microsoft Docs
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: reference
ms.assetid: 8e4403e9-595c-4b6b-9d0c-f6ae1b2bc99d
author: lrtoyou1223
ms.author: lle
ms.openlocfilehash: cac53946d83eda178328b153875a86440517a560
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87591926"
---
# <a name="create-a-custom-workflow-master-data-services"></a><span data-ttu-id="6c7c9-102">创建自定义工作流 (Master Data Services)</span><span class="sxs-lookup"><span data-stu-id="6c7c9-102">Create a Custom Workflow (Master Data Services)</span></span>
  [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] <span data-ttu-id="6c7c9-103">使用业务规则创建基本工作流解决方案，如自动更新和验证数据，并根据指定的条件发送电子邮件通知。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-103">uses business rules to create basic workflow solutions, such as to automatically update and validate data and have e-mail notifications sent, based on conditions you specify.</span></span> <span data-ttu-id="6c7c9-104">当您需要的处理比内置工作流操作提供的处理更复杂时，请使用自定义工作流。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-104">When you require processing that is more complex than what the built-in workflow actions provide, use a custom workflow.</span></span> <span data-ttu-id="6c7c9-105">自定义工作流是您创建的 .NET 程序集。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-105">A custom workflow is a .NET assembly that you create.</span></span> <span data-ttu-id="6c7c9-106">在调用您的工作流程序集时，您的代码可以执行您的情况所需要的任何操作。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-106">When your workflow assembly is called, your code can take whatever action your situation requires.</span></span> <span data-ttu-id="6c7c9-107">例如，如果您的工作流要求复杂的事件处理（如多层审批或复杂的决策树），您可以配置 [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] 来启动自定义工作流，以便分析数据和确定将其发送到何处以待审批。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-107">For example, if your workflow requires complex event processing, such as multi-tiered approvals or complicated decision trees, you can configure [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] to start a custom workflow that analyzes the data and determines where to send it for approval.</span></span>  
  
## <a name="how-custom-workflows-are-processed"></a><span data-ttu-id="6c7c9-108">如何处理自定义工作流</span><span class="sxs-lookup"><span data-stu-id="6c7c9-108">How Custom Workflows Are Processed</span></span>  
 <span data-ttu-id="6c7c9-109">有三个涉及处理自定义工作流的主要组件：[!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] Web 应用程序、SQL Server MDS Workflow Integration Service 和工作流处理程序程序集。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-109">There are three main components involved to process custom workflows: the [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] web application, SQL Server MDS Workflow Integration Service, and the workflow handler assembly.</span></span> <span data-ttu-id="6c7c9-110">这些组件按如下所示处理自定义工作流：</span><span class="sxs-lookup"><span data-stu-id="6c7c9-110">These components process a custom workflow as follows:</span></span>  
  
1.  <span data-ttu-id="6c7c9-111">您使用 [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] 来验证启动工作流的实体。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-111">You use [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] to validate an entity that starts a workflow.</span></span>  
  
2.  [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] <span data-ttu-id="6c7c9-112">将满足业务规则条件的成员发送到 [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] 数据库中的 Service Broker 队列。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-112">sends members that meet the business rule conditions to a Service Broker queue in the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database.</span></span>  
  
3.  <span data-ttu-id="6c7c9-113">SQL Server MDS Workflow Integration Service 定期调用 [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] 数据库中的存储过程。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-113">At regular intervals, SQL Server MDS Workflow Integration Service calls a stored procedure in the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database.</span></span>  
  
4.  <span data-ttu-id="6c7c9-114">当此存储过程发现 Service Broker 队列中的记录时，它将这些记录返回到 SQL Server MDS Workflow Integration Service。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-114">When this stored procedure finds records in the Service Broker queue, it returns them to SQL Server MDS Workflow Integration Service.</span></span>  
  
5.  <span data-ttu-id="6c7c9-115">SQL Server MDS Workflow Integration Services 将数据路由到您的工作流处理程序程序集。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-115">SQL Server MDS Workflow Integration Services routes the data to your workflow handler assembly.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6c7c9-116">注意：SQL Server MDS Workflow Integration Service 旨在触发简单的过程。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-116">Note: SQL Server MDS Workflow Integration Service is meant to trigger simple processes.</span></span> <span data-ttu-id="6c7c9-117">如果您的自定义代码需要复杂处理，请在单独的线程中或工作流进程之外完成您的处理。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-117">If your custom code requires complex processing, complete your processing either in a separate thread or outside of the workflow process.</span></span>  
  
## <a name="configure-master-data-services-for-custom-workflows"></a><span data-ttu-id="6c7c9-118">为自定义工作流配置 Master Data Services</span><span class="sxs-lookup"><span data-stu-id="6c7c9-118">Configure Master Data Services for Custom Workflows</span></span>  
 <span data-ttu-id="6c7c9-119">创建自定义工作流需要编写一些自定义代码，并将 [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] 配置为将工作流数据传递给工作流处理程序。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-119">Creating a custom workflow requires writing some custom code and configuring [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] to pass workflow data to your workflow handler.</span></span> <span data-ttu-id="6c7c9-120">请按照以下步骤启用自定义工作流处理：</span><span class="sxs-lookup"><span data-stu-id="6c7c9-120">Follow these steps to enable custom workflow processing:</span></span>  
  
1.  <span data-ttu-id="6c7c9-121">创建用于实现[MasterDataServices. WorkflowTypeExtender. IWorkflowTypeExtender](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130))的 .net 程序集。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-121">Create a .NET assembly that implements [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130)).</span></span>  
  
2.  <span data-ttu-id="6c7c9-122">配置 SQL Server MDS Workflow Integration Service 以连接您的 [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] 数据库，并将标记与您的工作流处理程序关联。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-122">Configure SQL Server MDS Workflow Integration Service to connect to your [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database and to associate a tag with your workflow handler.</span></span>  
  
3.  <span data-ttu-id="6c7c9-123">启动 SQL Server MDS Workflow Integration Service。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-123">Start SQL Server MDS Workflow Integration Service.</span></span>  
  
4.  <span data-ttu-id="6c7c9-124">在 [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] 中创建业务规则，以启动标记了工作流处理程序名称的工作流。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-124">Create a business rule in [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] that starts a workflow that is tagged with the name of your workflow handler.</span></span>  
  
5.  <span data-ttu-id="6c7c9-125">将此业务规则应用到成员，以触发您的自定义工作流。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-125">Apply the business rule to a member that triggers your custom workflow.</span></span>  
  
### <a name="create-the-workflow-handler-assembly"></a><span data-ttu-id="6c7c9-126">创建工作流处理程序程序集</span><span class="sxs-lookup"><span data-stu-id="6c7c9-126">Create the Workflow Handler Assembly</span></span>  
 <span data-ttu-id="6c7c9-127">自定义工作流是实现[IWorkflowTypeExtender](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130))接口的 .net 类库程序集。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-127">A custom workflow is a .NET class library assembly that implements the [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130)) interface.</span></span> <span data-ttu-id="6c7c9-128">SQL Server MDS Workflow Integration Service 调用[WorkflowTypeExtender](/previous-versions/sql/sql-server-2016/hh759009(v=sql.130)) ，以运行你的代码。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-128">SQL Server MDS Workflow Integration Service calls the [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender.StartWorkflow\*](/previous-versions/sql/sql-server-2016/hh759009(v=sql.130)) method to run your code.</span></span> <span data-ttu-id="6c7c9-129">有关实现[MasterDataServices](/previous-versions/sql/sql-server-2016/hh759009(v=sql.130))的示例代码，请参阅[Master Data Services&#41;&#40;自定义工作流示例](create-a-custom-workflow-example.md)。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-129">For example code that implements [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender.StartWorkflow\*](/previous-versions/sql/sql-server-2016/hh759009(v=sql.130)), see [Custom Workflow Example &#40;Master Data Services&#41;](create-a-custom-workflow-example.md).</span></span>  
  
 <span data-ttu-id="6c7c9-130">按照以下步骤使用 Visual Studio 2010 创建 SQL Server MDS Workflow Integration Service 可以调用来处理自定义工作流的程序集：</span><span class="sxs-lookup"><span data-stu-id="6c7c9-130">Follow these steps to use Visual Studio 2010 to create an assembly that SQL Server MDS Workflow Integration Service can call to handle a custom workflow:</span></span>  
  
1.  <span data-ttu-id="6c7c9-131">在 Visual Studio 2010 中，创建使用所选语言的新“类库”项目\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-131">In Visual Studio 2010, create a new **Class Library** project that uses the language of your choice.</span></span> <span data-ttu-id="6c7c9-132">若要创建 C# 类库，请选择“Visual C#\Windows”项目类型，并选择“类库”模板\*\*\*\*\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-132">To create a C# Class Library, select the **Visual C#\Windows** project types and select the **Class Library** template.</span></span> <span data-ttu-id="6c7c9-133">输入项目名称，如“MDSWorkflowTest”，然后单击“确定”\*\*\*\*\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-133">Enter a name for your project, such as **MDSWorkflowTest**, and click **OK**.</span></span>  
  
2.  <span data-ttu-id="6c7c9-134">将引用添加到 Microsoft.MasterDataServices.WorkflowTypeExtender.dll。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-134">Add a reference to Microsoft.MasterDataServices.WorkflowTypeExtender.dll.</span></span> <span data-ttu-id="6c7c9-135">此程序集可在 \<Your installation folder> \Master Data services\webapplication\bin 中找到。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-135">This assembly can be found in \<Your installation folder>\Master Data Services\WebApplication\bin.</span></span>  
  
3.  <span data-ttu-id="6c7c9-136">将“using Microsoft.MasterDataServices.Core.Workflow;”添加到 C# 代码文件。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-136">Add 'using Microsoft.MasterDataServices.Core.Workflow;' to your C# code file.</span></span>  
  
4.  <span data-ttu-id="6c7c9-137">继承类声明中的[MasterDataServices。](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130))</span><span class="sxs-lookup"><span data-stu-id="6c7c9-137">Inherit from [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130)) in your class declaration.</span></span> <span data-ttu-id="6c7c9-138">该类声明应类似于：“public class WorkflowTester : IWorkflowTypeExtender”。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-138">The class declaration should be similar to: 'public class WorkflowTester : IWorkflowTypeExtender'.</span></span>  
  
5.  <span data-ttu-id="6c7c9-139">实现[MasterDataServices. WorkflowTypeExtender. IWorkflowTypeExtender](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130))接口。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-139">Implement the [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130)) interface.</span></span> <span data-ttu-id="6c7c9-140">SQL Server MDS Workflow Integration Service 调用[WorkflowTypeExtender. StartWorkflow \*](/previous-versions/sql/sql-server-2016/hh759009(v=sql.130))方法来启动工作流。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-140">The [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender.StartWorkflow\*](/previous-versions/sql/sql-server-2016/hh759009(v=sql.130)) method is called by SQL Server MDS Workflow Integration Service to start your workflow.</span></span>  
  
6.  <span data-ttu-id="6c7c9-141">将程序集复制到 \<Your installation folder> \Master Data services\webapplication\bin 中名为 Microsoft.MasterDataServices.Workflow.exe 的 SQL SERVER MDS Workflow Integration Service 可执行文件的位置。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-141">Copy your assembly to the location of the SQL Server MDS Workflow Integration Service executable, named Microsoft.MasterDataServices.Workflow.exe, in \<Your installation folder>\Master Data Services\WebApplication\bin.</span></span>  
  
### <a name="configure-sql-server-mds-workflow-integration-service"></a><span data-ttu-id="6c7c9-142">配置 SQL Server MDS Workflow Integration Service</span><span class="sxs-lookup"><span data-stu-id="6c7c9-142">Configure SQL Server MDS Workflow Integration Service</span></span>  
 <span data-ttu-id="6c7c9-143">按照如下步骤编辑 [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] 配置文件以包含您的 [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] 数据库的连接信息，并将标记与您的工作流处理程序程序集关联：</span><span class="sxs-lookup"><span data-stu-id="6c7c9-143">Edit the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] configuration file to include connection information for your [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database and to associate a tag with your workflow handler assembly by following these steps:</span></span>  
  
1.  <span data-ttu-id="6c7c9-144">在 \<Your installation folder> \Master Data services\webapplication\bin 中查找 Microsoft.MasterDataServices.Workflow.exe.config</span><span class="sxs-lookup"><span data-stu-id="6c7c9-144">Find Microsoft.MasterDataServices.Workflow.exe.config in \<Your installation folder>\Master Data Services\WebApplication\bin.</span></span>  
  
2.  <span data-ttu-id="6c7c9-145">将 [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] 数据库连接信息添加为“ConnectionString”设置。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-145">Add the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database connection information to the "ConnectionString" setting.</span></span> <span data-ttu-id="6c7c9-146">如果您的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 安装使用区分大小写的排序规则，则必须以与数据集中相同的大小写输入数据库的名称。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-146">If your [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] installation uses case-sensitive collation, the name of the database must be entered in the same case as in the database.</span></span> <span data-ttu-id="6c7c9-147">例如，完整设置标记可能类似以下形式：</span><span class="sxs-lookup"><span data-stu-id="6c7c9-147">For example, the complete setting tag might look like this:</span></span>  
  
    ```xml  
    <setting name="ConnectionString" serializeAs="String">  
        <value>Server=myServer;Database=myDatabase;Integrated Security=True</value>  
    </setting>  
    ```  
  
3.  <span data-ttu-id="6c7c9-148">在“ConnectionString”设置下，添加“WorkflowTypeExtenders”设置以将标记名称与工作流处理程序程序集关联。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-148">Below the "ConnectionString" setting add a "WorkflowTypeExtenders" setting to associate a tag name with your workflow handler assembly.</span></span> <span data-ttu-id="6c7c9-149">例如：</span><span class="sxs-lookup"><span data-stu-id="6c7c9-149">For example:</span></span>  
  
    ```xml  
    <setting name="WorkflowTypeExtenders" serializeAs="String">  
        <value>TEST=MDSWorkflowTestLib.WorkflowTester, MDSWorkflowTestLib</value>  
    </setting>  
    ```  
  
     <span data-ttu-id="6c7c9-150">标记的内部文本 \<value> 的格式为 \<Workflow tag> = \<assembly-qualified workflow type name> 。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-150">The inner text of the \<value> tag is in the form of \<Workflow tag>=\<assembly-qualified workflow type name>.</span></span> <span data-ttu-id="6c7c9-151">\<Workflow tag>是在中创建业务规则时用于标识工作流处理程序程序集的名称 [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-151">\<Workflow tag> is a name you use to identify the workflow handler assembly when you create a business rule in [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)].</span></span> <span data-ttu-id="6c7c9-152">\<assembly-qualified workflow type name>是工作流类的命名空间限定名称，后跟一个逗号，然后是程序集的显示名称。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-152">\<assembly-qualified workflow type name> is the namespace-qualified name of your workflow class, followed by a comma, followed by the display name of the assembly.</span></span> <span data-ttu-id="6c7c9-153">如果您的程序集采用强名称，则还必须包括版本信息及其 PublicKeyToken。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-153">If your assembly is strongly named, you also have to include version information and its PublicKeyToken.</span></span> <span data-ttu-id="6c7c9-154">\<setting>如果已为不同类型的工作流创建多个工作流处理程序，则可以包含多个标记。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-154">You can include multiple \<setting> tags if you have created multiple workflow handlers for different kinds of workflows.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6c7c9-155">根据服务器的配置，在尝试保存 Microsoft.MasterDataServices.Workflow.exe.config 文件时，可能会显示一条“拒绝访问”错误。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-155">Depending on the configuration of your server, you may see an "Access is denied" error when you try to save the Microsoft.MasterDataServices.Workflow.exe.config file.</span></span> <span data-ttu-id="6c7c9-156">如果发生这种情况，则暂时禁用服务器上的用户帐户控制 (UAC)。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-156">If this occurs, temporarily disable User Account Control (UAC) on the server.</span></span> <span data-ttu-id="6c7c9-157">为此，打开“控制面板”，单击“系统与安全”\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-157">To do this, open Control Panel, click **System and Security**.</span></span> <span data-ttu-id="6c7c9-158">在“操作中心”下，单击“更改用户帐户控制设置”\*\*\*\*\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-158">Under **Action Center**, click **Change User Account Control Settings**.</span></span> <span data-ttu-id="6c7c9-159">在“用户帐户控制设置”对话框中，将滑动条移动到底部以不再接收通知\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-159">In the **User Account Control Settings** dialog, slide the bar to the bottom so that you are never notified.</span></span> <span data-ttu-id="6c7c9-160">重新启动您的计算机，然后重复前面的步骤以编辑您的配置文件。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-160">Restart your computer and repeat the preceding steps to edit your configuration file.</span></span> <span data-ttu-id="6c7c9-161">保存该文件之后，将您的 UAC 设置重置为默认级别。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-161">After saving the file, reset your UAC settings to the default level.</span></span>  
  
### <a name="start-sql-server-mds-workflow-integration-service"></a><span data-ttu-id="6c7c9-162">启动 SQL Server MDS Workflow Integration Service</span><span class="sxs-lookup"><span data-stu-id="6c7c9-162">Start SQL Server MDS Workflow Integration Service</span></span>  
 <span data-ttu-id="6c7c9-163">默认情况下，不安装 SQL Server MDS Workflow Integration Service。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-163">By default, SQL Server MDS Workflow Integration Service is not installed.</span></span> <span data-ttu-id="6c7c9-164">您必须先安装此服务，才能使用它。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-164">You must install the service before it can be used.</span></span> <span data-ttu-id="6c7c9-165">为获得最大安全性，为该服务创建一个本地用户，并仅为该用户授予执行工作流操作所需的权限。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-165">For the greatest security, create a local user for the service and grant this user only the permissions needed to perform workflow operations.</span></span> <span data-ttu-id="6c7c9-166">若要创建用户，请按照以下步骤安装此服务，然后启动该服务：</span><span class="sxs-lookup"><span data-stu-id="6c7c9-166">To create a user, install the service, and start the service, follow these steps:</span></span>  
  
1.  <span data-ttu-id="6c7c9-167">使用“本地用户和组”管理器创建名为（例如，mds_workflow_service）的本地用户。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-167">Use the Local Users and Groups manager to create a local user named, for example, mds_workflow_service.</span></span>  
  
2.  <span data-ttu-id="6c7c9-168">使用 SQL Server Management Studio 向 mds_workflow_service 用户授予执行 [mdm].[udpExternalActionsGet] 存储过程的权限。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-168">Use SQL Server Management Studio to grant the mds_workflow_service user permission to execute the [mdm].[udpExternalActionsGet] stored procedure.</span></span> <span data-ttu-id="6c7c9-169">为此，请为 mds_workflow_service 帐户创建一个新的登录名，并在 [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] 数据库中创建一个新用户，然后将此用户映射为 mds_workflow_service 登录名，为用户授予对 [mdm].[udpExternalActionsGet] 存储过程的 EXECUTE 权限。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-169">To do this, create a new login for the mds_workflow_service account, create a new user in the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database, map this user to the mds_workflow_service login, and grant the user EXECUTE permission to the [mdm].[udpExternalActionsGet] stored procedure.</span></span>  
  
3.  <span data-ttu-id="6c7c9-170">向 mds_workflow_service 用户授予执行工作流处理程序程序集的权限。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-170">Grant the mds_workflow_service user permission to execute the workflow handler assembly.</span></span> <span data-ttu-id="6c7c9-171">为此，将 mds_workflow_service 用户添加到工作流处理程序程序集“属性”的“安全性”选项卡，然后向 mds_workflow_service 用户授予 READ 权限和 EXECUTE 权限\*\*\*\*\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-171">To do this, add the mds_workflow_service user to the **Security** tab of the **Properties** of the workflow handler assembly and grant the mds_workflow_service user READ and EXECUTE permission.</span></span>  
  
4.  <span data-ttu-id="6c7c9-172">向 mds_workflow_service 用户授予执行 SQL Server MDS Workflow Integration Service 可执行文件的权限。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-172">Grant the mds_workflow_service user permission to execute the SQL Server MDS Workflow Integration Service executable.</span></span> <span data-ttu-id="6c7c9-173">为此，请将 mds_workflow_service 用户添加到 Microsoft.MasterDataServices.Workflow.exe 的**属性**的 "**安全**" 选项卡中的 " \<Your installation folder> \Master Data Services\WebApplication\bin"，并向 mds_workflow_service 授予 "读取" 和 "执行" 权限。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-173">To do this, add the mds_workflow_service user to the **Security** tab of the **Properties** of Microsoft.MasterDataServices.Workflow.exe, in \<Your installation folder>\Master Data Services\WebApplication\bin and grant the mds_workflow_service user READ and EXECUTE permission.</span></span>  
  
5.  <span data-ttu-id="6c7c9-174">通过使用 .NET 安装实用工具（名为 InstallUtil.exe）来安装 SQL Server MDS Workflow Integration Service。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-174">Install SQL Server MDS Workflow Integration Service by using the .NET installation utility, named InstallUtil.exe.</span></span> <span data-ttu-id="6c7c9-175">InstallUtil.exe 位于 .NET 安装文件夹中，如 C:\Windows\Microsoft.NET\Framework\v4.0.30319\\。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-175">InstallUtil.exe can be found in the .NET installation folder, such as C:\Windows\Microsoft.NET\Framework\v4.0.30319\\.</span></span> <span data-ttu-id="6c7c9-176">通过在提升的命令提示符中输入以下命令安装 SQL Server MDS Workflow Integration Service：</span><span class="sxs-lookup"><span data-stu-id="6c7c9-176">Install SQL Server MDS Workflow Integration Service by entering the following in an elevated command prompt:</span></span>  
  
    ```  
    C:\Windows\Microsoft.NET\Framework\v4.0.30319\InstallUtil Microsoft.MasterDataServices.Workflow.exe  
    ```  
  
     <span data-ttu-id="6c7c9-177">在安装过程中出现提示时，指定 mds_workflow_service 用户。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-177">Specify the mds_workflow_service user when prompted during installation.</span></span>  
  
6.  <span data-ttu-id="6c7c9-178">通过使用“服务”管理单元来启动 SQL Server MDS Workflow Integration Service。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-178">Start SQL Server MDS Workflow Integration Service by using the Services snap-in.</span></span> <span data-ttu-id="6c7c9-179">为此，在服务管理单元中找到 SQL Server MDS Workflow Integration Service，然后单击“开始”链接\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-179">To do this, find SQL Server MDS Workflow Integration Service in the Services snap-in, select it, and click the  **Start** link.</span></span>  
  
### <a name="create-a-workflow-business-rule"></a><span data-ttu-id="6c7c9-180">创建工作流业务规则</span><span class="sxs-lookup"><span data-stu-id="6c7c9-180">Create a Workflow Business Rule</span></span>  
 <span data-ttu-id="6c7c9-181">在应用时，使用 [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] 来创建和发布将启动工作流的业务规则。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-181">Use [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] to create and publish a business rule that will start the workflow when applied.</span></span> <span data-ttu-id="6c7c9-182">应确保业务规则包含更改属性值的操作，以便该规则应用一次后，其计算结果为 False。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-182">You should ensure that your business rule contains actions that change attribute values, so that the rule evaluates to false after it has been applied once.</span></span> <span data-ttu-id="6c7c9-183">例如，当 Price 属性值大于 500 且 Approved 属性值为空时，您的业务规则可能计算为 True。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-183">For example, your business rule might evaluate to true when a Price attribute value is greater than 500 and the Approved attribute value is blank.</span></span> <span data-ttu-id="6c7c9-184">该规则可能包含两个操作：一个操作是将 Approved 属性值设置为“挂起”，另一个操作是启动工作流。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-184">The rule can then include two actions: one to set the Approved attribute value to Pending and one to start the workflow.</span></span> <span data-ttu-id="6c7c9-185">或者，建议创建一个使用“已更改”条件的规则，并将属性添加到更改跟踪组。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-185">Alternatively, you may want to create a rule that uses the "has changed" condition and add your attributes to change tracking groups.</span></span> <span data-ttu-id="6c7c9-186">有关业务规则的详细信息，请参阅[业务规则 &#40;Master Data Services&#41;](../business-rules-master-data-services.md)。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-186">For more information about business rules, see [Business Rules &#40;Master Data Services&#41;](../business-rules-master-data-services.md).</span></span>  
  
 <span data-ttu-id="6c7c9-187">按照以下步骤在 [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] 中创建用于启动自定义工作流的业务规则：</span><span class="sxs-lookup"><span data-stu-id="6c7c9-187">Create a business rule that starts a custom workflow in [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] by following these steps:</span></span>  
  
1.  <span data-ttu-id="6c7c9-188">在 [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] 的业务规则编辑器中，指定了业务规则条后，将“启动工作流”操作从“外部操作”列表拖动到“THEN”窗格的“操作”标签\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-188">In the business rule editor of [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)], after you have specified the conditions of your business rule, drag the **Start Workflow** action from the **External actions** list to the **THEN** pane's **Action** label.</span></span>  
  
2.  <span data-ttu-id="6c7c9-189">在“编辑操作”窗格中的“工作流类型”框中，键入标识工作流处理程序程序集的标记\*\*\*\*\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-189">In the **Edit Action** pane, in the **Workflow type** box, type the tag that identifies your workflow handler assembly.</span></span> <span data-ttu-id="6c7c9-190">这是您在您的程序集的配置文件中指定的标记，例如 TEST。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-190">This is the tag you specified in the configuration file for your assembly, for example, TEST.</span></span>  
  
3.  <span data-ttu-id="6c7c9-191">或者，选中“包含成员数据”复选框\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-191">Optionally, select the **Include member data** check box.</span></span> <span data-ttu-id="6c7c9-192">选中此复选框可以在 XML 中包括传递到工作流处理程序的的属性名称和值。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-192">Choose this to include attribute names and values in the XML that is passed to the workflow handler.</span></span>  
  
4.  <span data-ttu-id="6c7c9-193">在“工作流站点”框中，键入网站名称\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-193">In the **Workflow site** box, type the name of a website.</span></span> <span data-ttu-id="6c7c9-194">对于您的自定义工作流，此方法不适用，但可用于添加的内容。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-194">For your custom workflow this may not apply, but can be used for added context.</span></span>  
  
5.  <span data-ttu-id="6c7c9-195">在“工作流名称”框中，键入来自 Visual Studio 的工作流名称\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-195">In the **Workflow name** box, type the name of your workflow from Visual Studio.</span></span> <span data-ttu-id="6c7c9-196">对于您的自定义工作流，此方法不适用，但可用于添加的内容。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-196">For your custom workflow this may not apply, but can be used for added context.</span></span>  
  
6.  <span data-ttu-id="6c7c9-197">保存并发布业务规则。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-197">Save and publish the business rule.</span></span>  
  
### <a name="apply-business-rules-to-start-a-workflow"></a><span data-ttu-id="6c7c9-198">应用业务规则以启动工作流</span><span class="sxs-lookup"><span data-stu-id="6c7c9-198">Apply Business Rules to Start a Workflow</span></span>  
 <span data-ttu-id="6c7c9-199">将此业务规则应用于您的数据，以启动工作流。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-199">Apply the business rule to your data to start the workflow.</span></span> <span data-ttu-id="6c7c9-200">为此，使用 [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] 以编辑包含要验证的成员的实体。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-200">To do this, use [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] to edit the entity that contains the members you want to validate.</span></span> <span data-ttu-id="6c7c9-201">单击“应用业务规则”\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-201">Click **Apply business rules**.</span></span> <span data-ttu-id="6c7c9-202">为了响应此业务规则，[!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] 将填充 [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] 数据库的 Service Broker 队列。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-202">In response to the business rule, [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] populates the Service Broker queue of the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database.</span></span> <span data-ttu-id="6c7c9-203">当 SQL Server MDS Workflow Integration Service 检查该队列时，它将数据发送到指定的工作流处理程序程序集并清除该队列。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-203">When SQL Server MDS Workflow Integration Service checks the queue, it sends the data to the specified workflow handler assembly and clears the queue.</span></span> <span data-ttu-id="6c7c9-204">工作流处理程序程序集执行已编码到队列中的任何操作。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-204">The workflow handler assembly performs whatever actions you have coded into it.</span></span>  
  
## <a name="troubleshoot-custom-workflows"></a><span data-ttu-id="6c7c9-205">排除自定义工作流故障</span><span class="sxs-lookup"><span data-stu-id="6c7c9-205">Troubleshoot Custom Workflows</span></span>  
 <span data-ttu-id="6c7c9-206">如果工作流处理程序程序集不接收数据，则可以尝试调试 SQL Server MDS Workflow Integration Service 或查看 Service Broker 队列。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-206">If your workflow handler assembly doesn't receive data, you can try debugging SQL Server MDS Workflow Integration Service or viewing the Service Broker queue.</span></span>  
  
### <a name="debug-sql-server-mds-workflow-integration-service"></a><span data-ttu-id="6c7c9-207">调试 SQL Server MDS Workflow Integration Service</span><span class="sxs-lookup"><span data-stu-id="6c7c9-207">Debug SQL Server MDS Workflow Integration Service</span></span>  
 <span data-ttu-id="6c7c9-208">若要调试 SQL Server Workflow Integration Service，请执行以下步骤：</span><span class="sxs-lookup"><span data-stu-id="6c7c9-208">To debug SQL Server Workflow Integration Service, take the following steps:</span></span>  
  
1.  <span data-ttu-id="6c7c9-209">使用“服务”管理单元以停止服务。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-209">Use the Services snap-in to stop the service.</span></span>  
  
2.  <span data-ttu-id="6c7c9-210">打开命令提示符，导航到此服务的位置，通过输入 Microsoft.MasterDataServices.Workflow.exe -console 在控制台中运行此服务。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-210">Open a command prompt, navigate to the location of the service, and run the service in console mode by entering: Microsoft.MasterDataServices.Workflow.exe -console.</span></span>  
  
3.  <span data-ttu-id="6c7c9-211">在 [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] 中，更新您的成员，并再次应用业务规则。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-211">In [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)], update your member and apply business rules again.</span></span> <span data-ttu-id="6c7c9-212">控制台窗口中将显示详细日志。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-212">Detailed logs are displayed in the console window.</span></span>  
  
### <a name="view-the-service-broker-queue"></a><span data-ttu-id="6c7c9-213">查看 Service Broker 队列</span><span class="sxs-lookup"><span data-stu-id="6c7c9-213">View the Service Broker Queue</span></span>  
 <span data-ttu-id="6c7c9-214">包含作为工作流一部分传递的主数据的 Service Broker 队列为：mdm.microsoft/mdm/queue/externalaction。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-214">The Service Broker queue that contains the master data passed as part of the workflow is: mdm.microsoft/mdm/queue/externalaction.</span></span> <span data-ttu-id="6c7c9-215">队列位于 [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] 数据库的 Service Broker 节点下的 SQL Management Studio 的“对象资源管理器”中\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-215">Queues can be found in the **Object Explorer** of SQL Management Studio under the Service Broker node of the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database.</span></span> <span data-ttu-id="6c7c9-216">请注意，如果此服务已正确清除队列，则此队列将为空。</span><span class="sxs-lookup"><span data-stu-id="6c7c9-216">Be aware that, if the service cleared the queue properly, this queue will be empty.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="6c7c9-217">另请参阅</span><span class="sxs-lookup"><span data-stu-id="6c7c9-217">See Also</span></span>  
 <span data-ttu-id="6c7c9-218">[&#40;Master Data Services 的自定义工作流示例&#41;](create-a-custom-workflow-example.md) </span><span class="sxs-lookup"><span data-stu-id="6c7c9-218">[Custom Workflow Example &#40;Master Data Services&#41;](create-a-custom-workflow-example.md) </span></span>  
 [<span data-ttu-id="6c7c9-219">自定义工作流 XML 说明 &#40;Master Data Services&#41;</span><span class="sxs-lookup"><span data-stu-id="6c7c9-219">Custom Workflow XML Description &#40;Master Data Services&#41;</span></span>](create-a-custom-workflow-xml-description.md)  
  
  
