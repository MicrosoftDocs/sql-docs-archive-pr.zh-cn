---
title: 使用包中的变量 |Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
helpviewer_keywords:
- user-defined variables [Integration Services]
- variables [Integration Services], use scenarios
- system variables [Integration Services]
ms.assetid: 7742e92d-46c5-4cc4-b9a3-45b688ddb787
author: chugugrace
ms.author: chugu
ms.openlocfilehash: acfb6813406bd3a143712e40ec510a4658d4e5da
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87578932"
---
# <a name="use-variables-in-packages"></a><span data-ttu-id="0fd0c-102">在包中使用变量</span><span class="sxs-lookup"><span data-stu-id="0fd0c-102">Use Variables in Packages</span></span>
  <span data-ttu-id="0fd0c-103">变量是对 [!INCLUDE[ssISnoversion](../includes/ssisnoversion-md.md)] 包的有效补充，而且使用非常灵活。它们可以在包中的对象之间以及父包和子包之间提供通信。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-103">Variables are a useful and flexible addition to [!INCLUDE[ssISnoversion](../includes/ssisnoversion-md.md)] packages; they can provide communication among objects in the package, and between parent and child packages.</span></span> <span data-ttu-id="0fd0c-104">变量还可以用在表达式和脚本中。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-104">Variables can also be used in expressions and scripts.</span></span>  
  
## <a name="user-defined-variables-and-system-variables"></a><span data-ttu-id="0fd0c-105">用户定义的变量和系统变量</span><span class="sxs-lookup"><span data-stu-id="0fd0c-105">User-Defined Variables and System Variables</span></span>  
 [!INCLUDE[ssISnoversion](../includes/ssisnoversion-md.md)] <span data-ttu-id="0fd0c-106">提供系统变量，而且支持用户定义的变量。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-106">provides system variables and supports user-defined variables.</span></span> <span data-ttu-id="0fd0c-107">在创建新包时，可以将容器或任务添加到包中，也可以创建事件处理程序， [!INCLUDE[ssISnoversion](../includes/ssisnoversion-md.md)] 包括一组可用于容器的系统变量。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-107">When you create a new package, add a container or a task to a package, or create an event handler, [!INCLUDE[ssISnoversion](../includes/ssisnoversion-md.md)] includes a set of system variables for the container.</span></span> <span data-ttu-id="0fd0c-108">系统变量包含有关包、容器、任务或事件处理程序的非常有用的信息。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-108">System variables contain useful information about a package, container, task, or event handler.</span></span> <span data-ttu-id="0fd0c-109">例如，在运行时， **MachineName** 系统变量包含运行包的计算机的名称， **StartTime** 变量包含包开始运行的时间。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-109">For example, at run time the **MachineName** system variable contains the name of the computer on which the package is running and **StartTime** the time the package started to run.</span></span> <span data-ttu-id="0fd0c-110">系统变量是只读的。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-110">System variables are read-only.</span></span> <span data-ttu-id="0fd0c-111">有关详细信息，请参阅 [System Variables](system-variables.md)。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-111">For more information, see [System Variables](system-variables.md).</span></span>  
  
 <span data-ttu-id="0fd0c-112">您可以创建用户定义的变量，然后在包中使用这些变量。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-112">You can create user-defined variables and then use them in packages.</span></span> <span data-ttu-id="0fd0c-113">在 [!INCLUDE[ssIS](../includes/ssis-md.md)]中，可以通过很多方式使用用户定义的变量：在脚本中；在由优先约束、For 循环容器、派生列转换和有条件拆分转换使用的表达式中；以及在更新属性值的属性表达式中。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-113">User-defined variables can be used in many ways in [!INCLUDE[ssIS](../includes/ssis-md.md)]: in scripts; in the expressions used by precedence constraints, the For Loop container, the Derived Column transformation, and the Conditional Split transformation; and in the property expressions that update property values.</span></span>  
  
 <span data-ttu-id="0fd0c-114">例如，您可以在 For 循环容器的求值条件中使用用户定义的变量。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-114">For example, you can use a user-defined variable in the evaluation condition for the For Loop container.</span></span> <span data-ttu-id="0fd0c-115">您还可以将 Foreach 循环容器中的枚举器集合值映射为变量，如果执行 SQL 任务使用参数化的 SQL 语句，您可以将语句的参数映射为变量。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-115">You can also map the enumerator collection value in a Foreach Loop container to a variable, and if an Execute SQL task uses a parameterized SQL statement, you can map the parameters for the statement to variables.</span></span> <span data-ttu-id="0fd0c-116">有关详细信息，请参阅 [Integration Services (SSIS) 变量](integration-services-ssis-variables.md)。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-116">For more information, see [Integration Services &#40;SSIS&#41; Variables](integration-services-ssis-variables.md).</span></span>  
  
## <a name="variables-usage-scenarios"></a><span data-ttu-id="0fd0c-117">变量使用方案</span><span class="sxs-lookup"><span data-stu-id="0fd0c-117">Variables Usage Scenarios</span></span>  
 <span data-ttu-id="0fd0c-118">变量在 [!INCLUDE[ssISnoversion](../includes/ssisnoversion-md.md)] 包中有多种不同的使用方式。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-118">Variables are used in many different ways in [!INCLUDE[ssISnoversion](../includes/ssisnoversion-md.md)] packages.</span></span> <span data-ttu-id="0fd0c-119">您会发现，如果不向包中添加用户定义的变量以实现解决方案所要求的灵活性和可管理性，包的开发将无法进行下去。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-119">You will probably find that package development does not progress far before you have to add a user-defined variable to your package to implement the flexibility and manageability your solution requires.</span></span> <span data-ttu-id="0fd0c-120">根据方案的不同，通常还会用到系统变量。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-120">Depending on the scenario, system variables are also commonly used.</span></span>  
  
 <span data-ttu-id="0fd0c-121">**属性表达式** ：在设置包和包对象属性的属性表达式中使用变量来提供值。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-121">**Property Expressions** Use variables to provide values in the property expressions that set the properties of packages and package objects.</span></span> <span data-ttu-id="0fd0c-122">例如，表达式 `SELECT * FROM @varTableName` 中包含变量 `varTableName` ，该变量可更新“执行 SQL 任务”所运行的 SQL 语句。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-122">For example, the expression, `SELECT * FROM @varTableName` includes the variable `varTableName` that updates the SQL statement that an Execute SQL task runs.</span></span> <span data-ttu-id="0fd0c-123">表达式 `DATEPART("d", GETDATE()) == 1? @[User::varPackageFirst]:@[User::varPackageOther]`" 通过在月份的第一天运行 `varPackageFirst` 变量指定的包而在其他天中运行 `varPackageOther` 变量指定的包，来更新“执行包”任务所运行的包。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-123">The expression, `DATEPART("d", GETDATE()) == 1? @[User::varPackageFirst]:@[User::varPackageOther]`", updates the package that the Execute Package task runs, by running the package specified in the `varPackageFirst` variable on the first day of the month and running the package specified in the `varPackageOther` variable on other days.</span></span> <span data-ttu-id="0fd0c-124">有关详细信息，请参阅 [在包中使用属性表达式](expressions/use-property-expressions-in-packages.md)。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-124">For more information, see [Use Property Expressions in Packages](expressions/use-property-expressions-in-packages.md).</span></span>  
  
 <span data-ttu-id="0fd0c-125">**数据流表达式** ：在派生列转换和有条件拆分转换用于填充列的表达式中使用变量来提供值，或将数据行定向到不同的转换输出中。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-125">**Data Flow Expressions** Use variables to provide values in the expressions that the Derived Column and Conditional Split transformations use to populate columns, or to direct data rows to different transformation outputs.</span></span> <span data-ttu-id="0fd0c-126">例如，表达式 `@varSalutation + LastName`连接 `VarSalutation` 变量和 `LastName` 列中的值。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-126">For example, the expression, `@varSalutation + LastName`, concatenates the value in the `VarSalutation` variable and the `LastName` column.</span></span> <span data-ttu-id="0fd0c-127">表达式 `Income < @HighIncome`将 `Income` 列值小于 `HighIncome` 变量值的数据行定向到一个输出。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-127">The expression, `Income < @HighIncome`, directs data rows in which the value of the `Income` column is less than the value in the `HighIncome` variable to an output.</span></span> <span data-ttu-id="0fd0c-128">有关详细信息，请参阅 [派生列转换](data-flow/transformations/derived-column-transformation.md)、[有条件拆分转换](data-flow/transformations/conditional-split-transformation.md)和 [Integration Services (SSIS) 表达式](expressions/integration-services-ssis-expressions.md)。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-128">For more information, see [Derived Column Transformation](data-flow/transformations/derived-column-transformation.md), [Conditional Split Transformation](data-flow/transformations/conditional-split-transformation.md), and [Integration Services &#40;SSIS&#41; Expressions](expressions/integration-services-ssis-expressions.md).</span></span>  
  
 <span data-ttu-id="0fd0c-129">**优先约束表达式** ：提供要在优先约束中用来确定受约束的可执行文件是否运行的值。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-129">**Precedence Constraint Expressions** Provide values to use in precedence constraints to determine whether a constrained executable runs.</span></span> <span data-ttu-id="0fd0c-130">这些表达式可以和执行结果（成功、失败、完成）一起使用，也可代替执行结果。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-130">The expressions can be used either together with an execution outcome (success, failure, completion), or instead of an execution outcome.</span></span> <span data-ttu-id="0fd0c-131">例如，如果表达式 `@varMax > @varMin` 的计算结果为 `true`，则运行可执行文件。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-131">For example, if the expression, `@varMax > @varMin`, evaluates to `true`, the executable runs.</span></span> <span data-ttu-id="0fd0c-132">有关详细信息，请参阅 [将表达式添加到优先约束](control-flow/precedence-constraints.md)。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-132">For more information, see [Add Expressions to Precedence Constraints](control-flow/precedence-constraints.md).</span></span>  
  
 <span data-ttu-id="0fd0c-133">**参数和返回代码** ：为输入参数提供值，或存储输出参数和返回代码的值。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-133">**Parameters and Return Codes** Provide values to input parameters, or store the values of output parameters and return codes.</span></span> <span data-ttu-id="0fd0c-134">可通过将变量映射到参数和返回值来执行上述操作。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-134">You do this by mapping the variables to parameters and return values.</span></span> <span data-ttu-id="0fd0c-135">例如，如果将变量 `varProductId` 设置为 23 并运行 SQL 语句 `SELECT * from Production.Product WHERE ProductID = ?`，查询将检索 `ProductID` 为 23 的产品。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-135">For example, if you set the variable `varProductId` to 23 and run the SQL statement, `SELECT * from Production.Product WHERE ProductID = ?`, the query retrieves the product with a `ProductID` of 23.</span></span> <span data-ttu-id="0fd0c-136">有关详细信息，请参阅 [执行 SQL 任务](control-flow/execute-sql-task.md) 和 [执行 SQL 任务中的参数和返回代码](../../2014/integration-services/parameters-and-return-codes-in-the-execute-sql-task.md)。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-136">For more information, see [Execute SQL Task](control-flow/execute-sql-task.md) and [Parameters and Return Codes in the Execute SQL Task](../../2014/integration-services/parameters-and-return-codes-in-the-execute-sql-task.md).</span></span>  
  
 <span data-ttu-id="0fd0c-137">**For 循环表达式** ：提供要在 FOR 循环的初始化表达式、求值表达式和赋值表达式中使用的值。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-137">**For Loop Expressions** Provide values to use in the initialization, evaluation, and assignment expressions of the For Loop.</span></span> <span data-ttu-id="0fd0c-138">例如，如果变量 `varCount` 为 2， `varMaxCount` 为 10，初始化表达式为 `@varCount`，求值表达式为  `@varCount < @varMaxCount`，赋值表达式为 `@varCount =@varCount +1`，则循环将重复 8 次。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-138">For example, if the variable `varCount` is 2 and `varMaxCount` is 10, the initialization expression is `@varCount`, the evaluation expression is  `@varCount < @varMaxCount`, and the assignment expression is `@varCount =@varCount +1`, then the loop repeats 8 times.</span></span> <span data-ttu-id="0fd0c-139">有关详细信息，请参阅 [For 循环容器](control-flow/for-loop-container.md)。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-139">For more information, see [For Loop Container](control-flow/for-loop-container.md).</span></span>  
  
 <span data-ttu-id="0fd0c-140">**父包变量配置** ：将值由父包传递给子包。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-140">**Parent Package Variable Configurations** Pass values from parent packages to child packages.</span></span> <span data-ttu-id="0fd0c-141">子包可通过使用父包变量配置来访问父包中的变量。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-141">Child packages can access variables in the parent package by using parent package variable configurations.</span></span> <span data-ttu-id="0fd0c-142">例如，如果子包必须与父包使用相同日期，则子包可以定义一个父包变量配置，该配置将指定 GETDATE 函数在父包中设置的变量。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-142">For example, if the child package must use the same date as the parent package, the child package can define a parent package variable configuration that specifies a variable set by the GETDATE function in the parent package.</span></span> <span data-ttu-id="0fd0c-143">有关详细信息，请参阅 [Execute Package Task](control-flow/execute-package-task.md) 和 [Package Configurations](../../2014/integration-services/package-configurations.md)。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-143">For more information, see [Execute Package Task](control-flow/execute-package-task.md) and [Package Configurations](../../2014/integration-services/package-configurations.md).</span></span>  
  
 <span data-ttu-id="0fd0c-144">**脚本任务和脚本组件** 为脚本任务或脚本组件提供只读和可读/写变量的列表，在脚本内更新读/写变量，然后在该脚本内或该脚本外使用更新的值。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-144">**Script Task and Script Component** Provide a list of read-only and read/write variable to the Script task or Script component, update the read/write variables within the script, and then use the updated values in or outside the script.</span></span> <span data-ttu-id="0fd0c-145">例如，在代码 `numberOfCars = CType(Dts.Variables("NumberOfCars").Value, Integer)`中，脚本变量 `numberOfCars` 由 `NumberOfCars`变量中的值更新。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-145">For example, in the code, `numberOfCars = CType(Dts.Variables("NumberOfCars").Value, Integer)`, the script variable `numberOfCars` is updated by the value in the variable, `NumberOfCars`.</span></span> <span data-ttu-id="0fd0c-146">有关详细信息，请参阅 [Using Variables in the Script Task](control-flow/script-task.md)。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-146">For more information, see [Using Variables in the Script Task](control-flow/script-task.md).</span></span>  
  
## <a name="configurations-and-variables"></a><span data-ttu-id="0fd0c-147">配置和变量</span><span class="sxs-lookup"><span data-stu-id="0fd0c-147">Configurations and Variables</span></span>  
 <span data-ttu-id="0fd0c-148">若要动态更新变量，可以为变量创建配置，将这些配置部署到包中，然后在部署包时更新配置文件中的变量值。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-148">To dynamically update variables, you can create configurations for the variables, deploy the configurations with the package, and then update the variable values in the configuration file when you deploy the packages.</span></span> <span data-ttu-id="0fd0c-149">在运行时，包使用更新后的变量值。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-149">At run time, the package uses the updated variable values.</span></span> <span data-ttu-id="0fd0c-150">有关详细信息，请参阅 [创建包配置](../../2014/integration-services/create-package-configurations.md)。</span><span class="sxs-lookup"><span data-stu-id="0fd0c-150">For more information, see [Create Package Configurations](../../2014/integration-services/create-package-configurations.md).</span></span>  
  
### <a name="to-add-modify-and-delete-user-defined-variables"></a><span data-ttu-id="0fd0c-151">添加、修改和删除用户定义的变量</span><span class="sxs-lookup"><span data-stu-id="0fd0c-151">To add, modify, and delete user-defined variables</span></span>  
  
-   [<span data-ttu-id="0fd0c-152">添加、删除、更改包中用户定义变量的作用域</span><span class="sxs-lookup"><span data-stu-id="0fd0c-152">Add, Delete, Change Scope of User-Defined Variable in a Package</span></span>](../../2014/integration-services/add-delete-change-scope-of-user-defined-variable-in-a-package.md)  
  
-   [<span data-ttu-id="0fd0c-153">设置用户定义变量的属性</span><span class="sxs-lookup"><span data-stu-id="0fd0c-153">Set the Properties of a User-Defined Variable</span></span>](../../2014/integration-services/set-the-properties-of-a-user-defined-variable.md)  
  
  
