---
title: 在包中使用属性表达式 | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
helpviewer_keywords:
- packages [Integration Services], expressions
- Integration Services packages, expressions
- SQL Server Integration Services packages, expressions
- dynamic properties
- updating package properties
- SSIS packages, expressions
- expressions [Integration Services], property expressions
- property expressions [Integration Services]
ms.assetid: a4bfc925-3ef6-431e-b1dd-7e0023d3a92d
author: chugugrace
ms.author: chugu
ms.openlocfilehash: bb373428e91cfc8cb4b26a986da6d795ab2fea98
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87589201"
---
# <a name="use-property-expressions-in-packages"></a><span data-ttu-id="61ddf-102">在包中使用属性表达式</span><span class="sxs-lookup"><span data-stu-id="61ddf-102">Use Property Expressions in Packages</span></span>
  <span data-ttu-id="61ddf-103">属性表达式是分配给属性以便能够在运行时对该属性进行动态更新的表达式。</span><span class="sxs-lookup"><span data-stu-id="61ddf-103">A property expression is an expression that is assigned to a property to enable dynamic update of the property at run time.</span></span> <span data-ttu-id="61ddf-104">例如，属性表达式可以通过插入存储在变量中的电子邮件地址来更新发送邮件任务所使用的“收件人”行。</span><span class="sxs-lookup"><span data-stu-id="61ddf-104">For example, a property expression can update the To line that a Send Mail task uses by inserting an e-mail address that is stored in a variable.</span></span>

 <span data-ttu-id="61ddf-105">表达式可以添加到包、任务、Foreach 循环、For 循环、序列、Foreach 枚举器、事件处理程序、包或项目级别连接管理器，或添加到日志提供程序。</span><span class="sxs-lookup"><span data-stu-id="61ddf-105">An expression can be added to a package, task, Foreach Loop, For Loop, Sequence, Foreach enumerator, event handler, a package or project level connection manager, or log provider.</span></span> <span data-ttu-id="61ddf-106">这些对象的任何读/写属性都可以实现属性表达式。</span><span class="sxs-lookup"><span data-stu-id="61ddf-106">Any property of these objects that is read/write can implement a property expression.</span></span> [!INCLUDE[ssISnoversion](../../../includes/ssisnoversion-md.md)] <span data-ttu-id="61ddf-107">还支持在数据流组件的某些自定义属性中使用属性表达式。</span><span class="sxs-lookup"><span data-stu-id="61ddf-107">also supports the use of property expressions in some custom properties of data flow components.</span></span> <span data-ttu-id="61ddf-108">变量和优先约束不支持属性表达式，但它们包含可以使用表达式的特殊属性。</span><span class="sxs-lookup"><span data-stu-id="61ddf-108">Variables and precedence constraints do not support property expressions, but they include special properties in which you can use expressions.</span></span>

 <span data-ttu-id="61ddf-109">属性表达式可以通过不同的方式进行更新：</span><span class="sxs-lookup"><span data-stu-id="61ddf-109">Property expressions can be updated in different ways:</span></span>

-   <span data-ttu-id="61ddf-110">用户定义的变量可以包括在包配置中，在部署包时可以更新这些变量。</span><span class="sxs-lookup"><span data-stu-id="61ddf-110">User-defined variables can be included in package configurations and then updated when the package is deployed.</span></span> <span data-ttu-id="61ddf-111">在运行时，使用更新后的变量值计算属性表达式。</span><span class="sxs-lookup"><span data-stu-id="61ddf-111">At run time, the property expression is evaluated using the updated variable value.</span></span>

-   <span data-ttu-id="61ddf-112">表达式中包含的系统变量在运行时更新，这样可以更改属性求值的结果。</span><span class="sxs-lookup"><span data-stu-id="61ddf-112">System variables that are included in expressions are updated at run time, which changes the results of the property evaluation.</span></span>

-   <span data-ttu-id="61ddf-113">日期和时间函数在运行时计算，并将更新后的值提供给属性表达式。</span><span class="sxs-lookup"><span data-stu-id="61ddf-113">Date and time functions are evaluated at run time and provide the updated values to property expressions.</span></span>

-   <span data-ttu-id="61ddf-114">表达式中的变量可以由脚本任务和脚本组件运行的脚本进行更新。</span><span class="sxs-lookup"><span data-stu-id="61ddf-114">Variables in expressions can be updated by the scripts that the Script task and the Script component run.</span></span>

 <span data-ttu-id="61ddf-115">表达式是使用 [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssISnoversion](../../../includes/ssisnoversion-md.md)] 表达式语言生成的。</span><span class="sxs-lookup"><span data-stu-id="61ddf-115">The expressions are built using the [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssISnoversion](../../../includes/ssisnoversion-md.md)] expression language.</span></span> <span data-ttu-id="61ddf-116">表达式可以使用系统变量或用户定义的变量以及表达式语言提供的运算符、函数和类型转换。</span><span class="sxs-lookup"><span data-stu-id="61ddf-116">The expressions can use system or user-defined variables, together with the operators, functions, and type casts that the expression language provides.</span></span>

> [!NOTE]
>  <span data-ttu-id="61ddf-117">用户定义的变量名和系统变量名区分大小写。</span><span class="sxs-lookup"><span data-stu-id="61ddf-117">The names of user-defined and system variables are case-sensitive.</span></span>

 <span data-ttu-id="61ddf-118">有关详细信息，请参阅 [Integration Services (SSIS) 表达式](integration-services-ssis-expressions.md)。</span><span class="sxs-lookup"><span data-stu-id="61ddf-118">For more information, see [Integration Services &#40;SSIS&#41; Expressions](integration-services-ssis-expressions.md).</span></span>

 <span data-ttu-id="61ddf-119">属性表达式的一个重要用途是为包的每个已部署的实例自定义配置。</span><span class="sxs-lookup"><span data-stu-id="61ddf-119">An important use of property expressions is to customize configurations for each deployed instance of a package.</span></span> <span data-ttu-id="61ddf-120">这使得可以动态更新不同环境的包属性。</span><span class="sxs-lookup"><span data-stu-id="61ddf-120">This makes it possible to dynamically update package properties for different environments.</span></span> <span data-ttu-id="61ddf-121">例如，您可以创建将变量分配给连接管理器的连接字符串的属性表达式，然后在部署包时更新该变量，从而确保了在运行时连接字符串是正确的。</span><span class="sxs-lookup"><span data-stu-id="61ddf-121">For example, you can create a property expression that assigns a variable to the connection string of a connection manager, and then update the variable when the package is deployed, ensuring that the connection string is correct at run time.</span></span> <span data-ttu-id="61ddf-122">在计算属性表达式之前加载包配置。</span><span class="sxs-lookup"><span data-stu-id="61ddf-122">Package configurations are loaded before the property expressions are evaluated.</span></span>

 <span data-ttu-id="61ddf-123">一个属性只能使用一个属性表达式，一个属性表达式只能应用于一个属性。</span><span class="sxs-lookup"><span data-stu-id="61ddf-123">A property can use only one property expression and a property expression can apply only to one property.</span></span> <span data-ttu-id="61ddf-124">但是，您可以生成多个相同的属性表达式，并将它们分配给不同的属性。</span><span class="sxs-lookup"><span data-stu-id="61ddf-124">However, you can build multiple identical property expressions and assign them to different properties.</span></span>

 <span data-ttu-id="61ddf-125">某些属性是通过使用来自枚举器的值来设置的。</span><span class="sxs-lookup"><span data-stu-id="61ddf-125">Some properties are set by using values from enumerators.</span></span> <span data-ttu-id="61ddf-126">在属性表达式中引用枚举器成员时，必须使用与枚举器成员的友好名称等价的数值。</span><span class="sxs-lookup"><span data-stu-id="61ddf-126">When you reference the enumerator member in a property expression, you must use the numeric value that is equivalent to the friendly name of the enumerator member.</span></span> <span data-ttu-id="61ddf-127">例如，如果属性表达式设置 `LoggingMode` 属性，而该属性使用来自 `DTSLoggingMode` 枚举的值，则属性表达式必须使用 0、1 或 2 而不是友好名称 `Enabled`、`Disabled` 或 `UseParentSetting`。</span><span class="sxs-lookup"><span data-stu-id="61ddf-127">For example, if a property expression sets the `LoggingMode` property, which uses a value from the `DTSLoggingMode` enumeration, the property expression must use 0, 1, or 2 instead of the friendly names `Enabled`, `Disabled`, or `UseParentSetting`.</span></span> <span data-ttu-id="61ddf-128">有关详细信息，请参阅 [属性表达式中的枚举常量](enumerated-constants-in-property-expressions.md)。</span><span class="sxs-lookup"><span data-stu-id="61ddf-128">For more information, see [Enumerated Constants in Property Expressions](enumerated-constants-in-property-expressions.md).</span></span>

## <a name="property-expression-user-interface"></a><span data-ttu-id="61ddf-129">属性表达式用户界面</span><span class="sxs-lookup"><span data-stu-id="61ddf-129">Property Expression User Interface</span></span>
 [!INCLUDE[ssISnoversion](../../../includes/ssisnoversion-md.md)] <span data-ttu-id="61ddf-130">提供了一组用于生成和管理属性表达式的工具。</span><span class="sxs-lookup"><span data-stu-id="61ddf-130">provides a set of tools for building and managing property expressions.</span></span>

-   <span data-ttu-id="61ddf-131">**“表达式”** 页，在任务、For 循环容器和 Foreach 容器的自定义编辑器中提供。</span><span class="sxs-lookup"><span data-stu-id="61ddf-131">The **Expressions** page, found in the custom editors for tasks, the For Loop container, and the Foreach containers.</span></span> <span data-ttu-id="61ddf-132">利用 **“表达式”** 页可以编辑表达式，查看任务、Foreach 循环或 For 循环所使用的属性表达式的列表。</span><span class="sxs-lookup"><span data-stu-id="61ddf-132">The **Expressions** page lets you edit expressions and view a list of the property expressions that a task, Foreach Loop, or For Loop uses.</span></span>

-   <span data-ttu-id="61ddf-133">**“属性”** 窗口，用于编辑表达式和查看包或包对象所使用的属性表达式的列表。</span><span class="sxs-lookup"><span data-stu-id="61ddf-133">The **Properties** window, for editing expressions and viewing a list of the property expressions that a package or package objects use.</span></span>

-   <span data-ttu-id="61ddf-134">**“属性表达式编辑器”** 对话框，用于创建、更新和删除属性表达式。</span><span class="sxs-lookup"><span data-stu-id="61ddf-134">The **Property Expressions Editor** dialog box, for creating, updating, and deleting property expressions.</span></span>

-   <span data-ttu-id="61ddf-135">**“表达式生成器”** 对话框，用于使用图形工具生成表达式。</span><span class="sxs-lookup"><span data-stu-id="61ddf-135">The **Expression Builder** dialog box, for building an expression using graphical tools.</span></span> <span data-ttu-id="61ddf-136">**“表达式生成器”** 对话框可以计算表达式，以便于您查看，而不将计算结果分配给属性。</span><span class="sxs-lookup"><span data-stu-id="61ddf-136">The **Expression Builder** dialog box can evaluate expressions for your review without assigning the evaluation result to the property.</span></span>

 <span data-ttu-id="61ddf-137">以下关系图显示了用来添加、更改和删除属性表达式的用户界面。</span><span class="sxs-lookup"><span data-stu-id="61ddf-137">The following diagram shows the user interfaces that you use to add, change, and remove property expressions.</span></span>

 <span data-ttu-id="61ddf-138">![属性表达式的用户界面](../media/ssis-propertyexpressionui.gif "属性表达式的用户界面")</span><span class="sxs-lookup"><span data-stu-id="61ddf-138">![The user interface for property expressions](../media/ssis-propertyexpressionui.gif "The user interface for property expressions")</span></span>

 <span data-ttu-id="61ddf-139">在“属性”窗口和“表达式”页中，单击“表达式”集合级别中的浏览按钮“(…)”，以打开“属性表达式编辑器”对话框      。</span><span class="sxs-lookup"><span data-stu-id="61ddf-139">In the **Properties** window and the **Expressions** page, click the browse button **(...)** at the **Expressions** collection level to open the **Property Expressions Editor** dialog box.</span></span> <span data-ttu-id="61ddf-140">属性表达式编辑器允许将属性映射到表达式，也允许键入属性表达式。</span><span class="sxs-lookup"><span data-stu-id="61ddf-140">The Property Expressions Editor allows you to map a property to an expression and to type a property expression.</span></span> <span data-ttu-id="61ddf-141">如果希望使用图形表达式工具来创建表达式，然后对其进行验证，请在表达式级别单击浏览按钮 (…) 以打开“表达式生成器”对话框，然后进行创建或修改，并（可选）验证表达式。  </span><span class="sxs-lookup"><span data-stu-id="61ddf-141">If you want to use the graphical expression tools to create and then validate the expression, click the browse button **(...)** at the expression level to open the **Expression Builder** dialog box, and then create or modify and optionally validate the expression.</span></span>

 <span data-ttu-id="61ddf-142">还可以从 **“属性表达式编辑器”** 对话框打开 **“表达式生成器”** 对话框。</span><span class="sxs-lookup"><span data-stu-id="61ddf-142">You can also open the **Expression Builder** dialog box from the **Property Expressions Editor** dialog box.</span></span>

#### <a name="to-work-with-property-expressions"></a><span data-ttu-id="61ddf-143">使用属性表达式</span><span class="sxs-lookup"><span data-stu-id="61ddf-143">To work with property expressions</span></span>

-   [<span data-ttu-id="61ddf-144">添加或更改属性表达式</span><span class="sxs-lookup"><span data-stu-id="61ddf-144">Add or Change a Property Expression</span></span>](add-or-change-a-property-expression.md)

### <a name="setting-property-expressions-of-data-flow-components"></a><span data-ttu-id="61ddf-145">设置数据流组件的属性表达式</span><span class="sxs-lookup"><span data-stu-id="61ddf-145">Setting Property Expressions of Data Flow Components</span></span>
 <span data-ttu-id="61ddf-146">如果在 [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)]中构造包，则支持属性表达式的数据流组件的属性将显示在它们所属的“数据流”任务上。</span><span class="sxs-lookup"><span data-stu-id="61ddf-146">If you construct a package in [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)], the properties of data flow components that support property expressions are exposed on the Data Flow task to which they belong.</span></span> <span data-ttu-id="61ddf-147">若要添加、更改和删除数据流组件的属性表达式，请右键单击数据流组件所属的数据流的“数据流”任务，并单击“属性”。 </span><span class="sxs-lookup"><span data-stu-id="61ddf-147">To add, change, and remove the property expressions of data flow components, you right-click the Data Flow task for the data flow to which the data flow components belong and click **Properties**.</span></span> <span data-ttu-id="61ddf-148">“属性”窗口将列出可以对其使用属性表达式的数据流组件的属性。</span><span class="sxs-lookup"><span data-stu-id="61ddf-148">The Properties window lists the properties of data flow components with which you can use property expressions.</span></span> <span data-ttu-id="61ddf-149">例如，若要在名为 SampleCustomer 的数据流中创建或修改“行抽样”转换的 SamplingValue 属性的属性表达式，请右键单击“行抽样”转换所属的数据流的“数据流”任务，然后单击“属性”。 </span><span class="sxs-lookup"><span data-stu-id="61ddf-149">For example, to create or modify a property expression for the SamplingValue property of a Row Sampling transformation in a data flow named SampleCustomer, right-click the Data Flow task for the data flow to which the Row Sampling transformation belongs and click **Properties**.</span></span> <span data-ttu-id="61ddf-150">SamplingValue 属性将在“属性”窗口中列出，其格式为 [SampleCustomer].[SamplingValue]。</span><span class="sxs-lookup"><span data-stu-id="61ddf-150">The SamplingValue property is listed in the Properties window, and has the format [SampleCustomer].[SamplingValue].</span></span>

 <span data-ttu-id="61ddf-151">在“属性”窗口中，可以添加、更改和删除数据流组件的属性表达式，具体方式与对其他 [!INCLUDE[ssISnoversion](../../../includes/ssisnoversion-md.md)] 对象类型执行属性表达式操作时相同。</span><span class="sxs-lookup"><span data-stu-id="61ddf-151">In the Properties window, you add, change, and remove property expressions for data flow components in the same way as property expressions for other [!INCLUDE[ssISnoversion](../../../includes/ssisnoversion-md.md)] object types.</span></span> <span data-ttu-id="61ddf-152">通过“属性”窗口，还可以访问用于添加、更改或删除数据流组件的属性表达式的各种对话框和生成器。</span><span class="sxs-lookup"><span data-stu-id="61ddf-152">The Properties window also provides access to the various dialog boxes and builders that you use to add, change, or remove property expressions for data flow components.</span></span> <span data-ttu-id="61ddf-153">有关可以用属性表达式更新的数据流组件属性的详细信息，请参阅 [Transformation Custom Properties](../data-flow/transformations/transformation-custom-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="61ddf-153">For more information about the properties of data flow components that can be updated by property expressions, see [Transformation Custom Properties](../data-flow/transformations/transformation-custom-properties.md).</span></span>

## <a name="loading-property-expressions"></a><span data-ttu-id="61ddf-154">加载属性表达式</span><span class="sxs-lookup"><span data-stu-id="61ddf-154">Loading Property Expressions</span></span>
 <span data-ttu-id="61ddf-155">无法指定或控制何时加载属性表达式。</span><span class="sxs-lookup"><span data-stu-id="61ddf-155">You cannot specify or control when property expressions are loaded.</span></span> <span data-ttu-id="61ddf-156">属性表达式将在包和包对象通过验证后被计算并加载。</span><span class="sxs-lookup"><span data-stu-id="61ddf-156">The property expressions are evaluated and loaded when the package and the package objects are validated.</span></span> <span data-ttu-id="61ddf-157">保存包、在 [!INCLUDE[ssIS](../../../includes/ssis-md.md)] 设计器中打开包以及运行包时，将发生验证。</span><span class="sxs-lookup"><span data-stu-id="61ddf-157">Validation occurs when you save the package, open the package in [!INCLUDE[ssIS](../../../includes/ssis-md.md)] Designer, and run the package.</span></span>

 <span data-ttu-id="61ddf-158">因此，在添加属性表达式之后，只有在保存包、运行包或重新打开包以后，才能在 [!INCLUDE[ssIS](../../../includes/ssis-md.md)] 设计器中看到使用属性表达式的包对象的更新后的属性值。</span><span class="sxs-lookup"><span data-stu-id="61ddf-158">You will therefore not see the updated values of the properties of the package objects that use property expressions in [!INCLUDE[ssIS](../../../includes/ssis-md.md)] Designer until you save the package, run the package, or reopen the package after adding the property expressions.</span></span>

 <span data-ttu-id="61ddf-159">如果调用特定于该对象类型的方法，那么也会加载与不同对象类型（连接管理器、日志提供程序和枚举器）关联的属性表达式。</span><span class="sxs-lookup"><span data-stu-id="61ddf-159">The property expressions associated with different types of objects-connection managers, log providers, and enumerators-are also loaded when methods specific to that object type are called.</span></span> <span data-ttu-id="61ddf-160">例如，连接管理器的属性将在 [!INCLUDE[ssISnoversion](../../../includes/ssisnoversion-md.md)] 创建连接实例之前加载。</span><span class="sxs-lookup"><span data-stu-id="61ddf-160">For example, the properties of connection managers are loaded before [!INCLUDE[ssISnoversion](../../../includes/ssisnoversion-md.md)] creates an instance of the connection.</span></span>

 <span data-ttu-id="61ddf-161">属性表达式将在加载包配置之后加载。</span><span class="sxs-lookup"><span data-stu-id="61ddf-161">Property expressions are loaded after package configurations have loaded.</span></span> <span data-ttu-id="61ddf-162">例如，变量首先由它们的配置进行更新，然后计算并加载使用这些变量的属性表达式。</span><span class="sxs-lookup"><span data-stu-id="61ddf-162">For example, variables are updated first by their configurations, and then the property expressions that use the variables are evaluated and loaded.</span></span> <span data-ttu-id="61ddf-163">这意味着属性表达式始终使用由配置所设置的变量的值。</span><span class="sxs-lookup"><span data-stu-id="61ddf-163">This means that the property expressions always use the values of variables that are set by configurations.</span></span>

> [!NOTE]
>  <span data-ttu-id="61ddf-164">不能使用 `Set` **dtexec**实用工具的选项填充属性表达式。</span><span class="sxs-lookup"><span data-stu-id="61ddf-164">You cannot use the `Set` option of the **dtexec** utility to populate a property expression.</span></span>

 <span data-ttu-id="61ddf-165">下表总结了何时计算并加载 [!INCLUDE[ssISnoversion](../../../includes/ssisnoversion-md.md)] 的属性表达式。</span><span class="sxs-lookup"><span data-stu-id="61ddf-165">The following table summarizes when property expressions of [!INCLUDE[ssISnoversion](../../../includes/ssisnoversion-md.md)] are evaluated and loaded.</span></span>

|<span data-ttu-id="61ddf-166">对象类型</span><span class="sxs-lookup"><span data-stu-id="61ddf-166">Object type</span></span>|<span data-ttu-id="61ddf-167">加载并计算</span><span class="sxs-lookup"><span data-stu-id="61ddf-167">Load and evaluate</span></span>|
|-----------------|-----------------------|
|<span data-ttu-id="61ddf-168">包、Foreach 循环、For 循环、序列、任务和数据流组件</span><span class="sxs-lookup"><span data-stu-id="61ddf-168">Package, Foreach loop, For Loop, Sequence, tasks, and data flow components</span></span>|<span data-ttu-id="61ddf-169">加载配置之后</span><span class="sxs-lookup"><span data-stu-id="61ddf-169">After loading configurations</span></span><br /><br /> <span data-ttu-id="61ddf-170">验证之前</span><span class="sxs-lookup"><span data-stu-id="61ddf-170">Before validation</span></span><br /><br /> <span data-ttu-id="61ddf-171">执行之前</span><span class="sxs-lookup"><span data-stu-id="61ddf-171">Before execution</span></span>|
|<span data-ttu-id="61ddf-172">连接管理器</span><span class="sxs-lookup"><span data-stu-id="61ddf-172">Connection managers</span></span>|<span data-ttu-id="61ddf-173">加载配置之后</span><span class="sxs-lookup"><span data-stu-id="61ddf-173">After loading configurations</span></span><br /><br /> <span data-ttu-id="61ddf-174">验证之前</span><span class="sxs-lookup"><span data-stu-id="61ddf-174">Before validation</span></span><br /><br /> <span data-ttu-id="61ddf-175">执行之前</span><span class="sxs-lookup"><span data-stu-id="61ddf-175">Before execution</span></span><br /><br /> <span data-ttu-id="61ddf-176">创建连接实例之前</span><span class="sxs-lookup"><span data-stu-id="61ddf-176">Before creating a connection instance</span></span>|
|<span data-ttu-id="61ddf-177">日志提供程序</span><span class="sxs-lookup"><span data-stu-id="61ddf-177">Log providers</span></span>|<span data-ttu-id="61ddf-178">加载配置之后</span><span class="sxs-lookup"><span data-stu-id="61ddf-178">After loading configurations</span></span><br /><br /> <span data-ttu-id="61ddf-179">验证之前</span><span class="sxs-lookup"><span data-stu-id="61ddf-179">Before validation</span></span><br /><br /> <span data-ttu-id="61ddf-180">执行之前</span><span class="sxs-lookup"><span data-stu-id="61ddf-180">Before execution</span></span><br /><br /> <span data-ttu-id="61ddf-181">打开日志之前</span><span class="sxs-lookup"><span data-stu-id="61ddf-181">Before opening logs</span></span>|
|<span data-ttu-id="61ddf-182">Foreach 枚举器</span><span class="sxs-lookup"><span data-stu-id="61ddf-182">Foreach enumerators</span></span>|<span data-ttu-id="61ddf-183">加载配置之后</span><span class="sxs-lookup"><span data-stu-id="61ddf-183">After loading configurations</span></span><br /><br /> <span data-ttu-id="61ddf-184">验证之前</span><span class="sxs-lookup"><span data-stu-id="61ddf-184">Before validation</span></span><br /><br /> <span data-ttu-id="61ddf-185">执行之前</span><span class="sxs-lookup"><span data-stu-id="61ddf-185">Before execution</span></span><br /><br /> <span data-ttu-id="61ddf-186">每个循环枚举之前</span><span class="sxs-lookup"><span data-stu-id="61ddf-186">Before each enumeration of the loop</span></span>|

## <a name="using-property-expressions-in-the-foreach-loop"></a><span data-ttu-id="61ddf-187">在 Foreach 循环中使用属性表达式</span><span class="sxs-lookup"><span data-stu-id="61ddf-187">Using Property Expressions in the Foreach Loop</span></span>
 <span data-ttu-id="61ddf-188">通常需要实现属性表达式来设置 Foreach 循环容器内部使用的连接管理器的 `ConnectionString` 属性值。</span><span class="sxs-lookup"><span data-stu-id="61ddf-188">It is frequently useful to implement a property expression to set the value of the `ConnectionString` property of connection managers that are used inside the Foreach Loop container.</span></span> <span data-ttu-id="61ddf-189">在枚举器将其当前值映射到与每个循环迭代有关的某个变量后，属性表达式可以使用此变量的值动态更新 `ConnectionString` 属性的值。</span><span class="sxs-lookup"><span data-stu-id="61ddf-189">After the enumerator maps its current value to a variable on each iteration of the loop, the property expression can use the value of this variable to update the value of the `ConnectionString` property dynamically .</span></span>

 <span data-ttu-id="61ddf-190">如果希望将属性表达式与 Foreach 循环所使用的文件、多个文件、平面文件和多平面文件连接管理器的 `ConnectionString` 属性一起使用，则应当考虑以下情况。</span><span class="sxs-lookup"><span data-stu-id="61ddf-190">If you want to use property expressions with the `ConnectionString` property of File, Multiple Files, Flat Files, and Multiple Flat Files connection managers that a Foreach Loop uses, there are some things that you should consider.</span></span> <span data-ttu-id="61ddf-191">通过将 `MaxConcurrentExecutables` 属性设置为大于 1 的值或值 -1，可以将包配置为同时运行多个可执行文件。</span><span class="sxs-lookup"><span data-stu-id="61ddf-191">A package can be configured to run multiple executables concurrently by setting the `MaxConcurrentExecutables` property either to a value greater than 1 or to the value -1.</span></span> <span data-ttu-id="61ddf-192">值为 -1 将使得可同时运行的可执行文件最大数目等于处理器数加 2。</span><span class="sxs-lookup"><span data-stu-id="61ddf-192">A value of -1 allows the maximum number of concurrently running executables to equal the number of processors plus two.</span></span> <span data-ttu-id="61ddf-193">若要避免并行执行可执行文件时出现负面结果，值 `MaxConcurrentExecutables` 应设置为 1。</span><span class="sxs-lookup"><span data-stu-id="61ddf-193">To avoid negative consequences from the parallel execution of executables, the value `MaxConcurrentExecutables` should be set to 1.</span></span> <span data-ttu-id="61ddf-194">如果 `MaxConcurrentExecutables` 不设置为 1，则无法保证 `ConnectionString` 属性的值正确无误，结果将是不可预测的。</span><span class="sxs-lookup"><span data-stu-id="61ddf-194">If `MaxConcurrentExecutables` is not set to 1, then the value of the `ConnectionString` property cannot be guaranteed and results are unpredictable.</span></span>

 <span data-ttu-id="61ddf-195">例如，请考虑使用一个 Foreach 循环枚举文件夹中的文件，检索文件名，然后使用“执行 SQL 任务”将每个文件名插入表中。</span><span class="sxs-lookup"><span data-stu-id="61ddf-195">For example, consider a Foreach Loop that enumerates files in a folder, retrieves the file names, and then uses an Execute SQL task to insert each file name into a table.</span></span> <span data-ttu-id="61ddf-196">如果 `MaxConcurrentExecutables` 不设置为 1，那么如果两个“执行 SQL 任务”实例试图同时写入表中，则会发生写入冲突。</span><span class="sxs-lookup"><span data-stu-id="61ddf-196">If `MaxConcurrentExecutables` is not set to 1, then write conflicts could occur if two instances of the Execute SQL task attempted to write to the table at the same time.</span></span>

## <a name="sample-property-expressions"></a><span data-ttu-id="61ddf-197">示例属性表达式</span><span class="sxs-lookup"><span data-stu-id="61ddf-197">Sample Property Expressions</span></span>
 <span data-ttu-id="61ddf-198">下列示例表达式说明如何在属性表达式中使用系统变量、运算符、函数和字符串文字。</span><span class="sxs-lookup"><span data-stu-id="61ddf-198">The following sample expressions show how to use system variables, operators, functions, and string literals in property expressions.</span></span>

### <a name="property-expression-for-the-loggingmode-property-of-a-package"></a><span data-ttu-id="61ddf-199">包的 LoggingMode 属性的属性表达式</span><span class="sxs-lookup"><span data-stu-id="61ddf-199">Property Expression for the LoggingMode Property of a Package</span></span>
 <span data-ttu-id="61ddf-200">下面的属性表达式可用于设置包的 LoggingMode 属性。</span><span class="sxs-lookup"><span data-stu-id="61ddf-200">The following property expression can be used to set the LoggingMode property of a package.</span></span> <span data-ttu-id="61ddf-201">表达式使用 DAY 和 GETDATE 函数来获得日期中表示“日”日期部分的整数。</span><span class="sxs-lookup"><span data-stu-id="61ddf-201">The expression uses the DAY and GETDATE functions to get an integer that represents the day datepart of a date.</span></span> <span data-ttu-id="61ddf-202">如果日是 1 号或 15 号，则启用日志记录；否则，禁用日志记录。</span><span class="sxs-lookup"><span data-stu-id="61ddf-202">If the day is the 1st or 15th, logging is enabled; otherwise, logging is disabled.</span></span> <span data-ttu-id="61ddf-203">值1是 LoggingMode 枚举器成员的整数等效项 `Enabled` ，值2是成员的整数等效项 `Disabled` 。</span><span class="sxs-lookup"><span data-stu-id="61ddf-203">The value 1 is the integer equivalent of the LoggingMode enumerator member `Enabled`, and the value 2 is the integer equivalent of the member `Disabled`.</span></span> <span data-ttu-id="61ddf-204">在表达式中，必须使用数值而不是枚举器成员名称。</span><span class="sxs-lookup"><span data-stu-id="61ddf-204">You must use the numeric value instead of the enumerator member name in the expression.</span></span>

 `DAY((DT_DBTIMESTAMP)GETDATE())==1||DAY((DT_DBTIMESTAMP)GETDATE())==15?1:2`

### <a name="property-expression-for-the-subject-of-an-e-mail-message"></a><span data-ttu-id="61ddf-205">电子邮件主题的属性表达式</span><span class="sxs-lookup"><span data-stu-id="61ddf-205">Property Expression for the Subject of an E-mail Message</span></span>
 <span data-ttu-id="61ddf-206">下面的属性表达式可用于设置发送邮件任务的 Subject 属性并提供了有用的电子邮件主题。</span><span class="sxs-lookup"><span data-stu-id="61ddf-206">The following property expression can be used to set the Subject property of a Send Mail task and provide a useful e-mail subject.</span></span> <span data-ttu-id="61ddf-207">该表达式使用字符串文字、系统变量、串联 (+) 和转换运算符以及 DATEDIFF 和 GETDATE 函数的组合。</span><span class="sxs-lookup"><span data-stu-id="61ddf-207">The expression uses a combination of string literals, system variables, the concatenation (+) and cast operators, and the DATEDIFF and GETDATE functions.</span></span> <span data-ttu-id="61ddf-208">系统变量是 `PackageName` 和 `StartTime` 变量。</span><span class="sxs-lookup"><span data-stu-id="61ddf-208">The system variables are the `PackageName` and `StartTime` variables.</span></span>

 `"PExpression-->Package: (" + @[System::PackageName] + ") Started:"+  (DT_WSTR, 30) @[System::StartTime] + " Duration:"  +  (DT_WSTR,10) (DATEDIFF( "ss", @[System::StartTime] , GETDATE()  )) + " seconds"`

 <span data-ttu-id="61ddf-209">如果包名称为 EmailRowCountPP，曾经在 2005 年 3 月 4 日运行，运行的持续时间为 9 秒钟，则该表达式的求值结果为下面的字符串。</span><span class="sxs-lookup"><span data-stu-id="61ddf-209">If the package name is EmailRowCountPP, was run on 3/4/2005, and the duration of the run was 9 seconds, the expression evaluates to the following string.</span></span>

 <span data-ttu-id="61ddf-210">PExpression-->Package: (EmailRowCountPP) Started:3/4/2005 11:06:18 AM Duration:9 seconds.</span><span class="sxs-lookup"><span data-stu-id="61ddf-210">PExpression-->Package: (EmailRowCountPP) Started:3/4/2005 11:06:18 AM Duration:9 seconds.</span></span>

### <a name="property-expression-for-the-message-of-an-e-mail-message"></a><span data-ttu-id="61ddf-211">电子邮件正文的属性表达式</span><span class="sxs-lookup"><span data-stu-id="61ddf-211">Property Expression for the Message of an E-mail Message</span></span>
 <span data-ttu-id="61ddf-212">下面的属性表达式可用于设置发送邮件任务的 MessageSource 属性。</span><span class="sxs-lookup"><span data-stu-id="61ddf-212">The following property expression can be used to set the MessageSource property of a Send Mail task.</span></span> <span data-ttu-id="61ddf-213">该表达式使用字符串文字、用户定义的变量和串联 (+) 运算符的组合。</span><span class="sxs-lookup"><span data-stu-id="61ddf-213">The expression uses a combination of string literals, user-defined variables, and the concatenation (+) operator.</span></span> <span data-ttu-id="61ddf-214">用户定义变量命名为 `nasdaqrawrows`、 `nyserawrows`和 `amexrawrows`。</span><span class="sxs-lookup"><span data-stu-id="61ddf-214">The user-defined variables are named `nasdaqrawrows`, `nyserawrows`, and `amexrawrows`.</span></span> <span data-ttu-id="61ddf-215">字符串“\n”指明是一个回车符。</span><span class="sxs-lookup"><span data-stu-id="61ddf-215">The string "\n" indicates a carriage return.</span></span>

 `"Rows Processed: "  +   "\n" +"   NASDAQ: "  +   (dt_wstr,9)@[nasdaqrawrows]   + "\n" + "   NYSE: "  +  (dt_wstr,9)@[nyserawrows]  + "\n" + "   Amex: "  +  (dt_wstr,9)@[amexrawrows]`

 <span data-ttu-id="61ddf-216">如果 `nasdaqrawrows` 为 7058， `nyserawrows` 为 3528，并且 `amexrawrows` 为 1102，则表达式计算结果为下列字符串。</span><span class="sxs-lookup"><span data-stu-id="61ddf-216">If `nasdaqrawrows` is 7058, `nyserawrows` is 3528, and `amexrawrows` is 1102, the expression evaluates to the following string.</span></span>

 <span data-ttu-id="61ddf-217">Rows Processed:</span><span class="sxs-lookup"><span data-stu-id="61ddf-217">Rows Processed:</span></span>

 <span data-ttu-id="61ddf-218">NASDAQ: 7058</span><span class="sxs-lookup"><span data-stu-id="61ddf-218">NASDAQ: 7058</span></span>

 <span data-ttu-id="61ddf-219">NYSE: 3528</span><span class="sxs-lookup"><span data-stu-id="61ddf-219">NYSE: 3528</span></span>

 <span data-ttu-id="61ddf-220">AMEX: 1102</span><span class="sxs-lookup"><span data-stu-id="61ddf-220">AMEX: 1102</span></span>

### <a name="property-expression-for-the-executable-property-of-an-execute-process-task"></a><span data-ttu-id="61ddf-221">执行进程任务的可执行文件属性的属性表达式</span><span class="sxs-lookup"><span data-stu-id="61ddf-221">Property Expression for the Executable Property of an Execute Process Task</span></span>
 <span data-ttu-id="61ddf-222">下面的属性表达式可以用于设置执行进程任务的 Executable 属性。</span><span class="sxs-lookup"><span data-stu-id="61ddf-222">The following property expression can be used to set the Executable property of an Execute Process task.</span></span> <span data-ttu-id="61ddf-223">该表达式使用字符串文字、运算符和函数的组合。</span><span class="sxs-lookup"><span data-stu-id="61ddf-223">The expression uses a combination of string literals, operators, and functions.</span></span> <span data-ttu-id="61ddf-224">该表达式使用 DATEPART 和 GETDATE 函数以及条件运算符。</span><span class="sxs-lookup"><span data-stu-id="61ddf-224">The expression uses the DATEPART and GETDATE functions and the conditional operator.</span></span>

 `DATEPART("weekday", GETDATE()) ==2?"notepad.exe":"mspaint.exe"`

 <span data-ttu-id="61ddf-225">如果是每周的第二天，则执行进程任务运行 notepad.exe，如果是其他时间，则该任务运行 mspaint.exe。</span><span class="sxs-lookup"><span data-stu-id="61ddf-225">If it is the second day in the week, the Execute Process task runs notepad.exe, otherwise the task runs mspaint.exe.</span></span>

### <a name="property-expression-for-the-connectionstring-property-of-a-flat-file-connection-manager"></a><span data-ttu-id="61ddf-226">平面文件连接管理器 ConnectionString 属性的属性表达式</span><span class="sxs-lookup"><span data-stu-id="61ddf-226">Property Expression for the ConnectionString Property of a Flat File Connection Manager</span></span>
 <span data-ttu-id="61ddf-227">下面的属性表达式可以用于设置平面文件连接管理器的 ConnectionString 属性。</span><span class="sxs-lookup"><span data-stu-id="61ddf-227">The following property expression can be used to set the ConnectionString property of a Flat File connection manager.</span></span> <span data-ttu-id="61ddf-228">该表达式使用一个用户定义变量 `myfilenamefull`，该变量包含指向一个文本文件的路径。</span><span class="sxs-lookup"><span data-stu-id="61ddf-228">The expression uses a single user-defined variable, `myfilenamefull`, which contains the path to a text file.</span></span>

 `@[User::myfilenamefull]`

> [!NOTE]
>  <span data-ttu-id="61ddf-229">连接管理器的属性表达式只能使用“属性”窗口进行访问。</span><span class="sxs-lookup"><span data-stu-id="61ddf-229">Property expressions for connection managers can be accessed only by using the Properties window.</span></span> <span data-ttu-id="61ddf-230">若要查看连接管理器的属性，必须在“属性”窗口打开时在 [!INCLUDE[ssIS](../../../includes/ssis-md.md)] 设计器的“连接管理器”区域中选择连接管理器，或右键单击连接管理器并选择“属性”。</span><span class="sxs-lookup"><span data-stu-id="61ddf-230">To view the properties for a connection manager, you must select the connection manager in the **Connection Managers** area of [!INCLUDE[ssIS](../../../includes/ssis-md.md)] Designer when the Properties window is open, or right-click the connection manager and select **Properties**.</span></span>

### <a name="property-expression-for-the-configstring-property-of-a-text-file-log-provider"></a><span data-ttu-id="61ddf-231">文本文件日志提供程序的 ConfigString 属性的属性表达式</span><span class="sxs-lookup"><span data-stu-id="61ddf-231">Property Expression for the ConfigString Property of a Text File Log Provider</span></span>
 <span data-ttu-id="61ddf-232">下面的属性表达式可以用于设置文本文件日志提供程序的 ConfigString 属性。</span><span class="sxs-lookup"><span data-stu-id="61ddf-232">The following property expression can be used to set the ConfigString property of a Text File log provider.</span></span> <span data-ttu-id="61ddf-233">该表达式使用一个用户定义变量 `varConfigString`，该变量包含要使用的文件连接管理器的名称。</span><span class="sxs-lookup"><span data-stu-id="61ddf-233">The expression uses a single user-defined variable, `varConfigString`, which contains the name of the File connection manager to use.</span></span> <span data-ttu-id="61ddf-234">文件连接管理器指定将在其中写入日志项的文本文件的路径。</span><span class="sxs-lookup"><span data-stu-id="61ddf-234">The File connection manager specifies the path of the text file to which log entries are written.</span></span>

 `@[User::varConfigString]`

> [!NOTE]
>  <span data-ttu-id="61ddf-235">日志提供程序的属性表达式只能通过“属性”窗口访问。</span><span class="sxs-lookup"><span data-stu-id="61ddf-235">Property expressions for log providers can be accessed only by using the Properties window.</span></span> <span data-ttu-id="61ddf-236">若要查看某日志提供程序的属性，必须在“属性”窗口打开的情况下在 [!INCLUDE[ssIS](../../../includes/ssis-md.md)] 设计器的“包资源管理器”选项卡中选择相应的日志提供程序；或者在包资源管理器中右键单击该日志提供程序，再单击“属性”。</span><span class="sxs-lookup"><span data-stu-id="61ddf-236">To view the properties of a log provider, you must select the log provider on the **Package Explorer** tab of [!INCLUDE[ssIS](../../../includes/ssis-md.md)] Designer when the Properties window is open, or right-click the log provider in Package Explorer and click **Properties**.</span></span>

## <a name="external-resources"></a><span data-ttu-id="61ddf-237">外部资源</span><span class="sxs-lookup"><span data-stu-id="61ddf-237">External Resources</span></span>

-   [<span data-ttu-id="61ddf-238">表达式和配置荧光笔 (CodePlex Project)</span><span class="sxs-lookup"><span data-stu-id="61ddf-238">Expression and Configuration Highlighter (CodePlex Project)</span></span>](https://go.microsoft.com/fwlink/?LinkId=146625)

-   <span data-ttu-id="61ddf-239">social.technet.microsoft.com 上的技术文章 [SSIS 表达式示例](https://go.microsoft.com/fwlink/?LinkId=220761)</span><span class="sxs-lookup"><span data-stu-id="61ddf-239">Technical article, [SSIS Expression Examples](https://go.microsoft.com/fwlink/?LinkId=220761), on social.technet.microsoft.com</span></span>

## <a name="see-also"></a><span data-ttu-id="61ddf-240">另请参阅</span><span class="sxs-lookup"><span data-stu-id="61ddf-240">See Also</span></span>
 [<span data-ttu-id="61ddf-241">在包中使用变量</span><span class="sxs-lookup"><span data-stu-id="61ddf-241">Use Variables in Packages</span></span>](../use-variables-in-packages.md)


