---
title: 使用检查点重启包 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
helpviewer_keywords:
- checkpoints [Integration Services]
- restarting packages
- starting packages
ms.assetid: 48f2fbb7-8964-484a-8311-5126cf594bfb
author: chugugrace
ms.author: chugu
ms.openlocfilehash: aa0e0e9ad1da67bfc70dec61396ab026df62d3ee
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87587889"
---
# <a name="restart-packages-by-using-checkpoints"></a><span data-ttu-id="e47ec-102">通过使用检查点重新启动包</span><span class="sxs-lookup"><span data-stu-id="e47ec-102">Restart Packages by Using Checkpoints</span></span>
  [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] <span data-ttu-id="e47ec-103">可以从失败点重新启动失败的包，而不是重新运行整个包。</span><span class="sxs-lookup"><span data-stu-id="e47ec-103">can restart failed packages from the point of failure, instead of rerunning the whole package.</span></span> <span data-ttu-id="e47ec-104">如果包配置为使用检查点，则关于包执行的信息会写入检查点文件中。</span><span class="sxs-lookup"><span data-stu-id="e47ec-104">If a package is configured to use checkpoints, information about package execution is written to a checkpoint file.</span></span> <span data-ttu-id="e47ec-105">当重新运行失败的包时，可以使用检查点文件从失败点重新启动该包。</span><span class="sxs-lookup"><span data-stu-id="e47ec-105">When the failed package is rerun, the checkpoint file is used to restart the package from the point of failure.</span></span> <span data-ttu-id="e47ec-106">如果包成功运行，则会删除该检查点文件，然后在下次运行包时会重新创建相应的检查点文件。</span><span class="sxs-lookup"><span data-stu-id="e47ec-106">If the package runs successfully, the checkpoint file is deleted, and then re-created the next time the package is run.</span></span>  
  
 <span data-ttu-id="e47ec-107">在包中使用检查点可以提供下列好处：</span><span class="sxs-lookup"><span data-stu-id="e47ec-107">Using checkpoints in a package can provide the following benefits.</span></span>  
  
-   <span data-ttu-id="e47ec-108">避免重复下载和上载大型文件。</span><span class="sxs-lookup"><span data-stu-id="e47ec-108">Avoid repeating the downloading and uploading of large files.</span></span> <span data-ttu-id="e47ec-109">例如，对于每次下载都使用 FTP 任务下载多个大型文件的包，如果下载单个文件失败，则可以重新启动该包，只下载该失败的文件。</span><span class="sxs-lookup"><span data-stu-id="e47ec-109">For example, a package that downloads multiple large files by using an FTP task for each download can be restarted after the downloading of a single file fails and then download only that file.</span></span>  
  
-   <span data-ttu-id="e47ec-110">避免重复加载大量数据。</span><span class="sxs-lookup"><span data-stu-id="e47ec-110">Avoid repeating the loading of large amounts of data.</span></span> <span data-ttu-id="e47ec-111">例如，对于为每个维度使用不同的大容量插入任务向数据仓库中的维度表执行大容量插入的包，如果某一维度表的插入失败，则可以重新启动该包，只重新加载该失败的维度。</span><span class="sxs-lookup"><span data-stu-id="e47ec-111">For example, a package that performs bulk inserts into dimension tables in a data warehouse using a different Bulk Insert task for each dimension can be restarted if the insertion fails for one dimension table, and only that dimension will be reloaded.</span></span>  
  
-   <span data-ttu-id="e47ec-112">避免重复聚合值。</span><span class="sxs-lookup"><span data-stu-id="e47ec-112">Avoid repeating the aggregation of values.</span></span> <span data-ttu-id="e47ec-113">例如，如果包需要计算多个聚合，例如求平均值和求和，而且使用不同的数据流任务执行每个聚合，则在计算一个聚合失败时，可以重新启动该包，只重新计算该失败的聚合。</span><span class="sxs-lookup"><span data-stu-id="e47ec-113">For example, a package that computes many aggregates, such as averages and sums, using a separate Data Flow task to perform each aggregation, can be restarted after computing an aggregation fails and only that aggregation will be recomputed.</span></span>  
  
 <span data-ttu-id="e47ec-114">如果包配置为使用检查点， [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] 将捕获检查点文件中的重新启动点。</span><span class="sxs-lookup"><span data-stu-id="e47ec-114">If a package is configured to use checkpoints, [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] captures the restart point in the checkpoint file.</span></span> <span data-ttu-id="e47ec-115">失败的容器类型以及功能（例如事务）的实现都会影响在检查点文件中所记录的重新启动点。</span><span class="sxs-lookup"><span data-stu-id="e47ec-115">The type of container that fails and the implementation of features such as transactions affect the restart point that is recorded in the checkpoint file.</span></span> <span data-ttu-id="e47ec-116">检查点文件中还捕获变量的当前值。</span><span class="sxs-lookup"><span data-stu-id="e47ec-116">The current values of variables are also captured in the checkpoint file.</span></span> <span data-ttu-id="e47ec-117">但是，数据类型为 `Object` 的变量的值不保存在检查点文件中。</span><span class="sxs-lookup"><span data-stu-id="e47ec-117">However, the values of variables that have the `Object` data type are not saved in checkpoint files.</span></span>  
  
## <a name="defining-restart-points"></a><span data-ttu-id="e47ec-118">定义重新启动点</span><span class="sxs-lookup"><span data-stu-id="e47ec-118">Defining Restart Points</span></span>  
 <span data-ttu-id="e47ec-119">封装单个任务的任务宿主容器是可以重新启动的最小原子工作单元。</span><span class="sxs-lookup"><span data-stu-id="e47ec-119">The task host container, which encapsulates a single task, is the smallest atomic unit of work that can be restarted.</span></span> <span data-ttu-id="e47ec-120">Foreach 循环容器和事务处理容器也被视为原子工作单元。</span><span class="sxs-lookup"><span data-stu-id="e47ec-120">The Foreach Loop container and a transacted container are also treated as atomic units of work.</span></span>  
  
 <span data-ttu-id="e47ec-121">如果在事务处理容器运行时停止某个包，则该事务将会结束，并且将回滚该容器执行的所有工作。</span><span class="sxs-lookup"><span data-stu-id="e47ec-121">If a package is stopped while a transacted container is running, the transaction ends and any work performed by the container is rolled back.</span></span> <span data-ttu-id="e47ec-122">当重新启动该包时，会重新运行失败的容器。</span><span class="sxs-lookup"><span data-stu-id="e47ec-122">When the package is restarted, the container that failed is rerun.</span></span> <span data-ttu-id="e47ec-123">检查点文件中不记录事务处理容器的任何子容器的完成情况。</span><span class="sxs-lookup"><span data-stu-id="e47ec-123">The completion of any child containers of transacted container is not recorded in the checkpoint file.</span></span> <span data-ttu-id="e47ec-124">因此，当重新启动包时，会再次运行事务处理容器及其子容器。</span><span class="sxs-lookup"><span data-stu-id="e47ec-124">Therefore, when the package is restarted, the transacted container and its child containers run again.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="e47ec-125">在同一个包中使用检查点和事务可能会导致意外的结果。</span><span class="sxs-lookup"><span data-stu-id="e47ec-125">Using checkpoints and transactions in the same package could cause unexpected results.</span></span> <span data-ttu-id="e47ec-126">例如，当包失败并从某个检查点重新启动时，该包可能会重复已成功提交的事务。</span><span class="sxs-lookup"><span data-stu-id="e47ec-126">For example, when a package fails and restarts from a checkpoint, the package might repeat a transaction that has already been successfully committed.</span></span>  
  
 <span data-ttu-id="e47ec-127">不为 For 循环和 Foreach 循环容器保存检查点数据。</span><span class="sxs-lookup"><span data-stu-id="e47ec-127">Checkpoint data is not saved for For Loop and Foreach Loop containers.</span></span> <span data-ttu-id="e47ec-128">当重新启动包时，会再次运行 For 循环和 Foreach 循环容器及其子容器。</span><span class="sxs-lookup"><span data-stu-id="e47ec-128">When a package is restarted, the For Loop and Foreach Loop containers and the child containers are run again.</span></span> <span data-ttu-id="e47ec-129">如果循环中的子容器已成功运行，则不会将其记录在检查点文件中，而是重新运行子容器。</span><span class="sxs-lookup"><span data-stu-id="e47ec-129">If a child container in the loop runs successfully, it is not recorded in the checkpoint file, instead it is rerun.</span></span> <span data-ttu-id="e47ec-130">有关解决方法的详细信息，请参阅 [不为 For 循环和 Foreach 循环容器项采用 SSIS 检查点](https://go.microsoft.com/fwlink/?LinkId=241633)。</span><span class="sxs-lookup"><span data-stu-id="e47ec-130">For more information and a workaround, see [SSIS Checkpoints are not honored for For Loop or Foreach Loop container items](https://go.microsoft.com/fwlink/?LinkId=241633).</span></span>  
  
 <span data-ttu-id="e47ec-131">在重新启动包时，不会重新加载包配置，包使用写入检查点文件中的配置信息。</span><span class="sxs-lookup"><span data-stu-id="e47ec-131">If the package is restarted the package configurations are not reloaded, instead the package uses the configuration information written to the checkpoint file.</span></span> <span data-ttu-id="e47ec-132">这就确保包在重新运行时使用的是与失败时相同的配置。</span><span class="sxs-lookup"><span data-stu-id="e47ec-132">This ensures that the package uses the same configurations when it is rerun as the time it failed.</span></span>  
  
 <span data-ttu-id="e47ec-133">包只能在控制流级重新启动。</span><span class="sxs-lookup"><span data-stu-id="e47ec-133">A package can be restarted only at the control flow level.</span></span> <span data-ttu-id="e47ec-134">您无法重新启动处于数据流中间的包。</span><span class="sxs-lookup"><span data-stu-id="e47ec-134">You cannot restart a package in the middle of a data flow.</span></span> <span data-ttu-id="e47ec-135">为了避免重新运行整个数据流，可以将包设计为包括多个数据流，每个数据流使用不同的数据流任务。</span><span class="sxs-lookup"><span data-stu-id="e47ec-135">To avoid rerunning the whole data flow, the package might be designed to include multiple data flows, each one using a different Data Flow task.</span></span> <span data-ttu-id="e47ec-136">这样，在重新启动包时，将只需重新运行一个数据流任务。</span><span class="sxs-lookup"><span data-stu-id="e47ec-136">This way the package can be restarted, rerunning only one Data Flow task.</span></span>  
  
## <a name="configuring-a-package-to-restart"></a><span data-ttu-id="e47ec-137">将包配置为重新启动</span><span class="sxs-lookup"><span data-stu-id="e47ec-137">Configuring a Package to Restart</span></span>  
 <span data-ttu-id="e47ec-138">检查点文件包括所有已完成的容器的执行结果、系统变量和用户定义的变量的当前值以及包配置信息。</span><span class="sxs-lookup"><span data-stu-id="e47ec-138">The checkpoint file includes the execution results of all completed containers, the current values of system and user-defined variables, and package configuration information.</span></span> <span data-ttu-id="e47ec-139">该文件还包括包的唯一标识符。</span><span class="sxs-lookup"><span data-stu-id="e47ec-139">The file also includes the unique identifier of the package.</span></span> <span data-ttu-id="e47ec-140">若要成功重新启动包，检查点文件中的包标识符和包必须匹配，否则重新启动将失败。</span><span class="sxs-lookup"><span data-stu-id="e47ec-140">To successfully restart a package, the package identifier in the checkpoint file and the package must match; otherwise the restart fails.</span></span> <span data-ttu-id="e47ec-141">这样可以防止包使用其他包版本所写的检查点文件。</span><span class="sxs-lookup"><span data-stu-id="e47ec-141">This prevents a package from using a checkpoint file written by a different package version.</span></span> <span data-ttu-id="e47ec-142">如果包成功运行，则在包重新启动后，将会删除该检查点文件。</span><span class="sxs-lookup"><span data-stu-id="e47ec-142">If the package runs successfully, after it is restarted the checkpoint file is deleted.</span></span>  
  
 <span data-ttu-id="e47ec-143">下表列出了可设置为实现检查点的包属性。</span><span class="sxs-lookup"><span data-stu-id="e47ec-143">The following table lists the package properties that you set to implement checkpoints.</span></span>  
  
|<span data-ttu-id="e47ec-144">properties</span><span class="sxs-lookup"><span data-stu-id="e47ec-144">Property</span></span>|<span data-ttu-id="e47ec-145">说明</span><span class="sxs-lookup"><span data-stu-id="e47ec-145">Description</span></span>|  
|--------------|-----------------|  
|<span data-ttu-id="e47ec-146">CheckpointFileName</span><span class="sxs-lookup"><span data-stu-id="e47ec-146">CheckpointFileName</span></span>|<span data-ttu-id="e47ec-147">指定检查点文件的名称。</span><span class="sxs-lookup"><span data-stu-id="e47ec-147">Specifies the name of the checkpoint file.</span></span>|  
|<span data-ttu-id="e47ec-148">CheckpointUsage</span><span class="sxs-lookup"><span data-stu-id="e47ec-148">CheckpointUsage</span></span>|<span data-ttu-id="e47ec-149">指定是否使用检查点。</span><span class="sxs-lookup"><span data-stu-id="e47ec-149">Specifies whether checkpoints are used.</span></span>|  
|<span data-ttu-id="e47ec-150">SaveCheckpoints</span><span class="sxs-lookup"><span data-stu-id="e47ec-150">SaveCheckpoints</span></span>|<span data-ttu-id="e47ec-151">指示包是否保存检查点。</span><span class="sxs-lookup"><span data-stu-id="e47ec-151">Indicates whether the package saves checkpoints.</span></span> <span data-ttu-id="e47ec-152">此属性必须设置为 True，才能从失败点重新启动包。</span><span class="sxs-lookup"><span data-stu-id="e47ec-152">This property must be set to True to restart a package from a point of failure.</span></span>|  
  
 <span data-ttu-id="e47ec-153">此外， `true` 对于包中要标识为重新启动点的所有容器，必须将 FailPackageOnFailure 属性设置为。</span><span class="sxs-lookup"><span data-stu-id="e47ec-153">Additionally, you must set the FailPackageOnFailure property to `true` for all the containers in the package that you want to identify as restart points.</span></span>  
  
 <span data-ttu-id="e47ec-154">可以使用 ForceExecutionResult 属性测试包中检查点的使用情况。</span><span class="sxs-lookup"><span data-stu-id="e47ec-154">You can use the ForceExecutionResult property to test the use of checkpoints in a package.</span></span> <span data-ttu-id="e47ec-155">通过将容器或任务的 ForceExecutionResult 设置为 Failure，可以模拟实时的失败。</span><span class="sxs-lookup"><span data-stu-id="e47ec-155">By setting ForceExecutionResult of a task or container to Failure, you can imitate real-time failure.</span></span> <span data-ttu-id="e47ec-156">当重新运行包时，将重新运行失败的任务和容器。</span><span class="sxs-lookup"><span data-stu-id="e47ec-156">When you rerun the package, the failed task and containers will be rerun.</span></span>  
  
### <a name="checkpoint-usage"></a><span data-ttu-id="e47ec-157">检查点用法</span><span class="sxs-lookup"><span data-stu-id="e47ec-157">Checkpoint Usage</span></span>  
 <span data-ttu-id="e47ec-158">CheckpointUsage 属性可设置为下列值：</span><span class="sxs-lookup"><span data-stu-id="e47ec-158">The CheckpointUsage property can be set to the following values:</span></span>  
  
|<span data-ttu-id="e47ec-159">值</span><span class="sxs-lookup"><span data-stu-id="e47ec-159">Value</span></span>|<span data-ttu-id="e47ec-160">说明</span><span class="sxs-lookup"><span data-stu-id="e47ec-160">Description</span></span>|  
|-----------|-----------------|  
|`Never`|<span data-ttu-id="e47ec-161">指定不使用检查点文件，包从包工作流的起点开始运行。</span><span class="sxs-lookup"><span data-stu-id="e47ec-161">Specifies that the checkpoint file is not used and that the package runs from the start of the package workflow.</span></span>|  
|`Always`|<span data-ttu-id="e47ec-162">指定始终使用检查点文件，包从上一次执行失败的点重新启动。</span><span class="sxs-lookup"><span data-stu-id="e47ec-162">Specifies that the checkpoint file is always used and that the package restarts from the point of the previous execution failure.</span></span> <span data-ttu-id="e47ec-163">如果找不到检查点文件，则包失败。</span><span class="sxs-lookup"><span data-stu-id="e47ec-163">If the checkpoint file is not found, the package fails.</span></span>|  
|`IfExists`|<span data-ttu-id="e47ec-164">指定如果存在检查点文件则使用该文件。</span><span class="sxs-lookup"><span data-stu-id="e47ec-164">Specifies that the checkpoint file is used if it exists.</span></span> <span data-ttu-id="e47ec-165">如果检查点文件存在，则包从上一次执行失败的点重新启动；如果检查点文件不存在，则包从包工作流的起点开始运行。</span><span class="sxs-lookup"><span data-stu-id="e47ec-165">If the checkpoint file exists, the package restarts from the point of the previous execution failure; otherwise, it runs from the start of the package workflow.</span></span>|  
  
> [!NOTE]  
>  <span data-ttu-id="e47ec-166">Dtexec 的 **/checkpointing on on**选项等效于将 `SaveCheckpoints` 包的属性设置为 `True` ，并将 `CheckpointUsage` 属性设置为 "始终"。</span><span class="sxs-lookup"><span data-stu-id="e47ec-166">The **/CheckPointing on** option of dtexec is equivalent to setting the `SaveCheckpoints` property of the package to `True`, and the `CheckpointUsage` property to Always.</span></span> <span data-ttu-id="e47ec-167">有关详细信息，请参阅 [dtexec Utility](dtexec-utility.md)。</span><span class="sxs-lookup"><span data-stu-id="e47ec-167">For more information, see [dtexec Utility](dtexec-utility.md).</span></span>  
  
## <a name="securing-checkpoint-files"></a><span data-ttu-id="e47ec-168">保护检查点文件</span><span class="sxs-lookup"><span data-stu-id="e47ec-168">Securing Checkpoint Files</span></span>  
 <span data-ttu-id="e47ec-169">包级别的保护不包括保护检查点文件，必须单独保护这些文件。</span><span class="sxs-lookup"><span data-stu-id="e47ec-169">Package level protection does not include protection of checkpoint files and you must secure these files separately.</span></span> <span data-ttu-id="e47ec-170">检查点数据只能存储在文件系统中，应当使用操作系统访问控制列表 (ACL) 来保护用于存储该文件的位置或文件夹。</span><span class="sxs-lookup"><span data-stu-id="e47ec-170">Checkpoint data can be stored only in the file system and you should use an operating system access control list (ACL) to secure the location or folder where you store the file.</span></span> <span data-ttu-id="e47ec-171">重要的是务必保护检查点文件，因为它们包含了有关包状态的信息，包括变量的当前值。</span><span class="sxs-lookup"><span data-stu-id="e47ec-171">It is important to secure checkpoint files because they contain information about the package state, including the current values of variables.</span></span> <span data-ttu-id="e47ec-172">例如，变量可能包含由很多行私人数据（如电话号码）组成的记录集。</span><span class="sxs-lookup"><span data-stu-id="e47ec-172">For example, a variable may contain a recordset with many rows of private data such as telephone numbers.</span></span> <span data-ttu-id="e47ec-173">有关详细信息，请参阅 [访问包使用的文件](../access-to-files-used-by-packages.md)。</span><span class="sxs-lookup"><span data-stu-id="e47ec-173">For more information, see [Access to Files Used by Packages](../access-to-files-used-by-packages.md).</span></span>  
  
### <a name="to-configure-the-checkpoint-properties"></a><span data-ttu-id="e47ec-174">配置检查点属性</span><span class="sxs-lookup"><span data-stu-id="e47ec-174">To configure the checkpoint properties</span></span>  
  
-   [<span data-ttu-id="e47ec-175">配置检查点以重新启动失败的包</span><span class="sxs-lookup"><span data-stu-id="e47ec-175">Configure Checkpoints for Restarting a Failed Package</span></span>](../configure-checkpoints-for-restarting-a-failed-package.md)  
  
## <a name="external-resources"></a><span data-ttu-id="e47ec-176">外部资源</span><span class="sxs-lookup"><span data-stu-id="e47ec-176">External Resources</span></span>  
  
-   <span data-ttu-id="e47ec-177">social.technet.microsoft.com 上的技术文章： [在故障转移或失败后自动重新启动 SSIS 包](https://go.microsoft.com/fwlink/?LinkId=200407)</span><span class="sxs-lookup"><span data-stu-id="e47ec-177">Technical article, [Automatic Restart of SSIS packages after Failover or Failure](https://go.microsoft.com/fwlink/?LinkId=200407), on social.technet.microsoft.com</span></span>  
  
-   <span data-ttu-id="e47ec-178">support.microsoft.com 上的支持文章： [不为 For 循环和 Foreach 循环容器项采用 SSIS 检查点](https://go.microsoft.com/fwlink/?LinkId=241633)。</span><span class="sxs-lookup"><span data-stu-id="e47ec-178">Support article, [SSIS Checkpoints are not honored for For Loop or Foreach Loop container items](https://go.microsoft.com/fwlink/?LinkId=241633), on support.microsoft.com.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e47ec-179">另请参阅</span><span class="sxs-lookup"><span data-stu-id="e47ec-179">See Also</span></span>  
 [<span data-ttu-id="e47ec-180">SQL Server Integration Services</span><span class="sxs-lookup"><span data-stu-id="e47ec-180">SQL Server Integration Services</span></span>](../sql-server-integration-services.md)  
  
  
