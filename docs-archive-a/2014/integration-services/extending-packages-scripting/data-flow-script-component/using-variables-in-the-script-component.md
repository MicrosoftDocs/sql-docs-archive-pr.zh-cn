---
title: 在脚本组件中使用变量 | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: reference
helpviewer_keywords:
- Script component [Integration Services], using variables
ms.assetid: 92d1881a-1ef1-43ae-b1ca-48d0536bdbc2
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 4328a938c56ad8383c12cdae1d6511604ec65582
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87691315"
---
# <a name="using-variables-in-the-script-component"></a><span data-ttu-id="a7b26-102">在脚本组件中使用变量</span><span class="sxs-lookup"><span data-stu-id="a7b26-102">Using Variables in the Script Component</span></span>
  <span data-ttu-id="a7b26-103">变量存储包及其容器、任务和事件处理程序在运行时可以使用的值。</span><span class="sxs-lookup"><span data-stu-id="a7b26-103">Variables store values that a package and its containers, tasks, and event handlers can use at run time.</span></span> <span data-ttu-id="a7b26-104">有关详细信息，请参阅 [Integration Services (SSIS) 变量](../../integration-services-ssis-variables.md)。</span><span class="sxs-lookup"><span data-stu-id="a7b26-104">For more information, see [Integration Services &#40;SSIS&#41; Variables](../../integration-services-ssis-variables.md).</span></span>  
  
 <span data-ttu-id="a7b26-105">您可以通过在 " `ReadOnlyVariables` `ReadWriteVariables` **脚本转换编辑器**" 的 "**脚本**" 页上的 "和" 字段中输入逗号分隔的变量列表，使现有变量可用于只读或读/写访问。</span><span class="sxs-lookup"><span data-stu-id="a7b26-105">You can make existing variables available for read-only or read/write access by your custom script by entering comma-delimited lists of variables in the `ReadOnlyVariables` and `ReadWriteVariables` fields on the **Script** page of the **Script Transformation Editor**.</span></span> <span data-ttu-id="a7b26-106">请注意，变量名称区分大小写。</span><span class="sxs-lookup"><span data-stu-id="a7b26-106">Keep in mind that variable names are case-sensitive.</span></span> <span data-ttu-id="a7b26-107">使用 `Value` 属性可以从单个变量读取数据或向其中写入数据。</span><span class="sxs-lookup"><span data-stu-id="a7b26-107">Use the `Value` property to read from and write to individual variables.</span></span> <span data-ttu-id="a7b26-108">当脚本在运行时操作变量时，脚本组件将在后台处理任何所需的锁定。</span><span class="sxs-lookup"><span data-stu-id="a7b26-108">The Script component handles any required locking behind the scenes as your script manipulates the variables at run time.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="a7b26-109">`ReadWriteVariables` 集合仅供在 `PostExecute` 方法中尽可能优化性能并降低锁定冲突的风险。</span><span class="sxs-lookup"><span data-stu-id="a7b26-109">The collection of `ReadWriteVariables` is only available in the `PostExecute` method to maximize performance and minimize the risk of locking conflicts.</span></span> <span data-ttu-id="a7b26-110">因此不能在处理每行数据时直接递增包变量的值，</span><span class="sxs-lookup"><span data-stu-id="a7b26-110">Therefore you cannot directly increment the value of a package variable as you process each row of data.</span></span> <span data-ttu-id="a7b26-111">而应递增本地变量的值，并在所有数据处理完毕后，在 `PostExecute` 方法中将包变量的值设置为本地变量的值。</span><span class="sxs-lookup"><span data-stu-id="a7b26-111">Increment the value of a local variable instead, and set the value of the package variable to the value of the local variable in the `PostExecute` method after all data has been processed.</span></span> <span data-ttu-id="a7b26-112">还可以使用 <xref:Microsoft.SqlServer.Dts.Pipeline.ScriptComponent.VariableDispenser%2A> 属性解决此限制问题，本主题稍后会进行介绍。</span><span class="sxs-lookup"><span data-stu-id="a7b26-112">You can also use the <xref:Microsoft.SqlServer.Dts.Pipeline.ScriptComponent.VariableDispenser%2A> property to work around this limitation, as described later in this topic.</span></span> <span data-ttu-id="a7b26-113">但是，在处理每一行时直接写包变量将会对性能产生负面影响，并增加锁定冲突的风险。</span><span class="sxs-lookup"><span data-stu-id="a7b26-113">However, writing directly to a package variable as each row is processed will negatively impact performance and increase the risk of locking conflicts.</span></span>  
  
 <span data-ttu-id="a7b26-114">有关“脚本转换编辑器”的“脚本”页的详细信息，请参阅[在脚本组件编辑器中配置脚本组件](configuring-the-script-component-in-the-script-component-editor.md)和[脚本转换编辑器（“脚本”页）](../../script-transformation-editor-script-page.md) 。</span><span class="sxs-lookup"><span data-stu-id="a7b26-114">For more information about the **Script** page of the **Script Transformation Editor**, see [Configuring the Script Component in the Script Component Editor](configuring-the-script-component-in-the-script-component-editor.md) and [Script Transformation Editor &#40;Script Page&#41;](../../script-transformation-editor-script-page.md).</span></span>  
  
 <span data-ttu-id="a7b26-115">脚本组件在 `Variables` 项目项中创建一个 `ComponentWrapper` 集合类，该集合类为每个预配置变量值包含一个强类型的取值函数属性，该属性与变量本身同名。</span><span class="sxs-lookup"><span data-stu-id="a7b26-115">The Script component creates a `Variables` collection class in the `ComponentWrapper` project item with a strongly-typed accessor property for the value of each preconfigured variable where the property has the same name as the variable itself.</span></span> <span data-ttu-id="a7b26-116">此集合通过 `Variables` 类的 `ScriptMain` 属性公开。</span><span class="sxs-lookup"><span data-stu-id="a7b26-116">This collection is exposed through the `Variables` property of the `ScriptMain` class.</span></span> <span data-ttu-id="a7b26-117">取值函数属性根据需要提供对变量值的只读或读/写权限。</span><span class="sxs-lookup"><span data-stu-id="a7b26-117">The accessor property provides read-only or read/write permission to the value of the variable as appropriate.</span></span> <span data-ttu-id="a7b26-118">例如，如果将名为 `MyIntegerVariable` 的整数变量添加到 `ReadOnlyVariables` 列表中，则可在脚本中使用以下代码检索该变量的值：</span><span class="sxs-lookup"><span data-stu-id="a7b26-118">For example, if you have added an integer variable named `MyIntegerVariable` to the `ReadOnlyVariables` list, you can retrieve its value in your script by using the following code:</span></span>  
  
 `Dim myIntegerVariableValue As Integer = Me.Variables.MyIntegerVariable`  
  
 <span data-ttu-id="a7b26-119">还可以使用 <xref:Microsoft.SqlServer.Dts.Pipeline.ScriptComponent.VariableDispenser%2A> 属性（通过调用 `Me.VariableDispenser` 进行访问）在脚本组件中使用变量。</span><span class="sxs-lookup"><span data-stu-id="a7b26-119">You can also use the <xref:Microsoft.SqlServer.Dts.Pipeline.ScriptComponent.VariableDispenser%2A> property, accessed by calling `Me.VariableDispenser`, to work with variables in the Script component.</span></span> <span data-ttu-id="a7b26-120">在这种情况下，使用的不是变量的已命名类型化取值函数属性，而是直接访问这些变量。</span><span class="sxs-lookup"><span data-stu-id="a7b26-120">In this case you are not using the typed and named accessor properties for variables, but accessing the variables directly.</span></span> <span data-ttu-id="a7b26-121">使用 <xref:Microsoft.SqlServer.Dts.Pipeline.ScriptComponent.VariableDispenser%2A> 时，您必须在您自己的代码中处理锁定语义和变量值的数据类型转换。</span><span class="sxs-lookup"><span data-stu-id="a7b26-121">When using the <xref:Microsoft.SqlServer.Dts.Pipeline.ScriptComponent.VariableDispenser%2A>, you must handle both the locking semantics and the casting of data types for variable values in your own code.</span></span> <span data-ttu-id="a7b26-122">如果要使用在设计时不可用，而是以编程方式在运行时创建的变量，则必须使用 <xref:Microsoft.SqlServer.Dts.Pipeline.ScriptComponent.VariableDispenser%2A> 属性，而不是已命名的类型化取值函数属性。</span><span class="sxs-lookup"><span data-stu-id="a7b26-122">You have to use the <xref:Microsoft.SqlServer.Dts.Pipeline.ScriptComponent.VariableDispenser%2A> property instead of the named and typed accessor properties if you want to work with a variable that is not available at design time but is created programmatically at run time.</span></span>  
  
<span data-ttu-id="a7b26-123">![Integration Services 图标 (小型) ](../../media/dts-16.gif "集成服务图标（小）")  **随时保持最新 Integration Services**</span><span class="sxs-lookup"><span data-stu-id="a7b26-123">![Integration Services icon (small)](../../media/dts-16.gif "Integration Services icon (small)")  **Stay Up to Date with Integration Services**</span></span><br /> <span data-ttu-id="a7b26-124">若要从 Microsoft 获得最新的下载内容、文章、示例和视频，以及从社区获得所选解决方案，请访问 MSDN 上的 [!INCLUDE[ssISnoversion](../../../includes/ssisnoversion-md.md)] 页：</span><span class="sxs-lookup"><span data-stu-id="a7b26-124">For the latest downloads, articles, samples, and videos from Microsoft, as well as selected solutions from the community, visit the [!INCLUDE[ssISnoversion](../../../includes/ssisnoversion-md.md)] page on MSDN:</span></span><br /><br /> [<span data-ttu-id="a7b26-125">访问 MSDN 上的 Integration Services 页</span><span class="sxs-lookup"><span data-stu-id="a7b26-125">Visit the Integration Services page on MSDN</span></span>](https://go.microsoft.com/fwlink/?LinkId=136655)<br /><br /> <span data-ttu-id="a7b26-126">若要获得有关这些更新的自动通知，请订阅该页上提供的 RSS 源。</span><span class="sxs-lookup"><span data-stu-id="a7b26-126">For automatic notification of these updates, subscribe to the RSS feeds available on the page.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a7b26-127">另请参阅</span><span class="sxs-lookup"><span data-stu-id="a7b26-127">See Also</span></span>  
 <span data-ttu-id="a7b26-128">[Integration Services (SSIS) 变量](../../integration-services-ssis-variables.md) </span><span class="sxs-lookup"><span data-stu-id="a7b26-128">[Integration Services &#40;SSIS&#41; Variables](../../integration-services-ssis-variables.md) </span></span>  
 [<span data-ttu-id="a7b26-129">使用包中的变量</span><span class="sxs-lookup"><span data-stu-id="a7b26-129">Use Variables in Packages</span></span>](../../use-variables-in-packages.md)  
  
  
