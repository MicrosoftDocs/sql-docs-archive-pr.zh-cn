---
title: 模糊查找转换 | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
f1_keywords:
- sql12.dts.designer.fuzzylookuptrans.f1
helpviewer_keywords:
- cleaning data
- comparing data
- token delimiters [Integration Services]
- temporary indexes [Integration Services]
- temporary tables [Integration Services]
- Fuzzy Lookup transformation
- reference tables [Integration Services]
- match similar data [Integration Services]
- replacing missing values
- correcting data [Integration Services]
- cache [Integration Services]
- standardizing data [Integration Services]
- lookups [Integration Services]
- confidence scores [Integration Services]
- fuzzy matches
- missing values replaced [Integration Services]
- similarity thresholds [Integration Services]
ms.assetid: 019db426-3de2-4ca9-8667-79fd9a47a068
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 742a87e7425fd65b8af7bcda87c237151d382f77
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87587936"
---
# <a name="fuzzy-lookup-transformation"></a><span data-ttu-id="c8c6d-102">模糊查找转换</span><span class="sxs-lookup"><span data-stu-id="c8c6d-102">Fuzzy Lookup Transformation</span></span>
  <span data-ttu-id="c8c6d-103">模糊查找转换执行数据清理任务，例如标准化数据、更正数据以及提供丢失的值。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-103">The Fuzzy Lookup transformation performs data cleaning tasks such as standardizing data, correcting data, and providing missing values.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="c8c6d-104">有关模糊查找转换的详细信息（包括性能和内存限制），请参阅白皮书： [Fuzzy Lookup and Fuzzy Grouping in SQL Server Integration Services 2005](https://go.microsoft.com/fwlink/?LinkId=96604)（SQL Server Integration Services 2005 中的模糊查找和模糊分组）。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-104">For more detailed information about the Fuzzy Lookup transformation, including performance and memory limitations, see the white paper, [Fuzzy Lookup and Fuzzy Grouping in SQL Server Integration Services 2005](https://go.microsoft.com/fwlink/?LinkId=96604).</span></span>  
  
 <span data-ttu-id="c8c6d-105">模糊查找转换与查找转换之间的不同之处在于：它使用了模糊匹配。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-105">The Fuzzy Lookup transformation differs from the Lookup transformation in its use of fuzzy matching.</span></span> <span data-ttu-id="c8c6d-106">查找转换使用同等联接在引用表中查找匹配的记录。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-106">The Lookup transformation uses an equi-join to locate matching records in the reference table.</span></span> <span data-ttu-id="c8c6d-107">它返回带有至少一个匹配记录的记录，并且返回没有匹配记录的记录。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-107">It returns records with at least one matching record, and returns records with no matching records.</span></span> <span data-ttu-id="c8c6d-108">与此相比较，模糊查找转换使用模糊匹配返回引用表中一个或多个接近的匹配项。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-108">In contrast, the Fuzzy Lookup transformation uses fuzzy matching to return one or more close matches in the reference table.</span></span>  
  
 <span data-ttu-id="c8c6d-109">在包数据流中，模糊查找转换通常在查找转换之后。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-109">A Fuzzy Lookup transformation frequently follows a Lookup transformation in a package data flow.</span></span> <span data-ttu-id="c8c6d-110">首先，查找转换尝试找到一个完全匹配的项。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-110">First, the Lookup transformation tries to find an exact match.</span></span> <span data-ttu-id="c8c6d-111">如果未找到，模糊查找转换提供引用表中接近的匹配项。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-111">If it fails, the Fuzzy Lookup transformation provides close matches from the reference table.</span></span>  
  
 <span data-ttu-id="c8c6d-112">这种转换需要访问包含用于清理和扩展输入数据的值的引用数据源。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-112">The transformation needs access to a reference data source that contains the values that are used to clean and extend the input data.</span></span> <span data-ttu-id="c8c6d-113">引用数据源必须是 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 数据库中的表。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-113">The reference data source must be a table in a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database.</span></span> <span data-ttu-id="c8c6d-114">输入列中的值与引用表中的值之间的匹配可以是完全匹配，也可以是模糊匹配。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-114">The match between the value in an input column and the value in the reference table can be an exact match or a fuzzy match.</span></span> <span data-ttu-id="c8c6d-115">但是，这种转换要求至少为模糊匹配配置一个列匹配。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-115">However, the transformation requires at least one column match to be configured for fuzzy matching.</span></span> <span data-ttu-id="c8c6d-116">如果希望仅使用完全匹配，请改用查找转换。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-116">If you want to use only exact matching, use the Lookup transformation instead.</span></span>  
  
 <span data-ttu-id="c8c6d-117">此转换有一个输入和一个输出。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-117">This transformation has one input and one output.</span></span>  
  
 <span data-ttu-id="c8c6d-118">在模糊匹配中，只能使用具有 `DT_WSTR` 和 `DT_STR` 数据类型的输入列。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-118">Only input columns with the `DT_WSTR` and `DT_STR` data types can be used in fuzzy matching.</span></span> <span data-ttu-id="c8c6d-119">完全匹配可以使用除 `DT_TEXT`、`DT_NTEXT` 和 `DT_IMAGE` 之外的所有 DTS 数据类型。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-119">Exact matching can use any DTS data type except `DT_TEXT`, `DT_NTEXT`, and `DT_IMAGE`.</span></span> <span data-ttu-id="c8c6d-120">有关详细信息，请参阅 [Integration Services 数据类型](../integration-services-data-types.md)。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-120">For more information, see [Integration Services Data Types](../integration-services-data-types.md).</span></span> <span data-ttu-id="c8c6d-121">参与输入和引用表之间联接的列必须具有兼容的数据类型。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-121">Columns that participate in the join between the input and the reference table must have compatible data types.</span></span> <span data-ttu-id="c8c6d-122">例如，将具有 DTS 数据类型的列联接 `DT_WSTR` 到数据类型为的列是有效的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] `nvarchar` ，但将数据类型为的列联接 `DT_WSTR` 到具有数据类型的列是无效的 `int` 。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-122">For example, it is valid to join a column with the DTS `DT_WSTR` data type to a column with the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] `nvarchar` data type, but invalid to join a column with the `DT_WSTR` data type to a column with the `int` data type.</span></span>  
  
 <span data-ttu-id="c8c6d-123">通过指定最大内存量、行比较算法以及对转换所用的索引和引用表进行缓存，可以自定义这种转换。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-123">You can customize this transformation by specifying the maximum amount of memory, the row comparison algorithm, and the caching of indexes and reference tables that the transformation uses.</span></span>  
  
 <span data-ttu-id="c8c6d-124">可以通过设置 MaxMemoryUsage 自定义属性来配置模糊查找转换所使用的内存数量。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-124">The amount of memory that the Fuzzy Lookup transformation uses can be configured by setting the MaxMemoryUsage custom property.</span></span> <span data-ttu-id="c8c6d-125">可以指定内存量 (MB)；或使用值 0，让转换根据其需要和可用物理内存来使用动态内存量。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-125">You can specify the number of megabytes (MB), or use the value 0, which lets the transformation use a dynamic amount of memory based on its needs and the physical memory available.</span></span> <span data-ttu-id="c8c6d-126">加载包时，可以通过属性表达式来更新 MaxMemoryUsage 自定义属性。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-126">The MaxMemoryUsage custom property can be updated by a property expression when the package is loaded.</span></span> <span data-ttu-id="c8c6d-127">有关详细信息，请参阅 [Integration Services (SSIS) 表达式](../../expressions/integration-services-ssis-expressions.md)、[在包中使用属性表达式](../../expressions/use-property-expressions-in-packages.md)和[转换自定义属性](transformation-custom-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-127">For more information, see [Integration Services &#40;SSIS&#41; Expressions](../../expressions/integration-services-ssis-expressions.md), [Use Property Expressions in Packages](../../expressions/use-property-expressions-in-packages.md), and [Transformation Custom Properties](transformation-custom-properties.md).</span></span>  
  
## <a name="controlling-fuzzy-matching-behavior"></a><span data-ttu-id="c8c6d-128">控制模糊匹配的行为</span><span class="sxs-lookup"><span data-stu-id="c8c6d-128">Controlling Fuzzy Matching Behavior</span></span>  
 <span data-ttu-id="c8c6d-129">模糊查找转换包含以下三项可自定义所执行的查找的功能：每个输入行可返回的最大匹配项数、标记分隔符和相似性阈值。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-129">The Fuzzy Lookup transformation includes three features for customizing the lookup it performs: maximum number of matches to return per input row, token delimiters, and similarity thresholds.</span></span>  
  
 <span data-ttu-id="c8c6d-130">这种转换返回零个或多个匹配项，匹配项的最大数量为所指定的匹配项数。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-130">The transformation returns zero or more matches up to the number of matches specified.</span></span> <span data-ttu-id="c8c6d-131">指定最大匹配项数并不保证转换会返回最大数量的匹配项；它只保证转换最多返回该数量的匹配项。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-131">Specifying a maximum number of matches does not guarantee that the transformation returns the maximum number of matches; it only guarantees that the transformation returns at most that number of matches.</span></span> <span data-ttu-id="c8c6d-132">如果将最大匹配项数设置为大于 1 的值，则对于每次查找，转换的输出可能包括多行，而且其中一些行可能是重复的。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-132">If you set the maximum number of matches to a value greater than 1, the output of the transformation may include more than one row per lookup and some of the rows may be duplicates.</span></span>  
  
 <span data-ttu-id="c8c6d-133">该转换提供了一组用于对数据进行词汇切分的默认分隔符，但您可以添加适合自己数据需要的标记分隔符。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-133">The transformation provides a default set of delimiters used to tokenize the data, but you can add token delimiters to suit the needs of your data.</span></span> <span data-ttu-id="c8c6d-134">Delimiters 属性包含默认分隔符。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-134">The Delimiters property contains the default delimiters.</span></span> <span data-ttu-id="c8c6d-135">因为词汇切分在要进行比较的数据内定义相关单元，所以词汇切分是非常重要的操作。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-135">Tokenization is important because it defines the units within the data that are compared to each other.</span></span>  
  
 <span data-ttu-id="c8c6d-136">相似性阈值可以在组件级和联接级设置。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-136">The similarity thresholds can be set at the component and join levels.</span></span> <span data-ttu-id="c8c6d-137">仅当转换在输入中的列与引用表的列之间执行模糊匹配时，联接级相似性阈值才可用。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-137">The join-level similarity threshold is only available when the transformation performs a fuzzy match between columns in the input and the reference table.</span></span> <span data-ttu-id="c8c6d-138">相似性范围是 0 到 1。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-138">The similarity range is 0 to 1.</span></span> <span data-ttu-id="c8c6d-139">阈值越接近 1，则行和列必须越相似，才能被认定为重复。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-139">The closer to 1 the threshold is, the more similar the rows and columns must be to qualify as duplicates.</span></span> <span data-ttu-id="c8c6d-140">通过在组件级和联接级设置 MinSimilarity 属性，可以指定相似性阈值。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-140">You specify the similarity threshold by setting the MinSimilarity property at the component and join levels.</span></span> <span data-ttu-id="c8c6d-141">为了满足在组件级指定的相似性，所有匹配项的所有行都必须具有大于或等于在组件级所指定的相似性阈值的相似性。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-141">To satisfy the similarity that is specified at the component level, all rows must have a similarity across all matches that is greater than or equal to the similarity threshold that is specified at the component level.</span></span> <span data-ttu-id="c8c6d-142">即，您不能在组件级指定非常接近的匹配项，除非行级或联接级的匹配项同样接近。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-142">That is, you cannot specify a very close match at the component level unless the matches at the row or join level are equally close.</span></span>  
  
 <span data-ttu-id="c8c6d-143">每个匹配项都包括一个相似性得分和一个置信度得分。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-143">Each match includes a similarity score and a confidence score.</span></span> <span data-ttu-id="c8c6d-144">相似性得分是一个数学度量值，表示输入记录与模糊查找转换从引用表中返回的记录之间在结构上的相似程度。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-144">The similarity score is a mathematical measure of the textural similarity between the input record and the record that Fuzzy Lookup transformation returns from the reference table.</span></span> <span data-ttu-id="c8c6d-145">置信度得分是一个可能性的度量值，表示特定值在从引用表中所发现的匹配项中成为最佳匹配项的可能程度。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-145">The confidence score is a measure of how likely it is that a particular value is the best match among the matches found in the reference table.</span></span> <span data-ttu-id="c8c6d-146">分配给记录的置信度得分取决于所返回的其他匹配记录。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-146">The confidence score assigned to a record depends on the other matching records that are returned.</span></span> <span data-ttu-id="c8c6d-147">例如，匹配 *St.* 和 *Saint* 会返回一个较低的相似性得分，而无论其他匹配项是什么。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-147">For example, matching *St.* and *Saint* returns a low similarity score regardless of other matches.</span></span> <span data-ttu-id="c8c6d-148">如果 *Saint* 是返回的唯一匹配项，则置信度得分会很高。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-148">If *Saint* is the only match returned, the confidence score is high.</span></span> <span data-ttu-id="c8c6d-149">如果 *Saint* 和 *St.* 同时出现在引用表中，则 *St.* 的置信度较高，而 *Saint* 的置信度较低。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-149">If both *Saint* and *St.* appear in the reference table, the confidence in *St.* is high and the confidence in *Saint* is low.</span></span> <span data-ttu-id="c8c6d-150">但是，高相似性可能并不意味着高置信度。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-150">However, high similarity may not mean high confidence.</span></span> <span data-ttu-id="c8c6d-151">例如，如果正在查找值 *Chapter 4*，返回的结果 *Chapter 1*、 *Chapter 2*和 *Chapter 3* 都具有很高的相似性得分，然而置信度得分却都较低，这是因为无法肯定哪个结果是最佳匹配项。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-151">For example, if you are looking up the value *Chapter 4*, the returned results *Chapter 1*, *Chapter 2*, and *Chapter 3* have a high similarity score but a low confidence score because it is unclear which of the results is the best match.</span></span>  
  
 <span data-ttu-id="c8c6d-152">相似性得分由介于 0 和 1 之间的一个小数值表示，其中，相似性得分 1 表示输入列中的值与引用表中的值完全匹配。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-152">The similarity score is represented by a decimal value between 0 and 1, where a similarity score of 1 means an exact match between the value in the input column and the value in the reference table.</span></span> <span data-ttu-id="c8c6d-153">置信度得分也是介于 0 和 1 之间的一个小数值，表示对匹配项的置信度。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-153">The confidence score, also a decimal value between 0 and 1, indicates the confidence in the match.</span></span> <span data-ttu-id="c8c6d-154">如果没有发现有用的匹配项，则为该行分配相似性得分 0 和置信度得分 0，并且从引用表中复制的输出列会包含 Null 值。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-154">If no usable match is found, similarity and confidence scores of 0 are assigned to the row, and the output columns copied from the reference table will contain null values.</span></span>  
  
 <span data-ttu-id="c8c6d-155">有时，模糊查找可能在引用表中找不到相应的匹配项。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-155">Sometimes, Fuzzy Lookup may not locate appropriate matches in the reference table.</span></span> <span data-ttu-id="c8c6d-156">如果查找中使用的输入值是一个短单词，则可能会发生这种情况。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-156">This can occur if the input value that is used in a lookup is a single, short word.</span></span> <span data-ttu-id="c8c6d-157">例如，如果该列或行中的任何其他列中都没有任何其他标记，则 *helo* 与引用表中的 *hello* 不匹配。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-157">For example, *helo* is not matched with the value *hello* in a reference table when no other tokens are present in that column or any other column in the row.</span></span>  
  
 <span data-ttu-id="c8c6d-158">该转换的输出列包括标记为传递列的输入列、查找表中的选定列和以下其他列：</span><span class="sxs-lookup"><span data-stu-id="c8c6d-158">The transformation output columns include the input columns that are marked as pass-through columns, the selected columns in the lookup table, and the following additional columns:</span></span>  
  
-   <span data-ttu-id="c8c6d-159">**_Similarity**，此列描述输入列中的值和引用列中的值之间的相似性。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-159">**_Similarity**, a column that describes the similarity between values in the input and reference columns.</span></span>  
  
-   <span data-ttu-id="c8c6d-160">**_Confidence**，此列描述匹配程度。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-160">**_Confidence**, a column that describes the quality of the match.</span></span>  
  
 <span data-ttu-id="c8c6d-161">该转换使用与 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 数据库的连接来创建模糊匹配算法所使用的临时表。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-161">The transformation uses the connection to the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database to create the temporary tables that the fuzzy matching algorithm uses.</span></span>  
  
## <a name="running-the-fuzzy-lookup-transformation"></a><span data-ttu-id="c8c6d-162">运行模糊查找转换</span><span class="sxs-lookup"><span data-stu-id="c8c6d-162">Running the Fuzzy Lookup Transformation</span></span>  
 <span data-ttu-id="c8c6d-163">当包首次运行转换时，该转换将复制引用表，然后将具有整数数据类型的键添加到新表中，接着生成该键列的索引。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-163">When the package first runs the transformation, the transformation copies the reference table, adds a key with an integer data type to the new table, and builds an index on the key column.</span></span> <span data-ttu-id="c8c6d-164">随后，该转换生成引用表的副本的索引，该索引称为匹配索引。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-164">Next, the transformation builds an index, called a match index, on the copy of the reference table.</span></span> <span data-ttu-id="c8c6d-165">匹配索引存储转换输入列中的值的词汇切分结果，接着该转换在查找操作中使用这些标记。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-165">The match index stores the results of tokenizing the values in the transformation input columns, and the transformation then uses the tokens in the lookup operation.</span></span> <span data-ttu-id="c8c6d-166">匹配索引是 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 数据库中的一个表。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-166">The match index is a table in a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database.</span></span>  
  
 <span data-ttu-id="c8c6d-167">当包再次运行时，该转换可以使用现有的匹配索引，也可以创建新的索引。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-167">When the package runs again, the transformation can either use an existing match index or create a new index.</span></span> <span data-ttu-id="c8c6d-168">如果引用表是静态的，对于数据清理的重复会话，包可以避免开销可能很大的重新生成索引的过程。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-168">If the reference table is static, the package can avoid the potentially expensive process of rebuilding the index for repeat sessions of data cleaning.</span></span> <span data-ttu-id="c8c6d-169">您可以选择使用现有索引，该索引是在包首次运行时创建的。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-169">If you choose to use an existing index, the index is created the first time that the package runs.</span></span> <span data-ttu-id="c8c6d-170">如果多个模糊查找转换使用同一引用表，则它们可以使用同一索引。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-170">If multiple Fuzzy Lookup transformations use the same reference table, they can all use the same index.</span></span> <span data-ttu-id="c8c6d-171">若要重用该索引，查找操作必须是相同的，而且查找必须使用相同的列。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-171">To reuse the index, the lookup operations must be identical; the lookup must use the same columns.</span></span> <span data-ttu-id="c8c6d-172">您可以命名该索引，然后选择到保存该索引的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 数据库的连接。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-172">You can name the index and select the connection to the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database that saves the index.</span></span>  
  
 <span data-ttu-id="c8c6d-173">如果该转换保存了匹配索引，则匹配索引将得到自动维护。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-173">If the transformation saves the match index, the match index can be maintained automatically.</span></span> <span data-ttu-id="c8c6d-174">这意味着，每次更新引用表中的记录时，也会更新匹配索引。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-174">This means that every time a record in the reference table is updated, the match index is also updated.</span></span> <span data-ttu-id="c8c6d-175">维护匹配索引可以节省处理时间，因为无需在包运行时重新生成索引。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-175">Maintaining the match index can save processing time, because the index does not have to be rebuilt when the package runs.</span></span> <span data-ttu-id="c8c6d-176">您可以指定该转换如何管理匹配索引。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-176">You can specify how the transformation manages the match index.</span></span>  
  
 <span data-ttu-id="c8c6d-177">下表介绍了匹配索引选项：</span><span class="sxs-lookup"><span data-stu-id="c8c6d-177">The following table describes the match index options.</span></span>  
  
|<span data-ttu-id="c8c6d-178">选项</span><span class="sxs-lookup"><span data-stu-id="c8c6d-178">Option</span></span>|<span data-ttu-id="c8c6d-179">说明</span><span class="sxs-lookup"><span data-stu-id="c8c6d-179">Description</span></span>|  
|------------|-----------------|  
|<span data-ttu-id="c8c6d-180">**GenerateAndMaintainNewIndex**</span><span class="sxs-lookup"><span data-stu-id="c8c6d-180">**GenerateAndMaintainNewIndex**</span></span>|<span data-ttu-id="c8c6d-181">创建一个新的索引，保存它，然后对其进行维护。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-181">Create a new index, save it, and maintain it.</span></span> <span data-ttu-id="c8c6d-182">该转换在引用表上安装触发器，使引用表和索引表同步。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-182">The transformation installs triggers on the reference table to keep the reference table and index table synchronized.</span></span>|  
|<span data-ttu-id="c8c6d-183">**GenerateAndPersistNewIndex**</span><span class="sxs-lookup"><span data-stu-id="c8c6d-183">**GenerateAndPersistNewIndex**</span></span>|<span data-ttu-id="c8c6d-184">创建一个新的索引，保存它，但不对其进行维护。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-184">Create a new index and save it, but do not maintain it.</span></span>|  
|<span data-ttu-id="c8c6d-185">**GenerateNewIndex**</span><span class="sxs-lookup"><span data-stu-id="c8c6d-185">**GenerateNewIndex**</span></span>|<span data-ttu-id="c8c6d-186">创建一个新的索引，但不保存它。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-186">Create a new index, but do not save it.</span></span>|  
|<span data-ttu-id="c8c6d-187">**ReuseExistingIndex**</span><span class="sxs-lookup"><span data-stu-id="c8c6d-187">**ReuseExistingIndex**</span></span>|<span data-ttu-id="c8c6d-188">重用现有索引。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-188">Reuse an existing index.</span></span>|  
  
### <a name="maintenance-of-the-match-index-table"></a><span data-ttu-id="c8c6d-189">维护匹配索引表</span><span class="sxs-lookup"><span data-stu-id="c8c6d-189">Maintenance of the Match Index Table</span></span>  
 <span data-ttu-id="c8c6d-190">**GenerateAndMaintainNewIndex** 选项在引用表上安装触发器，以保持匹配索引表和引用表同步。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-190">The **GenerateAndMaintainNewIndex** option installs triggers on the reference table to keep the match index table and the reference table synchronized.</span></span> <span data-ttu-id="c8c6d-191">如果必须删除已安装的触发器，则必须运行 **sp_FuzzyLookupTableMaintenanceUnInstall** 存储过程，然后将 MatchIndexName 属性中指定的名称提供为输入参数值。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-191">If you have to remove the installed trigger, you must run the **sp_FuzzyLookupTableMaintenanceUnInstall** stored procedure, and provide the name specified in the MatchIndexName property as the input parameter value.</span></span>  
  
 <span data-ttu-id="c8c6d-192">在运行 **sp_FuzzyLookupTableMaintenanceUnInstall** 存储过程之前，不应该删除维护的匹配索引表。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-192">You should not delete the maintained match index table before running the **sp_FuzzyLookupTableMaintenanceUnInstall** stored procedure.</span></span> <span data-ttu-id="c8c6d-193">如果删除了匹配索引表，引用表上的触发器将无法正确执行。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-193">If the match index table is deleted, the triggers on the reference table will not execute correctly.</span></span> <span data-ttu-id="c8c6d-194">在手动删除引用表上的触发器之前，对引用表进行的所有后续更新都将失败。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-194">All subsequent updates to the reference table will fail until you manually drop the triggers on the reference table.</span></span>  
  
 <span data-ttu-id="c8c6d-195">SQL TRUNCATE TABLE 命令不调用 DELETE 触发器。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-195">The SQL TRUNCATE TABLE command does not invoke DELETE triggers.</span></span> <span data-ttu-id="c8c6d-196">如果对引用表使用 TRUNCATE TABLE 命令，则引用表和匹配索引表将无法再同步，模糊查找转换将失败。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-196">If the TRUNCATE TABLE command is used on the reference table, the reference table and the match index will no longer be synchronized and the Fuzzy Lookup transformation fails.</span></span> <span data-ttu-id="c8c6d-197">尽管维护匹配索引表的触发器安装在引用表上，您也应该使用 SQL DELETE 命令，而不是使用 TRUNCATE TABLE 命令。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-197">While the triggers that maintain the match index table are installed on the reference table, you should use the SQL DELETE command instead of the TRUNCATE TABLE command.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="c8c6d-198">如果在 **“模糊查找转换编辑器”** 的 **“引用表”** 选项卡中选择 **“维护存储的索引”** ，则转换将使用托管存储过程维护索引。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-198">When you select **Maintain stored index** on the **Reference Table** tab of the **Fuzzy Lookup Transformation Editor**, the transformation uses managed stored procedures to maintain the index.</span></span> <span data-ttu-id="c8c6d-199">这些托管存储过程使用 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]中的公共语言运行时 (CLR) 集成功能。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-199">These managed stored procedures use the common language runtime (CLR) integration feature in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="c8c6d-200">默认情况下，不启用 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 中的 CLR 集成。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-200">By default, CLR integration in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is not enabled.</span></span> <span data-ttu-id="c8c6d-201">若要使用 **“维护存储的索引”** 功能，必须启用 CLR 集成。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-201">To use the **Maintain stored index** functionality, you must enable CLR integration.</span></span> <span data-ttu-id="c8c6d-202">有关详细信息，请参阅 [Enabling CLR Integration](../../../relational-databases/clr-integration/clr-integration-enabling.md)。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-202">For more information, see [Enabling CLR Integration](../../../relational-databases/clr-integration/clr-integration-enabling.md).</span></span>  
>   
>  <span data-ttu-id="c8c6d-203">由于 **“维护存储的索引”** 选项需要 CLR 集成，所以只有在选择已启用 CLR 集成的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例上的引用表时，此功能才能发挥作用。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-203">Because the **Maintain stored index** option requires CLR integration, this feature works only when you select a reference table on an instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] where CLR integration is enabled.</span></span>  
  
## <a name="row-comparison"></a><span data-ttu-id="c8c6d-204">行比较</span><span class="sxs-lookup"><span data-stu-id="c8c6d-204">Row Comparison</span></span>  
 <span data-ttu-id="c8c6d-205">配置模糊查找转换时，可以指定该转换在定位引用表中的匹配记录时所用的比较算法。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-205">When you configure the Fuzzy Lookup transformation, you can specify the comparison algorithm that the transformation uses to locate matching records in the reference table.</span></span> <span data-ttu-id="c8c6d-206">如果将 "穷举" 属性设置为 `True` ，则转换会将输入中的每一行与引用表中的每一行进行比较。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-206">If you set the Exhaustive property to `True`, the transformation compares every row in the input to every row in the reference table.</span></span> <span data-ttu-id="c8c6d-207">这种比较算法可以生成更准确的结果，但是，除非引用表中的行数较少，否则很有可能使转换的执行速度变得很慢。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-207">This comparison algorithm may produce more accurate results, but it is likely to make the transformation perform more slowly unless the number of rows is the reference table is small.</span></span> <span data-ttu-id="c8c6d-208">如果穷举属性设置为，则 `True` 整个引用表都会加载到内存中。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-208">If the Exhaustive property is set to `True`, the entire reference table is loaded into memory.</span></span> <span data-ttu-id="c8c6d-209">若要避免性能问题，最好 `True` 在包开发过程中将详尽的属性设置为。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-209">To avoid performance issues, it is advisable to set the Exhaustive property to `True` during package development only.</span></span>  
  
 <span data-ttu-id="c8c6d-210">如果将详尽的属性设置为 `False` ，则模糊查找转换只返回至少具有一个索引标记或子字符串的匹配项， (子字符串称为*q 语法*) 与输入记录共有。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-210">If the Exhaustive property is set to `False`, the Fuzzy Lookup transformation returns only matches that have at least one indexed token or substring (the substring is called a *q-gram*) in common with the input record.</span></span> <span data-ttu-id="c8c6d-211">若要最大程度提高查找效率，请以模糊查找转换查找匹配项时所用的倒排索引结构仅对表内每行中的一个令牌子集建立索引。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-211">To maximize the efficiency of lookups, only a subset of the tokens in each row in the table is indexed in the inverted index structure that the Fuzzy Lookup transformation uses to locate matches.</span></span> <span data-ttu-id="c8c6d-212">当输入数据集很小时，可以将 "穷举" 设置为， `True` 以避免在索引表中不存在任何公共标记的缺失匹配项。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-212">When the input dataset is small, you can set Exhaustive to `True` to avoid missing matches for which no common tokens exist in the index table.</span></span>  
  
## <a name="caching-of-indexes-and-reference-tables"></a><span data-ttu-id="c8c6d-213">缓存索引和引用表</span><span class="sxs-lookup"><span data-stu-id="c8c6d-213">Caching of Indexes and Reference Tables</span></span>  
 <span data-ttu-id="c8c6d-214">在配置模糊查找转换时，可以指定转换在开始执行其工作之前，是否将部分索引和引用表缓存到内存中。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-214">When you configure the Fuzzy Lookup transformation, you can specify whether the transformation partially caches the index and reference table in memory before the transformation does its work.</span></span> <span data-ttu-id="c8c6d-215">如果将 WarmCaches 属性设置为 `True` ，则索引和引用表将加载到内存中。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-215">If you set the WarmCaches property to `True`, the index and reference table are loaded into memory.</span></span> <span data-ttu-id="c8c6d-216">当输入具有很多行时，将 WarmCaches 属性设置为 `True` 可以提高转换的性能。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-216">When the input has many rows, setting the WarmCaches property to `True` can improve the performance of the transformation.</span></span> <span data-ttu-id="c8c6d-217">当输入行数很小时，将 WarmCaches 属性设置为 `False` 可以更快地重复使用较大的索引。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-217">When the number of input rows is small, setting the WarmCaches property to `False` can make the reuse of a large index faster.</span></span>  
  
## <a name="temporary-tables-and-indexes"></a><span data-ttu-id="c8c6d-218">临时表和索引</span><span class="sxs-lookup"><span data-stu-id="c8c6d-218">Temporary Tables and Indexes</span></span>  
 <span data-ttu-id="c8c6d-219">在运行时，模糊查找转换会在该转换所连接到的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 数据库中创建临时对象，例如表和索引。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-219">At run time, the Fuzzy Lookup transformation creates temporary objects, such as tables and indexes, in the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database that the transformation connects to.</span></span> <span data-ttu-id="c8c6d-220">这些临时表和索引的大小与引用表中的行数和标记数以及模糊查找转换所创建的标记数成比例；因此，它们有可能会占用相当大的磁盘空间。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-220">The size of these temporary tables and indexes is proportionate to the number of rows and tokens in the reference table and the number of tokens that the Fuzzy Lookup transformation creates; therefore, they could potentially consume a significant amount of disk space.</span></span> <span data-ttu-id="c8c6d-221">该转换也会查询这些临时表。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-221">The transformation also queries these temporary tables.</span></span> <span data-ttu-id="c8c6d-222">因此，应该考虑将模糊查找转换连接到 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 数据库的非生产实例中，在生产服务器只有有限的可用磁盘空间时，尤其应该如此。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-222">You should therefore consider connecting the Fuzzy Lookup transformation to a non-production instance of a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database, especially if the production server has limited disk space available.</span></span>  
  
 <span data-ttu-id="c8c6d-223">如果此转换所使用的表和索引位于本地计算机，则此转换的性能可能会提高。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-223">The performance of this transformation may improve if the tables and indexes it uses are located on the local computer.</span></span> <span data-ttu-id="c8c6d-224">如果模糊查找转换使用的引用表位于生产服务器上，您应该考虑将该表复制到非生产服务器，并将模糊查找转换配置为访问该副本。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-224">If the reference table that the Fuzzy Lookup transformation uses is on the production server, you should consider copying the table to a non-production server and configuring the Fuzzy Lookup transformation to access the copy.</span></span> <span data-ttu-id="c8c6d-225">这样做可以防止查找查询占用生产服务器上的资源。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-225">By doing this, you can prevent the lookup queries from consuming resources on the production server.</span></span> <span data-ttu-id="c8c6d-226">此外，如果模糊查找转换维护匹配索引（即如果 MatchIndexOptionsis 设置为“GenerateAndMaintainNewIndex”），则转换可以在执行数据清理操作的过程中锁定引用表，以防止其他用户和应用程序访问该表  。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-226">In addition, if the Fuzzy Lookup transformation maintains the match index-that is, if MatchIndexOptionsis set to **GenerateAndMaintainNewIndex**-the transformation may lock the reference table for the duration of the data cleaning operation and prevent other users and applications from accessing the table.</span></span>  
  
## <a name="configuring-the-fuzzy-lookup-transformation"></a><span data-ttu-id="c8c6d-227">配置模糊查找转换</span><span class="sxs-lookup"><span data-stu-id="c8c6d-227">Configuring the Fuzzy Lookup Transformation</span></span>  
 <span data-ttu-id="c8c6d-228">可以通过 [!INCLUDE[ssIS](../../../includes/ssis-md.md)] 设计器或以编程方式来设置属性。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-228">You can set properties through [!INCLUDE[ssIS](../../../includes/ssis-md.md)] Designer or programmatically.</span></span>  
  
 <span data-ttu-id="c8c6d-229">有关可以在 **“模糊查找转换编辑器”** 对话框中设置的属性的详细信息，请单击下列主题之一：</span><span class="sxs-lookup"><span data-stu-id="c8c6d-229">For more information about the properties that you can set in the **Fuzzy Lookup Transformation Editor** dialog box, click one of the following topics:</span></span>  
  
-   [<span data-ttu-id="c8c6d-230">模糊查找转换编辑器（“引用表”选项卡）</span><span class="sxs-lookup"><span data-stu-id="c8c6d-230">Fuzzy Lookup Transformation Editor &#40;Reference Table Tab&#41;</span></span>](../../fuzzy-lookup-transformation-editor-reference-table-tab.md)  
  
-   [<span data-ttu-id="c8c6d-231">模糊查找转换编辑器（“列”选项卡）</span><span class="sxs-lookup"><span data-stu-id="c8c6d-231">Fuzzy Lookup Transformation Editor &#40;Columns Tab&#41;</span></span>](../../fuzzy-lookup-transformation-editor-columns-tab.md)  
  
-   [<span data-ttu-id="c8c6d-232">模糊查找转换编辑器（“高级”选项卡）</span><span class="sxs-lookup"><span data-stu-id="c8c6d-232">Fuzzy Lookup Transformation Editor &#40;Advanced Tab&#41;</span></span>](../../fuzzy-lookup-transformation-editor-advanced-tab.md)  
  
 <span data-ttu-id="c8c6d-233">有关可以在 **“高级编辑器”** 对话框中或以编程方式设置的属性的详细信息，请单击下列主题之一：</span><span class="sxs-lookup"><span data-stu-id="c8c6d-233">For more information about the properties that you can set in the **Advanced Editor** dialog box or programmatically, click one of the following topics:</span></span>  
  
-   [<span data-ttu-id="c8c6d-234">Common Properties</span><span class="sxs-lookup"><span data-stu-id="c8c6d-234">Common Properties</span></span>](../../common-properties.md)  
  
-   [<span data-ttu-id="c8c6d-235">转换自定义属性</span><span class="sxs-lookup"><span data-stu-id="c8c6d-235">Transformation Custom Properties</span></span>](transformation-custom-properties.md)  
  
## <a name="related-tasks"></a><span data-ttu-id="c8c6d-236">Related Tasks</span><span class="sxs-lookup"><span data-stu-id="c8c6d-236">Related Tasks</span></span>  
 <span data-ttu-id="c8c6d-237">有关如何设置数据流组件属性的详细信息，请参阅 [设置数据流组件属性](../set-the-properties-of-a-data-flow-component.md)。</span><span class="sxs-lookup"><span data-stu-id="c8c6d-237">For details about how to set properties of a data flow component, see [Set the Properties of a Data Flow Component](../set-the-properties-of-a-data-flow-component.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="c8c6d-238">另请参阅</span><span class="sxs-lookup"><span data-stu-id="c8c6d-238">See Also</span></span>  
 <span data-ttu-id="c8c6d-239">[查找转换](lookup-transformation.md) </span><span class="sxs-lookup"><span data-stu-id="c8c6d-239">[Lookup Transformation](lookup-transformation.md) </span></span>  
 <span data-ttu-id="c8c6d-240">[模糊分组转换](fuzzy-grouping-transformation.md) </span><span class="sxs-lookup"><span data-stu-id="c8c6d-240">[Fuzzy Grouping Transformation](fuzzy-grouping-transformation.md) </span></span>  
 [<span data-ttu-id="c8c6d-241">Integration Services 转换</span><span class="sxs-lookup"><span data-stu-id="c8c6d-241">Integration Services Transformations</span></span>](integration-services-transformations.md)  
  
  
