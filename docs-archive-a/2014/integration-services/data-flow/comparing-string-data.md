---
title: 比较字符串数据 | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
helpviewer_keywords:
- comparing string data
- comparison options [Integration Services]
- locales [Integration Services]
- converting string data
- string comparisons
ms.assetid: 93aeb5bd-e208-46b7-8979-dea2dcd37d4c
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 5670f434470d8fad0a8b593ccde0c01ae307e417
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87590313"
---
# <a name="comparing-string-data"></a><span data-ttu-id="b772f-102">比较字符串数据</span><span class="sxs-lookup"><span data-stu-id="b772f-102">Comparing String Data</span></span>
  <span data-ttu-id="b772f-103">字符串比较是由 [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)]执行的许多转换中的重要组成部分，字符串比较也用在变量表达式和属性表达式的求值中。</span><span class="sxs-lookup"><span data-stu-id="b772f-103">String comparisons are an important part of many of the transformations performed by [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)], and string comparisons are also used in the evaluation of expressions in variables and property expressions.</span></span> <span data-ttu-id="b772f-104">例如，排序转换比较数据集中的值，从而以升序或降序对数据进行排序。</span><span class="sxs-lookup"><span data-stu-id="b772f-104">For example, the Sort transformation compares values in a dataset to sort data in ascending or descending order.</span></span>  
  
## <a name="configuring-transformations-for-string-comparisons"></a><span data-ttu-id="b772f-105">为字符串比较配置转换</span><span class="sxs-lookup"><span data-stu-id="b772f-105">Configuring Transformations for String Comparisons</span></span>  
 <span data-ttu-id="b772f-106">可以自定义排序、聚合、模糊分组和模糊查找转换，以更改在列级比较字符串的方式。</span><span class="sxs-lookup"><span data-stu-id="b772f-106">The Sort, Aggregate, Fuzzy Grouping, and Fuzzy Lookup transformations can be customized to change the way strings are compared at the column level.</span></span> <span data-ttu-id="b772f-107">例如，可以指定进行比较时忽略大小写，这意味着大写字符和小写字符将被视为相同的字符。</span><span class="sxs-lookup"><span data-stu-id="b772f-107">For example, you can specify that a comparison ignores case, which means that uppercase and lowercase characters are treated as the same character.</span></span>  
  
 <span data-ttu-id="b772f-108">下列转换使用可以包含字符串比较的表达式。</span><span class="sxs-lookup"><span data-stu-id="b772f-108">The following transformations use expressions that can include string comparisons.</span></span>  
  
-   <span data-ttu-id="b772f-109">有条件拆分转换可以在表达式中使用字符串比较，以确定将数据行发送到哪个输出。</span><span class="sxs-lookup"><span data-stu-id="b772f-109">The Conditional Split transformation can use string comparisons in expressions to determine which output to send the data row to.</span></span> <span data-ttu-id="b772f-110">有关详细信息，请参阅 [Conditional Split Transformation](transformations/conditional-split-transformation.md)。</span><span class="sxs-lookup"><span data-stu-id="b772f-110">For more information, see [Conditional Split Transformation](transformations/conditional-split-transformation.md).</span></span>  
  
-   <span data-ttu-id="b772f-111">派生列转换可以在表达式中使用字符串比较，以生成新的列值。</span><span class="sxs-lookup"><span data-stu-id="b772f-111">The Derived Column transformation can use string comparisons in expressions to generate new column values.</span></span> <span data-ttu-id="b772f-112">有关详细信息，请参阅 [派生列转换](transformations/derived-column-transformation.md)。</span><span class="sxs-lookup"><span data-stu-id="b772f-112">For more information, see [Derived Column Transformation](transformations/derived-column-transformation.md).</span></span>  
  
 <span data-ttu-id="b772f-113">变量、变量映射和优先约束也使用可以包含字符串比较的表达式。</span><span class="sxs-lookup"><span data-stu-id="b772f-113">Variables, variable mappings, and precedence constraints also use expressions, which can include string comparisons.</span></span> <span data-ttu-id="b772f-114">有关表达式的详细信息，请参阅 [Integration Services (SSIS) 表达式](../expressions/integration-services-ssis-expressions.md)。</span><span class="sxs-lookup"><span data-stu-id="b772f-114">For more information about expressions, see [Integration Services &#40;SSIS&#41; Expressions](../expressions/integration-services-ssis-expressions.md).</span></span>  
  
## <a name="processing-during-string-comparison"></a><span data-ttu-id="b772f-115">字符串比较期间的处理</span><span class="sxs-lookup"><span data-stu-id="b772f-115">Processing during String Comparison</span></span>  
 <span data-ttu-id="b772f-116">根据数据和转换的配置，在字符串数据比较的过程中可能需要进行下列处理：</span><span class="sxs-lookup"><span data-stu-id="b772f-116">Depending on the data and the configuration of the transformation, the following processing may occur during the comparison of string data:</span></span>  
  
-   <span data-ttu-id="b772f-117">将数据转换为 Unicode 数据。</span><span class="sxs-lookup"><span data-stu-id="b772f-117">Converting data to Unicode.</span></span> <span data-ttu-id="b772f-118">如果源数据尚不是 Unicode 数据，则自动将其转换为 Unicode 数据，然后开始比较。</span><span class="sxs-lookup"><span data-stu-id="b772f-118">If the source data is not already Unicode, the data is automatically converted to Unicode before the comparison occurs.</span></span>  
  
-   <span data-ttu-id="b772f-119">使用区域设置以应用区域设置特定的规则来解释日期、时间、十进制数据和排序顺序。</span><span class="sxs-lookup"><span data-stu-id="b772f-119">Using locale to apply locale-specific rules for interpreting date, time, decimal data, and sort order.</span></span>  
  
-   <span data-ttu-id="b772f-120">在列级应用比较选项以更改比较敏感度。</span><span class="sxs-lookup"><span data-stu-id="b772f-120">Applying comparison options at the column level to change the sensitivity of comparisons.</span></span>  
  
## <a name="converting-string-data-to-unicode"></a><span data-ttu-id="b772f-121">将字符串数据转换为 Unicode 数据</span><span class="sxs-lookup"><span data-stu-id="b772f-121">Converting String Data to Unicode</span></span>  
 <span data-ttu-id="b772f-122">根据转换执行的操作和转换的配置，字符串数据可能被转换为 DT_WSTR 数据类型，这是字符串字符的 Unicode 表示形式。</span><span class="sxs-lookup"><span data-stu-id="b772f-122">Depending on the operations that the transformation performs and the configuration of the transformation, string data may be converted to the DT_WSTR data type, which is a Unicode representation of string characters.</span></span>  
  
 <span data-ttu-id="b772f-123">使用列的代码页可以将具有 DT_STR 数据类型的字符串数据转换为 Unicode 数据。</span><span class="sxs-lookup"><span data-stu-id="b772f-123">String data that has the DT_STR data type is converted to Unicode using the code page of the column.</span></span> [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] <span data-ttu-id="b772f-124">支持列级代码页，使用不同的代码页可以转换每个列。</span><span class="sxs-lookup"><span data-stu-id="b772f-124">supports code pages at the column level, and each column can be converted by using a different code page.</span></span>  
  
 <span data-ttu-id="b772f-125">在大多数情况下， [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] 可以从数据源中识别出正确的代码页。</span><span class="sxs-lookup"><span data-stu-id="b772f-125">In most cases, [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] can identify the correct code page from the data source.</span></span> <span data-ttu-id="b772f-126">例如，在 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 中，您可以在数据库和列级设置排序规则。</span><span class="sxs-lookup"><span data-stu-id="b772f-126">For example, in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] you can set a collation at the database and column levels.</span></span> <span data-ttu-id="b772f-127">代码页从 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 排序规则派生，这些规则可以是 Windows 排序规则或 SQL 排序规则。</span><span class="sxs-lookup"><span data-stu-id="b772f-127">The code page is derived from a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] collation, which can be either a Windows or an SQL collation.</span></span>  
  
 <span data-ttu-id="b772f-128">如果 [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] 提供了意外的代码页，或包访问数据源时使用的访问接口未提供确定正确的代码页所需的足够信息，那么您可以在 OLE DB 源和 OLE DB 目标中指定一个默认代码页。</span><span class="sxs-lookup"><span data-stu-id="b772f-128">If [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] provides an unexpected code page, or if the package accesses a data source by using a provider that does not supply sufficient information to determine the correct code page, you can specify a default code page in the OLE DB source and the OLE DB destination.</span></span> <span data-ttu-id="b772f-129">这样，在出现这种情况时将使用默认的代码页，而不使用 [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] 提供的代码页。</span><span class="sxs-lookup"><span data-stu-id="b772f-129">The default code pages are used instead of the code pages that [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] provides.</span></span>  
  
 <span data-ttu-id="b772f-130">文件没有代码页。</span><span class="sxs-lookup"><span data-stu-id="b772f-130">Files do not have code pages.</span></span> <span data-ttu-id="b772f-131">此时，包用来连接到文件数据的平面文件和多平面文件连接管理器，会包含一个用于指定文件的代码页的属性。</span><span class="sxs-lookup"><span data-stu-id="b772f-131">Instead, the Flat File and the Multiple Flat Files connection managers that a package uses to connect to file data include a property for specifying the code page of the file.</span></span> <span data-ttu-id="b772f-132">代码页只能在文件级设置，不能在列级设置。</span><span class="sxs-lookup"><span data-stu-id="b772f-132">The code page can be set at the file level only, not at the column level.</span></span>  
  
## <a name="setting-locale"></a><span data-ttu-id="b772f-133">设置区域</span><span class="sxs-lookup"><span data-stu-id="b772f-133">Setting Locale</span></span>  
 [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] <span data-ttu-id="b772f-134">不使用代码页来推断对数据排序或解释日期、时间和十进制数据时遵循的区域设置特定的规则。</span><span class="sxs-lookup"><span data-stu-id="b772f-134">does not use the code page to infer locale-specific rules for sorting data or interpreting date, time, and decimal data.</span></span> <span data-ttu-id="b772f-135">相反，转换会读取在数据流组件、数据流任务、容器或包上的 LocaleId 属性所设置的区域设置。</span><span class="sxs-lookup"><span data-stu-id="b772f-135">Instead, the transformation reads the locale that is set by the LocaleId property on the data flow component, Data Flow task, container, or package.</span></span> <span data-ttu-id="b772f-136">默认情况下，转换从其数据流任务继承区域设置，而数据流任务又从包继承。</span><span class="sxs-lookup"><span data-stu-id="b772f-136">By default, the locale of a transformation is inherited from its Data Flow task, which in turn inherits from the package.</span></span> <span data-ttu-id="b772f-137">如果数据流任务位于像 For 循环容器这样的容器中，那么此数据流任务将从该容器中继承其区域设置。</span><span class="sxs-lookup"><span data-stu-id="b772f-137">If the Data Flow task is in a container such as the For Loop container, it inherits its locale from the container.</span></span>  
  
 <span data-ttu-id="b772f-138">还可以为平面文件连接管理器和多平面文件连接管理器指定区域设置。</span><span class="sxs-lookup"><span data-stu-id="b772f-138">You can also specify a locale for a Flat File connection manager and a Multiple Flat Files connection manager.</span></span>  
  
## <a name="setting-comparison-options"></a><span data-ttu-id="b772f-139">设置比较选项</span><span class="sxs-lookup"><span data-stu-id="b772f-139">Setting Comparison Options</span></span>  
 <span data-ttu-id="b772f-140">区域设置提供了比较字符串数据的基本规则。</span><span class="sxs-lookup"><span data-stu-id="b772f-140">The locale provides the basic rules for comparing string data.</span></span> <span data-ttu-id="b772f-141">例如，区域设置指定了字母表中每个字母的排序位置。</span><span class="sxs-lookup"><span data-stu-id="b772f-141">For example, the locale specifies the sort position of each letter in the alphabet.</span></span> <span data-ttu-id="b772f-142">但是，当执行某些转换的比较时，这些规则可能还不够，不过， [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] 支持一组比区域设置比较规则更详尽的高级比较选项。</span><span class="sxs-lookup"><span data-stu-id="b772f-142">However, these rules may not be sufficient for the comparisons that some transformations perform, and [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] supports a set of advanced comparison options that go beyond the comparison rules of a locale.</span></span> <span data-ttu-id="b772f-143">这些比较选项在列级设置。</span><span class="sxs-lookup"><span data-stu-id="b772f-143">These comparison options are set at the column level.</span></span> <span data-ttu-id="b772f-144">例如，利用这些比较选项之一，您可以忽略非空格字符。</span><span class="sxs-lookup"><span data-stu-id="b772f-144">For example, one of the comparison options lets you ignore nonspacing characters.</span></span> <span data-ttu-id="b772f-145">此选项的作用是忽略重音，如强调，这会使 "a" 和 "时" 与比较目的相同。</span><span class="sxs-lookup"><span data-stu-id="b772f-145">The effect of this option is to ignore diacritics such as the accent, which makes "a" and "å" identical for comparison purposes.</span></span>  
  
 <span data-ttu-id="b772f-146">下表介绍比较选项和排序样式。</span><span class="sxs-lookup"><span data-stu-id="b772f-146">The following table describes the comparison options and a sort style.</span></span>  
  
|<span data-ttu-id="b772f-147">比较选项</span><span class="sxs-lookup"><span data-stu-id="b772f-147">Comparison option</span></span>|<span data-ttu-id="b772f-148">说明</span><span class="sxs-lookup"><span data-stu-id="b772f-148">Description</span></span>|  
|-----------------------|-----------------|  
|<span data-ttu-id="b772f-149">忽略大小写</span><span class="sxs-lookup"><span data-stu-id="b772f-149">Ignore case</span></span>|<span data-ttu-id="b772f-150">指定比较是否区分大小写字母。</span><span class="sxs-lookup"><span data-stu-id="b772f-150">Specifies whether the comparison distinguishes between uppercase and lowercase letters.</span></span> <span data-ttu-id="b772f-151">如果设置了此选项，字符串比较会忽略大小写。</span><span class="sxs-lookup"><span data-stu-id="b772f-151">If this option is set, the string comparison ignores case.</span></span> <span data-ttu-id="b772f-152">例如，"ABC" 和 "abc" 没有区别。</span><span class="sxs-lookup"><span data-stu-id="b772f-152">For example, "ABC" becomes the same as "abc".</span></span>|  
|<span data-ttu-id="b772f-153">忽略假名类型</span><span class="sxs-lookup"><span data-stu-id="b772f-153">Ignore kana type</span></span>|<span data-ttu-id="b772f-154">指定比较是否区分日语的两种假名字符类型：平假名和片假名。</span><span class="sxs-lookup"><span data-stu-id="b772f-154">Specifies whether the comparison distinguishes between the two types of Japanese kana characters: hiragana and katakana.</span></span> <span data-ttu-id="b772f-155">如果设置了此选项，字符串比较会忽略假名类型。</span><span class="sxs-lookup"><span data-stu-id="b772f-155">If this option is set, the string comparison ignores kana type.</span></span>|  
|<span data-ttu-id="b772f-156">忽略字符宽度</span><span class="sxs-lookup"><span data-stu-id="b772f-156">Ignore character width</span></span>|<span data-ttu-id="b772f-157">指定比较是否区分字符的单字节形式和该字符的双字节形式。</span><span class="sxs-lookup"><span data-stu-id="b772f-157">Specifies whether the comparison distinguishes between a single-byte character and the same character when it is represented as a double-byte character.</span></span> <span data-ttu-id="b772f-158">如果设置了此选项，字符串比较将把同一字符的单字节形式和双字节形式视为相同。</span><span class="sxs-lookup"><span data-stu-id="b772f-158">If this option is set, the string comparison treats single-byte and double-byte representations of the same character as identical.</span></span>|  
|<span data-ttu-id="b772f-159">忽略非空格字符</span><span class="sxs-lookup"><span data-stu-id="b772f-159">Ignore nonspacing characters</span></span>|<span data-ttu-id="b772f-160">指定比较是否区分空格字符和标注字符。</span><span class="sxs-lookup"><span data-stu-id="b772f-160">Specifies whether the comparison distinguishes between spacing characters and diacritics.</span></span> <span data-ttu-id="b772f-161">如果设置了此选项，则比较会忽略标注字符。</span><span class="sxs-lookup"><span data-stu-id="b772f-161">If this option is set, the comparison ignores diacritics.</span></span> <span data-ttu-id="b772f-162">例如，"å" 与 "a" 相同。</span><span class="sxs-lookup"><span data-stu-id="b772f-162">For example, "å" is equal to "a".</span></span>|  
|<span data-ttu-id="b772f-163">忽略符号</span><span class="sxs-lookup"><span data-stu-id="b772f-163">Ignore symbols</span></span>|<span data-ttu-id="b772f-164">指定比较是否区分字母字符和符号（如空格字符、标点、货币符号和数学符号）。</span><span class="sxs-lookup"><span data-stu-id="b772f-164">Specifies whether the comparison distinguishes between letter characters and symbols such as white-space characters, punctuation, currency symbols, and mathematical symbols.</span></span> <span data-ttu-id="b772f-165">如果设置了此选项，字符串比较会忽略符号。</span><span class="sxs-lookup"><span data-stu-id="b772f-165">If this option is set, the string comparison ignores symbols.</span></span> <span data-ttu-id="b772f-166">例如，" New York" 与 "New York" 相同，"\*ABC" 与 "ABC"' 相同。</span><span class="sxs-lookup"><span data-stu-id="b772f-166">For example, " New York" becomes the same as "New York" and "\*ABC" is the same as "ABC"'.</span></span>|  
|<span data-ttu-id="b772f-167">将标点作为符号排序</span><span class="sxs-lookup"><span data-stu-id="b772f-167">Sort punctuation as symbols</span></span>|<span data-ttu-id="b772f-168">指定比较是否对标点符号排序，并将除了连字符和撇号外的所有标点符号排在字母数字字符之前。</span><span class="sxs-lookup"><span data-stu-id="b772f-168">Specifies whether the comparison sorts all punctuation symbols, except the hyphen and apostrophe, before the alphanumeric characters.</span></span> <span data-ttu-id="b772f-169">例如，如果设置了此选项，".ABC" 将会排在 "ABC" 前面。</span><span class="sxs-lookup"><span data-stu-id="b772f-169">For example, if this option is set, ".ABC" sorts before "ABC".</span></span>|  
  
 <span data-ttu-id="b772f-170">排序、聚合、模糊分组和模糊查找转换中包含了这些比较数据的选项。</span><span class="sxs-lookup"><span data-stu-id="b772f-170">The Sort, Aggregate, Fuzzy Grouping and Fuzzy Lookup transformations include these options for comparing data.</span></span>  
  
 <span data-ttu-id="b772f-171">**FullySensitive** 比较标志显示在模糊分组和模糊查找转换的 **“高级编辑器”** 对话框中。</span><span class="sxs-lookup"><span data-stu-id="b772f-171">The **FullySensitive** comparison flag displays in the **Advanced Editor** dialog box for the Fuzzy Grouping and Fuzzy Lookup transformations.</span></span> <span data-ttu-id="b772f-172">选择 **FullySensitive** 比较标志意味着应用所有比较选项。</span><span class="sxs-lookup"><span data-stu-id="b772f-172">Selecting the **FullySensitive** comparison flag means that all the comparison options apply.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b772f-173">另请参阅</span><span class="sxs-lookup"><span data-stu-id="b772f-173">See Also</span></span>  
 <span data-ttu-id="b772f-174">[Integration Services 数据类型](integration-services-data-types.md) </span><span class="sxs-lookup"><span data-stu-id="b772f-174">[Integration Services Data Types](integration-services-data-types.md) </span></span>  
 <span data-ttu-id="b772f-175">[快速分析](../fast-parse.md) </span><span class="sxs-lookup"><span data-stu-id="b772f-175">[Fast Parse](../fast-parse.md) </span></span>  
 [<span data-ttu-id="b772f-176">标准分析</span><span class="sxs-lookup"><span data-stu-id="b772f-176">Standard Parse</span></span>](../standard-parse.md)  
  
  
