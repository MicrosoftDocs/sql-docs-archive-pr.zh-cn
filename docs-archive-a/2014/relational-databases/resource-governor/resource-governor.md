---
title: 资源调控器 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: performance
ms.topic: conceptual
helpviewer_keywords:
- Resource Governor, overview
- Resource Governor
ms.assetid: 2bc89b66-e801-45ba-b30d-8ed197052212
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 7660446a176b9535883a001318c8f8fc981f99c1
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87689299"
---
# <a name="resource-governor"></a><span data-ttu-id="9d758-102">Resource Governor</span><span class="sxs-lookup"><span data-stu-id="9d758-102">Resource Governor</span></span>
  [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="9d758-103">资源调控器是一项可用于管理 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 工作负荷和系统资源使用情况的功能。</span><span class="sxs-lookup"><span data-stu-id="9d758-103">Resource Governor is a feature than you can use to manage [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] workload and system resource consumption.</span></span> <span data-ttu-id="9d758-104">可以通过 Resource Governor 指定各种限制，对可供传入应用程序请求使用的 CPU、物理 IO 和内存量进行限制。</span><span class="sxs-lookup"><span data-stu-id="9d758-104">Resource Governor enables you to specify limits on the amount of CPU, physical IO, and memory that incoming application requests can use.</span></span>  
  
## <a name="benefits-of-resource-governor"></a><span data-ttu-id="9d758-105">资源调控器的优势</span><span class="sxs-lookup"><span data-stu-id="9d758-105">Benefits of Resource Governor</span></span>  
 <span data-ttu-id="9d758-106">利用资源调控器，您可以通过指定传入请求的资源消耗限制来管理 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 工作负荷和资源。</span><span class="sxs-lookup"><span data-stu-id="9d758-106">Resource Governor enables you to manage [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] workloads and resources by specifying limits on resource consumption by incoming requests.</span></span> <span data-ttu-id="9d758-107">在资源调控器上下文中，工作负荷是一组大小相似的查询或请求，可以且应该视为单个实体。</span><span class="sxs-lookup"><span data-stu-id="9d758-107">In the Resource Governor context, workload is a set of similarly sized queries or requests that can, and should be, treated as a single entity.</span></span> <span data-ttu-id="9d758-108">这并不是必需的，但是工作负荷的资源使用模式越统一，通过资源调控器可能获得的益处越多。</span><span class="sxs-lookup"><span data-stu-id="9d758-108">This is not a requirement, but the more uniform the resource usage pattern of a workload is, the more benefit you are likely to derive from Resource Governor.</span></span> <span data-ttu-id="9d758-109">资源限制可以实时重新配置，对正在执行的工作负荷影响非常小。</span><span class="sxs-lookup"><span data-stu-id="9d758-109">Resource limits can be reconfigured in real time with minimal impact on workloads that are executing.</span></span>  
  
 <span data-ttu-id="9d758-110">在相同服务器上存在多个不同工作负荷的环境中，使用资源调控器可以区分这些工作负荷并能根据指定的限制在请求时分配共享资源。</span><span class="sxs-lookup"><span data-stu-id="9d758-110">In an environment where multiple distinct workloads are present on the same server, Resource Governor enables you to differentiate these workloads and allocate shared resources as they are requested, based on the limits that you specify.</span></span> <span data-ttu-id="9d758-111">这些资源是 CPU、物理 IO 和内存。</span><span class="sxs-lookup"><span data-stu-id="9d758-111">These resources are CPU, physical IO, and memory.</span></span>  
  
 <span data-ttu-id="9d758-112">通过使用资源调控器，您可以：</span><span class="sxs-lookup"><span data-stu-id="9d758-112">By using Resource Governor, you can:</span></span>  
  
-   <span data-ttu-id="9d758-113">在服务于多个客户端工作负荷的单个 SQL Server 实例上提供多租户和资源隔离。</span><span class="sxs-lookup"><span data-stu-id="9d758-113">Provide multitenancy and resource isolation on single instances of SQL Server that serve multiple client workloads.</span></span> <span data-ttu-id="9d758-114">也就是说，您可以将某个服务器上的可用资源划分到多个工作负荷上，并且尽量减少在工作负荷争用资源时可能发生的问题。</span><span class="sxs-lookup"><span data-stu-id="9d758-114">That is, you can divide the available resources on a server among the workloads and minimize the problems that can occur when workloads compete for resources.</span></span>  
  
-   <span data-ttu-id="9d758-115">提供可预测性能并且在多工作负荷和多用户环境中支持针对工作负荷租户的 SLA。</span><span class="sxs-lookup"><span data-stu-id="9d758-115">Provide predictable performance and support SLAs for workload tenants in a multi-workload and multi-user environment.</span></span>  
  
-   <span data-ttu-id="9d758-116">隔离和限制失控查询，或者中止可能使 IO 子系统饱和以及对其他工作负荷有负面影响的操作（例如 DBCC CHECKDB）的 IO 资源。</span><span class="sxs-lookup"><span data-stu-id="9d758-116">Isolate and limit runaway queries or throttle IO resources for operations such as DBCC CHECKDB that can saturate the IO subsystem and negatively impact other workloads.</span></span>  
  
-   <span data-ttu-id="9d758-117">为资源使用退款添加细粒度资源跟踪，并且对服务器资源的使用者提供可预测的计费。</span><span class="sxs-lookup"><span data-stu-id="9d758-117">Add fine-grained resource tracking for resource usage chargebacks and provide predictable billing to the consumers of the server resources.</span></span>  
  
## <a name="resource-governor-constraints"></a><span data-ttu-id="9d758-118">资源调控器约束</span><span class="sxs-lookup"><span data-stu-id="9d758-118">Resource Governor Constraints</span></span>  
 <span data-ttu-id="9d758-119">此资源调控器版本存在以下约束：</span><span class="sxs-lookup"><span data-stu-id="9d758-119">This release of Resource Governor has the following constraints:</span></span>  
  
-   <span data-ttu-id="9d758-120">资源管理仅限于 [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="9d758-120">Resource management is limited to the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)].</span></span> <span data-ttu-id="9d758-121">资源调控器不能用于 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]、 [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)]和 [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="9d758-121">Resource Governor can not be used for [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)], [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)], and [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)].</span></span>  
  
-   <span data-ttu-id="9d758-122">SQL Server 实例之间没有工作负荷监视或工作负荷管理。</span><span class="sxs-lookup"><span data-stu-id="9d758-122">There is no workload monitoring or workload management between SQL Server instances.</span></span>  
  
-   <span data-ttu-id="9d758-123">资源调控器可以管理 OLTP 工作负荷，但通常持续时间非常短的查询类型总是在 CPU 上停留很短时间而不足以应用带宽控制。</span><span class="sxs-lookup"><span data-stu-id="9d758-123">Resource Governor can manage OLTP workloads but these types of queries, which are typically very short in duration, are not always on the CPU long enough to apply bandwidth controls.</span></span> <span data-ttu-id="9d758-124">这样会使返回的 CPU 使用率的统计信息有偏差。</span><span class="sxs-lookup"><span data-stu-id="9d758-124">This may skew in the statistics returned for CPU usage %.</span></span>  
  
-   <span data-ttu-id="9d758-125">控制物理 IO 的功能仅适用于用户操作，而不适用于系统任务。</span><span class="sxs-lookup"><span data-stu-id="9d758-125">The ability to govern physical IO only applies to user operations and not system tasks.</span></span> <span data-ttu-id="9d758-126">系统任务包括向事务日志的写入操作和 Lazy Writer IO 操作。</span><span class="sxs-lookup"><span data-stu-id="9d758-126">System tasks include write operations to the transaction log and Lazy Writer IO operations.</span></span> <span data-ttu-id="9d758-127">资源调控器主要应用于用户读取操作，因为大多数写操作通常由系统任务执行。</span><span class="sxs-lookup"><span data-stu-id="9d758-127">The Resource Govenor applies primarily to user read operations because most write operations are typically performed by system tasks.</span></span>  
  
-   <span data-ttu-id="9d758-128">您不能对内部资源池设置 IO 阈值。</span><span class="sxs-lookup"><span data-stu-id="9d758-128">You cannot set IO thresholds on the internal resource pool.</span></span>  
  
## <a name="resource-concepts"></a><span data-ttu-id="9d758-129">资源概念</span><span class="sxs-lookup"><span data-stu-id="9d758-129">Resource Concepts</span></span>  
 <span data-ttu-id="9d758-130">下面的三个概念是了解和使用资源调控器的基础：</span><span class="sxs-lookup"><span data-stu-id="9d758-130">The following three concepts are fundamental to understanding and using Resource Governor:</span></span>  
  
-   <span data-ttu-id="9d758-131">**资源池。**</span><span class="sxs-lookup"><span data-stu-id="9d758-131">**Resource pools.**</span></span> <span data-ttu-id="9d758-132">资源池表示服务器的物理资源。</span><span class="sxs-lookup"><span data-stu-id="9d758-132">A resource pool, represents the physical resources of the server.</span></span> <span data-ttu-id="9d758-133">您可以将池看作 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例内部的一个虚拟 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例。</span><span class="sxs-lookup"><span data-stu-id="9d758-133">You can think of a pool as a virtual [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance inside of a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="9d758-134">当安装 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 时，会创建两个资源池（内部资源池和默认资源池）。</span><span class="sxs-lookup"><span data-stu-id="9d758-134">Two resource pools (internal and default) are created when [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is installed.</span></span> <span data-ttu-id="9d758-135">资源调控器还支持用户定义的资源池。</span><span class="sxs-lookup"><span data-stu-id="9d758-135">Resource Governor also supports user-defined resource pools.</span></span> <span data-ttu-id="9d758-136">有关详细信息，请参阅 [Resource Governor Resource Pool](resource-governor-resource-pool.md)。</span><span class="sxs-lookup"><span data-stu-id="9d758-136">For more information, see [Resource Governor Resource Pool](resource-governor-resource-pool.md).</span></span>  
  
-   <span data-ttu-id="9d758-137">**工作负荷组。**</span><span class="sxs-lookup"><span data-stu-id="9d758-137">**Workload groups.**</span></span> <span data-ttu-id="9d758-138">工作负荷组充当具有相似分类标准的会话请求的容器。</span><span class="sxs-lookup"><span data-stu-id="9d758-138">A workload group serves as a container for session requests that have similar classification criteria.</span></span> <span data-ttu-id="9d758-139">工作负荷允许对会话进行聚合监视，并定义会话的策略。</span><span class="sxs-lookup"><span data-stu-id="9d758-139">A workload allows for aggregate monitoring of the sessions, and defines policies for the sessions.</span></span> <span data-ttu-id="9d758-140">每个工作负荷组都处于一个资源池中。</span><span class="sxs-lookup"><span data-stu-id="9d758-140">Each workload group is in a resource pool.</span></span> <span data-ttu-id="9d758-141">当安装 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 时，会创建两个工作负荷组（内部工作负荷组和默认工作负荷组）并将其映射到对应的资源池。</span><span class="sxs-lookup"><span data-stu-id="9d758-141">Two workload groups (internal and default) are created and mapped to their corresponding resource pools when [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is installed.</span></span> <span data-ttu-id="9d758-142">资源调控器还支持用户定义的工作负荷组。</span><span class="sxs-lookup"><span data-stu-id="9d758-142">Resource Governor also supports user-defined workload groups.</span></span> <span data-ttu-id="9d758-143">有关详细信息，请参阅 [Resource Governor Workload Group](resource-governor-workload-group.md)。</span><span class="sxs-lookup"><span data-stu-id="9d758-143">For more information see, [Resource Governor Workload Group](resource-governor-workload-group.md).</span></span>  
  
-   <span data-ttu-id="9d758-144">**分类。**</span><span class="sxs-lookup"><span data-stu-id="9d758-144">**Classification.**</span></span> <span data-ttu-id="9d758-145">分类过程会根据传入会话的特征将其分配给工作负荷组。</span><span class="sxs-lookup"><span data-stu-id="9d758-145">The Classification process assigns incoming sessions to a workload group based on the characteristics of the session.</span></span> <span data-ttu-id="9d758-146">您可以通过编写用户定义函数（称为分类器函数）来定制分类逻辑。</span><span class="sxs-lookup"><span data-stu-id="9d758-146">You can tailor the classification logic by writing a user-defined function, called a classifier function.</span></span> <span data-ttu-id="9d758-147">资源调控器还支持用于实现分类规则的分类器用户定义的函数。</span><span class="sxs-lookup"><span data-stu-id="9d758-147">Resource Governor also supports a classifier user-defined function for implementing classification rules.</span></span> <span data-ttu-id="9d758-148">有关详细信息，请参阅 [Resource Governor Classifier Function](resource-governor-classifier-function.md)。</span><span class="sxs-lookup"><span data-stu-id="9d758-148">For more information, see [Resource Governor Classifier Function](resource-governor-classifier-function.md).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="9d758-149">资源调控器不向专用管理员连接 (DAC) 施加任何控制。</span><span class="sxs-lookup"><span data-stu-id="9d758-149">Resource Governor does not impose any controls on a dedicated administrator connection (DAC).</span></span> <span data-ttu-id="9d758-150">无需对在内部工作负荷组和资源池中运行的 DAC 查询进行分类。</span><span class="sxs-lookup"><span data-stu-id="9d758-150">There is no need to classify DAC queries, which run in the internal workload group and resource pool.</span></span>  
  
 <span data-ttu-id="9d758-151">在资源调控器的上下文中，您可以将前面的概念视为组件。</span><span class="sxs-lookup"><span data-stu-id="9d758-151">In the context of Resource Governor, you can treat the preceding concepts as components.</span></span> <span data-ttu-id="9d758-152">下图显示了这些组件及其在数据库引擎环境中相互之间的关系。</span><span class="sxs-lookup"><span data-stu-id="9d758-152">The following illustration shows these components and their relationship with each other as they exist in the database engine environment.</span></span> <span data-ttu-id="9d758-153">从处理的角度，简化的流程如下所示：</span><span class="sxs-lookup"><span data-stu-id="9d758-153">From a processing perspective, the simplified flow is as follows:</span></span>  
  
-   <span data-ttu-id="9d758-154">会话有传入的连接（Session 1，共 *n*个）。</span><span class="sxs-lookup"><span data-stu-id="9d758-154">There is an incoming connection for a session (Session 1 of *n*).</span></span>  
  
-   <span data-ttu-id="9d758-155">会话已分类（分类）。</span><span class="sxs-lookup"><span data-stu-id="9d758-155">The session is classified (Classification).</span></span>  
  
-   <span data-ttu-id="9d758-156">会话工作负荷将路由到工作负荷组，例如，Group 4。</span><span class="sxs-lookup"><span data-stu-id="9d758-156">The session workload is routed to a workload group, for example, Group 4.</span></span>  
  
-   <span data-ttu-id="9d758-157">工作负荷组使用与其关联的资源池，例如，Pool 2。</span><span class="sxs-lookup"><span data-stu-id="9d758-157">The workload group uses the resource pool it is associated with, for example, Pool 2.</span></span>  
  
-   <span data-ttu-id="9d758-158">资源池提供并限制应用程序所需的资源，例如，Application 3。</span><span class="sxs-lookup"><span data-stu-id="9d758-158">The resource pool provides and limits the resources required by the application, for example, Application 3.</span></span>  
  
 <span data-ttu-id="9d758-159">![Resource Governor 功能组件](../../database-engine/media/rg-basic-funct-components.gif "Resource Governor 功能组件")</span><span class="sxs-lookup"><span data-stu-id="9d758-159">![Resource Governor Functional Components](../../database-engine/media/rg-basic-funct-components.gif "Resource Governor Functional Components")</span></span>  
  
## <a name="resource-governor-tasks"></a><span data-ttu-id="9d758-160">资源调控器任务</span><span class="sxs-lookup"><span data-stu-id="9d758-160">Resource Governor Tasks</span></span>  
  
|<span data-ttu-id="9d758-161">任务说明</span><span class="sxs-lookup"><span data-stu-id="9d758-161">Task Description</span></span>|<span data-ttu-id="9d758-162">主题</span><span class="sxs-lookup"><span data-stu-id="9d758-162">Topic</span></span>|  
|----------------------|-----------|  
|<span data-ttu-id="9d758-163">说明如何启用资源调控器。</span><span class="sxs-lookup"><span data-stu-id="9d758-163">Describes how to enable Resource Governor.</span></span>|[<span data-ttu-id="9d758-164">启用资源调控器</span><span class="sxs-lookup"><span data-stu-id="9d758-164">Enable Resource Governor</span></span>](resource-governor.md)|  
|<span data-ttu-id="9d758-165">说明如何禁用资源调控器。</span><span class="sxs-lookup"><span data-stu-id="9d758-165">Describes how to disable Resource Governor.</span></span>|[<span data-ttu-id="9d758-166">禁用资源调控器</span><span class="sxs-lookup"><span data-stu-id="9d758-166">Disable Resource Governor</span></span>](disable-resource-governor.md)|  
|<span data-ttu-id="9d758-167">说明如何创建、更改和删除资源池。</span><span class="sxs-lookup"><span data-stu-id="9d758-167">Describes how to create, alter, and drop a resource pool.</span></span>|[<span data-ttu-id="9d758-168">资源调控器资源池</span><span class="sxs-lookup"><span data-stu-id="9d758-168">Resource Governor Resource Pool</span></span>](resource-governor-resource-pool.md)|  
|<span data-ttu-id="9d758-169">说明如何创建、更改、移动和删除工作负荷组。</span><span class="sxs-lookup"><span data-stu-id="9d758-169">Describes how to create, alter, move, and drop a workload group.</span></span>|[<span data-ttu-id="9d758-170">资源调控器工作负荷组</span><span class="sxs-lookup"><span data-stu-id="9d758-170">Resource Governor Workload Group</span></span>](resource-governor-workload-group.md)|  
|<span data-ttu-id="9d758-171">说明如何创建和测试分类器用户定义函数。</span><span class="sxs-lookup"><span data-stu-id="9d758-171">Describes how to create and test a classifier user-defined function.</span></span>|[<span data-ttu-id="9d758-172">资源调控器分类器函数</span><span class="sxs-lookup"><span data-stu-id="9d758-172">Resource Governor Classifier Function</span></span>](resource-governor-classifier-function.md)|  
|<span data-ttu-id="9d758-173">说明如何使用模板配置资源调控器。</span><span class="sxs-lookup"><span data-stu-id="9d758-173">Describes how to configure Resource Governor using a template.</span></span>|[<span data-ttu-id="9d758-174">使用模板配置资源调控器</span><span class="sxs-lookup"><span data-stu-id="9d758-174">Configure Resource Governor Using a Template</span></span>](configure-resource-governor-using-a-template.md)|  
|<span data-ttu-id="9d758-175">说明如何查看资源调控器属性。</span><span class="sxs-lookup"><span data-stu-id="9d758-175">Describes how to view Resource Governor properties.</span></span>|[<span data-ttu-id="9d758-176">查看资源调控器属性</span><span class="sxs-lookup"><span data-stu-id="9d758-176">View Resource Governor Properties</span></span>](view-resource-governor-properties.md)|  
  
## <a name="see-also"></a><span data-ttu-id="9d758-177">另请参阅</span><span class="sxs-lookup"><span data-stu-id="9d758-177">See Also</span></span>  
 [<span data-ttu-id="9d758-178">数据库引擎实例 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="9d758-178">Database Engine Instances &#40;SQL Server&#41;</span></span>](../../database-engine/configure-windows/database-engine-instances-sql-server.md)  
  
  
