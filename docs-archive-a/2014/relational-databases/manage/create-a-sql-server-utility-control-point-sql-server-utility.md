---
title: 创建 SQL Server 实用工具控制点（SQL Server 实用工具）| Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: configuration
ms.topic: conceptual
f1_keywords:
- SQL12.SWB.create.ucp.progress.F1
- SQL12.SWB.create.ucp.welcome.F1
- SQL12.SWB.create.ucp.Summary.F1
- SQL12.SWB.create.ucp.validation.F1
- SQL12.SWB.create.ucp.instancename.F1
- SQL12.SWB.create.ucp.agentconfiguration.F1
helpviewer_keywords:
- Create UCP
- UCP
ms.assetid: d5335124-1625-47ce-b4ac-36078967158c
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 833c83868230c2ac05514db666bd4cab629d9588
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87578883"
---
# <a name="create-a-sql-server-utility-control-point-sql-server-utility"></a><span data-ttu-id="a3dd8-102">创建 SQL Server 实用工具控制点（SQL Server 实用工具）</span><span class="sxs-lookup"><span data-stu-id="a3dd8-102">Create a SQL Server Utility Control Point (SQL Server Utility)</span></span>
  <span data-ttu-id="a3dd8-103">一个企业可以具有多个 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具，并且每个 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具可以管理 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的多个实例和多个数据层应用程序。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-103">An enterprise can have multiple [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utilities, and each [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility can manage many instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] and data-tier applications.</span></span> <span data-ttu-id="a3dd8-104">每个 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具都具有一个且仅有一个实用工具控制点 (UCP)。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-104">Every [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility has one and only one utility control point (UCP).</span></span> <span data-ttu-id="a3dd8-105">必须为每个 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具分别创建一个新的 UCP。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-105">You must create a new UCP for each [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility.</span></span> <span data-ttu-id="a3dd8-106">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的每个托管实例以及每个数据层应用程序都是一个且只能是一个 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具的成员，并且由单个 UCP 管理。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-106">Each managed instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] and every data-tier application is a member of one and only one [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility, and is managed by a single UCP.</span></span>

 <span data-ttu-id="a3dd8-107">UCP 每隔 15 分钟从 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的托管实例收集配置和性能信息。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-107">The UCP collects configuration and performance information from managed instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] every 15 minutes.</span></span> <span data-ttu-id="a3dd8-108">此信息存储在 UCP 上的实用工具管理数据仓库 (UMDW) 中；该 UMDW 文件名是 sysutility_mdw。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-108">This information is stored in the utility management data warehouse (UMDW) on the UCP; the UMDW file name is sysutility_mdw.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="a3dd8-109">性能数据与策略进行比较，以便帮助标识资源使用瓶颈和整合机会。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-109">performance data is compared to policies to help identify resource use bottlenecks and consolidation opportunities.</span></span>

## <a name="before-you-begin"></a><span data-ttu-id="a3dd8-110">开始之前</span><span class="sxs-lookup"><span data-stu-id="a3dd8-110">Before You Begin</span></span>
 <span data-ttu-id="a3dd8-111">创建 UCP 之前，请查看以下要求和建议。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-111">Before you create a UCP, review the following requirements and recommendations.</span></span>

 <span data-ttu-id="a3dd8-112">在此版本中，UCP 和 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的所有托管实例必须满足以下要求：</span><span class="sxs-lookup"><span data-stu-id="a3dd8-112">In this release, the UCP and all managed instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] must satisfy the following requirements:</span></span>

-   [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="a3dd8-113">必须是 10.50 版或更高版本。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-113">must be version 10.50 or higher.</span></span>

-   <span data-ttu-id="a3dd8-114">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例类型必须是 [!INCLUDE[ssDE](../../includes/ssde-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-114">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance type must be [!INCLUDE[ssDE](../../includes/ssde-md.md)].</span></span>

-   <span data-ttu-id="a3dd8-115">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具必须在单个 Windows 域内或跨具有双向信任关系的多个域操作。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-115">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility must operate within a single Windows domain, or across domains with two-way trust relationships.</span></span>

-   <span data-ttu-id="a3dd8-116">UCP 和 SQL Server 的所有托管实例上的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 服务帐户必须对 Active Directory 中的用户具有读取权限。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-116">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] service accounts on the UCP and all managed instances of SQL Server must have read permission to Users in Active Directory.</span></span>

 <span data-ttu-id="a3dd8-117">在此版本中，UCP 必须满足以下要求：</span><span class="sxs-lookup"><span data-stu-id="a3dd8-117">In this release, the UCP must satisfy the following requirements:</span></span>

-   <span data-ttu-id="a3dd8-118">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例必须是受支持版本。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-118">The instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] must be a supported edition.</span></span> <span data-ttu-id="a3dd8-119">有关各个版本支持的功能列表 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ，请参阅 SQL Server 2014 的各个[版本支持的功能](../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md)。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-119">For a list of features that are supported by the editions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], see [Features Supported by the Editions of SQL Server 2014](../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md).</span></span>

-   <span data-ttu-id="a3dd8-120">我们建议 UCP 由 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]的区分大小写的实例承载。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-120">We recommend that the UCP is hosted by a case-sensitive instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>

 <span data-ttu-id="a3dd8-121">对于针对 UCP 计算机的容量计划，请考虑以下建议：</span><span class="sxs-lookup"><span data-stu-id="a3dd8-121">Consider the following recommendations for capacity planning on the UCP computer:</span></span>

-   <span data-ttu-id="a3dd8-122">在典型的方案中，UCP 上 UMDW 数据库 (sysutility_mdw) 使用的磁盘空间是每年 SQL Server 的每个托管实例大约 2 GB。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-122">In a typical scenario, disk space used by the UMDW database (sysutility_mdw) on the UCP is approximately 2 GB per managed instance of SQL Server per year.</span></span> <span data-ttu-id="a3dd8-123">此估计值可能会根据托管实例收集的数据库和系统对象的数目而发生变化。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-123">This estimate can vary depending on the number of database and system objects collected by the managed instance.</span></span> <span data-ttu-id="a3dd8-124">UMDW (sysutility_mdw) 磁盘空间增长率在最初的两天最高。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-124">The UMDW (sysutility_mdw) disk space growth rate is highest during the first two days.</span></span>

-   <span data-ttu-id="a3dd8-125">在典型的方案中，UCP 上 msdb 使用的磁盘空间是 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]的每个托管实例大约 20 MB。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-125">In a typical scenario, disk space used by msdb on the UCP is approximately 20 MB per managed instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="a3dd8-126">请注意，此估计值可能会根据资源使用策略以及托管实例收集的数据库和系统对象的数目而发生变化。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-126">Note that this estimate can vary depending on the resource utilization policies and the number of database and system objects collected by the managed instance.</span></span> <span data-ttu-id="a3dd8-127">一般而言，磁盘空间使用率随着违反策略的数目的增加而增加，并且随着易失性资源的可调时间范围的持续时间长度的增加而增加。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-127">In general, disk space usage increases as the number of policy violations increases and the duration of the moving time window for volatile resources increases.</span></span>

-   <span data-ttu-id="a3dd8-128">请注意，在某一托管实例的数据保持期到期前，从 UCP 中删除该托管实例将不会降低 UCP 数据库所占用的磁盘空间。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-128">Note that removing a managed instance from the UCP will not reduce the disk space used by UCP databases until expiration of data retention periods for the managed instance.</span></span>

 <span data-ttu-id="a3dd8-129">在此版本中， [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的所有托管实例必须满足以下要求：</span><span class="sxs-lookup"><span data-stu-id="a3dd8-129">In this release, all managed instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] must satisfy the following requirements:</span></span>

-   <span data-ttu-id="a3dd8-130">我们建议，如果 UCP 由 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]的不区分大小写的实例承载，则 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的托管实例也应是不区分大小写。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-130">We recommend that if the UCP is hosted by a case-insensitive instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], then managed instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] should also be case-insensitive.</span></span>

-   <span data-ttu-id="a3dd8-131">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具监视不支持 FILESTREAM 数据。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-131">FILESTREAM data are not supported for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility monitoring.</span></span>

 <span data-ttu-id="a3dd8-132">有关详细信息，请参阅[SQL Server 2014 各个版本支持](../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md)的 SQL Server 和功能的[最大容量规范](../../sql-server/maximum-capacity-specifications-for-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-132">For more information, see [Maximum Capacity Specifications for SQL Server](../../sql-server/maximum-capacity-specifications-for-sql-server.md) and [Features Supported by the Editions of SQL Server 2014](../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md).</span></span>

### <a name="remove-previous-utility-control-points-before-installing-a-new-one"></a><span data-ttu-id="a3dd8-133">在安装新的实用工具控制点之前删除以前的实用工具控制点</span><span class="sxs-lookup"><span data-stu-id="a3dd8-133">Remove Previous Utility Control Points Before Installing a New One</span></span>
 <span data-ttu-id="a3dd8-134">如果您在某一 SQL Server 实例上安装实用工具控制点 (UCP)，并且该实例曾配置为 UCP，则必须在执行此操作前删除所有 SQL Server 托管实例并且删除该 UCP。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-134">If you are installing a utility control point (UCP) on an instance of SQL Server that was ever configured as a UCP, you must remove all managed instances of SQL Server and remove the UCP before doing so.</span></span> <span data-ttu-id="a3dd8-135">可以通过运行 **sp_sysutility_ucp_remove** 存储过程来执行此操作。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-135">You do this by running the **sp_sysutility_ucp_remove** stored procedure.</span></span>

 <span data-ttu-id="a3dd8-136">在运行该过程之前，请注意以下要求：</span><span class="sxs-lookup"><span data-stu-id="a3dd8-136">Before you run the procedure, note the following requirements:</span></span>

-   <span data-ttu-id="a3dd8-137">该过程必须在作为 UCP 的计算机上运行。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-137">This procedure must be run on a computer that is a UCP.</span></span>

-   <span data-ttu-id="a3dd8-138">该过程必须由具有 sysadmin 权限的用户运行，创建 UCP 要求同样的权限。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-138">This procedure must be run by a user with sysadmin permissions, the same permissions required to create a UCP.</span></span>

-   <span data-ttu-id="a3dd8-139">SQL Server 的所有托管实例必须都从该 UCP 中删除。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-139">All managed instances of SQL Server must be removed from the UCP.</span></span> <span data-ttu-id="a3dd8-140">请注意，该 UCP 是 SQL Server 的托管实例。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-140">Note that the UCP is a managed instance of SQL Server.</span></span> <span data-ttu-id="a3dd8-141">有关详细信息，请参阅[操作说明：从 SQL Server 实用工具中删除 SQL Server 实例](https://go.microsoft.com/fwlink/?LinkId=169392)。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-141">For more information, see [How to: Remove an Instance of SQL Server from the SQL Server Utility](https://go.microsoft.com/fwlink/?LinkId=169392).</span></span>

 <span data-ttu-id="a3dd8-142">使用此过程可以从 SQL Server 实用工具中删除 SQL Server UCP。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-142">Use this procedure to remove a SQL Server UCP from the SQL Server Utility.</span></span> <span data-ttu-id="a3dd8-143">在完成该操作后，可以再次在 SQL Server 的实例上创建 UCP。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-143">After the operation is complete, a UCP can be created on the instance of SQL Server again.</span></span>

 <span data-ttu-id="a3dd8-144">使用 SQL Server Management Studio 连接到该 UCP，然后运行以下脚本：</span><span class="sxs-lookup"><span data-stu-id="a3dd8-144">Use SQL Server Management Studio to connect to the UCP, then run this script:</span></span>

```sql
EXEC msdb.dbo.sp_sysutility_ucp_remove;
```

> [!NOTE]
>  <span data-ttu-id="a3dd8-145">如果删除了 UCP 的 SQL Server 实例具有非实用工具数据收集组，则该过程将不删除 sysutility_mdw 数据库。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-145">If the instance of SQL Server where the UCP was removed has a non-Utility data collection set, the sysutility_mdw database is not dropped by the procedure.</span></span> <span data-ttu-id="a3dd8-146">在此情况下，必须首先手动删除 sysutility_mdw 数据库，然后才能再次创建 UCP。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-146">If this is the case, the sysutility_mdw database must be dropped manually before the UCP can be created again.</span></span>

 <span data-ttu-id="a3dd8-147">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的每个托管实例以及每个数据层应用程序都是一个且只能是一个 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具的成员，并且由单个 UCP 管理。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-147">Each managed instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] and every data-tier application is a member of one and only one [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility, and is managed by a single UCP.</span></span> <span data-ttu-id="a3dd8-148">有关 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具概念的详细信息，请参阅 [SQL Server 实用工具功能和任务](sql-server-utility-features-and-tasks.md)。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-148">For more information about [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility concepts, see [SQL Server Utility Features and Tasks](sql-server-utility-features-and-tasks.md).</span></span>

 <span data-ttu-id="a3dd8-149">UCP 是 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具的中心原因点。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-149">A UCP is the central reasoning point of the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility.</span></span> <span data-ttu-id="a3dd8-150">使用 UCP，你可以查看从 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的托管实例和 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 数据层应用程序收集的配置和性能信息，并且执行常规的容量规划活动。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-150">Using the UCP, you can view configuration and performance information collected from managed instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] and [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] data-tier applications, and perform general capacity planning activities.</span></span> <span data-ttu-id="a3dd8-151">UCP 是用于从 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具注册和删除 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例的启动点。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-151">The UCP is the launch point for enrolling and removing instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] from the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility.</span></span>

 <span data-ttu-id="a3dd8-152">在 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具中注册 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的实例后，可以监视 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的托管实例和数据层应用程序的资源运行状况，以便发现合并机会和确定资源瓶颈。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-152">After enrolling instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] in the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility, you can monitor resource health for managed instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] and data-tier applications to identify consolidation opportunities and isolate resource bottlenecks.</span></span> <span data-ttu-id="a3dd8-153">有关详细信息，请参阅 [在 SQL Server 实用工具中监视 SQL Server 的实例](monitor-instances-of-sql-server-in-the-sql-server-utility.md)。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-153">For more information, see [Monitor Instances of SQL Server in the SQL Server Utility](monitor-instances-of-sql-server-in-the-sql-server-utility.md).</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="a3dd8-154">支持 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具收集组与非 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具收集组并行。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-154">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility collection set is supported side-by-side with non- [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility collection sets.</span></span> <span data-ttu-id="a3dd8-155">也就是说，在 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的某一托管实例是 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具的成员时，该托管实例可由其他收集组监视。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-155">That is, a managed instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] can be monitored by other collection sets while it is a member of a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility.</span></span> <span data-ttu-id="a3dd8-156">但要注意的是，该托管实例上的所有收集组会将其数据上载到 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具管理数据仓库中。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-156">Note, however, that all collection sets on the managed instance will upload their data to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility management data warehouse.</span></span> <span data-ttu-id="a3dd8-157">有关详细信息，请参阅[在 SQL Server 的同一实例中运行实用工具和非实用工具收集组的注意事项](run-utility-and-non-utility-collection-sets-on-same-sql-instance.md)和[配置你的实用工具控制点数据仓库（SQL Server 实用工具）](configure-your-utility-control-point-data-warehouse-sql-server-utility.md)。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-157">For more information, see [Considerations for Running Utility and non-Utility Collection Sets on the Same Instance of SQL Server](run-utility-and-non-utility-collection-sets-on-same-sql-instance.md) and [Configure Your Utility Control Point Data Warehouse &#40;SQL Server Utility&#41;](configure-your-utility-control-point-data-warehouse-sql-server-utility.md).</span></span>

## <a name="wizard-steps"></a><span data-ttu-id="a3dd8-158">向导步骤</span><span class="sxs-lookup"><span data-stu-id="a3dd8-158">Wizard Steps</span></span>
 ![](../../database-engine/media/create-ucp.gif "Create_UCP")

 <span data-ttu-id="a3dd8-159">以下各节提供与用于创建新的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] UCP 的向导工作流中每一页有关的详细信息。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-159">The following sections provide information about each page in the wizard work flow to create a new [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] UCP.</span></span> <span data-ttu-id="a3dd8-160">要启动向导以创建新的 UCP，则从 SSMS 的“视图”菜单中打开“实用工具资源管理器”窗格，然后单击“实用工具资源管理器”窗格顶部的 ![](../../database-engine/media/create-ucp.gif "Create_UCP")“创建 UCP”按钮。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-160">To launch the wizard to create a new UCP, open the Utility Explorer pane from the View menu in SSMS, then click on the ![](../../database-engine/media/create-ucp.gif "Create_UCP") **Create UCP** button at the top of the Utility Explorer pane.</span></span>

 <span data-ttu-id="a3dd8-161">单击下面列表中的链接可以导航到向导中某一页的详细信息：</span><span class="sxs-lookup"><span data-stu-id="a3dd8-161">Click on a link in the list below to navigate to details for a page in the Wizard.</span></span>

 <span data-ttu-id="a3dd8-162">有关此操作的 PowerShell 脚本的详细信息，请参阅 [示例](#PowerShell_create_UCP)。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-162">For more information about a PowerShell script of this operation, see the [example](#PowerShell_create_UCP).</span></span>

-   [<span data-ttu-id="a3dd8-163">创建 UCP 向导简介</span><span class="sxs-lookup"><span data-stu-id="a3dd8-163">Introduction to Create UCP Wizard</span></span>](#Welcome)

-   [<span data-ttu-id="a3dd8-164">指定实例</span><span class="sxs-lookup"><span data-stu-id="a3dd8-164">Specify Instance</span></span>](#Instance_name)

-   [<span data-ttu-id="a3dd8-165">连接对话框</span><span class="sxs-lookup"><span data-stu-id="a3dd8-165">Connection Dialog</span></span>](#Connection_dialog)

-   [<span data-ttu-id="a3dd8-166">实用工具收集组帐户</span><span class="sxs-lookup"><span data-stu-id="a3dd8-166">Utility Collection Set Account</span></span>](#Agent_configuration)

-   [<span data-ttu-id="a3dd8-167">验证规则</span><span class="sxs-lookup"><span data-stu-id="a3dd8-167">Validation Rules</span></span>](#Validation_rules)

-   [<span data-ttu-id="a3dd8-168">摘要</span><span class="sxs-lookup"><span data-stu-id="a3dd8-168">Summary</span></span>](#Summary)

-   [<span data-ttu-id="a3dd8-169">创建实用工具控制点</span><span class="sxs-lookup"><span data-stu-id="a3dd8-169">Creating the Utility Control Point</span></span>](#Creating_UCP)

##  <a name="introduction-to-create-ucp-wizard"></a><a name="Welcome"></a> <span data-ttu-id="a3dd8-170">创建 UCP 向导简介</span><span class="sxs-lookup"><span data-stu-id="a3dd8-170">Introduction to Create UCP Wizard</span></span>
 <span data-ttu-id="a3dd8-171">如果您打开实用工具资源管理器并且没有连接的实用工具控制点，则必须连接到一个控制点或创建一个新的控制点。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-171">If you open Utility Explorer and there is no connected utility control point, you must connect to one or create a new one.</span></span>

 <span data-ttu-id="a3dd8-172">连接到现有 UCP - 如果在你的部署中已存在一个实用工具控制点，则可以通过单击“实用工具资源管理器”窗格顶部的 ![](../../database-engine/media/connect-to-utility.gif "Connect_to_Utility")“连接到实用工具”按钮连接到该实用工具控制点 。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-172">**Connect to existing UCP** - If there is already a utility control point in your deployment, you can connect to it by clicking the ![](../../database-engine/media/connect-to-utility.gif "Connect_to_Utility")**Connect to Utility** button at the top of the Utility Explorer pane.</span></span> <span data-ttu-id="a3dd8-173">若要连接到现有 UCP，您必须具有管理员凭据或是实用工具读取者角色的成员。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-173">To connect to an existing UCP, you must have administrator credentials or be a member of the Utility Reader role.</span></span> <span data-ttu-id="a3dd8-174">请注意，每个 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具只能有一个 UCP，并且只能从 SSMS 的某一实例连接到一个 UCP。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-174">Note that there can only be one UCP per [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility and you can only be connected to one UCP from an instance of SSMS.</span></span>

 <span data-ttu-id="a3dd8-175">创建新的 UCP - 要创建新的实用工具控制点，请单击“实用工具资源管理器”窗格顶部的 ![](../../database-engine/media/create-ucp.gif "Create_UCP")“创建 UCP”按钮 。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-175">**Create a new UCP** - To create a new utility control point, click the ![](../../database-engine/media/create-ucp.gif "Create_UCP")**Create UCP** button at the top of the Utility Explorer pane.</span></span> <span data-ttu-id="a3dd8-176">若要创建一个新的 UCP，必须指定 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例名称并在连接对话框中提供管理员凭据。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-176">To create a new UCP, you must specify the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance name and provide administrator credentials in the connection dialog.</span></span> <span data-ttu-id="a3dd8-177">请注意，每个 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具只能有一个 UCP。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-177">Note that there can only be one UCP per [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility.</span></span>

##  <a name="specify-instance"></a><a name="Instance_name"></a> <span data-ttu-id="a3dd8-178">指定实例</span><span class="sxs-lookup"><span data-stu-id="a3dd8-178">Specify Instance</span></span>
 <span data-ttu-id="a3dd8-179">指定与您正创建的 UCP 有关的以下信息：</span><span class="sxs-lookup"><span data-stu-id="a3dd8-179">Specify the following information about the UCP you are creating:</span></span>

-   <span data-ttu-id="a3dd8-180">**实例名称** - 若要从连接对话框中选择某一 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例，请单击“连接…”。以 ComputerName\InstanceName 的格式提供计算机名称和 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例名称。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-180">**Instance Name** - To select an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] from the connection dialog, click **Connect...**. Provide the computer name and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance name in the format ComputerName\InstanceName.</span></span>

-   <span data-ttu-id="a3dd8-181">**实用程序名称** - 指定将用于在网络上标识 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具的名称。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-181">**Utility Name** - Specify a name that will be used to identify the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility on the network.</span></span>

 <span data-ttu-id="a3dd8-182">若要继续，请单击 **“下一步”** 。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-182">To continue, click **Next**.</span></span>

##  <a name="connection-dialog"></a><a name="Connection_dialog"></a> <span data-ttu-id="a3dd8-183">连接对话框</span><span class="sxs-lookup"><span data-stu-id="a3dd8-183">Connection Dialog</span></span>
 <span data-ttu-id="a3dd8-184">在“连接到服务器”对话框中，验证服务器类型、计算机名称和 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例名称信息。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-184">On the Connect to Server dialog box, verify the server type, computer name, and [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance name information.</span></span> <span data-ttu-id="a3dd8-185">有关详细信息，请参阅[连接到服务器（数据库引擎）](../../ssms/f1-help/connect-to-server-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-185">For more information, see [Connect to Server &#40;Database Engine&#41;](../../ssms/f1-help/connect-to-server-database-engine.md).</span></span>

> [!NOTE]
>  <span data-ttu-id="a3dd8-186">如果连接是加密的，将使用加密连接。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-186">If the connection is encrypted, the encrypted connection will be used.</span></span> <span data-ttu-id="a3dd8-187">如果连接未加密，则 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具将使用加密连接重新进行连接。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-187">If the connection is not encrypted, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility will reconnect using an encrypted connection.</span></span>

 <span data-ttu-id="a3dd8-188">若要继续，请单击“连接...”。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-188">To continue, click **Connect...**.</span></span>

##  <a name="utility-collection-set-account"></a><a name="Agent_configuration"></a> <span data-ttu-id="a3dd8-189">实用工具收集组帐户</span><span class="sxs-lookup"><span data-stu-id="a3dd8-189">Utility Collection Set Account</span></span>
 <span data-ttu-id="a3dd8-190">指定要运行 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具收集组的 Windows 域帐户。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-190">Specify a Windows domain account to run the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility collection set.</span></span> <span data-ttu-id="a3dd8-191">此帐户用作 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具收集组的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理的代理帐户。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-191">This account is used as the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent proxy account for the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility collection set.</span></span> <span data-ttu-id="a3dd8-192">此外，也可以使用现有的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理服务帐户。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-192">Alternatively, you can use the existing [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent service account.</span></span> <span data-ttu-id="a3dd8-193">若要满足验证要求，请使用以下准则来指定帐户。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-193">To pass validation requirements, use the following guidelines to specify the account.</span></span>

 <span data-ttu-id="a3dd8-194">如果您指定了 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理服务帐户选项：</span><span class="sxs-lookup"><span data-stu-id="a3dd8-194">If you specify the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent service account option:</span></span>

-   <span data-ttu-id="a3dd8-195">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理服务帐户必须是 Windows 域帐户，且不是 LocalSystem、NetworkService 或 LocalService 之类的内置帐户。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-195">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent service account must be a Windows domain account that is not a built-in account like LocalSystem, NetworkService, or LocalService.</span></span>

 <span data-ttu-id="a3dd8-196">若要继续，请单击 **“下一步”** 。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-196">To continue, click **Next**.</span></span>

##  <a name="validation-rules"></a><a name="Validation_rules"></a> <span data-ttu-id="a3dd8-197">验证规则</span><span class="sxs-lookup"><span data-stu-id="a3dd8-197">Validation Rules</span></span>
 <span data-ttu-id="a3dd8-198">在此版本的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]中，在将创建 UCP 的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例上，必须满足以下条件：</span><span class="sxs-lookup"><span data-stu-id="a3dd8-198">In this release of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], the following conditions must be true on the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] where the UCP will be created:</span></span>

|<span data-ttu-id="a3dd8-199">验证规则</span><span class="sxs-lookup"><span data-stu-id="a3dd8-199">Validation rule</span></span>|<span data-ttu-id="a3dd8-200">纠正措施</span><span class="sxs-lookup"><span data-stu-id="a3dd8-200">Corrective action</span></span>|
|---------------------|-----------------------|
|<span data-ttu-id="a3dd8-201">对于将创建实用工具控制点的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例，您必须具有管理员权限。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-201">You must have administrator privileges on the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] where the utility control point will be created.</span></span>|<span data-ttu-id="a3dd8-202">在 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]的实例上，以具有管理员权限的帐户登录。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-202">Log on with an account that has administrator privileges on the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>|
|<span data-ttu-id="a3dd8-203">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 版本必须是 10.50 版或更高版本。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-203">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] version must be 10.50 or higher.</span></span>|<span data-ttu-id="a3dd8-204">指定用于承载 UCP 的不同 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-204">Specify a different instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to host the UCP.</span></span>|
|<span data-ttu-id="a3dd8-205">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例必须是受支持版本。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-205">The instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] must be a supported edition.</span></span> <span data-ttu-id="a3dd8-206">有关各个版本支持的功能列表 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ，请参阅 SQL Server 2014 的各个[版本支持的功能](../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md)。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-206">For a list of features that are supported by the editions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], see [Features Supported by the Editions of SQL Server 2014](../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md).</span></span>|<span data-ttu-id="a3dd8-207">指定用于承载 UCP 的不同 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-207">Specify a different instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to host the UCP.</span></span>|
|<span data-ttu-id="a3dd8-208">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的实例不得是已向任何其他 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] UCP 注册的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的实例。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-208">The instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] must not be an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] enrolled with any other [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] UCP.</span></span>|<span data-ttu-id="a3dd8-209">指定用于承载 UCP 的不同 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例，或者从当前是 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的托管实例的 UCP 取消注册该 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]实例。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-209">Specify a different instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to host the UCP, or unenroll the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] from the UCP where it is currently a managed instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>|
|<span data-ttu-id="a3dd8-210">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的实例不能已是某一实用工具控制点的宿主。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-210">The instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] cannot already be host to a utility control point.</span></span>|<span data-ttu-id="a3dd8-211">指定用于承载 UCP 的不同 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-211">Specify a different instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to host the UCP.</span></span>|
|<span data-ttu-id="a3dd8-212">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的指定实例应启用 TCP/IP。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-212">The specified instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] should have TCP/IP enabled.</span></span>|<span data-ttu-id="a3dd8-213">为 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]的指定实例启用 TCP/IP。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-213">Enable TCP/IP for the specified instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>|
|<span data-ttu-id="a3dd8-214">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的实例不能具有名为“sysutility_mdw”的数据库。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-214">The instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] cannot have a database named "sysutility_mdw."</span></span>|<span data-ttu-id="a3dd8-215">创建 UCP 操作将创建一个名为“sysutility_mdw”的实用工具管理数据仓库 (UMDW)。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-215">The create UCP operation will create a utility management data warehouse (UMDW) named "sysutility_mdw."</span></span> <span data-ttu-id="a3dd8-216">该操作要求该名称在验证规则运行时在计算机上不存在。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-216">The operation requires that the name does not exist on the computer at the time that validation rules are run.</span></span> <span data-ttu-id="a3dd8-217">若要继续，您必须删除或重命名名为“sysutility_mdw”的任何数据库。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-217">To continue, you must remove or rename any database named "sysutility_mdw."</span></span> <span data-ttu-id="a3dd8-218">有关重命名操作的详细信息，请参阅 [ALTER DATABASE (Transact-SQL)](/sql/t-sql/statements/alter-database-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-218">For more information about renaming operations, see [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql).</span></span>|
|<span data-ttu-id="a3dd8-219">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的指定实例上的收集组必须停止运行。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-219">Collection sets on the specified instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] must be stopped.</span></span>|<span data-ttu-id="a3dd8-220">在 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]的指定实例上创建 UCP 时停止预先存在的收集组。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-220">Stop pre-existing collection sets while the UCP is created on the specified instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="a3dd8-221">如果数据收集器被禁用，则启用它，停止正在运行的所有收集组，然后为创建 UCP 操作重新运行验证规则。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-221">If the data collector is disabled, enable it, stop any running collection sets, then re-run validation rules for the Create UCP operation.</span></span><br /><br /> <span data-ttu-id="a3dd8-222">启用数据收集器：</span><span class="sxs-lookup"><span data-stu-id="a3dd8-222">To enable the data collector:</span></span><br /><br /> <span data-ttu-id="a3dd8-223">在对象资源管理器中，展开 **“管理”** 节点。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-223">In Object Explorer, expand the **Management** node.</span></span><br /><br /> <span data-ttu-id="a3dd8-224">右键单击 **“数据收集”** ，然后单击 **“启用数据收集”** 。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-224">Right-click **Data Collection**, and then click **Enable Data Collection**.</span></span><br /><br /> <span data-ttu-id="a3dd8-225">停止收集组：</span><span class="sxs-lookup"><span data-stu-id="a3dd8-225">To stop a collection set:</span></span><br /><br /> <span data-ttu-id="a3dd8-226">在对象资源管理器中，依次展开“管理”节点、 **“数据收集”** 、 **“系统数据收集组”** 。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-226">In Object Explorer, expand the Management node, expand **Data Collection**, and then expand **System Data Collection Sets**.</span></span><br /><br /> <span data-ttu-id="a3dd8-227">右键单击要停止的收集组，然后单击 **“停止数据收集组”** 。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-227">Right-click the collection set that you want to stop, and then click **Stop Data Collection Set**.</span></span><br /><br /> <span data-ttu-id="a3dd8-228">出现一个显示此操作结果的消息框，收集组图标上的红色圆圈指示收集组已停止运行。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-228">A message box will display the result of this action, and a red circle on the icon for the collection set indicates that the collection set has stopped.</span></span>|
|<span data-ttu-id="a3dd8-229">指定实例上的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理服务必须启动。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-229">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent service on the specified instance must be started.</span></span> <span data-ttu-id="a3dd8-230">如果 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的指定实例是 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 故障转移群集实例，则 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理服务必须配置为手动启动。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-230">If the specified instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] failover cluster instance, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent service must be configured to start manually.</span></span> <span data-ttu-id="a3dd8-231">否则， [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理服务必须配置为自动启动。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-231">Otherwise, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent service must be configured to start automatically.</span></span>|<span data-ttu-id="a3dd8-232">启动 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理服务。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-232">Start the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent service.</span></span> <span data-ttu-id="a3dd8-233">如果 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的指定实例是 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 故障转移群集实例，则将 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理服务配置为手动启动。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-233">If the specified instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] failover cluster instance, configure the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent service to start manually.</span></span> <span data-ttu-id="a3dd8-234">否则，将 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理服务配置为自动启动。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-234">Otherwise, configure the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent service to start automatically.</span></span>|
|<span data-ttu-id="a3dd8-235">WMI 必须正确配置。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-235">WMI must be configured correctly.</span></span>|<span data-ttu-id="a3dd8-236">若要排查 WMI 配置问题，请参阅 [SQL Server 实用工具故障排除](../../database-engine/troubleshoot-the-sql-server-utility.md)。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-236">To troubleshoot WMI configuration, see [Troubleshoot the SQL Server Utility](../../database-engine/troubleshoot-the-sql-server-utility.md).</span></span>|
|<span data-ttu-id="a3dd8-237">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理的代理帐户不能是 Network Service 之类的内置帐户。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-237">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent proxy account cannot be a built-in account, like Network Service.</span></span>|<span data-ttu-id="a3dd8-238">如果 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理的代理帐户是 Network Service 之类的内置帐户，则将该帐户重新分配给作为 sysadmin 的 Windows 域帐户。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-238">If the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent proxy account is a built-in account, like Network Service, re-assign the account to a Windows domain account that is sysadmin.</span></span>|
|<span data-ttu-id="a3dd8-239">如果您选择代理帐户选项，则 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理的代理帐户必须是有效的 Windows 域帐户。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-239">If you select the proxy account option, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent proxy account must be a valid Windows domain account.</span></span>|<span data-ttu-id="a3dd8-240">指定一个有效的 Windows 域帐户。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-240">Specify a valid Windows domain account.</span></span> <span data-ttu-id="a3dd8-241">为了确保该帐户是有效帐户，请使用 Windows 域帐户登录到 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的指定实例。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-241">To ensure that the account is valid, logon to the specified instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] using the Windows domain account.</span></span>|
|<span data-ttu-id="a3dd8-242">如果你选择服务帐户选项，则 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理服务帐户不能是 Network Service 之类的内置帐户。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-242">If you select the service account option, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent service account cannot be a built-in account, like Network Service.</span></span>|<span data-ttu-id="a3dd8-243">如果该 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理服务帐户是 Network Service 之类的内置帐户，则将该帐户重新分配给 Windows 域帐户。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-243">If the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent service account is a built-in account, like Network Service, re-assign the account to a Windows domain account.</span></span>|
|<span data-ttu-id="a3dd8-244">如果您选择服务帐户选项，则 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理服务帐户必须是有效的 Windows 域帐户。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-244">If you select the service account option, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent service account must be a valid Windows domain account.</span></span>|<span data-ttu-id="a3dd8-245">指定一个有效的 Windows 域帐户。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-245">Specify a valid Windows domain account.</span></span> <span data-ttu-id="a3dd8-246">为了确保该帐户是有效帐户，请使用 Windows 域帐户登录到 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的指定实例。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-246">To ensure that the account is valid, logon to the specified instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] using the Windows domain account.</span></span>|

 <span data-ttu-id="a3dd8-247">如果在验证结果中存在失败的条件，则纠正妨碍性问题后单击 **“重新运行验证”** 以便验证计算机配置。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-247">If there are failed conditions in the validation results, correct the blocking issues and then click **Rerun Validation** to verify the computer configuration.</span></span>

 <span data-ttu-id="a3dd8-248">若要保存验证报表，请单击 **“保存报表”** ，然后指定文件的位置。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-248">To save the validation report, click **Save Report** then specify a location for the file.</span></span>

 <span data-ttu-id="a3dd8-249">若要继续，请单击 **“下一步”** 。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-249">To continue, click **Next**.</span></span>

##  <a name="summary"></a><a name="Summary"></a><span data-ttu-id="a3dd8-250">总结</span><span class="sxs-lookup"><span data-stu-id="a3dd8-250">Summary</span></span>
 <span data-ttu-id="a3dd8-251">摘要页显示您提供的与 UCP 有关的信息：</span><span class="sxs-lookup"><span data-stu-id="a3dd8-251">The summary page displays the information that you provided about the UCP:</span></span>

-   <span data-ttu-id="a3dd8-252">承载该 UCP 的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例名称。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-252">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance name that hosts the UCP.</span></span>

-   <span data-ttu-id="a3dd8-253">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具的名称。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-253">The name of the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility.</span></span>

-   <span data-ttu-id="a3dd8-254">将用于运行 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具数据收集作业的帐户的名称。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-254">The name of the account that will be used to run jobs for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility data collection.</span></span>

 <span data-ttu-id="a3dd8-255">若要更改 UCP 配置设置，请单击 **“上一步”** 。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-255">To change UCP configuration settings, click **Previous**.</span></span> <span data-ttu-id="a3dd8-256">若要继续，请单击 **“下一步”** 。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-256">To continue, click **Next**.</span></span>

##  <a name="creating-the-utility-control-point"></a><a name="Creating_UCP"></a> <span data-ttu-id="a3dd8-257">创建实用工具控制点</span><span class="sxs-lookup"><span data-stu-id="a3dd8-257">Creating the Utility Control Point</span></span>
 <span data-ttu-id="a3dd8-258">在创建 UCP 的操作过程中，该向导将显示相关步骤并提供有关状态：</span><span class="sxs-lookup"><span data-stu-id="a3dd8-258">During the operation to create the UCP, the wizard will display the steps and provide status:</span></span>

-   <span data-ttu-id="a3dd8-259">正在为创建 UCP 准备 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-259">Preparing the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance for UCP creation.</span></span>

-   <span data-ttu-id="a3dd8-260">正在创建实用工具管理数据仓库 (UMDW)。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-260">Creating the utility management data warehouse (UMDW).</span></span>

-   <span data-ttu-id="a3dd8-261">正在初始化 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] UMDW；UMDW 文件名为 sysutility_mdw。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-261">Initializing the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] UMDW; the UMDW file name is sysutility_mdw.</span></span>

-   <span data-ttu-id="a3dd8-262">正在配置 UCP。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-262">Configuring the UCP.</span></span>

-   <span data-ttu-id="a3dd8-263">正在配置 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具收集组。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-263">Configuring the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility collection set.</span></span>

 <span data-ttu-id="a3dd8-264">若要保存与创建 UCP 操作有关的报表，请单击 **“保存报表”** ，然后指定文件的位置。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-264">To save a report about the create UCP operation, click **Save Report** then specify a location for the file.</span></span>

 <span data-ttu-id="a3dd8-265">若要完成向导，请单击 **“完成”** 。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-265">To complete the wizard, click **Finish**.</span></span>

 <span data-ttu-id="a3dd8-266">在完成创建 UCP 向导后，对于为“已部署的数据层应用程序”、“托管实例”和“实用工具管理”在其下具有节点的 UCP，SSMS 的实用工具资源管理器导航窗格中将显示一个节点。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-266">After completing the Create UCP Wizard, the Utility Explorer navigation pane in SSMS displays a node for the UCP with nodes under it for Deployed Data-tier Applications, Managed Instances, and Utility Administration.</span></span> <span data-ttu-id="a3dd8-267">该 UCP 将自动成为托管实例。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-267">The UCP automatically becomes a managed instance.</span></span>

 <span data-ttu-id="a3dd8-268">数据收集过程将立即开始，但可能需要最长 30 分钟的时间，数据才会首次出现在实用工具资源管理器内容窗格的面板和视点中。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-268">The data collection process begins immediately, but it can take up to 30 minutes for data to first appear in the dashboard and viewpoints in the Utility Explorer content pane.</span></span> <span data-ttu-id="a3dd8-269">数据收集将以每 15 分钟一次的频率继续执行。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-269">Data collection continues once every 15 minutes.</span></span> <span data-ttu-id="a3dd8-270">初始数据将来自该 UCP 本身。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-270">Initial data will be from the UCP itself.</span></span> <span data-ttu-id="a3dd8-271">也就是说，该 UCP 是 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具中 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的第一个托管实例。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-271">That is, the UCP is the first managed instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] in the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility.</span></span>

 <span data-ttu-id="a3dd8-272">若要显示面板，请单击 **“视图”** ，然后从 SSMS 菜单中选择 **“实用工具资源管理器内容”** 。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-272">To display the dashboard, click **View** then select **Utility Explorer Content** from the SSMS menu.</span></span> <span data-ttu-id="a3dd8-273">若要刷新数据，请在实用工具资源管理器窗格中右键单击实用工具名称，然后选择“刷新”。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-273">To refresh data, right-click the utility name in the Utility Explorer pane, then select **Refresh**.</span></span>

 <span data-ttu-id="a3dd8-274">有关如何将 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的其他实例注册到 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具中的详细信息，请参阅[注册 SQL Server 实例（SQL Server 实用工具）](enroll-an-instance-of-sql-server-sql-server-utility.md)。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-274">For more information about how to enroll additional instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] into the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility, see [Enroll an Instance of SQL Server &#40;SQL Server Utility&#41;](enroll-an-instance-of-sql-server-sql-server-utility.md).</span></span> <span data-ttu-id="a3dd8-275">若要从 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实用工具中将该 UCP 作为托管实例删除，请在“实用工具资源管理器”窗格中选择“托管实例”以便填充托管实例的列表视图，在“实用工具资源管理器内容”列表视图中右键单击 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例名称，然后选择“取消实例托管”。</span><span class="sxs-lookup"><span data-stu-id="a3dd8-275">To remove the UCP as a managed instance from the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Utility, select **Managed Instances** in the **Utility Explorer** pane to populate the list view of managed instances, right-click on the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance name in the **Utility Explorer Content** list view, then select **Make Instance Unmanaged**.</span></span>

##  <a name="create-a-new-utility-control-point-using-powershell"></a><a name="PowerShell_create_UCP"></a> <span data-ttu-id="a3dd8-276">使用 PowerShell 创建新的实用工具控制点</span><span class="sxs-lookup"><span data-stu-id="a3dd8-276">Create a New Utility Control Point Using PowerShell</span></span>
 <span data-ttu-id="a3dd8-277">使用以下示例创建一个新的实用工具控制点：</span><span class="sxs-lookup"><span data-stu-id="a3dd8-277">Use the following example to create a new utility control point:</span></span>

```powershell
$UtilityInstance = new-object -Type Microsoft.SqlServer.Management.Smo.Server "ComputerName\UCP-Name";
$SqlStoreConnection = new-object -Type Microsoft.SqlServer.Management.Sdk.Sfc.SqlStoreConnection $UtilityInstance.ConnectionContext.SqlConnectionObject;
$Utility = [Microsoft.SqlServer.Management.Utility.Utility]::CreateUtility("Utility", $SqlStoreConnection, "ProxyAccount", "ProxyAccountPassword");
```

## <a name="see-also"></a><span data-ttu-id="a3dd8-278">另请参阅</span><span class="sxs-lookup"><span data-stu-id="a3dd8-278">See Also</span></span>
 <span data-ttu-id="a3dd8-279">[SQL Server 实用工具功能和任务](sql-server-utility-features-and-tasks.md)对[SQL Server 实用工具进行故障排除](../../database-engine/troubleshoot-the-sql-server-utility.md)</span><span class="sxs-lookup"><span data-stu-id="a3dd8-279">[SQL Server Utility Features and Tasks](sql-server-utility-features-and-tasks.md) [Troubleshoot the SQL Server Utility](../../database-engine/troubleshoot-the-sql-server-utility.md)</span></span>
