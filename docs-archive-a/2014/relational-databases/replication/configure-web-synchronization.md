---
title: 配置 Web 同步 | Microsoft Docs
ms.custom: ''
ms.date: 01/10/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
f1_keywords:
- SQL10.REP.CONFIGWEBSYNCWIZARD.SUBTYPE.F1
- SQL10.REP.CONFIGWEBSYNCWIZARD.CLIENTAUTH.F1
- SQL10.REP.CONFIGWEBSYNCWIZARD.WEBSERV.F1
- SQL10.REP.CONFIGWEBSYNCWIZARD.DIRACCESS.F1
- SQL10.REP.CONFIGWEBSYNCWIZARD.VIRDIRINFO.F1
- SQL10.REP.CONFIGWEBSYNCWIZARD.AUTHACCESS.F1
- SQL10.REP.CONFIGWEBSYNCWIZARD.COMPLETEWIZ.F1
- SQL10.REP.CONFIGWEBSYNCWIZARD.ANONACCESS.F1
- SQL10.REP.CONFIGWEBSYNCWIZARD.SNAPSHARE.F1
helpviewer_keywords:
- Web synchronization, security best practices
- Web synchronization, configuring
ms.assetid: 21f8e4d4-cd07-4856-98f0-9c9890ebbc82
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 406175533b92d13dce8c14b91b654fbb6099dc22
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87577571"
---
# <a name="configure-web-synchronization"></a><span data-ttu-id="ff083-102">Configure Web Synchronization</span><span class="sxs-lookup"><span data-stu-id="ff083-102">Configure Web Synchronization</span></span>
  <span data-ttu-id="ff083-103">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 合并复制的 Web 同步选项支持使用 HTTPS 协议跨 Internet 复制数据。</span><span class="sxs-lookup"><span data-stu-id="ff083-103">The Web synchronization option for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Merge Replication enables data replication using the HTTPS protocol over the Internet.</span></span> <span data-ttu-id="ff083-104">若要使用 Web 同步，首先需要执行以下配置操作：</span><span class="sxs-lookup"><span data-stu-id="ff083-104">To use Web synchronization, you first need to perform the following configuration actions:</span></span>  
  
1.  <span data-ttu-id="ff083-105">创建新的域帐户并映射 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 登录名。</span><span class="sxs-lookup"><span data-stu-id="ff083-105">Create new domain accounts and map [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] logins.</span></span>  
  
2.  <span data-ttu-id="ff083-106">配置运行 [!INCLUDE[msCoName](../../includes/msconame-md.md)] Internet 信息服务 (IIS) 的计算机以同步订阅。</span><span class="sxs-lookup"><span data-stu-id="ff083-106">Configure the computer that is running [!INCLUDE[msCoName](../../includes/msconame-md.md)] Internet Information Services (IIS) to synchronize subscriptions.</span></span>  
  
3.  <span data-ttu-id="ff083-107">配置合并发布以允许使用 Web 同步。</span><span class="sxs-lookup"><span data-stu-id="ff083-107">Configure a merge publication to allow Web synchronization.</span></span>  
  
4.  <span data-ttu-id="ff083-108">配置一个或多个订阅以使用 Web 同步。</span><span class="sxs-lookup"><span data-stu-id="ff083-108">Configure one or more subscriptions to use Web synchronization.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ff083-109">如果您计划复制大量数据或者使用大型数据类型（如 `varchar(max)`），请阅读本主题中的“复制大量数据”一节。</span><span class="sxs-lookup"><span data-stu-id="ff083-109">If you plan to replicate large volumes of data or use large data types such as `varchar(max)`, read the section "Replicating Large Volumes of Data" in this topic.</span></span>  
  
 <span data-ttu-id="ff083-110">若要成功设置 Web 同步，您必须决定如何配置安全性以满足您特定的要求和策略。</span><span class="sxs-lookup"><span data-stu-id="ff083-110">To successfully set up Web synchronization, you must decide how you will configure security to meet your particular requirements and policies.</span></span> <span data-ttu-id="ff083-111">最好先作出以上决策并创建必要的帐户，然后再尝试配置 IIS、发布和订阅。</span><span class="sxs-lookup"><span data-stu-id="ff083-111">It is best to make these decisions and create the necessary accounts before you attempt to configure IIS, the publication, and subscriptions.</span></span>  
  
 <span data-ttu-id="ff083-112">在之后的过程中，为简明起见，描述了一个使用本地帐户的简化安全配置。</span><span class="sxs-lookup"><span data-stu-id="ff083-112">In the procedures that follow, a simplified security configuration using local accounts is described, for brevity.</span></span> <span data-ttu-id="ff083-113">这个简化的配置适用于 IIS 及 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 发布服务器和分发服务器同时运行在同一计算机上的安装情况，尽管您更可能对生产环境中的安装使用多服务器拓扑（也是建议做法）。</span><span class="sxs-lookup"><span data-stu-id="ff083-113">This simplified configuration is suitable for installations where both IIS and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Publisher and Distributor are running on the same computer, even though it is much more likely (and recommended) that you will use a multiple-server topology for a production installation.</span></span> <span data-ttu-id="ff083-114">您可以在这些过程中用域帐户替代本地帐户。</span><span class="sxs-lookup"><span data-stu-id="ff083-114">You can substitute domain accounts for the local accounts in the procedures.</span></span>  
  
## <a name="creating-new-accounts-and-mapping-sql-server-logins"></a><span data-ttu-id="ff083-115">创建新帐户并映射 SQL Server 登录名</span><span class="sxs-lookup"><span data-stu-id="ff083-115">Creating New Accounts and Mapping SQL Server Logins</span></span>  
 <span data-ttu-id="ff083-116">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 复制侦听器 (replisapi.dll) 通过模拟为复制网站所关联的应用程序池指定的帐户来连接发布服务器。</span><span class="sxs-lookup"><span data-stu-id="ff083-116">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Replication Listener (replisapi.dll) connects to the Publisher by impersonating the account specified for the application pool that is associated with the replication web site.</span></span>  
  
 <span data-ttu-id="ff083-117">用于 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 复制侦听器的帐户必须具有 [Merge Agent Security](merge-agent-security.md)中的“连接发布服务器或分发服务器”一节所述的权限。</span><span class="sxs-lookup"><span data-stu-id="ff083-117">The account used for the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Replication Listener must have permissions as described in [Merge Agent Security](merge-agent-security.md), under the section "Connect to the Publisher or Distributor."</span></span> <span data-ttu-id="ff083-118">总之，该帐户必须：</span><span class="sxs-lookup"><span data-stu-id="ff083-118">In summary, the account must:</span></span>  
  
-   <span data-ttu-id="ff083-119">是发布访问列表 (PAL) 的成员。</span><span class="sxs-lookup"><span data-stu-id="ff083-119">Be a member of the Publication Access List (PAL).</span></span>  
  
-   <span data-ttu-id="ff083-120">映射到与发布数据库中的某个用户关联的登录名。</span><span class="sxs-lookup"><span data-stu-id="ff083-120">Be mapped to a login associated with a user in the publication database.</span></span>  
  
-   <span data-ttu-id="ff083-121">映射到与分发数据库中的某个用户关联的登录名。</span><span class="sxs-lookup"><span data-stu-id="ff083-121">Be mapped to a login associated with a user in the distribution database.</span></span>  
  
-   <span data-ttu-id="ff083-122">对快照共享具有读取权限。</span><span class="sxs-lookup"><span data-stu-id="ff083-122">Have Read permissions on the snapshot share.</span></span>  
  
 <span data-ttu-id="ff083-123">如果您是首次使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 复制，您还需要为复制代理创建帐户和登录名。</span><span class="sxs-lookup"><span data-stu-id="ff083-123">If this is the first time you are using [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Replication, you will also need to create accounts and logins for the replication agents.</span></span> <span data-ttu-id="ff083-124">有关详细信息，请参阅本主题中的“配置发布”和“配置订阅”这两节。</span><span class="sxs-lookup"><span data-stu-id="ff083-124">For more information, see the "Configuring the Publication" and "Configuring the Subscription" sections in this topic.</span></span>  
  
 <span data-ttu-id="ff083-125">在配置 Web 同步前，建议您先阅读本主题中的“Web 同步的最佳安全配置”一节。</span><span class="sxs-lookup"><span data-stu-id="ff083-125">Before you configure Web synchronization, we recommend that you read the "Security Best Practices for Web Synchronization" section in this topic.</span></span> <span data-ttu-id="ff083-126">有关 Web 同步安全性的详细信息，请参阅 [Security Architecture for Web Synchronization](security/security-architecture-for-web-synchronization.md)。</span><span class="sxs-lookup"><span data-stu-id="ff083-126">For more information about Web synchronization security, see [Security Architecture for Web Synchronization](security/security-architecture-for-web-synchronization.md).</span></span>  
  
## <a name="configuring-the-computer-that-is-running-iis"></a><span data-ttu-id="ff083-127">配置正在运行 IIS 的计算机</span><span class="sxs-lookup"><span data-stu-id="ff083-127">Configuring the Computer That Is Running IIS</span></span>  
 <span data-ttu-id="ff083-128">Web 同步要求安装并配置 IIS。</span><span class="sxs-lookup"><span data-stu-id="ff083-128">Web synchronization requires that you install and configure IIS.</span></span> <span data-ttu-id="ff083-129">在配置发布以使用 Web 同步之前，您需要了解复制网站的 URL。</span><span class="sxs-lookup"><span data-stu-id="ff083-129">You will need the URL to the replication Web site before you can configure a publication to use Web synchronization.</span></span>  
  
<span data-ttu-id="ff083-130">从版本 5.0 开始，IIS 中支持 Web 同步。</span><span class="sxs-lookup"><span data-stu-id="ff083-130">Web synchronization is supported on IIS beginning with version 5.0.</span></span> <span data-ttu-id="ff083-131">IIS 版本 7.0 不支持配置 Web 同步向导。</span><span class="sxs-lookup"><span data-stu-id="ff083-131">The Configure Web Synchronization Wizard is not supported on IIS version 7.0.</span></span> <span data-ttu-id="ff083-132">从 SQL Server 2012 开始，要使用 IIS 服务器上的 Web 同步组件，我们建议用户随复制安装 SQL Server。</span><span class="sxs-lookup"><span data-stu-id="ff083-132">Beginning with SQL Server 2012, to use the web sync component on IIS server, we recommend users install SQL Server with replication.</span></span> <span data-ttu-id="ff083-133">这可以是免费的 SQL Server Express 版本。</span><span class="sxs-lookup"><span data-stu-id="ff083-133">This can be the free SQL Server Express edition.</span></span>  
  
 <span data-ttu-id="ff083-134">需要使用 SSL 进行 Web 同步。</span><span class="sxs-lookup"><span data-stu-id="ff083-134">SSL is required for Web synchronization.</span></span> <span data-ttu-id="ff083-135">您将需要由证书颁发机构颁发的安全证书。</span><span class="sxs-lookup"><span data-stu-id="ff083-135">You will need a security certificate issued by a certification authority.</span></span> <span data-ttu-id="ff083-136">仅出于测试目的，可以使用自行颁发的安全证书。</span><span class="sxs-lookup"><span data-stu-id="ff083-136">For testing purposes only, you can use a self-issued security certificate.</span></span>  
  
  
 <span data-ttu-id="ff083-137">**配置 IIS 以实现 Web 同步**</span><span class="sxs-lookup"><span data-stu-id="ff083-137">**To configure IIS for Web synchronization**</span></span>  
  
-   [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]<span data-ttu-id="ff083-138">设置用户帐户 ：[配置 IIS 以实现 Web 同步](configure-iis-for-web-synchronization.md)</span><span class="sxs-lookup"><span data-stu-id="ff083-138">: [Configure IIS for Web Synchronization](configure-iis-for-web-synchronization.md)</span></span>  
  
-   [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]<span data-ttu-id="ff083-139">设置用户帐户 ：[配置 IIS 7 以实现 Web 同步](configure-iis-7-for-web-synchronization.md)</span><span class="sxs-lookup"><span data-stu-id="ff083-139">: [Configure IIS 7 for Web Synchronization](configure-iis-7-for-web-synchronization.md)</span></span>  
  
## <a name="creating-a-web-garden"></a><span data-ttu-id="ff083-140">创建 Web 园</span><span class="sxs-lookup"><span data-stu-id="ff083-140">Creating a Web Garden</span></span>  
 <span data-ttu-id="ff083-141">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 复制侦听器支持每个线程处理两个并发同步操作。</span><span class="sxs-lookup"><span data-stu-id="ff083-141">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Replication Listener supports two concurrent synchronization operations per thread.</span></span> <span data-ttu-id="ff083-142">超出此限制可能导致复制侦听器停止响应。</span><span class="sxs-lookup"><span data-stu-id="ff083-142">Exceeding this limit may cause the Replication Listener to stop responding.</span></span> <span data-ttu-id="ff083-143">为 replisapi.dll 分配的线程数由应用程序池的 Maximum Worker Processes 属性来确定。</span><span class="sxs-lookup"><span data-stu-id="ff083-143">The number of threads allocated to replisapi.dll is determined by the application pool Maximum Worker Processes property.</span></span> <span data-ttu-id="ff083-144">默认情况下，此属性设置为 1。</span><span class="sxs-lookup"><span data-stu-id="ff083-144">By default, this property is set at 1.</span></span>  
  
 <span data-ttu-id="ff083-145">您可以通过增大 Maximum Worker Process 属性值来支持每个 CPU 处理更多的并发同步操作。</span><span class="sxs-lookup"><span data-stu-id="ff083-145">You can support a greater number of concurrent synchronization operations per CPU by increasing the Maximum Worker Process property value.</span></span> <span data-ttu-id="ff083-146">通过增大每个 CPU 的工作进程数进行扩展的方式被称为创建“Web 园”。</span><span class="sxs-lookup"><span data-stu-id="ff083-146">Scaling out by increasing the number of worker processes per CPU is known as creating a "Web garden."</span></span>  
  
 <span data-ttu-id="ff083-147">创建 Web 园将允许同时有两个以上的订阅服务器进行同步。</span><span class="sxs-lookup"><span data-stu-id="ff083-147">Web gardening will allow more than two Subscribers to synchronize at the same time.</span></span> <span data-ttu-id="ff083-148">但这也会增加 replisapi.dll 对 CPU 的占用，从而给服务器总体性能带来负面影响。</span><span class="sxs-lookup"><span data-stu-id="ff083-148">It will also increase CPU utilization by replisapi.dll, which can negatively impact overall server performance.</span></span> <span data-ttu-id="ff083-149">所以在选择 Maximum Worker Processes 的值时务须权衡考虑以上两个方面。</span><span class="sxs-lookup"><span data-stu-id="ff083-149">It is important to balance these considerations when you choose a value for Maximum Worker Processes.</span></span>  
  
#### <a name="to-increase-maximum-worker-processes-in-iis-7"></a><span data-ttu-id="ff083-150">在 IIS 7 中增加最大工作进程数</span><span class="sxs-lookup"><span data-stu-id="ff083-150">To increase Maximum Worker Processes in IIS 7</span></span>  
  
1.  <span data-ttu-id="ff083-151">在 **“Internet 信息服务(IIS)管理器”** 中，展开本地服务器节点，然后单击 **“应用程序池”** 节点。</span><span class="sxs-lookup"><span data-stu-id="ff083-151">In **Internet Information Services (IIS) Manager**, expand the local server node, and then click on the **Application Pool** node.</span></span>  
  
2.  <span data-ttu-id="ff083-152">选择与 Web 同步站点关联的应用程序池，然后单击 **“操作”** 窗格上的 **“高级设置”** 。</span><span class="sxs-lookup"><span data-stu-id="ff083-152">Select the application pool associated with the Web synchronization site, and then click **Advanced Settings** on the **Actions** pane.</span></span>  
  
3.  <span data-ttu-id="ff083-153">在“高级设置”对话框的 **“处理模型”** 标题下，单击标为 **“最大工作线程数”** 的行。</span><span class="sxs-lookup"><span data-stu-id="ff083-153">On the Advanced Settings dialog, under the **Process Model** heading, click the row labeled **Maximum Worker Processes**.</span></span> <span data-ttu-id="ff083-154">更改属性值，然后单击 **“确定”** 。</span><span class="sxs-lookup"><span data-stu-id="ff083-154">Change the property value, and then click **OK**.</span></span>  
  
## <a name="configuring-the-publication"></a><span data-ttu-id="ff083-155">配置发布</span><span class="sxs-lookup"><span data-stu-id="ff083-155">Configuring the Publication</span></span>  
 <span data-ttu-id="ff083-156">若要使用 Web 同步，需要创建一个发布（就像为标准合并拓扑创建发布一样）。</span><span class="sxs-lookup"><span data-stu-id="ff083-156">To use Web synchronization, create a publication in the same way that you would for a standard merge topology.</span></span> <span data-ttu-id="ff083-157">有关详细信息，请参阅[发布数据和数据库对象](publish/publish-data-and-database-objects.md)。</span><span class="sxs-lookup"><span data-stu-id="ff083-157">For more information, see [Publish Data and Database Objects](publish/publish-data-and-database-objects.md).</span></span>  
  
 <span data-ttu-id="ff083-158">创建发布后，启用允许通过以下方法之一（ [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]、 [!INCLUDE[tsql](../../includes/tsql-md.md)]或复制管理对象 (RMO)）进行 Web 同步的选项。</span><span class="sxs-lookup"><span data-stu-id="ff083-158">After the publication is created, enable the option to allow for Web synchronization by using one of the following methods: [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span> <span data-ttu-id="ff083-159">若要启用 Web 同步，需要为订阅服务器连接提供 Web 服务器地址。</span><span class="sxs-lookup"><span data-stu-id="ff083-159">To enable Web synchronization, you will need to supply the Web server address for Subscriber connections.</span></span>  
  
 <span data-ttu-id="ff083-160">如果您是首次使用发布服务器，还必须配置分发服务器和快照共享。</span><span class="sxs-lookup"><span data-stu-id="ff083-160">If you are using a Publisher for the first time, you must also configure a Distributor and a snapshot share.</span></span> <span data-ttu-id="ff083-161">每台订阅服务器中的合并代理都必须对快照共享具有读取权限。</span><span class="sxs-lookup"><span data-stu-id="ff083-161">The Merge Agent at each Subscriber must have read permissions on the snapshot share.</span></span> <span data-ttu-id="ff083-162">有关详细信息，请参阅[配置分发](configure-distribution.md)和[保护快照文件夹的安全](security/secure-the-snapshot-folder.md)。</span><span class="sxs-lookup"><span data-stu-id="ff083-162">For more information, see [Configure Distribution](configure-distribution.md) and [Secure the Snapshot Folder](security/secure-the-snapshot-folder.md).</span></span>  
  
 <span data-ttu-id="ff083-163">`gen` 是 websync xml 文件中的一个保留字。</span><span class="sxs-lookup"><span data-stu-id="ff083-163">`gen` is a reserved word in websync xml files.</span></span> <span data-ttu-id="ff083-164">不要尝试发布包含名为 `gen` 的列的表。</span><span class="sxs-lookup"><span data-stu-id="ff083-164">Do not attempt to publish tables containing columns named `gen`.</span></span>  
  
## <a name="configuring-the-subscription"></a><span data-ttu-id="ff083-165">配置订阅</span><span class="sxs-lookup"><span data-stu-id="ff083-165">Configuring the Subscription</span></span>  
 <span data-ttu-id="ff083-166">启用发布并配置 IIS 后，创建请求订阅并指定该请求订阅应通过使用 IIS 进行同步。</span><span class="sxs-lookup"><span data-stu-id="ff083-166">After you enable a publication and configure IIS, create a pull subscription and specify that the pull subscription should synchronize by using IIS.</span></span> <span data-ttu-id="ff083-167">（仅请求订阅支持 Web 同步。）</span><span class="sxs-lookup"><span data-stu-id="ff083-167">(Web synchronization is supported only for pull subscriptions.)</span></span>  
  
## <a name="upgrading-from-an-earlier-version-of-sql-server"></a><span data-ttu-id="ff083-168">升级 SQL Server 的早期版本</span><span class="sxs-lookup"><span data-stu-id="ff083-168">Upgrading from an Earlier Version of SQL Server</span></span>  
 <span data-ttu-id="ff083-169">如果您现在配置有 Web 同步拓扑，并且要升级 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]，则必须将 Replisapi.dll 的最新版本复制到 Web 同步所用的虚拟目录。</span><span class="sxs-lookup"><span data-stu-id="ff083-169">If you have an existing Web synchronization topology configured and you upgrade [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], you must ensure that the latest version of Replisapi.dll is copied to the virtual directory used by Web synchronization.</span></span> <span data-ttu-id="ff083-170">默认情况下，Replisapi.dll 的最新版本位于 C:\Program Files\Microsoft SQL Server\\<nnn\>\COM 中。</span><span class="sxs-lookup"><span data-stu-id="ff083-170">By default, the latest version of Replisapi.dll is located in C:\Program Files\Microsoft SQL Server\\<nnn\>\COM.</span></span>  
  
## <a name="replicating-large-volumes-of-data"></a><span data-ttu-id="ff083-171">复制大量数据</span><span class="sxs-lookup"><span data-stu-id="ff083-171">Replicating Large Volumes of Data</span></span>  
 <span data-ttu-id="ff083-172">为避免订阅服务器计算机出现潜在的内存问题，Web 同步对用于传输更改的 XML 文件使用默认最大大小 100 MB。</span><span class="sxs-lookup"><span data-stu-id="ff083-172">To help avoid potential memory problems on Subscriber computers Web synchronization uses a default maximum size of 100 MB for the XML file used to transfer changes.</span></span> <span data-ttu-id="ff083-173">可以通过设置以下注册表项来引发限制：</span><span class="sxs-lookup"><span data-stu-id="ff083-173">The limit can be raised by setting the following registry key:</span></span>  
  
 <span data-ttu-id="ff083-174">**HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SQL Server\100\Replication**</span><span class="sxs-lookup"><span data-stu-id="ff083-174">**HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SQL Server\100\Replication**</span></span>  
  
 <span data-ttu-id="ff083-175">**WebSyncMaxXmlSize DWORD 2000000**</span><span class="sxs-lookup"><span data-stu-id="ff083-175">**WebSyncMaxXmlSize DWORD 2000000**</span></span>  
  
 <span data-ttu-id="ff083-176">此注册表项可接受值的范围是 100 MB 到 4GB。</span><span class="sxs-lookup"><span data-stu-id="ff083-176">The range of acceptable values for this key is 100 MB to 4GB.</span></span> <span data-ttu-id="ff083-177">值以 KB 指定。</span><span class="sxs-lookup"><span data-stu-id="ff083-177">The value is specified in KB.</span></span> <span data-ttu-id="ff083-178">将此参数设置为高值并不保证您能够同步该数量的数据。</span><span class="sxs-lookup"><span data-stu-id="ff083-178">Setting this parameter to a high value does not guarantee that you can synchronize that amount of data.</span></span> <span data-ttu-id="ff083-179">有效限制值受订阅服务器计算机上的可用连续内存量约束。</span><span class="sxs-lookup"><span data-stu-id="ff083-179">The effective limit is constrained by how much contiguous memory is available on the Subscriber computer.</span></span> <span data-ttu-id="ff083-180">如果您的值必须大于 100 MB，建议您递增该值，并且使用订阅服务器上的典型工作负荷来测试内存占用。</span><span class="sxs-lookup"><span data-stu-id="ff083-180">If you must have a value larger than 100 MB, we recommend that you increase the value incrementally and test memory consumption with a typical workload on the Subscriber.</span></span>  
  
 <span data-ttu-id="ff083-181">XML 文件的最大大小为 4 GB，但复制会成批地同步该文件的更改。</span><span class="sxs-lookup"><span data-stu-id="ff083-181">The maximum size for the XML file is 4 GB, but replication synchronizes the changes from that file in batches.</span></span> <span data-ttu-id="ff083-182">数据和元数据的最大批大小是 25 MB。</span><span class="sxs-lookup"><span data-stu-id="ff083-182">The maximum batch size of data and metadata is 25 MB.</span></span> <span data-ttu-id="ff083-183">必须确保每批的数据不超过大约 20 MB，20 MB 足以容纳元数据和任何其他开销。</span><span class="sxs-lookup"><span data-stu-id="ff083-183">You must ensure that the data in each batch does not exceed approximately 20 MB, which allows for metadata and any other overhead.</span></span> <span data-ttu-id="ff083-184">此限制具有以下含义：</span><span class="sxs-lookup"><span data-stu-id="ff083-184">This limit has the following implications:</span></span>  
  
-   <span data-ttu-id="ff083-185">不能复制任何会导致数据和元数据超过 25 MB 的列。</span><span class="sxs-lookup"><span data-stu-id="ff083-185">You cannot replicate any column that causes the data and metadata to exceed 25 MB.</span></span> <span data-ttu-id="ff083-186">如果要复制的行包含大型数据类型（如 `varchar(max)`），这可能会引发问题。</span><span class="sxs-lookup"><span data-stu-id="ff083-186">This might be an issue when you are replicating rows that contain large data types, such as `varchar(max)`.</span></span>  
  
-   <span data-ttu-id="ff083-187">如果要复制大量数据，则可能必须调整合并代理的批大小。</span><span class="sxs-lookup"><span data-stu-id="ff083-187">If you replicate large volumes of data, you might have to adjust the Merge Agent batch size.</span></span>  
  
 <span data-ttu-id="ff083-188">合并复制的批大小是用“  代”度量的，代是指每个项目的变更集。</span><span class="sxs-lookup"><span data-stu-id="ff083-188">Batch size for merge replication is measured in *generations*, which are collections of changes per article.</span></span> <span data-ttu-id="ff083-189">批处理中的代数通过使用合并代理的- `DownloadGenerationsPerBatch` 和参数来指定 `UploadGenerationsPerBatch` 。</span><span class="sxs-lookup"><span data-stu-id="ff083-189">The number of generations in a batch is specified by using the-`DownloadGenerationsPerBatch` and -`UploadGenerationsPerBatch` parameters of the Merge Agent.</span></span> <span data-ttu-id="ff083-190">有关详细信息，请参阅 [Replication Merge Agent](agents/replication-merge-agent.md)。</span><span class="sxs-lookup"><span data-stu-id="ff083-190">For more information, see [Replication Merge Agent](agents/replication-merge-agent.md).</span></span>  
  
 <span data-ttu-id="ff083-191">对于大量数据，请为每个批次参数指定一个较小的数字。</span><span class="sxs-lookup"><span data-stu-id="ff083-191">For large volumes of data, specify a small number for each of the batching parameters.</span></span> <span data-ttu-id="ff083-192">我们建议您从值 10 开始，然后基于应用程序需要和性能进行调整。</span><span class="sxs-lookup"><span data-stu-id="ff083-192">We recommend that you start with a value of 10, and then tune based on application needs and performance.</span></span> <span data-ttu-id="ff083-193">通常，这些参数在代理配置文件中指定。</span><span class="sxs-lookup"><span data-stu-id="ff083-193">Typically, these parameters are specified in an agent profile.</span></span> <span data-ttu-id="ff083-194">有关配置文件的详细信息，请参阅 [Replication Agent Profiles](agents/replication-agent-profiles.md)。</span><span class="sxs-lookup"><span data-stu-id="ff083-194">For more information about profiles, see [Replication Agent Profiles](agents/replication-agent-profiles.md).</span></span>  
  
## <a name="security-best-practices-for-web-synchronization"></a><span data-ttu-id="ff083-195">Web 同步的最佳安全配置</span><span class="sxs-lookup"><span data-stu-id="ff083-195">Security Best Practices for Web Synchronization</span></span>  
 <span data-ttu-id="ff083-196">在 Web 同步中，有很多与安全相关的设置可供选择。</span><span class="sxs-lookup"><span data-stu-id="ff083-196">There are many choices for security-related settings in Web synchronization.</span></span> <span data-ttu-id="ff083-197">建议使用以下方法：</span><span class="sxs-lookup"><span data-stu-id="ff083-197">We recommend the following approach:</span></span>  
  
-   <span data-ttu-id="ff083-198">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 分发服务器和发布服务器可位于同一台计算机上（这是合并复制的典型安装）。</span><span class="sxs-lookup"><span data-stu-id="ff083-198">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Distributor and Publisher can be on the same computer (a typical setup for merge replication).</span></span> <span data-ttu-id="ff083-199">但是，IIS 应该安装在单独的计算机上。</span><span class="sxs-lookup"><span data-stu-id="ff083-199">However, IIS should be installedon a separate computer.</span></span>  
  
-   <span data-ttu-id="ff083-200">使用安全套接字层 (SSL) 加密订阅服务器和运行 IIS 的计算机之间的连接。</span><span class="sxs-lookup"><span data-stu-id="ff083-200">Use Secure Sockets Layer (SSL) to encrypt the connection between the Subscriber and the computer running IIS.</span></span> <span data-ttu-id="ff083-201">这对 Web 同步是必需的。</span><span class="sxs-lookup"><span data-stu-id="ff083-201">This is required for Web synchronization.</span></span>  
  
-   <span data-ttu-id="ff083-202">对从订阅服务器到 IIS 的连接使用基本身份验证。</span><span class="sxs-lookup"><span data-stu-id="ff083-202">Use Basic Authentication for connections from the Subscriber to IIS.</span></span> <span data-ttu-id="ff083-203">使用基本身份验证，IIS 服务器无需委托，就可以代表订阅服务器与发布服务器/分发服务器建立连接。</span><span class="sxs-lookup"><span data-stu-id="ff083-203">Using Basic Authentication, IIS can make connections to the Publisher/Distributor on behalf of the Subscriber without requiring delegation.</span></span> <span data-ttu-id="ff083-204">如果使用集成身份验证，则必须使用委托。</span><span class="sxs-lookup"><span data-stu-id="ff083-204">Delegation is required if you use Integrated Authentication.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="ff083-205">基本身份验证是将凭据传递给 IIS 时所采用的方法。</span><span class="sxs-lookup"><span data-stu-id="ff083-205">Basic Authentication is the method by which credentials are passed to IIS.</span></span> <span data-ttu-id="ff083-206">基本身份验证不会阻止为与 IIS 建立的连接指定 Windows 域帐户。</span><span class="sxs-lookup"><span data-stu-id="ff083-206">Basic Authentication does not prevent specifying Windows domain accounts for connections that are made to IIS.</span></span>  
  
-   <span data-ttu-id="ff083-207">指定快照代理应以 Windows 域帐户运行，并指定代理应以该帐户建立连接。</span><span class="sxs-lookup"><span data-stu-id="ff083-207">Specify that the Snapshot Agent should run under a Windows domain account, and specify that the agent should make connections as that account.</span></span> <span data-ttu-id="ff083-208">（这是默认配置。）指定每个合并代理都应以使用订阅服务器计算机的用户的域帐户运行，并指定代理应以该帐户建立连接。</span><span class="sxs-lookup"><span data-stu-id="ff083-208">(This is the default configuration.) Specify that each Merge Agent should run under the domain account of the user that uses the Subscriber computer, and specify that the agent should make connections as that account.</span></span>  
  
     <span data-ttu-id="ff083-209">有关代理所需权限的详细信息，请参阅 [Replication Agent Security Model](security/replication-agent-security-model.md)。</span><span class="sxs-lookup"><span data-stu-id="ff083-209">For more information about the permissions that are required by agents, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
-   <span data-ttu-id="ff083-210">指定与在新建订阅向导的 " **Web 服务器信息**" 页中指定帐户和密码时使用的域帐户相同的域帐户，或者指定 sp_addpullsubscription_agent 的和参数的值时所使用的域合并代理帐户 **@internet_url** **@internet_login** 。 [sp_addpullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql)</span><span class="sxs-lookup"><span data-stu-id="ff083-210">Specify the same domain account as the one the Merge Agent uses when you specify an account and password on the **Web Server Information** page of the New Subscription Wizard or when you specify values for the **@internet_url** and **@internet_login** parameters of [sp_addpullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql).</span></span> <span data-ttu-id="ff083-211">此帐户必须具有对快照共享的读取权限。</span><span class="sxs-lookup"><span data-stu-id="ff083-211">This account must have read permissions for the snapshot share.</span></span>  
  
-   <span data-ttu-id="ff083-212">每个发布都应对 IIS 使用一个单独的虚拟目录。</span><span class="sxs-lookup"><span data-stu-id="ff083-212">Each publication should use a separate virtual directory for IIS.</span></span>  
  
-   <span data-ttu-id="ff083-213">运行 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 复制侦听器 (Replisapi.dll) 的帐户也是要在同步期间连接到发布服务器和分发服务器的帐户。</span><span class="sxs-lookup"><span data-stu-id="ff083-213">The account under which the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Replication Listener (Replisapi.dll) runs is also the account that will connect to the Publisher and Distributor during synchronization.</span></span> <span data-ttu-id="ff083-214">此帐户必须映射到发布服务器和分发服务器上的 SQL 登录帐户。</span><span class="sxs-lookup"><span data-stu-id="ff083-214">This account must be mapped to a SQL Login account on the Publisher and Distributor.</span></span> <span data-ttu-id="ff083-215">有关详细信息，请参阅[配置 IIS 以实现 Web 同步](configure-iis-for-web-synchronization.md)中的“设置 SQL Server 复制侦听器的权限”一节。</span><span class="sxs-lookup"><span data-stu-id="ff083-215">For more information, see the "Setting Permissions for the SQL Server Replication Listener" section in the [Configure IIS for Web Synchronization](configure-iis-for-web-synchronization.md).</span></span>  
  
-   <span data-ttu-id="ff083-216">可以使用 FTP 将快照从发布服务器传递到运行 IIS 的计算机。</span><span class="sxs-lookup"><span data-stu-id="ff083-216">You can use FTP to deliver the snapshot from the Publisher to the computer that is running IIS.</span></span> <span data-ttu-id="ff083-217">快照始终使用 HTTPS 从运行 IIS 的计算机传递到订阅服务器。</span><span class="sxs-lookup"><span data-stu-id="ff083-217">The snapshot is always delivered from the computer that is running IIS to the Subscriber by using HTTPS.</span></span> <span data-ttu-id="ff083-218">有关详细信息，请参阅[通过 FTP 传输快照](transfer-snapshots-through-ftp.md)。</span><span class="sxs-lookup"><span data-stu-id="ff083-218">For more information, see [Transfer Snapshots Through FTP](transfer-snapshots-through-ftp.md).</span></span>  
  
-   <span data-ttu-id="ff083-219">如果复制拓扑中的服务器位于防火墙之后，则需要在防火墙中打开端口以便启用 Web 同步。</span><span class="sxs-lookup"><span data-stu-id="ff083-219">If servers in the replication topology are behind a firewall, you might need to open ports in the firewall to enable Web synchronization.</span></span>  
  
    -   <span data-ttu-id="ff083-220">订阅服务器计算机使用 SSL 通过 HTTPS（通常配置为使用端口 443）连接到运行 IIS 的计算机。</span><span class="sxs-lookup"><span data-stu-id="ff083-220">The Subscriber computer connects to the computer that is running IIS over HTTPS using SSL, which is typically configured to use port 443.</span></span> [!INCLUDE[ssEW](../../includes/ssew-md.md)] <span data-ttu-id="ff083-221">订阅服务器还可以通过 HTTP（通常配置为使用端口 80）建立连接。</span><span class="sxs-lookup"><span data-stu-id="ff083-221">Subscribers can also connect over HTTP, which is typically configured to use port 80.</span></span>  
  
    -   <span data-ttu-id="ff083-222">运行 IIS 的计算机通常通过端口 1433 连接到发布服务器或分发服务器（默认实例）。</span><span class="sxs-lookup"><span data-stu-id="ff083-222">The computer that is running IIS typically connects to the Publisher or Distributor using port 1433 (default instance).</span></span> <span data-ttu-id="ff083-223">当发布服务器或分发服务器是某台服务器上的命名实例，且该服务器具有另一个默认实例时，则通常通过端口 1500 连接到命名实例。</span><span class="sxs-lookup"><span data-stu-id="ff083-223">When the Publisher or Distributor is a named instance on a server with another default instance, port 1500 is typically used to connect to the named instance.</span></span>  
  
    -   <span data-ttu-id="ff083-224">如果运行 IIS 的计算机与分发服务器被防火墙隔离开来，且快照传送使用的是 FTP 共享，则必须打开用于 FTP 的端口。</span><span class="sxs-lookup"><span data-stu-id="ff083-224">If the computer running IIS is separated from the Distributor by a firewall and an FTP share is used for snapshot delivery, the ports used for FTP must be opened.</span></span> <span data-ttu-id="ff083-225">有关详细信息，请参阅[通过 FTP 传输快照](transfer-snapshots-through-ftp.md)。</span><span class="sxs-lookup"><span data-stu-id="ff083-225">For more information, see [Transfer Snapshots Through FTP](transfer-snapshots-through-ftp.md).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="ff083-226">打开防火墙的端口可能会使服务器受到恶意攻击。</span><span class="sxs-lookup"><span data-stu-id="ff083-226">Opening ports in your firewall can leave your server exposed to malicious attacks.</span></span> <span data-ttu-id="ff083-227">请确保在打开端口之前了解防火墙系统。</span><span class="sxs-lookup"><span data-stu-id="ff083-227">Make sure that you understand firewall systems before you open ports.</span></span> <span data-ttu-id="ff083-228">有关详细信息，请参阅 [Security Considerations for a SQL Server Installation](../../sql-server/install/security-considerations-for-a-sql-server-installation.md)。</span><span class="sxs-lookup"><span data-stu-id="ff083-228">For more information, see [Security Considerations for a SQL Server Installation](../../sql-server/install/security-considerations-for-a-sql-server-installation.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ff083-229">另请参阅</span><span class="sxs-lookup"><span data-stu-id="ff083-229">See Also</span></span>  
 [<span data-ttu-id="ff083-230">合并复制的 Web 同步</span><span class="sxs-lookup"><span data-stu-id="ff083-230">Web Synchronization for Merge Replication</span></span>](web-synchronization-for-merge-replication.md)  
  
  
