---
title: 复制管理员常见问题解答 | Microsoft Docs
ms.custom: ''
ms.date: 03/09/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- administering replication, frequently asked questions
- replication [SQL Server], administering
ms.assetid: 5a9e4ddf-3cb1-4baf-94d6-b80acca24f64
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 02f12008b9ab8e9cd4c7d08ed81a902629b90827
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87691701"
---
# <a name="frequently-asked-questions-for-replication-administrators"></a><span data-ttu-id="d19ab-102">复制管理员常见问题</span><span class="sxs-lookup"><span data-stu-id="d19ab-102">Frequently Asked Questions for Replication Administrators</span></span>
  <span data-ttu-id="d19ab-103">下列问题和解答就复制数据库管理员所面临的多种任务提供指导。</span><span class="sxs-lookup"><span data-stu-id="d19ab-103">The following questions and answers provide guidance on a variety of tasks faced by administrators of replicated databases.</span></span>  
  
## <a name="configuring-replication"></a><span data-ttu-id="d19ab-104">配置复制</span><span class="sxs-lookup"><span data-stu-id="d19ab-104">Configuring Replication</span></span>  
  
### <a name="does-activity-need-to-be-stopped-on-a-database-when-it-is-published"></a><span data-ttu-id="d19ab-105">活动在发布时是否需要在数据库上停止？</span><span class="sxs-lookup"><span data-stu-id="d19ab-105">Does activity need to be stopped on a database when it is published?</span></span>  
 <span data-ttu-id="d19ab-106">不是。</span><span class="sxs-lookup"><span data-stu-id="d19ab-106">No.</span></span> <span data-ttu-id="d19ab-107">创建发布时，活动仍可在数据库上继续进行。</span><span class="sxs-lookup"><span data-stu-id="d19ab-107">Activity can continue on a database while a publication is being created.</span></span> <span data-ttu-id="d19ab-108">注意，生成快照可能占用大量资源，因此最好在数据库活动较少的期间生成快照（默认情况下完成新建发布向导后就生成快照）。</span><span class="sxs-lookup"><span data-stu-id="d19ab-108">Be aware that producing a snapshot can be resource-intensive, so it is best to generate snapshots during periods of lower activity on the database (by default a snapshot is generated when you complete the New Publication Wizard).</span></span>  
  
### <a name="are-tables-locked-during-snapshot-generation"></a><span data-ttu-id="d19ab-109">快照生成期间是否锁定表？</span><span class="sxs-lookup"><span data-stu-id="d19ab-109">Are tables locked during snapshot generation?</span></span>  
 <span data-ttu-id="d19ab-110">锁定的时间长度取决于所用复制的类型：</span><span class="sxs-lookup"><span data-stu-id="d19ab-110">The length of time that the locks are taken depends on the type of replication used:</span></span>  
  
-   <span data-ttu-id="d19ab-111">对于合并发布，快照代理不使用任何锁。</span><span class="sxs-lookup"><span data-stu-id="d19ab-111">For merge publications, the Snapshot Agent does not take any locks.</span></span>  
  
-   <span data-ttu-id="d19ab-112">对于事务发布，默认情况下快照代理只在快照生成的初始阶段进行锁定。</span><span class="sxs-lookup"><span data-stu-id="d19ab-112">For transactional publications, by default the Snapshot Agent takes locks only during the initial phase of snapshot generation.</span></span>  
  
-   <span data-ttu-id="d19ab-113">对于快照发布，快照代理在快照生成的整个过程中都进行锁定。</span><span class="sxs-lookup"><span data-stu-id="d19ab-113">For snapshot publications the Snapshot Agent takes locks during the entire snapshot generation process.</span></span>  
  
 <span data-ttu-id="d19ab-114">由于锁会阻止其他用户更新表，所以应把快照代理安排在数据库活动较少的期间执行，对快照发布尤其如此。</span><span class="sxs-lookup"><span data-stu-id="d19ab-114">Because locks prevent other users from updating the tables, the Snapshot Agent should be scheduled to execute during periods of lower activity on the database, especially for snapshot publications.</span></span>  
  
### <a name="when-is-a-subscription-available-when-can-the-subscription-database-be-used"></a><span data-ttu-id="d19ab-115">订阅何时可用？何时可以使用订阅数据库？</span><span class="sxs-lookup"><span data-stu-id="d19ab-115">When is a subscription available; when can the subscription database be used?</span></span>  
 <span data-ttu-id="d19ab-116">将快照应用于订阅数据库之后，即可使用订阅。</span><span class="sxs-lookup"><span data-stu-id="d19ab-116">A subscription is available after the snapshot has been applied to the subscription database.</span></span> <span data-ttu-id="d19ab-117">即使订阅数据库在此之前就可以访问，但在应用快照之前，不应使用数据库。</span><span class="sxs-lookup"><span data-stu-id="d19ab-117">Even though the subscription database is accessible prior to this, the database should not be used until after the snapshot has been applied.</span></span> <span data-ttu-id="d19ab-118">使用复制监视器检查快照生成和应用的状态：</span><span class="sxs-lookup"><span data-stu-id="d19ab-118">Use Replication Monitor to check the status of snapshot generation and application:</span></span>  
  
-   <span data-ttu-id="d19ab-119">快照由快照代理生成。</span><span class="sxs-lookup"><span data-stu-id="d19ab-119">The snapshot is generated by the Snapshot Agent.</span></span> <span data-ttu-id="d19ab-120">请在复制监视器中某个发布的 **“代理”** 选项卡中查看快照生成的状态。</span><span class="sxs-lookup"><span data-stu-id="d19ab-120">View the status of snapshot generation on the **Agents** tab for a publication in Replication Monitor.</span></span> <span data-ttu-id="d19ab-121">有关详细信息，请参阅[使用复制监视器查看信息和执行任务](../monitor/view-information-and-perform-tasks-replication-monitor.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-121">For more information, see [View Information and Perform Tasks using Replication Monitor](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span></span>  
  
-   <span data-ttu-id="d19ab-122">快照由分发代理或合并代理应用。</span><span class="sxs-lookup"><span data-stu-id="d19ab-122">The snapshot is applied by the Distribution Agent or Merge Agent.</span></span> <span data-ttu-id="d19ab-123">请在复制监视器的 **“分发代理”** 页或 **“合并代理”** 页中查看快照应用的状态。</span><span class="sxs-lookup"><span data-stu-id="d19ab-123">View the status of snapshot application in the **Distribution Agent** or **Merge Agent** page of Replication Monitor.</span></span> 
  
### <a name="what-happens-if-the-snapshot-agent-has-not-completed-when-the-distribution-or-merge-agent-starts"></a><span data-ttu-id="d19ab-124">如果分发代理或合并代理启动时快照代理尚未完成，会出现什么情况？</span><span class="sxs-lookup"><span data-stu-id="d19ab-124">What happens if the Snapshot Agent has not completed when the Distribution or Merge Agent starts?</span></span>  
 <span data-ttu-id="d19ab-125">如果分发代理或合并代理和快照代理同时运行，不会引发错误。</span><span class="sxs-lookup"><span data-stu-id="d19ab-125">It will not cause an error if the Distribution Agent or Merge Agent runs at the same time as the Snapshot Agent.</span></span> <span data-ttu-id="d19ab-126">但是，必须注意下列事项：</span><span class="sxs-lookup"><span data-stu-id="d19ab-126">However, you must be aware of the following:</span></span>  
  
-   <span data-ttu-id="d19ab-127">如果将分发代理或合并代理配置为连续运行，则该代理将在快照代理完成之后自动应用快照。</span><span class="sxs-lookup"><span data-stu-id="d19ab-127">If the Distribution Agent or Merge Agent is configured to run continuously, the agent applies the snapshot automatically after the Snapshot Agent completes.</span></span>  
  
-   <span data-ttu-id="d19ab-128">如果将分发代理或合并代理配置为按计划运行或按需运行，而且在代理运行时不存在可用的快照，则代理将关闭，并显示一条快照尚不可用的消息。</span><span class="sxs-lookup"><span data-stu-id="d19ab-128">If the Distribution Agent or Merge Agent is configured to run on a schedule or on-demand, and there is no snapshot available when the agent runs, the agent will shut down with a message stating that a snapshot is not yet available.</span></span> <span data-ttu-id="d19ab-129">快照代理完成后，必须再次运行代理以应用快照。</span><span class="sxs-lookup"><span data-stu-id="d19ab-129">You must run the agent again to apply the snapshot after the Snapshot Agent has completed.</span></span> <span data-ttu-id="d19ab-130">有关运行代理的详细信息，请参阅[同步推送订阅](../synchronize-a-push-subscription.md)、[同步请求订阅](../synchronize-a-pull-subscription.md)和[复制代理可执行文件概念](../concepts/replication-agent-executables-concepts.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-130">For more information on running agents, see [Synchronize a Push Subscription](../synchronize-a-push-subscription.md), [Synchronize a Pull Subscription](../synchronize-a-pull-subscription.md), and [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
### <a name="should-i-script-my-replication-configuration"></a><span data-ttu-id="d19ab-131">是否应为复制配置编写脚本？</span><span class="sxs-lookup"><span data-stu-id="d19ab-131">Should I script my replication configuration?</span></span>  
 <span data-ttu-id="d19ab-132">是的。</span><span class="sxs-lookup"><span data-stu-id="d19ab-132">Yes.</span></span> <span data-ttu-id="d19ab-133">为复制配置编写脚本是任何复制拓扑的灾难恢复计划的关键。</span><span class="sxs-lookup"><span data-stu-id="d19ab-133">Scripting the replication configuration is a key part of any disaster recovery plan for a replication topology.</span></span> <span data-ttu-id="d19ab-134">有关编写脚本的详细信息，请参阅 [Scripting Replication](../scripting-replication.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-134">For more information on scripting, see [Scripting Replication](../scripting-replication.md).</span></span>  
  
### <a name="what-recovery-model-is-required-on-a-replicated-database"></a><span data-ttu-id="d19ab-135">复制数据库需要什么样的恢复模式？</span><span class="sxs-lookup"><span data-stu-id="d19ab-135">What recovery model is required on a replicated database?</span></span>  
 <span data-ttu-id="d19ab-136">复制使用以下任何恢复模式都可正常运行：简单恢复模式、大容量日志恢复模式或完整恢复模式。</span><span class="sxs-lookup"><span data-stu-id="d19ab-136">Replication functions properly using any of the recovery models: simple, bulk-logged, or full.</span></span> <span data-ttu-id="d19ab-137">合并复制以在元数据表中存储信息的方式跟踪更改。</span><span class="sxs-lookup"><span data-stu-id="d19ab-137">Merge replication tracks change by storing information in metadata tables.</span></span> <span data-ttu-id="d19ab-138">事务复制通过标记事务日志来跟踪更改，但此标记过程不受恢复模式影响。</span><span class="sxs-lookup"><span data-stu-id="d19ab-138">Transactional replication tracks changes by marking the transaction log, but this marking process is not affected by the recovery model.</span></span>  
  
### <a name="why-does-replication-add-a-column-to-replicated-tables-will-it-be-removed-if-the-table-isnt-published"></a><span data-ttu-id="d19ab-139">复制为什么要向已复制的表添加一列；如果表并未发布，是否会删除该列？</span><span class="sxs-lookup"><span data-stu-id="d19ab-139">Why does replication add a column to replicated tables; will it be removed if the table isn't published?</span></span>  
 <span data-ttu-id="d19ab-140">若要跟踪更改，带有排队更新订阅的合并复制和事务复制必须能够唯一地标识每个已发布表中的每一行。</span><span class="sxs-lookup"><span data-stu-id="d19ab-140">To track changes, merge replication and transactional replication with queued updating subscriptions must be able to uniquely identify every row in every published table.</span></span> <span data-ttu-id="d19ab-141">为实现这一点：</span><span class="sxs-lookup"><span data-stu-id="d19ab-141">To accomplish this:</span></span>  
  
-   <span data-ttu-id="d19ab-142">合并复制向每个表添加 **rowguid** 列，除非表中已包含一个具有 **ROWGUIDCOL** 属性集且数据类型为 **uniqueidentifier** 的列（这种情况下将使用此列）。</span><span class="sxs-lookup"><span data-stu-id="d19ab-142">Merge replication adds the column **rowguid** to every table, unless the table already has a column of data type **uniqueidentifier** with the **ROWGUIDCOL** property set (in which case this column is used).</span></span> <span data-ttu-id="d19ab-143">如果从发布中删除表，则删除 **rowguid** 列；如果将现有列用于跟踪，则不删除该列。</span><span class="sxs-lookup"><span data-stu-id="d19ab-143">If the table is dropped from the publication, the **rowguid** column is removed; if an existing column was used for tracking, the column is not removed.</span></span>  
  
-   <span data-ttu-id="d19ab-144">如果事务发布支持排队更新订阅，复制就会向每个表添加 **msrepl_tran_version** 列。</span><span class="sxs-lookup"><span data-stu-id="d19ab-144">If a transactional publication supports queued updating subscriptions, replication adds the column **msrepl_tran_version** to every table.</span></span> <span data-ttu-id="d19ab-145">如果从发布中删除表，则不会删除 **msrepl_tran_version** 列。</span><span class="sxs-lookup"><span data-stu-id="d19ab-145">If the table is dropped from the publication, the **msrepl_tran_version** column is not removed.</span></span>  
  
-   <span data-ttu-id="d19ab-146">筛选器不能包含复制所用的 `rowguidcol` 来标识行。</span><span class="sxs-lookup"><span data-stu-id="d19ab-146">A filter must not include the `rowguidcol` used by replication to identify rows.</span></span> <span data-ttu-id="d19ab-147">默认情况下，这是您设置合并复制时添加的列，命名为 **rowguid**。</span><span class="sxs-lookup"><span data-stu-id="d19ab-147">By default this is the column added at the time you set up merge replication and is named **rowguid**.</span></span>  
  
### <a name="how-do-i-manage-constraints-on-published-tables"></a><span data-ttu-id="d19ab-148">如何管理已发布表的约束？</span><span class="sxs-lookup"><span data-stu-id="d19ab-148">How do I manage constraints on published tables?</span></span>  
 <span data-ttu-id="d19ab-149">关于已发布表的约束，有几个问题需要考虑：</span><span class="sxs-lookup"><span data-stu-id="d19ab-149">There are a number of issues to consider regarding constraints on published tables:</span></span>  
  
-   <span data-ttu-id="d19ab-150">事务复制要求每个已发布表都有主键约束。</span><span class="sxs-lookup"><span data-stu-id="d19ab-150">Transactional replication requires a primary key constraint on each published table.</span></span> <span data-ttu-id="d19ab-151">合并复制不需要主键，但如果存在一个主键，则必须复制该主键。</span><span class="sxs-lookup"><span data-stu-id="d19ab-151">Merge replication does not require a primary key, but if one is present, it must be replicated.</span></span> <span data-ttu-id="d19ab-152">快照复制不需要主键。</span><span class="sxs-lookup"><span data-stu-id="d19ab-152">Snapshot replication does not require a primary key.</span></span>  
  
-   <span data-ttu-id="d19ab-153">默认情况下，主键约束、索引和检查约束都会复制到订阅服务器。</span><span class="sxs-lookup"><span data-stu-id="d19ab-153">By default, primary key constraints, indexes, and check constraints are replicated to Subscribers.</span></span>  
  
-   <span data-ttu-id="d19ab-154">默认情况下为外键约束和检查约束指定 NOT FOR REPLICATION 选项；约束对用户操作强制使用，但不对代理操作强制使用。</span><span class="sxs-lookup"><span data-stu-id="d19ab-154">The NOT FOR REPLICATION option is specified by default for foreign key constraints and check constraints; the constraints are enforced for user operations but not agent operations.</span></span>  
  
 <span data-ttu-id="d19ab-155">有关设置控制是否复制约束的架构选项的信息，请参阅 [Specify Schema Options](../publish/specify-schema-options.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-155">For information on setting the schema options that control whether constraints are replicated, see [Specify Schema Options](../publish/specify-schema-options.md).</span></span>  
  
### <a name="how-do-i-manage-identity-columns"></a><span data-ttu-id="d19ab-156">如何管理标识列？</span><span class="sxs-lookup"><span data-stu-id="d19ab-156">How do I manage identity columns?</span></span>  
 <span data-ttu-id="d19ab-157">复制在订阅服务器中为包含更新的复制拓扑提供自动标识范围管理。</span><span class="sxs-lookup"><span data-stu-id="d19ab-157">Replication provides automatic identity range management for replication topologies that include updates at the Subscriber.</span></span> <span data-ttu-id="d19ab-158">有关详细信息，请参阅[复制标识列](../publish/replicate-identity-columns.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-158">For more information, see [Replicate Identity Columns](../publish/replicate-identity-columns.md).</span></span>  
  
### <a name="can-the-same-objects-be-published-in-different-publications"></a><span data-ttu-id="d19ab-159">是否可以在不同的发布中发布相同的对象？</span><span class="sxs-lookup"><span data-stu-id="d19ab-159">Can the same objects be published in different publications?</span></span>  
 <span data-ttu-id="d19ab-160">是，但有一些限制。</span><span class="sxs-lookup"><span data-stu-id="d19ab-160">Yes, but with some restrictions.</span></span> <span data-ttu-id="d19ab-161">有关详细信息，请参阅[发布数据和数据库对象](../publish/publish-data-and-database-objects.md)主题中的“在多个发布中发布表”部分。</span><span class="sxs-lookup"><span data-stu-id="d19ab-161">For more information, see the section "Publishing Tables in More Than One Publication" in the topic [Publish Data and Database Objects](../publish/publish-data-and-database-objects.md).</span></span>  
  
### <a name="can-multiple-publications-use-the-same-distribution-database"></a><span data-ttu-id="d19ab-162">多个发布是否可以使用同一个分发数据库？</span><span class="sxs-lookup"><span data-stu-id="d19ab-162">Can multiple publications use the same distribution database?</span></span>  
 <span data-ttu-id="d19ab-163">是的。</span><span class="sxs-lookup"><span data-stu-id="d19ab-163">Yes.</span></span> <span data-ttu-id="d19ab-164">对于可以使用同一分发数据库的发布的数量或类型没有任何限制。</span><span class="sxs-lookup"><span data-stu-id="d19ab-164">There are no restrictions on the number or types of publications that can use the same distribution database.</span></span> <span data-ttu-id="d19ab-165">来自给定发布服务器的所有发布都必须使用同一分发服务器和分发数据库。</span><span class="sxs-lookup"><span data-stu-id="d19ab-165">All publications from a given Publisher must use the same Distributor and distribution database.</span></span>  
  
 <span data-ttu-id="d19ab-166">如果有多个发布，则可以在分发服务器上配置多个分发数据库，以确保通过每个分发数据库的数据流都来自单个发布。</span><span class="sxs-lookup"><span data-stu-id="d19ab-166">If you have multiple publications, you can configure multiple distribution databases at the Distributor to ensure that the data flowing through each distribution database is from a single publication.</span></span> <span data-ttu-id="d19ab-167">使用“分发服务器属性”对话框或 [sp_adddistributiondb &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributiondb-transact-sql) 添加分发数据库。</span><span class="sxs-lookup"><span data-stu-id="d19ab-167">Use the **Distributor Properties** dialog box or [sp_adddistributiondb &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributiondb-transact-sql) to add a distribution database.</span></span> <span data-ttu-id="d19ab-168">有关访问该对话框的详细信息，请参阅[查看和修改分发服务器和发布服务器属性](../view-and-modify-distributor-and-publisher-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-168">For more information about accessing the dialog box, see [View and Modify Distributor and Publisher Properties](../view-and-modify-distributor-and-publisher-properties.md).</span></span>  
  
### <a name="how-do-i-find-information-on-the-distributor-and-publisher-such-as-which-objects-in-a-database-are-published"></a><span data-ttu-id="d19ab-169">如何在分发服务器和发布服务器中查找信息，如已经发布了数据库中的哪些对象？</span><span class="sxs-lookup"><span data-stu-id="d19ab-169">How do I find information on the Distributor and Publisher, such as which objects in a database are published?</span></span>  
 <span data-ttu-id="d19ab-170">此信息可通过 [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]和许多复制存储过程获得。</span><span class="sxs-lookup"><span data-stu-id="d19ab-170">This information is available through [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], and a number of replication stored procedures.</span></span> <span data-ttu-id="d19ab-171">有关详细信息，请参阅 [Distributor and Publisher Information Script](distributor-and-publisher-information-script.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-171">For more information, see [Distributor and Publisher Information Script](distributor-and-publisher-information-script.md).</span></span>  
  
### <a name="does-replication-encrypt-data"></a><span data-ttu-id="d19ab-172">复制是否加密数据？</span><span class="sxs-lookup"><span data-stu-id="d19ab-172">Does replication encrypt data?</span></span>  
 <span data-ttu-id="d19ab-173">不是。</span><span class="sxs-lookup"><span data-stu-id="d19ab-173">No.</span></span> <span data-ttu-id="d19ab-174">复制不对数据库中存储的数据或网络上传输的数据加密。</span><span class="sxs-lookup"><span data-stu-id="d19ab-174">Replication does not encrypt data that is stored in the database or transferred over the network.</span></span> <span data-ttu-id="d19ab-175">有关详细信息，请参阅主题的 "加密" 一节[SQL Server 复制安全性](../security/view-and-modify-replication-security-settings.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-175">For more information, see the "Encryption" section of the topic [SQL Server Replication Security](../security/view-and-modify-replication-security-settings.md).</span></span>  
  
### <a name="how-do-i-replicate-data-over-the-internet"></a><span data-ttu-id="d19ab-176">如何在 Internet 上复制数据？</span><span class="sxs-lookup"><span data-stu-id="d19ab-176">How do I replicate data over the Internet?</span></span>  
 <span data-ttu-id="d19ab-177">使用以下方式在 Internet 上复制数据：</span><span class="sxs-lookup"><span data-stu-id="d19ab-177">Replicate data over the Internet using:</span></span>  
  
-   <span data-ttu-id="d19ab-178">虚拟专用网络 (VPN)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-178">A Virtual Private Network (VPN).</span></span> <span data-ttu-id="d19ab-179">有关详细信息，请参阅[使用 VPN 通过 Internet 发布数据](../publish-data-over-the-internet-using-vpn.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-179">For more information, see [Publish Data over the Internet Using VPN](../publish-data-over-the-internet-using-vpn.md).</span></span>  
  
-   <span data-ttu-id="d19ab-180">对于合并复制，使用 Web 同步选项。</span><span class="sxs-lookup"><span data-stu-id="d19ab-180">The Web synchronization option for merge replication.</span></span> <span data-ttu-id="d19ab-181">有关详细信息，请参阅 [Web Synchronization for Merge Replication](../web-synchronization-for-merge-replication.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-181">For more information, see [Web Synchronization for Merge Replication](../web-synchronization-for-merge-replication.md).</span></span>  
  
 <span data-ttu-id="d19ab-182">所有类型的 [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 复制都可以通过 VPN 来复制数据。但如果使用的是合并复制，应考虑使用 Web 同步。</span><span class="sxs-lookup"><span data-stu-id="d19ab-182">All types of [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] replication can replicate data over a VPN, but you should consider Web synchronization if you are using merge replication.</span></span>  
  
### <a name="does-replication-resume-if-a-connection-is-dropped"></a><span data-ttu-id="d19ab-183">如果删除连接，复制是否可以继续？</span><span class="sxs-lookup"><span data-stu-id="d19ab-183">Does replication resume if a connection is dropped</span></span>  
 <span data-ttu-id="d19ab-184">是的。</span><span class="sxs-lookup"><span data-stu-id="d19ab-184">Yes.</span></span> <span data-ttu-id="d19ab-185">如果删除连接，复制处理可从停止处继续。</span><span class="sxs-lookup"><span data-stu-id="d19ab-185">Replication processing resumes at the point at which it left off if a connection is dropped.</span></span> <span data-ttu-id="d19ab-186">如果在不可靠的网络上使用合并复制，则请考虑使用逻辑记录，这可确保把相关更改作为一个单元来处理。</span><span class="sxs-lookup"><span data-stu-id="d19ab-186">If you are using merge replication over an unreliable network, consider using logical records, which ensures related changes are processed as a unit.</span></span> <span data-ttu-id="d19ab-187">有关详细信息，请参阅[通过逻辑记录对相关行的更改进行分组](../merge/group-changes-to-related-rows-with-logical-records.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-187">For more information, see [Group Changes to Related Rows with Logical Records](../merge/group-changes-to-related-rows-with-logical-records.md).</span></span>  
  
### <a name="does-replication-work-over-low-bandwidth-connections-does-it-use-compression"></a><span data-ttu-id="d19ab-188">复制是否可以在低带宽连接上工作？</span><span class="sxs-lookup"><span data-stu-id="d19ab-188">Does replication work over low bandwidth connections?</span></span> <span data-ttu-id="d19ab-189">它是否使用压缩？</span><span class="sxs-lookup"><span data-stu-id="d19ab-189">Does it use compression?</span></span>  
 <span data-ttu-id="d19ab-190">是，复制的确可以在低带宽连接上工作。</span><span class="sxs-lookup"><span data-stu-id="d19ab-190">Yes, replication does work over low bandwidth connections.</span></span> <span data-ttu-id="d19ab-191">对于通过 TCP/IP 的连接，复制使用该协议提供的压缩，但不提供其他压缩。</span><span class="sxs-lookup"><span data-stu-id="d19ab-191">For connections over TCP/IP, it uses the compression provided by the protocol but does not provide additional compression.</span></span> <span data-ttu-id="d19ab-192">对于通过 HTTPS 的 Web 同步连接，复制使用协议提供的压缩，也使用复制更改所用的 XML 文件的其他压缩。</span><span class="sxs-lookup"><span data-stu-id="d19ab-192">For Web synchronization connections over HTTPS, it uses the compression provided by the protocol and also additional compression of the XML files used to replicate changes.</span></span>  
  
## <a name="logins-and-object-ownership"></a><span data-ttu-id="d19ab-193">登录名和对象所有权</span><span class="sxs-lookup"><span data-stu-id="d19ab-193">Logins and Object Ownership</span></span>  
  
### <a name="are-logins-and-passwords-replicated"></a><span data-ttu-id="d19ab-194">是否复制登录名和密码？</span><span class="sxs-lookup"><span data-stu-id="d19ab-194">Are logins and passwords replicated?</span></span>  
 <span data-ttu-id="d19ab-195">不是。</span><span class="sxs-lookup"><span data-stu-id="d19ab-195">No.</span></span> <span data-ttu-id="d19ab-196">可以创建 DTS 包，把登录名和密码从发布服务器传输到一个或多个订阅服务器。</span><span class="sxs-lookup"><span data-stu-id="d19ab-196">You could create a DTS package to transfer logins and passwords from a Publisher to one or more Subscribers.</span></span>  
  
### <a name="what-are-schemas-and-how-are-they-replicated"></a><span data-ttu-id="d19ab-197">什么是架构，如何复制架构？</span><span class="sxs-lookup"><span data-stu-id="d19ab-197">What are schemas and how are they replicated?</span></span>  
 <span data-ttu-id="d19ab-198">从 [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] 开始，架构有两种含义：</span><span class="sxs-lookup"><span data-stu-id="d19ab-198">Beginning with [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], *schema* has two meanings:</span></span>  
  
-   <span data-ttu-id="d19ab-199">对象的定义，如 CREATE TABLE 语句。</span><span class="sxs-lookup"><span data-stu-id="d19ab-199">The definition of an object, such as a CREATE TABLE statement.</span></span> <span data-ttu-id="d19ab-200">默认情况下，复制把所有已复制对象的定义都复制到订阅服务器。</span><span class="sxs-lookup"><span data-stu-id="d19ab-200">By default, replication copies the definitions of all replicated objects to the Subscriber.</span></span>  
  
-   <span data-ttu-id="d19ab-201">在其中创建对象的命名空间： \<Database> ... \<Schema> \<Object>使用 CREATE SCHEMA 语句定义架构。</span><span class="sxs-lookup"><span data-stu-id="d19ab-201">The namespace within which an object is created: \<Database>.\<Schema>.\<Object>. Schemas are defined using the CREATE SCHEMA statement.</span></span>  
  
-   <span data-ttu-id="d19ab-202">在新建发布向导中，复制在架构和对象所有权方面具有以下默认行为：</span><span class="sxs-lookup"><span data-stu-id="d19ab-202">Replication has the following default behavior in the New Publication Wizard with respect to schemas and object ownership:</span></span>  
  
-   <span data-ttu-id="d19ab-203">对于兼容性级别为 90 或更高的合并发布、快照发布和事务发布中的项目：默认情况下，订阅服务器中的对象所有者与发布服务器中相应对象的所有者相同。</span><span class="sxs-lookup"><span data-stu-id="d19ab-203">For articles in merge publications with a compatibility level of 90 or higher, snapshot publications, and transactional publications: by default, the object owner at the Subscriber is the same as the owner of the corresponding object at the Publisher.</span></span> <span data-ttu-id="d19ab-204">如果订阅服务器中不存在拥有对象的架构，将自动创建这些架构。</span><span class="sxs-lookup"><span data-stu-id="d19ab-204">If the schemas that own objects do not exist at the Subscriber, they are created automatically.</span></span>  
  
-   <span data-ttu-id="d19ab-205">对于合并发布中兼容级别低于 90 的项目：默认情况下，所有者保留为空，并且在订阅服务器上创建对象的过程中指定为 **dbo** 。</span><span class="sxs-lookup"><span data-stu-id="d19ab-205">For articles in merge publications with a compatibility level lower than 90: by default, the owner is left blank and is specified as **dbo** during the creation of the object on the Subscriber.</span></span>  
  
-   <span data-ttu-id="d19ab-206">对于 Oracle 发布中的项目：默认情况下，所有者指定为 **dbo**。</span><span class="sxs-lookup"><span data-stu-id="d19ab-206">For articles in Oracle publications: by default, the owner is specified as **dbo**.</span></span>  
  
-   <span data-ttu-id="d19ab-207">对于使用字符模式快照（用于非[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 订阅服务器以及 [!INCLUDE[ssEW](../../../includes/ssew-md.md)] 订阅服务器）的发布中的项目：默认情况下，所有者保留为空。</span><span class="sxs-lookup"><span data-stu-id="d19ab-207">For articles in publications that use character mode snapshots (which are used for non-[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Subscribers and [!INCLUDE[ssEW](../../../includes/ssew-md.md)] Subscribers): by default, the owner is left blank.</span></span> <span data-ttu-id="d19ab-208">所有者默认为与分发代理或合并代理连接到订阅服务器所使用的帐户关联的所有者。</span><span class="sxs-lookup"><span data-stu-id="d19ab-208">The owner defaults to the owner associated with the account used by the Distribution Agent or Merge Agent to connect to the Subscriber.</span></span>  
  
 <span data-ttu-id="d19ab-209">可通过“项目属性 - \<***Article***>”对话框更改对象所有者，也可通过以下存储过程进行更改：sp_addarticle、sp_addmergearticle、sp_changearticle 和 sp_changemergearticle    。</span><span class="sxs-lookup"><span data-stu-id="d19ab-209">The object owner can be changed through the **Article Properties - \<***Article***>** dialog box and through the following stored procedures: **sp_addarticle**, **sp_addmergearticle**, **sp_changearticle**, and **sp_changemergearticle**.</span></span> <span data-ttu-id="d19ab-210">有关详细信息，请参阅[查看和修改发布属性](../publish/view-and-modify-publication-properties.md)、[定义项目](../publish/define-an-article.md)和[查看和修改项目属性](../publish/view-and-modify-article-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-210">For more information, see [View and Modify Publication Properties](../publish/view-and-modify-publication-properties.md), [Define an Article](../publish/define-an-article.md), and [View and Modify Article Properties](../publish/view-and-modify-article-properties.md).</span></span>  
  
### <a name="how-can-grants-on-the-subscription-database-be-configured-to-match-grants-on-the-publication-database"></a><span data-ttu-id="d19ab-211">如何配置订阅数据库上的授权，以使其与发布数据库上的授权相匹配？</span><span class="sxs-lookup"><span data-stu-id="d19ab-211">How can grants on the subscription database be configured to match grants on the publication database?</span></span>  
 <span data-ttu-id="d19ab-212">默认情况下，复制不在订阅数据库上执行 GRANT 语句。</span><span class="sxs-lookup"><span data-stu-id="d19ab-212">By default, replication does not execute GRANT statements on the subscription database.</span></span> <span data-ttu-id="d19ab-213">如果希望订阅数据库上的权限与发布数据库上的权限相匹配，请使用下列方法之一：</span><span class="sxs-lookup"><span data-stu-id="d19ab-213">If you want the permissions on the subscription database to match those on the publication database, use one of the following methods:</span></span>  
  
-   <span data-ttu-id="d19ab-214">直接在订阅数据库上执行 GRANT 语句。</span><span class="sxs-lookup"><span data-stu-id="d19ab-214">Execute GRANT statements at the subscription database directly.</span></span>  
  
-   <span data-ttu-id="d19ab-215">使用快照后脚本来执行这些语句。</span><span class="sxs-lookup"><span data-stu-id="d19ab-215">Use a post-snapshot script to execute the statements.</span></span> <span data-ttu-id="d19ab-216">有关详细信息，请参阅[在应用快照之前和之后执行脚本](../snapshot-options.md#execute-scripts-before-and-after-snapshot-is-applied)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-216">For more information, see [Execute Scripts Before and After the Snapshot Is Applied](../snapshot-options.md#execute-scripts-before-and-after-snapshot-is-applied).</span></span>  
  
-   <span data-ttu-id="d19ab-217">使用存储过程 [sp_addscriptexec](/sql/relational-databases/system-stored-procedures/sp-addscriptexec-transact-sql) 执行语句。</span><span class="sxs-lookup"><span data-stu-id="d19ab-217">Use the stored procedure [sp_addscriptexec](/sql/relational-databases/system-stored-procedures/sp-addscriptexec-transact-sql) to execute the statements.</span></span>  
  
### <a name="what-happens-to-permissions-granted-in-a-subscription-database-if-a-subscription-is-reinitialized"></a><span data-ttu-id="d19ab-218">如果重新初始化订阅，订阅数据库中授予的权限会怎样？</span><span class="sxs-lookup"><span data-stu-id="d19ab-218">What happens to permissions granted in a subscription database if a subscription is reinitialized?</span></span>  
 <span data-ttu-id="d19ab-219">默认情况下，重新初始化订阅时会删除并重新创建订阅服务器中的对象，这将导致删除已授予这些对象的所有权限。</span><span class="sxs-lookup"><span data-stu-id="d19ab-219">By default, objects at the Subscriber are dropped and recreated when a subscription is reinitialized, which causes all granted permissions for those objects to be dropped.</span></span> <span data-ttu-id="d19ab-220">有两种方法可以处理此种情况：</span><span class="sxs-lookup"><span data-stu-id="d19ab-220">There are two ways to handle this:</span></span>  
  
-   <span data-ttu-id="d19ab-221">重新初始化后，使用前一部分介绍的技术重新应用授权。</span><span class="sxs-lookup"><span data-stu-id="d19ab-221">Reapply the grants after the reinitialization using the techniques described in the previous section.</span></span>  
  
-   <span data-ttu-id="d19ab-222">指定重新初始化订阅时不应删除对象。</span><span class="sxs-lookup"><span data-stu-id="d19ab-222">Specify that objects should not be dropped when the subscription is reinitialized.</span></span> <span data-ttu-id="d19ab-223">重新初始化之前，进行以下两项操作之一：</span><span class="sxs-lookup"><span data-stu-id="d19ab-223">Prior to reinitialization, either:</span></span>  
  
    -   <span data-ttu-id="d19ab-224">执行 [sp_changearticle](/sql/relational-databases/system-stored-procedures/sp-changearticle-transact-sql) 或 [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-224">Execute [sp_changearticle](/sql/relational-databases/system-stored-procedures/sp-changearticle-transact-sql) or [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql).</span></span> <span data-ttu-id="d19ab-225">为参数指定值 "pre_creation_cmd" (**sp_changearticle**) "或" pre_creation_command " \*\* (sp_changemergearticle) \*\* **@property** ，并为参数指定值" none "、" delete "或" 截断 " **@value** 。</span><span class="sxs-lookup"><span data-stu-id="d19ab-225">Specify a value of 'pre_creation_cmd' (**sp_changearticle**) or 'pre_creation_command' (**sp_changemergearticle**) for the parameter **@property** and a value of 'none', 'delete' or 'truncate' for the parameter **@value**.</span></span>  
  
    -   <span data-ttu-id="d19ab-226">在“项目属性- \<Article>”对话框的“目标对象”部分中，选择“保留现有对象保持不变”和“删除数据”   **。如果项目有行筛选器，则仅删除与该筛选器匹配的数据。**</span><span class="sxs-lookup"><span data-stu-id="d19ab-226">In the **Article Properties - \<Article>** dialog box in the **Destination Object** section, select a value of **Keep existing object unchanged**, **Delete data. If article has a row filter, delete only data that matches the filter.**</span></span> <span data-ttu-id="d19ab-227">或者为“名称已被使用时的操作”选择“截断现有对象中的所有数据”。 </span><span class="sxs-lookup"><span data-stu-id="d19ab-227">or **Truncate all data in the existing object** for the option **Action if name is in use**.</span></span> <span data-ttu-id="d19ab-228">有关访问此对话框的详细信息，请参阅[查看和修改发布属性](../publish/view-and-modify-publication-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-228">For more information on accessing this dialog box, see [View and Modify Publication Properties](../publish/view-and-modify-publication-properties.md).</span></span>  
  
## <a name="database-maintenance"></a><span data-ttu-id="d19ab-229">数据库维护</span><span class="sxs-lookup"><span data-stu-id="d19ab-229">Database Maintenance</span></span>  
  
### <a name="why-cant-i-run-truncate-table-on-a-published-table"></a><span data-ttu-id="d19ab-230">为什么无法对已发布的表运行 TRUNCATE TABLE？</span><span class="sxs-lookup"><span data-stu-id="d19ab-230">Why can't I run TRUNCATE TABLE on a published table?</span></span>  
 <span data-ttu-id="d19ab-231">TRUNCATE TABLE 是不会激发触发器的日志未记录的操作。</span><span class="sxs-lookup"><span data-stu-id="d19ab-231">TRUNCATE TABLE is a non-logged operation that does not fire triggers.</span></span> <span data-ttu-id="d19ab-232">之所以不允许对已发布的表运行 TRUNCATE TABLE，是因为复制无法跟踪此操作导致的更改：事务复制通过事务日志来跟踪更改；合并复制通过已发布表的触发器来跟踪更改。</span><span class="sxs-lookup"><span data-stu-id="d19ab-232">It is not permitted because replication cannot track the changes caused by the operation: transactional replication tracks changes through the transaction log; merge replication tracks changes through triggers on published tables.</span></span>  
  
### <a name="what-is-the-effect-of-running-a-bulk-insert-command-on-a-replicated-database"></a><span data-ttu-id="d19ab-233">在复制的数据库上运行大容量插入命令，会产生什么效果？</span><span class="sxs-lookup"><span data-stu-id="d19ab-233">What is the effect of running a bulk insert command on a replicated database?</span></span>  
 <span data-ttu-id="d19ab-234">对于事务复制，大容量插入命令跟踪和复制的方式和其他插入命令相同。</span><span class="sxs-lookup"><span data-stu-id="d19ab-234">For transactional replication, bulk inserts are tracked and replicated like other inserts.</span></span> <span data-ttu-id="d19ab-235">对于合并复制，则必须确保正确更新跟踪元数据的更改。</span><span class="sxs-lookup"><span data-stu-id="d19ab-235">For merge replication, you must ensure that change tracking metadata is updated properly.</span></span>  
  
### <a name="are-there-any-replication-considerations-for-backup-and-restore"></a><span data-ttu-id="d19ab-236">对于备份和还原，是否存在复制注意事项？</span><span class="sxs-lookup"><span data-stu-id="d19ab-236">Are there any replication considerations for backup and restore?</span></span>  
 <span data-ttu-id="d19ab-237">是的。</span><span class="sxs-lookup"><span data-stu-id="d19ab-237">Yes.</span></span> <span data-ttu-id="d19ab-238">对于复制所涉及数据库有许多特别注意事项。</span><span class="sxs-lookup"><span data-stu-id="d19ab-238">There are a number of special considerations for databases that are involved in replication.</span></span> <span data-ttu-id="d19ab-239">有关详细信息，请参阅 [备份和还原复制的数据库](back-up-and-restore-replicated-databases.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-239">For more information, see [Back Up and Restore Replicated Databases](back-up-and-restore-replicated-databases.md).</span></span>  
  
### <a name="does-replication-affect-the-size-of-the-transaction-log"></a><span data-ttu-id="d19ab-240">复制是否影响事务日志的大小？</span><span class="sxs-lookup"><span data-stu-id="d19ab-240">Does replication affect the size of the transaction log?</span></span>  
 <span data-ttu-id="d19ab-241">合并复制和快照复制不影响事务日志的大小，但事务复制会影响。</span><span class="sxs-lookup"><span data-stu-id="d19ab-241">Merge replication and snapshot replication do not affect transaction log size, but transactional replication can.</span></span> <span data-ttu-id="d19ab-242">如果数据库包括一个或多个事务发布，则只有将与这些发布有关的所有事务传递到分发数据库之后才会截断日志。</span><span class="sxs-lookup"><span data-stu-id="d19ab-242">If a database includes one or more transactional publications, the log is not truncated until all transactions relevant to the publications have been delivered to the distribution database.</span></span> <span data-ttu-id="d19ab-243">如果事务日志增长得过大，而且日志读取器代理按计划运行，请考虑缩短运行间隔。</span><span class="sxs-lookup"><span data-stu-id="d19ab-243">If the transaction log is growing too large, and the Log Reader Agent is running on a scheduled basis, consider shortening the interval between runs.</span></span> <span data-ttu-id="d19ab-244">或者，将日志读取器代理设置为以连续模式运行。</span><span class="sxs-lookup"><span data-stu-id="d19ab-244">Or, set it to run in continuous mode.</span></span> <span data-ttu-id="d19ab-245">如果将其设置为以连续模式运行（默认值），请确保它正在运行。</span><span class="sxs-lookup"><span data-stu-id="d19ab-245">If it is set to run in continuous mode (the default), ensure that it is running.</span></span> <span data-ttu-id="d19ab-246">有关检查日志读取器代理状态的详细信息，请参阅[使用复制监视器查看信息和执行任务](../monitor/view-information-and-perform-tasks-replication-monitor.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-246">For more information on checking Log Reader Agent status, see [View Information and Perform Tasks using Replication Monitor](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span></span>  
  
 <span data-ttu-id="d19ab-247">此外，如果在发布数据库或分发数据库中设置了选项“sync with backup”，则直到备份了所有事务后，才会截断事务日志。</span><span class="sxs-lookup"><span data-stu-id="d19ab-247">Additionally, if you have set the option 'sync with backup' on the publication database or distribution database, the transaction log is not truncated until all transactions have been backed up.</span></span> <span data-ttu-id="d19ab-248">如果事务日志增长过大，而且已设置了此选项，请考虑缩短事务日志备份间的间隔。</span><span class="sxs-lookup"><span data-stu-id="d19ab-248">If the transaction log is growing too large, and you have this option set, consider shortening the interval between transaction log backups.</span></span> <span data-ttu-id="d19ab-249">有关备份和还原涉及到事务复制的数据库的详细信息，请参阅[快照复制和事务复制的备份和还原策略](strategies-for-backing-up-and-restoring-snapshot-and-transactional-replication.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-249">For more information on backing up and restoring databases involved in transactional replication, see [Strategies for Backing Up and Restoring Snapshot and Transactional Replication](strategies-for-backing-up-and-restoring-snapshot-and-transactional-replication.md).</span></span>  
  
### <a name="how-do-i-rebuild-indexes-or-tables-in-replicated-databases"></a><span data-ttu-id="d19ab-250">如何在复制的数据库中重新生成索引或表？</span><span class="sxs-lookup"><span data-stu-id="d19ab-250">How do I rebuild indexes or tables in replicated databases?</span></span>  
 <span data-ttu-id="d19ab-251">有许多用于重新生成索引的机制。</span><span class="sxs-lookup"><span data-stu-id="d19ab-251">There are a variety of mechanisms for rebuilding indexes.</span></span> <span data-ttu-id="d19ab-252">这些机制都可以使用，且对于复制并没有特别的注意事项，但下述情况例外：事务发布中的表必须具有主键，因此无法删除并重新创建这些表的主键。</span><span class="sxs-lookup"><span data-stu-id="d19ab-252">They can all be used with no special considerations for replication, with the following exception: primary keys are required on tables in transactional publications, so you cannot drop and recreate primary keys on these tables.</span></span>  
  
### <a name="how-do-i-add-or-change-indexes-on-publication-and-subscription-databases"></a><span data-ttu-id="d19ab-253">如何在发布数据库和订阅数据库上添加或更改索引？</span><span class="sxs-lookup"><span data-stu-id="d19ab-253">How do I add or change indexes on publication and subscription databases?</span></span>  
 <span data-ttu-id="d19ab-254">可以在发布服务器或订阅服务器中添加索引，并且没有针对复制的特别注意事项（注意，索引可以影响性能）。</span><span class="sxs-lookup"><span data-stu-id="d19ab-254">Indexes can be added at the Publisher or Subscribers with no special considerations for replication (be aware that indexes can affect performance).</span></span> <span data-ttu-id="d19ab-255">不会复制 CREATE INDEX 和 ALTER INDEX，因此如果要添加或更改比如发布服务器中的索引，则必须也在订阅服务器中进行相同的添加或更改（如果想要其反映在订阅服务器中）。</span><span class="sxs-lookup"><span data-stu-id="d19ab-255">CREATE INDEX and ALTER INDEX are not replicated, so if you add or change an index at, for example, the Publisher, you must make the same addition or change at the Subscriber if you want it reflected there.</span></span>  
  
### <a name="how-do-i-move-or-rename-files-for-databases-involved-in-replication"></a><span data-ttu-id="d19ab-256">如何对复制所涉及的数据库的文件进行移动和重命名？</span><span class="sxs-lookup"><span data-stu-id="d19ab-256">How do I move or rename files for databases involved in replication?</span></span>  
 <span data-ttu-id="d19ab-257">在早于 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 的 [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)]版本中，移动或重命名数据库文件需要分离并重新附加数据库。</span><span class="sxs-lookup"><span data-stu-id="d19ab-257">In versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] prior to [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], moving or renaming database files required detaching and reattaching the database.</span></span> <span data-ttu-id="d19ab-258">因为无法分离复制的数据库，所以必须首先从这些数据库中删除复制。</span><span class="sxs-lookup"><span data-stu-id="d19ab-258">Because a replicated database cannot be detached, replication had to be removed from these databases first.</span></span> <span data-ttu-id="d19ab-259">从 [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)]开始，无需分离并重新附加数据库便可移动或重命名文件，且不会影响复制。</span><span class="sxs-lookup"><span data-stu-id="d19ab-259">Beginning with [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], you can move or rename files without detaching and re-attaching the database, with no effect on replication.</span></span> <span data-ttu-id="d19ab-260">有关移动和重命名文件的详细信息，请参阅 [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-260">For more information about moving and renaming files, see [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql).</span></span>  
  
### <a name="how-do-i-drop-a-table-that-is-being-replicated"></a><span data-ttu-id="d19ab-261">如何删除正在复制的表？</span><span class="sxs-lookup"><span data-stu-id="d19ab-261">How do I drop a table that is being replicated?</span></span>  
 <span data-ttu-id="d19ab-262">先使用 [sp_droparticle](/sql/relational-databases/system-stored-procedures/sp-droparticle-transact-sql)、[sp_dropmergearticle](/sql/relational-databases/system-stored-procedures/sp-dropmergearticle-transact-sql) 或“发布属性 - \<Publication>”对话框从发布中删除项目，然后使用 `DROP <Object>` 从数据库中删除它。</span><span class="sxs-lookup"><span data-stu-id="d19ab-262">First drop the article from the publication using [sp_droparticle](/sql/relational-databases/system-stored-procedures/sp-droparticle-transact-sql), [sp_dropmergearticle](/sql/relational-databases/system-stored-procedures/sp-dropmergearticle-transact-sql), or the **Publication Properties - \<Publication>** dialog box, and then drop it from the database using `DROP <Object>`.</span></span> <span data-ttu-id="d19ab-263">在添加订阅后，就不能从快照发布或事务发布中删除项目，而必须先删除订阅。</span><span class="sxs-lookup"><span data-stu-id="d19ab-263">You cannot drop articles from snapshot or transactional publications after subscriptions have been added; you must drop the subscriptions first.</span></span> <span data-ttu-id="d19ab-264">有关详细信息，请参阅[向现有发布添加项目和从中删除项目](../publish/add-articles-to-and-drop-articles-from-existing-publications.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-264">For more information, see [Add Articles to and Drop Articles from Existing Publications](../publish/add-articles-to-and-drop-articles-from-existing-publications.md).</span></span>  
  
### <a name="how-do-i-add-or-drop-columns-on-a-published-table"></a><span data-ttu-id="d19ab-265">如何在已发布的表中添加或删除列？</span><span class="sxs-lookup"><span data-stu-id="d19ab-265">How do I add or drop columns on a published table?</span></span>  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="d19ab-266">支持对已发布对象进行各种架构更改，包括添加和删除列。</span><span class="sxs-lookup"><span data-stu-id="d19ab-266">supports a wide variety of schema changes on published objects, including adding and dropping columns.</span></span> <span data-ttu-id="d19ab-267">例如，执行 ALTER TABLE .。。在发布服务器上删除列，并将该语句复制到订阅服务器，然后执行以删除列。</span><span class="sxs-lookup"><span data-stu-id="d19ab-267">For example, execute ALTER TABLE ... DROP COLUMN at the Publisher, and the statement is replicated to Subscribers and then executed to drop the column.</span></span> <span data-ttu-id="d19ab-268">运行早于 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 的 [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] 版本的订阅服务器支持通过存储过程 [sp_repladdcolumn](/sql/relational-databases/system-stored-procedures/sp-repladdcolumn-transact-sql) 和 [sp_repldropcolumn](/sql/relational-databases/system-stored-procedures/sp-repldropcolumn-transact-sql)添加和删除列。</span><span class="sxs-lookup"><span data-stu-id="d19ab-268">Subscribers running versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] prior to [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] support adding and dropping columns through the stored procedures [sp_repladdcolumn](/sql/relational-databases/system-stored-procedures/sp-repladdcolumn-transact-sql) and [sp_repldropcolumn](/sql/relational-databases/system-stored-procedures/sp-repldropcolumn-transact-sql).</span></span> <span data-ttu-id="d19ab-269">有关详细信息，请参阅[对发布数据库进行架构更改](../publish/make-schema-changes-on-publication-databases.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-269">For more information, see [Make Schema Changes on Publication Databases](../publish/make-schema-changes-on-publication-databases.md).</span></span>  
  
## <a name="replication-maintenance"></a><span data-ttu-id="d19ab-270">复制维护</span><span class="sxs-lookup"><span data-stu-id="d19ab-270">Replication Maintenance</span></span>  
  
### <a name="how-do-i-determine-if-the-data-at-subscribers-is-synchronized-with-data-at-the-publisher"></a><span data-ttu-id="d19ab-271">如何确定订阅服务器的数据是否与发布服务器的数据同步？</span><span class="sxs-lookup"><span data-stu-id="d19ab-271">How do I determine if the data at Subscribers is synchronized with data at the Publisher?</span></span>  
 <span data-ttu-id="d19ab-272">使用验证。</span><span class="sxs-lookup"><span data-stu-id="d19ab-272">Use validation.</span></span> <span data-ttu-id="d19ab-273">验证报告给定订阅服务器是否与发布服务器同步。</span><span class="sxs-lookup"><span data-stu-id="d19ab-273">Validation reports on whether a given Subscriber is synchronized with the Publisher.</span></span> <span data-ttu-id="d19ab-274">有关详细信息，请参阅[验证已复制的数据](../validate-data-at-the-subscriber.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-274">For more information, see [Validate Replicated Data](../validate-data-at-the-subscriber.md).</span></span> <span data-ttu-id="d19ab-275">验证不会提供与某些行是否未正确同步有关的信息，而 [tablediff 实用工具](../../../tools/tablediff-utility.md) 可以提供此信息。</span><span class="sxs-lookup"><span data-stu-id="d19ab-275">Validation does not provide information on which rows if any are not synchronized correctly, but the [tablediff utility](../../../tools/tablediff-utility.md) does.</span></span>  
  
### <a name="how-do-i-add-a-table-to-an-existing-publication"></a><span data-ttu-id="d19ab-276">如何向现有发布添加表？</span><span class="sxs-lookup"><span data-stu-id="d19ab-276">How do I add a table to an existing publication?</span></span>  
 <span data-ttu-id="d19ab-277">不必为了添加表（或另一个对象）而停止发布数据库或订阅数据库上的活动。</span><span class="sxs-lookup"><span data-stu-id="d19ab-277">It is not necessary to stop activity on the publication or subscription databases in order to add a table (or another object).</span></span> <span data-ttu-id="d19ab-278">通过“发布属性 - \<Publication>”对话框或存储过程 [sp_addarticle](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql) 和 [sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) 将表添加到发布。</span><span class="sxs-lookup"><span data-stu-id="d19ab-278">Add a table to a publication through the **Publication Properties - \<Publication>** dialog box or the stored procedures [sp_addarticle](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql) and [sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql).</span></span> <span data-ttu-id="d19ab-279">有关详细信息，请参阅[向现有发布添加项目和从中删除项目](../publish/add-articles-to-and-drop-articles-from-existing-publications.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-279">For more information, see [Add Articles to and Drop Articles from Existing Publications](../publish/add-articles-to-and-drop-articles-from-existing-publications.md).</span></span>  
  
### <a name="how-do-i-remove-a-table-from-a-publication"></a><span data-ttu-id="d19ab-280">如何从发布中删除表？</span><span class="sxs-lookup"><span data-stu-id="d19ab-280">How do I remove a table from a publication?</span></span>  
 <span data-ttu-id="d19ab-281">使用 [sp_droparticle](/sql/relational-databases/system-stored-procedures/sp-droparticle-transact-sql)、[sp_dropmergearticle](/sql/relational-databases/system-stored-procedures/sp-dropmergearticle-transact-sql) 或“发布属性 - \<Publication>”对话框从发布中删除表。</span><span class="sxs-lookup"><span data-stu-id="d19ab-281">Remove a table from the publication using [sp_droparticle](/sql/relational-databases/system-stored-procedures/sp-droparticle-transact-sql), [sp_dropmergearticle](/sql/relational-databases/system-stored-procedures/sp-dropmergearticle-transact-sql), or the **Publication Properties - \<Publication>** dialog box.</span></span> <span data-ttu-id="d19ab-282">在添加订阅后，就不能从快照发布或事务发布中删除项目，而必须先删除订阅。</span><span class="sxs-lookup"><span data-stu-id="d19ab-282">You cannot drop articles from snapshot or transactional publications after subscriptions have been added; you must drop the subscriptions first.</span></span> <span data-ttu-id="d19ab-283">有关详细信息，请参阅[向现有发布添加项目和从中删除项目](../publish/add-articles-to-and-drop-articles-from-existing-publications.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-283">For more information, see [Add Articles to and Drop Articles from Existing Publications](../publish/add-articles-to-and-drop-articles-from-existing-publications.md).</span></span>  
  
### <a name="what-actions-require-subscriptions-to-be-reinitialized"></a><span data-ttu-id="d19ab-284">哪些操作需要重新初始化订阅？</span><span class="sxs-lookup"><span data-stu-id="d19ab-284">What actions require subscriptions to be reinitialized?</span></span>  
 <span data-ttu-id="d19ab-285">许多项目和发布更改都需要重新初始化订阅。</span><span class="sxs-lookup"><span data-stu-id="d19ab-285">There are a number of article and publication changes that require subscriptions to be reinitialized.</span></span> <span data-ttu-id="d19ab-286">有关详细信息，请参阅[更改发布和项目属性](../publish/change-publication-and-article-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-286">For more information, see [Change Publication and Article Properties](../publish/change-publication-and-article-properties.md).</span></span>  
  
### <a name="what-actions-cause-snapshots-to-be-invalidated"></a><span data-ttu-id="d19ab-287">什么操作会导致快照失效？</span><span class="sxs-lookup"><span data-stu-id="d19ab-287">What actions cause snapshots to be invalidated?</span></span>  
 <span data-ttu-id="d19ab-288">许多项目和发布更改都可使快照无效，并需要生成新快照。</span><span class="sxs-lookup"><span data-stu-id="d19ab-288">There are a number of article and publication changes that invalidate snapshots and require a new snapshot to be generated.</span></span> <span data-ttu-id="d19ab-289">有关详细信息，请参阅[更改发布和项目属性](../publish/change-publication-and-article-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-289">For more information, see [Change Publication and Article Properties](../publish/change-publication-and-article-properties.md).</span></span>  
  
### <a name="how-do-i-remove-replication"></a><span data-ttu-id="d19ab-290">如何删除复制？</span><span class="sxs-lookup"><span data-stu-id="d19ab-290">How do I remove replication?</span></span>  
 <span data-ttu-id="d19ab-291">从数据库删除复制所需的操作取决于数据库是作为发布数据库、订阅数据库使用，还是同时作为这两种数据库使用。</span><span class="sxs-lookup"><span data-stu-id="d19ab-291">The actions required to remove replication from a database depend on whether the database served as a publication database, subscription database, or both.</span></span>  
  
### <a name="how-do-i-determine-whether-there-are-transactions-or-rows-to-be-replicated"></a><span data-ttu-id="d19ab-292">如何确定是否存在要复制的事务或行？</span><span class="sxs-lookup"><span data-stu-id="d19ab-292">How do I determine whether there are transactions or rows to be replicated?</span></span>  
 <span data-ttu-id="d19ab-293">对于事务复制，请使用存储过程或复制监视器中的 **“未分发的命令”** 选项卡。</span><span class="sxs-lookup"><span data-stu-id="d19ab-293">For transactional replication, use stored procedures or the **Undistributed Commands** tab in Replication Monitor.</span></span> <span data-ttu-id="d19ab-294">有关详细信息，请参阅[在分发数据库中查看复制的命令和其他信息 &#40;复制 Transact-sql 编程&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md)和[使用复制监视器查看信息和执行任务](../monitor/view-information-and-perform-tasks-replication-monitor.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-294">For more information, see [View Replicated Commands and Other Information in the Distribution Database &#40;Replication Transact-SQL Programming&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) and [View Information and Perform Tasks using Replication Monitor](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span></span>  
  
 <span data-ttu-id="d19ab-295">对于合并复制，请使用 **sp_showpendingchanges**存储过程。</span><span class="sxs-lookup"><span data-stu-id="d19ab-295">For merge replication, use the stored procedure **sp_showpendingchanges**.</span></span> <span data-ttu-id="d19ab-296">有关详细信息，请参阅 [sp_showpendingchanges &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-showpendingchanges-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-296">For more information, see [sp_showpendingchanges &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-showpendingchanges-transact-sql).</span></span>  
  
### <a name="how-far-behind-is-the-distribution-agent-should-i-reinitialize"></a><span data-ttu-id="d19ab-297">分发代理滞后多少？</span><span class="sxs-lookup"><span data-stu-id="d19ab-297">How far behind is the Distribution Agent?</span></span> <span data-ttu-id="d19ab-298">是否应重新初始化？</span><span class="sxs-lookup"><span data-stu-id="d19ab-298">Should I reinitialize?</span></span>  
 <span data-ttu-id="d19ab-299">使用 **sp_replmonitorsubscriptionpendingcmds** 存储过程或复制监视器中的 **“未分发的命令”** 选项卡。</span><span class="sxs-lookup"><span data-stu-id="d19ab-299">Use the **sp_replmonitorsubscriptionpendingcmds** stored procedure or the **Undistributed Commands** tab in Replication Monitor.</span></span> <span data-ttu-id="d19ab-300">存储过程和选项卡显示：</span><span class="sxs-lookup"><span data-stu-id="d19ab-300">The stored procedure and tab display:</span></span>  
  
-   <span data-ttu-id="d19ab-301">在分发数据库中尚未传递到所选订阅服务器的命令数。</span><span class="sxs-lookup"><span data-stu-id="d19ab-301">The number of commands in the distribution database that have not been delivered to the selected Subscriber.</span></span> <span data-ttu-id="d19ab-302">一个命令由一个 Transact-SQL 数据操作语言 (DML) 语句或一个数据定义语言 (DDL) 语句组成。</span><span class="sxs-lookup"><span data-stu-id="d19ab-302">A command consists of one Transact-SQL data manipulation language (DML) statement or one data definition language (DDL) statement.</span></span>  
  
-   <span data-ttu-id="d19ab-303">将命令传递到订阅服务器所需的估计时间。</span><span class="sxs-lookup"><span data-stu-id="d19ab-303">The estimated amount of time to deliver commands to the Subscriber.</span></span> <span data-ttu-id="d19ab-304">如果此值大于生成快照并将其应用于订阅服务器所需的时间，请考虑重新初始化订阅服务器。</span><span class="sxs-lookup"><span data-stu-id="d19ab-304">If this value is greater than the amount of time required to generate and apply a snapshot to the Subscriber, consider reinitializing the Subscriber.</span></span> <span data-ttu-id="d19ab-305">有关详细信息，请参阅 [重新初始化订阅](../reinitialize-subscriptions.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-305">For more information, see [Reinitialize Subscriptions](../reinitialize-subscriptions.md).</span></span>  
  
 <span data-ttu-id="d19ab-306">有关详细信息，请参阅[sp_replmonitorsubscriptionpendingcmds &#40;transact-sql&#41;](/sql/relational-databases/system-stored-procedures/sp-replmonitorsubscriptionpendingcmds-transact-sql)和[使用复制监视器查看信息和执行任务](../monitor/view-information-and-perform-tasks-replication-monitor.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-306">For more information, see [sp_replmonitorsubscriptionpendingcmds &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replmonitorsubscriptionpendingcmds-transact-sql) and [View Information and Perform Tasks using Replication Monitor](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span></span>  
  
## <a name="replication-and-other-database-features"></a><span data-ttu-id="d19ab-307">复制和其他数据库功能</span><span class="sxs-lookup"><span data-stu-id="d19ab-307">Replication and Other Database Features</span></span>  
  
### <a name="does-replication-work-in-conjunction-with-log-shipping-and-database-mirroring"></a><span data-ttu-id="d19ab-308">复制是否可与日志传送和数据库镜像一起进行？</span><span class="sxs-lookup"><span data-stu-id="d19ab-308">Does replication work in conjunction with log shipping and database mirroring?</span></span>  
 <span data-ttu-id="d19ab-309">是的。</span><span class="sxs-lookup"><span data-stu-id="d19ab-309">Yes.</span></span> <span data-ttu-id="d19ab-310">有关详细信息，请参阅[日志传送和复制 &#40;SQL Server&#41;](../../../database-engine/log-shipping/log-shipping-and-replication-sql-server.md) 和[数据库镜像和复制 &#40;SQL Server&#41;](../../../database-engine/database-mirroring/database-mirroring-and-replication-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="d19ab-310">For more information, see [Log Shipping and Replication &#40;SQL Server&#41;](../../../database-engine/log-shipping/log-shipping-and-replication-sql-server.md) and [Database Mirroring and Replication &#40;SQL Server&#41;](../../../database-engine/database-mirroring/database-mirroring-and-replication-sql-server.md).</span></span>  
  
### <a name="does-replication-work-in-conjunction-with-clustering"></a><span data-ttu-id="d19ab-311">复制是否可与聚类分析一起进行？</span><span class="sxs-lookup"><span data-stu-id="d19ab-311">Does replication work in conjunction with clustering?</span></span>  
 <span data-ttu-id="d19ab-312">是的。</span><span class="sxs-lookup"><span data-stu-id="d19ab-312">Yes.</span></span> <span data-ttu-id="d19ab-313">没有需要特别注意的事项，因为所有数据都存储在群集上的一组磁盘中。</span><span class="sxs-lookup"><span data-stu-id="d19ab-313">No special considerations are required because all data is stored on one set of disks on the cluster.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d19ab-314">另请参阅</span><span class="sxs-lookup"><span data-stu-id="d19ab-314">See Also</span></span>  
 <span data-ttu-id="d19ab-315">[复制管理常见问题解答](frequently-asked-questions-for-replication-administrators.md) </span><span class="sxs-lookup"><span data-stu-id="d19ab-315">[Replication Administration FAQ](frequently-asked-questions-for-replication-administrators.md) </span></span>  
 [<span data-ttu-id="d19ab-316">Best Practices for Replication Administration</span><span class="sxs-lookup"><span data-stu-id="d19ab-316">Best Practices for Replication Administration</span></span>](best-practices-for-replication-administration.md)  
  
  
