---
title: 对发布数据库进行架构更改 | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- replication [SQL Server], schema changes
- snapshot replication [SQL Server], replicating schema changes
- merge replication [SQL Server replication], replicating schema changes
- transactional replication, replicating schema changes
- schemas [SQL Server replication], replicating changes
- publishing [SQL Server replication], schema changes
ms.assetid: 926c88d7-a844-402f-bcb9-db49e5013b69
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: e26d3e89fcba41d474ca56637f9e465f17127348
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87577534"
---
# <a name="make-schema-changes-on-publication-databases"></a><span data-ttu-id="91dc5-102">对发布数据库进行架构更改</span><span class="sxs-lookup"><span data-stu-id="91dc5-102">Make Schema Changes on Publication Databases</span></span>
  <span data-ttu-id="91dc5-103">复制支持对已发布对象进行多种架构更改。</span><span class="sxs-lookup"><span data-stu-id="91dc5-103">Replication supports a wide range of schema changes to published objects.</span></span> <span data-ttu-id="91dc5-104">对 [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 发布服务器中相应的发布对象进行下列任何一种架构更改时，默认会将该更改传播到所有 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 订阅服务器：</span><span class="sxs-lookup"><span data-stu-id="91dc5-104">When you make any of the following schema changes on the appropriate published object at a [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Publisher, that change is propagated by default to all [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Subscribers:</span></span>  
  
-   <span data-ttu-id="91dc5-105">ALTER TABLE</span><span class="sxs-lookup"><span data-stu-id="91dc5-105">ALTER TABLE</span></span>  
  
-   <span data-ttu-id="91dc5-106">如果已启用架构更改复制，并且拓扑包括 [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] 或 [!INCLUDE[ssEWnoversion](../../../includes/ssewnoversion-md.md)] Subscribers.ALTER VIEW，则不应使用 ALTER TABLE SET LOCK ESCALATION。</span><span class="sxs-lookup"><span data-stu-id="91dc5-106">ALTER TABLE SET LOCK ESCALATION should not be used if schema change replication is enabled and a topology includes [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or [!INCLUDE[ssEWnoversion](../../../includes/ssewnoversion-md.md)] Subscribers.ALTER VIEW</span></span>  
  
-   <span data-ttu-id="91dc5-107">ALTER PROCEDURE</span><span class="sxs-lookup"><span data-stu-id="91dc5-107">ALTER PROCEDURE</span></span>  
  
-   <span data-ttu-id="91dc5-108">ALTER FUNCTION</span><span class="sxs-lookup"><span data-stu-id="91dc5-108">ALTER FUNCTION</span></span>  
  
-   <span data-ttu-id="91dc5-109">ALTER TRIGGER</span><span class="sxs-lookup"><span data-stu-id="91dc5-109">ALTER TRIGGER</span></span>  
  
     <span data-ttu-id="91dc5-110">由于无法复制数据定义语言 [DDL] 触发器，ALTER TRIGGER 只能用于数据操作语言 [DML] 触发器。</span><span class="sxs-lookup"><span data-stu-id="91dc5-110">ALTER TRIGGER can be used only for data manipulation language [DML] triggers because data definition language [DDL] triggers cannot be replicated.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="91dc5-111">对表进行架构更改时必须使用 [!INCLUDE[tsql](../../../includes/tsql-md.md)] 或 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 管理对象 (SMO)。</span><span class="sxs-lookup"><span data-stu-id="91dc5-111">Schema changes to tables must be made by using [!INCLUDE[tsql](../../../includes/tsql-md.md)] or [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Management Objects (SMO).</span></span> <span data-ttu-id="91dc5-112">在 [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]中进行架构更改时， [!INCLUDE[ssManStudio](../../../includes/ssmanstudio-md.md)] 将尝试删除并重新创建表。</span><span class="sxs-lookup"><span data-stu-id="91dc5-112">When schema changes are made in [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[ssManStudio](../../../includes/ssmanstudio-md.md)] attempts to drop and re-create the table.</span></span> <span data-ttu-id="91dc5-113">因为无法删除已发布的对象，所以架构更改失败。</span><span class="sxs-lookup"><span data-stu-id="91dc5-113">You cannot drop published objects, therefore the schema change fails.</span></span>  
  
 <span data-ttu-id="91dc5-114">对于事务复制和合并复制，当分发代理或合并代理运行时，将增量传播架构更改。</span><span class="sxs-lookup"><span data-stu-id="91dc5-114">For transactional replication and merge replication, schema changes are propagated incrementally when the Distribution Agent or Merge Agent runs.</span></span> <span data-ttu-id="91dc5-115">对于快照复制，将在订阅服务器中应用新快照时传播架构更改。</span><span class="sxs-lookup"><span data-stu-id="91dc5-115">For snapshot replication, schema changes are propagated when a new snapshot is applied at the Subscriber.</span></span> <span data-ttu-id="91dc5-116">在快照复制中，每次发生同步时，都将架构的一个新副本发送到订阅服务器。</span><span class="sxs-lookup"><span data-stu-id="91dc5-116">In snapshot replication, a new copy of the schema is sent to the Subscriber each time synchronization occurs.</span></span> <span data-ttu-id="91dc5-117">因此，每次同步时都自动传播对以前发布的对象的所有架构更改（而不只是上面列出的那些）。</span><span class="sxs-lookup"><span data-stu-id="91dc5-117">Therefore, all schema changes (not just those listed above) to previously published objects are automatically propagated with each synchronization.</span></span>  
  
 <span data-ttu-id="91dc5-118">有关在发布中添加和删除项目的信息，请参阅[向现有发布添加项目和从中删除项目](add-articles-to-and-drop-articles-from-existing-publications.md)。</span><span class="sxs-lookup"><span data-stu-id="91dc5-118">For information about adding and removing articles from publications, see [Add Articles to and Drop Articles from Existing Publications](add-articles-to-and-drop-articles-from-existing-publications.md).</span></span>  
  
 <span data-ttu-id="91dc5-119">**复制架构更改**</span><span class="sxs-lookup"><span data-stu-id="91dc5-119">**To replicate schema changes**</span></span>  
  
 <span data-ttu-id="91dc5-120">默认情况下会复制上面列出的架构更改。</span><span class="sxs-lookup"><span data-stu-id="91dc5-120">The schema changes listed above are replicated by default.</span></span> <span data-ttu-id="91dc5-121">有关禁止复制架构更改的信息，请参阅 [Replicate Schema Changes](replicate-schema-changes.md)。</span><span class="sxs-lookup"><span data-stu-id="91dc5-121">For information about disabling the replication of schema changes, see [Replicate Schema Changes](replicate-schema-changes.md).</span></span>  
  
## <a name="considerations-for-schema-changes"></a><span data-ttu-id="91dc5-122">架构更改的注意事项</span><span class="sxs-lookup"><span data-stu-id="91dc5-122">Considerations for Schema Changes</span></span>  
 <span data-ttu-id="91dc5-123">复制架构更改时，请牢记下列注意事项：</span><span class="sxs-lookup"><span data-stu-id="91dc5-123">Keep the following considerations in mind when replicating schema changes.</span></span>  
  
### <a name="general-considerations"></a><span data-ttu-id="91dc5-124">一般注意事项</span><span class="sxs-lookup"><span data-stu-id="91dc5-124">General Considerations</span></span>  
  
-   <span data-ttu-id="91dc5-125">架构更改需遵守 [!INCLUDE[tsql](../../../includes/tsql-md.md)]规定的所有限制。</span><span class="sxs-lookup"><span data-stu-id="91dc5-125">Schema changes are subject to any restrictions imposed by [!INCLUDE[tsql](../../../includes/tsql-md.md)].</span></span> <span data-ttu-id="91dc5-126">例如，ALTER TABLE 不允许对主键列执行 ALTER 语句。</span><span class="sxs-lookup"><span data-stu-id="91dc5-126">For example, ALTER TABLE does not allow you to ALTER primary key columns.</span></span>  
  
-   <span data-ttu-id="91dc5-127">仅对初始快照执行数据类型映射。</span><span class="sxs-lookup"><span data-stu-id="91dc5-127">Data type mapping is performed only for the initial snapshot.</span></span> <span data-ttu-id="91dc5-128">架构更改不会映射到以前版本的数据类型。</span><span class="sxs-lookup"><span data-stu-id="91dc5-128">Schema changes are not mapped to previous versions of data types.</span></span> <span data-ttu-id="91dc5-129">例如，如果在 [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)] 中使用 `ALTER TABLE ADD datetime2 column` 语句，则不会将数据类型转换为 [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] 订阅服务器的 `nvarchar`。</span><span class="sxs-lookup"><span data-stu-id="91dc5-129">For example, if the statement `ALTER TABLE ADD datetime2 column` is used in [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)], the data type is not translated to `nvarchar` for [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] Subscribers.</span></span> <span data-ttu-id="91dc5-130">在某些情况下，架构更改在发布服务器上受到阻止。</span><span class="sxs-lookup"><span data-stu-id="91dc5-130">In some cases, schema changes are blocked on the Publisher.</span></span>  
  
-   <span data-ttu-id="91dc5-131">如果发布被设置为允许传播架构更改，则不论为发布中的项目设置的相关架构选项是什么，都会传播架构更改。</span><span class="sxs-lookup"><span data-stu-id="91dc5-131">If a publication is set to allow the propagation of schema changes, schema changes are propagated regardless of how the related schema option is set for an article in the publication.</span></span> <span data-ttu-id="91dc5-132">例如，如果选择不复制某个表项目的外键约束，但随后又发出 ALTER TABLE 命令，将外键添加到发布服务器中的表中，那么外键将被添加到订阅服务器中的表中。</span><span class="sxs-lookup"><span data-stu-id="91dc5-132">For example, if you select not to replicate foreign key constraints for a table article, but then issue an ALTER TABLE command that adds a foreign key to the table at the Publisher, the foreign key is added to the table at the Subscriber.</span></span> <span data-ttu-id="91dc5-133">若要防止出现这种情况，请在发出 ALTER TABLE 命令之前禁用架构更改的传播。</span><span class="sxs-lookup"><span data-stu-id="91dc5-133">To prevent this, disable the propagation of schema changes before issuing the ALTER TABLE command.</span></span>  
  
-   <span data-ttu-id="91dc5-134">架构更改只应在发布服务器中进行，不应在订阅服务器中（包括重新发布订阅服务器）上进行。</span><span class="sxs-lookup"><span data-stu-id="91dc5-134">Schema changes should be made only at the Publisher, not at Subscribers (including republishing Subscribers).</span></span> <span data-ttu-id="91dc5-135">合并复制禁止在订阅服务器中进行架构更改。</span><span class="sxs-lookup"><span data-stu-id="91dc5-135">Merge replication prevents schema changes at the Subscriber.</span></span> <span data-ttu-id="91dc5-136">事务复制虽然不禁止更改，但更改可能会导致复制失败。</span><span class="sxs-lookup"><span data-stu-id="91dc5-136">Transactional replication does not prevent the changes, but the changes can cause replication to fail.</span></span>  
  
-   <span data-ttu-id="91dc5-137">传播到重新发布订阅服务器的更改默认情况下会传播到它的订阅服务器。</span><span class="sxs-lookup"><span data-stu-id="91dc5-137">Changes propagated to a republishing Subscriber are by default propagated to its Subscribers.</span></span>  
  
-   <span data-ttu-id="91dc5-138">如果架构更改引用存在于发布服务器中而不存在于订阅服务器中的对象或约束，则架构更改将在发布服务器中成功，但在订阅服务器上失败。</span><span class="sxs-lookup"><span data-stu-id="91dc5-138">If the schema change references objects or constraints existing on the Publisher but not on the Subscriber, the schema change will succeed on the Publisher but will fail on the Subscriber.</span></span>  
  
-   <span data-ttu-id="91dc5-139">添加外键时引用的订阅服务器中的所有对象必须与发布服务器中的相应对象具有相同的名称和所有者。</span><span class="sxs-lookup"><span data-stu-id="91dc5-139">All objects on the Subscriber that are referenced when adding a foreign key must have the same name and owner as the corresponding object on the Publisher.</span></span>  
  
-   <span data-ttu-id="91dc5-140">不支持显式添加、删除或更改索引。</span><span class="sxs-lookup"><span data-stu-id="91dc5-140">Explicitly adding, dropping, or altering indexes is not supported.</span></span> <span data-ttu-id="91dc5-141">支持为约束（如主键约束）隐式创建的索引。</span><span class="sxs-lookup"><span data-stu-id="91dc5-141">Indexes created implicitly for constraints (such as a primary key constraint) are supported.</span></span>  
  
-   <span data-ttu-id="91dc5-142">不支持更改或删除由复制管理的标识列。</span><span class="sxs-lookup"><span data-stu-id="91dc5-142">Altering or dropping identity columns that are managed by replication is not supported.</span></span> <span data-ttu-id="91dc5-143">有关自动管理标识列的详细信息，请参阅[复制标识列](replicate-identity-columns.md)。</span><span class="sxs-lookup"><span data-stu-id="91dc5-143">For more information about automatic management of identity columns, see [Replicate Identity Columns](replicate-identity-columns.md).</span></span>  
  
-   <span data-ttu-id="91dc5-144">不支持包含不确定性函数的架构更改，因为它们可能会导致发布服务器和订阅服务器中的数据不同（称为无法收敛）。</span><span class="sxs-lookup"><span data-stu-id="91dc5-144">Schema changes that include nondeterministic functions are not supported because they can result in data at the Publisher and Subscriber being different (referred to as non-convergence).</span></span> <span data-ttu-id="91dc5-145">例如，如果在发布服务器发出以下命令： `ALTER TABLE SalesOrderDetail ADD OrderDate DATETIME DEFAULT GETDATE()`，则将此命令复制到订阅服务器并执行时，会得到不同的值。</span><span class="sxs-lookup"><span data-stu-id="91dc5-145">For example, if you issue the following command at the Publisher: `ALTER TABLE SalesOrderDetail ADD OrderDate DATETIME DEFAULT GETDATE()`, the values are different when the command is replicated to the Subscriber and executed.</span></span> <span data-ttu-id="91dc5-146">有关不确定性函数的详细信息，请参阅 [Deterministic and Nondeterministic Functions](../../user-defined-functions/deterministic-and-nondeterministic-functions.md)。</span><span class="sxs-lookup"><span data-stu-id="91dc5-146">For more information about nondeterministic functions, see [Deterministic and Nondeterministic Functions](../../user-defined-functions/deterministic-and-nondeterministic-functions.md).</span></span>  
  
-   <span data-ttu-id="91dc5-147">建议显式命名约束。</span><span class="sxs-lookup"><span data-stu-id="91dc5-147">It is recommended that constraints be explicitly named.</span></span> <span data-ttu-id="91dc5-148">如果不显式命名约束， [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 将为约束生成名称，并且这些名称在发布服务器和每个订阅服务器中都不同。</span><span class="sxs-lookup"><span data-stu-id="91dc5-148">If a constraint is not explicitly named, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] generates a name for the constraint, and these names will be different on the Publisher and each Subscriber.</span></span> <span data-ttu-id="91dc5-149">这在复制架构更改时会引发问题。</span><span class="sxs-lookup"><span data-stu-id="91dc5-149">This can cause issues during the replication of schema changes.</span></span> <span data-ttu-id="91dc5-150">例如，如果在发布服务器中删除一列并删除了一个相关约束，则复制将尝试在订阅服务器中删除该约束。</span><span class="sxs-lookup"><span data-stu-id="91dc5-150">For example, if you drop a column at the Publisher and a dependent constraint is dropped, replication will attempt to drop the constraint at the Subscriber.</span></span> <span data-ttu-id="91dc5-151">由于约束名称不同，因此在订阅服务器上的删除将失败。</span><span class="sxs-lookup"><span data-stu-id="91dc5-151">The drop at the Subscriber will fail because the name of the constraint is different.</span></span> <span data-ttu-id="91dc5-152">如果由于约束命名问题而导致同步失败，可以在订阅服务器中手动删除约束然后重新运行合并代理。</span><span class="sxs-lookup"><span data-stu-id="91dc5-152">If synchronization fails because of a constraint naming issue, manually drop the constraint at the Subscriber and then rerun the Merge Agent.</span></span>  
  
-   <span data-ttu-id="91dc5-153">如果为复制发布了一个表，并且已生成了发布快照，则无法将该表中的列更改为 XML 数据类型。若要更改列，必须先删除复制。</span><span class="sxs-lookup"><span data-stu-id="91dc5-153">If a table is published for replication, it is not possible to alter a column in that table to a data type of XML if a publication snapshot has already been generated To alter the column, you must first remove replication.</span></span>  
  
-   <span data-ttu-id="91dc5-154">对已发布的表执行 DDL 时，“未提交读”不是受支持的隔离级别。</span><span class="sxs-lookup"><span data-stu-id="91dc5-154">Read uncommitted is not a supported isolation level when doing DDL on a published table.</span></span>  
  
-   <span data-ttu-id="91dc5-155">不应使用 `SET CONTEXT_INFO` 来修改已对发布的对象执行架构更改的事务的上下文。</span><span class="sxs-lookup"><span data-stu-id="91dc5-155">`SET CONTEXT_INFO` should not be used to modify the context of transactions where schema changes are performed against published objects.</span></span>  
  
#### <a name="adding-columns"></a><span data-ttu-id="91dc5-156">添加列</span><span class="sxs-lookup"><span data-stu-id="91dc5-156">Adding Columns</span></span>  
  
-   <span data-ttu-id="91dc5-157">若要将一个新列添加到表中并在现有发布中包括该列，请执行 ALTER TABLE \<Table> ADD \<Column>。</span><span class="sxs-lookup"><span data-stu-id="91dc5-157">To add a new column to a table and include that column in an existing publication, execute ALTER TABLE \<Table> ADD \<Column>.</span></span> <span data-ttu-id="91dc5-158">默认情况下，此列然后将被复制到所有订阅服务器中。</span><span class="sxs-lookup"><span data-stu-id="91dc5-158">By default, the column is then replicated to all Subscribers.</span></span> <span data-ttu-id="91dc5-159">此列必须允许 NULL 值或包含默认约束。</span><span class="sxs-lookup"><span data-stu-id="91dc5-159">The column must allow NULL values or include a default constraint.</span></span> <span data-ttu-id="91dc5-160">有关添加列的详细信息，请参阅本主题中的“合并复制”部分。</span><span class="sxs-lookup"><span data-stu-id="91dc5-160">For more information about adding columns, see the "Merge Replication" section in this topic.</span></span>  
  
-   <span data-ttu-id="91dc5-161">若要将一个新列添加到表中但不在现有发布中包括此列，请禁用架构更改复制，然后执行 ALTER TABLE \<Table> ADD \<Column>。</span><span class="sxs-lookup"><span data-stu-id="91dc5-161">To add a new column to a table and not include that column in an existing publication, disable the replication of schema changes, and then execute ALTER TABLE \<Table> ADD \<Column>.</span></span>  
  
-   <span data-ttu-id="91dc5-162">若要在现有发布中包括现有列，请使用 [&#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-articlecolumn-transact-sql)、[sp_mergearticlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-mergearticlecolumn-transact-sql) 或“发布属性 - \<Publication>”对话框。</span><span class="sxs-lookup"><span data-stu-id="91dc5-162">To include an existing column in an existing publication, use [sp_articlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-articlecolumn-transact-sql), [sp_mergearticlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-mergearticlecolumn-transact-sql), or the **Publication Properties - \<Publication>** dialog box.</span></span>  
  
     <span data-ttu-id="91dc5-163">有关详细信息，请参阅 [Define and Modify a Column Filter](define-and-modify-a-column-filter.md)。</span><span class="sxs-lookup"><span data-stu-id="91dc5-163">For more information, see [Define and Modify a Column Filter](define-and-modify-a-column-filter.md).</span></span> <span data-ttu-id="91dc5-164">这要求重新初始化订阅。</span><span class="sxs-lookup"><span data-stu-id="91dc5-164">This will require subscriptions to be reinitialized.</span></span>  
  
-   <span data-ttu-id="91dc5-165">不支持向已发布的表添加标识列，因为将列复制到订阅服务器时，会导致无法收敛。</span><span class="sxs-lookup"><span data-stu-id="91dc5-165">Adding an identity column to a published table is not supported, because it can result in non-convergence when the column is replicated to the Subscriber.</span></span> <span data-ttu-id="91dc5-166">发布服务器的标识列中的值取决于受影响的表中行的物理存储顺序。</span><span class="sxs-lookup"><span data-stu-id="91dc5-166">The values in the identity column at the Publisher depend on the order in which the rows for the affected table are physically stored.</span></span> <span data-ttu-id="91dc5-167">行在订阅服务器中的存储顺序可能会有所不同。因此对于相同的行，标识列的值可能会不同。</span><span class="sxs-lookup"><span data-stu-id="91dc5-167">The rows might be stored differently at the Subscriber; therefore the value for the identity column can be different for the same rows.</span></span>  
  
#### <a name="dropping-columns"></a><span data-ttu-id="91dc5-168">删除列</span><span class="sxs-lookup"><span data-stu-id="91dc5-168">Dropping Columns</span></span>  
  
-   <span data-ttu-id="91dc5-169">若要从现有发布中删除列并从发布服务器中的表内删除该列，请执行 ALTER TABLE \<Table> DROP \<Column>。</span><span class="sxs-lookup"><span data-stu-id="91dc5-169">To drop a column from an existing publication and drop the column from the table at the Publisher, execute ALTER TABLE \<Table> DROP \<Column>.</span></span> <span data-ttu-id="91dc5-170">默认情况下，该列然后将从所有订阅服务器中的表中删除。</span><span class="sxs-lookup"><span data-stu-id="91dc5-170">By default, the column is then dropped from the table at all Subscribers.</span></span>  
  
-   <span data-ttu-id="91dc5-171">若要从现有发布中删除列，但在发布服务器中的表内保留该列，请使用 [sp_articlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-articlecolumn-transact-sql)、[sp_mergearticlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-mergearticlecolumn-transact-sql) 或“发布属性 - \<Publication>”对话框。</span><span class="sxs-lookup"><span data-stu-id="91dc5-171">To drop a column from an existing publication but retain the column in the table at the Publisher, use [sp_articlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-articlecolumn-transact-sql), [sp_mergearticlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-mergearticlecolumn-transact-sql), or the **Publication Properties - \<Publication>** dialog box.</span></span>  
  
     <span data-ttu-id="91dc5-172">有关详细信息，请参阅 [Define and Modify a Column Filter](define-and-modify-a-column-filter.md)。</span><span class="sxs-lookup"><span data-stu-id="91dc5-172">For more information, see [Define and Modify a Column Filter](define-and-modify-a-column-filter.md).</span></span> <span data-ttu-id="91dc5-173">这要求生成一个新的快照。</span><span class="sxs-lookup"><span data-stu-id="91dc5-173">This will require a new snapshot to be generated.</span></span>  
  
-   <span data-ttu-id="91dc5-174">要删除的列不能用于数据库中任何发布的任何项目的筛选子句中。</span><span class="sxs-lookup"><span data-stu-id="91dc5-174">The column to be dropped cannot be used in the filter clauses of any article of any publication in the database.</span></span>  
  
-   <span data-ttu-id="91dc5-175">从已发布项目中删除列时，请考虑任何可能影响数据库的列的约束、索引或属性。</span><span class="sxs-lookup"><span data-stu-id="91dc5-175">When dropping a column from a published article, take into consideration any constraints, indexes, or properties of the column that could affect the database.</span></span> <span data-ttu-id="91dc5-176">例如：</span><span class="sxs-lookup"><span data-stu-id="91dc5-176">For example:</span></span>  
  
    -   <span data-ttu-id="91dc5-177">无法从事务发布的项目中删除主键中使用的列，因为这些列由复制使用。</span><span class="sxs-lookup"><span data-stu-id="91dc5-177">You cannot drop columns used in a primary key from articles in transactional publications, because they are used by replication.</span></span>  
  
    -   <span data-ttu-id="91dc5-178">无法从合并发布的项目中删除 rowguid 列，也不能从支持更新订阅的事务性发布的项目中删除 mstran_repl_version 列，因为这些列由复制使用。</span><span class="sxs-lookup"><span data-stu-id="91dc5-178">You cannot drop the rowguid column from articles in merge publications or the mstran_repl_version column from articles in transactional publications that support updating subscriptions, because they are used by replication.</span></span>  
  
    -   <span data-ttu-id="91dc5-179">不会将索引更改传播到订阅服务器：如果在发布服务器上删除一列并删除相关索引，则不会复制索引删除。</span><span class="sxs-lookup"><span data-stu-id="91dc5-179">Index changes are not propagated to Subscribers: if you drop a column at the Publisher and a dependent index is dropped, the index drop is not replicated.</span></span> <span data-ttu-id="91dc5-180">在发布服务器上删除列之前，应在订阅服务器中删除索引，这样从发布服务器向订阅服务器复制列删除时才会成功。</span><span class="sxs-lookup"><span data-stu-id="91dc5-180">You should drop the index at the Subscriber before dropping the column at the Publisher, so that the column drop succeeds when it is replicated from the Publisher to the Subscriber.</span></span> <span data-ttu-id="91dc5-181">如果由于订阅服务器中的索引而导致同步失败，可以手动删除索引然后重新运行合并代理。</span><span class="sxs-lookup"><span data-stu-id="91dc5-181">If synchronization fails because of an index at the Subscriber, manually drop the index and then rerun the Merge Agent.</span></span>  
  
    -   <span data-ttu-id="91dc5-182">约束应显式命名，以允许删除。</span><span class="sxs-lookup"><span data-stu-id="91dc5-182">Constraints should be explicitly named to allow for dropping.</span></span> <span data-ttu-id="91dc5-183">有关详细信息，请参阅本主题后面的“一般注意事项”部分。</span><span class="sxs-lookup"><span data-stu-id="91dc5-183">For more information, see the "General Considerations" section earlier in this topic.</span></span>  
  
### <a name="transactional-replication"></a><span data-ttu-id="91dc5-184">事务复制</span><span class="sxs-lookup"><span data-stu-id="91dc5-184">Transactional Replication</span></span>  
  
-   <span data-ttu-id="91dc5-185">架构更改传播到运行 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]早期版本的订阅服务器中，但 DDL 语句只应包含订阅服务器中的 SQL Server 版本支持的语法。</span><span class="sxs-lookup"><span data-stu-id="91dc5-185">Schema changes are propagated to Subscribers running previous versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], but the DDL statement should only include syntax supported by the version at the Subscriber.</span></span>  
  
     <span data-ttu-id="91dc5-186">如果订阅服务器重新发布数据，唯一支持的架构更改是添加和删除列。</span><span class="sxs-lookup"><span data-stu-id="91dc5-186">If the Subscriber republishes data, the only supported schema changes are adding and dropping a column.</span></span> <span data-ttu-id="91dc5-187">应当在发布服务器上使用 [sp_repladdcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repladdcolumn-transact-sql) 和 [sp_repldropcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repldropcolumn-transact-sql) 执行这些更改，不应使用 ALTER TABLE DDL 语法。</span><span class="sxs-lookup"><span data-stu-id="91dc5-187">These changes should be made on the Publisher using [sp_repladdcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repladdcolumn-transact-sql) and [sp_repldropcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repldropcolumn-transact-sql) rather than ALTER TABLE DDL syntax.</span></span>  
  
-   <span data-ttu-id="91dc5-188">不向非 SQL Server 订阅服务器复制架构更改。</span><span class="sxs-lookup"><span data-stu-id="91dc5-188">Schema changes are not replicated to non-SQL Server Subscribers.</span></span>  
  
-   <span data-ttu-id="91dc5-189">不会从非[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 发布服务器中传播架构更改。</span><span class="sxs-lookup"><span data-stu-id="91dc5-189">Schema changes are not propagated from non-[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Publishers.</span></span>  
  
-   <span data-ttu-id="91dc5-190">无法更改按表复制的索引视图。</span><span class="sxs-lookup"><span data-stu-id="91dc5-190">You cannot alter indexed views that are replicated as tables.</span></span> <span data-ttu-id="91dc5-191">可以更改按索引视图复制的索引视图，但更改它们将导致它们成为普通视图，而不是索引视图。</span><span class="sxs-lookup"><span data-stu-id="91dc5-191">Indexed views that are replicated as indexed views can be altered, but altering them will cause them to become regular views, rather than indexed views.</span></span>  
  
-   <span data-ttu-id="91dc5-192">如果发布支持立即更新订阅或排队更新订阅，则必须在进行架构更改前停止系统：必须在发布服务器和订阅服务器中停止已发布的表上的所有活动，还必须将挂起的数据更改传播到所有节点。</span><span class="sxs-lookup"><span data-stu-id="91dc5-192">If the publication supports immediate updating or queued updating subscriptions, the system must be quiesced before making schema changes: all activity on the published table must be stopped at the Publisher and Subscribers, and pending data changes must be propagated to all nodes.</span></span> <span data-ttu-id="91dc5-193">架构更改传播到所有节点后，可以在已发布的表上恢复活动。</span><span class="sxs-lookup"><span data-stu-id="91dc5-193">After the schema changes have propagated to all nodes, activity can resume on the published tables.</span></span>  
  
-   <span data-ttu-id="91dc5-194">如果发布在对等拓扑中，必须在进行架构更改前停止系统。</span><span class="sxs-lookup"><span data-stu-id="91dc5-194">If the publication is in a peer-to-peer topology, the system must be quiesced before making schema changes.</span></span> <span data-ttu-id="91dc5-195">有关详细信息，请参阅[停止复制拓扑（复制 Transact-SQL 编程）](../administration/quiesce-a-replication-topology-replication-transact-sql-programming.md)。</span><span class="sxs-lookup"><span data-stu-id="91dc5-195">For more information, see [Quiesce a Replication Topology &#40;Replication Transact-SQL Programming&#41;](../administration/quiesce-a-replication-topology-replication-transact-sql-programming.md).</span></span>  
  
-   <span data-ttu-id="91dc5-196">将一个时间戳列添加到表中并将时间戳映射到 binary(8) 将导致重新初始化所有活动订阅的项目。</span><span class="sxs-lookup"><span data-stu-id="91dc5-196">Adding a timestamp column to a table and mapping the timestamp to binary(8) causes the article to be reinitialized for all active subscriptions.</span></span>  
  
### <a name="merge-replication"></a><span data-ttu-id="91dc5-197">合并复制</span><span class="sxs-lookup"><span data-stu-id="91dc5-197">Merge Replication</span></span>  
  
-   <span data-ttu-id="91dc5-198">合并复制处理架构更改的方式由发布兼容级别以及快照设置为本机模式（默认）还是字符模式决定：</span><span class="sxs-lookup"><span data-stu-id="91dc5-198">How merge replication handles schema changes is determined by the publication compatibility level, and whether the snapshot is set to native mode (default) or character mode:</span></span>  
  
    -   <span data-ttu-id="91dc5-199">若要复制架构更改，发布兼容级别必须至少是 90RTM。</span><span class="sxs-lookup"><span data-stu-id="91dc5-199">To replicate schema changes, the compatibility level of the publication must be at least 90RTM.</span></span> <span data-ttu-id="91dc5-200">如果订阅服务器运行 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 的早期版本或者兼容级别小于 90RTM，则可以使用 [sp_repladdcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repladdcolumn-transact-sql) 和 [sp_repldropcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repldropcolumn-transact-sql) 来添加和删除列。</span><span class="sxs-lookup"><span data-stu-id="91dc5-200">If Subscribers are running previous versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] or the compatibility level is less than 90RTM you can use [sp_repladdcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repladdcolumn-transact-sql) and [sp_repldropcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repldropcolumn-transact-sql) to add and drop columns.</span></span> <span data-ttu-id="91dc5-201">但是，不推荐使用这些过程。</span><span class="sxs-lookup"><span data-stu-id="91dc5-201">However, these procedures are deprecated.</span></span>  
  
    -   <span data-ttu-id="91dc5-202">如果您试图在现有项目中添加包含 [!INCLUDE[ssKatmai](../../../includes/sskatmai-md.md)]中引入的数据类型的列，则 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 具有以下行为：</span><span class="sxs-lookup"><span data-stu-id="91dc5-202">If you try to add to an existing article a column with a data type that was introduced in [!INCLUDE[ssKatmai](../../../includes/sskatmai-md.md)], [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] has the following behavior:</span></span>  
  
        ||<span data-ttu-id="91dc5-203">100RTM，本机快照</span><span class="sxs-lookup"><span data-stu-id="91dc5-203">100RTM, native snapshot</span></span>|<span data-ttu-id="91dc5-204">100RTM，字符快照</span><span class="sxs-lookup"><span data-stu-id="91dc5-204">100RTM, character snapshot</span></span>|<span data-ttu-id="91dc5-205">所有其他兼容级别</span><span class="sxs-lookup"><span data-stu-id="91dc5-205">All other compatibility levels</span></span>|  
        |-|-----------------------------|--------------------------------|------------------------------------|  
        |`hierarchyid`|<span data-ttu-id="91dc5-206">允许更改</span><span class="sxs-lookup"><span data-stu-id="91dc5-206">Allow change</span></span>|<span data-ttu-id="91dc5-207">阻止更改</span><span class="sxs-lookup"><span data-stu-id="91dc5-207">Block change</span></span>|<span data-ttu-id="91dc5-208">阻止更改</span><span class="sxs-lookup"><span data-stu-id="91dc5-208">Block change</span></span>|  
        |<span data-ttu-id="91dc5-209">`geography` 和 `geometry`</span><span class="sxs-lookup"><span data-stu-id="91dc5-209">`geography` and `geometry`</span></span>|<span data-ttu-id="91dc5-210">允许更改</span><span class="sxs-lookup"><span data-stu-id="91dc5-210">Allow change</span></span>|<span data-ttu-id="91dc5-211">允许更改<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="91dc5-211">Allow change<sup>1</sup></span></span>|<span data-ttu-id="91dc5-212">阻止更改</span><span class="sxs-lookup"><span data-stu-id="91dc5-212">Block change</span></span>|  
        |`filestream`|<span data-ttu-id="91dc5-213">允许更改</span><span class="sxs-lookup"><span data-stu-id="91dc5-213">Allow change</span></span>|<span data-ttu-id="91dc5-214">阻止更改</span><span class="sxs-lookup"><span data-stu-id="91dc5-214">Block change</span></span>|<span data-ttu-id="91dc5-215">阻止更改</span><span class="sxs-lookup"><span data-stu-id="91dc5-215">Block change</span></span>|  
        |<span data-ttu-id="91dc5-216">`date`、`time`、`datetime2` 和 `datetimeoffset`</span><span class="sxs-lookup"><span data-stu-id="91dc5-216">`date`, `time`, `datetime2`, and `datetimeoffset`</span></span>|<span data-ttu-id="91dc5-217">允许更改</span><span class="sxs-lookup"><span data-stu-id="91dc5-217">Allow change</span></span>|<span data-ttu-id="91dc5-218">允许更改<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="91dc5-218">Allow change<sup>1</sup></span></span>|<span data-ttu-id="91dc5-219">阻止更改</span><span class="sxs-lookup"><span data-stu-id="91dc5-219">Block change</span></span>|  
  
         <span data-ttu-id="91dc5-220"><sup>1</sup> SQL Server Compact 订阅服务器在订阅服务器中转换这些数据类型。</span><span class="sxs-lookup"><span data-stu-id="91dc5-220"><sup>1</sup> SQL Server Compact Subscribers convert these data types at the Subscriber.</span></span>  
  
-   <span data-ttu-id="91dc5-221">如果在应用架构更改时发生错误（如由于添加的外键引用订阅服务器中不可用的表而导致错误），同步将失败，必须重新初始化订阅。</span><span class="sxs-lookup"><span data-stu-id="91dc5-221">If an error occurs when applying a schema change (such as an error resulting from adding a foreign key that references a table not available at the Subscriber), synchronization fails and the subscription must be reinitialized.</span></span>  
  
-   <span data-ttu-id="91dc5-222">如果在联接筛选器或参数化筛选器中涉及的列上进行架构更改，必须重新初始化所有订阅并重新生成快照。</span><span class="sxs-lookup"><span data-stu-id="91dc5-222">If a schema change is made on a column involved in a join filter or parameterized filter, you must reinitialize all subscriptions and regenerate the snapshot.</span></span>  
  
-   <span data-ttu-id="91dc5-223">合并复制提供了在排除故障期间跳过架构更改的存储过程。</span><span class="sxs-lookup"><span data-stu-id="91dc5-223">Merge replication provides stored procedures to skip schema changes during troubleshooting.</span></span> <span data-ttu-id="91dc5-224">有关详细信息，请参阅 [sp_markpendingschemachange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-markpendingschemachange-transact-sql) 和 [sp_enumeratependingschemachanges &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-enumeratependingschemachanges-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="91dc5-224">For more information, see [sp_markpendingschemachange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-markpendingschemachange-transact-sql) and [sp_enumeratependingschemachanges &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-enumeratependingschemachanges-transact-sql).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="91dc5-225">另请参阅</span><span class="sxs-lookup"><span data-stu-id="91dc5-225">See Also</span></span>  
 <span data-ttu-id="91dc5-226">[ALTER TABLE (Transact-SQL)](/sql/t-sql/statements/alter-table-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="91dc5-226">[ALTER TABLE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-table-transact-sql) </span></span>  
 <span data-ttu-id="91dc5-227">[ALTER VIEW &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-view-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="91dc5-227">[ALTER VIEW &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-view-transact-sql) </span></span>  
 <span data-ttu-id="91dc5-228">[ALTER PROCEDURE (Transact-SQL)](/sql/t-sql/statements/alter-procedure-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="91dc5-228">[ALTER PROCEDURE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-procedure-transact-sql) </span></span>  
 <span data-ttu-id="91dc5-229">[ALTER FUNCTION &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-function-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="91dc5-229">[ALTER FUNCTION &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-function-transact-sql) </span></span>  
 <span data-ttu-id="91dc5-230">[ALTER TRIGGER (Transact-SQL)](/sql/t-sql/statements/alter-trigger-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="91dc5-230">[ALTER TRIGGER &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-trigger-transact-sql) </span></span>  
 <span data-ttu-id="91dc5-231">[发布数据和数据库对象](publish-data-and-database-objects.md) </span><span class="sxs-lookup"><span data-stu-id="91dc5-231">[Publish Data and Database Objects](publish-data-and-database-objects.md) </span></span>  
 [<span data-ttu-id="91dc5-232">重新生成自定义事务过程以反映架构更改</span><span class="sxs-lookup"><span data-stu-id="91dc5-232">Regenerate Custom Transactional Procedures to Reflect Schema Changes</span></span>](../transactional/transactional-articles-regenerate-to-reflect-schema-changes.md)  
  
  
