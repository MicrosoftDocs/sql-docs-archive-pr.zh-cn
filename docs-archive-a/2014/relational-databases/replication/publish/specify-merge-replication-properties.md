---
title: 指定合并复制属性 |Microsoft Docs
ms.custom: ''
ms.date: 11/29/2018
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- merge replication [SQL Server replication], about merge replication
- merge replication [SQL Server replication]
ms.assetid: ff87c368-4c00-4e48-809d-ea752839551e
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 3b2e66b7ed26420093166445a478bfec7f1dd21d
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87691179"
---
# <a name="specify-merge-replication-properties"></a><span data-ttu-id="4a356-102">指定合并复制属性</span><span class="sxs-lookup"><span data-stu-id="4a356-102">Specify Merge Replication Properties</span></span>
<span data-ttu-id="4a356-103">本主题说明如何为合并复制指定各种属性。</span><span class="sxs-lookup"><span data-stu-id="4a356-103">This topic explains how to specify various properties for your merge replication.</span></span> 


## <a name="download-only"></a><span data-ttu-id="4a356-104">仅限下载</span><span class="sxs-lookup"><span data-stu-id="4a356-104">Download-only</span></span>
  <span data-ttu-id="4a356-105">本部分介绍如何使用或在中指定合并表项目仅用于下载 [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] [!INCLUDE[tsql](../../../includes/tsql-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="4a356-105">This section describes how to specify that a merge table article is download-only in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] or [!INCLUDE[tsql](../../../includes/tsql-md.md)].</span></span> <span data-ttu-id="4a356-106">仅用于下载的项目是为具有不在订阅服务器上更新的数据的应用程序设计的。</span><span class="sxs-lookup"><span data-stu-id="4a356-106">Download-only articles are designed for applications with data that is not updated at Subscribers.</span></span> <span data-ttu-id="4a356-107">有关详细信息，请参阅[使用仅下载项目优化合并复制性能](../merge/optimize-merge-replication-performance-with-download-only-articles.md)。</span><span class="sxs-lookup"><span data-stu-id="4a356-107">For more information, see [Optimize Merge Replication Performance with Download-Only Articles](../merge/optimize-merge-replication-performance-with-download-only-articles.md).</span></span>  
 
  
###  <a name="limitations-and-restrictions"></a><span data-ttu-id="4a356-108">限制和局限</span><span class="sxs-lookup"><span data-stu-id="4a356-108">Limitations and Restrictions</span></span>  
  
-   <span data-ttu-id="4a356-109">如果在初始化订阅后指定项目仅用于下载，则所有收到该项目的客户端订阅必须重新初始化。</span><span class="sxs-lookup"><span data-stu-id="4a356-109">If you specify that an article is download-only after subscriptions have been initialized, all client subscriptions that received the article must be reinitialized.</span></span> <span data-ttu-id="4a356-110">服务器订阅不必重新初始化。</span><span class="sxs-lookup"><span data-stu-id="4a356-110">Server subscriptions do not have to be reinitialized.</span></span> <span data-ttu-id="4a356-111">有关属性更改的影响的详细信息，请参阅[更改发布和项目属性](change-publication-and-article-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="4a356-111">For more information on the effects of property changes, see [Change Publication and Article Properties](change-publication-and-article-properties.md).</span></span>  
  
### <a name="using-sql-server-management-studio"></a><span data-ttu-id="4a356-112">使用 SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="4a356-112">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="4a356-113">在新建发布向导的 "**项目**" 页或 "**项目属性- \<Article> \*\* " 对话框的 "**属性\*\*" 选项卡上，将项目指定为仅下载。</span><span class="sxs-lookup"><span data-stu-id="4a356-113">Specify that an article is download-only on the **Articles** page of the New Publication Wizard or the **Properties** tab of the **Article Properties - \<Article>** dialog box.</span></span> <span data-ttu-id="4a356-114">“新建发布”向导和“发布属性 - \<Publication>”对话框中提供了该对话框。</span><span class="sxs-lookup"><span data-stu-id="4a356-114">This dialog box is available in the New Publication Wizard and the **Publication Properties - \<Publication>** dialog box.</span></span> <span data-ttu-id="4a356-115">有关如何使用该向导和如何访问该对话框的详细信息，请参阅[创建发布](../publish/create-a-publication.md)和[查看和修改发布属性](../publish/view-and-modify-publication-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="4a356-115">For more information about using the wizard and accessing the dialog box, see [Create a Publication](../publish/create-a-publication.md) and [View and Modify Publication Properties](../publish/view-and-modify-publication-properties.md).</span></span>  
  
#### <a name="to-specify-that-an-article-is-download-only-on-the-articles-page"></a><span data-ttu-id="4a356-116">在“项目”页上指定项目仅用于下载</span><span class="sxs-lookup"><span data-stu-id="4a356-116">To specify that an article is download-only on the Articles page</span></span>  
  
-   <span data-ttu-id="4a356-117">在新建发布向导的 **“项目”** 页上，选择一个表，然后选中复选框 **“已选中的表仅用于下载”** 。</span><span class="sxs-lookup"><span data-stu-id="4a356-117">On the **Articles** page of the New Publication Wizard select a table, and then select the checkbox **Highlighted table is download-only**.</span></span> 
  
#### <a name="to-specify-that-an-article-is-download-only-on-the-properties-tab-of-the-article-properties---article-dialog-box"></a><span data-ttu-id="4a356-118">若要在 "项目属性-" 对话框的 "属性" 选项卡上将项目指定为仅下载 \<Article></span><span class="sxs-lookup"><span data-stu-id="4a356-118">To specify that an article is download-only on the Properties tab of the Article Properties - \<Article> dialog box</span></span>  
  
1.  <span data-ttu-id="4a356-119">在新建发布向导或“发布属性 - \<Publication>”对话框的“项目”页上，选择一个表，然后单击“项目属性”。  </span><span class="sxs-lookup"><span data-stu-id="4a356-119">On the **Articles** page of the New Publication Wizard or the **Publication Properties - \<Publication>** dialog box, select a table, and then click **Article Properties**.</span></span>    
2.  <span data-ttu-id="4a356-120">单击 **“设置突出显示的表项目的属性”** 或 **“设置所有表项目的属性”** 。</span><span class="sxs-lookup"><span data-stu-id="4a356-120">Click **Set Properties of Highlighted Table Article** or **Set Properties of All Table Articles**.</span></span>    
3.  <span data-ttu-id="4a356-121">在“项目属性 - \<Article>”对话框的“属性”选项卡的“目标对象”部分中，为“同步方向”指定以下值之一：</span><span class="sxs-lookup"><span data-stu-id="4a356-121">In the **Destination Object** section of the **Properties** tab of the **Article Properties - \<Article>** dialog box, specify one of the following values for **Synchronization direction**:</span></span>    
    -   <span data-ttu-id="4a356-122">**下载到订阅服务器，禁止订阅服务器更改**</span><span class="sxs-lookup"><span data-stu-id="4a356-122">**Download to Subscriber, prohibit Subscriber changes**</span></span>    
    -   <span data-ttu-id="4a356-123">**下载到订阅服务器，允许订阅服务器更改**</span><span class="sxs-lookup"><span data-stu-id="4a356-123">**Download to Subscriber, allow Subscriber changes**</span></span>  
  
4.  <span data-ttu-id="4a356-124">如果处于“发布属性 - \<Publication>”对话框中，请单击“确定”以保存并关闭该对话框 。</span><span class="sxs-lookup"><span data-stu-id="4a356-124">If you are in the **Publication Properties - \<Publication>** dialog box, click **OK** to save and close the dialog box.</span></span>    

###  <a name="using-transact-sql"></a><span data-ttu-id="4a356-125">“使用 Transact-SQL”</span><span class="sxs-lookup"><span data-stu-id="4a356-125">Using Transact-SQL</span></span>  
  
#### <a name="to-specify-that-a-new-merge-table-article-is-download-only"></a><span data-ttu-id="4a356-126">指定新合并表项目仅用于下载</span><span class="sxs-lookup"><span data-stu-id="4a356-126">To specify that a new merge table article is download-only</span></span>    
1.  <span data-ttu-id="4a356-127">执行[sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql)，并为参数\*\* \@ subscriber_upload_options**指定值**1**或**2\*\* 。</span><span class="sxs-lookup"><span data-stu-id="4a356-127">Execute [sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql), specifying a value of **1** or **2** for the parameter **\@subscriber_upload_options**.</span></span> <span data-ttu-id="4a356-128">这些数字分别与以下行为相对应：</span><span class="sxs-lookup"><span data-stu-id="4a356-128">The numbers correspond to the following behavior:</span></span>  
  
    -   <span data-ttu-id="4a356-129">**0** - 无限制（默认值）。</span><span class="sxs-lookup"><span data-stu-id="4a356-129">**0** - No restrictions (default).</span></span> <span data-ttu-id="4a356-130">将订阅服务器上所做的更改上载到发布服务器。</span><span class="sxs-lookup"><span data-stu-id="4a356-130">Changes made at the Subscriber are uploaded to the Publisher.</span></span>    
    -   <span data-ttu-id="4a356-131">**1** - 允许在订阅服务器上进行更改，但不会将它们上载到发布服务器。</span><span class="sxs-lookup"><span data-stu-id="4a356-131">**1** - Changes are allowed at the Subscriber, but they are not uploaded to the Publisher.</span></span>    
    -   <span data-ttu-id="4a356-132">**2** - 不允许在订阅服务器上进行更改。</span><span class="sxs-lookup"><span data-stu-id="4a356-132">**2** - Changes are not allowed at the Subscriber.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="4a356-133">如果某个项目的源表已在另一个发布中发布，则这两个项目的\*\* \@ subscriber_upload_options\*\*的值必须相同。</span><span class="sxs-lookup"><span data-stu-id="4a356-133">If the source table for an article is already published in another publication, the value of **\@subscriber_upload_options** must be the same for both articles.</span></span>  
  
#### <a name="to-modify-an-existing-merge-table-article-to-be-download-only"></a><span data-ttu-id="4a356-134">修改现有合并表项目以使其仅用于下载</span><span class="sxs-lookup"><span data-stu-id="4a356-134">To modify an existing merge table article to be download-only</span></span>  
  
1.  <span data-ttu-id="4a356-135">若要确定项目是否仅用于下载，请执行 [sp_helpmergearticle](/sql/relational-databases/system-stored-procedures/sp-helpmergearticle-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="4a356-135">To determine if an article is download-only, execute [sp_helpmergearticle](/sql/relational-databases/system-stored-procedures/sp-helpmergearticle-transact-sql).</span></span> <span data-ttu-id="4a356-136">记下结果集中该项目的 **upload_options** 值。</span><span class="sxs-lookup"><span data-stu-id="4a356-136">Note the value of **upload_options** for the article in the result set.</span></span>    
2.  <span data-ttu-id="4a356-137">如果步骤1中返回的值为**0**，则执行[sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql)，为 " \*\* \@ 属性**" 指定值**subscriber_upload_options\*\* ，将值**1**指定给\*\* \@ force_invalidate_snapshot**和** \@ force_reinit_subscription**，并将值1或**2**指定为 " \*\* \@ value** **" 的值**，这与以下行为相对应：</span><span class="sxs-lookup"><span data-stu-id="4a356-137">If the value returned in step 1 is **0**, execute [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql), specifying a value of **subscriber_upload_options** for **\@property**, a value of **1** for **\@force_invalidate_snapshot** and **\@force_reinit_subscription**, and a value of **1** or **2** for **\@value**, which corresponds to the following behavior:</span></span>  
  
    -   <span data-ttu-id="4a356-138">**1** - 允许在订阅服务器上进行更改，但不会将它们上载到发布服务器。</span><span class="sxs-lookup"><span data-stu-id="4a356-138">**1** - Changes are allowed at the Subscriber, but they are not uploaded to the Publisher.</span></span>    
    -   <span data-ttu-id="4a356-139">**2** - 不允许在订阅服务器上进行更改。</span><span class="sxs-lookup"><span data-stu-id="4a356-139">**2** - Changes are not allowed at the Subscriber.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="4a356-140">如果某个项目的源表已经在另一个发布中发布，则两个项目的仅用于下载行为必须相同。</span><span class="sxs-lookup"><span data-stu-id="4a356-140">If the source table for an article is already published in another publication, the download-only behavior must be the same for both articles.</span></span>  
 
## <a name=""></a><span data-ttu-id="4a356-141"><a name="interactive-conflict-resolution">交互式冲突解决</a></span><span class="sxs-lookup"><span data-stu-id="4a356-141"><a name="interactive-conflict-resolution">Interactive conflict resolution</a></span></span>
[!INCLUDE[msCoName](../../../includes/msconame-md.md)]<span data-ttu-id="4a356-142">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]复制提供交互式冲突解决程序，使你能够在中 [!INCLUDE[msCoName](../../../includes/msconame-md.md)] 按需同步过程中手动解决冲突Windows 同步管理器。</span><span class="sxs-lookup"><span data-stu-id="4a356-142">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] replication provides an Interactive Resolver, which allows you to resolve conflicts manually during on-demand synchronization in [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows Synchronization Manager.</span></span> <span data-ttu-id="4a356-143">启用交互式冲突解决方法后，在同步过程中即可使用交互式冲突解决程序来交互式解决冲突。</span><span class="sxs-lookup"><span data-stu-id="4a356-143">After interactive resolution is enabled, resolve conflicts interactively during synchronization, using the Interactive Resolver.</span></span> <span data-ttu-id="4a356-144">交互式冲突解决程序可以通过 [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows 同步管理器获取。</span><span class="sxs-lookup"><span data-stu-id="4a356-144">The Interactive Resolver is available through the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows Synchronization Manager.</span></span> <span data-ttu-id="4a356-145">有关详细信息，请参阅[使用 Windows 同步管理器同步订阅（Windows 同步管理器）](../synchronize-a-subscription-using-windows-synchronization-manager.md)。</span><span class="sxs-lookup"><span data-stu-id="4a356-145">For more information, see [Synchronize a Subscription Using Windows Synchronization Manager &#40;Windows Synchronization Manager&#41;](../synchronize-a-subscription-using-windows-synchronization-manager.md).</span></span>  
  
    
###  <a name="recommendations"></a><a name="Recommendations"></a> <span data-ttu-id="4a356-146">建议</span><span class="sxs-lookup"><span data-stu-id="4a356-146">Recommendations</span></span>  
  
-   <span data-ttu-id="4a356-147">如果在 Windows 同步管理器以外执行同步（如 SQL Server Management Studio 或复制监视器中的计划同步或按需同步），则会使用为项目指定的默认冲突解决方法自动解决冲突，而无需用户干预。</span><span class="sxs-lookup"><span data-stu-id="4a356-147">If a synchronization is performed outside of Windows Synchronization Manager (as a scheduled synchronization or an on demand synchronization in SQL Server Management Studio or Replication Monitor), conflicts are resolved automatically without user intervention, using the default conflict resolution specified for the article.</span></span> <span data-ttu-id="4a356-148">有关详细信息，请参阅 [Interactive Conflict Resolution](../merge/advanced-merge-replication-conflict-interactive-resolution.md)。</span><span class="sxs-lookup"><span data-stu-id="4a356-148">For more information, see [Interactive Conflict Resolution](../merge/advanced-merge-replication-conflict-interactive-resolution.md).</span></span>  
  
###  <a name="using-sql-server-management-studio"></a><span data-ttu-id="4a356-149">使用 SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="4a356-149">Using SQL Server Management Studio</span></span>  
  
#### <a name="enable-interactive-conflict-resolution-for-an-article"></a><span data-ttu-id="4a356-150">为项目启用交互式冲突解决方法</span><span class="sxs-lookup"><span data-stu-id="4a356-150">Enable interactive conflict resolution for an article</span></span>  
  
1.  <span data-ttu-id="4a356-151">在新建发布向导或“发布属性 - \<Publication>”对话框的“项目” 页上，选择一个表。</span><span class="sxs-lookup"><span data-stu-id="4a356-151">On the **Articles** page of the New Publication Wizard or the **Publication Properties - \<Publication>** dialog box, select a table.</span></span> <span data-ttu-id="4a356-152">有关如何使用该向导和如何访问该对话框的详细信息，请参阅[创建发布](create-a-publication.md)和[查看和修改发布属性](view-and-modify-publication-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="4a356-152">For more information about using the wizard and accessing the dialog box, see [Create a Publication](create-a-publication.md) and [View and Modify Publication Properties](view-and-modify-publication-properties.md).</span></span>    
2.  <span data-ttu-id="4a356-153">单击 **“项目属性”** ，然后单击 **“设置突出显示的表项目的属性”** 或 **“设置所有表项目的属性”** 。</span><span class="sxs-lookup"><span data-stu-id="4a356-153">Click **Article Properties**, and then click **Set Properties of Highlighted Table Article** or **Set Properties of All Table Articles**.</span></span>    
3.  <span data-ttu-id="4a356-154">在“项目属性 - \<Article>”  或“项目属性 - \<ArticleType>”页上，单击“冲突解决程序”选项卡。</span><span class="sxs-lookup"><span data-stu-id="4a356-154">On the **Article Properties - \<Article>** or **Article Properties - \<ArticleType>** page, click the **Resolver** tab.</span></span>    
4.  <span data-ttu-id="4a356-155">选择 **“允许订阅服务器在按需同步时交互式解决冲突”** 。</span><span class="sxs-lookup"><span data-stu-id="4a356-155">Select **Allow Subscriber to resolve conflicts interactively during on-demand synchronization**.</span></span>    
5.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]    
6.  <span data-ttu-id="4a356-156">如果处于“发布属性 - \<Publication>”对话框中，请单击“确定”以保存并关闭该对话框 。</span><span class="sxs-lookup"><span data-stu-id="4a356-156">If you are in the **Publication Properties - \<Publication>** dialog box, click **OK** to save and close the dialog box.</span></span>  
  
#### <a name="to-specify-that-a-subscription-should-use-interactive-conflict-resolution"></a><span data-ttu-id="4a356-157">指定订阅应使用交互式冲突解决方法</span><span class="sxs-lookup"><span data-stu-id="4a356-157">To specify that a subscription should use interactive conflict resolution</span></span>  
  
1.  <span data-ttu-id="4a356-158">在“订阅属性 - \<Subscriber>: \<SubscriptionDatabase>”  对话框中，为“以交互方式解决冲突”选项指定“True”值。</span><span class="sxs-lookup"><span data-stu-id="4a356-158">In the **Subscription Properties - \<Subscriber>: \<SubscriptionDatabase>** dialog box, specify a value of **True** for the **Resolve conflicts interactively** option.</span></span> <span data-ttu-id="4a356-159">有关访问此对话框的详细信息，请参阅 [View and Modify Push Subscription Properties](../view-and-modify-push-subscription-properties.md) 和 [View and Modify Pull Subscription Properties](../view-and-modify-pull-subscription-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="4a356-159">For more information about accessing this dialog box, see [View and Modify Push Subscription Properties](../view-and-modify-push-subscription-properties.md) and [View and Modify Pull Subscription Properties](../view-and-modify-pull-subscription-properties.md).</span></span> 
2.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
### <a name="using-transact-sql"></a><span data-ttu-id="4a356-160">“使用 Transact-SQL”</span><span class="sxs-lookup"><span data-stu-id="4a356-160">Using Transact-SQL</span></span>  
 <span data-ttu-id="4a356-161">创建合并发布的请求订阅时，您可以编程方式指定订阅服务器将使用此图形界面来解决项目冲突。</span><span class="sxs-lookup"><span data-stu-id="4a356-161">You can programmatically specify that a Subscriber will use this graphical interface to resolve article conflicts when a pull subscription to a merge publication is created.</span></span> <span data-ttu-id="4a356-162">只有支持此选项的项目中的冲突才会显示在交互式冲突解决程序中。</span><span class="sxs-lookup"><span data-stu-id="4a356-162">Only conflicts in articles that support this option will be displayed in the Interactive Resolver.</span></span>  
  
#### <a name="create-a-merge-pull-subscription-that-uses-the-interactive-resolver"></a><span data-ttu-id="4a356-163">创建使用交互式冲突解决程序的合并请求订阅</span><span class="sxs-lookup"><span data-stu-id="4a356-163">Create a merge pull subscription that uses the Interactive Resolver</span></span>  
  
1.  <span data-ttu-id="4a356-164">在发布服务器上，对发布数据库执行[sp_helpmergearticle](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql)，并指定\*\* \@ 发布\*\*。</span><span class="sxs-lookup"><span data-stu-id="4a356-164">At the Publisher on the publication database, execute [sp_helpmergearticle](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql), specifying **\@publication**.</span></span> <span data-ttu-id="4a356-165">注意结果集中其交互式冲突解决程序将被使用的每个项目的 **allow_interactive_resolver** 值。</span><span class="sxs-lookup"><span data-stu-id="4a356-165">Note the value of **allow_interactive_resolver** for each article in the result set for which the Interactive Resolver will be used.</span></span>    
    -   <span data-ttu-id="4a356-166">如果该值为 **1**，将使用交互式冲突解决程序。</span><span class="sxs-lookup"><span data-stu-id="4a356-166">If this value is **1**, the Interactive Resolver will be used.</span></span>    
    -   <span data-ttu-id="4a356-167">如果该值为 **0**，则您必须首先启用每个项目的交互式冲突解决程序。</span><span class="sxs-lookup"><span data-stu-id="4a356-167">If this value is **0**, you must first enable the Interactive Resolver for each article.</span></span> <span data-ttu-id="4a356-168">为此，请执行[sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql)，并指定\*\* \@ 发布**、 \*\* \@ 项目**、 \*\* \@ 属性**的值**allow_interactive_resolver\*\* ，并将值设置为**true** 。 \*\* \@ \*\*</span><span class="sxs-lookup"><span data-stu-id="4a356-168">To do this, execute [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql), specifying **\@publication**, **\@article**, a value of **allow_interactive_resolver** for **\@property**, and a value of **true** for **\@value**.</span></span>    
2.  <span data-ttu-id="4a356-169">在订阅服务器上，对订阅数据库执行 [sp_addmergepullsubscription](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="4a356-169">At the Subscriber on the subscription database, execute [sp_addmergepullsubscription](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-transact-sql).</span></span> <span data-ttu-id="4a356-170">有关详细信息，请参阅 [创建请求订阅](../create-a-pull-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="4a356-170">For more information, see [Create a Pull Subscription](../create-a-pull-subscription.md).</span></span>    
3.  <span data-ttu-id="4a356-171">在订阅服务器的订阅数据库中，执行 [sp_addmergepullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql)，同时指定下列参数：</span><span class="sxs-lookup"><span data-stu-id="4a356-171">At the Subscriber on the subscription database, execute [sp_addmergepullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql), specifying the following parameters:</span></span>  
  
    -   <span data-ttu-id="4a356-172">发布\*\* \@ 服务器**、 \*\* \@ publisher_db** (发布的数据库) 和\*\* \@ 发布\*\*。</span><span class="sxs-lookup"><span data-stu-id="4a356-172">**\@publisher**, **\@publisher_db** (the published database), and **\@publication**.</span></span>    
    -   <span data-ttu-id="4a356-173">\*\* \@ Enabled_for_syncmgr**的值为**true\*\* 。</span><span class="sxs-lookup"><span data-stu-id="4a356-173">A value of **true** for **\@enabled_for_syncmgr**.</span></span>    
    -   <span data-ttu-id="4a356-174">\*\* \@ Use_interactive_resolver**的值为**true\*\* 。</span><span class="sxs-lookup"><span data-stu-id="4a356-174">A value of **true** for **\@use_interactive_resolver**.</span></span>    
    -   <span data-ttu-id="4a356-175">合并代理所需的安全帐户信息。</span><span class="sxs-lookup"><span data-stu-id="4a356-175">The security account information required by the Merge Agent.</span></span> <span data-ttu-id="4a356-176">有关详细信息，请参阅 [创建请求订阅](../create-a-pull-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="4a356-176">For more information, see [Create a Pull Subscription](../create-a-pull-subscription.md).</span></span>    
4.  <span data-ttu-id="4a356-177">在发布服务器的发布数据库中，执行 [sp_addmergesubscription](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="4a356-177">At the Publisher on the publication database, execute [sp_addmergesubscription](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql).</span></span>  
  
#### <a name="define-an-article-that-supports-the-interactive-resolver"></a><span data-ttu-id="4a356-178">定义支持交互式冲突解决程序的项目</span><span class="sxs-lookup"><span data-stu-id="4a356-178">Define an article that supports the Interactive Resolver</span></span>  
  
<span data-ttu-id="4a356-179">在发布服务器上，对发布数据库执行 [sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="4a356-179">At the Publisher on the publication database, execute [sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql).</span></span> <span data-ttu-id="4a356-180">指定项目**所属发布的名称、项目 \@ **的名称、要为** \@ source_object**发布的数据库对象，并\*\* \@ **将** \@ allow_interactive_resolver**的值指定为**true\*\* 。</span><span class="sxs-lookup"><span data-stu-id="4a356-180">Specify the name of the publication to which the article belongs for **\@publication**, a name for the article for **\@article**, the database object being published for **\@source_object**, and a value of **true** for **\@allow_interactive_resolver**.</span></span> <span data-ttu-id="4a356-181">有关详细信息，请参阅 [定义项目](define-an-article.md)。</span><span class="sxs-lookup"><span data-stu-id="4a356-181">For more information, see [Define an Article](define-an-article.md).</span></span>  

## <a name="specify-the-conflict-tracking-and-resolution-level"></a><span data-ttu-id="4a356-182">指定冲突跟踪和解决方法级别</span><span class="sxs-lookup"><span data-stu-id="4a356-182">Specify the Conflict Tracking and Resolution Level</span></span> 
<span data-ttu-id="4a356-183">在同步对合并发布的订阅时，复制检查是否存在因对发布服务器和订阅服务器上的相同数据进行更改而导致的冲突。</span><span class="sxs-lookup"><span data-stu-id="4a356-183">When a subscription to a merge publication is synchronized, replication checks for conflicts caused by changes to the same data made at both the Publisher and the Subscriber.</span></span> <span data-ttu-id="4a356-184">可以指定是在行级别检测冲突（即对行的任何更改都视为冲突），还是在列级别检测冲突（即只有更改了相同的行和列时才视作冲突）。</span><span class="sxs-lookup"><span data-stu-id="4a356-184">You can specify whether conflicts are detected at the row-level, where any change to the row is considered a conflict, or column-level, where only changes to the same row and column are considered a conflict.</span></span> <span data-ttu-id="4a356-185">项目的冲突解决在行级别执行。</span><span class="sxs-lookup"><span data-stu-id="4a356-185">Conflict resolution for articles is performed at the row-level.</span></span> <span data-ttu-id="4a356-186">有关在使用逻辑记录时检测和解决冲突的详细信息，请参阅 [Detecting and Resolving Conflicts in Logical Records](../merge/advanced-merge-replication-conflict-resolving-in-logical-record.md)。</span><span class="sxs-lookup"><span data-stu-id="4a356-186">For more information about conflict detection and resolution when logical records are used, see [Detecting and Resolving Conflicts in Logical Records](../merge/advanced-merge-replication-conflict-resolving-in-logical-record.md).</span></span>  
  

  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="4a356-187">限制和局限</span><span class="sxs-lookup"><span data-stu-id="4a356-187">Limitations and Restrictions</span></span>  
  
-   <span data-ttu-id="4a356-188">如果在初始化订阅后修改跟踪级别，必须重新初始化这些订阅。</span><span class="sxs-lookup"><span data-stu-id="4a356-188">If you modify the tracking level after subscriptions have been initialized, those subscriptions must be reinitialized.</span></span> <span data-ttu-id="4a356-189">有关属性更改的影响的详细信息，请参阅[更改发布和项目属性](../publish/change-publication-and-article-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="4a356-189">For more information about the effects of property changes, see [Change Publication and Article Properties](../publish/change-publication-and-article-properties.md).</span></span>    
-   <span data-ttu-id="4a356-190">对于行级和列级跟踪，始终在行级执行冲突解决：入选行将覆盖落选行。</span><span class="sxs-lookup"><span data-stu-id="4a356-190">With row- and column-level tracking, conflict resolution is always performed at the row-level: the winning row overwrites the losing row.</span></span> <span data-ttu-id="4a356-191">合并复制还允许您指定在逻辑记录级跟踪和解决冲突，但 [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]没有提供这些选项。</span><span class="sxs-lookup"><span data-stu-id="4a356-191">Merge replication also allows you to specify that conflicts be tracked and resolved at the logical record level, but these options are not available from [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)].</span></span> <span data-ttu-id="4a356-192">有关在复制存储过程中设置这些选项的信息，请参阅 [定义合并表项目间的逻辑记录关系](../publish/define-a-logical-record-relationship-between-merge-table-articles.md)。</span><span class="sxs-lookup"><span data-stu-id="4a356-192">For information about setting these options from replication stored procedures, see [Define a Logical Record Relationship Between Merge Table Articles](../publish/define-a-logical-record-relationship-between-merge-table-articles.md).</span></span>  
  
###  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="4a356-193">使用 SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="4a356-193">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="4a356-194">在“项目属性”对话框的“属性“选项卡上指定合并项目的行级或列级跟踪，该对话框可以在新发布向导和“发布属性 - \<Publication>”对话框中找到。</span><span class="sxs-lookup"><span data-stu-id="4a356-194">Specify row- or column-level tracking for merge articles on the **Properties** tab of the **Article Properties** dialog box, which is available in the New Publication Wizard and the **Publication Properties - \<Publication>** dialog box.</span></span> <span data-ttu-id="4a356-195">有关如何使用该向导和如何访问该对话框的详细信息，请参阅[创建发布](create-a-publication.md)和[查看和修改发布属性](../publish/view-and-modify-publication-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="4a356-195">For more information about using the wizard and accessing the dialog box, see [Create a Publication](create-a-publication.md) and [View and Modify Publication Properties](../publish/view-and-modify-publication-properties.md).</span></span>  
  
#### <a name="specify-row--or-column-level-tracking"></a><span data-ttu-id="4a356-196">指定行级别或列级别跟踪</span><span class="sxs-lookup"><span data-stu-id="4a356-196">Specify row- or column-level tracking</span></span>  
  
1.  <span data-ttu-id="4a356-197">在新建发布向导或“发布属性 - \<Publication>”对话框的“项目” 页上，选择一个表。</span><span class="sxs-lookup"><span data-stu-id="4a356-197">On the **Articles** page of the New Publication Wizard or the **Publication Properties - \<Publication>** dialog box, select a table.</span></span>    
2.  <span data-ttu-id="4a356-198">单击 **“项目属性”** ，然后单击 **“设置突出显示的表项目的属性”** 或 **“设置所有表项目的属性”** 。</span><span class="sxs-lookup"><span data-stu-id="4a356-198">Click **Article Properties**, and then click **Set Properties of Highlighted Table Article** or **Set Properties of All Table Articles**.</span></span>   
3.  <span data-ttu-id="4a356-199">在“项目属性 \<Article>”对话框的“属性”选项卡上，为“跟踪级别”属性选择以下值之一：  “行级别跟踪”或“列级别跟踪” 。</span><span class="sxs-lookup"><span data-stu-id="4a356-199">On the **Properties** tab of the **Article Properties \<Article>** dialog box, select one of the following values for the **Tracking level** property: **Row-level tracking** or **Column-level tracking**.</span></span>    
4.  <span data-ttu-id="4a356-200">如果处于“发布属性 - \<Publication>”对话框中，请单击“确定”以保存并关闭该对话框 。</span><span class="sxs-lookup"><span data-stu-id="4a356-200">If you are in the **Publication Properties - \<Publication>** dialog box, click **OK** to save and close the dialog box.</span></span>  
  
###  <a name="using-transact-sql"></a><span data-ttu-id="4a356-201">“使用 Transact-SQL”</span><span class="sxs-lookup"><span data-stu-id="4a356-201">Using Transact-SQL</span></span>  
  
#### <a name="specify-conflict-tracking-options-for-a-new-merge-article"></a><span data-ttu-id="4a356-202">为新的合并项目指定冲突跟踪选项</span><span class="sxs-lookup"><span data-stu-id="4a356-202">Specify conflict tracking options for a new merge article</span></span>  
  
1.  <span data-ttu-id="4a356-203">在发布服务器上，对发布数据库执行[sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) ，并为\*\* \@ column_tracking\*\*指定下列值之一：</span><span class="sxs-lookup"><span data-stu-id="4a356-203">At the Publisher on the publication database, execute [sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) and specify one of the following values for **\@column_tracking**:</span></span>  
  
    -   <span data-ttu-id="4a356-204">**true** - 为项目使用列级别跟踪。</span><span class="sxs-lookup"><span data-stu-id="4a356-204">**true** - Use column-level tracking for the article.</span></span>    
    -   <span data-ttu-id="4a356-205">**false** - 使用行级别跟踪，这是默认值。</span><span class="sxs-lookup"><span data-stu-id="4a356-205">**false** - Use row-level tracking, which is the default.</span></span>  
  
#### <a name="change-conflict-tracking-options-for-a-merge-article"></a><span data-ttu-id="4a356-206">更改合并项目的冲突跟踪选项</span><span class="sxs-lookup"><span data-stu-id="4a356-206">Change conflict tracking options for a merge article</span></span>  
  
1.  <span data-ttu-id="4a356-207">若要确定某个合并项目的冲突跟踪选项，请执行 [sp_helpmergearticle](/sql/relational-databases/system-stored-procedures/sp-helpmergearticle-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="4a356-207">To determine the conflict tracking options for a merge article, execute [sp_helpmergearticle](/sql/relational-databases/system-stored-procedures/sp-helpmergearticle-transact-sql).</span></span> <span data-ttu-id="4a356-208">请注意项目的结果集中 **column_tracking** 选项的值。</span><span class="sxs-lookup"><span data-stu-id="4a356-208">Note the value of the **column_tracking** option in the result set for the article.</span></span> <span data-ttu-id="4a356-209">值为 **1** 表明使用的是列级别的跟踪，值为 **0** 表明使用的是行级别的跟踪。</span><span class="sxs-lookup"><span data-stu-id="4a356-209">A value of **1** means that column-level tracking is being used, and a value of **0** means that row-level tracking is being used.</span></span>    
2.  <span data-ttu-id="4a356-210">在发布服务器上，对发布数据库执行 [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="4a356-210">At the Publisher on the publication database, execute [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql).</span></span> <span data-ttu-id="4a356-211">为 " \*\* \@ 属性**" 指定**column_tracking**的值，并为 " \*\* \@ 值**" 指定以下值之一：</span><span class="sxs-lookup"><span data-stu-id="4a356-211">Specify a value of **column_tracking** for **\@property** and one of the following values for **\@value**:</span></span>
    -   <span data-ttu-id="4a356-212">**true** - 为项目使用列级别跟踪。</span><span class="sxs-lookup"><span data-stu-id="4a356-212">**true** - Use column-level tracking for the article.</span></span>
    -   <span data-ttu-id="4a356-213">**false** - 使用行级别跟踪，这是默认值。</span><span class="sxs-lookup"><span data-stu-id="4a356-213">**false** - Use row-level tracking, which is the default.</span></span>  
  
     <span data-ttu-id="4a356-214">为\*\* \@ force_invalidate_snapshot**和** \@ force_reinit_subscription**指定值**1\*\* 。</span><span class="sxs-lookup"><span data-stu-id="4a356-214">Specify a value of **1** for both **\@force_invalidate_snapshot** and **\@force_reinit_subscription**.</span></span>  

## <a name="tracking-deletes"></a><span data-ttu-id="4a356-215">跟踪删除</span><span class="sxs-lookup"><span data-stu-id="4a356-215">Tracking deletes</span></span>

> [!NOTE]  
>  [!INCLUDE[ssNoteDepFutureAvoid](../../../includes/ssnotedepfutureavoid-md.md)]  
  
 <span data-ttu-id="4a356-216">默认情况下，合并复制同步发布服务器和订阅服务器之间的 DELETE 命令。</span><span class="sxs-lookup"><span data-stu-id="4a356-216">By default, merge replication synchronizes DELETE commands between the Publisher and Subscriber.</span></span> <span data-ttu-id="4a356-217">您可以使用合并复制来保留订阅数据库中的行，即使这些行已从发布中删除，反之亦然。</span><span class="sxs-lookup"><span data-stu-id="4a356-217">Merge replication enables you to retain rows in the subscription database even when they have been deleted from the publication, and vice versa.</span></span> <span data-ttu-id="4a356-218">您可以通过编程方式指定在创建新项目时忽略 DELETE 命令，或者可以使用复制存储过程在以后启用此功能。</span><span class="sxs-lookup"><span data-stu-id="4a356-218">You can programmatically specify that DELETE commands be ignored when creating a new article or you can enable this functionality at a later time using replication stored procedures.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="4a356-219">启用此功能将导致无法收敛，也就是说，位于订阅服务器上的数据将无法准确反映发布服务器上的数据。</span><span class="sxs-lookup"><span data-stu-id="4a356-219">Enabling this functionality will result in non-convergence, which means that data present at the Subscriber will not accurately reflect data at the Publisher.</span></span> <span data-ttu-id="4a356-220">您必须实现自己的用于手动删除已删除行的机制。</span><span class="sxs-lookup"><span data-stu-id="4a356-220">You must implement your own mechanism for manually removing deleted rows.</span></span>  
  
### <a name="specify-that-deletes-be-ignored-for-a-new-merge-article"></a><span data-ttu-id="4a356-221">指定对新合并项目忽略删除</span><span class="sxs-lookup"><span data-stu-id="4a356-221">Specify that deletes be ignored for a new merge article</span></span>  
  
1.  <span data-ttu-id="4a356-222">在发布服务器上，对发布数据库执行 [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="4a356-222">At the Publisher on the publication database, execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql).</span></span> <span data-ttu-id="4a356-223">将的值指定 `false` 为\*\* \@ delete_tracking\*\*。</span><span class="sxs-lookup"><span data-stu-id="4a356-223">Specify a value of `false` for **\@delete_tracking**.</span></span> <span data-ttu-id="4a356-224">有关详细信息，请参阅 [定义项目](../publish/define-an-article.md)。</span><span class="sxs-lookup"><span data-stu-id="4a356-224">For more information, see [Define an Article](../publish/define-an-article.md).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="4a356-225">如果某个项目的源表已在另一个发布中发布，则两个项目的 **delete_tracking** 值必须相同。</span><span class="sxs-lookup"><span data-stu-id="4a356-225">If the source table for an article is already published in another publication, the value of **delete_tracking** must be the same for both articles.</span></span>  
  
### <a name="specify-that-deletes-be-ignored-for-an-existing-merge-article"></a><span data-ttu-id="4a356-226">指定对现有合并项目忽略删除</span><span class="sxs-lookup"><span data-stu-id="4a356-226">Specify that deletes be ignored for an existing merge article</span></span>  
  
1.  <span data-ttu-id="4a356-227">若要确定是否对项目启用了错误补偿，请执行 [sp_helpmergearticle (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-helpmergearticle-transact-sql) 并注意结果集中的 **delete_tracking** 值。</span><span class="sxs-lookup"><span data-stu-id="4a356-227">To determine if error compensation is enabled for an article, execute [sp_helpmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergearticle-transact-sql) and note the value of **delete_tracking** in the result set.</span></span> <span data-ttu-id="4a356-228">如果该值为 **0**，则删除已被忽略。</span><span class="sxs-lookup"><span data-stu-id="4a356-228">If this value is **0**, deletes are already being ignored.</span></span>    
2.  <span data-ttu-id="4a356-229">如果步骤 1 的值为 **1**，则在发布服务器上对发布数据库执行 [sp_changemergearticle (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="4a356-229">If the value from step 1 is **1**, execute [sp_changemergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql) at the Publisher on the publication database.</span></span> <span data-ttu-id="4a356-230">为 " \*\* \@ 属性**" 指定**delete_tracking\*\*的值，并为 "值" 指定值 `false` 。 \*\* \@ \*\*</span><span class="sxs-lookup"><span data-stu-id="4a356-230">Specify a value of **delete_tracking** for **\@property**, and a value of `false` for **\@value**.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="4a356-231">如果某个项目的源表已在另一个发布中发布，则两个项目的 **delete_tracking** 值必须相同。</span><span class="sxs-lookup"><span data-stu-id="4a356-231">If the source table for an article is already published in another publication, the value of **delete_tracking** must be the same for both articles.</span></span>  
  
## <a name="processing-order"></a><span data-ttu-id="4a356-232">处理顺序</span><span class="sxs-lookup"><span data-stu-id="4a356-232">Processing Order</span></span>
  <span data-ttu-id="4a356-233">通过使用合并复制，您可以指定在同步过程中合并代理处理项目的顺序。</span><span class="sxs-lookup"><span data-stu-id="4a356-233">Merge replication enables you to specify the order in which articles are processed by the Merge Agent during the synchronization process.</span></span> <span data-ttu-id="4a356-234">您可以在使用复制存储过程创建项目时以编程方式为每个项目指定顺序。</span><span class="sxs-lookup"><span data-stu-id="4a356-234">You can assign an order to each article programmatically when creating an article using replication stored procedures.</span></span> <span data-ttu-id="4a356-235">项目按值的由低到高顺序进行处理。</span><span class="sxs-lookup"><span data-stu-id="4a356-235">Articles are processed in order from lowest to highest value.</span></span> <span data-ttu-id="4a356-236">如果两个项目具有相同值，将对其进行并发处理。</span><span class="sxs-lookup"><span data-stu-id="4a356-236">If two articles have the same value, they are processed concurrently.</span></span> <span data-ttu-id="4a356-237">有关详细信息，请参阅[指定合并复制属性](../publish/specify-merge-replication-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="4a356-237">For more information, see [Specify Merge Replication properties](../publish/specify-merge-replication-properties.md).</span></span>  

  <span data-ttu-id="4a356-238">从开始 [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] ，可以覆盖合并发布的项目默认处理顺序。</span><span class="sxs-lookup"><span data-stu-id="4a356-238">Beginning with [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], it is possible to override the default order of article processing for merge publications.</span></span> <span data-ttu-id="4a356-239">例如，如果通过触发器定义引用完整性而这些触发器又必须按某顺序激发，以上操作就会很有用。</span><span class="sxs-lookup"><span data-stu-id="4a356-239">This is useful, for example, if you define referential integrity through triggers and those triggers must fire in a certain order.</span></span> 

### <a name="how-processing-order-is-determined"></a><span data-ttu-id="4a356-240">如何确定处理顺序</span><span class="sxs-lookup"><span data-stu-id="4a356-240">How Processing Order is Determined</span></span>  
 <span data-ttu-id="4a356-241">合并同步过程中，项目在默认情况下按照对象间相关性要求的顺序处理，包括基表中定义的声明性引用完整性 (DRI) 约束。</span><span class="sxs-lookup"><span data-stu-id="4a356-241">During merge synchronization, articles are, by default, processed in the order required by the dependencies between objects, including the declarative referential integrity (DRI) constraints defined on the base tables.</span></span> <span data-ttu-id="4a356-242">处理涉及将更改枚举到表，然后应用这些更改。</span><span class="sxs-lookup"><span data-stu-id="4a356-242">Processing involves enumerating the changes to a table and then applying those changes.</span></span> <span data-ttu-id="4a356-243">若不存在 DRI，但在表项目之间存在联接筛选器或逻辑记录，则就以筛选器和逻辑记录要求的顺序处理项目。</span><span class="sxs-lookup"><span data-stu-id="4a356-243">If no DRI is present but join filters or logical records exist between table articles, the articles are processed in the order required by the filters and logical records.</span></span> <span data-ttu-id="4a356-244">未通过 DRI、联接筛选器、逻辑记录或其他依赖关系与任何其他项目相关的项目，根据 [sysmergearticles (Transact-SQL)](/sql/relational-databases/system-tables/sysmergearticles-transact-sql) 系统表中的项目别名进行处理。</span><span class="sxs-lookup"><span data-stu-id="4a356-244">Articles not related to any other article through DRI, join filters, logical records, or other dependencies are processed according to the article nickname in the [sysmergearticles &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/sysmergearticles-transact-sql) system table.</span></span>  
  
 <span data-ttu-id="4a356-245">考虑一个包含 **SalesOrderHeader** 表和 **SalesOrderDetail** 表的发布，并且 **SalesOrderHeader** 表中具有主键列 **SalesOrderID** 而 **SalesOrderDetail** 表中具有对应的外键列 **SalesOrderID** 。</span><span class="sxs-lookup"><span data-stu-id="4a356-245">Consider a publication that includes the tables **SalesOrderHeader** and **SalesOrderDetail** with a primary key column **SalesOrderID** in the **SalesOrderHeader** table and a corresponding foreign key column **SalesOrderID** in the **SalesOrderDetail** table.</span></span> <span data-ttu-id="4a356-246">同步过程中，合并复制通过在 **SalesOrderDetail** 中插入相关行之前先在 **SalesOrderHeader**中插入某些新行的方式来防止违反外键。</span><span class="sxs-lookup"><span data-stu-id="4a356-246">During synchronization, merge replication prevents foreign key violations by inserting any new rows in **SalesOrderHeader** before inserting associated rows in **SalesOrderDetail**.</span></span> <span data-ttu-id="4a356-247">同样，要先从 **SalesOrderDetail** 中删除行，然后才从 **SalesOrderHeader**中删除相关行。</span><span class="sxs-lookup"><span data-stu-id="4a356-247">Similarly, rows are deleted from **SalesOrderDetail** before the associated row is deleted from **SalesOrderHeader**.</span></span>  
  
 <span data-ttu-id="4a356-248">但是，在某些应用程序中，通过数据库触发器（或者在应用程序级，而不是通过 DRI）强制引用完整性。</span><span class="sxs-lookup"><span data-stu-id="4a356-248">However, in some applications referential integrity is enforced through database triggers, or at the application level, rather than through DRI.</span></span> <span data-ttu-id="4a356-249">考虑上述具有引用完整性的发布（而不是 DRI）， **SalesOrderDetail** 表可能会有一个插入触发器以确保在允许插入之前 **SalesOrderHeader** 表中存在相关行。</span><span class="sxs-lookup"><span data-stu-id="4a356-249">Given the publication described above, instead of DRI, the **SalesOrderDetail** table could have an insert trigger that ensures the associated row in the **SalesOrderHeader** table exists before allowing an insert.</span></span> <span data-ttu-id="4a356-250">**SalesOrderHeader** 可能有一个删除触发器以确保在允许删除之前 **SalesOrderDetail** 中没有相关行。</span><span class="sxs-lookup"><span data-stu-id="4a356-250">**SalesOrderHeader** could have a delete trigger that ensures there are no associated rows in **SalesOrderDetail** before allowing a delete.</span></span> <span data-ttu-id="4a356-251">由于合并复制无法在激发触发器之前确定触发器的结果，所以在确定项目的处理顺序时，合并复制不会考虑触发器。</span><span class="sxs-lookup"><span data-stu-id="4a356-251">Merge replication does not take into account triggers when determining processing order of articles because it cannot determine what the result of the trigger will be until it has fired.</span></span> <span data-ttu-id="4a356-252">同样，复制也不会考虑在应用程序级定义的约束。</span><span class="sxs-lookup"><span data-stu-id="4a356-252">Similarly, replication cannot take into account constraints defined at the application level.</span></span>  
  
 <span data-ttu-id="4a356-253">通过触发器或在应用程序级维护引用完整性时，您应该指定项目应处理的顺序。</span><span class="sxs-lookup"><span data-stu-id="4a356-253">When referential integrity is maintained through triggers or at the application level, you should specify the order in which the articles should be processed.</span></span> <span data-ttu-id="4a356-254">在有关触发器的示例中，需要指定在处理 **SalesOrderDetail** 之前先处理 **SalesOrderHeader**表，因为项目排序是根据插入顺序进行的。</span><span class="sxs-lookup"><span data-stu-id="4a356-254">In the example with triggers, you would specify that the **SalesOrderHeader** table should be processed before **SalesOrderDetail**, because article ordering is based on insert order.</span></span> <span data-ttu-id="4a356-255">合并复制会自动反转删除顺序。</span><span class="sxs-lookup"><span data-stu-id="4a356-255">Merge replication will automatically reverse the order for deletes.</span></span> <span data-ttu-id="4a356-256">不进行项目排序也不会导致合并复制失败，因为即使违反约束，合并代理也会继续处理项目；然后它会在处理完其他项目后重试所有过去失败的操作。</span><span class="sxs-lookup"><span data-stu-id="4a356-256">Merge replication will not fail without article ordering, because the Merge Agent continues to process articles if a constraint violation occurs; it then retries any operations that failed after other articles have been processed.</span></span> <span data-ttu-id="4a356-257">指定项目顺序仅避免重试以及其他与其相关联的处理。</span><span class="sxs-lookup"><span data-stu-id="4a356-257">Specifying article order simply avoids retries and the additional processing associated with them.</span></span> <span data-ttu-id="4a356-258">如果指定了错误顺序（比如，导致详细记录在标题记录前处理的顺序），合并复制会重试处理直到成功。</span><span class="sxs-lookup"><span data-stu-id="4a356-258">If you specify an incorrect order (for example, one that results in detail records being processed before header records), merge replication will retry processing until it succeeds.</span></span>  

### <a name="new-article"></a><span data-ttu-id="4a356-259">新文章</span><span class="sxs-lookup"><span data-stu-id="4a356-259">New Article</span></span>
  
1.  <span data-ttu-id="4a356-260">在发布服务器上，对发布数据库执行 [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="4a356-260">At the Publisher on the publication database, execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql).</span></span> <span data-ttu-id="4a356-261">指定一个整数值，该值表示\*\* \@ processing_order\*\*的项目的处理顺序。</span><span class="sxs-lookup"><span data-stu-id="4a356-261">Specify an integer value that represents the processing order for the article for **\@processing_order**.</span></span> <span data-ttu-id="4a356-262">有关详细信息，请参阅 [定义项目](define-an-article.md)。</span><span class="sxs-lookup"><span data-stu-id="4a356-262">For more information, see [Define an Article](define-an-article.md).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="4a356-263">创建指定了顺序的项目时，应在项目顺序值之间留有间隔。</span><span class="sxs-lookup"><span data-stu-id="4a356-263">When creating ordered articles, you should leave gaps between the article order values.</span></span> <span data-ttu-id="4a356-264">这样便于以后设置新值。</span><span class="sxs-lookup"><span data-stu-id="4a356-264">This makes it easier to set new values in the future.</span></span> <span data-ttu-id="4a356-265">例如，如果有三个项目需要指定固定处理顺序，请将\*\* \@ processing_order\*\*的值设置为10、20和30，而不是分别设置为1、2和3。</span><span class="sxs-lookup"><span data-stu-id="4a356-265">For example, if you have three articles for which you need to specify a fixed processing order, set the value of **\@processing_order** to 10, 20, and 30 rather than 1, 2, and 3, respectively.</span></span>  
  
### <a name="existing-article"></a><span data-ttu-id="4a356-266">现有项目</span><span class="sxs-lookup"><span data-stu-id="4a356-266">Existing article</span></span>
  
1.  <span data-ttu-id="4a356-267">若要确定项目的处理顺序，请执行 [sp_helpmergearticle (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-helpmergearticle-transact-sql)，并记下结果集中的 **processing_order** 值。</span><span class="sxs-lookup"><span data-stu-id="4a356-267">To determine processing order of an article, execute [sp_helpmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergearticle-transact-sql) and note the value of **processing_order** in the result set.</span></span>  
  
2.  <span data-ttu-id="4a356-268">在发布服务器上，对发布数据库执行 [sp_changemergearticle (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="4a356-268">At the Publisher on the publication database, execute [sp_changemergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql).</span></span> <span data-ttu-id="4a356-269">为\*\* \@ 属性**指定**processing_order**的值，并指定一个表示** \@ 值\*\*处理顺序的整数值。</span><span class="sxs-lookup"><span data-stu-id="4a356-269">Specify a value of **processing_order** for **\@property** and an integer value that represents the processing order for **\@value**.</span></span>  



## <a name="see-also"></a><span data-ttu-id="4a356-270">另请参阅</span><span class="sxs-lookup"><span data-stu-id="4a356-270">See Also</span></span>  
 [<span data-ttu-id="4a356-271">用条件性删除跟踪优化合并复制的性能</span><span class="sxs-lookup"><span data-stu-id="4a356-271">Optimize Merge Replication Performance with Conditional Delete Tracking</span></span>](../merge/optimize-merge-replication-performance-with-conditional-delete-tracking.md)  
 <span data-ttu-id="4a356-272">[检测并解决逻辑记录中的冲突](../merge/advanced-merge-replication-conflict-resolving-in-logical-record.md) </span><span class="sxs-lookup"><span data-stu-id="4a356-272">[Detecting and Resolving Conflicts in Logical Records](../merge/advanced-merge-replication-conflict-resolving-in-logical-record.md) </span></span>  
 <span data-ttu-id="4a356-273">[定义合并表项目间的逻辑记录关系](define-a-logical-record-relationship-between-merge-table-articles.md) </span><span class="sxs-lookup"><span data-stu-id="4a356-273">[Define a Logical Record Relationship Between Merge Table Articles](define-a-logical-record-relationship-between-merge-table-articles.md) </span></span>  
 <span data-ttu-id="4a356-274">[检测并解决合并复制冲突](../merge/advanced-merge-replication-conflict-detection-and-resolution.md) </span><span class="sxs-lookup"><span data-stu-id="4a356-274">[Detect and Resolve Merge Replication Conflicts](../merge/advanced-merge-replication-conflict-detection-and-resolution.md) </span></span>  
 <span data-ttu-id="4a356-275">[使用仅下载项目优化合并复制性能](../merge/optimize-merge-replication-performance-with-download-only-articles.md) </span><span class="sxs-lookup"><span data-stu-id="4a356-275">[Optimize Merge Replication Performance with Download-Only Articles](../merge/optimize-merge-replication-performance-with-download-only-articles.md) </span></span>  
 <span data-ttu-id="4a356-276">[Define an Article](define-an-article.md) </span><span class="sxs-lookup"><span data-stu-id="4a356-276">[Define an Article](define-an-article.md) </span></span>  
 [<span data-ttu-id="4a356-277">查看和修改项目属性</span><span class="sxs-lookup"><span data-stu-id="4a356-277">View and Modify Article Properties</span></span>](view-and-modify-article-properties.md)  