---
title: 创建和应用初始快照 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- snapshots [SQL Server replication], creating
- snapshot replication [SQL Server], initial snapshots
ms.assetid: 742727a1-5189-44ec-b3ae-6fd7aa1f5347
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: b7ac008fe139adf55376bb50fbf60dddcd6b9ae5
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87578135"
---
# <a name="create-and-apply-the-initial-snapshot"></a><span data-ttu-id="c865f-102">创建并应用初始快照</span><span class="sxs-lookup"><span data-stu-id="c865f-102">Create and Apply the Initial Snapshot</span></span>
  <span data-ttu-id="c865f-103">本主题说明如何使用 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 、 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]或复制管理对象 (RMO) 在 [!INCLUDE[tsql](../../includes/tsql-md.md)]中创建和应用初始快照。</span><span class="sxs-lookup"><span data-stu-id="c865f-103">This topic describes how to create and apply the initial snapshot in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span> <span data-ttu-id="c865f-104">使用参数化筛选器的合并发布需要由两部分组成的快照。</span><span class="sxs-lookup"><span data-stu-id="c865f-104">Merge publications that use parameterized filters require a two-part snapshot.</span></span> <span data-ttu-id="c865f-105">有关详细信息，请参阅 [为包含参数化筛选器的合并发布创建快照](create-a-snapshot-for-a-merge-publication-with-parameterized-filters.md)。</span><span class="sxs-lookup"><span data-stu-id="c865f-105">For more information, see [Create a Snapshot for a Merge Publication with Parameterized Filters](create-a-snapshot-for-a-merge-publication-with-parameterized-filters.md).</span></span>  
  
 <span data-ttu-id="c865f-106">**本主题内容**</span><span class="sxs-lookup"><span data-stu-id="c865f-106">**In This Topic**</span></span>  
  
-   <span data-ttu-id="c865f-107">**创建和应用初始快照，使用：**</span><span class="sxs-lookup"><span data-stu-id="c865f-107">**To create and apply the initial snapshot, using:**</span></span>  
  
     [<span data-ttu-id="c865f-108">SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="c865f-108">SQL Server Management Studio</span></span>](#SSMSProcedure)  
  
     [<span data-ttu-id="c865f-109">Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="c865f-109">Transact-SQL</span></span>](#TsqlProcedure)  
  
     [<span data-ttu-id="c865f-110">复制管理对象 (RMO)</span><span class="sxs-lookup"><span data-stu-id="c865f-110">Replication Management Objects (RMO)</span></span>](#RMOProcedure)  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="c865f-111">使用 SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="c865f-111">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="c865f-112">默认情况下，如果运行 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理，在使用新建发布向导创建发布后，快照代理将立即生成快照。</span><span class="sxs-lookup"><span data-stu-id="c865f-112">By default, if [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent is running, a snapshot is generated by the Snapshot Agent immediately after a publication is created with the New Publication Wizard.</span></span> <span data-ttu-id="c865f-113">然后，默认情况下将由分发代理（对于快照复制和事务复制）或合并代理（对于合并订阅）把此快照应用于所有订阅。</span><span class="sxs-lookup"><span data-stu-id="c865f-113">By default, it is then applied by the Distribution Agent (for snapshot and transactional replication) or Merge Agent (for merge subscriptions) for all subscriptions.</span></span> <span data-ttu-id="c865f-114">还可以使用 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] 和复制监视器生成快照。</span><span class="sxs-lookup"><span data-stu-id="c865f-114">A snapshot can also be generated using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] and Replication Monitor.</span></span> <span data-ttu-id="c865f-115">有关启动复制监视器的信息，请参阅[启动复制监视器](monitor/start-the-replication-monitor.md)。</span><span class="sxs-lookup"><span data-stu-id="c865f-115">For information about starting Replication Monitor, see [Start the Replication Monitor](monitor/start-the-replication-monitor.md).</span></span>  
  
#### <a name="to-create-a-snapshot-in-management-studio"></a><span data-ttu-id="c865f-116">在 Management Studio 中创建快照</span><span class="sxs-lookup"><span data-stu-id="c865f-116">To create a snapshot in Management Studio</span></span>  
  
1.  <span data-ttu-id="c865f-117">在 [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)]中连接到发布服务器，然后展开服务器节点。</span><span class="sxs-lookup"><span data-stu-id="c865f-117">Connect to the Publisher in [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="c865f-118">展开 **“复制”** 文件夹，再展开 **“本地发布”** 文件夹。</span><span class="sxs-lookup"><span data-stu-id="c865f-118">Expand the **Replication** folder, and then expand the **Local Publications** folder.</span></span>  
  
3.  <span data-ttu-id="c865f-119">右键单击要为其创建快照的发布，然后单击 **“查看快照代理状态”** 。</span><span class="sxs-lookup"><span data-stu-id="c865f-119">Right-click the publication for which you want to create a snapshot, and then click **View Snapshot Agent Status**.</span></span>  
  
4.  <span data-ttu-id="c865f-120">在“查看快照代理状态 - \<Publication>”对话框中，单击“启动” 。</span><span class="sxs-lookup"><span data-stu-id="c865f-120">In the **View Snapshot Agent Status - \<Publication>** dialog box, click **Start**.</span></span>  
  
 <span data-ttu-id="c865f-121">快照代理生成快照后，将显示一条消息，例如“[100%] 已生成 17 个项目的快照”。</span><span class="sxs-lookup"><span data-stu-id="c865f-121">When the Snapshot Agent finishes generating the snapshot, a message will be displayed, such as "[100%] A snapshot of 17 article(s) was generated."</span></span>  
  
#### <a name="to-create-a-snapshot-in-replication-monitor"></a><span data-ttu-id="c865f-122">在复制监视器中创建快照</span><span class="sxs-lookup"><span data-stu-id="c865f-122">To create a snapshot in Replication Monitor</span></span>  
  
1.  <span data-ttu-id="c865f-123">在复制监视器的左窗格中依次展开发布服务器组、发布服务器。</span><span class="sxs-lookup"><span data-stu-id="c865f-123">In Replication Monitor, expand a Publisher group in the left pane, and then expand a Publisher.</span></span>  
  
2.  <span data-ttu-id="c865f-124">右键单击要为其生成快照的发布，再单击 **“生成快照”** 。</span><span class="sxs-lookup"><span data-stu-id="c865f-124">Right-click the publication for which you want to generate a snapshot, and then click **Generate Snapshot**.</span></span>  
  
3.  <span data-ttu-id="c865f-125">若要查看快照代理的状态，请单击 **“代理”** 选项卡。有关更多详细信息，请右键单击网格中的快照代理，再单击 **“查看详细信息”** 。</span><span class="sxs-lookup"><span data-stu-id="c865f-125">To view the status of the Snapshot Agent, click the **Agents** tab. For more detailed information, right-click the Snapshot Agent in the grid, and then click **View Details**.</span></span>  
  
#### <a name="to-apply-a-snapshot"></a><span data-ttu-id="c865f-126">应用快照</span><span class="sxs-lookup"><span data-stu-id="c865f-126">To apply a snapshot</span></span>  
  
1.  <span data-ttu-id="c865f-127">快照生成后，通过用分发代理或合并代理同步订阅来应用此快照：</span><span class="sxs-lookup"><span data-stu-id="c865f-127">After the snapshot is generated, it is applied by synchronizing the subscription with the Distribution Agent or the Merge Agent:</span></span>  
  
    -   <span data-ttu-id="c865f-128">如果代理设置为连续运行（事务复制下的默认设置），则快照生成后将自动应用。</span><span class="sxs-lookup"><span data-stu-id="c865f-128">If the agent is set to run continuously (the default for transactional replication), the snapshot is automatically applied after it is generated.</span></span>  
  
    -   <span data-ttu-id="c865f-129">如果代理设置为根据计划运行，则在安排代理下次运行时应用快照。</span><span class="sxs-lookup"><span data-stu-id="c865f-129">If the agent is set to run on a schedule, the snapshot is applied the next time the agent is scheduled to run.</span></span>  
  
    -   <span data-ttu-id="c865f-130">如果代理设置为按需运行，则在您下次运行代理时应用快照。</span><span class="sxs-lookup"><span data-stu-id="c865f-130">If the agent is set to run on demand, it is applied the next time you run the agent.</span></span>  
  
     <span data-ttu-id="c865f-131">有关同步订阅的详细信息，请参阅 [Synchronize a Push Subscription](synchronize-a-push-subscription.md) 和 [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md)文件夹中打开。</span><span class="sxs-lookup"><span data-stu-id="c865f-131">For more information about synchronizing subscriptions, see [Synchronize a Push Subscription](synchronize-a-push-subscription.md) and [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md).</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="c865f-132">使用 Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="c865f-132">Using Transact-SQL</span></span>  
 <span data-ttu-id="c865f-133">可通过创建并运行快照代理作业或通过批处理文件运行快照代理可执行文件，以编程方式创建初始快照。</span><span class="sxs-lookup"><span data-stu-id="c865f-133">Initial snapshots can be programmatically created either by creating and running a Snapshot Agent job or by running the Snapshot Agent executable file from a batch file.</span></span> <span data-ttu-id="c865f-134">初始快照生成后，该快照将在订阅首次同步时传输并应用到订阅服务器。</span><span class="sxs-lookup"><span data-stu-id="c865f-134">After an initial snapshot has been generated, it is transferred to and applied at the Subscriber when the subscription is first synchronized.</span></span> <span data-ttu-id="c865f-135">如果您在命令提示符处或通过批处理文件运行快照代理，则只要现有快照变为无效，您就需要重新运行此代理。</span><span class="sxs-lookup"><span data-stu-id="c865f-135">If you run the Snapshot Agent from a command prompt or a batch file, you will need to rerun the agent whenever the existing snapshot becomes invalid.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="c865f-136">如果可能，请在运行时提示用户输入安全凭据。</span><span class="sxs-lookup"><span data-stu-id="c865f-136">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="c865f-137">如果必须在脚本文件中存储凭据，则必须保护文件以防止未经授权的访问。</span><span class="sxs-lookup"><span data-stu-id="c865f-137">If you must store credentials in a script file, you must secure the file to prevent unauthorized access.</span></span>  
  
#### <a name="to-create-and-run-a-snapshot-agent-job-to-generate-the-initial-snapshot"></a><span data-ttu-id="c865f-138">创建并运行快照代理作业以生成初始快照</span><span class="sxs-lookup"><span data-stu-id="c865f-138">To create and run a Snapshot Agent job to generate the initial snapshot</span></span>  
  
1.  <span data-ttu-id="c865f-139">创建快照发布、事务发布或合并发布。</span><span class="sxs-lookup"><span data-stu-id="c865f-139">Create a snapshot, transactional, or merge publication.</span></span> <span data-ttu-id="c865f-140">有关详细信息，请参阅 [Create a Publication](publish/create-a-publication.md)。</span><span class="sxs-lookup"><span data-stu-id="c865f-140">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="c865f-141">执行 [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="c865f-141">Execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="c865f-142">指定 **@publication** 和以下参数：</span><span class="sxs-lookup"><span data-stu-id="c865f-142">Specify **@publication** and the following parameters:</span></span>  
  
    -   <span data-ttu-id="c865f-143">**@job_login，用于指定**快照代理在分发服务器上运行时所用的 Windows 身份验证凭据。</span><span class="sxs-lookup"><span data-stu-id="c865f-143">**The @job_login, which specifies** the Windows Authentication credentials under which the Snapshot Agent runs at the Distributor.</span></span>  
  
    -   <span data-ttu-id="c865f-144">**@job_password**，为提供的 Windows 凭据的密码。</span><span class="sxs-lookup"><span data-stu-id="c865f-144">**The @job_password**, which is the password for the supplied Windows credentials.</span></span>  
  
    -   <span data-ttu-id="c865f-145">（可选）如果代理在连接到发布服务器时将使用 SQL Server 身份验证，则将 **@publisher_security_mode** 的值指定为 **@publisher_security_mode** 。</span><span class="sxs-lookup"><span data-stu-id="c865f-145">(Optional) A value of **0** for **@publisher_security_mode** if the agent will use SQL Server Authentication when connecting to the Publisher.</span></span> <span data-ttu-id="c865f-146">在这种情况下，你还必须为和指定 SQL Server 身份验证登录信息 **@publisher_login** **@publisher_password** 。</span><span class="sxs-lookup"><span data-stu-id="c865f-146">In this case, you must also specify the SQL Server Authentication login information for **@publisher_login** and **@publisher_password**.</span></span>  
  
    -   <span data-ttu-id="c865f-147">（可选）快照代理作业的同步计划。</span><span class="sxs-lookup"><span data-stu-id="c865f-147">(Optional) A synchronization schedule for the Snapshot Agent job.</span></span> <span data-ttu-id="c865f-148">有关详细信息，请参阅 [Specify Synchronization Schedules](specify-synchronization-schedules.md)。</span><span class="sxs-lookup"><span data-stu-id="c865f-148">For more information, see [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="c865f-149">使用远程分发服务器配置发布服务器时，为所有参数提供的值（包括 *job_login* 和 *job_password*）都会以纯文本方式发送到该分发服务器。</span><span class="sxs-lookup"><span data-stu-id="c865f-149">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="c865f-150">在执行此存储过程之前，应该对发布服务器及其远程分发服务器之间的连接进行加密。</span><span class="sxs-lookup"><span data-stu-id="c865f-150">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="c865f-151">有关详细信息，请参阅[启用数据库引擎的加密连接（SQL Server 配置管理器）](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="c865f-151">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="c865f-152">向发布添加项目。</span><span class="sxs-lookup"><span data-stu-id="c865f-152">Add articles to the publication.</span></span> <span data-ttu-id="c865f-153">有关详细信息，请参阅 [定义项目](publish/define-an-article.md)。</span><span class="sxs-lookup"><span data-stu-id="c865f-153">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
4.  <span data-ttu-id="c865f-154">在发布服务器上，对发布数据库执行 [sp_startpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-startpublication-snapshot-transact-sql)，并指定步骤 1 中 **@publication** 的值。</span><span class="sxs-lookup"><span data-stu-id="c865f-154">At the Publisher on the publication database, execute [sp_startpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-startpublication-snapshot-transact-sql), specifying the value of **@publication** from step 1.</span></span>  
  
#### <a name="to-run-the-snapshot-agent-to-generate-the-initial-snapshot"></a><span data-ttu-id="c865f-155">运行快照代理以生成初始快照</span><span class="sxs-lookup"><span data-stu-id="c865f-155">To run the Snapshot Agent to generate the initial snapshot</span></span>  
  
1.  <span data-ttu-id="c865f-156">创建快照发布、事务发布或合并发布。</span><span class="sxs-lookup"><span data-stu-id="c865f-156">Create a snapshot, transactional, or merge publication.</span></span> <span data-ttu-id="c865f-157">有关详细信息，请参阅 [Create a Publication](publish/create-a-publication.md)。</span><span class="sxs-lookup"><span data-stu-id="c865f-157">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="c865f-158">向发布添加项目。</span><span class="sxs-lookup"><span data-stu-id="c865f-158">Add articles to the publication.</span></span> <span data-ttu-id="c865f-159">有关详细信息，请参阅 [定义项目](publish/define-an-article.md)。</span><span class="sxs-lookup"><span data-stu-id="c865f-159">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
3.  <span data-ttu-id="c865f-160">在命令提示符处或批处理文件中，通过运行 [snapshot.exe](agents/replication-snapshot-agent.md) 并指定下列命令行参数，启动 **复制合并代理**：</span><span class="sxs-lookup"><span data-stu-id="c865f-160">From the command prompt or in a batch file, start the [Replication Snapshot Agent](agents/replication-snapshot-agent.md) by running **snapshot.exe**, specifying the following command-line arguments:</span></span>  
  
    -   <span data-ttu-id="c865f-161">**-Publication**</span><span class="sxs-lookup"><span data-stu-id="c865f-161">**-Publication**</span></span>  
  
    -   <span data-ttu-id="c865f-162">**-Publisher**</span><span class="sxs-lookup"><span data-stu-id="c865f-162">**-Publisher**</span></span>  
  
    -   <span data-ttu-id="c865f-163">**-Distributor**</span><span class="sxs-lookup"><span data-stu-id="c865f-163">**-Distributor**</span></span>  
  
    -   <span data-ttu-id="c865f-164">**-PublisherDB**</span><span class="sxs-lookup"><span data-stu-id="c865f-164">**-PublisherDB**</span></span>  
  
    -   <span data-ttu-id="c865f-165">**-ReplicationType**</span><span class="sxs-lookup"><span data-stu-id="c865f-165">**-ReplicationType**</span></span>  
  
     <span data-ttu-id="c865f-166">如果您使用的是 SQL Server 身份验证，则还必须指定下列参数：</span><span class="sxs-lookup"><span data-stu-id="c865f-166">If you are using SQL Server Authentication, you must also specify the following arguments:</span></span>  
  
    -   <span data-ttu-id="c865f-167">**-DistributorLogin**</span><span class="sxs-lookup"><span data-stu-id="c865f-167">**-DistributorLogin**</span></span>  
  
    -   <span data-ttu-id="c865f-168">**-DistributorPassword**</span><span class="sxs-lookup"><span data-stu-id="c865f-168">**-DistributorPassword**</span></span>  
  
    -   <span data-ttu-id="c865f-169">**-DistributorSecurityMode** =  **\@publisher_security_mode**</span><span class="sxs-lookup"><span data-stu-id="c865f-169">**-DistributorSecurityMode** = **0**</span></span>  
  
    -   <span data-ttu-id="c865f-170">**-PublisherLogin**</span><span class="sxs-lookup"><span data-stu-id="c865f-170">**-PublisherLogin**</span></span>  
  
    -   <span data-ttu-id="c865f-171">**-PublisherPassword**</span><span class="sxs-lookup"><span data-stu-id="c865f-171">**-PublisherPassword**</span></span>  
  
    -   <span data-ttu-id="c865f-172">**-PublisherSecurityMode** =  **\@publisher_security_mode**</span><span class="sxs-lookup"><span data-stu-id="c865f-172">**-PublisherSecurityMode** = **0**</span></span>  
  
###  <a name="examples-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="c865f-173">示例 (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="c865f-173">Examples (Transact-SQL)</span></span>  
 <span data-ttu-id="c865f-174">此示例演示如何创建事务发布，并为新的发布添加快照代理作业（使用 **sqlcmd** 脚本变量）。</span><span class="sxs-lookup"><span data-stu-id="c865f-174">This example shows how to create a transactional publication and add a Snapshot Agent job for the new publication (using **sqlcmd** scripting variables).</span></span> <span data-ttu-id="c865f-175">此示例还启动该作业。</span><span class="sxs-lookup"><span data-stu-id="c865f-175">The example also starts the job.</span></span>  
  
 [!code-sql[HowTo#sp_trangenerate_snapshot](../../snippets/tsql/SQL15/replication/howto/tsql/createtranpubinitialsnapshot.sql#sp_trangenerate_snapshot)]  
  
 <span data-ttu-id="c865f-176">此示例创建一个合并发布，并为此发布添加一个快照代理作业（使用 **sqlcmd** 变量）。</span><span class="sxs-lookup"><span data-stu-id="c865f-176">This example creates a merge publication and adds a Snapshot Agent job (using **sqlcmd** variables) for the publication.</span></span> <span data-ttu-id="c865f-177">此示例还启动该作业。</span><span class="sxs-lookup"><span data-stu-id="c865f-177">This example also starts the job.</span></span>  
  
 [!code-sql[HowTo#sp_mergegenerate_snapshot](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubinitialsnapshot.sql#sp_mergegenerate_snapshot)]  
  
 <span data-ttu-id="c865f-178">以下命令行参数启动快照代理，以为合并发布生成快照。</span><span class="sxs-lookup"><span data-stu-id="c865f-178">The following command-line arguments start the Snapshot Agent to generate the snapshot for a merge publication.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="c865f-179">为便于阅读，添加了换行符。</span><span class="sxs-lookup"><span data-stu-id="c865f-179">Line breaks were added to improve readability.</span></span> <span data-ttu-id="c865f-180">但在批处理文件中，命令必须位于一行中。</span><span class="sxs-lookup"><span data-stu-id="c865f-180">In a batch file, commands must be made in a single line.</span></span>  
  
 [!code-sql[HowTo#startmergesnapshot_10](../../snippets/tsql/SQL15/replication/howto/tsql/createmergesnapshot_10.bat)]  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="c865f-181">使用复制管理对象 (RMO)</span><span class="sxs-lookup"><span data-stu-id="c865f-181">Using Replication Management Objects (RMO)</span></span>  
 <span data-ttu-id="c865f-182">快照代理将在创建发布后生成快照。</span><span class="sxs-lookup"><span data-stu-id="c865f-182">The Snapshot Agent generates snapshots after a publication is created.</span></span> <span data-ttu-id="c865f-183">可以使用复制管理对象 (RMO) 和直接托管代码对复制代理功能的访问权限以编程的方式生成这些快照。</span><span class="sxs-lookup"><span data-stu-id="c865f-183">You can generate these snapshots programmatically by using Replication Management Objects (RMO) and direct managed code access to replication agent functionalities.</span></span> <span data-ttu-id="c865f-184">所使用的对象取决于复制的类型。</span><span class="sxs-lookup"><span data-stu-id="c865f-184">The objects you use depend on the type of replication.</span></span> <span data-ttu-id="c865f-185">可以使用 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> 对象同步启动快照代理，也可以使用代理作业异步启动快照代理。</span><span class="sxs-lookup"><span data-stu-id="c865f-185">The Snapshot Agent can be started synchronously using the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> object or asynchronously using the agent job.</span></span> <span data-ttu-id="c865f-186">初始快照生成后，该快照将在订阅首次同步时传输并应用到订阅服务器。</span><span class="sxs-lookup"><span data-stu-id="c865f-186">After the initial snapshot has been generated, it is transferred to and applied at the Subscriber when the subscription is first synchronized.</span></span> <span data-ttu-id="c865f-187">只要现有快照不再包含有效的最新数据，您就需要重新运行代理。</span><span class="sxs-lookup"><span data-stu-id="c865f-187">You will need to rerun the agent whenever the existing snapshot no longer contains valid, up-to-date data.</span></span> <span data-ttu-id="c865f-188">有关详细信息，请参阅[维护发布](publish/maintain-publications.md)。</span><span class="sxs-lookup"><span data-stu-id="c865f-188">For more information, see [Maintain Publications](publish/maintain-publications.md).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="c865f-189">如果可能，请在运行时提示用户输入安全凭据。</span><span class="sxs-lookup"><span data-stu-id="c865f-189">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="c865f-190">如果必须存储凭据，请使用 [Windows .NET Framework 提供的](https://go.microsoft.com/fwlink/?LinkId=34733) Cryptographic Services [!INCLUDE[msCoName](../../includes/msconame-md.md)] （加密服务）。</span><span class="sxs-lookup"><span data-stu-id="c865f-190">If you must store credentials, use the [cryptographic services](https://go.microsoft.com/fwlink/?LinkId=34733) provided by the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows .NET Framework.</span></span>  
  
#### <a name="to-generate-the-initial-snapshot-for-a-snapshot-or-transactional-publication-by-starting-the-snapshot-agent-job-asynchronous"></a><span data-ttu-id="c865f-191">通过启动快照代理作业（异步）为快照发布或事务发布生成初始快照</span><span class="sxs-lookup"><span data-stu-id="c865f-191">To generate the initial snapshot for a snapshot or transactional publication by starting the Snapshot Agent job (asynchronous)</span></span>  
  
1.  <span data-ttu-id="c865f-192">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 类创建与发布服务器的连接。</span><span class="sxs-lookup"><span data-stu-id="c865f-192">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="c865f-193">创建的 <xref:Microsoft.SqlServer.Replication.TransPublication> 类的实例。</span><span class="sxs-lookup"><span data-stu-id="c865f-193">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransPublication> class.</span></span> <span data-ttu-id="c865f-194">设置发布的 <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> 和 <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> 属性，并将 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> 属性设置为步骤 1 中创建的连接。</span><span class="sxs-lookup"><span data-stu-id="c865f-194">Set the <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> and <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> properties for the publication, and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the connection created in step 1.</span></span>  
  
3.  <span data-ttu-id="c865f-195">调用 <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> 方法以加载该对象的其余属性。</span><span class="sxs-lookup"><span data-stu-id="c865f-195">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method to load the remaining properties of the object.</span></span> <span data-ttu-id="c865f-196">如果此方法返回 `false`，则说明步骤 2 中的发布属性定义不正确，或者此发布不存在。</span><span class="sxs-lookup"><span data-stu-id="c865f-196">If this method returns `false`, either the publication properties in step 2 were defined incorrectly or the publication does not exist.</span></span>  
  
4.  <span data-ttu-id="c865f-197">如果 <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> 的值为 `false`，请调用 <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> 为此发布创建快照代理作业。</span><span class="sxs-lookup"><span data-stu-id="c865f-197">If the value of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> is `false`, call <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> to create the snapshot agent job for this publication.</span></span>  
  
5.  <span data-ttu-id="c865f-198">调用 <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> 方法以启动为此发布生成快照的代理作业。</span><span class="sxs-lookup"><span data-stu-id="c865f-198">Call the <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> method to start the agent job that generates the snapshot for this publication.</span></span>  
  
6.  <span data-ttu-id="c865f-199">（可选）<xref:Microsoft.SqlServer.Replication.TransPublication.SnapshotAvailable%2A> 的值为 `true` 时，订阅服务器具有快照。</span><span class="sxs-lookup"><span data-stu-id="c865f-199">(Optional) When the value of <xref:Microsoft.SqlServer.Replication.TransPublication.SnapshotAvailable%2A> is `true`, the snapshot is available to Subscribers.</span></span>  
  
#### <a name="to-generate-the-initial-snapshot-for-a-snapshot-or-transactional-publication-by-running-the-snapshot-agent-synchronous"></a><span data-ttu-id="c865f-200">通过运行快照代理（同步）为快照发布或事务发布生成初始快照</span><span class="sxs-lookup"><span data-stu-id="c865f-200">To generate the initial snapshot for a snapshot or transactional publication by running the Snapshot Agent (synchronous)</span></span>  
  
1.  <span data-ttu-id="c865f-201">创建 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> 类的实例，并设置下列所需属性：</span><span class="sxs-lookup"><span data-stu-id="c865f-201">Create an instance of the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> class, and set the following required properties:</span></span>  
  
    -   <span data-ttu-id="c865f-202"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> - 发布服务器的名称</span><span class="sxs-lookup"><span data-stu-id="c865f-202"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> - name of the Publisher</span></span>  
  
    -   <span data-ttu-id="c865f-203"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> - 发布数据库的名称</span><span class="sxs-lookup"><span data-stu-id="c865f-203"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> - name of the publication database</span></span>  
  
    -   <span data-ttu-id="c865f-204"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> - 发布的名称</span><span class="sxs-lookup"><span data-stu-id="c865f-204"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> - name of the publication</span></span>  
  
    -   <span data-ttu-id="c865f-205"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> - 分发服务器的名称</span><span class="sxs-lookup"><span data-stu-id="c865f-205"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> - name of the Distributor</span></span>  
  
    -   <span data-ttu-id="c865f-206"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> - 值为 <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> 表示连接到发布服务器时使用 Windows 身份验证，值为 <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> 以及值为 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherLogin%2A> 和 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherPassword%2A> 表示连接到发布服务器时使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 身份验证。</span><span class="sxs-lookup"><span data-stu-id="c865f-206"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to use Windows Authentication when connecting to the Publisher or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> and values for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherLogin%2A> and <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherPassword%2A> to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher.</span></span> <span data-ttu-id="c865f-207">建议使用 Windows 身份验证。</span><span class="sxs-lookup"><span data-stu-id="c865f-207">Windows Authentication is recommended.</span></span>  
  
    -   <span data-ttu-id="c865f-208"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> - 值为 <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> 表示连接到分发服务器时使用 Windows 身份验证，值为 <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> 以及值为 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorLogin%2A> 和 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorPassword%2A> 表示连接到分发服务器时使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 身份验证。</span><span class="sxs-lookup"><span data-stu-id="c865f-208"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to use Windows Authentication when connecting to the Distributor or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> and values for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorLogin%2A> and <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorPassword%2A> to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Distributor.</span></span> <span data-ttu-id="c865f-209">建议使用 Windows 身份验证。</span><span class="sxs-lookup"><span data-stu-id="c865f-209">Windows Authentication is recommended.</span></span>  
  
2.  <span data-ttu-id="c865f-210">将 <xref:Microsoft.SqlServer.Replication.ReplicationType.Transactional> 的值设置为 <xref:Microsoft.SqlServer.Replication.ReplicationType.Snapshot> 或 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>。</span><span class="sxs-lookup"><span data-stu-id="c865f-210">Set a value of <xref:Microsoft.SqlServer.Replication.ReplicationType.Transactional> or <xref:Microsoft.SqlServer.Replication.ReplicationType.Snapshot> for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>.</span></span>  
  
3.  <span data-ttu-id="c865f-211">调用 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="c865f-211">Call the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> method.</span></span>  
  
#### <a name="to-generate-the-initial-snapshot-for-a-merge-publication-by-starting-the-snapshot-agent-job-asynchronous"></a><span data-ttu-id="c865f-212">通过启动快照代理作业（异步）为合并发布生成初始快照</span><span class="sxs-lookup"><span data-stu-id="c865f-212">To generate the initial snapshot for a merge publication by starting the Snapshot Agent job (asynchronous)</span></span>  
  
1.  <span data-ttu-id="c865f-213">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 类创建与发布服务器的连接。</span><span class="sxs-lookup"><span data-stu-id="c865f-213">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="c865f-214">创建的 <xref:Microsoft.SqlServer.Replication.MergePublication> 类的实例。</span><span class="sxs-lookup"><span data-stu-id="c865f-214">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class.</span></span> <span data-ttu-id="c865f-215">设置发布的 <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> 和 <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> 属性，并将 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> 属性设置为步骤 1 中创建的连接。</span><span class="sxs-lookup"><span data-stu-id="c865f-215">Set the <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> and <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> properties for the publication, and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the connection created in step 1.</span></span>  
  
3.  <span data-ttu-id="c865f-216">调用 <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> 方法以加载该对象的其余属性。</span><span class="sxs-lookup"><span data-stu-id="c865f-216">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method to load the remaining properties of the object.</span></span> <span data-ttu-id="c865f-217">如果此方法返回 `false`，则说明步骤 2 中的发布属性定义不正确，或者此发布不存在。</span><span class="sxs-lookup"><span data-stu-id="c865f-217">If this method returns `false`, either the publication properties in step 2 were defined incorrectly or the publication does not exist.</span></span>  
  
4.  <span data-ttu-id="c865f-218">如果 <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> 的值为 `false`，请调用 <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> 为此发布创建快照代理作业。</span><span class="sxs-lookup"><span data-stu-id="c865f-218">If the value of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> is `false`, call <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> to create the snapshot agent job for this publication.</span></span>  
  
5.  <span data-ttu-id="c865f-219">调用 <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> 方法以启动为此发布生成快照的代理作业。</span><span class="sxs-lookup"><span data-stu-id="c865f-219">Call the <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> method to start the agent job that generates the snapshot for this publication.</span></span>  
  
6.  <span data-ttu-id="c865f-220">（可选）<xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> 的值为 `true` 时，订阅服务器具有快照。</span><span class="sxs-lookup"><span data-stu-id="c865f-220">(Optional) When the value of <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> is `true`, the snapshot is available to Subscribers.</span></span>  
  
#### <a name="to-generate-the-initial-snapshot-for-a-merge-publication-by-running-the-snapshot-agent-synchronous"></a><span data-ttu-id="c865f-221">通过运行快照代理（同步）为合并发布生成初始快照</span><span class="sxs-lookup"><span data-stu-id="c865f-221">To generate the initial snapshot for a merge publication by running the Snapshot Agent (synchronous)</span></span>  
  
1.  <span data-ttu-id="c865f-222">创建 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> 类的实例，并设置下列所需属性：</span><span class="sxs-lookup"><span data-stu-id="c865f-222">Create an instance of the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> class, and set the following required properties:</span></span>  
  
    -   <span data-ttu-id="c865f-223"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> - 发布服务器的名称</span><span class="sxs-lookup"><span data-stu-id="c865f-223"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> - name of the Publisher</span></span>  
  
    -   <span data-ttu-id="c865f-224"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> - 发布数据库的名称</span><span class="sxs-lookup"><span data-stu-id="c865f-224"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> - name of the publication database</span></span>  
  
    -   <span data-ttu-id="c865f-225"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> - 发布的名称</span><span class="sxs-lookup"><span data-stu-id="c865f-225"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> - name of the publication</span></span>  
  
    -   <span data-ttu-id="c865f-226"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> - 分发服务器的名称</span><span class="sxs-lookup"><span data-stu-id="c865f-226"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> - name of the Distributor</span></span>  
  
    -   <span data-ttu-id="c865f-227"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> - 值为 <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> 表示连接到发布服务器时使用 Windows 身份验证，值为 <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> 以及值为 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherLogin%2A> 和 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherPassword%2A> 表示连接到发布服务器时使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 身份验证。</span><span class="sxs-lookup"><span data-stu-id="c865f-227"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to use Windows Authentication when connecting to the Publisher or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> and values for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherLogin%2A> and <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherPassword%2A> to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher.</span></span> <span data-ttu-id="c865f-228">建议使用 Windows 身份验证。</span><span class="sxs-lookup"><span data-stu-id="c865f-228">Windows Authentication is recommended.</span></span>  
  
    -   <span data-ttu-id="c865f-229"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> - 值为 <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> 表示连接到分发服务器时使用 Windows 身份验证，值为 <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> 以及值为 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorLogin%2A> 和 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorPassword%2A> 表示连接到分发服务器时使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 身份验证。</span><span class="sxs-lookup"><span data-stu-id="c865f-229"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to use Windows Authentication when connecting to the Distributor or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> and values for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorLogin%2A> and <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorPassword%2A> to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Distributor.</span></span> <span data-ttu-id="c865f-230">建议使用 Windows 身份验证。</span><span class="sxs-lookup"><span data-stu-id="c865f-230">Windows Authentication is recommended.</span></span>  
  
2.  <span data-ttu-id="c865f-231">将 <xref:Microsoft.SqlServer.Replication.ReplicationType.Merge> 的值设置为 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>。</span><span class="sxs-lookup"><span data-stu-id="c865f-231">Set a value of <xref:Microsoft.SqlServer.Replication.ReplicationType.Merge> for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>.</span></span>  
  
3.  <span data-ttu-id="c865f-232">调用 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="c865f-232">Call the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> method.</span></span>  
  
###  <a name="examples-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="c865f-233">示例 (RMO)</span><span class="sxs-lookup"><span data-stu-id="c865f-233">Examples (RMO)</span></span>  
 <span data-ttu-id="c865f-234">此示例同步运行快照代理，为事务发布生成初始快照。</span><span class="sxs-lookup"><span data-stu-id="c865f-234">This example synchronously runs the Snapshot Agent to generate the initial snapshot for a transactional publication.</span></span>  
  
 [!code-csharp[HowTo#rmo_GenerateSnapshot](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_generatesnapshot)]  
  
 [!code-vb[HowTo#rmo_vb_GenerateSnapshot](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_generatesnapshot)]  
  
 <span data-ttu-id="c865f-235">此示例异步启动代理作业，为事务发布生成初始快照。</span><span class="sxs-lookup"><span data-stu-id="c865f-235">This example asynchronously starts the agent job to generate the initial snapshot for a transactional publication.</span></span>  
  
 [!code-csharp[HowTo#rmo_GenerateSnapshot_WithJob](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_generatesnapshot_withjob)]  
  
 [!code-vb[HowTo#rmo_vb_GenerateSnapshot_WithJob](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_generatesnapshot_withjob)]  
  
## <a name="see-also"></a><span data-ttu-id="c865f-236">另请参阅</span><span class="sxs-lookup"><span data-stu-id="c865f-236">See Also</span></span>  
 <span data-ttu-id="c865f-237">[Create a Publication](publish/create-a-publication.md) </span><span class="sxs-lookup"><span data-stu-id="c865f-237">[Create a Publication](publish/create-a-publication.md) </span></span>  
 <span data-ttu-id="c865f-238">[Create a Pull Subscription](create-a-pull-subscription.md) </span><span class="sxs-lookup"><span data-stu-id="c865f-238">[Create a Pull Subscription](create-a-pull-subscription.md) </span></span>  
 <span data-ttu-id="c865f-239">[ssSDSFull](create-a-push-subscription.md) </span><span class="sxs-lookup"><span data-stu-id="c865f-239">[Create a Push Subscription](create-a-push-subscription.md) </span></span>  
 <span data-ttu-id="c865f-240">[Specify Synchronization Schedules](specify-synchronization-schedules.md) </span><span class="sxs-lookup"><span data-stu-id="c865f-240">[Specify Synchronization Schedules](specify-synchronization-schedules.md) </span></span>  
 <span data-ttu-id="c865f-241">[创建并应用快照](create-and-apply-the-snapshot.md) </span><span class="sxs-lookup"><span data-stu-id="c865f-241">[Create and Apply the Snapshot](create-and-apply-the-snapshot.md) </span></span>  
 <span data-ttu-id="c865f-242">[使用快照初始化订阅](initialize-a-subscription-with-a-snapshot.md) </span><span class="sxs-lookup"><span data-stu-id="c865f-242">[Initialize a Subscription with a Snapshot](initialize-a-subscription-with-a-snapshot.md) </span></span>  
 <span data-ttu-id="c865f-243">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="c865f-243">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span></span>  
 <span data-ttu-id="c865f-244">[Replication Security Best Practices](security/replication-security-best-practices.md) </span><span class="sxs-lookup"><span data-stu-id="c865f-244">[Replication Security Best Practices](security/replication-security-best-practices.md) </span></span>  
 <span data-ttu-id="c865f-245">[Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="c865f-245">[Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md) </span></span>  
 [<span data-ttu-id="c865f-246">将 sqlcmd 与脚本变量结合使用</span><span class="sxs-lookup"><span data-stu-id="c865f-246">Use sqlcmd with Scripting Variables</span></span>](../scripting/sqlcmd-use-with-scripting-variables.md)  
  
  
