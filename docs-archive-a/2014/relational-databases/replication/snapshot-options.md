---
title: 修改 SQL 复制的快照初始化选项 |Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- snapshot replication [SQL Server], options
- snapshots [SQL Server replication], options
ms.assetid: 759fab42-66c7-4541-a7a3-bb6fb868493c
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 946d9035730512a626e710b1140a1ba01290908a
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87689855"
---
# <a name="modify-snapshot-initialization-options-for-sql-replication"></a><span data-ttu-id="284df-102">修改 SQL 复制的快照初始化选项</span><span class="sxs-lookup"><span data-stu-id="284df-102">Modify Snapshot Initialization Options for SQL Replication</span></span>

<span data-ttu-id="284df-103">本文介绍如何在[使用快照初始化订阅](initialize-a-subscription-with-a-snapshot.md)时修改多个选项。</span><span class="sxs-lookup"><span data-stu-id="284df-103">This article discusses how to modify a number of options when [initializing a subscription with a snapshot](initialize-a-subscription-with-a-snapshot.md).</span></span>

## <a name="snapshot-format"></a><span data-ttu-id="284df-104">快照格式</span><span class="sxs-lookup"><span data-stu-id="284df-104">Snapshot Format</span></span>
  <span data-ttu-id="284df-105">在“发布属性 -  \<Publication>”对话框的“快照”页上指定快照格式。</span><span class="sxs-lookup"><span data-stu-id="284df-105">Specify snapshot format on the **Snapshot** page of the **Publication Properties - \<Publication>** dialog box.</span></span> <span data-ttu-id="284df-106">有关访问此对话框的详细信息，请参阅 [View and Modify Publication Properties](publish/view-and-modify-publication-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="284df-106">For more information about accessing this dialog box, see [View and Modify Publication Properties](publish/view-and-modify-publication-properties.md).</span></span>  

1.  <span data-ttu-id="284df-107">在“发布属性 - \<Publication>”对话框的“快照”页上，选择“本机 SQL Server - 所有订阅服务器都必须是运行 SQL Server 的服务器”或“字符 - 如果发布服务器或订阅服务器没有运行 SQL Server，则需要此项”。</span><span class="sxs-lookup"><span data-stu-id="284df-107">On the **Snapshot** page of the **Publication Properties - \<Publication>** dialog box, select **Native SQL Server - all Subscribers must be servers running SQL Server** or **Character - required if a Publisher or Subscriber is not running SQL Server**.</span></span> 

    > [!NOTE]  
    >  <span data-ttu-id="284df-108">建议选择本机格式，除非此发布必须支持对 [!INCLUDE[ssEW](../../../includes/ssew-md.md)] 数据库或非[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 数据库的订阅。</span><span class="sxs-lookup"><span data-stu-id="284df-108">It is recommended to select the native format unless this publication must support subscriptions to a [!INCLUDE[ssEW](../../../includes/ssew-md.md)] database or a non-[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database.</span></span>    
1.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  

## <a name="snapshot-folder-locations"></a><span data-ttu-id="284df-109">快照文件夹位置</span><span class="sxs-lookup"><span data-stu-id="284df-109">Snapshot folder locations</span></span>

### <a name="default-snapshot-location"></a><span data-ttu-id="284df-110">默认快照位置</span><span class="sxs-lookup"><span data-stu-id="284df-110">Default snapshot location</span></span>
<span data-ttu-id="284df-111">指定 (SQL Server Management Studio 的默认快照位置，) 在 "配置分发向导" 的 "**快照文件夹**" 页上指定默认快照位置。</span><span class="sxs-lookup"><span data-stu-id="284df-111">Specify the Default Snapshot Location (SQL Server Management Studio) Specify the default snapshot location on the **Snapshot Folder** page of the Configure Distribution Wizard.</span></span> <span data-ttu-id="284df-112">有关使用此向导的详细信息，请参阅[配置发布和分发](configure-publishing-and-distribution.md)。</span><span class="sxs-lookup"><span data-stu-id="284df-112">For more information about using this wizard, see [Configure Publishing and Distribution](configure-publishing-and-distribution.md).</span></span> <span data-ttu-id="284df-113">如果在未配置为分发服务器的服务器上创建发布，请在新建发布向导的 **“快照文件夹”** 页上指定默认快照位置。</span><span class="sxs-lookup"><span data-stu-id="284df-113">If you create a publication on a server that is not configured as a Distributor, specify a default snapshot location on the **Snapshot Folder** page of the New Publication Wizard.</span></span> <span data-ttu-id="284df-114">有关使用此向导的详细信息，请参阅[创建发布](publish/create-a-publication.md)。</span><span class="sxs-lookup"><span data-stu-id="284df-114">For more information about using this wizard, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
 <span data-ttu-id="284df-115">在“分发服务器属性 - \<Distributor>”对话框的“发布服务器”页上，修改默认快照位置 。</span><span class="sxs-lookup"><span data-stu-id="284df-115">Modify the default snapshot location on the **Publishers** page of the **Distributor Properties - \<Distributor>** dialog box.</span></span> <span data-ttu-id="284df-116">有关详细信息，请参阅[查看和修改分发服务器和发布服务器属性](view-and-modify-distributor-and-publisher-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="284df-116">For more information, see [View and Modify Distributor and Publisher Properties](view-and-modify-distributor-and-publisher-properties.md).</span></span> <span data-ttu-id="284df-117">在“发布属性 - \<Publication>”对话框中设置每个发布的快照文件夹。</span><span class="sxs-lookup"><span data-stu-id="284df-117">Set the snapshot folder for each publication in the **Publication Properties - \<Publication>** dialog box.</span></span> <span data-ttu-id="284df-118">有关详细信息，请参阅 [View and Modify Publication Properties](publish/view-and-modify-publication-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="284df-118">For more information, see [View and Modify Publication Properties](publish/view-and-modify-publication-properties.md).</span></span>  
  
#### <a name="modify-the-default-snapshot-location"></a><span data-ttu-id="284df-119">修改默认快照位置</span><span class="sxs-lookup"><span data-stu-id="284df-119">Modify the default snapshot location</span></span>  
  
1.  <span data-ttu-id="284df-120">在“分发服务器属性 - \<Distributor>”对话框的“发布服务器”页上，单击要更改其默认快照位置的发布服务器的属性按钮 (...)  。</span><span class="sxs-lookup"><span data-stu-id="284df-120">On the **Publishers** page of the **Distributor Properties - \<Distributor>** dialog box, click the properties button (**...**) for the Publisher for which you want to change the default snapshot location.</span></span>    
2.  <span data-ttu-id="284df-121">在“分发服务器属性 - \<Publisher>”对话框中，为“默认快照文件夹”属性输入一个值 。</span><span class="sxs-lookup"><span data-stu-id="284df-121">In the **Publisher Properties - \<Publisher>** dialog box, enter a value for the **Default Snapshot Folder** property.</span></span>

    > [!NOTE]  
    >  <span data-ttu-id="284df-122">快照代理必须对指定的目录具有写权限，而分发代理或合并代理必须具有读权限。</span><span class="sxs-lookup"><span data-stu-id="284df-122">The Snapshot Agent must have write permissions for the directory you specify, and the Distribution Agent or Merge Agent must have read permissions.</span></span> <span data-ttu-id="284df-123">如果使用的是请求订阅，则必须指定一个共享目录作为通用命名约定 (UNC) 路径，如 \\\computername\snapshot。</span><span class="sxs-lookup"><span data-stu-id="284df-123">If pull subscriptions are used, you must specify a shared directory as a universal naming convention (UNC) path, such as \\\computername\snapshot.</span></span> <span data-ttu-id="284df-124">有关详细信息，请参阅[保护快照文件夹](security/secure-the-snapshot-folder.md)。</span><span class="sxs-lookup"><span data-stu-id="284df-124">For more information, see [Secure the Snapshot Folder](security/secure-the-snapshot-folder.md).</span></span>    
1.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  

### <a name="alternate-snapshot-location"></a><span data-ttu-id="284df-125">备用快照位置</span><span class="sxs-lookup"><span data-stu-id="284df-125">Alternate snapshot location</span></span>
  <span data-ttu-id="284df-126">在 "**发布属性- \<Publication> \*\* " 对话框的 "**快照\*\*" 页上指定备用快照位置。</span><span class="sxs-lookup"><span data-stu-id="284df-126">Specify an alternate snapshot location on the **Snapshot** page of the **Publication Properties - \<Publication>** dialog box.</span></span> <span data-ttu-id="284df-127">有关访问此对话框的详细信息，请参阅 [View and Modify Publication Properties](publish/view-and-modify-publication-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="284df-127">For more information about accessing this dialog box, see [View and Modify Publication Properties](publish/view-and-modify-publication-properties.md).</span></span> 

  
#### <a name="specify-an-alternate-snapshot-location"></a><span data-ttu-id="284df-128">指定备用快照位置</span><span class="sxs-lookup"><span data-stu-id="284df-128">Specify an alternate snapshot location</span></span>  
  
1.  <span data-ttu-id="284df-129">在“发布属性 -  \<Publication>”对话框的“快照”页上：</span><span class="sxs-lookup"><span data-stu-id="284df-129">On the **Snapshot** page of the **Publication Properties - \<Publication>** dialog box:</span></span>    
    1.  <span data-ttu-id="284df-130">选择 **“将文件放入下列文件夹”** ，然后单击 **“浏览”** 定位到某个目录，或者输入用于存储快照文件的目录的路径。</span><span class="sxs-lookup"><span data-stu-id="284df-130">Select **Put files in the following folder**, and then click **Browse** to navigate to a directory, or enter the path to the directory in which the snapshot files should be stored.</span></span>    

        > [!NOTE]  
        >  <span data-ttu-id="284df-131">快照代理必须对指定的目录具有写权限，而分发代理或合并代理必须具有读权限。</span><span class="sxs-lookup"><span data-stu-id="284df-131">The Snapshot Agent must have write permissions for the directory you specify, and the Distribution Agent or Merge Agent must have read permissions.</span></span> <span data-ttu-id="284df-132">如果使用的是请求订阅，则必须指定一个共享目录作为通用命名约定 (UNC) 路径，如 \\\computername\snapshot。</span><span class="sxs-lookup"><span data-stu-id="284df-132">If pull subscriptions are used, you must specify a shared directory as a universal naming convention (UNC) path, such as \\\computername\snapshot.</span></span> <span data-ttu-id="284df-133">有关详细信息，请参阅[保护快照文件夹](security/secure-the-snapshot-folder.md)。</span><span class="sxs-lookup"><span data-stu-id="284df-133">For more information, see [Secure the Snapshot Folder](security/secure-the-snapshot-folder.md).</span></span>    
    <span data-ttu-id="284df-134">a.</span><span class="sxs-lookup"><span data-stu-id="284df-134">a.</span></span>  <span data-ttu-id="284df-135">除非需要将快照文件同时写入两个位置，否则应清除 **“将文件放入默认文件夹”** 。</span><span class="sxs-lookup"><span data-stu-id="284df-135">Clear **Put files in the default folder** unless you require snapshot files to be written to both locations.</span></span>    
     <span data-ttu-id="284df-136">若要压缩快照文件，请选择 **“压缩此文件夹中的快照文件”** 。</span><span class="sxs-lookup"><span data-stu-id="284df-136">To compress the snapshot files, select **Compress snapshot files in this location**.</span></span> <span data-ttu-id="284df-137">压缩通常用于低带宽连接和可移动介质（如 CD-ROM）上的备用快照位置。</span><span class="sxs-lookup"><span data-stu-id="284df-137">Compression is typically used for low bandwidth connections and alternate snapshot locations on removable media, such as a CD-ROM.</span></span>    
1.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]   


## <a name="compress-snapshot-files"></a><span data-ttu-id="284df-138">压缩快照文件</span><span class="sxs-lookup"><span data-stu-id="284df-138">Compress snapshot files</span></span>
<span data-ttu-id="284df-139">指定应在 "**发布属性- \<Publication> \*\* " 对话框的 "**快照\*\*" 页上压缩文件。</span><span class="sxs-lookup"><span data-stu-id="284df-139">Specify that files should be compressed on the **Snapshot** page of the **Publication Properties - \<Publication>** dialog box.</span></span> <span data-ttu-id="284df-140">有关访问此对话框的详细信息，请参阅 [View and Modify Publication Properties](publish/view-and-modify-publication-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="284df-140">For more information about accessing this dialog box, see [View and Modify Publication Properties](publish/view-and-modify-publication-properties.md).</span></span>  
  
1.  <span data-ttu-id="284df-141">在“发布属性 -  \<Publication>”对话框的“快照”页上：</span><span class="sxs-lookup"><span data-stu-id="284df-141">On the **Snapshot** page of the **Publication Properties - \<Publication>** dialog box:</span></span>  
  
    1.  <span data-ttu-id="284df-142">选择 **“将文件放入下列文件夹”** ，然后单击 **“浏览”** 定位到某个目录，或者输入用于存储快照文件的目录的路径。</span><span class="sxs-lookup"><span data-stu-id="284df-142">Select **Put files in the following folder**, and then click **Browse** to navigate to a directory, or enter the path to the directory in which the snapshot files should be stored.</span></span>    
        > [!NOTE]  
        >  <span data-ttu-id="284df-143">快照代理必须对指定的目录具有写权限，而分发代理或合并代理必须具有读权限。</span><span class="sxs-lookup"><span data-stu-id="284df-143">The Snapshot Agent must have write permissions for the directory you specify, and the Distribution Agent or Merge Agent must have read permissions.</span></span> <span data-ttu-id="284df-144">如果使用的是请求订阅，则必须指定一个共享目录作为通用命名约定 (UNC) 路径，如 \\\computername\snapshot。</span><span class="sxs-lookup"><span data-stu-id="284df-144">If pull subscriptions are used, you must specify a shared directory as a universal naming convention (UNC) path, such as \\\computername\snapshot.</span></span> <span data-ttu-id="284df-145">有关详细信息，请参阅[保护快照文件夹](security/secure-the-snapshot-folder.md)</span><span class="sxs-lookup"><span data-stu-id="284df-145">For more information, see [Secure the Snapshot Folder](security/secure-the-snapshot-folder.md)</span></span>  
  
    2.  <span data-ttu-id="284df-146">除非需要将快照文件同时写入两个位置，否则应清除 **“将文件放入默认文件夹”** 。</span><span class="sxs-lookup"><span data-stu-id="284df-146">Clear **Put files in the default folder** unless you require snapshot files to be written to both locations.</span></span>    
        > [!NOTE]  
        >  <span data-ttu-id="284df-147">如果选中了此复选框，则默认文件夹中存储的文件将不压缩。</span><span class="sxs-lookup"><span data-stu-id="284df-147">If this check box is selected, the files stored in the default folder are not compressed.</span></span> <span data-ttu-id="284df-148">压缩文件只能存储在上一步骤中指定的备用位置中。</span><span class="sxs-lookup"><span data-stu-id="284df-148">Compressed files can only be stored in the alternate location specified in the previous step.</span></span>    
2.  <span data-ttu-id="284df-149">选择 **“压缩此文件夹中的快照文件”** 。</span><span class="sxs-lookup"><span data-stu-id="284df-149">Select **Compress snapshot files in this folder**.</span></span>    
3.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  

## <a name="execute-scripts-before-and-after-snapshot-is-applied"></a><span data-ttu-id="284df-150">在应用快照之前和之后执行脚本</span><span class="sxs-lookup"><span data-stu-id="284df-150">Execute scripts before and after snapshot is applied</span></span>

 <span data-ttu-id="284df-151">可以指定在应用快照之前或之后在订阅服务器上执行的脚本。</span><span class="sxs-lookup"><span data-stu-id="284df-151">You can specify scripts to execute at the Subscriber before or after the snapshot is applied.</span></span> <span data-ttu-id="284df-152">使用脚本的原因有多种，例如在每台订阅服务器上创建登录帐户和架构（对象所有者）。</span><span class="sxs-lookup"><span data-stu-id="284df-152">Scripts can be used for a variety of reasons, such as creating logins and schemas (object owners) at each Subscriber.</span></span>  
  
 <span data-ttu-id="284df-153">可以为每个脚本指定一个文件位置，每次发生快照处理时，快照代理都会将脚本文件复制到当前快照文件夹中。</span><span class="sxs-lookup"><span data-stu-id="284df-153">You specify a file location for each script, and the Snapshot Agent copies the script files to the current snapshot folder each time snapshot processing occurs.</span></span> <span data-ttu-id="284df-154">应用快照时，分发代理或合并代理会在执行任何复制的对象脚本之前执行快照前脚本。</span><span class="sxs-lookup"><span data-stu-id="284df-154">The Distribution Agent or the Merge Agent runs the pre-snapshot script before any of the replicated object scripts when applying a snapshot.</span></span> <span data-ttu-id="284df-155">分发代理或合并代理在所有其他复制的对象脚本和数据应用之后，才会执行快照后脚本。</span><span class="sxs-lookup"><span data-stu-id="284df-155">The Distribution Agent or the Merge Agent runs the post-snapshot script after all the other replicated object scripts and data have been applied.</span></span> <span data-ttu-id="284df-156">在完成快照应用程序且成功执行脚本文件之后，这些脚本文件将从订阅服务器上的工作目录中删除。</span><span class="sxs-lookup"><span data-stu-id="284df-156">After the snapshot application is complete and script files run successfully, the script files are removed from the working directory on the Subscriber.</span></span>  
  
 <span data-ttu-id="284df-157">通过启动 **sqlcmd** 实用工具来执行脚本。</span><span class="sxs-lookup"><span data-stu-id="284df-157">The script is run by launching the **sqlcmd** utility.</span></span> <span data-ttu-id="284df-158">部署脚本之前，请先用 **sqlcmd** 执行该脚本，以确保它可以按预期方式执行。</span><span class="sxs-lookup"><span data-stu-id="284df-158">Before deploying a script, run it with **sqlcmd** to ensure it executes as expected.</span></span> <span data-ttu-id="284df-159">应用快照之前和之后执行的脚本的内容必须可重复。</span><span class="sxs-lookup"><span data-stu-id="284df-159">The contents of scripts that are executed before and after the snapshot is applied must be repeatable.</span></span> <span data-ttu-id="284df-160">例如，如果在脚本中创建了一个表，则应该首先检查该表是否存在，如果存在就执行相应的操作。</span><span class="sxs-lookup"><span data-stu-id="284df-160">For example, if you create a table in the script, you should first check for its existence and take appropriate action if it exists.</span></span> <span data-ttu-id="284df-161">脚本必须可重复是因为，如果需要重新初始化已应用了脚本的订阅，则在重新初始化期间应用新的快照时，将再次应用该脚本。</span><span class="sxs-lookup"><span data-stu-id="284df-161">The script must be repeatable because if you need to reinitialize a subscription for which the script has already been applied, the script will be applied again when the new snapshot is applied during reinitialization.</span></span>  
  
 <span data-ttu-id="284df-162">如果压缩快照文件（采用 [!INCLUDE[msCoName](../../includes/msconame-md.md)] CAB 文件格式压缩），则也会压缩脚本并将其置于此 CAB 文件中。</span><span class="sxs-lookup"><span data-stu-id="284df-162">If you are compressing the snapshot file (by putting it in [!INCLUDE[msCoName](../../includes/msconame-md.md)] CAB file format), the scripts are also compressed and placed in the CAB file.</span></span> <span data-ttu-id="284df-163">压缩的快照文件传输到订阅服务器并解压缩到订阅服务器上的工作目录后，将执行所有指示为快照前脚本的脚本。</span><span class="sxs-lookup"><span data-stu-id="284df-163">After the compressed snapshot file is transferred to the Subscriber and decompressed to a working directory on the Subscriber, any script indicated as a pre-snapshot script is executed.</span></span> <span data-ttu-id="284df-164">同样，在应用快照的最后一个步骤中，所有快照后脚本在订阅服务器上解压缩并执行。</span><span class="sxs-lookup"><span data-stu-id="284df-164">Likewise, any post-snapshot script is decompressed and executed at the Subscriber as the last step in applying the snapshot.</span></span>  

### <a name="execute-a-script-before-or-after-a-snapshot-is-applied"></a><span data-ttu-id="284df-165">在应用快照之前或之后执行脚本</span><span class="sxs-lookup"><span data-stu-id="284df-165">Execute a script before or after a snapshot is applied</span></span>  
 <span data-ttu-id="284df-166">在 "**发布属性- \<Publication> **对话框" 的 "**快照**" 页上，指定在应用快照之前或之后执行的可选脚本。</span><span class="sxs-lookup"><span data-stu-id="284df-166">Specify an optional script to execute before or after the snapshot is applied on the **Snapshot** page of the **Publication Properties - \<Publication>** dialog box.</span></span> <span data-ttu-id="284df-167">有关访问此对话框的详细信息，请参阅 [View and Modify Publication Properties](publish/view-and-modify-publication-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="284df-167">For more information about accessing this dialog box, see [View and Modify Publication Properties](publish/view-and-modify-publication-properties.md).</span></span>  


1.  <span data-ttu-id="284df-168">在“发布属性 -  \<Publication>”对话框的“快照”页上：</span><span class="sxs-lookup"><span data-stu-id="284df-168">On the **Snapshot** page of the **Publication Properties - \<Publication>** dialog box:</span></span>    
    -   <span data-ttu-id="284df-169">若要指定在应用快照之前执行的脚本，请单击 **“浏览”** 导航到该脚本，或者在 **“应用快照之前执行此脚本”** 文本框中输入该脚本的路径。</span><span class="sxs-lookup"><span data-stu-id="284df-169">To specify a script to execute before the snapshot is applied, click **Browse** to navigate to the script, or enter a path to the script in the **Before applying the snapshot, execute this script** text box.</span></span> 
   
        > [!NOTE]  
        >  <span data-ttu-id="284df-170">分发代理或合并代理必须对指定目录具有读取权限。</span><span class="sxs-lookup"><span data-stu-id="284df-170">The Distribution Agent or Merge Agent must have read permissions for the directory you specify.</span></span> <span data-ttu-id="284df-171">如果使用的是请求订阅，则必须指定一个共享目录作为通用命名约定 (UNC) 路径，如 \\\computername\scripts\myscript.sql。</span><span class="sxs-lookup"><span data-stu-id="284df-171">If pull subscriptions are used, you must specify a shared directory as a universal naming convention (UNC) path, such as \\\computername\scripts\myscript.sql.</span></span>    
    -   <span data-ttu-id="284df-172">若要指定在应用快照之后执行的脚本，请单击 **“浏览”** 导航到该脚本，或者在 **“应用快照之后执行此脚本”** 文本框中输入该脚本的 UNC 路径。</span><span class="sxs-lookup"><span data-stu-id="284df-172">To specify a script to execute after the snapshot is applied, click **Browse** to navigate to the script, or enter a UNC path to the script in the **After applying the snapshot, execute this script** text box.</span></span>    
2.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
  
  
