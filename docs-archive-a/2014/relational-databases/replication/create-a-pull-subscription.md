---
title: 创建请求订阅 | Microsoft Docs
ms.custom: ''
ms.date: 05/24/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- pull subscriptions [SQL Server replication], creating
- merge replication subscribing [SQL Server replication], pull subscriptions
- subscriptions [SQL Server replication], pull
- snapshot replication [SQL Server], subscribing
- transactional replication, subscribing
ms.assetid: 41d1886d-59c9-41fc-9bd6-a59b40e0af6e
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 12ef7d658496c0fb7281827259e8e46f0c5fac64
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87591871"
---
# <a name="create-a-pull-subscription"></a><span data-ttu-id="9227a-102">创建请求订阅</span><span class="sxs-lookup"><span data-stu-id="9227a-102">Create a Pull Subscription</span></span>
  <span data-ttu-id="9227a-103">本主题说明如何使用 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 、 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]或复制管理对象 (RMO) 在 [!INCLUDE[tsql](../../includes/tsql-md.md)]中创建请求订阅。</span><span class="sxs-lookup"><span data-stu-id="9227a-103">This topic describes how create a pull subscription in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span>  
  
 <span data-ttu-id="9227a-104">可以通过脚本设置 P2P 复制的请求订阅，但是不能通过向导这样做。</span><span class="sxs-lookup"><span data-stu-id="9227a-104">Setting up a pull subscription for P2P replication is possible by script, but is not available through the wizard.</span></span>  
  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="9227a-105">使用 SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="9227a-105">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="9227a-106">使用新建订阅向导在发布服务器或订阅服务器中创建请求订阅。</span><span class="sxs-lookup"><span data-stu-id="9227a-106">Create a pull subscription at the Publisher or the Subscriber using the New Subscription Wizard.</span></span> <span data-ttu-id="9227a-107">按照向导中的页的指示执行下列操作：</span><span class="sxs-lookup"><span data-stu-id="9227a-107">Follow the pages in the wizard to:</span></span>  
  
-   <span data-ttu-id="9227a-108">指定发布服务器和发布。</span><span class="sxs-lookup"><span data-stu-id="9227a-108">Specify the Publisher and publication.</span></span>  
  
-   <span data-ttu-id="9227a-109">选择运行复制代理的位置。</span><span class="sxs-lookup"><span data-stu-id="9227a-109">Select where replication agents will run.</span></span> <span data-ttu-id="9227a-110">对于请求订阅，根据发布类型的不同，请在 **“分发代理位置”** 页或 **“合并代理位置”** 页上选择 **“在其订阅服务器上运行每个代理(请求订阅)”** 。</span><span class="sxs-lookup"><span data-stu-id="9227a-110">For a pull subscription, select **Run each agent at its Subscriber (pull subscriptions)** on the **Distribution Agent Location** page or **Merge Agent Location** page, depending on the type of publication.</span></span>  
  
-   <span data-ttu-id="9227a-111">指定订阅服务器和订阅数据库。</span><span class="sxs-lookup"><span data-stu-id="9227a-111">Specify Subscribers and subscription databases.</span></span>  
  
-   <span data-ttu-id="9227a-112">指定复制代理建立连接所用的登录名和密码：</span><span class="sxs-lookup"><span data-stu-id="9227a-112">Specify the logins and passwords used for connections made by replication agents:</span></span>  
  
    -   <span data-ttu-id="9227a-113">对于快照发布和事务发布的订阅，在 **“分发代理安全性”** 页上指定凭据。</span><span class="sxs-lookup"><span data-stu-id="9227a-113">For subscriptions to snapshot and transactional publications, specify credentials on the **Distribution Agent Security** page.</span></span>  
  
    -   <span data-ttu-id="9227a-114">对于合并发布的订阅，在 **“合并代理安全性”** 页上指定凭据。</span><span class="sxs-lookup"><span data-stu-id="9227a-114">For subscriptions to merge publications, specify credentials on the **Merge Agent Security** page.</span></span>  
  
     <span data-ttu-id="9227a-115">有关每个代理所需权限的信息，请参阅 [R复制代理安全模式](security/replication-agent-security-model.md)。</span><span class="sxs-lookup"><span data-stu-id="9227a-115">For information about the permissions required by each agent, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
-   <span data-ttu-id="9227a-116">指定同步计划和初始化订阅服务器的时间。</span><span class="sxs-lookup"><span data-stu-id="9227a-116">Specify a synchronization schedule and when the Subscriber should be initialized.</span></span>  
  
-   <span data-ttu-id="9227a-117">指定合并发布的其他选项：订阅类型；参数化筛选值；如果发布启用了 Web 同步，则还需指定要通过 HTTPS 同步的信息。</span><span class="sxs-lookup"><span data-stu-id="9227a-117">Specify additional options for merge publications: subscription type; values for parameterized filtering; and information for synchronization through HTTPS if the publication is enabled for Web synchronization.</span></span>  
  
-   <span data-ttu-id="9227a-118">指定允许更新订阅的事务发布的其他选项：订阅服务器是立即在发布服务器上提交更改还是将它们写入队列、用于从订阅服务器连接到发布服务器的凭据。</span><span class="sxs-lookup"><span data-stu-id="9227a-118">Specify additional options for transactional publications that allow updating subscriptions: whether Subscribers should commit changes at the Publisher immediately or write them to a queue; credentials used to connect from the Subscriber to the Publisher.</span></span>  
  
-   <span data-ttu-id="9227a-119">还可以编写订阅的脚本（可选）。</span><span class="sxs-lookup"><span data-stu-id="9227a-119">Optionally script the subscription.</span></span>  
  
#### <a name="to-create-a-pull-subscription-from-the-publisher"></a><span data-ttu-id="9227a-120">从发布服务器创建请求订阅</span><span class="sxs-lookup"><span data-stu-id="9227a-120">To create a pull subscription from the Publisher</span></span>  
  
1.  <span data-ttu-id="9227a-121">在 [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] 中连接到发布服务器，然后展开服务器节点。</span><span class="sxs-lookup"><span data-stu-id="9227a-121">Connect to the Publisher in [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="9227a-122">展开 **“复制”** 文件夹，再展开 **“本地发布”** 文件夹。</span><span class="sxs-lookup"><span data-stu-id="9227a-122">Expand the **Replication** folder, and then expand the **Local Publications** folder.</span></span>  
  
3.  <span data-ttu-id="9227a-123">右键单击要为其创建一个或多个订阅的发布，然后单击 **“新建订阅”** 。</span><span class="sxs-lookup"><span data-stu-id="9227a-123">Right-click the publication for which you want to create one or more subscriptions, and then click **New Subscriptions**.</span></span>  
  
4.  <span data-ttu-id="9227a-124">完成新建订阅向导中的页。</span><span class="sxs-lookup"><span data-stu-id="9227a-124">Complete the pages in the New Subscription Wizard.</span></span>  
  
#### <a name="to-create-a-pull-subscription-from-the-subscriber"></a><span data-ttu-id="9227a-125">从订阅服务器创建请求订阅</span><span class="sxs-lookup"><span data-stu-id="9227a-125">To create a pull subscription from the Subscriber</span></span>  
  
1.  <span data-ttu-id="9227a-126">在 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]中连接到订阅服务器，然后展开服务器节点。</span><span class="sxs-lookup"><span data-stu-id="9227a-126">Connect to the Subscriber in [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="9227a-127">展开 **“复制”** 文件夹。</span><span class="sxs-lookup"><span data-stu-id="9227a-127">Expand the **Replication** folder.</span></span>  
  
3.  <span data-ttu-id="9227a-128">右键单击 **“本地订阅”** 文件夹，再单击 **“新建订阅”** 。</span><span class="sxs-lookup"><span data-stu-id="9227a-128">Right-click the **Local Subscriptions** folder, and then click **New Subscriptions**.</span></span>  
  
4.  <span data-ttu-id="9227a-129">在“新建订阅向导”的“发布”页上，从“发布服务器”下拉列表中选择 \<Find SQL Server Publisher> 或 \<Find Oracle Publisher>   。</span><span class="sxs-lookup"><span data-stu-id="9227a-129">On the **Publication** page of the New Subscription Wizard, select **\<Find SQL Server Publisher>** or **\<Find Oracle Publisher>** from the **Publisher** drop-down list.</span></span>  
  
5.  <span data-ttu-id="9227a-130">在 **“连接到服务器”** 对话框中连接到发布服务器。</span><span class="sxs-lookup"><span data-stu-id="9227a-130">Connect to the Publisher in the **Connect to Server** dialog box.</span></span>  
  
6.  <span data-ttu-id="9227a-131">在 **“发布”** 页上，选择一个发布。</span><span class="sxs-lookup"><span data-stu-id="9227a-131">Select a publication on the **Publication** page.</span></span>  
  
7.  <span data-ttu-id="9227a-132">完成新建订阅向导中的页。</span><span class="sxs-lookup"><span data-stu-id="9227a-132">Complete the pages in the New Subscription Wizard.</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="9227a-133">使用 Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="9227a-133">Using Transact-SQL</span></span>  
 <span data-ttu-id="9227a-134">可以使用复制存储过程以编程方式创建请求订阅。</span><span class="sxs-lookup"><span data-stu-id="9227a-134">Pull subscriptions can be created programmatically using replication stored procedures.</span></span> <span data-ttu-id="9227a-135">所用的存储过程取决于订阅所属的发布的类型。</span><span class="sxs-lookup"><span data-stu-id="9227a-135">The stored procedures used will depend on the type of publication to which the subscription belongs.</span></span>  
  
#### <a name="to-create-a-pull-subscription-to-a-snapshot-or-transactional-publication"></a><span data-ttu-id="9227a-136">创建快照或事务发布的请求订阅</span><span class="sxs-lookup"><span data-stu-id="9227a-136">To create a pull subscription to a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="9227a-137">在发布服务器上，通过执行 [sp_helppublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helppublication-transact-sql) 验证发布是否支持请求订阅。</span><span class="sxs-lookup"><span data-stu-id="9227a-137">At the Publisher, verify that the publication supports pull subscriptions by executing [sp_helppublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helppublication-transact-sql).</span></span>  
  
    -   <span data-ttu-id="9227a-138">如果结果集中 **allow_pull** 的值为 **1**，则发布支持请求订阅。</span><span class="sxs-lookup"><span data-stu-id="9227a-138">If the value of **allow_pull** in the result set is **1**, then the publication supports pull subscriptions.</span></span>  
  
    -   <span data-ttu-id="9227a-139">如果**allow_pull**的值为**0**，则执行[sp_changepublication &#40;transact-sql&#41;](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql)， **allow_pull** **@property** 并为和指定 allow_pull `true` **@value** 。</span><span class="sxs-lookup"><span data-stu-id="9227a-139">If the value of **allow_pull** is **0**, execute [sp_changepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql), specifying **allow_pull** for **@property** and `true` for **@value**.</span></span>  
  
2.  <span data-ttu-id="9227a-140">在订阅服务器上，执行 [sp_addpullsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="9227a-140">At the Subscriber, execute [sp_addpullsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-transact-sql).</span></span> <span data-ttu-id="9227a-141">指定 **@publisher** 和 **@publication** 。</span><span class="sxs-lookup"><span data-stu-id="9227a-141">Specify **@publisher** and **@publication**.</span></span> <span data-ttu-id="9227a-142">有关更新订阅的信息，请参阅 [创建事务发布的可更新订阅](publish/create-an-updatable-subscription-to-a-transactional-publication.md)。</span><span class="sxs-lookup"><span data-stu-id="9227a-142">For information about updating subscriptions, see [Create an Updatable Subscription to a Transactional Publication](publish/create-an-updatable-subscription-to-a-transactional-publication.md).</span></span>  
  
3.  <span data-ttu-id="9227a-143">在订阅服务器上，执行 [sp_addpullsubscription_agent &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="9227a-143">At the Subscriber, execute [sp_addpullsubscription_agent &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql).</span></span> <span data-ttu-id="9227a-144">指定下列各项：</span><span class="sxs-lookup"><span data-stu-id="9227a-144">Specify the following:</span></span>  
  
    -   <span data-ttu-id="9227a-145">**@publisher**、 **@publisher_db** 和 **@publication** 参数。</span><span class="sxs-lookup"><span data-stu-id="9227a-145">The **@publisher**, **@publisher_db**, and **@publication** parameters.</span></span>  
  
    -   <span data-ttu-id="9227a-146">[!INCLUDE[msCoName](../../includes/msconame-md.md)]订阅服务器上的分发代理针对和运行时所用的 Windows 凭据 **@job_login** **@job_password** 。</span><span class="sxs-lookup"><span data-stu-id="9227a-146">The [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows credentials under which the Distribution Agent at the Subscriber runs for **@job_login** and **@job_password**.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="9227a-147">使用 Windows 集成身份验证进行的连接始终使用和指定的 Windows 凭据 **@job_login** **@job_password** 。</span><span class="sxs-lookup"><span data-stu-id="9227a-147">Connections made using Windows Integrated Authentication always use the Windows credentials specified by **@job_login** and **@job_password**.</span></span> <span data-ttu-id="9227a-148">分发代理始终使用 Windows 集成身份验证与订阅服务器建立本地连接。</span><span class="sxs-lookup"><span data-stu-id="9227a-148">The Distribution Agent always makes the local connection to the Subscriber using Windows Integrated Authentication.</span></span> <span data-ttu-id="9227a-149">默认情况下，该代理将使用 Windows 集成身份验证连接到分发服务器。</span><span class="sxs-lookup"><span data-stu-id="9227a-149">By default, the agent will connect to the Distributor using Windows Integrated Authentication.</span></span>  
  
    -   <span data-ttu-id="9227a-150">（可选） **0** 指定为 **@distributor_security_mode** 值以及 [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 和 **@distributor_login** ，将 **@distributor_password**登录信息，如果需要在连接到分发服务器时使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 身份验证，请指定这些参数。</span><span class="sxs-lookup"><span data-stu-id="9227a-150">(Optional) A value of **0** for **@distributor_security_mode** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **@distributor_login** and **@distributor_password**, if you need to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Distributor.</span></span>  
  
    -   <span data-ttu-id="9227a-151">该订阅的分发代理作业计划。</span><span class="sxs-lookup"><span data-stu-id="9227a-151">A schedule for the Distribution Agent job for this subscription.</span></span> <span data-ttu-id="9227a-152">有关详细信息，请参阅 [Specify Synchronization Schedules](specify-synchronization-schedules.md)。</span><span class="sxs-lookup"><span data-stu-id="9227a-152">For more information, see [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span></span>  
  
4.  <span data-ttu-id="9227a-153">在发布服务器上，执行 [sp_addsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql) 以注册请求订阅。</span><span class="sxs-lookup"><span data-stu-id="9227a-153">At the Publisher, execute [sp_addsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql) to register the pull subscription.</span></span> <span data-ttu-id="9227a-154">指定 **@publication** 、 **@subscriber** 和 **@destination_db** 。</span><span class="sxs-lookup"><span data-stu-id="9227a-154">Specify **@publication**, **@subscriber**, and **@destination_db**.</span></span> <span data-ttu-id="9227a-155">将 **@subscription_type** 指定为 **@subscription_type**。</span><span class="sxs-lookup"><span data-stu-id="9227a-155">Specify a value of **pull** for **@subscription_type**.</span></span>  
  
#### <a name="to-create-a-pull-subscription-to-a-merge-publication"></a><span data-ttu-id="9227a-156">创建合并发布的请求订阅</span><span class="sxs-lookup"><span data-stu-id="9227a-156">To create a pull subscription to a merge publication</span></span>  
  
1.  <span data-ttu-id="9227a-157">在发布服务器上，通过执行 [sp_helpmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql) 验证发布是否支持请求订阅。</span><span class="sxs-lookup"><span data-stu-id="9227a-157">At the Publisher, verify that the publication supports pull subscriptions by executing [sp_helpmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql).</span></span>  
  
    -   <span data-ttu-id="9227a-158">如果结果集中 **allow_pull** 的值为 **1**，则发布支持请求订阅。</span><span class="sxs-lookup"><span data-stu-id="9227a-158">If the value of **allow_pull** in the result set is **1**, then the publication supports pull subscriptions.</span></span>  
  
    -   <span data-ttu-id="9227a-159">如果**allow_pull**的值为**0**，则执行[sp_changemergepublication &#40;transact-sql&#41;](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql)， **allow_pull** **@property** 并为和指定 allow_pull `true` **@value** 。</span><span class="sxs-lookup"><span data-stu-id="9227a-159">If the value of **allow_pull** is **0**, execute [sp_changemergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql), specifying **allow_pull** for **@property** and `true` for **@value**.</span></span>  
  
2.  <span data-ttu-id="9227a-160">在订阅服务器上，执行 [sp_addmergepullsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="9227a-160">At the Subscriber, execute [sp_addmergepullsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-transact-sql).</span></span> <span data-ttu-id="9227a-161">指定 **@publisher** 、 **@publisher_db** 、 **@publication** 和以下参数：</span><span class="sxs-lookup"><span data-stu-id="9227a-161">Specify **@publisher**, **@publisher_db**, **@publication**, and the following parameters:</span></span>  
  
    -   <span data-ttu-id="9227a-162">**@subscriber_type**-为客户端订阅指定**local** ，对于服务器订阅指定**global** 。</span><span class="sxs-lookup"><span data-stu-id="9227a-162">**@subscriber_type** - specify **local** for a client subscription and **global** for a server subscription.</span></span>  
  
    -   <span data-ttu-id="9227a-163">**@subscription_priority**-指定订阅 (**0.00**到**99.99**) 的优先级。</span><span class="sxs-lookup"><span data-stu-id="9227a-163">**@subscription_priority** - Specify a priority for the subscription (**0.00** to **99.99**).</span></span> <span data-ttu-id="9227a-164">只有服务器订阅要求指定优先级。</span><span class="sxs-lookup"><span data-stu-id="9227a-164">This is only required for a server subscription.</span></span>  
  
         <span data-ttu-id="9227a-165">有关详细信息，请参阅 [高级合并复制冲突的检测和解决](merge/advanced-merge-replication-conflict-detection-and-resolution.md)。</span><span class="sxs-lookup"><span data-stu-id="9227a-165">For more information, see [Advanced Merge Replication Conflict Detection and Resolution](merge/advanced-merge-replication-conflict-detection-and-resolution.md).</span></span>  
  
3.  <span data-ttu-id="9227a-166">在订阅服务器上，执行 [sp_addmergepullsubscription_agent &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="9227a-166">At the Subscriber, execute [sp_addmergepullsubscription_agent &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql).</span></span> <span data-ttu-id="9227a-167">指定下列参数：</span><span class="sxs-lookup"><span data-stu-id="9227a-167">Specify the following parameters:</span></span>  
  
    -   <span data-ttu-id="9227a-168">**@publisher**、 **@publisher_db** 和 **@publication** 。</span><span class="sxs-lookup"><span data-stu-id="9227a-168">**@publisher**, **@publisher_db**, and **@publication**.</span></span>  
  
    -   <span data-ttu-id="9227a-169">订阅服务器上的合并代理针对和运行时所用的 Windows 凭据 **@job_login** **@job_password** 。</span><span class="sxs-lookup"><span data-stu-id="9227a-169">The Windows credentials under which the Merge Agent at the Subscriber runs for **@job_login** and **@job_password**.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="9227a-170">使用 Windows 集成身份验证进行的连接始终使用和指定的 Windows 凭据 **@job_login** **@job_password** 。</span><span class="sxs-lookup"><span data-stu-id="9227a-170">Connections made using Windows Integrated Authentication always use the Windows credentials specified by **@job_login** and **@job_password**.</span></span> <span data-ttu-id="9227a-171">合并代理始终使用 Windows 集成身份验证与订阅服务器进行本地连接。</span><span class="sxs-lookup"><span data-stu-id="9227a-171">The Merge Agent always makes the local connection to the Subscriber using Windows Integrated Authentication.</span></span> <span data-ttu-id="9227a-172">默认情况下，该代理将使用 Windows 集成身份验证连接到分发服务器和发布服务器。</span><span class="sxs-lookup"><span data-stu-id="9227a-172">By default, the agent will connect to the Distributor and Publisher using Windows Integrated Authentication.</span></span>  
  
    -   <span data-ttu-id="9227a-173">（可选） **0** 指定为 **@distributor_security_mode** 值以及 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 和 **@distributor_login** ，将 **@distributor_password**登录信息，如果需要在连接到分发服务器时使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 身份验证，请指定这些参数。</span><span class="sxs-lookup"><span data-stu-id="9227a-173">(Optional) A value of **0** for **@distributor_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **@distributor_login** and **@distributor_password**, if you need to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Distributor.</span></span>  
  
    -   <span data-ttu-id="9227a-174">（可选） **0** 指定为 **@publisher_security_mode** 值以及 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 和 **@publisher_login** ，将 **@publisher_password**登录信息，如果需要在连接到分发服务器时使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 身份验证，请指定这些参数。</span><span class="sxs-lookup"><span data-stu-id="9227a-174">(Optional) A value of **0** for **@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **@publisher_login** and **@publisher_password**, if you need to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher.</span></span>  
  
    -   <span data-ttu-id="9227a-175">该订阅的合并代理作业计划。</span><span class="sxs-lookup"><span data-stu-id="9227a-175">A schedule for the Merge Agent job for this subscription.</span></span> <span data-ttu-id="9227a-176">有关详细信息，请参阅 [创建事务发布的可更新订阅](publish/create-an-updatable-subscription-to-a-transactional-publication.md)。</span><span class="sxs-lookup"><span data-stu-id="9227a-176">For more information, see [Create an Updatable Subscription to a Transactional Publication](publish/create-an-updatable-subscription-to-a-transactional-publication.md).</span></span>  
  
4.  <span data-ttu-id="9227a-177">在发布服务器上，执行 [sp_addmergesubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="9227a-177">At the Publisher, execute [sp_addmergesubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql).</span></span> <span data-ttu-id="9227a-178">指定 **@publication** 、 **@subscriber** 、 **@subscriber_db** 和**的**值 **@subscription_type** 。</span><span class="sxs-lookup"><span data-stu-id="9227a-178">Specify **@publication**, **@subscriber**, **@subscriber_db**, and a value of **pull** for **@subscription_type**.</span></span> <span data-ttu-id="9227a-179">这样便可注册请求订阅。</span><span class="sxs-lookup"><span data-stu-id="9227a-179">This registers the pull subscription.</span></span>  
  
###  <a name="examples-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="9227a-180">示例 (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="9227a-180">Examples (Transact-SQL)</span></span>  
 <span data-ttu-id="9227a-181">以下示例创建事务发布的请求订阅。</span><span class="sxs-lookup"><span data-stu-id="9227a-181">The following example creates a pull subscription to a transactional publication.</span></span> <span data-ttu-id="9227a-182">第一个批处理在订阅服务器中执行，第二个批处理在发布服务器中执行。</span><span class="sxs-lookup"><span data-stu-id="9227a-182">The first batch is executed at the Subscriber, and the second batch is executed at the Publisher.</span></span> <span data-ttu-id="9227a-183">登录名和密码在运行时使用 sqlcmd 脚本变量进行提供。</span><span class="sxs-lookup"><span data-stu-id="9227a-183">Login and password values are supplied at runtime using sqlcmd scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_addtranpullsubscriptionagent](../../snippets/tsql/SQL15/replication/howto/tsql/createtranpullsub.sql#sp_addtranpullsubscriptionagent)]  
  
 [!code-sql[HowTo#sp_addtranpullsubscription](../../snippets/tsql/SQL15/replication/howto/tsql/createtranpullsub.sql#sp_addtranpullsubscription)]  
  
 <span data-ttu-id="9227a-184">以下示例创建合并发布的请求订阅。</span><span class="sxs-lookup"><span data-stu-id="9227a-184">The following example creates a pull subscription to a merge publication.</span></span> <span data-ttu-id="9227a-185">第一个批处理在订阅服务器中执行，第二个批处理在发布服务器中执行。</span><span class="sxs-lookup"><span data-stu-id="9227a-185">The first batch is executed at the Subscriber, and the second batch is executed at the Publisher.</span></span> <span data-ttu-id="9227a-186">在运行时使用 **sqlcmd** 脚本变量提供登录名和密码值。</span><span class="sxs-lookup"><span data-stu-id="9227a-186">Login and password values are supplied at runtime using **sqlcmd** scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_addmergepullsubscriptionagent](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepullsub.sql#sp_addmergepullsubscriptionagent)]  
  
 [!code-sql[HowTo#sp_addmergepullsubscription](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepullsub.sql#sp_addmergepullsubscription)]  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="9227a-187">使用复制管理对象 (RMO)</span><span class="sxs-lookup"><span data-stu-id="9227a-187">Using Replication Management Objects (RMO)</span></span>  
 <span data-ttu-id="9227a-188">用于创建请求订阅的 RMO 类取决于订阅所属的发布的类型。</span><span class="sxs-lookup"><span data-stu-id="9227a-188">The RMO classes used to create a pull subscription depend on the type of publication to which the subscription belongs.</span></span>  
  
#### <a name="to-create-a-pull-subscription-to-a-snapshot-or-transactional-publication"></a><span data-ttu-id="9227a-189">创建快照或事务发布的请求订阅</span><span class="sxs-lookup"><span data-stu-id="9227a-189">To create a pull subscription to a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="9227a-190">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 类创建与订阅服务器和发布服务器的连接。</span><span class="sxs-lookup"><span data-stu-id="9227a-190">Create connections to both the Subscriber and Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> Class.</span></span>  
  
2.  <span data-ttu-id="9227a-191">使用步骤 1 中的发布服务器连接，创建 <xref:Microsoft.SqlServer.Replication.TransPublication> 类的实例。</span><span class="sxs-lookup"><span data-stu-id="9227a-191">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransPublication> class by using the Publisher connection from step 1.</span></span> <span data-ttu-id="9227a-192">指定 <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>、 <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> 和 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>。</span><span class="sxs-lookup"><span data-stu-id="9227a-192">Specify <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>, <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> and <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
3.  <span data-ttu-id="9227a-193">调用 <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="9227a-193">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="9227a-194">如果该方法返回 `false`，则表示步骤 2 中指定的属性不正确，或者服务器中不存在发布。</span><span class="sxs-lookup"><span data-stu-id="9227a-194">If this method returns `false`, either the properties specified in step 2 are incorrect or the publication does not exist on the server.</span></span>  
  
4.  <span data-ttu-id="9227a-195">在 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> 属性和 <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull> 之间执行逻辑位与（在 Visual C# 中为 `&`，在 Visual Basic 中为 `And`）运算。</span><span class="sxs-lookup"><span data-stu-id="9227a-195">Perform a bitwise logical AND (`&` in Visual C# and `And` in Visual Basic) between the <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> property and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull>.</span></span> <span data-ttu-id="9227a-196">如果结果为 <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>，则将 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> 设置为 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> 和 <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull> 之间的逻辑位或（在 Visual C# 中为 `|`，在 Visual Basic 为 `Or`）的结果。</span><span class="sxs-lookup"><span data-stu-id="9227a-196">If the result is <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>, set <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> to the result of a bitwise logical OR (`|` in Visual C# and `Or` in Visual Basic) between <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull>.</span></span> <span data-ttu-id="9227a-197">然后，调用 <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> 以启用请求订阅。</span><span class="sxs-lookup"><span data-stu-id="9227a-197">Then, call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> to enable pull subscriptions.</span></span>  
  
5.  <span data-ttu-id="9227a-198">如果订阅数据库不存在，则使用 <xref:Microsoft.SqlServer.Management.Smo.Database> 类创建该数据库。</span><span class="sxs-lookup"><span data-stu-id="9227a-198">If the subscription database does not exist, create it by using the <xref:Microsoft.SqlServer.Management.Smo.Database> class.</span></span> <span data-ttu-id="9227a-199">有关详细信息，请参阅[创建、更改和删除数据库](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md)。</span><span class="sxs-lookup"><span data-stu-id="9227a-199">For more information, see [Creating, Altering, and Removing Databases](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md).</span></span>  
  
6.  <span data-ttu-id="9227a-200">创建的 <xref:Microsoft.SqlServer.Replication.TransPullSubscription> 类的实例。</span><span class="sxs-lookup"><span data-stu-id="9227a-200">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransPullSubscription> class.</span></span>  
  
7.  <span data-ttu-id="9227a-201">设置下列订阅属性：</span><span class="sxs-lookup"><span data-stu-id="9227a-201">Set the following subscription properties:</span></span>  
  
    -   <span data-ttu-id="9227a-202">在步骤 1 中为 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 创建的订阅服务器的 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>。</span><span class="sxs-lookup"><span data-stu-id="9227a-202">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> to the Subscriber created in step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="9227a-203">用于 <xref:Microsoft.SqlServer.Replication.PullSubscription.DatabaseName%2A>的订阅数据库的名称。</span><span class="sxs-lookup"><span data-stu-id="9227a-203">Name of the subscription database for <xref:Microsoft.SqlServer.Replication.PullSubscription.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="9227a-204">用于 <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherName%2A>的发布服务器的名称。</span><span class="sxs-lookup"><span data-stu-id="9227a-204">Name of the Publisher for <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherName%2A>.</span></span>  
  
    -   <span data-ttu-id="9227a-205">用于 <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationDBName%2A>的发布数据库的名称。</span><span class="sxs-lookup"><span data-stu-id="9227a-205">Name of the publication database for <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationDBName%2A>.</span></span>  
  
    -   <span data-ttu-id="9227a-206">用于 <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationName%2A>的发布的名称。</span><span class="sxs-lookup"><span data-stu-id="9227a-206">Name of the publication for <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationName%2A>.</span></span>  
  
    -   <span data-ttu-id="9227a-207"><xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> 的 <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> 和 <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> 或 <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A> 字段，用于提供分发代理在订阅服务器中运行时所使用的 [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows 帐户凭据。</span><span class="sxs-lookup"><span data-stu-id="9227a-207">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> or <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> fields of <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account under which the Distribution Agent runs at the Subscriber.</span></span> <span data-ttu-id="9227a-208">该帐户用于与订阅服务器进行本地连接，同时还用于使用 Windows 身份验证进行远程连接。</span><span class="sxs-lookup"><span data-stu-id="9227a-208">This account is used to make local connections to the Subscriber and to make remote connections using Windows Authentication.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="9227a-209">当 `sysadmin` 固定服务器角色的成员创建订阅时，不需要设置 <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A>，尽管建议这样做。</span><span class="sxs-lookup"><span data-stu-id="9227a-209">Setting <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A> is not required when the subscription is created by a member of the `sysadmin` fixed server role, however it is recommended.</span></span> <span data-ttu-id="9227a-210">在这种情况下，代理会模拟 SQL Server Agent 帐户。</span><span class="sxs-lookup"><span data-stu-id="9227a-210">In this case, the agent will impersonate the SQL Server Agent account.</span></span> <span data-ttu-id="9227a-211">有关详细信息，请参阅 [复制代理安全模式](security/replication-agent-security-model.md)。</span><span class="sxs-lookup"><span data-stu-id="9227a-211">For more information, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
    -   <span data-ttu-id="9227a-212">（可选）<xref:Microsoft.SqlServer.Replication.PullSubscription.CreateSyncAgentByDefault%2A> 的 `true` 值，用于创建用来同步订阅的代理作业。</span><span class="sxs-lookup"><span data-stu-id="9227a-212">(Optional) A value of `true` for <xref:Microsoft.SqlServer.Replication.PullSubscription.CreateSyncAgentByDefault%2A> to create an agent job that is used to synchronize the subscription.</span></span> <span data-ttu-id="9227a-213">如果您指定了 `false`（默认值），则只能以编程的方式同步订阅，如果您通过 <xref:Microsoft.SqlServer.Replication.TransSynchronizationAgent> 属性访问该对象，则必须指定 <xref:Microsoft.SqlServer.Replication.TransPullSubscription.SynchronizationAgent%2A> 的其他属性。</span><span class="sxs-lookup"><span data-stu-id="9227a-213">If you specify `false` (the default), the subscription can only be synchronized programmatically and you must specify additional properties of <xref:Microsoft.SqlServer.Replication.TransSynchronizationAgent> when you access this object from the <xref:Microsoft.SqlServer.Replication.TransPullSubscription.SynchronizationAgent%2A> property.</span></span> <span data-ttu-id="9227a-214">有关详细信息，请参阅 [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="9227a-214">For more information, see [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md).</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="9227a-215">并不是所有版本的 [!INCLUDE[msCoName](../../includes/msconame-md.md)][!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 都提供 SQL Server 代理。</span><span class="sxs-lookup"><span data-stu-id="9227a-215">SQL Server Agent is not available in every edition of [!INCLUDE[msCoName](../../includes/msconame-md.md)][!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="9227a-216">有关各个版本支持的功能列表 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ，请参阅 SQL Server 2014 的各个[版本支持的功能](../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md)。</span><span class="sxs-lookup"><span data-stu-id="9227a-216">For a list of features that are supported by the editions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], see [Features Supported by the Editions of SQL Server 2014](../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md).</span></span> <span data-ttu-id="9227a-217">当您将 Express Edition 订阅服务器的值指定为 `true` 时，便不会创建代理作业。</span><span class="sxs-lookup"><span data-stu-id="9227a-217">When you specify a value of `true` for Express Subscribers, the agent job is not created.</span></span> <span data-ttu-id="9227a-218">但是，与订阅相关的重要元数据存储在订阅服务器中。</span><span class="sxs-lookup"><span data-stu-id="9227a-218">However, important subscription-related metadata is stored at the Subscriber.</span></span>  
  
    -   <span data-ttu-id="9227a-219">（可选）在使用 SQL Server 身份验证连接到分发服务器时设置 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> 的 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> 和 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> 或 <xref:Microsoft.SqlServer.Replication.PullSubscription.DistributorSecurity%2A> 字段。</span><span class="sxs-lookup"><span data-stu-id="9227a-219">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.PullSubscription.DistributorSecurity%2A> when using SQL Server Authentication to connect to the Distributor.</span></span>  
  
8.  <span data-ttu-id="9227a-220">调用 <xref:Microsoft.SqlServer.Replication.PullSubscription.Create%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="9227a-220">Call the <xref:Microsoft.SqlServer.Replication.PullSubscription.Create%2A> method.</span></span>  
  
9. <span data-ttu-id="9227a-221">使用步骤 2 中的 <xref:Microsoft.SqlServer.Replication.TransPublication> 类的实例调用 <xref:Microsoft.SqlServer.Replication.TransPublication.MakePullSubscriptionWellKnown%2A> 方法以向发布服务器注册请求订阅。</span><span class="sxs-lookup"><span data-stu-id="9227a-221">Using the instance of the <xref:Microsoft.SqlServer.Replication.TransPublication> class from step 2, call the <xref:Microsoft.SqlServer.Replication.TransPublication.MakePullSubscriptionWellKnown%2A> method to register the pull subscription with the Publisher.</span></span> <span data-ttu-id="9227a-222">如果此注册已经存在，则会发生异常。</span><span class="sxs-lookup"><span data-stu-id="9227a-222">If this registration already exists, an exception occurs.</span></span>  
  
#### <a name="to-create-a-pull-subscription-to-a-merge-publication"></a><span data-ttu-id="9227a-223">创建合并发布的请求订阅</span><span class="sxs-lookup"><span data-stu-id="9227a-223">To create a pull subscription to a merge publication</span></span>  
  
1.  <span data-ttu-id="9227a-224">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 类创建与订阅服务器和发布服务器的连接。</span><span class="sxs-lookup"><span data-stu-id="9227a-224">Create connections to both the Subscriber and Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="9227a-225">使用步骤 1 中的发布服务器连接，创建 <xref:Microsoft.SqlServer.Replication.MergePublication> 类的实例。</span><span class="sxs-lookup"><span data-stu-id="9227a-225">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class by using the Publisher connection from step 1.</span></span> <span data-ttu-id="9227a-226">指定 <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>、 <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>和 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>。</span><span class="sxs-lookup"><span data-stu-id="9227a-226">Specify <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>, <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>, and <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
3.  <span data-ttu-id="9227a-227">调用 <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="9227a-227">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="9227a-228">如果该方法返回 `false`，则表示步骤 2 中指定的属性不正确，或者服务器中不存在发布。</span><span class="sxs-lookup"><span data-stu-id="9227a-228">If this method returns `false`, either the properties specified in step 2 are incorrect or the publication does not exist on the server.</span></span>  
  
4.  <span data-ttu-id="9227a-229">在 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> 属性和 <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull> 之间执行逻辑位与（在 Visual C# 中为 `&`，在 Visual Basic 中为 `And`）运算。</span><span class="sxs-lookup"><span data-stu-id="9227a-229">Perform a bitwise logical AND (`&` in Visual C# and `And` in Visual Basic) between the <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> property and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull>.</span></span> <span data-ttu-id="9227a-230">如果结果为 <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>，则将 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> 设置为 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> 和 <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull> 之间的逻辑位或（在 Visual C# 中为 `|`，在 Visual Basic 为 `Or`）的结果。</span><span class="sxs-lookup"><span data-stu-id="9227a-230">If the result is <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>, set <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> to the result of a bitwise logical OR (`|` in Visual C# and `Or` in Visual Basic) between <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull>.</span></span> <span data-ttu-id="9227a-231">然后，调用 <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> 以启用请求订阅。</span><span class="sxs-lookup"><span data-stu-id="9227a-231">Then, call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> to enable pull subscriptions.</span></span>  
  
5.  <span data-ttu-id="9227a-232">如果订阅数据库不存在，则使用 <xref:Microsoft.SqlServer.Management.Smo.Database> 类创建该数据库。</span><span class="sxs-lookup"><span data-stu-id="9227a-232">If the subscription database does not exist, create it by using the <xref:Microsoft.SqlServer.Management.Smo.Database> class.</span></span> <span data-ttu-id="9227a-233">有关详细信息，请参阅[创建、更改和删除数据库](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md)。</span><span class="sxs-lookup"><span data-stu-id="9227a-233">For more information, see [Creating, Altering, and Removing Databases](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md).</span></span>  
  
6.  <span data-ttu-id="9227a-234">创建的 <xref:Microsoft.SqlServer.Replication.MergePullSubscription> 类的实例。</span><span class="sxs-lookup"><span data-stu-id="9227a-234">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePullSubscription> class.</span></span>  
  
7.  <span data-ttu-id="9227a-235">设置下列订阅属性：</span><span class="sxs-lookup"><span data-stu-id="9227a-235">Set the following subscription properties:</span></span>  
  
    -   <span data-ttu-id="9227a-236">在步骤 1 中为 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 创建的订阅服务器的 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>。</span><span class="sxs-lookup"><span data-stu-id="9227a-236">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> to the Subscriber created in step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="9227a-237">用于 <xref:Microsoft.SqlServer.Replication.PullSubscription.DatabaseName%2A>的订阅数据库的名称。</span><span class="sxs-lookup"><span data-stu-id="9227a-237">Name of the subscription database for <xref:Microsoft.SqlServer.Replication.PullSubscription.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="9227a-238">用于 <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherName%2A>的发布服务器的名称。</span><span class="sxs-lookup"><span data-stu-id="9227a-238">Name of the Publisher for <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherName%2A>.</span></span>  
  
    -   <span data-ttu-id="9227a-239">用于 <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationDBName%2A>的发布数据库的名称。</span><span class="sxs-lookup"><span data-stu-id="9227a-239">Name of the publication database for <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationDBName%2A>.</span></span>  
  
    -   <span data-ttu-id="9227a-240">用于 <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationName%2A>的发布的名称。</span><span class="sxs-lookup"><span data-stu-id="9227a-240">Name of the publication for <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationName%2A>.</span></span>  
  
    -   <span data-ttu-id="9227a-241"><xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> 的 <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> 和 <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> 或 <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A> 字段，用于提供合并代理在订阅服务器中运行时所使用的 [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows 帐户的凭据。</span><span class="sxs-lookup"><span data-stu-id="9227a-241">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> or <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> fields of <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account under which the Merge Agent runs at the Subscriber.</span></span> <span data-ttu-id="9227a-242">该帐户用于与订阅服务器进行本地连接，同时还用于使用 Windows 身份验证进行远程连接。</span><span class="sxs-lookup"><span data-stu-id="9227a-242">This account is used to make local connections to the Subscriber and to make remote connections using Windows Authentication.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="9227a-243">当 `sysadmin` 固定服务器角色的成员创建订阅时，不需要设置 <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A>，尽管建议这样做。</span><span class="sxs-lookup"><span data-stu-id="9227a-243">Setting <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A> is not required when the subscription is created by a member of the `sysadmin` fixed server role, however it is recommended.</span></span> <span data-ttu-id="9227a-244">在这种情况下，代理会模拟 SQL Server Agent 帐户。</span><span class="sxs-lookup"><span data-stu-id="9227a-244">In this case, the agent will impersonate the SQL Server Agent account.</span></span> <span data-ttu-id="9227a-245">有关详细信息，请参阅 [复制代理安全模式](security/replication-agent-security-model.md)。</span><span class="sxs-lookup"><span data-stu-id="9227a-245">For more information, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
    -   <span data-ttu-id="9227a-246">（可选）<xref:Microsoft.SqlServer.Replication.PullSubscription.CreateSyncAgentByDefault%2A> 的 `true` 值，用于创建用来同步订阅的代理作业。</span><span class="sxs-lookup"><span data-stu-id="9227a-246">(Optional) A value of `true` for <xref:Microsoft.SqlServer.Replication.PullSubscription.CreateSyncAgentByDefault%2A> to create an agent job that is used to synchronize the subscription.</span></span> <span data-ttu-id="9227a-247">如果您指定了 `false`（默认值），则只能以编程的方式同步订阅，如果您通过 <xref:Microsoft.SqlServer.Replication.MergeSynchronizationAgent> 属性访问该对象，则必须指定 <xref:Microsoft.SqlServer.Replication.MergePullSubscription.SynchronizationAgent%2A> 的其他属性。</span><span class="sxs-lookup"><span data-stu-id="9227a-247">If you specify `false` (the default), the subscription can only be synchronized programmatically and you must specify additional properties of <xref:Microsoft.SqlServer.Replication.MergeSynchronizationAgent> when you access this object from the <xref:Microsoft.SqlServer.Replication.MergePullSubscription.SynchronizationAgent%2A> property.</span></span> <span data-ttu-id="9227a-248">有关详细信息，请参阅 [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="9227a-248">For more information, see [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md).</span></span>  
  
    -   <span data-ttu-id="9227a-249">（可选）在使用 SQL Server 身份验证连接到分发服务器时设置 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> 的 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> 和 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> 或 <xref:Microsoft.SqlServer.Replication.PullSubscription.DistributorSecurity%2A> 字段。</span><span class="sxs-lookup"><span data-stu-id="9227a-249">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.PullSubscription.DistributorSecurity%2A> when using SQL Server Authentication to connect to the Distributor.</span></span>  
  
    -   <span data-ttu-id="9227a-250">（可选）在使用 SQL Server 身份验证连接到发布服务器时设置 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> 的 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> 和 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> 或 <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherSecurity%2A> 字段。</span><span class="sxs-lookup"><span data-stu-id="9227a-250">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherSecurity%2A> when using SQL Server Authentication to connect to the Publisher.</span></span>  
  
8.  <span data-ttu-id="9227a-251">调用 <xref:Microsoft.SqlServer.Replication.PullSubscription.Create%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="9227a-251">Call the <xref:Microsoft.SqlServer.Replication.PullSubscription.Create%2A> method.</span></span>  
  
9. <span data-ttu-id="9227a-252">使用步骤 2 中的 <xref:Microsoft.SqlServer.Replication.MergePublication> 类的实例调用 <xref:Microsoft.SqlServer.Replication.MergePublication.MakePullSubscriptionWellKnown%2A> 方法以向发布服务器注册请求订阅。</span><span class="sxs-lookup"><span data-stu-id="9227a-252">Using the instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class from step 2, call the <xref:Microsoft.SqlServer.Replication.MergePublication.MakePullSubscriptionWellKnown%2A> method to register the pull subscription with the Publisher.</span></span> <span data-ttu-id="9227a-253">如果此注册已经存在，则会发生异常。</span><span class="sxs-lookup"><span data-stu-id="9227a-253">If this registration already exists, an exception occurs.</span></span>  
  
###  <a name="example-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="9227a-254">示例 (RMO)</span><span class="sxs-lookup"><span data-stu-id="9227a-254">Example (RMO)</span></span>  
 <span data-ttu-id="9227a-255">该示例创建事务发布的请求订阅。</span><span class="sxs-lookup"><span data-stu-id="9227a-255">This example creates a pull subscription to a transactional publication.</span></span> <span data-ttu-id="9227a-256">用于创建分发代理作业的 [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows 帐户凭据在运行时通过。</span><span class="sxs-lookup"><span data-stu-id="9227a-256">The [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account credentials used to create the Distribution Agent job are passed at runtime.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateTranPullSub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createtranpullsub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateTranPullSub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createtranpullsub)]  
  
 <span data-ttu-id="9227a-257">该示例创建合并发布的请求订阅。</span><span class="sxs-lookup"><span data-stu-id="9227a-257">This example creates a pull subscription to a merge publication.</span></span> <span data-ttu-id="9227a-258">用于创建合并代理作业的 Windows 帐户凭据在运行时通过。</span><span class="sxs-lookup"><span data-stu-id="9227a-258">The Windows account credentials used to create the Merge Agent job are passed at runtime.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePullSub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepullsub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePullSub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepullsub)]  
  
 <span data-ttu-id="9227a-259">该示例不在 [MSsubscription_properties](/sql/relational-databases/system-tables/mssubscription-properties-transact-sql)中创建关联的代理作业和订阅元数据，而直接创建合并发布的请求订阅。</span><span class="sxs-lookup"><span data-stu-id="9227a-259">This example creates a pull subscription to a merge publication without creating an associated agent job and subscription metadata in [MSsubscription_properties](/sql/relational-databases/system-tables/mssubscription-properties-transact-sql).</span></span> <span data-ttu-id="9227a-260">用于创建合并代理作业的 Windows 帐户凭据在运行时通过。</span><span class="sxs-lookup"><span data-stu-id="9227a-260">The Windows account credentials used to create the Merge Agent job are passed at runtime.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePullSub_NoJob](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepullsub_nojob)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePullSub_NoJob](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepullsub_nojob)]  
  
 <span data-ttu-id="9227a-261">该示例创建可使用 Web 同步通过 Internet 进行同步的合并发布的请求订阅。</span><span class="sxs-lookup"><span data-stu-id="9227a-261">This example creates a pull subscription to a merge publication that can be synchronized over the Internet using Web synchronization.</span></span> <span data-ttu-id="9227a-262">用于创建合并代理作业的 Windows 帐户凭据在运行时通过。</span><span class="sxs-lookup"><span data-stu-id="9227a-262">The Windows account credentials used to create the Merge Agent job are passed at runtime.</span></span> <span data-ttu-id="9227a-263">有关详细信息，请参阅 [Configure Web Synchronization](configure-web-synchronization.md)。</span><span class="sxs-lookup"><span data-stu-id="9227a-263">For more information, see [Configure Web Synchronization](configure-web-synchronization.md).</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePullSub_WebSync](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepullsub_websync)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePullSub_WebSync](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepullsub_websync)]  
  
## <a name="see-also"></a><span data-ttu-id="9227a-264">另请参阅</span><span class="sxs-lookup"><span data-stu-id="9227a-264">See Also</span></span>  
 <span data-ttu-id="9227a-265">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="9227a-265">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span></span>  
 <span data-ttu-id="9227a-266">[查看和修改请求订阅属性](view-and-modify-pull-subscription-properties.md) </span><span class="sxs-lookup"><span data-stu-id="9227a-266">[View and Modify Pull Subscription Properties](view-and-modify-pull-subscription-properties.md) </span></span>  
 <span data-ttu-id="9227a-267">[Configure Web Synchronization](configure-web-synchronization.md) </span><span class="sxs-lookup"><span data-stu-id="9227a-267">[Configure Web Synchronization](configure-web-synchronization.md) </span></span>  
 <span data-ttu-id="9227a-268">[Subscribe to Publications](subscribe-to-publications.md) </span><span class="sxs-lookup"><span data-stu-id="9227a-268">[Subscribe to Publications](subscribe-to-publications.md) </span></span>  
 [<span data-ttu-id="9227a-269">复制安全最佳做法</span><span class="sxs-lookup"><span data-stu-id="9227a-269">Replication Security Best Practices</span></span>](security/replication-security-best-practices.md)  
  
  
