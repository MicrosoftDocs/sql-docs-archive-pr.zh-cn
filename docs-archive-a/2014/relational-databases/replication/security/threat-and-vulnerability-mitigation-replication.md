---
title: 威胁和漏洞缓解（复制）| Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- attacks [SQL Server replication]
- threats [SQL Server replication security]
- security [SQL Server replication], threats
- security threats [SQL Server replication]
ms.assetid: 314fe497-56d8-4192-98e9-21b87cf8db04
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: c1a9c2c646f26d0cb61ae3d41ccdbd72551094d4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87691643"
---
# <a name="threat-and-vulnerability-mitigation-replication"></a><span data-ttu-id="e60f1-102">威胁和漏洞缓解（复制）</span><span class="sxs-lookup"><span data-stu-id="e60f1-102">Threat and Vulnerability Mitigation (Replication)</span></span>
  <span data-ttu-id="e60f1-103">本主题介绍减少复制拓扑所面临威胁的技术。</span><span class="sxs-lookup"><span data-stu-id="e60f1-103">This topic describes techniques to reduce threats to a replication topology.</span></span>  
  
## <a name="encryption"></a><span data-ttu-id="e60f1-104">加密</span><span class="sxs-lookup"><span data-stu-id="e60f1-104">Encryption</span></span>  
 <span data-ttu-id="e60f1-105">加密是把数据转换成没有特殊密钥就不能读取、而只有特定的接收者能够读取的数据格式的过程。</span><span class="sxs-lookup"><span data-stu-id="e60f1-105">Encryption is the process of converting data into a form that cannot be read without a special key, so that only the intended recipient can read the data.</span></span> <span data-ttu-id="e60f1-106">复制并不加密存储在表中或通过网络连接发送的数据。</span><span class="sxs-lookup"><span data-stu-id="e60f1-106">Replication does not encrypt data stored in tables or sent over network connections.</span></span> <span data-ttu-id="e60f1-107">这是有意设计的，因为在传输层有多种加密技术可以使用，其中包括下列行业标准技术：虚拟专用网络 (VPN)、安全套接字层 (SSL) 和 IP 安全 (IPSEC)。</span><span class="sxs-lookup"><span data-stu-id="e60f1-107">This is by design, because encryption is available at the transport level with a number of technologies, including the following industry standard technologies: Virtual Private Networks (VPN), Secure Sockets Layer (SSL), and IP Security (IPSEC).</span></span> <span data-ttu-id="e60f1-108">建议对复制拓扑中各计算机之间的连接，使用这些加密方法之一。</span><span class="sxs-lookup"><span data-stu-id="e60f1-108">We recommend using one of these encryption methods for the connections between computers in a replication topology.</span></span> <span data-ttu-id="e60f1-109">有关详细信息，请参阅[启用数据库引擎的加密连接（SQL Server 配置管理器）](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="e60f1-109">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span> <span data-ttu-id="e60f1-110">有关使用 VPN 和 SSL 在 Internet 上复制数据的信息，请参阅 [Securing Replication Over the Internet](securing-replication-over-the-internet.md)。</span><span class="sxs-lookup"><span data-stu-id="e60f1-110">For information about using VPN and SSL for replicating data over the Internet, see [Securing Replication Over the Internet](securing-replication-over-the-internet.md).</span></span>  
  
 <span data-ttu-id="e60f1-111">如果使用 SSL 来确保复制拓扑中计算机间的连接安全，请为每个复制代理的 **-EncryptionLevel** 参数指定值 **1** 或 **2** （建议指定值 **2** ）。</span><span class="sxs-lookup"><span data-stu-id="e60f1-111">If you use SSL to secure the connections between computers in a replication topology, specify a value of **1** or **2** for the **-EncryptionLevel** parameter of each replication agent (a value of **2** is recommended).</span></span> <span data-ttu-id="e60f1-112">值 **1** 指定使用加密，但是代理不验证 SSL 服务器证书是否由可信颁发者签名；值 **2** 指定证书要经过验证。</span><span class="sxs-lookup"><span data-stu-id="e60f1-112">A value of **1** specifies that encryption is used, but the agent does not verify that the SSL server certificate is signed by a trusted issuer; a value of **2** specifies that the certificate is verified.</span></span> <span data-ttu-id="e60f1-113">代理参数可以在代理配置文件和命令行中指定。</span><span class="sxs-lookup"><span data-stu-id="e60f1-113">Agent parameters can be specified in agent profiles and on the command line.</span></span> <span data-ttu-id="e60f1-114">有关详细信息，请参阅：</span><span class="sxs-lookup"><span data-stu-id="e60f1-114">For more information, see:</span></span>  
  
-   [<span data-ttu-id="e60f1-115">处理复制代理配置文件</span><span class="sxs-lookup"><span data-stu-id="e60f1-115">Work with Replication Agent Profiles</span></span>](../agents/replication-agent-profiles.md)  
  
-   [<span data-ttu-id="e60f1-116">查看和修改复制代理命令提示符参数 (SQL Server Management Studio)</span><span class="sxs-lookup"><span data-stu-id="e60f1-116">View and Modify Replication Agent Command Prompt Parameters &#40;SQL Server Management Studio&#41;</span></span>](../agents/view-and-modify-replication-agent-command-prompt-parameters.md)  
  
-   [<span data-ttu-id="e60f1-117">Replication Agent Executables Concepts</span><span class="sxs-lookup"><span data-stu-id="e60f1-117">Replication Agent Executables Concepts</span></span>](../concepts/replication-agent-executables-concepts.md)  
  
 <span data-ttu-id="e60f1-118">就数据库主密钥（用于加密数据）而言，复制具有以下行为：</span><span class="sxs-lookup"><span data-stu-id="e60f1-118">Replication has the following behavior with respect to database Master Keys, which are used to encrypt data:</span></span>  
  
-   <span data-ttu-id="e60f1-119">如果复制所涉及的数据库（发布数据库、订阅数据库或分发数据库）中有主密钥，则复制使用 [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)] 数据库对称密钥对该数据库中的代理密码进行加密和解密。</span><span class="sxs-lookup"><span data-stu-id="e60f1-119">If a Master Key is present in a database involved in replication (a publication database, subscription database, or distribution database), replication encrypts and decrypts agent passwords in that database using a [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)] database symmetric key.</span></span> <span data-ttu-id="e60f1-120">如果使用主密钥，则应在复制所涉及的每个数据库中都创建主密钥。</span><span class="sxs-lookup"><span data-stu-id="e60f1-120">If Master Keys are used, a Master Key should be created in each database involved in replication.</span></span> <span data-ttu-id="e60f1-121">有关创建主密钥的详细信息，请参阅 [CREATE MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-master-key-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="e60f1-121">For more information about creating Master Keys, see [CREATE MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-master-key-transact-sql).</span></span>  
  
-   <span data-ttu-id="e60f1-122">复制不会复制主密钥。</span><span class="sxs-lookup"><span data-stu-id="e60f1-122">Replication does not replicate Master Keys.</span></span> <span data-ttu-id="e60f1-123">如果要求订阅服务器上有主密钥，则必须用 BACKUP MASTER KEY 从发布数据库导出主密钥，然后用 RESTORE MASTER KEY 将其导入订阅数据库。</span><span class="sxs-lookup"><span data-stu-id="e60f1-123">If you require the Master Key at the Subscriber, you must export it from the publication database using BACKUP MASTER KEY and then import it into the subscription database using RESTORE MASTER KEY.</span></span> <span data-ttu-id="e60f1-124">有关详细信息，请参阅 [BACKUP MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-master-key-transact-sql) 和 [RESTORE MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-master-key-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="e60f1-124">For more information, see [BACKUP MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-master-key-transact-sql) and [RESTORE MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-master-key-transact-sql).</span></span>  
  
-   <span data-ttu-id="e60f1-125">如果为可附加的订阅数据库定义了主密钥，请使用 **@db_master_key_password** [Sp_attachsubscription &#40;transact-sql&#41;](/sql/relational-databases/system-stored-procedures/sp-attachsubscription-transact-sql)的参数指定主密钥密码。</span><span class="sxs-lookup"><span data-stu-id="e60f1-125">If a Master Key is defined for an attachable subscription database, specify the Master Key password using the **@db_master_key_password** parameter of [sp_attachsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-attachsubscription-transact-sql).</span></span> <span data-ttu-id="e60f1-126">这样就可以在订阅服务器上附加数据库了。</span><span class="sxs-lookup"><span data-stu-id="e60f1-126">This allows the database to be attached at the Subscriber.</span></span>  
  
 <span data-ttu-id="e60f1-127">有关加密以及主密钥的详细信息，请参阅 [Encryption Hierarchy](../../security/encryption/encryption-hierarchy.md)。</span><span class="sxs-lookup"><span data-stu-id="e60f1-127">For more information about encryption and Master Keys, see [Encryption Hierarchy](../../security/encryption/encryption-hierarchy.md).</span></span>  
  
 <span data-ttu-id="e60f1-128">通过使用复制，您可以发布加密的列数据。</span><span class="sxs-lookup"><span data-stu-id="e60f1-128">Replication enables you to publish encrypted column data.</span></span> <span data-ttu-id="e60f1-129">若要在订阅服务器上解密并使用此数据，则订阅服务器上也必须有用于在发布服务器上加密该数据的密钥。</span><span class="sxs-lookup"><span data-stu-id="e60f1-129">To decrypt and use this data at the Subscriber, the key that was used to encrypt the data at the Publisher must also be present on the Subscriber.</span></span> <span data-ttu-id="e60f1-130">复制并不提供安全机制来传输加密密钥。</span><span class="sxs-lookup"><span data-stu-id="e60f1-130">Replication does not provide a secure mechanism to transport encryption keys.</span></span> <span data-ttu-id="e60f1-131">您必须在订阅服务器上手动重新创建加密密钥。</span><span class="sxs-lookup"><span data-stu-id="e60f1-131">You must manually re-create the encryption key at the Subscriber.</span></span> <span data-ttu-id="e60f1-132">有关详细信息，请参阅[复制加密列中的数据 &#40;SQL Server Management Studio&#41;](replicate-data-in-encrypted-columns-sql-server-management-studio.md)。</span><span class="sxs-lookup"><span data-stu-id="e60f1-132">For more information, see [Replicate Data in Encrypted Columns &#40;SQL Server Management Studio&#41;](replicate-data-in-encrypted-columns-sql-server-management-studio.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e60f1-133">另请参阅</span><span class="sxs-lookup"><span data-stu-id="e60f1-133">See Also</span></span>  
 <span data-ttu-id="e60f1-134">[&#40;复制&#41;的标识和访问控制](identity-and-access-control-replication.md) </span><span class="sxs-lookup"><span data-stu-id="e60f1-134">[Identity and Access Control &#40;Replication&#41;](identity-and-access-control-replication.md) </span></span>  
 [<span data-ttu-id="e60f1-135">安全复制部署</span><span class="sxs-lookup"><span data-stu-id="e60f1-135">Secure Replication Deployment</span></span>](view-and-modify-replication-security-settings.md)  
  
  
