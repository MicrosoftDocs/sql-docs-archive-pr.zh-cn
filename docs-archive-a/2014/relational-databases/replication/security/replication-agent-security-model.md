---
title: 复制代理安全模式 | Microsoft Docs
ms.custom: ''
ms.date: 10/07/2015
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- Snapshot Agent, security
- agents [SQL Server replication], security
- Distribution Agent, security
- logins [SQL Server replication], permissions for agents
- security [SQL Server replication], agent security model
- Log Reader Agent, security
- Queue Reader Agent, security
- Merge Agent, security
- replication [SQL Server], agents and profiles
ms.assetid: 6d09fc8d-843a-4a7a-9812-f093d99d8192
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: da597bf97422f5a0960062b385bc0b67338edfe1
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87576633"
---
# <a name="replication-agent-security-model"></a><span data-ttu-id="ed1c0-102">复制代理安全性模式</span><span class="sxs-lookup"><span data-stu-id="ed1c0-102">Replication Agent Security Model</span></span>
  <span data-ttu-id="ed1c0-103">用复制代理安全模式可以对复制代理运行和建立连接所用的帐户进行精细粒度的控制：可以为每个代理指定不同的帐户。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-103">The replication agent security model allows for fine-grained control over the accounts under which replication agents run and make connections: A different account can be specified for each agent.</span></span> <span data-ttu-id="ed1c0-104">有关如何指定帐户的详细信息，请参阅[管理复制中的登录名和密码](identity-and-access-control-replication.md#manage-logins-and-passwords-in-replication)。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-104">For more information about how to specify accounts, see [Manage Logins and Passwords in Replication](identity-and-access-control-replication.md#manage-logins-and-passwords-in-replication).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="ed1c0-105">**sysadmin** 固定服务器角色的成员配置复制时，可以配置复制代理来模拟 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 代理帐户。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-105">When a member of the **sysadmin** fixed server role configures replication, replication agents can be configured to impersonate the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent account.</span></span> <span data-ttu-id="ed1c0-106">不指定复制代理的登录名和密码即可完成此操作；但是不推荐这种方法。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-106">This is done by not specifying a login and password for a replication agent; however, we do not recommend this approach.</span></span> <span data-ttu-id="ed1c0-107">作为最佳安全做法，建议以本主题后面的“代理所需权限”部分中介绍的最小权限来为每个代理指定一个帐户。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-107">Instead, as a security best practice, we recommend that you specify an account for each agent that has the minimum permissions that are described in the section "Permissions That Are Required by Agents" later in this topic.</span></span>  
  
 <span data-ttu-id="ed1c0-108">和所有可执行文件一样，复制代理在 Windows 帐户的上下文中运行。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-108">Replication agents, like all executables, run under the context of a Windows account.</span></span> <span data-ttu-id="ed1c0-109">它们使用此帐户来建立 Windows 集成安全性连接。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-109">The agents make Windows Integrated Security connections by using this account.</span></span> <span data-ttu-id="ed1c0-110">代理在哪个帐户之下运行取决于代理的启动方式：</span><span class="sxs-lookup"><span data-stu-id="ed1c0-110">The account under which the agent runs depends on how the agent is started:</span></span>  
  
-   <span data-ttu-id="ed1c0-111">从 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 代理作业启动代理，默认值为：使用 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 代理作业来启动复制代理时，代理将在配置复制时所指定的帐户的上下文中运行。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-111">Starting the agent from a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent job, the default: When a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent job is used to start a replication agent, the agent runs under the context of an account that you specify when you configure replication.</span></span> <span data-ttu-id="ed1c0-112">有关 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 代理和复制的详细信息，请参阅本主题后面的“SQL Server 代理下的代理安全性”部分。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-112">For more information about [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent and replication, see the section "Agent Security under SQL Server Agent" later in this topic.</span></span> <span data-ttu-id="ed1c0-113">有关运行 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 代理的帐户所需权限的信息，请参阅[配置 SQL Server 代理](../../../ssms/agent/configure-sql-server-agent.md)。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-113">For information about the permissions that are required for the account under which [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent runs, see [Configure SQL Server Agent](../../../ssms/agent/configure-sql-server-agent.md).</span></span>  
  
-   <span data-ttu-id="ed1c0-114">从 MS-DOS 命令行或直接通过脚本启动代理：代理在命令行上运行代理的用户帐户的上下文中运行。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-114">Starting the agent from an MS-DOS command line, either directly or through a script: The agent runs under the context of the account of the user that is running the agent at the command line.</span></span>  
  
-   <span data-ttu-id="ed1c0-115">从使用复制管理对象 (RMO) 或 ActiveX 控件的应用程序启动代理：代理在调用 RMO 或 ActiveX 控件的应用程序的上下文中运行。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-115">Starting the agent from an application that uses Replication Management Objects (RMO) or an ActiveX control: The agent runs under the context of the application that is calling RMO or the ActiveX control.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="ed1c0-116">不推荐使用 ActiveX 控件。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-116">ActiveX controls are deprecated.</span></span>  
  
 <span data-ttu-id="ed1c0-117">建议在 Windows 集成安全性的上下文中建立连接。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-117">We recommend that connections be made under the context of Windows Integrated Security.</span></span> <span data-ttu-id="ed1c0-118">为了向后兼容，还可以使用 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 安全性。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-118">For backward compatibility, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Security can also be used.</span></span> <span data-ttu-id="ed1c0-119">有关最佳操作的详细信息，请参阅 [Replication Security Best Practices](replication-security-best-practices.md)。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-119">For more information about best practices, see [Replication Security Best Practices](replication-security-best-practices.md).</span></span>  
  
## <a name="permissions-that-are-required-by-agents"></a><span data-ttu-id="ed1c0-120">代理所需权限</span><span class="sxs-lookup"><span data-stu-id="ed1c0-120">Permissions That Are Required by Agents</span></span>  
 <span data-ttu-id="ed1c0-121">用来运行代理并建立连接的帐户需要多种权限。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-121">The accounts under which agents run and make connections require a variety of permissions.</span></span> <span data-ttu-id="ed1c0-122">下表对这些权限进行了说明。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-122">These permissions are described in the following table.</span></span> <span data-ttu-id="ed1c0-123">建议每个代理使用不同的 Windows 帐户运行，并应仅授予帐户所需的权限。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-123">We recommend that each agent run under a different Windows account and the account should be granted only the required permissions.</span></span> <span data-ttu-id="ed1c0-124">有关与多个代理相关的发布访问列表 (PAL) 的信息，请参阅[保护发布服务器](secure-the-publisher.md)。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-124">For information about the publication access list (PAL), which is relevant for a number of agents, see [Secure the Publisher](secure-the-publisher.md).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ed1c0-125">某些 Windows 操作系统中的用户帐户控制 (UAC) 可防止对快照共享的管理访问。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-125">User Account Control (UAC) in some Windows operating systems can prevent administrative access to the snapshot share.</span></span> <span data-ttu-id="ed1c0-126">因此，必须对快照代理、分发代理和合并代理使用的 Windows 帐户显式授予快照共享权限。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-126">You must therefore explicitly grant snapshot share permissions to the Windows accounts that are used by the Snapshot Agent, Distribution Agent, and Merge Agent.</span></span> <span data-ttu-id="ed1c0-127">即使 Windows 帐户是管理员组的成员，也必须执行此操作。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-127">You must do this even if the Windows accounts are members of the Administrators group.</span></span> <span data-ttu-id="ed1c0-128">有关详细信息，请参阅[保护快照文件夹](secure-the-snapshot-folder.md)。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-128">For more information, see [Secure the Snapshot Folder](secure-the-snapshot-folder.md).</span></span>  
  
|<span data-ttu-id="ed1c0-129">代理</span><span class="sxs-lookup"><span data-stu-id="ed1c0-129">Agent</span></span>|<span data-ttu-id="ed1c0-130">权限</span><span class="sxs-lookup"><span data-stu-id="ed1c0-130">Permissions</span></span>|  
|-----------|-----------------|  
|<span data-ttu-id="ed1c0-131">快照代理</span><span class="sxs-lookup"><span data-stu-id="ed1c0-131">Snapshot Agent</span></span>|<span data-ttu-id="ed1c0-132">与分发服务器建立连接时，将使用运行代理的 Windows 帐户。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-132">The Windows account under which the agent runs is used when it makes connections to the Distributor.</span></span> <span data-ttu-id="ed1c0-133">此帐户必须：</span><span class="sxs-lookup"><span data-stu-id="ed1c0-133">This account must:</span></span><br /><br /> <span data-ttu-id="ed1c0-134">-至少是分发数据库中的 **db_owner** 固定数据库角色的成员。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-134">-At minimum, be a member of the **db_owner** fixed database role in the distribution database.</span></span><br /><br /> <span data-ttu-id="ed1c0-135">-对快照共享具有读取、写入和修改权限。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-135">-Have read, write, and modify permissions on the snapshot share.</span></span><br /><br /> <br /><br /> <span data-ttu-id="ed1c0-136">用于连接到发布服务器的帐户必须至少是发布数据库中的 **db_owner** 固定数据库角色的成员。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-136">The account that is used to connect to the Publisher must at minimum be a member of the **db_owner** fixed database role in the publication database.</span></span>|  
|<span data-ttu-id="ed1c0-137">日志读取器代理</span><span class="sxs-lookup"><span data-stu-id="ed1c0-137">Log Reader Agent</span></span>|<span data-ttu-id="ed1c0-138">与分发服务器建立连接时，将使用运行代理的 Windows 帐户。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-138">The Windows account under which the agent runs is used when it makes connections to the Distributor.</span></span> <span data-ttu-id="ed1c0-139">此帐户必须至少是分发数据库中的 **db_owner** 固定数据库角色的成员。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-139">This account must at minimum be a member of the **db_owner** fixed database role in the distribution database.</span></span><br /><br /> <span data-ttu-id="ed1c0-140">用于连接到发布服务器的帐户必须至少是发布数据库中的 **db_owner** 固定数据库角色的成员。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-140">The account that is used to connect to the Publisher must at minimum be a member of the **db_owner** fixed database role in the publication database.</span></span><br /><br /> <span data-ttu-id="ed1c0-141">如果选择 " `sync_type` *仅支持复制*" 选项、"*用备份初始化*" 或 "*从 lsn 初始化*" 选项，则日志读取器代理必须在执行后运行 `sp_addsubscription` ，以便将设置脚本写入分发数据库。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-141">When selecting the `sync_type` options *replication support only*, *initialize with backup*, or *initialize from lsn*, the log reader agent must run after executing `sp_addsubscription`, so that the set-up scripts are written to the distribution database.</span></span> <span data-ttu-id="ed1c0-142">日志读取器代理必须在作为 **sysadmin** 固定服务器角色成员的帐户下运行。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-142">The log reader agent must be running under an account that is a member of the **sysadmin** fixed server role.</span></span> <span data-ttu-id="ed1c0-143">当 `sync_type` 选项设置为 "*自动*" 时，不需要特殊的日志读取器代理操作。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-143">When the `sync_type` option is set to *Automatic*, no special log reader agent actions are required.</span></span>|  
|<span data-ttu-id="ed1c0-144">推送订阅的分发代理</span><span class="sxs-lookup"><span data-stu-id="ed1c0-144">Distribution Agent for a push subscription</span></span>|<span data-ttu-id="ed1c0-145">与分发服务器建立连接时，将使用运行代理的 Windows 帐户。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-145">The Windows account under which the agent runs is used when it makes connections to the Distributor.</span></span> <span data-ttu-id="ed1c0-146">此帐户必须：</span><span class="sxs-lookup"><span data-stu-id="ed1c0-146">This account must:</span></span><br /><br /> <span data-ttu-id="ed1c0-147">-至少是分发数据库中的 **db_owner** 固定数据库角色的成员。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-147">-At minimum be a member of the **db_owner** fixed database role in the distribution database.</span></span><br /><br /> <span data-ttu-id="ed1c0-148">-是 PAL 的成员。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-148">-Be a member of the PAL.</span></span><br /><br /> <span data-ttu-id="ed1c0-149">-对快照共享拥有读取权限。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-149">-Have read permissions on the snapshot share.</span></span><br /><br /> <span data-ttu-id="ed1c0-150">-如果订阅针对非 SQL Server 订阅服务器，则具备对订阅服务器的 OLE DB 访问接口的安装目录的访问权限。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-150">-Have read permissions on the installation directory of the OLE DB provider for the Subscriber if the subscription is for a non-SQL Server Subscriber.</span></span><br /><br /> <span data-ttu-id="ed1c0-151">-当复制 LOB 数据时，分发代理必须对复制 **C:\Program Files\Microsoft SQL Server\XX\COMfolder** 具有编写权限，其中 XX 表示实例 ID。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-151">-When replicating LOB data, the distribution agent must have write permissions on the replication **C:\Program Files\Microsoft SQL Server\XX\COMfolder** where XX represents the instanceID.</span></span><br /><br /> <br /><br /> <span data-ttu-id="ed1c0-152">用于连接到订阅服务器的帐户必须至少是订阅数据库中的 **db_owner** 固定数据库角色的成员（或者如果订阅针对于非 SQL Server 订阅服务器，则必须具有同等权限）。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-152">The account that is used to connect to the Subscriber must at minimum be a member of the **db_owner** fixed database role in the subscription database, or have equivalent permissions if the subscription is for a non-SQL Server Subscriber.</span></span><br /><br /> <span data-ttu-id="ed1c0-153">注意：在 `-subscriptionstreams >= 2` 分发代理上使用时，还必须 `View Server State` 对订阅服务器授予权限，以便检测到死锁。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-153">Note: When using `-subscriptionstreams >= 2` on the distribution agent you must also grant the `View Server State` permission on the subscribers to detect deadlocks.</span></span>|  
|<span data-ttu-id="ed1c0-154">请求订阅的分发代理</span><span class="sxs-lookup"><span data-stu-id="ed1c0-154">Distribution Agent for a pull subscription</span></span>|<span data-ttu-id="ed1c0-155">与订阅服务器建立连接时，将使用运行代理的 Windows 帐户。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-155">The Windows account under which the agent runs is used when it makes connections to the Subscriber.</span></span> <span data-ttu-id="ed1c0-156">此帐户必须至少是订阅数据库中的 **db_owner** 固定数据库角色的成员。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-156">This account must at minimum be a member of the **db_owner** fixed database role in the subscription database.</span></span> <span data-ttu-id="ed1c0-157">用于连接到分发服务器的帐户必须：</span><span class="sxs-lookup"><span data-stu-id="ed1c0-157">The account that is used to connect to the Distributor must:</span></span><br /><br /> <span data-ttu-id="ed1c0-158">-是 PAL 的成员。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-158">-Be a member of the PAL.</span></span><br /><br /> <span data-ttu-id="ed1c0-159">-对快照共享拥有读取权限。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-159">-Have read permissions on the snapshot share.</span></span><br /><br /> <span data-ttu-id="ed1c0-160">-当复制 LOB 数据时，分发代理必须对复制 **C:\Program Files\Microsoft SQL Server\XX\COMfolder** 具有编写权限，其中 XX 表示实例 ID。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-160">-When replicating LOB data, the distribution agent must have write permissions on the replication **C:\Program Files\Microsoft SQL Server\XX\COMfolder** where XX represents the instanceID.</span></span><br /><br /> <br /><br /> <span data-ttu-id="ed1c0-161">注意：在 `-subscriptionstreams >= 2` 分发代理上使用时，还必须 `View Server State` 对订阅服务器授予权限，以便检测到死锁。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-161">Note: When using `-subscriptionstreams >= 2` on the distribution agent you must also grant the `View Server State` permission on the subscribers to detect deadlocks.</span></span>|  
|<span data-ttu-id="ed1c0-162">推送订阅的合并代理</span><span class="sxs-lookup"><span data-stu-id="ed1c0-162">Merge Agent for a push subscription</span></span>|<span data-ttu-id="ed1c0-163">与发布服务器和分发服务器建立连接时，将使用运行代理的 Windows 帐户。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-163">The Windows account under which the agent runs is used when it makes connections to the Publisher and Distributor.</span></span> <span data-ttu-id="ed1c0-164">此帐户必须：</span><span class="sxs-lookup"><span data-stu-id="ed1c0-164">This account must:</span></span><br /><br /> <span data-ttu-id="ed1c0-165">-至少是分发数据库中的 **db_owner** 固定数据库角色的成员。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-165">-At minimum be a member of the **db_owner** fixed database role in the distribution database.</span></span><br /><br /> <span data-ttu-id="ed1c0-166">-是 PAL 的成员。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-166">-Be a member of the PAL.</span></span><br /><br /> <span data-ttu-id="ed1c0-167">-是与发布数据库中的某个用户关联的登录名。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-167">-Be a login that is associated with a user in the publication database.</span></span><br /><br /> <span data-ttu-id="ed1c0-168">-对快照共享拥有读取权限。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-168">-Have read permissions on the snapshot share.</span></span><br /><br /> <br /><br /> <span data-ttu-id="ed1c0-169">用于连接到订阅服务器的帐户必须至少是订阅数据库中的 **db_owner** 固定数据库角色的成员。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-169">The account used to connect to the Subscriber must at minimum be a member of the **db_owner** fixed database role in the subscription database.</span></span>|  
|<span data-ttu-id="ed1c0-170">请求订阅的合并代理</span><span class="sxs-lookup"><span data-stu-id="ed1c0-170">Merge Agent for a pull subscription</span></span>|<span data-ttu-id="ed1c0-171">与订阅服务器建立连接时，将使用运行代理的 Windows 帐户。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-171">The Windows account under which the agent runs is used when it makes connections to the Subscriber.</span></span> <span data-ttu-id="ed1c0-172">此帐户必须至少是订阅数据库中的 **db_owner** 固定数据库角色的成员。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-172">This account must at minimum be a member of the **db_owner** fixed database role in the subscription database.</span></span> <span data-ttu-id="ed1c0-173">用于连接到发布服务器和分发服务器的帐户必须：</span><span class="sxs-lookup"><span data-stu-id="ed1c0-173">The account that is used to connect to the Publisher and Distributor must:</span></span><br /><br /> <span data-ttu-id="ed1c0-174">-是 PAL 的成员。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-174">-Be a member of the PAL.</span></span><br /><br /> <span data-ttu-id="ed1c0-175">-是与发布数据库中的某个用户关联的登录名。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-175">-Be a login associated with a user in the publication database.</span></span><br /><br /> <span data-ttu-id="ed1c0-176">-是与分发数据库中的某个用户关联的登录名。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-176">-Be a login associated with a user in the distribution database.</span></span> <span data-ttu-id="ed1c0-177">用户可以为 `Guest` 用户。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-177">The user can be the `Guest` user.</span></span><br /><br /> <span data-ttu-id="ed1c0-178">-对快照共享拥有读取权限。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-178">-Have read permissions on the snapshot share.</span></span>|  
|<span data-ttu-id="ed1c0-179">队列读取器代理</span><span class="sxs-lookup"><span data-stu-id="ed1c0-179">Queue Reader Agent</span></span>|<span data-ttu-id="ed1c0-180">与分发服务器建立连接时，将使用运行代理的 Windows 帐户。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-180">The Windows account under which the agent runs is used when it makes connections to the Distributor.</span></span> <span data-ttu-id="ed1c0-181">此帐户必须至少是分发数据库中的 **db_owner** 固定数据库角色的成员。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-181">This account must at minimum be a member of the **db_owner** fixed database role in the distribution database.</span></span><br /><br /> <span data-ttu-id="ed1c0-182">用于连接到发布服务器的帐户必须至少是发布数据库中的 **db_owner** 固定数据库角色的成员。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-182">The account that is used to connect to the Publisher must at minimum be a member of the **db_owner** fixed database role in the publication database.</span></span><br /><br /> <span data-ttu-id="ed1c0-183">用于连接到订阅服务器的帐户必须至少是订阅数据库中的 **db_owner** 固定数据库角色的成员。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-183">The account that is used to connect to the Subscriber must at minimum be a member of the **db_owner** fixed database role in the subscription database.</span></span>|  
  
## <a name="agent-security-under-sql-server-agent"></a><span data-ttu-id="ed1c0-184">SQL Server 代理下的代理安全性</span><span class="sxs-lookup"><span data-stu-id="ed1c0-184">Agent Security Under SQL Server Agent</span></span>  
 <span data-ttu-id="ed1c0-185">使用 [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]、 [!INCLUDE[tsql](../../../includes/tsql-md.md)] 过程或 RMO 配置复制时，默认情况下将为每个代理创建 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 代理作业。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-185">When you configure replication by using [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../../includes/tsql-md.md)] procedures, or RMO, a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent job is created by default for each agent.</span></span> <span data-ttu-id="ed1c0-186">然后，代理将使用作业步骤的上下文运行，而不管它们是连续运行、根据计划运行还是按需运行。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-186">Agents then run under the context of a job step, regardless of whether they run continuously, on a schedule, or on demand.</span></span> <span data-ttu-id="ed1c0-187">可以在 **中的** Jobs [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]文件夹下查看这些作业。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-187">You can view these jobs under the **Jobs** folder in [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)].</span></span> <span data-ttu-id="ed1c0-188">下表列出了作业名称。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-188">The following table lists the job names.</span></span>  
  
|<span data-ttu-id="ed1c0-189">代理</span><span class="sxs-lookup"><span data-stu-id="ed1c0-189">Agent</span></span>|<span data-ttu-id="ed1c0-190">作业名称</span><span class="sxs-lookup"><span data-stu-id="ed1c0-190">Job name</span></span>|  
|-----------|--------------|  
|<span data-ttu-id="ed1c0-191">快照代理</span><span class="sxs-lookup"><span data-stu-id="ed1c0-191">Snapshot Agent</span></span>|**\<Publisher>-\<PublicationDatabase>-\<Publication>-\<integer>**|  
|<span data-ttu-id="ed1c0-192">合并发布分区的快照代理</span><span class="sxs-lookup"><span data-stu-id="ed1c0-192">Snapshot Agent for a merge publication partition</span></span>|<span data-ttu-id="ed1c0-193">Dyn_\<Publisher>-\<PublicationDatabase>-\<Publication>-\<GUID></span><span class="sxs-lookup"><span data-stu-id="ed1c0-193">**Dyn_\<Publisher>-\<PublicationDatabase>-\<Publication>-\<GUID>**</span></span>|  
|<span data-ttu-id="ed1c0-194">日志读取器代理</span><span class="sxs-lookup"><span data-stu-id="ed1c0-194">Log Reader Agent</span></span>|**\<Publisher>-\<PublicationDatabase>-\<integer>**|  
|<span data-ttu-id="ed1c0-195">请求订阅的合并代理</span><span class="sxs-lookup"><span data-stu-id="ed1c0-195">Merge Agent for pull subscriptions</span></span>|**\<Publisher>-\<PublicationDatabase>-\<Publication>-\<Subscriber>-\<SubscriptionDatabase>-\<integer>**|  
|<span data-ttu-id="ed1c0-196">推送订阅的合并代理</span><span class="sxs-lookup"><span data-stu-id="ed1c0-196">Merge Agent for push subscriptions</span></span>|**\<Publisher>-\<PublicationDatabase>-\<Publication>-\<Subscriber>-\<integer>**|  
|<span data-ttu-id="ed1c0-197">推送订阅的分发代理</span><span class="sxs-lookup"><span data-stu-id="ed1c0-197">Distribution Agent for push subscriptions</span></span>|<span data-ttu-id="ed1c0-198">**\<Publisher>-\<PublicationDatabase>-\<Publication>-\<Subscriber>-\<integer>** <sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="ed1c0-198">**\<Publisher>-\<PublicationDatabase>-\<Publication>-\<Subscriber>-\<integer>** <sup>1</sup></span></span>|  
|<span data-ttu-id="ed1c0-199">请求订阅的分发代理</span><span class="sxs-lookup"><span data-stu-id="ed1c0-199">Distribution Agent for pull subscriptions</span></span>|<span data-ttu-id="ed1c0-200">**\<Publisher>-\<PublicationDatabase>-\<Publication>-\<Subscriber>-\<SubscriptionDatabase>-\<GUID>** <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="ed1c0-200">**\<Publisher>-\<PublicationDatabase>-\<Publication>-\<Subscriber>-\<SubscriptionDatabase>-\<GUID>** <sup>2</sup></span></span>|  
|<span data-ttu-id="ed1c0-201">非 SQL Server 订阅服务器的推送订阅的分发代理</span><span class="sxs-lookup"><span data-stu-id="ed1c0-201">Distribution Agent for push subscriptions to non-SQL Server Subscribers</span></span>|**\<Publisher>-\<PublicationDatabase>-\<Publication>-\<Subscriber>-\<integer>**|  
|<span data-ttu-id="ed1c0-202">队列读取器代理</span><span class="sxs-lookup"><span data-stu-id="ed1c0-202">Queue Reader Agent</span></span>|<span data-ttu-id="ed1c0-203">**[\<Distributor>].\<integer>**</span><span class="sxs-lookup"><span data-stu-id="ed1c0-203">**[\<Distributor>].\<integer>**</span></span>|  
  
 <span data-ttu-id="ed1c0-204"><sup>1</sup>对于 Oracle 发布的推送订阅，作业名称为 \* \* \<Publisher> - \<Publisher**> 而不是 **\<Publisher>-\<PublicationDatabase>** 。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-204"><sup>1</sup> For push subscriptions to Oracle publications, the job name is \*\*\<Publisher>-\<Publisher**> instead of **\<Publisher>-\<PublicationDatabase>**.</span></span>  
  
 <span data-ttu-id="ed1c0-205"><sup>2</sup>对于 Oracle 发布的请求订阅，作业名称为 \* \* \<Publisher> - \<DistributionDatabase**> 而不是 **\<Publisher>-\<PublicationDatabase>** 。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-205"><sup>2</sup> For pull subscriptions to Oracle publications, the job name is \*\*\<Publisher>-\<DistributionDatabase**> instead of **\<Publisher>-\<PublicationDatabase>**.</span></span>  
  
 <span data-ttu-id="ed1c0-206">配置复制时，指定运行代理应使用的帐户。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-206">When you configure replication, you specify accounts under which agents should run.</span></span> <span data-ttu-id="ed1c0-207">但是，所有作业步骤都使用“代理 ”的安全上下文运行；因此，复制会为指定的代理帐户在内部执行下列映射：</span><span class="sxs-lookup"><span data-stu-id="ed1c0-207">However, all job steps run under the security context of a *proxy*; therefore, replication performs the following mappings internally for the agent accounts that you specify:</span></span>  
  
-   <span data-ttu-id="ed1c0-208">首先使用 [!INCLUDE[tsql](../../../includes/tsql-md.md)][CREATE CREDENTIAL](/sql/t-sql/statements/create-credential-transact-sql) 语句将帐户映射到凭据。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-208">The account is first mapped to a credential by using the [!INCLUDE[tsql](../../../includes/tsql-md.md)] [CREATE CREDENTIAL](/sql/t-sql/statements/create-credential-transact-sql) statement.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="ed1c0-209">代理的代理帐户使用凭据存储 Windows 用户帐户的相关信息。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-209">Agent proxies use credentials to store information about Windows user accounts.</span></span>  
  
-   <span data-ttu-id="ed1c0-210">调用 [sp_add_proxy](/sql/relational-databases/system-stored-procedures/sp-add-proxy-transact-sql) 存储过程，并使用凭据来创建代理。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-210">The [sp_add_proxy](/sql/relational-databases/system-stored-procedures/sp-add-proxy-transact-sql) stored procedure is called, and the credential is used to create a proxy..</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ed1c0-211">提供此信息有助于您了解使用适当的安全上下文运行代理时所涉及的内容。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-211">This information is provided to help you understand what is involved in running agents with the appropriate security context.</span></span> <span data-ttu-id="ed1c0-212">您不需要与已创建的凭据或代理进行直接交互。</span><span class="sxs-lookup"><span data-stu-id="ed1c0-212">You should not have to interact directly with the credentials or proxies that have been created.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ed1c0-213">另请参阅</span><span class="sxs-lookup"><span data-stu-id="ed1c0-213">See Also</span></span>  
 <span data-ttu-id="ed1c0-214">[Replication Security Best Practices](replication-security-best-practices.md) </span><span class="sxs-lookup"><span data-stu-id="ed1c0-214">[Replication Security Best Practices](replication-security-best-practices.md) </span></span>  
 <span data-ttu-id="ed1c0-215">[SQL Server 复制安全性](view-and-modify-replication-security-settings.md) </span><span class="sxs-lookup"><span data-stu-id="ed1c0-215">[SQL Server Replication Security](view-and-modify-replication-security-settings.md) </span></span>  
 [<span data-ttu-id="ed1c0-216">保护快照文件夹</span><span class="sxs-lookup"><span data-stu-id="ed1c0-216">Secure the Snapshot Folder</span></span>](secure-the-snapshot-folder.md)  
  
  
