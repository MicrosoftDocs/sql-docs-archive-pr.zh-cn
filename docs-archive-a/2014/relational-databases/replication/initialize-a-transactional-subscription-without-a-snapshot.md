---
title: 初始化事务订阅（不使用快照）| Microsoft Docs
ms.custom: ''
ms.date: 03/07/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- transactional replication, initializing
- replication [SQL Server], initializing
- initializing subscriptions [SQL Server replication], without snapshots
ms.assetid: 75c8c1f8-60bc-44a8-944b-d18d1f6bda11
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 88e240b75cdbb239548cfcb8e5d8df5eb2af2973
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87578071"
---
# <a name="initialize-a-transactional-subscription-without-a-snapshot"></a><span data-ttu-id="5014c-102">Initialize a Transactional Subscription Without a Snapshot</span><span class="sxs-lookup"><span data-stu-id="5014c-102">Initialize a Transactional Subscription Without a Snapshot</span></span>
  <span data-ttu-id="5014c-103">默认情况下，使用快照初始化对事务发布的订阅，此快照由快照代理生成并由分发代理应用。</span><span class="sxs-lookup"><span data-stu-id="5014c-103">By default, a subscription to a transactional publication is initialized with a snapshot, which is generated by the Snapshot Agent and applied by the Distribution Agent.</span></span> <span data-ttu-id="5014c-104">在某些方案中，例如涉及大型初始数据集的方案中，最好用其他方法初始化订阅。</span><span class="sxs-lookup"><span data-stu-id="5014c-104">In some scenarios, such as those involving large initial datasets, it is preferable to initialize a subscription using another method.</span></span> <span data-ttu-id="5014c-105">初始化订阅服务器的其他方法包括：</span><span class="sxs-lookup"><span data-stu-id="5014c-105">Other methods of initializing a Subscriber include:</span></span>  
  
-   <span data-ttu-id="5014c-106">指定备份。</span><span class="sxs-lookup"><span data-stu-id="5014c-106">Specifying a backup.</span></span> <span data-ttu-id="5014c-107">还原订阅服务器上的备份，然后分发代理将复制任何所需的复制元数据和系统过程。</span><span class="sxs-lookup"><span data-stu-id="5014c-107">Restore the backup on the Subscriber, and then the Distribution Agent copies any required replication metadata and system procedures.</span></span> <span data-ttu-id="5014c-108">使用备份进行初始化是向订阅服务器传递数据最快的方法，而且也很方便，因为如果在启用发布以使用备份进行初始化之后取得备份，则可以使用任何最近的备份。</span><span class="sxs-lookup"><span data-stu-id="5014c-108">Initializing with a backup is the fastest way to deliver data to the Subscriber and is convenient, because any recent backup can be used if it was taken after the publication was enabled for initialization with a backup.</span></span>  
  
-   <span data-ttu-id="5014c-109">通过用其他机制（如附加数据库）向订阅服务器复制初始数据集。</span><span class="sxs-lookup"><span data-stu-id="5014c-109">Copying an initial dataset to the Subscriber through another mechanism, such as attaching a database.</span></span> <span data-ttu-id="5014c-110">必须确保订阅服务器上的数据和架构是正确的，然后分发代理将复制任何所需的元数据和系统过程。</span><span class="sxs-lookup"><span data-stu-id="5014c-110">You must ensure the correct data and schema are at the Subscriber, and then the Distribution Agent copies any required metadata and system procedures.</span></span>  
  
## <a name="initializing-a-subscription-with-a-backup"></a><span data-ttu-id="5014c-111">用备份初始化订阅</span><span class="sxs-lookup"><span data-stu-id="5014c-111">Initializing a subscription with a backup</span></span>  
 <span data-ttu-id="5014c-112">备份包含整个数据库；因此，初始化每个订阅数据库时，它将包含发布数据库的完整副本：</span><span class="sxs-lookup"><span data-stu-id="5014c-112">A backup contains an entire database; therefore each subscription database will contain a complete copy of the publication database when it is initialized:</span></span>  
  
-   <span data-ttu-id="5014c-113">备份包括未指定为发布项目的表。</span><span class="sxs-lookup"><span data-stu-id="5014c-113">The backup includes tables not specified as articles for the publication.</span></span>  
  
-   <span data-ttu-id="5014c-114">备份包括所有数据，即使表中指定了行或列筛选器。</span><span class="sxs-lookup"><span data-stu-id="5014c-114">The backup includes all data, even if row or column filters are specified on a table.</span></span>  
  
 <span data-ttu-id="5014c-115">管理员或应用程序负责在还原备份后删除任何不需要的对象或数据。</span><span class="sxs-lookup"><span data-stu-id="5014c-115">It is the responsibility of the administrator or application to remove any unwanted objects or data after the backup has been restored.</span></span> <span data-ttu-id="5014c-116">在后续同步中，仅当数据更改应用于指定为项目的表时才被复制，而且这些更改满足您指定的任何筛选条件。</span><span class="sxs-lookup"><span data-stu-id="5014c-116">In subsequent synchronizations, data changes are only replicated if they apply to tables specified as articles, and the changes meet any filtering criteria you specified.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="5014c-117">还原备份时，如果要让订阅服务器自动同步，必须确保备份来自发布服务器。</span><span class="sxs-lookup"><span data-stu-id="5014c-117">When restoring a backup, you must ensure that the backup came from the Publisher if you want the Subscriber to automatically synchronize.</span></span> <span data-ttu-id="5014c-118">备份中的日志序列号 (LSN) 值（用于设置开始同步的点）是发布服务器所特有的。</span><span class="sxs-lookup"><span data-stu-id="5014c-118">The log sequence number (LSN) values in the backup (which are used to set the point at which to start synchronizing) are specific to the Publisher.</span></span>  
  
 <span data-ttu-id="5014c-119">**用备份初始化订阅**</span><span class="sxs-lookup"><span data-stu-id="5014c-119">**To initialize a subscription with a backup**</span></span>  
  
 <span data-ttu-id="5014c-120">若要使用备份初始化订阅，首先必须在创建发布时启用此选项，然后在创建订阅时为多个选项指定值。</span><span class="sxs-lookup"><span data-stu-id="5014c-120">To initialize a subscription with a backup, you first must enable the option when you create a publication, and then specify values for a number of options when you create a subscription.</span></span> <span data-ttu-id="5014c-121">可以通过新建发布向导或以编程方式启用发布。</span><span class="sxs-lookup"><span data-stu-id="5014c-121">Publications can be enabled through the New Publication Wizard or programmatically.</span></span> <span data-ttu-id="5014c-122">但是，订阅选项所需的值只能用编程方式指定。</span><span class="sxs-lookup"><span data-stu-id="5014c-122">However, the values required for the subscription options can only be specified programmatically.</span></span>  
  
-   [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]<span data-ttu-id="5014c-123">：[使用备份来初始化事务发布 (SQL Server Management Studio)](enable-initialization-with-backup-for-transactional-publications.md)</span><span class="sxs-lookup"><span data-stu-id="5014c-123">: [Enable Initialization with a Backup for Transactional Publications &#40;SQL Server Management Studio&#41;](enable-initialization-with-backup-for-transactional-publications.md)</span></span>  
  
-   <span data-ttu-id="5014c-124">复制 Transact-SQL 编程：[从备份初始化事务订阅（复制 Transact-SQL 编程）](initialize-a-transactional-subscription-from-a-backup.md)</span><span class="sxs-lookup"><span data-stu-id="5014c-124">Replication Transact-SQL programming: [Initialize a Transactional Subscription from a Backup &#40;Replication Transact-SQL Programming&#41;](initialize-a-transactional-subscription-from-a-backup.md)</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="5014c-125">如果初始化订阅时不使用快照，在发布服务器上运行 SQL Server 服务的帐户必须具有分发服务器上快照文件夹的写权限。</span><span class="sxs-lookup"><span data-stu-id="5014c-125">If a subscription is initialized without using a snapshot, the account under which the SQL Server service runs at the Publisher must have write permissions on the snapshot folder at the Distributor.</span></span> <span data-ttu-id="5014c-126">有关权限的详细信息，请参阅 [Replication Agent Security Model](security/replication-agent-security-model.md)。</span><span class="sxs-lookup"><span data-stu-id="5014c-126">For more information about permissions, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
### <a name="ensuring-the-suitability-of-a-backup"></a><span data-ttu-id="5014c-127">确保备份的适用性</span><span class="sxs-lookup"><span data-stu-id="5014c-127">Ensuring the suitability of a backup</span></span>  
 <span data-ttu-id="5014c-128">如果在执行备份后发生的所有事务都存储在分发服务器上，则备份适用于初始化订阅服务器。</span><span class="sxs-lookup"><span data-stu-id="5014c-128">A backup is suitable for initializing a Subscriber if all transactions that occur after the backup was taken are stored at the Distributor.</span></span> <span data-ttu-id="5014c-129">如果备份不适用，复制将显示一条错误消息。</span><span class="sxs-lookup"><span data-stu-id="5014c-129">Replication will display an error message if the backup is not suitable.</span></span>  
  
 <span data-ttu-id="5014c-130">若要帮助确保备份适用，请按下列规则执行：</span><span class="sxs-lookup"><span data-stu-id="5014c-130">To help ensure that a backup is suitable for use, follow these guidelines:</span></span>  
  
-   <span data-ttu-id="5014c-131">使用最新的可用备份，如果最新备份的保留时间超过了最大分发保持期，则在尝试用备份初始化订阅之前创建新的备份。</span><span class="sxs-lookup"><span data-stu-id="5014c-131">Use the latest backup available, and if the latest backup is older than the maximum distribution retention period, create a new backup before attempting to initialize a subscription with a backup.</span></span> <span data-ttu-id="5014c-132">有关保持期的详细信息，请参阅 [Subscription Expiration and Deactivation](subscription-expiration-and-deactivation.md)。</span><span class="sxs-lookup"><span data-stu-id="5014c-132">For more information about retention period, see [Subscription Expiration and Deactivation](subscription-expiration-and-deactivation.md).</span></span>  
  
-   <span data-ttu-id="5014c-133">默认情况下，分发清除作业将从分发数据库中清除保留时间超过 72 小时的事务。</span><span class="sxs-lookup"><span data-stu-id="5014c-133">By default, the distribution cleanup job clears transactions older than 72 hours from the distribution database.</span></span> <span data-ttu-id="5014c-134">清除根据发布的保持期设置进行。</span><span class="sxs-lookup"><span data-stu-id="5014c-134">Cleanup is based on the retention period set for the publication.</span></span> <span data-ttu-id="5014c-135">用保留时间较长的备份进行同步时，请考虑在想要还原的备份进行之前临时禁用此作业，并在订阅成功创建后再重新启用它。</span><span class="sxs-lookup"><span data-stu-id="5014c-135">When synchronizing with older backups, consider temporarily disabling the job before the backup you would like to restore and re-enabling it after the subscription is successfully created.</span></span> <span data-ttu-id="5014c-136">这可以防止从分发数据库中删除那些从备份成功同步时可能需要的事务。</span><span class="sxs-lookup"><span data-stu-id="5014c-136">This prevents removal of transactions from the distribution database that might be needed to synchronize successfully from the backup.</span></span> <span data-ttu-id="5014c-137">有关运行清除作业的信息，请参阅[运行复制维护作业 (SQL Server Management Studio)](administration/run-replication-maintenance-jobs-sql-server-management-studio.md)。</span><span class="sxs-lookup"><span data-stu-id="5014c-137">For information about running cleanup jobs, see [Run Replication Maintenance Jobs &#40;SQL Server Management Studio&#41;](administration/run-replication-maintenance-jobs-sql-server-management-studio.md).</span></span>  
  
 <span data-ttu-id="5014c-138">在某些情况下，设置使用备份初始化的订阅后，必须在还原的订阅服务器数据库中手动执行自定义。</span><span class="sxs-lookup"><span data-stu-id="5014c-138">In some cases you must manually perform customizations in the restored Subscriber database after setting up subscriptions that are initialized with a backup.</span></span> <span data-ttu-id="5014c-139">通常，如果用以下方式定义发布服务器：希望订阅服务器数据库的内容与发布服务器数据库的内容不同，则需要对还原的订阅服务器数据库进行手动修改。</span><span class="sxs-lookup"><span data-stu-id="5014c-139">In general, manual modifications at the restored Subscriber database are required if the Publication is defined in such a way that the Subscriber database content is expected to be different from the Publisher database content.</span></span>  
  
-   <span data-ttu-id="5014c-140">如果将还原数据库中的索引视图作为基于日志的索引视图到表的项目发布，则必须将其转换为表</span><span class="sxs-lookup"><span data-stu-id="5014c-140">Indexed-views at the restored database have to be converted to tables if they are published as log-based indexed-view-to-table articles</span></span>  
  
-   <span data-ttu-id="5014c-141">必须将还原数据库中的订阅时间戳列转换为 **binary(8)** 列：将包含时间戳列的表的内容复制到具有匹配架构（除了用 **binary(8)** 列替代时间戳列之外）的新表，删除原始表，然后使用与原始表相同的名称重命名新表。</span><span class="sxs-lookup"><span data-stu-id="5014c-141">Subscribed timestamp columns at the restored database must be converted to **binary(8)** columns: copy the content of the tables containing timestamp columns to new tables with matching schemas except having **binary(8)** columns in place of the timestamp columns, drop the original tables, and rename the new tables with the same names as the original tables.</span></span>  
  
## <a name="initializing-a-subscription-with-an-alternative-method"></a><span data-ttu-id="5014c-142">使用其他方法初始化订阅</span><span class="sxs-lookup"><span data-stu-id="5014c-142">Initializing a subscription with an alternative method</span></span>  
 <span data-ttu-id="5014c-143">可以使用任何能够将发布数据库架构和数据复制到订阅服务器的方法初始化订阅，例如 [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="5014c-143">It is possible to initialize a subscription using any method that allows you to copy the publication database schema and data to the Subscriber, such as [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)].</span></span> <span data-ttu-id="5014c-144">用其他方法初始化订阅服务器时，复制支持将对象复制到订阅服务器。</span><span class="sxs-lookup"><span data-stu-id="5014c-144">When you use an alternative method to initialize the Subscriber, replication support objects are copied to the Subscriber.</span></span>  
  
 <span data-ttu-id="5014c-145">与使用备份进行初始化不同，您或您的应用程序必须确保数据和架构在添加订阅时正确同步。</span><span class="sxs-lookup"><span data-stu-id="5014c-145">Unlike initializing with a backup, you or your application must ensure the data and schema are properly synchronized at the time you add the subscription.</span></span> <span data-ttu-id="5014c-146">例如，如果从将数据和架构复制到订阅服务器到添加订阅这一时间段内，发布服务器上进行了某一活动，则此活动导致的更改可能不会复制到订阅服务器。</span><span class="sxs-lookup"><span data-stu-id="5014c-146">If, for example, there is activity on the Publisher between the time data and schema are copied to the Subscriber and the time at which the subscription is added, changes resulting from this activity might not be replicated to the Subscriber.</span></span>  
  
 <span data-ttu-id="5014c-147">若要使用其他方法初始化订阅，请参阅 [Initialize a Subscription Manually](initialize-a-subscription-manually.md)。</span><span class="sxs-lookup"><span data-stu-id="5014c-147">To initialize a subscription with an alternative method, see [Initialize a Subscription Manually](initialize-a-subscription-manually.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="5014c-148">另请参阅</span><span class="sxs-lookup"><span data-stu-id="5014c-148">See Also</span></span>  
 [<span data-ttu-id="5014c-149">初始化订阅</span><span class="sxs-lookup"><span data-stu-id="5014c-149">Initialize a Subscription</span></span>](initialize-a-subscription.md)  
  
  
