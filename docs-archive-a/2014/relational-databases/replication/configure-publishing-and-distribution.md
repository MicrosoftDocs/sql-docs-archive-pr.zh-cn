---
title: 配置发布和分发 | Microsoft Docs
ms.custom: ''
ms.date: 06/30/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- replication [SQL Server], distribution
- distribution configuration [SQL Server replication]
- publishing [SQL Server replication], configuring
ms.assetid: 3cfc8966-833e-42fa-80cb-09175d1feed7
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: afd1544b5412c6ce2d83a9a1e9a50ddf662b3056
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87577581"
---
# <a name="configure-publishing-and-distribution"></a><span data-ttu-id="36884-102">配置发布和分发</span><span class="sxs-lookup"><span data-stu-id="36884-102">Configure Publishing and Distribution</span></span>
  <span data-ttu-id="36884-103">本主题说明如何使用 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 、 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]或复制管理对象 (RMO) 在 [!INCLUDE[tsql](../../includes/tsql-md.md)]中配置发布和分发。</span><span class="sxs-lookup"><span data-stu-id="36884-103">This topic describes how to configure publishing and distribution in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span>  
  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="36884-104">开始之前</span><span class="sxs-lookup"><span data-stu-id="36884-104">Before You Begin</span></span>  
  
###  <a name="security"></a><a name="Security"></a> <span data-ttu-id="36884-105">Security</span><span class="sxs-lookup"><span data-stu-id="36884-105">Security</span></span>  
 <span data-ttu-id="36884-106">有关详细信息，请参阅[安全复制部署](security/view-and-modify-replication-security-settings.md)。</span><span class="sxs-lookup"><span data-stu-id="36884-106">For more information, see [Secure Replication Deployment](security/view-and-modify-replication-security-settings.md).</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="36884-107">使用 SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="36884-107">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="36884-108">可以使用新建发布向导或配置分发向导配置分发。</span><span class="sxs-lookup"><span data-stu-id="36884-108">Configure distribution using the New Publication Wizard or the Configure Distribution Wizard.</span></span> <span data-ttu-id="36884-109">配置分发服务器后，查看并修改“分发服务器属性 - \<Distributor>”对话框中的属性。</span><span class="sxs-lookup"><span data-stu-id="36884-109">After the Distributor is configured, view and modify properties in the **Distributor Properties - \<Distributor>** dialog box.</span></span> <span data-ttu-id="36884-110">如果要配置分发服务器以使 **db_owner** 固定数据库角色的成员可以创建发布，或者要配置一个非发布服务器的远程分发服务器，请使用配置分发向导。</span><span class="sxs-lookup"><span data-stu-id="36884-110">Use the Configure Distribution Wizard if you want to configure a Distributor so that members of the **db_owner** fixed database roles can create publications, or because you want to configure a remote Distributor that is not a Publisher.</span></span>  
  
#### <a name="to-configure-distribution"></a><span data-ttu-id="36884-111">配置分发</span><span class="sxs-lookup"><span data-stu-id="36884-111">To configure distribution</span></span>  
  
1.  <span data-ttu-id="36884-112">在 [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] 中，连接到将要作为分发服务器的服务器（许多情况下，发布服务器和分发服务器是同一服务器），然后展开该服务器节点。</span><span class="sxs-lookup"><span data-stu-id="36884-112">In [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], connect to the server that will be the Distributor (in many cases, the Publisher and Distributor are the same server), and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="36884-113">右键单击 **“复制”** 文件夹，然后单击 **“配置分发”** 。</span><span class="sxs-lookup"><span data-stu-id="36884-113">Right-click the **Replication** folder, and then click **Configure Distribution**.</span></span>  
  
3.  <span data-ttu-id="36884-114">随着配置分发向导执行下列操作：</span><span class="sxs-lookup"><span data-stu-id="36884-114">Follow the Configure Distribution Wizard to:</span></span>  
  
    -   <span data-ttu-id="36884-115">选择分发服务器。</span><span class="sxs-lookup"><span data-stu-id="36884-115">Select a Distributor.</span></span> <span data-ttu-id="36884-116">若要使用本地分发服务器，请选择 **" \<ServerName> " 将充当自己的分发服务器;SQL Server 将创建分发数据库和日志**。</span><span class="sxs-lookup"><span data-stu-id="36884-116">To use a local Distributor, select **'\<ServerName>' will act as its own Distributor; SQL Server will create a distribution database and log**.</span></span> <span data-ttu-id="36884-117">若要使用远程分发服务器，请选择 **“使用以下服务器作为分发服务器”** ，再选择一个服务器。</span><span class="sxs-lookup"><span data-stu-id="36884-117">To use a remote Distributor, select **Use the following server as the Distributor**, and then select a server.</span></span> <span data-ttu-id="36884-118">该服务器必须已配置为分发服务器，并且启用发布服务器使用此分发服务器。</span><span class="sxs-lookup"><span data-stu-id="36884-118">The server must already be configured as a Distributor, and the Publisher must be enabled to use the Distributor.</span></span> <span data-ttu-id="36884-119">有关详细信息，请参阅[在分发服务器上启用远程发布服务器 (SQL Server Management Studio)](enable-a-remote-publisher-at-a-distributor-sql-server-management-studio.md)。</span><span class="sxs-lookup"><span data-stu-id="36884-119">For more information, see [Enable a Remote Publisher at a Distributor &#40;SQL Server Management Studio&#41;](enable-a-remote-publisher-at-a-distributor-sql-server-management-studio.md).</span></span>  
  
         <span data-ttu-id="36884-120">如果选择远程分发服务器，则必须在 **“管理密码”** 页上输入从发布服务器连接到分发服务器的密码。</span><span class="sxs-lookup"><span data-stu-id="36884-120">If you select a remote Distributor, you must enter a password on the **Administrative Password** page for connections made from the Publisher to the Distributor.</span></span> <span data-ttu-id="36884-121">此密码必须与在远程分发服务器上启用发布服务器时所指定的密码相匹配。</span><span class="sxs-lookup"><span data-stu-id="36884-121">This password must match the password specified when the Publisher was enabled at the remote Distributor.</span></span>  
  
    -   <span data-ttu-id="36884-122">指定根快照文件夹（适用于本地分发服务器）。</span><span class="sxs-lookup"><span data-stu-id="36884-122">Specify a root snapshot folder (for a local Distributor).</span></span> <span data-ttu-id="36884-123">快照文件夹只是指定共享的目录。向此文件夹中执行读写操作的代理必须对其具有足够的访问权限。</span><span class="sxs-lookup"><span data-stu-id="36884-123">The snapshot folder is simply a directory that you have designated as a share; agents that read from and write to this folder must have sufficient permissions to access it.</span></span> <span data-ttu-id="36884-124">每个使用此分发服务器的发布服务器都在根文件夹下创建一个文件夹，而每个发布则在发布服务器文件夹下创建用于存储快照文件的文件夹。</span><span class="sxs-lookup"><span data-stu-id="36884-124">Each Publisher that uses this Distributor creates a folder under the root folder, and each publication creates folders under the Publisher folder in which to store snapshot files.</span></span> <span data-ttu-id="36884-125">有关正确保护文件夹的详细信息，请参阅[保护快照文件夹的安全](security/secure-the-snapshot-folder.md)。</span><span class="sxs-lookup"><span data-stu-id="36884-125">For more information on securing the folder appropriately, see [Secure the Snapshot Folder](security/secure-the-snapshot-folder.md).</span></span>  
  
    -   <span data-ttu-id="36884-126">指定分发数据库（适用于本地分发服务器）。</span><span class="sxs-lookup"><span data-stu-id="36884-126">Specify the distribution database (for a local Distributor).</span></span> <span data-ttu-id="36884-127">分发数据库存储事务性复制的所有复制和事务类型的元数据和历史记录数据。</span><span class="sxs-lookup"><span data-stu-id="36884-127">The distribution database stores metadata and history data for all types of replication and transactions for transactional replication.</span></span>  
  
    -   <span data-ttu-id="36884-128">还可以让其他发布服务器使用该分发服务器（可选）。</span><span class="sxs-lookup"><span data-stu-id="36884-128">Optionally enable other Publishers to use the Distributor.</span></span> <span data-ttu-id="36884-129">如果其他发布服务器能够使用分发服务器，则必须在 **“分发服务器密码”** 页上输入从这些发布服务器连接到分发服务器的密码。</span><span class="sxs-lookup"><span data-stu-id="36884-129">If other Publishers are enabled to use the Distributor, you must enter a password on the **Distributor Password** page for connections made from these Publishers to the Distributor.</span></span>  
  
    -   <span data-ttu-id="36884-130">还可以为配置设置编写脚本（可选）。</span><span class="sxs-lookup"><span data-stu-id="36884-130">Optionally script configuration settings.</span></span> <span data-ttu-id="36884-131">有关详细信息，请参阅 [Scripting Replication](scripting-replication.md)。</span><span class="sxs-lookup"><span data-stu-id="36884-131">For more information, see [Scripting Replication](scripting-replication.md).</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="36884-132">使用 Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="36884-132">Using Transact-SQL</span></span>  
 <span data-ttu-id="36884-133">可以使用复制存储过程以编程方式配置复制发布和分发。</span><span class="sxs-lookup"><span data-stu-id="36884-133">Replication publishing and distribution can be configured programmatically using replication stored procedures.</span></span>  
  
#### <a name="to-configure-publishing-using-a-local-distributor"></a><span data-ttu-id="36884-134">使用本地分发服务器配置发布</span><span class="sxs-lookup"><span data-stu-id="36884-134">To configure publishing using a local distributor</span></span>  
  
1.  <span data-ttu-id="36884-135">执行 [sp_get_distributor (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-get-distributor-transact-sql) 以确定服务器是否已配置为分发服务器。</span><span class="sxs-lookup"><span data-stu-id="36884-135">Execute [sp_get_distributor &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-get-distributor-transact-sql) to determine if the server is already configured as a Distributor.</span></span>  
  
    -   <span data-ttu-id="36884-136">如果结果集中 **installed** 的值为 **0**，请在分发服务器上对 master 数据库执行 [sp_adddistributor (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="36884-136">If the value of **installed** in the result set is **0**, execute [sp_adddistributor &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql) at the Distributor on the master database.</span></span>  
  
    -   <span data-ttu-id="36884-137">如果结果集中 **distribution db installed** 的值为 **0**，请在分发服务器上对 master 数据库执行 [sp_adddistributiondb (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-adddistributiondb-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="36884-137">If the value of **distribution db installed** in the result set is **0**, execute [sp_adddistributiondb &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributiondb-transact-sql) at the Distributor on the master database.</span></span> <span data-ttu-id="36884-138">指定\*\* \@ 数据库\*\*的分发数据库的名称。</span><span class="sxs-lookup"><span data-stu-id="36884-138">Specify the name of the distribution database for **\@database**.</span></span> <span data-ttu-id="36884-139">还可以指定\*\* \@ max_distretention**的最大事务保持期和** \@ history_retention\*\*的历史记录保持期。</span><span class="sxs-lookup"><span data-stu-id="36884-139">Optionally, you can specify the maximum transactional retention period for **\@max_distretention** and the history retention period for **\@history_retention**.</span></span> <span data-ttu-id="36884-140">如果要创建一个新的数据库，请指定所需的数据库属性参数。</span><span class="sxs-lookup"><span data-stu-id="36884-140">If a new database is being created, specify the desired database property parameters.</span></span>  
  
2.  <span data-ttu-id="36884-141">在同时作为发布服务器的分发服务器上，执行[sp_adddistpublisher &#40;transact-sql&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistpublisher-transact-sql)，并指定将用作\*\* \@ working_directory\*\*默认快照文件夹的 UNC 共享。</span><span class="sxs-lookup"><span data-stu-id="36884-141">At the Distributor, which is also the Publisher, execute [sp_adddistpublisher &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistpublisher-transact-sql), specifying the UNC share that will be used as default snapshot folder for **\@working_directory**.</span></span>  
  
3.  <span data-ttu-id="36884-142">在发布服务器上执行 [sp_replicationdboption (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="36884-142">At the Publisher, execute [sp_replicationdboption &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql).</span></span> <span data-ttu-id="36884-143">为 "数据库类型" 指定要\*\* \@ 发布的数据库，为\*\* \*\* \@ optname**指定复制的类型，并为 " `true` \*\* \@ 值**" 指定值。</span><span class="sxs-lookup"><span data-stu-id="36884-143">Specify the database being published for **\@dbname**, the type of replication for **\@optname**, and a value of `true` for **\@value**.</span></span>  
  
#### <a name="to-configure-publishing-using-a-remote-distributor"></a><span data-ttu-id="36884-144">使用远程分发服务器配置发布</span><span class="sxs-lookup"><span data-stu-id="36884-144">To configure publishing using a remote distributor</span></span>  
  
1.  <span data-ttu-id="36884-145">执行 [sp_get_distributor (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-get-distributor-transact-sql) 以确定服务器是否已配置为分发服务器。</span><span class="sxs-lookup"><span data-stu-id="36884-145">Execute [sp_get_distributor &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-get-distributor-transact-sql) to determine if the server is already configured as a Distributor.</span></span>  
  
    -   <span data-ttu-id="36884-146">如果结果集中 **installed** 的值为 **0**，请在分发服务器上对 master 数据库执行 [sp_adddistributor (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="36884-146">If the value of **installed** in the result set is **0**, execute [sp_adddistributor &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql) at the Distributor on the master database.</span></span> <span data-ttu-id="36884-147">指定\*\* \@ 密码\*\*的强密码。</span><span class="sxs-lookup"><span data-stu-id="36884-147">Specify a strong password for **\@password**.</span></span> <span data-ttu-id="36884-148">发布服务器在连接到分发服务器时将使用 **distributor_admin** 帐户的此密码。</span><span class="sxs-lookup"><span data-stu-id="36884-148">This password for the **distributor_admin** account will be used by the Publisher when connecting to the Distributor.</span></span>  
  
    -   <span data-ttu-id="36884-149">如果结果集中 **distribution db installed** 的值为 **0**，请在分发服务器上对 master 数据库执行 [sp_adddistributiondb (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-adddistributiondb-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="36884-149">If the value of **distribution db installed** in the result set is **0**, execute [sp_adddistributiondb &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributiondb-transact-sql) at the Distributor on the master database.</span></span> <span data-ttu-id="36884-150">指定\*\* \@ 数据库\*\*的分发数据库的名称。</span><span class="sxs-lookup"><span data-stu-id="36884-150">Specify the name of the distribution database for **\@database**.</span></span> <span data-ttu-id="36884-151">还可以指定\*\* \@ max_distretention**的最大事务保持期和** \@ history_retention\*\*的历史记录保持期。</span><span class="sxs-lookup"><span data-stu-id="36884-151">Optionally, you can specify the maximum transactional retention period for **\@max_distretention** and the history retention period for **\@history_retention**.</span></span> <span data-ttu-id="36884-152">如果要创建一个新的数据库，请指定所需的数据库属性参数。</span><span class="sxs-lookup"><span data-stu-id="36884-152">If a new database is being created, specify the desired database property parameters.</span></span>  
  
2.  <span data-ttu-id="36884-153">在分发服务器上，执行[sp_adddistpublisher &#40;transact-sql&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistpublisher-transact-sql)，并指定将用作\*\* \@ working_directory\*\*默认快照文件夹的 UNC 共享。</span><span class="sxs-lookup"><span data-stu-id="36884-153">At the Distributor, execute [sp_adddistpublisher &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistpublisher-transact-sql), specifying the UNC share that will be used as default snapshot folder for **\@working_directory**.</span></span> <span data-ttu-id="36884-154">如果分发服务器在 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 连接到发布服务器时将使用身份验证，则还必须将\*\* \@ security_mode**的值指定为**0\*\* ，并将登录 [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 信息指定为\*\* \@ 登录**名和** \@ 密码\*\*。</span><span class="sxs-lookup"><span data-stu-id="36884-154">If the Distributor will use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@security_mode** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@login** and **\@password**.</span></span>  
  
3.  <span data-ttu-id="36884-155">在发布服务器上，对 master 数据库执行 [sp_adddistributor (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="36884-155">At the Publisher on the master database, execute [sp_adddistributor &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql).</span></span> <span data-ttu-id="36884-156">为\*\* \@ 密码\*\*指定在步骤1中使用的强密码。</span><span class="sxs-lookup"><span data-stu-id="36884-156">Specify the strong password used in step 1 for **\@password**.</span></span> <span data-ttu-id="36884-157">发布服务器在连接到分发服务器时将使用此密码。</span><span class="sxs-lookup"><span data-stu-id="36884-157">This password will be used by the Publisher when connecting to the Distributor.</span></span>  
  
4.  <span data-ttu-id="36884-158">在发布服务器上执行 [sp_replicationdboption (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="36884-158">At the Publisher, execute [sp_replicationdboption &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql).</span></span> <span data-ttu-id="36884-159">为 "数据库类型" 指定要\*\* \@ 发布的数据库，为\*\* \*\* \@ optname**指定复制的类型，并将 " \*\* \@ 值**" 的值指定为 "true"。</span><span class="sxs-lookup"><span data-stu-id="36884-159">Specify the database being published for **\@dbname**, the type of replication for **\@optname**, and a value of true for **\@value**.</span></span>  
  
###  <a name="example-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="36884-160">示例 (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="36884-160">Example (Transact-SQL)</span></span>  
 <span data-ttu-id="36884-161">下面的示例说明了如何以编程方式配置发布和分发。</span><span class="sxs-lookup"><span data-stu-id="36884-161">The following example demonstrates how to configure publishing and distribution programmatically.</span></span> <span data-ttu-id="36884-162">在本示例中，使用脚本变量提供要配置为发布服务器和本地分发服务器的服务器的名称。</span><span class="sxs-lookup"><span data-stu-id="36884-162">In this example, the name of the server that is being configured as a publisher and a local distributor is supplied using scripting variables.</span></span> <span data-ttu-id="36884-163">可以使用复制存储过程以编程方式配置复制发布和分发。</span><span class="sxs-lookup"><span data-stu-id="36884-163">Replication publishing and distribution can be configured programmatically using replication stored procedures.</span></span>  
  
 [!code-sql[HowTo#AddDistPub](../../snippets/tsql/SQL15/replication/howto/tsql/adddistpub.sql#adddistpub)]  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="36884-164">使用复制管理对象 (RMO)</span><span class="sxs-lookup"><span data-stu-id="36884-164">Using Replication Management Objects (RMO)</span></span>  
  
#### <a name="to-configure-publishing-and-distribution-on-a-single-server"></a><span data-ttu-id="36884-165">在单个服务器上配置发布和分发</span><span class="sxs-lookup"><span data-stu-id="36884-165">To configure publishing and distribution on a single server</span></span>  
  
1.  <span data-ttu-id="36884-166">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 类创建与服务器的连接。</span><span class="sxs-lookup"><span data-stu-id="36884-166">Create a connection to the server by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="36884-167">创建的 <xref:Microsoft.SqlServer.Replication.ReplicationServer> 类的实例。</span><span class="sxs-lookup"><span data-stu-id="36884-167">Create an instance of the <xref:Microsoft.SqlServer.Replication.ReplicationServer> class.</span></span> <span data-ttu-id="36884-168">传递步骤 1 中的 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 。</span><span class="sxs-lookup"><span data-stu-id="36884-168">Pass the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1.</span></span>  
  
3.  <span data-ttu-id="36884-169">创建的 <xref:Microsoft.SqlServer.Replication.DistributionDatabase> 类的实例。</span><span class="sxs-lookup"><span data-stu-id="36884-169">Create an instance of the <xref:Microsoft.SqlServer.Replication.DistributionDatabase> class.</span></span>  
  
4.  <span data-ttu-id="36884-170">将 <xref:Microsoft.SqlServer.Replication.DistributionDatabase.Name%2A> 属性设置为数据库名称，并将 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> 属性设置为步骤 1 中的 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 。</span><span class="sxs-lookup"><span data-stu-id="36884-170">Set the <xref:Microsoft.SqlServer.Replication.DistributionDatabase.Name%2A> property to the database name and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1.</span></span>  
  
5.  <span data-ttu-id="36884-171">通过调用 <xref:Microsoft.SqlServer.Replication.ReplicationServer.InstallDistributor%2A> 方法安装分布服务器。</span><span class="sxs-lookup"><span data-stu-id="36884-171">Install the Distributor by calling the <xref:Microsoft.SqlServer.Replication.ReplicationServer.InstallDistributor%2A> method.</span></span> <span data-ttu-id="36884-172">传递步骤 3 中的 <xref:Microsoft.SqlServer.Replication.DistributionDatabase> 对象。</span><span class="sxs-lookup"><span data-stu-id="36884-172">Pass the <xref:Microsoft.SqlServer.Replication.DistributionDatabase> object from step 3.</span></span>  
  
6.  <span data-ttu-id="36884-173">创建的 <xref:Microsoft.SqlServer.Replication.DistributionPublisher> 类的实例。</span><span class="sxs-lookup"><span data-stu-id="36884-173">Create an instance of the <xref:Microsoft.SqlServer.Replication.DistributionPublisher> class.</span></span>  
  
7.  <span data-ttu-id="36884-174">设置 <xref:Microsoft.SqlServer.Replication.DistributionPublisher>的以下属性：</span><span class="sxs-lookup"><span data-stu-id="36884-174">Set the following properties of <xref:Microsoft.SqlServer.Replication.DistributionPublisher>:</span></span>  
  
    -   <span data-ttu-id="36884-175"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.Name%2A> - 发布服务器的名称。</span><span class="sxs-lookup"><span data-stu-id="36884-175"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.Name%2A> - name of the Publisher.</span></span>  
  
    -   <span data-ttu-id="36884-176"><xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> - 步骤 1 中的 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 。</span><span class="sxs-lookup"><span data-stu-id="36884-176"><xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> - the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1.</span></span>  
  
    -   <span data-ttu-id="36884-177"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.DistributionDatabase%2A> - 在步骤 5 中创建的数据库的名称。</span><span class="sxs-lookup"><span data-stu-id="36884-177"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.DistributionDatabase%2A> - the name of the database created in step 5.</span></span>  
  
    -   <span data-ttu-id="36884-178"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.WorkingDirectory%2A> - 用于访问快照文件的共享目录。</span><span class="sxs-lookup"><span data-stu-id="36884-178"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.WorkingDirectory%2A> - the share used to access snapshot files.</span></span>  
  
    -   <span data-ttu-id="36884-179"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.PublisherSecurity%2A> - 连接到发布服务器时使用的安全模式。</span><span class="sxs-lookup"><span data-stu-id="36884-179"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.PublisherSecurity%2A> - the security mode used when connecting to the Publisher.</span></span> <span data-ttu-id="36884-180">建议使用<xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.WindowsAuthentication%2A> 。</span><span class="sxs-lookup"><span data-stu-id="36884-180"><xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.WindowsAuthentication%2A> is recommended.</span></span>  
  
8.  <span data-ttu-id="36884-181">调用 <xref:Microsoft.SqlServer.Replication.DistributionPublisher.Create%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="36884-181">Call the <xref:Microsoft.SqlServer.Replication.DistributionPublisher.Create%2A> method.</span></span>  
  
#### <a name="to-configure-publishing-and-distribution-using-a-remote-distributor"></a><span data-ttu-id="36884-182">使用远程分发服务器配置发布和分发</span><span class="sxs-lookup"><span data-stu-id="36884-182">To configure publishing and distribution using a remote Distributor</span></span>  
  
1.  <span data-ttu-id="36884-183">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 类创建与远程分发服务器的连接。</span><span class="sxs-lookup"><span data-stu-id="36884-183">Create a connection to the remote Distributor server by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="36884-184">创建的 <xref:Microsoft.SqlServer.Replication.ReplicationServer> 类的实例。</span><span class="sxs-lookup"><span data-stu-id="36884-184">Create an instance of the <xref:Microsoft.SqlServer.Replication.ReplicationServer> class.</span></span> <span data-ttu-id="36884-185">传递步骤 1 中的 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 。</span><span class="sxs-lookup"><span data-stu-id="36884-185">Pass the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1.</span></span>  
  
3.  <span data-ttu-id="36884-186">创建的 <xref:Microsoft.SqlServer.Replication.DistributionDatabase> 类的实例。</span><span class="sxs-lookup"><span data-stu-id="36884-186">Create an instance of the <xref:Microsoft.SqlServer.Replication.DistributionDatabase> class.</span></span>  
  
4.  <span data-ttu-id="36884-187">将 <xref:Microsoft.SqlServer.Replication.DistributionDatabase.Name%2A> 属性设置为数据库名称，并将 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> 属性设置为步骤 1 中的 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 。</span><span class="sxs-lookup"><span data-stu-id="36884-187">Set the <xref:Microsoft.SqlServer.Replication.DistributionDatabase.Name%2A> property to the database name, and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1.</span></span>  
  
5.  <span data-ttu-id="36884-188">通过调用 <xref:Microsoft.SqlServer.Replication.ReplicationServer.InstallDistributor%2A> 方法安装分布服务器。</span><span class="sxs-lookup"><span data-stu-id="36884-188">Install the Distributor by calling the <xref:Microsoft.SqlServer.Replication.ReplicationServer.InstallDistributor%2A> method.</span></span> <span data-ttu-id="36884-189">指定安全密码（在连接到远程分发服务器时由发布服务器使用）和步骤 3 中的 <xref:Microsoft.SqlServer.Replication.DistributionDatabase> 对象。</span><span class="sxs-lookup"><span data-stu-id="36884-189">Specify a secure password (used by the Publisher when connecting to the remote Distributor) and the <xref:Microsoft.SqlServer.Replication.DistributionDatabase> object from step 3.</span></span> <span data-ttu-id="36884-190">有关详细信息，请参阅[保护分发服务器的安全](security/secure-the-distributor.md)。</span><span class="sxs-lookup"><span data-stu-id="36884-190">For more information, see [Secure the Distributor](security/secure-the-distributor.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="36884-191">如果可能，请在运行时提示用户输入安全凭据。</span><span class="sxs-lookup"><span data-stu-id="36884-191">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="36884-192">如果必须存储凭据，请使用 [Windows .NET Framework 提供的](https://go.microsoft.com/fwlink/?LinkId=34733) Cryptographic Services [!INCLUDE[msCoName](../../includes/msconame-md.md)] （加密服务）。</span><span class="sxs-lookup"><span data-stu-id="36884-192">If you must store credentials, use the [cryptographic services](https://go.microsoft.com/fwlink/?LinkId=34733) provided by the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows .NET Framework.</span></span>  
  
6.  <span data-ttu-id="36884-193">创建的 <xref:Microsoft.SqlServer.Replication.DistributionPublisher> 类的实例。</span><span class="sxs-lookup"><span data-stu-id="36884-193">Create an instance of the <xref:Microsoft.SqlServer.Replication.DistributionPublisher> class.</span></span>  
  
7.  <span data-ttu-id="36884-194">设置 <xref:Microsoft.SqlServer.Replication.DistributionPublisher>的以下属性：</span><span class="sxs-lookup"><span data-stu-id="36884-194">Set the following properties of <xref:Microsoft.SqlServer.Replication.DistributionPublisher>:</span></span>  
  
    -   <span data-ttu-id="36884-195"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.Name%2A> - 本地发布服务器的名称。</span><span class="sxs-lookup"><span data-stu-id="36884-195"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.Name%2A> - name of the local Publisher server.</span></span>  
  
    -   <span data-ttu-id="36884-196"><xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> - 步骤 1 中的 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 。</span><span class="sxs-lookup"><span data-stu-id="36884-196"><xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> - the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1.</span></span>  
  
    -   <span data-ttu-id="36884-197"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.DistributionDatabase%2A> - 在步骤 5 中创建的数据库的名称。</span><span class="sxs-lookup"><span data-stu-id="36884-197"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.DistributionDatabase%2A> - the name of the database created in step 5.</span></span>  
  
    -   <span data-ttu-id="36884-198"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.WorkingDirectory%2A> - 用于访问快照文件的共享目录。</span><span class="sxs-lookup"><span data-stu-id="36884-198"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.WorkingDirectory%2A> - the share used to access snapshot files.</span></span>  
  
    -   <span data-ttu-id="36884-199"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.PublisherSecurity%2A> - 连接到发布服务器时使用的安全模式。</span><span class="sxs-lookup"><span data-stu-id="36884-199"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.PublisherSecurity%2A> - the security mode used when connecting to the Publisher.</span></span> <span data-ttu-id="36884-200">建议使用<xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.WindowsAuthentication%2A> 。</span><span class="sxs-lookup"><span data-stu-id="36884-200"><xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.WindowsAuthentication%2A> is recommended.</span></span>  
  
8.  <span data-ttu-id="36884-201">调用 <xref:Microsoft.SqlServer.Replication.DistributionPublisher.Create%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="36884-201">Call the <xref:Microsoft.SqlServer.Replication.DistributionPublisher.Create%2A> method.</span></span>  
  
9. <span data-ttu-id="36884-202">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 类创建与本地发布服务器的连接。</span><span class="sxs-lookup"><span data-stu-id="36884-202">Create a connection to the local Publisher server by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
10. <span data-ttu-id="36884-203">创建的 <xref:Microsoft.SqlServer.Replication.ReplicationServer> 类的实例。</span><span class="sxs-lookup"><span data-stu-id="36884-203">Create an instance of the <xref:Microsoft.SqlServer.Replication.ReplicationServer> class.</span></span> <span data-ttu-id="36884-204">传递步骤 9 中的 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 。</span><span class="sxs-lookup"><span data-stu-id="36884-204">Pass the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 9.</span></span>  
  
11. <span data-ttu-id="36884-205">调用 <xref:Microsoft.SqlServer.Replication.ReplicationServer.InstallDistributor%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="36884-205">Call the <xref:Microsoft.SqlServer.Replication.ReplicationServer.InstallDistributor%2A> method.</span></span> <span data-ttu-id="36884-206">传递远程分发服务器的名称和在步骤 5 中指定的远程分发服务器的密码。</span><span class="sxs-lookup"><span data-stu-id="36884-206">Pass the name of the remote Distributor and the password for the remote Distributor specified in step 5.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="36884-207">如果可能，请在运行时提示用户输入安全凭据。</span><span class="sxs-lookup"><span data-stu-id="36884-207">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="36884-208">如果必须存储凭据，请使用 Windows .NET Framework 提供的 [Cryptographic Services](https://go.microsoft.com/fwlink/?LinkId=34733) （加密服务）。</span><span class="sxs-lookup"><span data-stu-id="36884-208">If you must store credentials, use the [cryptographic services](https://go.microsoft.com/fwlink/?LinkId=34733) provided by the Windows .NET Framework.</span></span>  
  
###  <a name="example-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="36884-209">示例 (RMO)</span><span class="sxs-lookup"><span data-stu-id="36884-209">Example (RMO)</span></span>  
 <span data-ttu-id="36884-210">可以通过使用复制管理对象 (RMO) 以编程方式配置复制发布和分发。</span><span class="sxs-lookup"><span data-stu-id="36884-210">You can programmatically configure replication publishing and distribution by using Replication Management Objects (RMO).</span></span>  
  
 [!code-csharp[HowTo#rmo_AddDistPub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_adddistpub)]  
  
 [!code-vb[HowTo#rmo_vb_AddDistPub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_adddistpub)]  
  
## <a name="see-also"></a><span data-ttu-id="36884-211">另请参阅</span><span class="sxs-lookup"><span data-stu-id="36884-211">See Also</span></span>  
 <span data-ttu-id="36884-212">[查看和修改分发服务器和发布服务器属性](view-and-modify-distributor-and-publisher-properties.md) </span><span class="sxs-lookup"><span data-stu-id="36884-212">[View and Modify Distributor and Publisher Properties](view-and-modify-distributor-and-publisher-properties.md) </span></span>  
 <span data-ttu-id="36884-213">[Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="36884-213">[Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md) </span></span>  
 <span data-ttu-id="36884-214">[“配置分发”](configure-distribution.md) </span><span class="sxs-lookup"><span data-stu-id="36884-214">[Configure Distribution](configure-distribution.md) </span></span>  
 <span data-ttu-id="36884-215">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="36884-215">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span></span>  
 [<span data-ttu-id="36884-216">为 AlwaysOn 可用性组 &#40;SQL Server 配置复制&#41;</span><span class="sxs-lookup"><span data-stu-id="36884-216">Configure Replication for AlwaysOn Availability Groups &#40;SQL Server&#41;</span></span>](../../database-engine/availability-groups/windows/always-on-availability-groups-sql-server.md) 
  
  
