---
title: 手动初始化订阅 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- manual subscription initialization [SQL Server replication]
- subscriptions [SQL Server replication], initializing
- initializing subscriptions [SQL Server replication], without snapshots
ms.assetid: 27a1bc38-e498-4fff-8082-04b52aa4b22c
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 4eaeb50da9e4b71a08ec78614ae62ea33e3dc0d1
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87578075"
---
# <a name="initialize-a-subscription-manually"></a><span data-ttu-id="c08e7-102">手动初始化订阅</span><span class="sxs-lookup"><span data-stu-id="c08e7-102">Initialize a Subscription Manually</span></span>
  <span data-ttu-id="c08e7-103">本主题说明如何使用 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 或 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] 在 [!INCLUDE[tsql](../../includes/tsql-md.md)]中手动初始化订阅。</span><span class="sxs-lookup"><span data-stu-id="c08e7-103">This topic describes how to initialize a subscription manually in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] or [!INCLUDE[tsql](../../includes/tsql-md.md)].</span></span> <span data-ttu-id="c08e7-104">虽然初始快照通常用于初始化订阅，但如果架构和初始数据已经在订阅服务器上存在，则可以在不使用快照的情况下初始化对发布的订阅。</span><span class="sxs-lookup"><span data-stu-id="c08e7-104">While the initial snapshot is normally used to initialize a subscription, subscriptions to publications can be initialized without using a snapshot, provided that the schema and initial data are already present at the subscriber.</span></span>  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="c08e7-105">开始之前</span><span class="sxs-lookup"><span data-stu-id="c08e7-105">Before You Begin</span></span>  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="c08e7-106">限制和局限</span><span class="sxs-lookup"><span data-stu-id="c08e7-106">Limitations and Restrictions</span></span>  
  
-   <span data-ttu-id="c08e7-107">如果在将数据及架构复制到订阅服务器和手动初始化订阅之间的时间段内，在使用事务复制发布的数据库上进行了某活动，则此活动导致的更改可能不会复制到订阅服务器。</span><span class="sxs-lookup"><span data-stu-id="c08e7-107">If there is activity on a database published using transactional replication between the time data and schema are copied to the Subscriber and the time at which the subscription is manually initialized, changes resulting from this activity might not be replicated to the Subscriber.</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="c08e7-108">使用 SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="c08e7-108">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="c08e7-109">可通过将架构（通常为数据）复制到订阅数据库，手动初始化对发布的订阅。</span><span class="sxs-lookup"><span data-stu-id="c08e7-109">Initialize a subscription to a publication manually by copying the schema (and typically data) to the subscription database.</span></span> <span data-ttu-id="c08e7-110">架构和数据应与发布数据库匹配。</span><span class="sxs-lookup"><span data-stu-id="c08e7-110">The schema and data should match the publication database.</span></span> <span data-ttu-id="c08e7-111">然后在新建订阅向导的 **“初始化订阅”** 页上指定订阅不需要架构和数据。</span><span class="sxs-lookup"><span data-stu-id="c08e7-111">Then specify that the subscription does not require schema and data on the **Initialize Subscriptions** page of the New Subscription Wizard.</span></span> <span data-ttu-id="c08e7-112">有关访问此向导的详细信息，请参阅 [初始化事务订阅（不使用快照）](initialize-a-transactional-subscription-without-a-snapshot.md) 和 [创建请求订阅](create-a-pull-subscription.md)中手动初始化订阅。</span><span class="sxs-lookup"><span data-stu-id="c08e7-112">For more information about accessing this wizard, see [Initialize a Transactional Subscription Without a Snapshot](initialize-a-transactional-subscription-without-a-snapshot.md) and [Create a Pull Subscription](create-a-pull-subscription.md).</span></span>  
  
 <span data-ttu-id="c08e7-113">首次对订阅进行同步时，复制所需的对象和元数据将复制到订阅数据库。</span><span class="sxs-lookup"><span data-stu-id="c08e7-113">When you synchronize the subscription for the first time, the objects and metadata required by replication are copied to the subscription database.</span></span>  
  
#### <a name="to-initialize-a-subscription-to-a-publication-manually"></a><span data-ttu-id="c08e7-114">手动初始化对发布的订阅</span><span class="sxs-lookup"><span data-stu-id="c08e7-114">To initialize a subscription to a publication manually</span></span>  
  
1.  <span data-ttu-id="c08e7-115">确保架构和数据已复制到订阅数据库。</span><span class="sxs-lookup"><span data-stu-id="c08e7-115">Ensure that the schema and data are copied to the subscription database.</span></span>  
  
2.  <span data-ttu-id="c08e7-116">清除 **“初始化订阅”** 页中的 **“初始化”** 复选框。</span><span class="sxs-lookup"><span data-stu-id="c08e7-116">Clear the **Initialize** check box on the **Initialize Subscriptions** page of the New Subscription Wizard.</span></span> <span data-ttu-id="c08e7-117">对每个只要求复制对象和元数据的订阅执行此操作。</span><span class="sxs-lookup"><span data-stu-id="c08e7-117">Do this for each subscription that requires only replication objects and metadata to be copied.</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="c08e7-118">使用 Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="c08e7-118">Using Transact-SQL</span></span>  
 <span data-ttu-id="c08e7-119">可以使用复制存储过程手动初始化订阅。</span><span class="sxs-lookup"><span data-stu-id="c08e7-119">Subscriptions can be initialized manually using replication stored procedures.</span></span>  
  
#### <a name="to-manually-initialize-a-pull-subscription-to-a-transactional-publication"></a><span data-ttu-id="c08e7-120">手动初始化对事务发布的请求订阅</span><span class="sxs-lookup"><span data-stu-id="c08e7-120">To manually initialize a pull subscription to a transactional publication</span></span>  
  
1.  <span data-ttu-id="c08e7-121">确保订阅数据库中存在架构和数据。</span><span class="sxs-lookup"><span data-stu-id="c08e7-121">Ensure that the schema and data exist on the subscription database.</span></span> <span data-ttu-id="c08e7-122">有关详细信息，请参阅 [初始化事务订阅（不使用快照）](initialize-a-transactional-subscription-without-a-snapshot.md)中手动初始化订阅。</span><span class="sxs-lookup"><span data-stu-id="c08e7-122">For more information, see [Initialize a Transactional Subscription Without a Snapshot](initialize-a-transactional-subscription-without-a-snapshot.md).</span></span>  
  
2.  <span data-ttu-id="c08e7-123">在发布服务器的发布数据库中，执行 [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="c08e7-123">At the Publisher on the publication database, execute [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql).</span></span> <span data-ttu-id="c08e7-124">指定 **@publication** 、 **@subscriber** 、包含已发布数据的订阅服务器上的数据库的名称 **@destination_db** 、"**请求**的值 **@subscription_type** " 和 "**仅支持复制**的值" **@sync_type** 。</span><span class="sxs-lookup"><span data-stu-id="c08e7-124">Specify **@publication**, **@subscriber**, the name of the database at the Subscriber containing the published data for **@destination_db**, a value of **pull** for **@subscription_type**, and a value of **replication support only** for **@sync_type**.</span></span> <span data-ttu-id="c08e7-125">有关详细信息，请参阅 [创建请求订阅](create-a-pull-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="c08e7-125">For more information, see [Create a Pull Subscription](create-a-pull-subscription.md).</span></span>  
  
3.  <span data-ttu-id="c08e7-126">在订阅服务器上，执行 [sp_addpullsubscription](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="c08e7-126">At the Subscriber, execute [sp_addpullsubscription](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-transact-sql).</span></span> <span data-ttu-id="c08e7-127">有关更新订阅的信息，请参阅 [Create an Updatable Subscription to a Transactional Publication](publish/create-an-updatable-subscription-to-a-transactional-publication.md)。</span><span class="sxs-lookup"><span data-stu-id="c08e7-127">For updating subscriptions, see [Create an Updatable Subscription to a Transactional Publication](publish/create-an-updatable-subscription-to-a-transactional-publication.md).</span></span>  
  
4.  <span data-ttu-id="c08e7-128">在订阅服务器上，执行 [sp_addpullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="c08e7-128">At the Subscriber, execute [sp_addpullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql).</span></span> <span data-ttu-id="c08e7-129">有关详细信息，请参阅 [创建请求订阅](create-a-pull-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="c08e7-129">For more information, see [Create a Pull Subscription](create-a-pull-subscription.md).</span></span>  
  
5.  <span data-ttu-id="c08e7-130">启动分发代理以传输复制对象，并从发布服务器下载最新更改。</span><span class="sxs-lookup"><span data-stu-id="c08e7-130">Start the Distribution Agent to transfer replication objects and download the latest changes from the Publisher.</span></span> <span data-ttu-id="c08e7-131">有关详细信息，请参阅 [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="c08e7-131">For more information, see [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md).</span></span>  
  
#### <a name="to-manually-initialize-a-push-subscription-to-a-transactional-publication"></a><span data-ttu-id="c08e7-132">手动初始化对事务发布的推送订阅</span><span class="sxs-lookup"><span data-stu-id="c08e7-132">To manually initialize a push subscription to a transactional publication</span></span>  
  
1.  <span data-ttu-id="c08e7-133">确保订阅数据库中存在架构和数据。</span><span class="sxs-lookup"><span data-stu-id="c08e7-133">Ensure that the schema and data exist on the subscription database.</span></span> <span data-ttu-id="c08e7-134">有关详细信息，请参阅 [初始化事务订阅（不使用快照）](initialize-a-transactional-subscription-without-a-snapshot.md)中手动初始化订阅。</span><span class="sxs-lookup"><span data-stu-id="c08e7-134">For more information, see [Initialize a Transactional Subscription Without a Snapshot](initialize-a-transactional-subscription-without-a-snapshot.md).</span></span>  
  
2.  <span data-ttu-id="c08e7-135">在发布服务器的发布数据库中，执行 [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="c08e7-135">At the Publisher on the publication database, execute [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql).</span></span> <span data-ttu-id="c08e7-136">指定订阅服务器上包含已发布数据的数据库的名称 **@destination_db** ，将的值指定为**push** **@subscription_type** ，并将值指定为**仅支持复制** **@sync_type** 。</span><span class="sxs-lookup"><span data-stu-id="c08e7-136">Specify the name of the database at the Subscriber containing the published data for **@destination_db**, a value of **push** for **@subscription_type**, and a value of **replication support only** for **@sync_type**.</span></span> <span data-ttu-id="c08e7-137">有关更新订阅的信息，请参阅 [Create an Updatable Subscription to a Transactional Publication](publish/create-an-updatable-subscription-to-a-transactional-publication.md)。</span><span class="sxs-lookup"><span data-stu-id="c08e7-137">For updating subscriptions, see [Create an Updatable Subscription to a Transactional Publication](publish/create-an-updatable-subscription-to-a-transactional-publication.md).</span></span>  
  
3.  <span data-ttu-id="c08e7-138">在发布服务器的发布数据库中，执行 [sp_addpushsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="c08e7-138">At the Publisher on the publication database, execute [sp_addpushsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql).</span></span> <span data-ttu-id="c08e7-139">有关详细信息，请参阅 [创建推送订阅](create-a-push-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="c08e7-139">For more information, see [Create a Push Subscription](create-a-push-subscription.md).</span></span>  
  
4.  <span data-ttu-id="c08e7-140">启动分发代理以传输复制对象，并从发布服务器下载最新更改。</span><span class="sxs-lookup"><span data-stu-id="c08e7-140">Start the Distribution Agent to transfer replication objects and download the latest changes from the Publisher.</span></span> <span data-ttu-id="c08e7-141">有关详细信息，请参阅 [同步推送订阅](synchronize-a-push-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="c08e7-141">For more information, see [Synchronize a Push Subscription](synchronize-a-push-subscription.md).</span></span>  
  
#### <a name="to-manually-initialize-a-pull-subscription-to-a-merge-publication"></a><span data-ttu-id="c08e7-142">手动初始化对合并发布的请求订阅</span><span class="sxs-lookup"><span data-stu-id="c08e7-142">To manually initialize a pull subscription to a merge publication</span></span>  
  
1.  <span data-ttu-id="c08e7-143">确保订阅数据库中存在架构和数据。</span><span class="sxs-lookup"><span data-stu-id="c08e7-143">Ensure that the schema and data exist on the subscription database.</span></span> <span data-ttu-id="c08e7-144">通过在订阅服务器上还原发布数据库的备份，即可完成此操作。</span><span class="sxs-lookup"><span data-stu-id="c08e7-144">This can be done by restoring a backup of the publication database at the Subscriber.</span></span>  
  
2.  <span data-ttu-id="c08e7-145">在发布服务器中，执行 [sp_addmergesubscription](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="c08e7-145">At the Publisher, execute [sp_addmergesubscription](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql).</span></span> <span data-ttu-id="c08e7-146">指定 **@publication** 、 **@subscriber** 、 **@subscriber_db** 和**的**值 **@subscription_type** 。</span><span class="sxs-lookup"><span data-stu-id="c08e7-146">Specify **@publication**, **@subscriber**, **@subscriber_db**, and a value of **pull** for **@subscription_type**.</span></span> <span data-ttu-id="c08e7-147">这样便可注册请求订阅。</span><span class="sxs-lookup"><span data-stu-id="c08e7-147">This registers the pull subscription.</span></span>  
  
3.  <span data-ttu-id="c08e7-148">在订阅服务器上，对包含已发布数据的数据库执行 [sp_addmergepullsubscription](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="c08e7-148">At the Subscriber on the database containing the published data, execute [sp_addmergepullsubscription](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-transact-sql).</span></span> <span data-ttu-id="c08e7-149">将 **@sync_type** 的值指定为 **@sync_type**中手动初始化订阅。</span><span class="sxs-lookup"><span data-stu-id="c08e7-149">Specify a value of **none** for **@sync_type**.</span></span>  
  
4.  <span data-ttu-id="c08e7-150">在订阅服务器上，执行 [sp_addmergepullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="c08e7-150">At the Subscriber, execute [sp_addmergepullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql).</span></span> <span data-ttu-id="c08e7-151">有关详细信息，请参阅 [创建请求订阅](create-a-pull-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="c08e7-151">For more information, see [Create a Pull Subscription](create-a-pull-subscription.md).</span></span>  
  
5.  <span data-ttu-id="c08e7-152">启动合并代理以传输复制对象，并从发布服务器下载最新更改。</span><span class="sxs-lookup"><span data-stu-id="c08e7-152">Start the Merge Agent to transfer replication objects and download the latest changes from the Publisher.</span></span> <span data-ttu-id="c08e7-153">有关详细信息，请参阅 [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="c08e7-153">For more information, see [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md).</span></span>  
  
#### <a name="to-manually-initialize-a-push-subscription-to-a-merge-publication"></a><span data-ttu-id="c08e7-154">手动初始化对合并发布的推送订阅</span><span class="sxs-lookup"><span data-stu-id="c08e7-154">To manually initialize a push subscription to a merge publication</span></span>  
  
1.  <span data-ttu-id="c08e7-155">确保订阅数据库中存在架构和数据。</span><span class="sxs-lookup"><span data-stu-id="c08e7-155">Ensure that the schema and data exist on the subscription database.</span></span> <span data-ttu-id="c08e7-156">通过在订阅服务器上还原发布数据库的备份，即可完成此操作。</span><span class="sxs-lookup"><span data-stu-id="c08e7-156">This can be done by restoring a backup of the publication database at the Subscriber.</span></span>  
  
2.  <span data-ttu-id="c08e7-157">在发布服务器的发布数据库中，执行 [sp_addmergesubscription](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="c08e7-157">At the Publisher on the publication database, execute [sp_addmergesubscription](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql).</span></span> <span data-ttu-id="c08e7-158">指定订阅服务器上包含已发布数据的数据库的名称 **@subscriber_db** ，将的值指定为**push** ， **@subscription_type** 将值指定为**none** **@sync_type** 。</span><span class="sxs-lookup"><span data-stu-id="c08e7-158">Specify the name of the database at the Subscriber containing the published data for **@subscriber_db**, a value of **push** for **@subscription_type**, and a value of **none** for **@sync_type**.</span></span>  
  
3.  <span data-ttu-id="c08e7-159">在发布服务器的发布数据库中，执行 [sp_addmergepushsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepushsubscription-agent-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="c08e7-159">At the Publisher on the publication database, execute [sp_addmergepushsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepushsubscription-agent-transact-sql).</span></span> <span data-ttu-id="c08e7-160">有关详细信息，请参阅 [创建推送订阅](create-a-push-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="c08e7-160">For more information, see [Create a Push Subscription](create-a-push-subscription.md).</span></span>  
  
4.  <span data-ttu-id="c08e7-161">启动合并代理以传输复制对象，并从发布服务器下载最新更改。</span><span class="sxs-lookup"><span data-stu-id="c08e7-161">Start the Merge Agent to transfer replication objects and download the latest changes from the Publisher.</span></span> <span data-ttu-id="c08e7-162">有关详细信息，请参阅 [同步推送订阅](synchronize-a-push-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="c08e7-162">For more information, see [Synchronize a Push Subscription](synchronize-a-push-subscription.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="c08e7-163">另请参阅</span><span class="sxs-lookup"><span data-stu-id="c08e7-163">See Also</span></span>  
 <span data-ttu-id="c08e7-164">[初始化事务订阅（不使用快照）](initialize-a-transactional-subscription-without-a-snapshot.md) </span><span class="sxs-lookup"><span data-stu-id="c08e7-164">[Initialize a Transactional Subscription Without a Snapshot](initialize-a-transactional-subscription-without-a-snapshot.md) </span></span>  
 <span data-ttu-id="c08e7-165">[备份和还原复制的数据库](administration/back-up-and-restore-replicated-databases.md) </span><span class="sxs-lookup"><span data-stu-id="c08e7-165">[Back Up and Restore Replicated Databases](administration/back-up-and-restore-replicated-databases.md) </span></span>  
 [<span data-ttu-id="c08e7-166">复制安全最佳做法</span><span class="sxs-lookup"><span data-stu-id="c08e7-166">Replication Security Best Practices</span></span>](security/replication-security-best-practices.md)  
  
  
