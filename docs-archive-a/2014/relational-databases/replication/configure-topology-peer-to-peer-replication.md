---
title: 配置拓扑（对等复制）| Microsoft Docs
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
f1_keywords:
- sql12.rep.p2pwizard.peers.f1
ms.assetid: 5377c59f-2e25-4852-a306-c87ae3dca9fd
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 2dfc09f5ae7f488afd46f29c301d11b7687e0a4b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87577573"
---
# <a name="configure-topology-peer-to-peer-replication"></a><span data-ttu-id="a1ca4-102">配置拓扑（对等复制）</span><span class="sxs-lookup"><span data-stu-id="a1ca4-102">Configure Topology (Peer-to-Peer Replication)</span></span>
  <span data-ttu-id="a1ca4-103">可以使用 **“配置拓扑”** 页执行常见的配置任务，如添加新节点、删除节点，以及在现有节点之间添加新连接。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-103">Use the **Configure topology** page to perform common configuration tasks, such as adding new nodes, deleting nodes, and adding new connections between existing nodes.</span></span> <span data-ttu-id="a1ca4-104">在此向导的 **“发布”** 页上选定的节点会显示在设计图面上。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-104">The node you selected on the **Publication** page of this wizard is displayed on the design surface.</span></span> <span data-ttu-id="a1ca4-105">若要指定配置选项，请右键单击某个节点、连接或者设计图面。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-105">To specify configuration options, right-click a node, a connection, or the design surface.</span></span>

> [!NOTE]
>  <span data-ttu-id="a1ca4-106">配置对等拓扑向导关闭时请求拓扑信息。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-106">The Configure Peer to Peer Topology Wizard requests topology information when the wizard is closed.</span></span> <span data-ttu-id="a1ca4-107">如果该向导在所有节点响应信息请求之前关闭并重新打开，则该向导可能会显示部分网络。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-107">If the wizard is closed and reopened before all nodes respond to the request for information, the wizard might show a partial network.</span></span>

## <a name="options"></a><span data-ttu-id="a1ca4-108">选项</span><span class="sxs-lookup"><span data-stu-id="a1ca4-108">Options</span></span>
 <span data-ttu-id="a1ca4-109">**“配置拓扑”** 页包含界面元素和在右键单击元素后显示的选项。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-109">The **Configure topology** page contains interface elements and options that are available when you right-click an element.</span></span> <span data-ttu-id="a1ca4-110">下表对每一界面元素进行了介绍。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-110">The following table describes each interface element.</span></span>

|<span data-ttu-id="a1ca4-111">界面元素</span><span class="sxs-lookup"><span data-stu-id="a1ca4-111">Interface Element</span></span>|<span data-ttu-id="a1ca4-112">说明</span><span class="sxs-lookup"><span data-stu-id="a1ca4-112">Description</span></span>|
|-----------------------|-----------------|
|<span data-ttu-id="a1ca4-113">设计图面</span><span class="sxs-lookup"><span data-stu-id="a1ca4-113">Design surface</span></span>|<span data-ttu-id="a1ca4-114">显示其他界面元素。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-114">Displays other interface elements.</span></span> <span data-ttu-id="a1ca4-115">若要添加元素，请右键单击设计图面。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-115">To add elements, right-click the design surface.</span></span>|
|<span data-ttu-id="a1ca4-116">![拓扑中的第一个节点](media/p2pwizard-firstnode.gif "拓扑中的第一个节点")</span><span class="sxs-lookup"><span data-stu-id="a1ca4-116">![The first node in a topology](media/p2pwizard-firstnode.gif "The first node in a topology")</span></span>|<span data-ttu-id="a1ca4-117">拓扑中的原始节点。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-117">The original node in the topology.</span></span> <span data-ttu-id="a1ca4-118">可使用来自原始节点的发布数据库副本初始化新节点。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-118">New nodes are initialized by using a copy of the publication database from the original node.</span></span>|
|<span data-ttu-id="a1ca4-119">![具有其完整信息](media/p2pwizard-complete.gif "信息完整的节点")或更高版本的节点，复制具有其完整信息。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-119">![A node for which we have complete information](media/p2pwizard-complete.gif "A node for which we have complete information") or a later version, for which replication has complete information.</span></span> <span data-ttu-id="a1ca4-120">若要指定配置选项，请右键单击此节点。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-120">To specify configuration options, right-click the node.</span></span>|
|<span data-ttu-id="a1ca4-121">![信息不完整的节点](media/p2pwizard-incomplete.gif "信息不完整的节点")</span><span class="sxs-lookup"><span data-stu-id="a1ca4-121">![A node for which we have incomplete information](media/p2pwizard-incomplete.gif "A node for which we have incomplete information")</span></span>|<span data-ttu-id="a1ca4-122">复制具有其不完整信息的节点。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-122">A node for which replication has incomplete information.</span></span> <span data-ttu-id="a1ca4-123">若要指定配置选项，请右键单击此节点。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-123">To specify configuration options, right-click the node.</span></span> <span data-ttu-id="a1ca4-124">复制具有的信息不完整，原因为以下之一：</span><span class="sxs-lookup"><span data-stu-id="a1ca4-124">Replication has incomplete information because of one of the following reasons:</span></span><br /><br /> <span data-ttu-id="a1ca4-125">节点运行的是 [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] 实例，该实例没有存储向导所需的所有元数据。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-125">The node is running an instance of [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)], which does not store all the metadata required by the wizard.</span></span><br /><br /> <span data-ttu-id="a1ca4-126">节点运行的是 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的更高版本，但是复制无法从此节点检索订阅信息。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-126">The node is running a later version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], but replication cannot retrieve subscription information from the node.</span></span> <span data-ttu-id="a1ca4-127">针对此情况进行故障排除：</span><span class="sxs-lookup"><span data-stu-id="a1ca4-127">To troubleshoot this situation:</span></span><br /><span data-ttu-id="a1ca4-128">-请确保节点上的数据库处于联机状态，并且可以通过使用与连接到该节点的分发代理相同的凭据连接到该数据库。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-128">-Make sure that the database at the node is online and that you can connect to it by using the same credentials as the Distribution Agents that connect to the node.</span></span><br /><span data-ttu-id="a1ca4-129">-请确保连接到该节点的日志读取器代理和所有分发代理正在运行。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-129">-Make sure that the Log Reader Agent and all Distribution Agents that connect to the node are running.</span></span><br /><span data-ttu-id="a1ca4-130">-请确保刷新超时设置为足够高，以便收集所有拓扑信息。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-130">-Make sure that the refresh timeout is set high enough to gather all topology information.</span></span> <span data-ttu-id="a1ca4-131">若要设置超时，请右键单击设计图面，然后单击 **“设置刷新超时”**。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-131">To set the time-out, right-click the design surface, and click **Set Refresh Timeout**.</span></span>|
|<span data-ttu-id="a1ca4-132">灰色箭头线</span><span class="sxs-lookup"><span data-stu-id="a1ca4-132">Gray line with arrows</span></span>|<span data-ttu-id="a1ca4-133">两个节点之间的连接。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-133">The connection between two nodes.</span></span> <span data-ttu-id="a1ca4-134">若要添加连接，请右键单击要连接的节点之一。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-134">To add a connection, right-click one of the nodes that you want to connect.</span></span> <span data-ttu-id="a1ca4-135">若要删除某连接，请右键单击该连接。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-135">To remove a connection, right-click the connection.</span></span><br /><br /> <span data-ttu-id="a1ca4-136">如果箭头线上只有一个箭头，则表明复制拥有的其中一个节点的信息不完整。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-136">If the line has a single arrow, replication has incomplete information for one of the nodes.</span></span>|

### <a name="options-for-the-design-surface"></a><span data-ttu-id="a1ca4-137">设计图面选项</span><span class="sxs-lookup"><span data-stu-id="a1ca4-137">Options for the Design Surface</span></span>
 <span data-ttu-id="a1ca4-138">**重绘图形** 重绘设计图面上的对象而不刷新拓扑。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-138">**Redraw Graph** Redraw the objects on the design surface without refreshing the topology.</span></span> <span data-ttu-id="a1ca4-139">重绘操作可以提供一个更好的拓扑视图。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-139">Redrawing might provide a better view of the topology.</span></span>

 <span data-ttu-id="a1ca4-140">**刷新拓扑** 查询拓扑中每一节点，然后显示更新后的节点信息。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-140">**Refresh Topology** Query each node in the topology, and display updated information about each node.</span></span> <span data-ttu-id="a1ca4-141">如果节点数目较大，此过程可能需要几分钟。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-141">With many nodes, this process can take several minutes.</span></span>

 <span data-ttu-id="a1ca4-142">如果向导请求拓扑信息，而您未等到所有节点都响应此请求就关闭并重新打开了向导，则页面可能不会显示拓扑中的所有节点。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-142">If the wizard requests topology information, and then you close and reopen the wizard before all nodes respond to the request, this page might not display all nodes in the topology.</span></span>

 <span data-ttu-id="a1ca4-143">**添加新的对等节点**将的实例添加 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 到对等拓扑。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-143">**Add a New Peer Node** Add an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to the peer-to-peer topology.</span></span> <span data-ttu-id="a1ca4-144">如果将某实例添加为节点，在向导完成后会在该实例上创建一个发布。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-144">Adding an instance as a node creates a publication at that instance after the wizard completes.</span></span> <span data-ttu-id="a1ca4-145">添加该节点后，右键单击该节点可在此新节点和现有节点之间添加连接。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-145">After you add the node, right-click it to add a connection between the new node and an existing node.</span></span>

 <span data-ttu-id="a1ca4-146">若要加入对等拓扑，实例必须满足以下要求：</span><span class="sxs-lookup"><span data-stu-id="a1ca4-146">To participate in a peer-to-peer topology, the instance must meet the following requirements:</span></span>

-   <span data-ttu-id="a1ca4-147">实例必须已经配置为分发服务器，或者已与远程分发服务器关联。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-147">It must already be configured as a Distributor or be associated with a remote Distributor.</span></span>

-   <span data-ttu-id="a1ca4-148">实例必须包含复制所涉及数据库的副本。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-148">It must contain a copy of the database involved in replication.</span></span> <span data-ttu-id="a1ca4-149">此副本通常是原始发布数据库的已还原备份。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-149">This copy is typically a restored backup of the original publication database.</span></span>

 <span data-ttu-id="a1ca4-150">\*\*选择要查看的节点 () \*\*选择要在设计图面上查看的节点。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-150">**Select Node(s) to View** Select which nodes to view on the design surface.</span></span> <span data-ttu-id="a1ca4-151">如果拓扑包含大量节点，则此选项颇为有用。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-151">This option is useful if the topology has a large number of nodes.</span></span> <span data-ttu-id="a1ca4-152">请注意，您只能在设计图面上可见的节点间添加连接。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-152">Be aware that you can add connections only between nodes that are visible on the design surface.</span></span>

 <span data-ttu-id="a1ca4-153">**“设置刷新超时”** 指定刷新过程在超时之前可以运行的时间。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-153">**Set Refresh Timeout** Specify how long the refresh process can run before the operation times out.</span></span>

### <a name="options-for-each-node"></a><span data-ttu-id="a1ca4-154">每个节点的选项</span><span class="sxs-lookup"><span data-stu-id="a1ca4-154">Options for Each Node</span></span>
 <span data-ttu-id="a1ca4-155">**添加新的对等连接** 在两个节点之间添加连接。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-155">**Add a New Peer Connection** Add a connection between two nodes.</span></span> <span data-ttu-id="a1ca4-156">例如，如果要在节点 A 和节点 B 之间添加连接，则复制会添加两个订阅：第一个订阅使节点 A 可以接收来自节点 B 上的发布的更改，第二个订阅使节点 B 可以接收来自节点 A 上的发布的更改。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-156">For example, if you add a connection between Node A and Node B, replication adds two subscriptions: The first enables Node A to receive changes from the publication at Node B, and the second enables Node B to receive changes from the publication at Node A.</span></span>

 <span data-ttu-id="a1ca4-157">**删除对等节点** 从拓扑中删除节点。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-157">**Delete Peer Node** Removes a node from the topology.</span></span> <span data-ttu-id="a1ca4-158">例如，如果删除了节点 C，则该节点上的发布也会删除。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-158">For example, if you remove Node C, the publication at that node is removed.</span></span> <span data-ttu-id="a1ca4-159">节点 A 和节点 C 以及节点 B 和节点 C 之间的订阅也会删除。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-159">Subscriptions between Node A and Node C, and Node B and Node C are also removed.</span></span> <span data-ttu-id="a1ca4-160">而节点 C 上的数据库不会删除，发布和分发也不会禁用。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-160">The database at Node C is not deleted, and publishing and distribution are not disabled.</span></span>

> [!NOTE]
>  <span data-ttu-id="a1ca4-161">配置对等复制时，可以为每个节点指定一个 ID。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-161">When you configure peer-to-peer replication, you specify an ID for each node.</span></span> <span data-ttu-id="a1ca4-162">此 ID 对于拓扑中的所有节点必须是唯一的，存储于 [MSpeer_originatorid_history](/sql/relational-databases/system-tables/mspeer-originatorid-history-transact-sql) 系统表的 originator_id 列中。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-162">This ID, which must be unique across all nodes in the topology, is stored in the originator_id column in the [MSpeer_originatorid_history](/sql/relational-databases/system-tables/mspeer-originatorid-history-transact-sql) system table.</span></span> <span data-ttu-id="a1ca4-163">如果从拓扑中删除节点，此 ID 仍会保留在历史记录表中。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-163">If a node is removed from the topology, the ID is still retained in the history table.</span></span> <span data-ttu-id="a1ca4-164">保留此 ID 是为了防止当存在来自整个拓扑中仍在复制的已删除节点的更改时出现虚假冲突。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-164">The ID is retained to prevent false conflicts from occurring if there are changes from the removed node that are still being replicated across the topology.</span></span> <span data-ttu-id="a1ca4-165">如果想要对新节点重新使用该 ID，必须首先从所有节点 MSpeer_originatorid_history 表中手动删除该 ID。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-165">If you want to reuse the ID for a new node, you must first manually delete the ID from the MSpeer_originatorid_history table at all nodes.</span></span> <span data-ttu-id="a1ca4-166">在删除节点的 ID 之前，请执行 [sp_requestpeerresponse](/sql/relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql) 以确保复制从该节点进行的所有更改。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-166">Before you delete an ID for a node, execute [sp_requestpeerresponse](/sql/relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql) to verify that all changes that originated from that node have been replicated.</span></span>

 <span data-ttu-id="a1ca4-167">**连接到所有显示的节点** 在选定节点和所有其他节点之间添加连接。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-167">**Connect to ALL Displayed Nodes** Adds connections between the selected node and all other nodes.</span></span> <span data-ttu-id="a1ca4-168">例如，如果您在有三个节点的拓扑中为节点 C 选定了此选项，则复制会添加四个订阅：其中两个订阅使节点 A 和节点 B 可以接收来自节点 C 上的发布的更改，而另两个订阅使节点 C 可以接收来自节点 A 和节点 B 上的发布的更改。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-168">For example, if you selected this option for Node C in a three node topology, replication adds four subscriptions: two that enable Node A and Node B to receive changes from the publication at Node C, and two that enable Node C to receive changes from the publications at Node A and Node B.</span></span>

 <span data-ttu-id="a1ca4-169">\*\*选择要查看的节点 () \*\*选择要在设计图面上查看的节点。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-169">**Select Node(s) to View** Select which nodes to view on the design surface.</span></span> <span data-ttu-id="a1ca4-170">如果拓扑包含大量节点，则此选项颇为有用。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-170">This option is useful if the topology has a large number of nodes.</span></span> <span data-ttu-id="a1ca4-171">请注意，您只能在设计图面上可见的节点间添加连接。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-171">Be aware that you can add connections only between nodes that are visible on the design surface.</span></span>

### <a name="options-for-the-connection-arrows"></a><span data-ttu-id="a1ca4-172">针对连接箭头的选项</span><span class="sxs-lookup"><span data-stu-id="a1ca4-172">Options for the Connection Arrows</span></span>
 <span data-ttu-id="a1ca4-173">**删除对等连接** 删除两个节点之间的连接。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-173">**Remove Peer Connection** Remove a connection between two nodes.</span></span> <span data-ttu-id="a1ca4-174">例如，如果要删除节点 A 和节点 B 之间的连接，则复制会删除两个订阅：一个订阅使节点 A 可以接收来自节点 B 上的发布的更改，另一个订阅使节点 B 可以接收来自节点 A 上的发布的更改。</span><span class="sxs-lookup"><span data-stu-id="a1ca4-174">For example, if you remove a connection between Node A and Node B, replication drops two subscriptions: the one that enables Node A to receive changes from the publication at Node B, and the one that enables Node B to receive changes from the publication at Node A.</span></span>

## <a name="see-also"></a><span data-ttu-id="a1ca4-175">另请参阅</span><span class="sxs-lookup"><span data-stu-id="a1ca4-175">See Also</span></span>
 <span data-ttu-id="a1ca4-176">[配置发布和分发](configure-publishing-and-distribution.md)[管理对等拓扑 &#40;复制 Transact-sql 编程&#41;](administration/administer-a-peer-to-peer-topology-replication-transact-sql-programming.md) [对等事务复制](transactional/peer-to-peer-transactional-replication.md)</span><span class="sxs-lookup"><span data-stu-id="a1ca4-176">[Configure Publishing and Distribution](configure-publishing-and-distribution.md) [Administer a Peer-to-Peer Topology &#40;Replication Transact-SQL Programming&#41;](administration/administer-a-peer-to-peer-topology-replication-transact-sql-programming.md) [Peer-to-Peer Transactional Replication](transactional/peer-to-peer-transactional-replication.md)</span></span>


