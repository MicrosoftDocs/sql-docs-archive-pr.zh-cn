---
title: 验证已复制的数据 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- Subscribers [SQL Server replication], data validation
- replication [SQL Server], validating data
- transactional replication, validating data
- validating data
- merge replication data validation [SQL Server replication], SQL Server Management Studio
ms.assetid: 215b4c9a-0ce9-4c00-ac0b-43b54151dfa3
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 4d09750c0cb81d64f5921ae2064b2e75edb6ca96
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87576625"
---
# <a name="validate-replicated-data"></a><span data-ttu-id="3490b-102">验证已复制的数据</span><span class="sxs-lookup"><span data-stu-id="3490b-102">Validate Replicated Data</span></span>
  <span data-ttu-id="3490b-103">本主题说明如何使用 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 、 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]或复制管理对象 (RMO) 在 [!INCLUDE[tsql](../../includes/tsql-md.md)]中验证订阅服务器上的数据。</span><span class="sxs-lookup"><span data-stu-id="3490b-103">This topic describes how to validate data at the Subscriber in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span>  

  <span data-ttu-id="3490b-104">通过事务复制和合并复制，您可以验证订阅服务器中的数据与发布服务器中的数据是否匹配。</span><span class="sxs-lookup"><span data-stu-id="3490b-104">Transactional and merge replication allow you to validate that data at the Subscriber matches data at the Publisher.</span></span> <span data-ttu-id="3490b-105">可以对特定订阅或某一发布的所有订阅执行验证。</span><span class="sxs-lookup"><span data-stu-id="3490b-105">Validation can be performed for specific subscriptions or for all subscriptions to a publication.</span></span> <span data-ttu-id="3490b-106">指定下列验证类型之一，分发代理或合并代理便会在下次运行时验证数据：</span><span class="sxs-lookup"><span data-stu-id="3490b-106">Specify one of the following validation types and the Distribution Agent or Merge Agent will validate data the next time it runs:</span></span>  
  
-   <span data-ttu-id="3490b-107">**仅行计数**。</span><span class="sxs-lookup"><span data-stu-id="3490b-107">**Row count only**.</span></span> <span data-ttu-id="3490b-108">此选项将验证订阅服务器上的表与发布服务器上的表的行数是否相同，但不验证行内容是否匹配。</span><span class="sxs-lookup"><span data-stu-id="3490b-108">This validates whether the table at the Subscriber has the same number of rows as the table at the Publisher, but does not validate that the content of the rows matches.</span></span> <span data-ttu-id="3490b-109">行计数验证是一种简易验证方法，可帮助您了解数据是否存在问题。</span><span class="sxs-lookup"><span data-stu-id="3490b-109">Row count validation provides a lightweight approach to validation that can make you aware of issues with your data.</span></span>    
-   <span data-ttu-id="3490b-110">**行计数和二进制校验和**。</span><span class="sxs-lookup"><span data-stu-id="3490b-110">**Row count and binary checksum**.</span></span> <span data-ttu-id="3490b-111">除了可在发布服务器和订阅服务器上对行进行计数之外，还可使用校验和算法来计算所有数据的校验和。</span><span class="sxs-lookup"><span data-stu-id="3490b-111">In addition to taking a count of rows at the Publisher and Subscriber, a checksum of all the data is calculated using the checksum algorithm.</span></span> <span data-ttu-id="3490b-112">如果行计数失败，则不计算校验和。</span><span class="sxs-lookup"><span data-stu-id="3490b-112">If the row count fails, the checksum is not performed.</span></span>  
  
 <span data-ttu-id="3490b-113">除了验证订阅服务器和发布服务器上的数据是否匹配之外，合并复制还提供验证每个订阅服务器上的数据是否正确分区的功能。</span><span class="sxs-lookup"><span data-stu-id="3490b-113">In addition to validating that data at the Subscriber and Publisher match, merge replication provides the ability to validate that data is partitioned correctly for each Subscriber.</span></span> <span data-ttu-id="3490b-114">有关详细信息，请参阅[验证合并订阅服务器的分区信息](validate-partition-information-for-a-merge-subscriber.md)。</span><span class="sxs-lookup"><span data-stu-id="3490b-114">For more information, see [Validate Partition Information for a Merge Subscriber](validate-partition-information-for-a-merge-subscriber.md).</span></span>  

## <a name="how-data-validation-works"></a><span data-ttu-id="3490b-115">数据验证的工作机制</span><span class="sxs-lookup"><span data-stu-id="3490b-115">How Data Validation Works</span></span>  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="3490b-116">通过计算发布服务器上的行计数或校验和，并将这些值与订阅服务器上计算所得的行计数或校验和值比较来验证数据。</span><span class="sxs-lookup"><span data-stu-id="3490b-116">validates data by calculating a row count or a checksum at the Publisher and then comparing those values to the row count or checksum calculated at the Subscriber.</span></span> <span data-ttu-id="3490b-117">为整个发布表和整个订阅表各计算一个值，但计算中不包括 `text`、`ntext` 或 `image` 列中的数据。</span><span class="sxs-lookup"><span data-stu-id="3490b-117">One value is calculated for the entire publication table and one value is calculated for the entire subscription table, but data in `text`, `ntext`, or `image` columns is not included in the calculations.</span></span>  
  
 <span data-ttu-id="3490b-118">执行计算时，共享锁临时放置对其执行行计数或校验和的表上，不过计算很快完成，同时共享锁被删除，这一过程通常只需几秒钟。</span><span class="sxs-lookup"><span data-stu-id="3490b-118">While the calculations are performed, shared locks are placed temporarily on tables for which row counts or checksums are being run, but the calculations are completed quickly and the shared locks removed, usually in a matter of seconds.</span></span>  
  
 <span data-ttu-id="3490b-119">使用二进制校验和时，32 位冗余校验 (CRC) 将逐列进行，而不是在数据页的物理行上进行。</span><span class="sxs-lookup"><span data-stu-id="3490b-119">When binary checksums are used, 32-bit redundancy check (CRC) occurs on a column-by-column basis rather than a CRC on the physical row on the data page.</span></span> <span data-ttu-id="3490b-120">这使得表中的列可以按任意顺序在数据页上进行物理排序，但对该行计算的 CRC 值不变。</span><span class="sxs-lookup"><span data-stu-id="3490b-120">This allows the columns with the table to be in any order physically on the data page, but still compute to the same CRC for the row.</span></span> <span data-ttu-id="3490b-121">发布上有行筛选器或列筛选器时，可使用二进制校验和进行验证。</span><span class="sxs-lookup"><span data-stu-id="3490b-121">Binary checksum validation can be used when there are row or column filters on the publication.</span></span>  
  
 <span data-ttu-id="3490b-122">验证数据分为三个部分：</span><span class="sxs-lookup"><span data-stu-id="3490b-122">Validating data is a three-part process:</span></span>  
  
1.  <span data-ttu-id="3490b-123">将对发布的单个或所有订阅“标记”  为要验证。</span><span class="sxs-lookup"><span data-stu-id="3490b-123">A single subscription or all subscriptions to a publication are *marked* for validation.</span></span> <span data-ttu-id="3490b-124">可以在“验证单个订阅”、“验证多个订阅”和“验证所有订阅”对话框中，将订阅标记为要验证，这些对话框可以通过 [!INCLUDE[msCoName](../../includes/msconame-md.md)][!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] 中的“本地发布”**文件夹和“本地订阅”** 文件夹访问。</span><span class="sxs-lookup"><span data-stu-id="3490b-124">Mark subscriptions for validation in the **Validate Subscription**, **Validate Subscriptions**, and **Validate All Subscriptions** dialog boxes, which are available from the **Local Publications** folder and the **Local Subscriptions** folder in [!INCLUDE[msCoName](../../includes/msconame-md.md)][!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span></span> <span data-ttu-id="3490b-125">也可以从 **“所有订阅”** 选项卡、 **“订阅监视列表”** 选项卡和复制监视器中的发布节点中对订阅进行标记。</span><span class="sxs-lookup"><span data-stu-id="3490b-125">You can also mark subscriptions from the **All Subscriptions** tab, the **Subscription Watch List** tab, and the publications node in Replication Monitor.</span></span> <span data-ttu-id="3490b-126">有关启动复制监视器的信息，请参阅[启动复制监视器](monitor/start-the-replication-monitor.md)。</span><span class="sxs-lookup"><span data-stu-id="3490b-126">For information about starting Replication Monitor, see [Start the Replication Monitor](monitor/start-the-replication-monitor.md).</span></span>  
  
2.  <span data-ttu-id="3490b-127">下次分发代理（对于事务复制）或合并代理（对于合并复制）同步订阅时，将对订阅进行验证。</span><span class="sxs-lookup"><span data-stu-id="3490b-127">A subscription is validated the next time it is synchronized by the Distribution Agent (for transactional replication) or the Merge Agent (for merge replication).</span></span> <span data-ttu-id="3490b-128">分发代理通常是连续运行的，在这种情况下验证会立即进行；合并代理通常是按需运行的，在这种情况下验证在运行代理后进行。</span><span class="sxs-lookup"><span data-stu-id="3490b-128">The Distribution Agent typically runs continuously, in which case validation occurs immediately; the Merge Agent typically runs on demand, in which case validation occurs after you run the agent.</span></span>  
  
3.  <span data-ttu-id="3490b-129">查看验证结果：</span><span class="sxs-lookup"><span data-stu-id="3490b-129">View the validation results:</span></span>  
  
    -  <span data-ttu-id="3490b-130">在复制监视器的详细信息窗口中查看：对于事务复制，在 **“分发服务器到订阅服务器的历史记录”** 选项卡中；对于合并复制，在 **“同步历史记录”** 选项卡中。</span><span class="sxs-lookup"><span data-stu-id="3490b-130">In the detail windows in Replication Monitor: on the **Distributor to Subscriber History** tab for transactional replication and the **Synchronization History** tab for merge replication.</span></span>    
    -  <span data-ttu-id="3490b-131">在 **的** “查看同步状态” [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)]对话框中查看。</span><span class="sxs-lookup"><span data-stu-id="3490b-131">In the **View Synchronization Status** dialog box in [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)].</span></span>  
  


  
## <a name="considerations-and-restrictions"></a><span data-ttu-id="3490b-132">注意事项和限制</span><span class="sxs-lookup"><span data-stu-id="3490b-132">Considerations and restrictions</span></span>  
  
-   <span data-ttu-id="3490b-133">复制监视器的过程仅适用于推送订阅，因为请求订阅不能在复制监视器中同步。</span><span class="sxs-lookup"><span data-stu-id="3490b-133">The procedures for Replication Monitor are for push subscriptions only because pull subscriptions cannot be synchronized in Replication Monitor.</span></span> <span data-ttu-id="3490b-134">但是，可以在复制监视器中将订阅标记为要验证并查看请求订阅的验证结果。</span><span class="sxs-lookup"><span data-stu-id="3490b-134">However, you can mark a subscription for validation and view validation results for pull subscriptions in Replication Monitor.</span></span>    
-   <span data-ttu-id="3490b-135">验证结果指示验证是成功还是失败，但如果失败，并不指定哪些行验证失败。</span><span class="sxs-lookup"><span data-stu-id="3490b-135">The validation results indicate whether validation succeeded or failed, but do not specify which rows failed validation if a failure occurred.</span></span> <span data-ttu-id="3490b-136">若要比较发布服务器和订阅服务器中的数据，请使用 [tablediff Utility](../../tools/tablediff-utility.md)。</span><span class="sxs-lookup"><span data-stu-id="3490b-136">To compare data at the Publisher and Subscriber, use the [tablediff Utility](../../tools/tablediff-utility.md).</span></span> <span data-ttu-id="3490b-137">若要详细了解如何将此实用工具与已复制数据配合使用，请参阅[比较所复制表的差异（复制编程）](administration/compare-replicated-tables-for-differences-replication-programming.md)。</span><span class="sxs-lookup"><span data-stu-id="3490b-137">For more information about using this utility with replicated data, see [Compare Replicated Tables for Differences &#40;Replication Programming&#41;](administration/compare-replicated-tables-for-differences-replication-programming.md).</span></span>  
 
<span data-ttu-id="3490b-138">请在验证数据时考虑下列问题：</span><span class="sxs-lookup"><span data-stu-id="3490b-138">Take the following issues into consideration when validating data:</span></span>  
  
-   <span data-ttu-id="3490b-139">验证数据之前，必须停止订阅服务器上的一切更新活动（验证进行时不必停止发布服务器上的活动）。</span><span class="sxs-lookup"><span data-stu-id="3490b-139">You must stop all update activity at Subscribers before validating data (it is not necessary to stop activity at the Publisher when validation is occurring).</span></span>    
-   <span data-ttu-id="3490b-140">因为校验和与二进制校验和在验证大型数据集时可能需要大量处理器资源，所以应将验证安排在复制中所用服务器上的活动最少时进行。</span><span class="sxs-lookup"><span data-stu-id="3490b-140">Because checksums and binary checksums can require large amounts of processor resources when validating a large data set, you should schedule validation to occur when there is the least activity on the servers used in replication.</span></span>    
-   <span data-ttu-id="3490b-141">复制只验证表；它不验证只包含架构的项目（例如存储过程）是否在发布服务器和订阅服务器上相同。</span><span class="sxs-lookup"><span data-stu-id="3490b-141">Replication validates tables only; it does not validate whether schema only articles (such as stored procedures) are the same at the Publisher and Subscriber.</span></span>    
-   <span data-ttu-id="3490b-142">可以对任何发布的表使用二进制校验和。</span><span class="sxs-lookup"><span data-stu-id="3490b-142">Binary checksum can be used with any published table.</span></span> <span data-ttu-id="3490b-143">校验和无法验证带有列筛选器的表或列偏移量不一致的逻辑表结构（由于存在用于删除或添加列的 ALTER TABLE 语句）。</span><span class="sxs-lookup"><span data-stu-id="3490b-143">Checksum cannot validate tables with column filters, or logical table structures where column offsets differ (due to ALTER TABLE statements that drop or add columns).</span></span>    
-   <span data-ttu-id="3490b-144">复制验证使用 `checksum` 和**binary_checksum**函数。</span><span class="sxs-lookup"><span data-stu-id="3490b-144">Replication validation uses the `checksum` and **binary_checksum** functions.</span></span> <span data-ttu-id="3490b-145">有关其行为的信息，请参阅[校验和 (Transact-SQL)](/sql/t-sql/functions/checksum-transact-sql) 和 [BINARY_CHECKSUM (Transact-SQL)](/sql/t-sql/functions/binary-checksum-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="3490b-145">For  information about their behavior, see  [CHECKSUM &#40;Transact-SQL&#41;](/sql/t-sql/functions/checksum-transact-sql) and [BINARY_CHECKSUM  &#40;Transact-SQL&#41;](/sql/t-sql/functions/binary-checksum-transact-sql).</span></span>  
  
-   <span data-ttu-id="3490b-146">如果订阅服务器与发布服务器上的数据类型不同，则使用二进制校验和或校验和进行的验证可能会错误地报告失败。</span><span class="sxs-lookup"><span data-stu-id="3490b-146">Validation by using binary checksum or checksum can incorrectly report a failure if data types are different at the Subscriber than they are at the Publisher.</span></span> <span data-ttu-id="3490b-147">如果执行以下操作之一，则可能出现上述情况：</span><span class="sxs-lookup"><span data-stu-id="3490b-147">This can occur if you do any one of the following:</span></span>    
    -   <span data-ttu-id="3490b-148">显式设置架构选项从而为早期版本的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]映射数据类型。</span><span class="sxs-lookup"><span data-stu-id="3490b-148">Explicitly set schema options to map data types for earlier versions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>    
    -   <span data-ttu-id="3490b-149">将合并发布的发布兼容级别设置为早期版本的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]，并且已发布表包含一个或多个必须为此版本映射的数据类型。</span><span class="sxs-lookup"><span data-stu-id="3490b-149">Set the publication compatibility level for a merge publication to an earlier version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], and published tables contain one or more data types that must be mapped for this version.</span></span>    
    -   <span data-ttu-id="3490b-150">手动初始化订阅并且正在订阅服务器上使用不同的数据类型。</span><span class="sxs-lookup"><span data-stu-id="3490b-150">Manually initialize a subscription and are using different data types at the Subscriber.</span></span>    
-   <span data-ttu-id="3490b-151">事务复制的可转换订阅不支持二进制校验和和校验和验证。</span><span class="sxs-lookup"><span data-stu-id="3490b-151">Binary checksum and checksum validations are not supported for transformable subscriptions for transactional replication.</span></span>   
-   <span data-ttu-id="3490b-152">复制到非[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 订阅服务器的数据不支持验证。</span><span class="sxs-lookup"><span data-stu-id="3490b-152">Validation is not supported for data replicated to non-[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Subscribers.</span></span>  

## <a name="data-validation-results"></a><span data-ttu-id="3490b-153">数据验证结果</span><span class="sxs-lookup"><span data-stu-id="3490b-153">Data Validation Results</span></span>  
 <span data-ttu-id="3490b-154">验证完成时，分发代理或合并代理将记录有关成功或失败的消息（复制不报告具体失败的行）。</span><span class="sxs-lookup"><span data-stu-id="3490b-154">When validation is complete, the Distribution Agent or Merge Agent logs messages regarding success or failure (replication does not report which rows failed).</span></span> <span data-ttu-id="3490b-155">可以在 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]、复制监视器和复制系统表中查看这些消息。</span><span class="sxs-lookup"><span data-stu-id="3490b-155">These messages can be viewed in [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], Replication Monitor, and replication system tables.</span></span> <span data-ttu-id="3490b-156">上面所列的操作指南主题说明如何运行验证和查看结果。</span><span class="sxs-lookup"><span data-stu-id="3490b-156">The how-to topic listed above demonstrates how to run validation and view the results.</span></span>  
  
 <span data-ttu-id="3490b-157">若要处理验证失败，请考虑以下事项：</span><span class="sxs-lookup"><span data-stu-id="3490b-157">To handle validation failures, consider the following:</span></span>  
  
-   <span data-ttu-id="3490b-158">配置名为 **“复制: 订阅服务器未通过数据验证”** 的复制警报，以便您在验证失败时得到通知。</span><span class="sxs-lookup"><span data-stu-id="3490b-158">Configure the replication alert named **Replication: Subscriber has failed data validation** so that you are notified of the failure.</span></span> <span data-ttu-id="3490b-159">有关详细信息，请参阅 [配置预定义的复制警报 &#40;SQL Server Management Studio& # 41 (管理/配置预定义-) 。</span><span class="sxs-lookup"><span data-stu-id="3490b-159">For more information, see [Configure Predefined Replication Alerts &#40;SQL Server Management Studio&#41(administration/configure-predefined-replication-alerts-sql-server-management-studio.md).</span></span>  
  
-   <span data-ttu-id="3490b-160">验证失败是否已对您的应用程序带来问题？</span><span class="sxs-lookup"><span data-stu-id="3490b-160">Is the fact that validation failed an issue for your application?</span></span> <span data-ttu-id="3490b-161">如果验证失败带来了问题，请手动更新数据以进行同步，或者重新初始化订阅：</span><span class="sxs-lookup"><span data-stu-id="3490b-161">If the validation failure is an issue, manually update the data so that it is synchronized, or reinitialize the subscription:</span></span>  
  
    -   <span data-ttu-id="3490b-162">可以使用 [tablediff 实用工具](../../tools/tablediff-utility.md)来更新数据。</span><span class="sxs-lookup"><span data-stu-id="3490b-162">Data can be updated using the [tablediff utility](../../tools/tablediff-utility.md).</span></span> <span data-ttu-id="3490b-163">有关如何使用此实用工具的详细信息，请参阅[比较所复制表的差异（复制编程）](administration/compare-replicated-tables-for-differences-replication-programming.md)。</span><span class="sxs-lookup"><span data-stu-id="3490b-163">For more information about using this utility, see [Compare Replicated Tables for Differences &#40;Replication Programming&#41;](administration/compare-replicated-tables-for-differences-replication-programming.md).</span></span>  
  
    -   <span data-ttu-id="3490b-164">有关重新初始化的详细信息，请参阅[重新初始化订阅](reinitialize-subscriptions.md)。</span><span class="sxs-lookup"><span data-stu-id="3490b-164">For more information about reinitializaton, see [Reinitialize Subscriptions](reinitialize-subscriptions.md).</span></span>   
 
  
## <a name="articles-in-transactional-replication"></a><span data-ttu-id="3490b-165">事务复制中的项目</span><span class="sxs-lookup"><span data-stu-id="3490b-165">Articles in Transactional Replication</span></span> 

### <a name="using-sql-server-management-studio"></a><span data-ttu-id="3490b-166">使用 SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="3490b-166">Using SQL Server Management Studio</span></span>  
  
  
1.  <span data-ttu-id="3490b-167">在 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]中连接到发布服务器，然后展开服务器节点。</span><span class="sxs-lookup"><span data-stu-id="3490b-167">Connect to the Publisher in [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], and then expand the server node.</span></span>    
2.  <span data-ttu-id="3490b-168">展开 **“复制”** 文件夹，再展开 **“本地发布”** 文件夹。</span><span class="sxs-lookup"><span data-stu-id="3490b-168">Expand the **Replication** folder, and then expand the **Local Publications** folder.</span></span>    
3.  <span data-ttu-id="3490b-169">右键单击要验证其订阅的发布，然后单击 **“验证多个订阅”** 。</span><span class="sxs-lookup"><span data-stu-id="3490b-169">Right-click the publication for which you want to validate subscriptions, and then click **Validate Subscriptions**.</span></span>    
4.  <span data-ttu-id="3490b-170">在 **“验证多个订阅”** 对话框中，选择要验证的订阅：</span><span class="sxs-lookup"><span data-stu-id="3490b-170">In the **Validate Subscriptions** dialog box, select which subscriptions to validate:</span></span>    
    -   <span data-ttu-id="3490b-171">选择 **“验证所有 SQL Server 订阅”** 。</span><span class="sxs-lookup"><span data-stu-id="3490b-171">Select **Validate all SQL Server subscriptions**.</span></span>    
    -   <span data-ttu-id="3490b-172">选择 **“验证下列订阅”** ，再选择一个或多个订阅。</span><span class="sxs-lookup"><span data-stu-id="3490b-172">Select **Validate the following subscriptions**, and then select one or more subscriptions.</span></span>    
5.  <span data-ttu-id="3490b-173">若要指定要执行的验证类型（行计数，或行计数和校验和），请单击 **“验证选项”** ，然后在 **“订阅验证选项”** 对话框中指定选项。</span><span class="sxs-lookup"><span data-stu-id="3490b-173">To specify the type of validation to perform (row count, or row count and checksum) click **Validation Options**, and then specify options in the **Subscription Validation Options** dialog box.</span></span>    
6.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
7.  <span data-ttu-id="3490b-174">在复制监视器或 **“查看同步状态”** 对话框中查看验证结果。</span><span class="sxs-lookup"><span data-stu-id="3490b-174">View validation results in Replication Monitor or the **View Synchronization Status** dialog box.</span></span> <span data-ttu-id="3490b-175">对于每个订阅：</span><span class="sxs-lookup"><span data-stu-id="3490b-175">For each subscription:</span></span>    
    1.  <span data-ttu-id="3490b-176">展开发布，右键单击该订阅，然后单击 **“查看同步状态”** 。</span><span class="sxs-lookup"><span data-stu-id="3490b-176">Expand the publication, right-click the subscription, and then click **View Synchronization Status**.</span></span>    
    2.  <span data-ttu-id="3490b-177">如果代理未运行，请单击 **“查看同步状态”** 对话框中的 **“启动”** 。</span><span class="sxs-lookup"><span data-stu-id="3490b-177">If the agent is not running click **Start** in the **View Synchronization Status** dialog box.</span></span> <span data-ttu-id="3490b-178">该对话框将显示有关验证的信息性消息。</span><span class="sxs-lookup"><span data-stu-id="3490b-178">The dialog box will display informational messages regarding validation.</span></span>  
  
     <span data-ttu-id="3490b-179">如果未显示有关验证的任何消息，则说明该代理已记录了后续消息。</span><span class="sxs-lookup"><span data-stu-id="3490b-179">If you do not see any messages regarding validation, the agent has already logged a subsequent message.</span></span> <span data-ttu-id="3490b-180">在这种情况下，请在复制监视器中查看验证结果。</span><span class="sxs-lookup"><span data-stu-id="3490b-180">In this case, view the validation results in Replication Monitor.</span></span> <span data-ttu-id="3490b-181">有关详细信息，请参阅本主题中有关复制监视器相关操作的过程。</span><span class="sxs-lookup"><span data-stu-id="3490b-181">For more information, see the Replication Monitor how to procedures in this topic.</span></span>  

### <a name="using-transact-sql-t-sql"></a><span data-ttu-id="3490b-182">使用 Transact-SQL (T-SQL)</span><span class="sxs-lookup"><span data-stu-id="3490b-182">Using Transact-SQL (T-SQL)</span></span>

#### <a name="all-articles"></a><span data-ttu-id="3490b-183">所有项目</span><span class="sxs-lookup"><span data-stu-id="3490b-183">All articles</span></span>
  
1.  <span data-ttu-id="3490b-184">在发布服务器上，对发布数据库执行 [sp_publication_validation &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-publication-validation-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="3490b-184">At the Publisher on the publication database, execute [sp_publication_validation &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-publication-validation-transact-sql).</span></span> <span data-ttu-id="3490b-185">为\*\* \@ rowcount_only**指定** \@ 发布\*\*和以下值之一：</span><span class="sxs-lookup"><span data-stu-id="3490b-185">Specify **\@publication** and one of the following values for **\@rowcount_only**:</span></span>    
    -   <span data-ttu-id="3490b-186">**1** - 只检查行计数（默认值）</span><span class="sxs-lookup"><span data-stu-id="3490b-186">**1** - rowcount check only (the default)</span></span>    
    -   <span data-ttu-id="3490b-187">**2** - 行计数和二进制校验和。</span><span class="sxs-lookup"><span data-stu-id="3490b-187">**2** - rowcount and binary checksum.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="3490b-188">执行 [sp_publication_validation &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-publication-validation-transact-sql) 时，将会对发布中的每个项目执行 [sp_article_validation &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-article-validation-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="3490b-188">When you execute [sp_publication_validation &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-publication-validation-transact-sql), [sp_article_validation &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-article-validation-transact-sql) is executed for each article in the publication.</span></span> <span data-ttu-id="3490b-189">若要成功地执行 [sp_publication_validation &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-publication-validation-transact-sql)，必须对发布的基表中的所有列拥有 SELECT 权限。</span><span class="sxs-lookup"><span data-stu-id="3490b-189">To successfully execute [sp_publication_validation &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-publication-validation-transact-sql), you must have SELECT permissions on all columns in the published base tables.</span></span>  
  
2.  <span data-ttu-id="3490b-190">（可选）如果分发代理尚未运行，请为每个订阅都启动分发代理。</span><span class="sxs-lookup"><span data-stu-id="3490b-190">(Optional) Start the Distribution Agent for each subscription if it is not already running.</span></span> <span data-ttu-id="3490b-191">有关详细信息，请参阅 [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md) 和 [Synchronize a Push Subscription](synchronize-a-push-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="3490b-191">For more information, see [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md) and [Synchronize a Push Subscription](synchronize-a-push-subscription.md).</span></span>    
3.  <span data-ttu-id="3490b-192">检查代理输出以获取验证结果。</span><span class="sxs-lookup"><span data-stu-id="3490b-192">Check the agent output for the result of the validation.</span></span> <span data-ttu-id="3490b-193">有关详细信息，请参阅[验证已复制的数据](validate-data-at-the-subscriber.md)。</span><span class="sxs-lookup"><span data-stu-id="3490b-193">For more information, see [Validate Replicated Data](validate-data-at-the-subscriber.md).</span></span>  
  
#### <a name="single-article"></a><span data-ttu-id="3490b-194">单个项目</span><span class="sxs-lookup"><span data-stu-id="3490b-194">Single article</span></span> 
  
1.  <span data-ttu-id="3490b-195">在发布服务器上，对发布数据库执行 [sp_article_validation &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-article-validation-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="3490b-195">At the Publisher on the publication database, execute [sp_article_validation &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-article-validation-transact-sql).</span></span> <span data-ttu-id="3490b-196">指定\*\* \@ 发布**、 \*\* \@ 项目**的名称，并为\*\* \@ rowcount_only\*\*指定以下值之一：</span><span class="sxs-lookup"><span data-stu-id="3490b-196">Specify **\@publication**, the name of the article for **\@article**, and one of the following values for **\@rowcount_only**:</span></span>    
    -   <span data-ttu-id="3490b-197">**1** - 只检查行计数（默认值）</span><span class="sxs-lookup"><span data-stu-id="3490b-197">**1** - Rowcount check only (the default)</span></span>    
    -   <span data-ttu-id="3490b-198">**2** -行计数和二进制校验和。</span><span class="sxs-lookup"><span data-stu-id="3490b-198">**2** - Rowcount and binary checksum.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="3490b-199">若要成功地执行 [sp_article_validation &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-article-validation-transact-sql)，必须对发布的基表中的所有列拥有 SELECT 权限。</span><span class="sxs-lookup"><span data-stu-id="3490b-199">To successfully execute [sp_article_validation &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-article-validation-transact-sql), you must have SELECT permissions on all columns in the published base table.</span></span>  
  
2.  <span data-ttu-id="3490b-200">（可选）如果分发代理尚未运行，请为每个订阅都启动分发代理。</span><span class="sxs-lookup"><span data-stu-id="3490b-200">(Optional) Start the Distribution Agent for each subscription if it is not already running.</span></span> <span data-ttu-id="3490b-201">有关详细信息，请参阅 [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md) 和 [Synchronize a Push Subscription](synchronize-a-push-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="3490b-201">For more information, see [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md) and [Synchronize a Push Subscription](synchronize-a-push-subscription.md).</span></span>    
3.  <span data-ttu-id="3490b-202">检查代理输出以获取验证结果。</span><span class="sxs-lookup"><span data-stu-id="3490b-202">Check the agent output for the result of the validation.</span></span> <span data-ttu-id="3490b-203">有关详细信息，请参阅[验证已复制的数据](validate-data-at-the-subscriber.md)。</span><span class="sxs-lookup"><span data-stu-id="3490b-203">For more information, see [Validate Replicated Data](validate-data-at-the-subscriber.md).</span></span>  
  
#### <a name="single-subscriber"></a><span data-ttu-id="3490b-204">单个订阅服务器</span><span class="sxs-lookup"><span data-stu-id="3490b-204">Single subscriber</span></span>
  
1.  <span data-ttu-id="3490b-205">在发布服务器的发布数据库中，使用 [BEGIN TRANSACTION &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/begin-transaction-transact-sql) 打开一个显式事务。</span><span class="sxs-lookup"><span data-stu-id="3490b-205">At the Publisher on the publication database, open an explicit transaction using [BEGIN TRANSACTION &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/begin-transaction-transact-sql).</span></span>    
2.  <span data-ttu-id="3490b-206">在发布服务器上，对发布数据库执行 [sp_marksubscriptionvalidation &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-marksubscriptionvalidation-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="3490b-206">At the Publisher on the publication database, execute [sp_marksubscriptionvalidation &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-marksubscriptionvalidation-transact-sql).</span></span> <span data-ttu-id="3490b-207">指定**发布的发布、 \@ \*\* \*\* \@ 订阅**服务器的名称以及\*\* \@ destination_db\*\*的订阅数据库的名称。</span><span class="sxs-lookup"><span data-stu-id="3490b-207">Specify the publication for **\@publication**, the name of the Subscriber for **\@subscriber**, and the name of the subscription database for **\@destination_db**.</span></span>    
3.  <span data-ttu-id="3490b-208">（可选）对每个要验证的订阅都重复步骤 2。</span><span class="sxs-lookup"><span data-stu-id="3490b-208">(Optional) Repeat step 2 for each subscription being validated.</span></span>    
4.  <span data-ttu-id="3490b-209">在发布服务器上，对发布数据库执行 [sp_article_validation &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-article-validation-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="3490b-209">At the Publisher on the publication database, execute [sp_article_validation &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-article-validation-transact-sql).</span></span> <span data-ttu-id="3490b-210">指定\*\* \@ 发布**、 \*\* \@ 项目**的名称，并为\*\* \@ rowcount_only\*\*指定以下值之一：</span><span class="sxs-lookup"><span data-stu-id="3490b-210">Specify **\@publication**, the name of the article for **\@article**, and one of the following values for **\@rowcount_only**:</span></span>    
    -   <span data-ttu-id="3490b-211">**1** - 只检查行计数（默认值）</span><span class="sxs-lookup"><span data-stu-id="3490b-211">**1** - Rowcount check only (the default)</span></span>    
    -   <span data-ttu-id="3490b-212">**2** -行计数和二进制校验和。</span><span class="sxs-lookup"><span data-stu-id="3490b-212">**2** - Rowcount and binary checksum.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="3490b-213">若要成功地执行 [sp_article_validation &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-article-validation-transact-sql)，必须对发布的基表中的所有列拥有 SELECT 权限。</span><span class="sxs-lookup"><span data-stu-id="3490b-213">To successfully execute [sp_article_validation &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-article-validation-transact-sql), you must have SELECT permissions on all columns in the published base table.</span></span>  
  
5.  <span data-ttu-id="3490b-214">在发布服务器的发布数据库中，使用 [COMMIT TRANSACTION &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/commit-transaction-transact-sql) 提交事务。</span><span class="sxs-lookup"><span data-stu-id="3490b-214">At the Publisher on the publication database, commit the transaction using [COMMIT TRANSACTION &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/commit-transaction-transact-sql).</span></span>    
6.  <span data-ttu-id="3490b-215">（可选）为每个要验证的项目都重复步骤 1 到步骤 5。</span><span class="sxs-lookup"><span data-stu-id="3490b-215">(Optional) Repeat steps 1 through 5 for each article being validated.</span></span>    
7.  <span data-ttu-id="3490b-216">（可选）如果分发代理尚未运行，请启动分发代理。</span><span class="sxs-lookup"><span data-stu-id="3490b-216">(Optional) Start the Distribution Agent if it is not already running.</span></span> <span data-ttu-id="3490b-217">有关详细信息，请参阅 [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md) 和 [Synchronize a Push Subscription](synchronize-a-push-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="3490b-217">For more information, see [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md) and [Synchronize a Push Subscription](synchronize-a-push-subscription.md).</span></span>    
8.  <span data-ttu-id="3490b-218">检查代理输出以获取验证结果。</span><span class="sxs-lookup"><span data-stu-id="3490b-218">Check the agent output for the result of the validation.</span></span> <span data-ttu-id="3490b-219">有关详细信息，请参阅 [Validate Data at the Subscriber](validate-data-at-the-subscriber.md)。</span><span class="sxs-lookup"><span data-stu-id="3490b-219">For more information, see [Validate Data at the Subscriber](validate-data-at-the-subscriber.md).</span></span>  

##  <a name="all-push-subscriptions-to-a-transactional-publication"></a><span data-ttu-id="3490b-220">对事务发布的所有推送订阅</span><span class="sxs-lookup"><span data-stu-id="3490b-220">All push subscriptions to a Transactional Publication</span></span> 

### <a name="using-replication-monitor"></a><span data-ttu-id="3490b-221">使用复制监视器</span><span class="sxs-lookup"><span data-stu-id="3490b-221">Using Replication Monitor</span></span>
  
1.  <span data-ttu-id="3490b-222">在复制监视器的左窗格中依次展开发布服务器组、发布服务器。</span><span class="sxs-lookup"><span data-stu-id="3490b-222">In Replication Monitor, expand a Publisher group in the left pane, and then expand a Publisher.</span></span>    
2.  <span data-ttu-id="3490b-223">右键单击要验证其订阅的发布，然后单击 **“验证多个订阅”**。</span><span class="sxs-lookup"><span data-stu-id="3490b-223">Right-click the publication for which you want to validate subscriptions, and then click **Validate Subscriptions**.</span></span>    
3.  <span data-ttu-id="3490b-224">在 **“验证多个订阅”** 对话框中，选择要验证的订阅：</span><span class="sxs-lookup"><span data-stu-id="3490b-224">In the **Validate Subscriptions** dialog box, select which subscriptions to validate:</span></span>    
    -   <span data-ttu-id="3490b-225">选择 **“验证所有 SQL Server 订阅”**。</span><span class="sxs-lookup"><span data-stu-id="3490b-225">Select **Validate all SQL Server subscriptions**.</span></span>    
    -   <span data-ttu-id="3490b-226">选择 **“验证下列订阅”**，再选择一个或多个订阅。</span><span class="sxs-lookup"><span data-stu-id="3490b-226">Select **Validate the following subscriptions**, and then select one or more subscriptions.</span></span>   
4.  <span data-ttu-id="3490b-227">若要指定要执行的验证类型（行计数，或行计数和校验和），请单击 **“验证选项”**，然后在 **“订阅验证选项”** 对话框中指定选项。</span><span class="sxs-lookup"><span data-stu-id="3490b-227">To specify the type of validation to perform (row count, or row count and checksum) click **Validation Options**, and then specify options in the **Subscription Validation Options** dialog box.</span></span>    
5.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]    
6.  <span data-ttu-id="3490b-228">单击 **“所有订阅”** 选项卡。</span><span class="sxs-lookup"><span data-stu-id="3490b-228">Click the **All Subscriptions** tab.</span></span>    
7.  <span data-ttu-id="3490b-229">查看验证结果。</span><span class="sxs-lookup"><span data-stu-id="3490b-229">View validation results.</span></span> <span data-ttu-id="3490b-230">对于每个推送订阅：</span><span class="sxs-lookup"><span data-stu-id="3490b-230">For each push subscription:</span></span>   
    1.  <span data-ttu-id="3490b-231">如果代理未运行，请右键单击该订阅，然后单击 **“开始同步”**。</span><span class="sxs-lookup"><span data-stu-id="3490b-231">If the agent is not running, right-click the subscription, and then click **Start Synchronizing**.</span></span>   
    2.  <span data-ttu-id="3490b-232">右键单击该订阅，然后单击 **“查看详细信息”**。</span><span class="sxs-lookup"><span data-stu-id="3490b-232">Right-click the subscription, and then click **View Details**.</span></span>    
    3.  <span data-ttu-id="3490b-233">在 **“所选会话中的操作”** 文本区域中的 **“分发服务器到订阅服务器的历史记录”** 选项卡中，查看信息。</span><span class="sxs-lookup"><span data-stu-id="3490b-233">View information on the **Distributor to Subscriber History** tab in the **Actions in the selected session** text area.</span></span>  
  

## <a name="for-a-single-subscription-to-a-merge-publication"></a><span data-ttu-id="3490b-234">对于合并发布的单个订阅</span><span class="sxs-lookup"><span data-stu-id="3490b-234">For a single subscription to a Merge Publication</span></span>
  
### <a name="using-sql-server-management-studio"></a><span data-ttu-id="3490b-235">使用 SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="3490b-235">Using SQL Server Management Studio</span></span>
  
1.  <span data-ttu-id="3490b-236">在 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]中连接到发布服务器，然后展开服务器节点。</span><span class="sxs-lookup"><span data-stu-id="3490b-236">Connect to the Publisher in [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], and then expand the server node.</span></span>    
2.  <span data-ttu-id="3490b-237">展开 **“复制”** 文件夹，再展开 **“本地发布”** 文件夹。</span><span class="sxs-lookup"><span data-stu-id="3490b-237">Expand the **Replication** folder, and then expand the **Local Publications** folder.</span></span>    
3.  <span data-ttu-id="3490b-238">展开要验证其订阅的发布，右键单击该订阅，然后单击 **“验证单个订阅”**。</span><span class="sxs-lookup"><span data-stu-id="3490b-238">Expand the publication for which you want to validate subscriptions, right-click the subscription, and then click **Validate Subscription**.</span></span>    
4.  <span data-ttu-id="3490b-239">在 **“验证单个订阅”** 对话框中，选择 **“验证此订阅”**。</span><span class="sxs-lookup"><span data-stu-id="3490b-239">In the **Validate Subscription** dialog box, select **Validate this subscription**.</span></span>    
5.  <span data-ttu-id="3490b-240">若要指定要执行的验证类型（行计数，或行计数和校验和），请单击 **“选项”**，然后在 **“订阅验证选项”** 对话框中指定选项。</span><span class="sxs-lookup"><span data-stu-id="3490b-240">To specify the type of validation to perform (row count, or row count and checksum) click **Options**, and then specify options in the **Subscription Validation Options** dialog box.</span></span>    
6.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]    
7.  <span data-ttu-id="3490b-241">在复制监视器或 **“查看同步状态”** 对话框中查看验证结果：</span><span class="sxs-lookup"><span data-stu-id="3490b-241">View validation results in Replication Monitor or the **View Synchronization Status** dialog box:</span></span>  
    1.  <span data-ttu-id="3490b-242">展开发布，右键单击该订阅，然后单击 **“查看同步状态”**。</span><span class="sxs-lookup"><span data-stu-id="3490b-242">Expand the publication, right-click the subscription, and then click **View Synchronization Status**.</span></span>   
    2.  <span data-ttu-id="3490b-243">如果代理未运行，请单击 **“查看同步状态”** 对话框中的 **“启动”** 。</span><span class="sxs-lookup"><span data-stu-id="3490b-243">If the agent is not running, click **Start** in the **View Synchronization Status** dialog box.</span></span> <span data-ttu-id="3490b-244">该对话框将显示有关验证的信息性消息。</span><span class="sxs-lookup"><span data-stu-id="3490b-244">The dialog box will display informational messages regarding validation.</span></span>  
  
     <span data-ttu-id="3490b-245">如果未显示有关验证的任何消息，则说明该代理已记录了后续消息。</span><span class="sxs-lookup"><span data-stu-id="3490b-245">If you do not see any messages regarding validation, the agent has already logged a subsequent message.</span></span> <span data-ttu-id="3490b-246">在这种情况下，请在复制监视器中查看验证结果。</span><span class="sxs-lookup"><span data-stu-id="3490b-246">In this case, view the validation results in Replication Monitor.</span></span> <span data-ttu-id="3490b-247">有关详细信息，请参阅本主题中有关复制监视器相关操作的过程。</span><span class="sxs-lookup"><span data-stu-id="3490b-247">For more information, see the Replication Monitor how to procedures in this topic.</span></span>  

### <a name="using-transact-sql-t-sql"></a><span data-ttu-id="3490b-248">使用 Transact-SQL (T-SQL)</span><span class="sxs-lookup"><span data-stu-id="3490b-248">Using Transact-SQL (T-SQL)</span></span>

1.  <span data-ttu-id="3490b-249">在发布服务器上，对发布数据库执行 [sp_validatemergesubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-validatemergesubscription-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="3490b-249">At the Publisher on the publication database, execute [sp_validatemergesubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-validatemergesubscription-transact-sql).</span></span> <span data-ttu-id="3490b-250">指定\*\* \@ 发布**、 \*\* \@ 订阅**服务器的订阅服务器名称、 \*\* \@ subscriber_db**的订阅数据库的名称，以及** \@ 级别\*\*的下列值之一：</span><span class="sxs-lookup"><span data-stu-id="3490b-250">Specify **\@publication**, the name of the Subscriber for **\@subscriber**, the name of the subscription database for **\@subscriber_db**, and one of the following values for **\@level**:</span></span>   
    -   <span data-ttu-id="3490b-251">**1** - 只验证行计数。</span><span class="sxs-lookup"><span data-stu-id="3490b-251">**1** - Rowcount-only validation.</span></span>    
    -   <span data-ttu-id="3490b-252">**3** - 行计数二进制校验和验证。</span><span class="sxs-lookup"><span data-stu-id="3490b-252">**3** - Rowcount binary checksum validation.</span></span>  
  
     <span data-ttu-id="3490b-253">这样会标记所选订阅以便验证。</span><span class="sxs-lookup"><span data-stu-id="3490b-253">This marks the selected subscription for validation.</span></span>  
  
2.  <span data-ttu-id="3490b-254">启动每个订阅的合并代理。</span><span class="sxs-lookup"><span data-stu-id="3490b-254">Start the merge agent for each subscription.</span></span> <span data-ttu-id="3490b-255">有关详细信息，请参阅 [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md) 和 [Synchronize a Push Subscription](synchronize-a-push-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="3490b-255">For more information, see [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md) and [Synchronize a Push Subscription](synchronize-a-push-subscription.md).</span></span>    
3.  <span data-ttu-id="3490b-256">检查代理输出以获取验证结果。</span><span class="sxs-lookup"><span data-stu-id="3490b-256">Check the agent output for the result of the validation.</span></span>    
4.  <span data-ttu-id="3490b-257">为每个要验证的订阅重复步骤 1 到步骤 3。</span><span class="sxs-lookup"><span data-stu-id="3490b-257">Repeat steps 1 through 3 for each subscription being validated.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="3490b-258">通过在运行 **Replication Merge Agent** 时指定 [-Validate](agents/replication-merge-agent.md)参数还可以在同步结束时验证对合并发布的订阅。</span><span class="sxs-lookup"><span data-stu-id="3490b-258">A subscription to a merge publication can also be validated at the end of a synchronization by specifying the **-Validate** parameter when running the [Replication Merge Agent](agents/replication-merge-agent.md).</span></span>  

  
## <a name="for-all-subscriptions-to-a-merge-publication"></a><span data-ttu-id="3490b-259">对于合并发布的所有订阅</span><span class="sxs-lookup"><span data-stu-id="3490b-259">For all subscriptions to a Merge Publication</span></span>

### <a name="using-sql-server-management-studio"></a><span data-ttu-id="3490b-260">使用 SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="3490b-260">Using SQL Server Management Studio</span></span> 
  
1.  <span data-ttu-id="3490b-261">在 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]中连接到发布服务器，然后展开服务器节点。</span><span class="sxs-lookup"><span data-stu-id="3490b-261">Connect to the Publisher in [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], and then expand the server node.</span></span>    
2.  <span data-ttu-id="3490b-262">展开 **“复制”** 文件夹，再展开 **“本地发布”** 文件夹。</span><span class="sxs-lookup"><span data-stu-id="3490b-262">Expand the **Replication** folder, and then expand the **Local Publications** folder.</span></span>    
3.  <span data-ttu-id="3490b-263">右键单击要验证其订阅的发布，然后单击 **“验证所有订阅”**。</span><span class="sxs-lookup"><span data-stu-id="3490b-263">Right-click the publication for which you want to validate subscriptions, and then click **Validate All Subscriptions**.</span></span>    
4.  <span data-ttu-id="3490b-264">在 **“验证所有订阅”** 对话框中，指定要执行的验证类型（行计数，或行计数和校验和）。</span><span class="sxs-lookup"><span data-stu-id="3490b-264">In the **Validate All Subscriptions** dialog box, specify the type of validation to perform (row count, or row count and checksum).</span></span>    
5.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]    
6.  <span data-ttu-id="3490b-265">在复制监视器或 "**查看同步状态**" 对话框中查看验证结果。</span><span class="sxs-lookup"><span data-stu-id="3490b-265">View validation results in Replication Monitor or the **View Synchronization Status** dialog box.</span></span> <span data-ttu-id="3490b-266">对于每个订阅：</span><span class="sxs-lookup"><span data-stu-id="3490b-266">For each subscription:</span></span>    
    1.  <span data-ttu-id="3490b-267">展开发布，右键单击该订阅，然后单击 **“查看同步状态”**。</span><span class="sxs-lookup"><span data-stu-id="3490b-267">Expand the publication, right-click the subscription, and then click **View Synchronization Status**.</span></span>   
    2.  <span data-ttu-id="3490b-268">如果代理未运行，请单击 **“查看同步状态”** 对话框中的 **“启动”** 。</span><span class="sxs-lookup"><span data-stu-id="3490b-268">If the agent is not running, click **Start** in the **View Synchronization Status** dialog box.</span></span> <span data-ttu-id="3490b-269">该对话框将显示有关验证的信息性消息。</span><span class="sxs-lookup"><span data-stu-id="3490b-269">The dialog box will display informational messages regarding validation.</span></span>  
  
     <span data-ttu-id="3490b-270">如果未显示有关验证的任何消息，则说明该代理已记录了后续消息。</span><span class="sxs-lookup"><span data-stu-id="3490b-270">If you do not see any messages regarding validation, the agent has already logged a subsequent message.</span></span> <span data-ttu-id="3490b-271">在这种情况下，请在复制监视器中查看验证结果。</span><span class="sxs-lookup"><span data-stu-id="3490b-271">In this case, view the validation results in Replication Monitor.</span></span> <span data-ttu-id="3490b-272">有关详细信息，请参阅本主题中有关复制监视器相关操作的过程。</span><span class="sxs-lookup"><span data-stu-id="3490b-272">For more information, see the Replication Monitor how to procedures in this topic.</span></span>  

### <a name="using-transact-sql-t-sql"></a><span data-ttu-id="3490b-273">使用 Transact-SQL (T-SQL)</span><span class="sxs-lookup"><span data-stu-id="3490b-273">Using Transact-SQL (T-SQL)</span></span>

1.  <span data-ttu-id="3490b-274">在发布服务器上，对发布数据库执行 [sp_validatemergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-validatemergepublication-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="3490b-274">At the Publisher on the publication database, execute [sp_validatemergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-validatemergepublication-transact-sql).</span></span> <span data-ttu-id="3490b-275">为\*\* \@ level**指定** \@ 发布\*\*和以下值之一：</span><span class="sxs-lookup"><span data-stu-id="3490b-275">Specify **\@publication** and one of the following values for **\@level**:</span></span>    
    -   <span data-ttu-id="3490b-276">**1** - 只验证行计数。</span><span class="sxs-lookup"><span data-stu-id="3490b-276">**1** - Rowcount-only validation.</span></span>    
    -   <span data-ttu-id="3490b-277">**3** - 行计数二进制校验和验证。</span><span class="sxs-lookup"><span data-stu-id="3490b-277">**3** - Rowcount binary checksum validation.</span></span>  
  
     <span data-ttu-id="3490b-278">这样会标记所有订阅以便验证。</span><span class="sxs-lookup"><span data-stu-id="3490b-278">This marks all subscriptions for validation.</span></span>  
  
2.  <span data-ttu-id="3490b-279">启动每个订阅的合并代理。</span><span class="sxs-lookup"><span data-stu-id="3490b-279">Start the merge agent for each subscription.</span></span> <span data-ttu-id="3490b-280">有关详细信息，请参阅 [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md) 和 [Synchronize a Push Subscription](synchronize-a-push-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="3490b-280">For more information, see [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md) and [Synchronize a Push Subscription](synchronize-a-push-subscription.md).</span></span>    
3.  <span data-ttu-id="3490b-281">检查代理输出以获取验证结果。</span><span class="sxs-lookup"><span data-stu-id="3490b-281">Check the agent output for the result of the validation.</span></span> <span data-ttu-id="3490b-282">有关详细信息，请参阅 [Validate Data at the Subscriber](validate-data-at-the-subscriber.md)。</span><span class="sxs-lookup"><span data-stu-id="3490b-282">For more information, see [Validate Data at the Subscriber](validate-data-at-the-subscriber.md).</span></span>  


## <a name="for-a-single-push-subscription-to-a-merge-publication"></a><span data-ttu-id="3490b-283">对于合并发布的单个推送订阅</span><span class="sxs-lookup"><span data-stu-id="3490b-283">For a single push subscription to a Merge Publication</span></span> 

### <a name="using-replication-monitor"></a><span data-ttu-id="3490b-284">使用复制监视器</span><span class="sxs-lookup"><span data-stu-id="3490b-284">Using Replication Monitor</span></span>
  
1.  <span data-ttu-id="3490b-285">在复制监视器的左窗格中依次展开发布服务器组、发布服务器，再单击一个发布。</span><span class="sxs-lookup"><span data-stu-id="3490b-285">In Replication Monitor, expand a Publisher group in the left pane, expand a Publisher, and then click a publication.</span></span>    
2.  <span data-ttu-id="3490b-286">单击 **“所有订阅”** 选项卡。</span><span class="sxs-lookup"><span data-stu-id="3490b-286">Click the **All Subscriptions** tab.</span></span>    
3.  <span data-ttu-id="3490b-287">右键单击要验证的订阅，然后单击 **“验证单个订阅”**。</span><span class="sxs-lookup"><span data-stu-id="3490b-287">Right-click the subscription you want to validate, and then click **Validate Subscription**.</span></span>    
4.  <span data-ttu-id="3490b-288">在 **“验证单个订阅”** 对话框中，选择 **“验证此订阅”**。</span><span class="sxs-lookup"><span data-stu-id="3490b-288">In the **Validate Subscription** dialog box, select **Validate this subscription**.</span></span>    
5.  <span data-ttu-id="3490b-289">若要指定要执行的验证类型（行计数，或行计数和校验和），请单击 **“选项”**，然后在 **“订阅验证选项”** 对话框中指定选项。</span><span class="sxs-lookup"><span data-stu-id="3490b-289">To specify the type of validation to perform (row count, or row count and checksum) click **Options**, and then specify options in the **Subscription Validation Options** dialog box.</span></span>    
6.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]    
7.  <span data-ttu-id="3490b-290">单击 **“所有订阅”** 选项卡。</span><span class="sxs-lookup"><span data-stu-id="3490b-290">Click the **All Subscriptions** tab.</span></span>    
8.  <span data-ttu-id="3490b-291">查看验证结果：</span><span class="sxs-lookup"><span data-stu-id="3490b-291">View validation results:</span></span>    
    1.  <span data-ttu-id="3490b-292">如果代理未运行，请右键单击该订阅，然后单击 **“开始同步”**。</span><span class="sxs-lookup"><span data-stu-id="3490b-292">If the agent is not running, right-click the subscription, and then click **Start Synchronizing**.</span></span>    
    2.  <span data-ttu-id="3490b-293">右键单击该订阅，然后单击 **“查看详细信息”**。</span><span class="sxs-lookup"><span data-stu-id="3490b-293">Right-click the subscription, and then click **View Details**.</span></span>    
    3.  <span data-ttu-id="3490b-294">查看 **“同步历史记录”** 选项卡 **“所选会话的最后消息”** 文本区域中的信息。</span><span class="sxs-lookup"><span data-stu-id="3490b-294">View information on the **Synchronization History** tab in the **Last message of the selected session** text area.</span></span>  
  
## <a name="for-all-push-subscriptions-to-a-merge-publication"></a><span data-ttu-id="3490b-295">对于合并发布的所有推送订阅</span><span class="sxs-lookup"><span data-stu-id="3490b-295">For all push subscriptions to a Merge Publication</span></span> 

### <a name="using-replication-monitor"></a><span data-ttu-id="3490b-296">使用复制监视器</span><span class="sxs-lookup"><span data-stu-id="3490b-296">Using Replication Monitor</span></span>
  
1.  <span data-ttu-id="3490b-297">在复制监视器的左窗格中依次展开发布服务器组、发布服务器。</span><span class="sxs-lookup"><span data-stu-id="3490b-297">In Replication Monitor, expand a Publisher group in the left pane, and then expand a Publisher.</span></span>    
2.  <span data-ttu-id="3490b-298">右键单击要验证其订阅的发布，然后单击 **“验证所有订阅”**。</span><span class="sxs-lookup"><span data-stu-id="3490b-298">Right-click the publication for which you want to validate subscriptions, and then click **Validate All Subscriptions**.</span></span>    
3.  <span data-ttu-id="3490b-299">在 **“验证所有订阅”** 对话框中，指定要执行的验证类型（行计数，或行计数和校验和）。</span><span class="sxs-lookup"><span data-stu-id="3490b-299">In the **Validate All Subscriptions** dialog box, specify the type of validation to perform (row count, or row count and checksum).</span></span>    
4.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]    
5.  <span data-ttu-id="3490b-300">单击 **“所有订阅”** 选项卡。</span><span class="sxs-lookup"><span data-stu-id="3490b-300">Click the **All Subscriptions** tab.</span></span>    
6.  <span data-ttu-id="3490b-301">查看验证结果。</span><span class="sxs-lookup"><span data-stu-id="3490b-301">View validation results.</span></span> <span data-ttu-id="3490b-302">对于每个推送订阅：</span><span class="sxs-lookup"><span data-stu-id="3490b-302">For each push subscription:</span></span>    
    1.  <span data-ttu-id="3490b-303">如果代理未运行，请右键单击该订阅，然后单击 **“开始同步”**。</span><span class="sxs-lookup"><span data-stu-id="3490b-303">If the agent is not running, right-click the subscription, and then click **Start Synchronizing**.</span></span>    
    2.  <span data-ttu-id="3490b-304">右键单击该订阅，然后单击 **“查看详细信息”**。</span><span class="sxs-lookup"><span data-stu-id="3490b-304">Right-click the subscription, and then click **View Details**.</span></span>    
    3.  <span data-ttu-id="3490b-305">查看 **“同步历史记录”** 选项卡 **“所选会话的最后消息”** 文本区域中的信息。</span><span class="sxs-lookup"><span data-stu-id="3490b-305">View information on the **Synchronization History** tab in the **Last message of the selected session** text area.</span></span>  
  
  
## <a name="validate-data-using-merge-agent-parameters"></a><span data-ttu-id="3490b-306">使用合并代理参数验证数据</span><span class="sxs-lookup"><span data-stu-id="3490b-306">Validate data using Merge Agent Parameters</span></span>
  
1.  <span data-ttu-id="3490b-307">通过以下方式之一从命令提示符下启动订阅服务器（请求订阅）或分发服务器（推送订阅）上的合并代理。</span><span class="sxs-lookup"><span data-stu-id="3490b-307">Start the Merge Agent at the Subscriber (pull subscription) or at the Distributor (push subscription) from the command prompt in one of the following ways.</span></span>    
    -   <span data-ttu-id="3490b-308">为 **-Validate** 参数指定值 **1** （行计数）或 **3** （行计数和二进制校验和）。</span><span class="sxs-lookup"><span data-stu-id="3490b-308">Specifying a value of **1** (rowcount) or **3** (rowcount and binary checksum) for the **-Validate** parameter.</span></span>   
    -   <span data-ttu-id="3490b-309">为 **-ProfileName** 参数指定 **rowcount validation** 或 **rowcount and checksum validation** 。</span><span class="sxs-lookup"><span data-stu-id="3490b-309">Specifying **rowcount validation** or **rowcount and checksum validation** for the **-ProfileName** parameter.</span></span>  
  
     <span data-ttu-id="3490b-310">有关详细信息，请参阅 [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md) 或 [Synchronize a Push Subscription](synchronize-a-push-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="3490b-310">For more information, see [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md) or [Synchronize a Push Subscription](synchronize-a-push-subscription.md).</span></span>  
  
## <a name="using-replication-management-objects-rmo"></a><span data-ttu-id="3490b-311">使用复制管理对象 (RMO)</span><span class="sxs-lookup"><span data-stu-id="3490b-311">Using Replication Management Objects (RMO)</span></span>  
 <span data-ttu-id="3490b-312">通过使用复制，您可以使用复制管理对象 (RMO) 以编程方式验证订阅服务器上的数据是否与发布服务器上的数据匹配。</span><span class="sxs-lookup"><span data-stu-id="3490b-312">Replication enables you to use Replication Management Objects (RMO) to programmatically validate that data at the Subscriber matches data at the Publisher.</span></span> <span data-ttu-id="3490b-313">使用的对象取决于复制拓扑的类型。</span><span class="sxs-lookup"><span data-stu-id="3490b-313">The objects you use depend on the type of replication topology.</span></span> <span data-ttu-id="3490b-314">事务复制要求验证发布的所有订阅。</span><span class="sxs-lookup"><span data-stu-id="3490b-314">Transactional replication requires validation of all subscriptions to a publication.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="3490b-315">有关示例，请参阅本节后面的 [示例 (RMO)](#RMOExample)。</span><span class="sxs-lookup"><span data-stu-id="3490b-315">For an example, see [Example (RMO)](#RMOExample), later in this section.</span></span>  
  
#### <a name="to-validate-data-for-all-articles-in-a-transactional-publication"></a><span data-ttu-id="3490b-316">验证事务发布中所有项目的数据</span><span class="sxs-lookup"><span data-stu-id="3490b-316">To validate data for all articles in a transactional publication</span></span>  
  
1.  <span data-ttu-id="3490b-317">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 类创建与发布服务器的连接。</span><span class="sxs-lookup"><span data-stu-id="3490b-317">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>    
2.  <span data-ttu-id="3490b-318">创建的 <xref:Microsoft.SqlServer.Replication.TransPublication> 类的实例。</span><span class="sxs-lookup"><span data-stu-id="3490b-318">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransPublication> class.</span></span> <span data-ttu-id="3490b-319">设置发布的 <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> 和 <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> 属性。</span><span class="sxs-lookup"><span data-stu-id="3490b-319">Set the <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> and <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> properties for the publication.</span></span> <span data-ttu-id="3490b-320">将 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> 属性设置为步骤 1 中创建的连接。</span><span class="sxs-lookup"><span data-stu-id="3490b-320">Set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the connection created in step 1.</span></span>   
3.  <span data-ttu-id="3490b-321">调用 <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> 方法获取该对象的其余属性。</span><span class="sxs-lookup"><span data-stu-id="3490b-321">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method to get the remaining properties of the object.</span></span> <span data-ttu-id="3490b-322">如果此方法返回 `false`，则说明步骤 2 中的发布属性定义不正确，或者此发布不存在。</span><span class="sxs-lookup"><span data-stu-id="3490b-322">If this method returns `false`, either the publication properties in step 2 were defined incorrectly or the publication does not exist.</span></span>    
4.  <span data-ttu-id="3490b-323">调用 <xref:Microsoft.SqlServer.Replication.TransPublication.ValidatePublication%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="3490b-323">Call the <xref:Microsoft.SqlServer.Replication.TransPublication.ValidatePublication%2A> method.</span></span> <span data-ttu-id="3490b-324">传递以下参数：</span><span class="sxs-lookup"><span data-stu-id="3490b-324">Pass the following:</span></span>    
    -   <xref:Microsoft.SqlServer.Replication.ValidationOption>    
    -   <xref:Microsoft.SqlServer.Replication.ValidationMethod>    
    -   <span data-ttu-id="3490b-325">一个布尔值，指示是否在验证完成后停止分发代理。</span><span class="sxs-lookup"><span data-stu-id="3490b-325">A Boolean that indicates whether to stop the Distribution Agent after validation is completed.</span></span>  
  
     <span data-ttu-id="3490b-326">这将把项目标记为等待验证。</span><span class="sxs-lookup"><span data-stu-id="3490b-326">This marks the articles for validation.</span></span>  
  
5.  <span data-ttu-id="3490b-327">如果尚未运行，则启动分发代理以同步每个订阅。</span><span class="sxs-lookup"><span data-stu-id="3490b-327">If not already running, start the Distribution Agent to synchronize each subscription.</span></span> <span data-ttu-id="3490b-328">有关详细信息，请参阅 [Synchronize a Push Subscription](synchronize-a-push-subscription.md) 或 [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="3490b-328">For more information, see [Synchronize a Push Subscription](synchronize-a-push-subscription.md) or [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md).</span></span> <span data-ttu-id="3490b-329">验证操作的结果将写入代理历史记录。</span><span class="sxs-lookup"><span data-stu-id="3490b-329">The result of the validation operation is written to the agent history.</span></span> <span data-ttu-id="3490b-330">有关详细信息，请参阅 [Monitoring Replication](monitoring-replication.md)。</span><span class="sxs-lookup"><span data-stu-id="3490b-330">For more information, see [Monitoring Replication](monitoring-replication.md).</span></span>  
  
#### <a name="to-validate-data-in-all-subscriptions-to-a-merge-publication"></a><span data-ttu-id="3490b-331">验证合并发布的所有订阅中的数据</span><span class="sxs-lookup"><span data-stu-id="3490b-331">To validate data in all subscriptions to a merge publication</span></span>  
  
1.  <span data-ttu-id="3490b-332">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 类创建与发布服务器的连接。</span><span class="sxs-lookup"><span data-stu-id="3490b-332">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>   
2.  <span data-ttu-id="3490b-333">创建的 <xref:Microsoft.SqlServer.Replication.MergePublication> 类的实例。</span><span class="sxs-lookup"><span data-stu-id="3490b-333">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class.</span></span> <span data-ttu-id="3490b-334">设置发布的 <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> 和 <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> 属性。</span><span class="sxs-lookup"><span data-stu-id="3490b-334">Set the <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> and <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> properties for the publication.</span></span> <span data-ttu-id="3490b-335">将 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> 属性设置为步骤 1 中创建的连接。</span><span class="sxs-lookup"><span data-stu-id="3490b-335">Set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the connection created in step 1.</span></span>   
3.  <span data-ttu-id="3490b-336">调用 <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> 方法获取该对象的其余属性。</span><span class="sxs-lookup"><span data-stu-id="3490b-336">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method to get the remaining properties of the object.</span></span> <span data-ttu-id="3490b-337">如果此方法返回 `false`，则说明步骤 2 中的发布属性定义不正确，或者此发布不存在。</span><span class="sxs-lookup"><span data-stu-id="3490b-337">If this method returns `false`, either the publication properties in step 2 were defined incorrectly or the publication does not exist.</span></span>    
4.  <span data-ttu-id="3490b-338">调用 <xref:Microsoft.SqlServer.Replication.MergePublication.ValidatePublication%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="3490b-338">Call the <xref:Microsoft.SqlServer.Replication.MergePublication.ValidatePublication%2A> method.</span></span> <span data-ttu-id="3490b-339">传递所需的 <xref:Microsoft.SqlServer.Replication.ValidationOption>。</span><span class="sxs-lookup"><span data-stu-id="3490b-339">Pass the desired <xref:Microsoft.SqlServer.Replication.ValidationOption>.</span></span>    
5.  <span data-ttu-id="3490b-340">对每个订阅运行合并代理以开始验证，或者等待下一个计划的代理运行。</span><span class="sxs-lookup"><span data-stu-id="3490b-340">Run the Merge Agent for each subscription to start validation, or wait for the next scheduled agent run.</span></span> <span data-ttu-id="3490b-341">有关详细信息，请参阅 [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md) 和 [Synchronize a Push Subscription](synchronize-a-push-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="3490b-341">For more information, see [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md) and [Synchronize a Push Subscription](synchronize-a-push-subscription.md).</span></span> <span data-ttu-id="3490b-342">验证操作的结果将写入代理的历史记录，您可以使用复制监视器查看。</span><span class="sxs-lookup"><span data-stu-id="3490b-342">The result of the validation operation is written to the agent history, which you view by using Replication Monitor.</span></span> <span data-ttu-id="3490b-343">有关详细信息，请参阅 [Monitoring Replication](monitoring-replication.md)。</span><span class="sxs-lookup"><span data-stu-id="3490b-343">For more information, see [Monitoring Replication](monitoring-replication.md).</span></span>  
  
#### <a name="to-validate-data-in-a-single-subscription-to-a-merge-publication"></a><span data-ttu-id="3490b-344">验证合并发布的单个订阅中的数据</span><span class="sxs-lookup"><span data-stu-id="3490b-344">To validate data in a single subscription to a merge publication</span></span>  
  
1.  <span data-ttu-id="3490b-345">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 类创建与发布服务器的连接。</span><span class="sxs-lookup"><span data-stu-id="3490b-345">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>    
2.  <span data-ttu-id="3490b-346">创建的 <xref:Microsoft.SqlServer.Replication.MergePublication> 类的实例。</span><span class="sxs-lookup"><span data-stu-id="3490b-346">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class.</span></span> <span data-ttu-id="3490b-347">设置发布的 <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> 和 <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> 属性。</span><span class="sxs-lookup"><span data-stu-id="3490b-347">Set the <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> and <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> properties for the publication.</span></span> <span data-ttu-id="3490b-348">将 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> 属性设置为步骤 1 中创建的连接。</span><span class="sxs-lookup"><span data-stu-id="3490b-348">Set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the connection created in step 1.</span></span>    
3.  <span data-ttu-id="3490b-349">调用 <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> 方法获取该对象的其余属性。</span><span class="sxs-lookup"><span data-stu-id="3490b-349">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method to get the remaining properties of the object.</span></span> <span data-ttu-id="3490b-350">如果此方法返回 `false`，则说明步骤 2 中的发布属性定义不正确，或者此发布不存在。</span><span class="sxs-lookup"><span data-stu-id="3490b-350">If this method returns `false`, either the publication properties in step 2 were defined incorrectly or the publication does not exist.</span></span>    
4.  <span data-ttu-id="3490b-351">调用 <xref:Microsoft.SqlServer.Replication.MergePublication.ValidateSubscription%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="3490b-351">Call the <xref:Microsoft.SqlServer.Replication.MergePublication.ValidateSubscription%2A> method.</span></span> <span data-ttu-id="3490b-352">传递要验证的订阅服务器和订阅数据库的名称以及所需的 <xref:Microsoft.SqlServer.Replication.ValidationOption>。</span><span class="sxs-lookup"><span data-stu-id="3490b-352">Pass the name of the Subscriber and subscription database being validated and the desired <xref:Microsoft.SqlServer.Replication.ValidationOption>.</span></span>    
5.  <span data-ttu-id="3490b-353">对订阅运行合并代理以开始验证，或者等待下一个计划的代理运行。</span><span class="sxs-lookup"><span data-stu-id="3490b-353">Run the Merge Agent for the subscription to start validation, or wait for the next scheduled agent run.</span></span> <span data-ttu-id="3490b-354">有关详细信息，请参阅 [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md) 和 [Synchronize a Push Subscription](synchronize-a-push-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="3490b-354">For more information, see [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md) and [Synchronize a Push Subscription](synchronize-a-push-subscription.md).</span></span> <span data-ttu-id="3490b-355">验证操作的结果将写入代理的历史记录，您可以使用复制监视器查看。</span><span class="sxs-lookup"><span data-stu-id="3490b-355">The result of the validation operation is written to the agent history, which you view by using Replication Monitor.</span></span> <span data-ttu-id="3490b-356">有关详细信息，请参阅 [Monitoring Replication](monitoring-replication.md)。</span><span class="sxs-lookup"><span data-stu-id="3490b-356">For more information, see [Monitoring Replication](monitoring-replication.md).</span></span>  
  
###  <a name="example-rmo"></a><a name="RMOExample"></a> <span data-ttu-id="3490b-357">示例 (RMO)</span><span class="sxs-lookup"><span data-stu-id="3490b-357">Example (RMO)</span></span>  
 <span data-ttu-id="3490b-358">此示例将对事务发布的所有订阅标记为行计数验证。</span><span class="sxs-lookup"><span data-stu-id="3490b-358">This example marks all subscriptions to a transactional publication for rowcount validation.</span></span>  
  
 [!code-csharp[HowTo#rmo_ValidateTranPub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_validatetranpub)]  
  
 [!code-vb[HowTo#rmo_vb_ValidateTranPub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_validatetranpub)]  
  
 <span data-ttu-id="3490b-359">此示例将对合并发布的特定订阅标记为行计数验证。</span><span class="sxs-lookup"><span data-stu-id="3490b-359">This example marks a specific subscription to a merge publication for rowcount validation.</span></span>  
  
 [!code-csharp[HowTo#rmo_ValidateMergeSub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_validatemergesub)]  
  
 [!code-vb[HowTo#rmo_vb_ValidateMergeSub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_validatemergesub)]  
  
  
