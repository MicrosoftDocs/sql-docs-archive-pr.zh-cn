---
title: 为包含参数化筛选器的合并发布创建快照 | Microsoft Docs
ms.custom: ''
ms.date: 06/30/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- parameterized filters [SQL Server replication], snapshots
- snapshots [SQL Server replication], parameterized filters and
- filters [SQL Server replication], parameterized
ms.assetid: 00dfb229-f1de-4d33-90b0-d7c99ab52dcb
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: dad6f1648cba44b38e37720f7e395687f769d91e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87688837"
---
# <a name="create-a-snapshot-for-a-merge-publication-with-parameterized-filters"></a><span data-ttu-id="235d9-102">为包含参数化筛选器的合并发布创建快照</span><span class="sxs-lookup"><span data-stu-id="235d9-102">Create a Snapshot for a Merge Publication with Parameterized Filters</span></span>
  <span data-ttu-id="235d9-103">本主题说明如何使用 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 、 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]或复制管理对象 (RMO) 在 [!INCLUDE[tsql](../../includes/tsql-md.md)]中通过参数化筛选器为合并发布创建快照。</span><span class="sxs-lookup"><span data-stu-id="235d9-103">This topic describes how to create a snapshot for a merge publication with parameterized filters in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span>  
  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="235d9-104">开始之前</span><span class="sxs-lookup"><span data-stu-id="235d9-104">Before You Begin</span></span>  
  
###  <a name="recommendations"></a><a name="Recommendations"></a> <span data-ttu-id="235d9-105">建议</span><span class="sxs-lookup"><span data-stu-id="235d9-105">Recommendations</span></span>  
  
-   <span data-ttu-id="235d9-106">在使用参数化筛选器为合并发布生成快照时，必须先生成一个包含所有已发布数据和订阅的订阅服务器元数据的标准（架构）快照。</span><span class="sxs-lookup"><span data-stu-id="235d9-106">When generating a snapshot for a merge publication using parameterized filters, you must first generate a standard (schema) snapshot that contains all of the published data and Subscriber metadata for the subscription.</span></span> <span data-ttu-id="235d9-107">有关详细信息，请参阅 [创建并应用初始快照](create-and-apply-the-initial-snapshot.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-107">For more information, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span> <span data-ttu-id="235d9-108">创建完架构快照后，便可生成包含特定于订阅服务器的已发布数据分区的快照。</span><span class="sxs-lookup"><span data-stu-id="235d9-108">After you have created the schema snapshot, you can generate the snapshot that contains the Subscriber-specific partition of the published data.</span></span>  
  
-   <span data-ttu-id="235d9-109">如果发布中对一个或多个项目的筛选生成了对每个订阅具有唯一性的非重叠分区，则每当运行合并代理时都会清除元数据。</span><span class="sxs-lookup"><span data-stu-id="235d9-109">If the filtering for one or more articles in the publication yields non-overlapping partitions that are unique for each subscription, metadata is cleaned up whenever the Merge Agent runs.</span></span> <span data-ttu-id="235d9-110">这意味着分区快照会过期得更快。</span><span class="sxs-lookup"><span data-stu-id="235d9-110">This means that the partitioned snapshot expires more quickly.</span></span> <span data-ttu-id="235d9-111">使用此选项时，应考虑允许订阅服务器启动快照的生成和传递。</span><span class="sxs-lookup"><span data-stu-id="235d9-111">When using this option, you should consider allowing Subscribers to initiate snapshot generation and delivery.</span></span> <span data-ttu-id="235d9-112">有关筛选选项的详细信息，请参阅[包含参数化筛选器的合并发布的快照](snapshots-for-merge-publications-with-parameterized-filters.md)的“设置‘分区选项’”部分。</span><span class="sxs-lookup"><span data-stu-id="235d9-112">For more information about filtering options, see the "Setting 'partition options'" section of [Snapshots for Merge Publications with Parameterized Filters](snapshots-for-merge-publications-with-parameterized-filters.md).</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="235d9-113">使用 SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="235d9-113">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="235d9-114">在“发布属性 - \<Publication>”对话框的“数据分区”页上为分区生成快照。 </span><span class="sxs-lookup"><span data-stu-id="235d9-114">Generate snapshots for partitions on the **Data Partitions** page of the **Publication Properties - \<Publication>** dialog box.</span></span> <span data-ttu-id="235d9-115">有关访问此对话框的详细信息，请参阅 [View and Modify Publication Properties](publish/view-and-modify-publication-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-115">For more information about accessing this dialog box, see [View and Modify Publication Properties](publish/view-and-modify-publication-properties.md).</span></span> <span data-ttu-id="235d9-116">可以允许订阅服务器启动快照生成及传送和/或生成快照。</span><span class="sxs-lookup"><span data-stu-id="235d9-116">You can allow Subscribers to initiate snapshot generation and delivery and/or generate snapshots.</span></span>  
  
 <span data-ttu-id="235d9-117">生成一个或多个分区的快照之前，必须：</span><span class="sxs-lookup"><span data-stu-id="235d9-117">Before generating snapshots for one or more partitions, you must:</span></span>  
  
1.  <span data-ttu-id="235d9-118">使用新建发布向导创建合并发布，并在该向导的 **“添加筛选器”** 页上指定一个或多个参数化行筛选器。</span><span class="sxs-lookup"><span data-stu-id="235d9-118">Create a merge publication with the New Publication Wizard, and specify one or more parameterized row filters on the **Add Filter** page of the wizard.</span></span> <span data-ttu-id="235d9-119">有关详细信息，请参阅 [定义和修改合并项目的参数化行筛选器](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-119">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
2.  <span data-ttu-id="235d9-120">生成发布的架构快照。</span><span class="sxs-lookup"><span data-stu-id="235d9-120">Generate a schema snapshot for the publication.</span></span> <span data-ttu-id="235d9-121">默认情况下，架构快照在完成新建发布向导时生成；您也可以从 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]中生成架构快照。</span><span class="sxs-lookup"><span data-stu-id="235d9-121">By default, a schema snapshot is generated when you complete the New Publication Wizard; you can also generate a schema snapshot from [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span></span>  
  
#### <a name="to-generate-a-schema-snapshot"></a><span data-ttu-id="235d9-122">生成架构快照</span><span class="sxs-lookup"><span data-stu-id="235d9-122">To generate a schema snapshot</span></span>  
  
1.  <span data-ttu-id="235d9-123">在 [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)]中连接到发布服务器，然后展开服务器节点。</span><span class="sxs-lookup"><span data-stu-id="235d9-123">Connect to the Publisher in [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="235d9-124">展开 **“复制”** 文件夹，再展开 **“发布”** 文件夹。</span><span class="sxs-lookup"><span data-stu-id="235d9-124">Expand the **Replication** folder, and then expand the **Publications** folder.</span></span>  
  
3.  <span data-ttu-id="235d9-125">右键单击要为其创建快照的发布，然后单击 **“查看快照代理状态”** 。</span><span class="sxs-lookup"><span data-stu-id="235d9-125">Right-click the publication for which you want to create a snapshot, and then click **View Snapshot Agent Status**.</span></span>  
  
4.  <span data-ttu-id="235d9-126">在“查看快照代理状态 - \<Publication>”对话框中，单击“启动” 。</span><span class="sxs-lookup"><span data-stu-id="235d9-126">In the **View Snapshot Agent Status - \<Publication>** dialog box, click **Start**.</span></span>  
  
     <span data-ttu-id="235d9-127">快照代理生成快照后，将显示一条消息，例如“[100%] 已生成 17 个项目的快照”。</span><span class="sxs-lookup"><span data-stu-id="235d9-127">When the Snapshot Agent finishes generating the snapshot, a message will be displayed, such as "[100%] A snapshot of 17 article(s) was generated."</span></span>  
  
#### <a name="to-allow-subscribers-to-initiate-snapshot-generation-and-delivery"></a><span data-ttu-id="235d9-128">允许订阅服务器启动快照的生成和传递</span><span class="sxs-lookup"><span data-stu-id="235d9-128">To allow Subscribers to initiate snapshot generation and delivery</span></span>  
  
1.  <span data-ttu-id="235d9-129">在“发布属性 - \<Publication>”对话框的“数据分区”页上，选择“在新订阅服务器尝试同步时，根据需要自动定义分区并生成快照”。  </span><span class="sxs-lookup"><span data-stu-id="235d9-129">On the **Data Partitions** page of the **Publication Properties - \<Publication>** dialog box, select **Automatically define a partition and generate a snapshot if needed when a new Subscriber tries to synchronize**.</span></span>  
  
2.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
#### <a name="to-generate-and-refresh-snapshots"></a><span data-ttu-id="235d9-130">生成和刷新快照</span><span class="sxs-lookup"><span data-stu-id="235d9-130">To generate and refresh snapshots</span></span>  
  
1.  <span data-ttu-id="235d9-131">在“发布属性 - \<Publication>”对话框的“数据分区”页上，单击“添加”。  </span><span class="sxs-lookup"><span data-stu-id="235d9-131">On the **Data Partitions** page of the **Publication Properties - \<Publication>** dialog box, click **Add**.</span></span>  
  
2.  <span data-ttu-id="235d9-132">为与要为其创建快照的分区关联的 **HOST_NAME()** 和/或 **SUSER_SNAME()** 输入一个值。</span><span class="sxs-lookup"><span data-stu-id="235d9-132">Enter a value for the **HOST_NAME()** and/or **SUSER_SNAME()** value associated with the partition for which you want to create a snapshot.</span></span>  
  
3.  <span data-ttu-id="235d9-133">还可以指定快照刷新计划：</span><span class="sxs-lookup"><span data-stu-id="235d9-133">Optionally specify a schedule for refreshing snapshots:</span></span>  
  
    1.  <span data-ttu-id="235d9-134">选择 **“安排此分区的快照代理在以下时间运行”**</span><span class="sxs-lookup"><span data-stu-id="235d9-134">Select **Schedule the Snapshot Agent for this partition to run at the following time(s)**</span></span>  
  
    2.  <span data-ttu-id="235d9-135">接受默认的快照刷新计划，或者单击 **“更改”** 以指定其他计划。</span><span class="sxs-lookup"><span data-stu-id="235d9-135">Accept the default schedule for refreshing snapshots, or click **Change** to specify a different schedule.</span></span>  
  
4.  <span data-ttu-id="235d9-136">单击“确定”，这会使你返回“发布属性 - \<Publication>”对话框。 </span><span class="sxs-lookup"><span data-stu-id="235d9-136">Click **OK**, which returns you to the **Publication Properties - \<Publication>** dialog box.</span></span>  
  
5.  <span data-ttu-id="235d9-137">在属性网格中选择分区，然后单击 **“立即生成所选快照”** 。</span><span class="sxs-lookup"><span data-stu-id="235d9-137">Select the partition in the property grid, and then click **Generate the selected snapshots now**.</span></span>  
  
6.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="235d9-138">使用 Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="235d9-138">Using Transact-SQL</span></span>  
 <span data-ttu-id="235d9-139">使用存储过程和快照代理，您可以执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="235d9-139">Using stored procedures and the Snapshot Agent, you can perform the following:</span></span>  
  
-   <span data-ttu-id="235d9-140">允许订阅服务器在第一次同步时请求快照生成和应用。</span><span class="sxs-lookup"><span data-stu-id="235d9-140">Allow Subscribers to request snapshot generation and application the first time they synchronize.</span></span>  
  
-   <span data-ttu-id="235d9-141">为每个分区预生成快照。</span><span class="sxs-lookup"><span data-stu-id="235d9-141">Pre-generate snapshots for each partition.</span></span>  
  
-   <span data-ttu-id="235d9-142">手动为每个订阅服务器生成快照。</span><span class="sxs-lookup"><span data-stu-id="235d9-142">Manually generate a snapshot for each Subscriber.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="235d9-143">如果可能，请在运行时提示用户输入安全凭据。</span><span class="sxs-lookup"><span data-stu-id="235d9-143">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="235d9-144">如果必须在脚本文件中存储凭据，则必须保护文件以防止未经授权的访问。</span><span class="sxs-lookup"><span data-stu-id="235d9-144">If you must store credentials in a script file, you must secure the file to prevent unauthorized access.</span></span>  
  
#### <a name="to-create-a-publication-that-allows-subscribers-to-initiate-snapshot-generation-and-delivery"></a><span data-ttu-id="235d9-145">创建允许订阅服务器启动快照生成和传递的发布</span><span class="sxs-lookup"><span data-stu-id="235d9-145">To create a publication that allows Subscribers to initiate snapshot generation and delivery</span></span>  
  
1.  <span data-ttu-id="235d9-146">在发布服务器上，对发布数据库执行 [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="235d9-146">At the Publisher on the publication database, execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span></span> <span data-ttu-id="235d9-147">指定下列参数：</span><span class="sxs-lookup"><span data-stu-id="235d9-147">Specify the following parameters:</span></span>  
  
    -   <span data-ttu-id="235d9-148">将 \@publication 指定为发布的名称。</span><span class="sxs-lookup"><span data-stu-id="235d9-148">The name of the publication for **\@publication**.</span></span>  
  
    -   <span data-ttu-id="235d9-149">Allow_subscriber_initiated_snapshot 的值 `true` ， \*\* \@ \*\*它使订阅服务器可以启动快照进程。</span><span class="sxs-lookup"><span data-stu-id="235d9-149">A value of `true` for **\@allow_subscriber_initiated_snapshot**, which enables Subscribers to initiate the snapshot process.</span></span>  
  
    -   <span data-ttu-id="235d9-150">（可选）将 \@max_concurrent_dynamic_snapshots 指定为可并发运行的动态快照进程数。</span><span class="sxs-lookup"><span data-stu-id="235d9-150">(Optional) The number of dynamic snapshot processes that can run concurrently for **\@max_concurrent_dynamic_snapshots**.</span></span> <span data-ttu-id="235d9-151">如果正在运行的进程数达到了最大值，并且订阅服务器尝试生成快照，则该进程将被置于队列中。</span><span class="sxs-lookup"><span data-stu-id="235d9-151">If the maximum number of processes is running and a Subscriber attempts to generate a snapshot, the process is placed in a queue.</span></span> <span data-ttu-id="235d9-152">默认情况下，并发进程的数量不受限制。</span><span class="sxs-lookup"><span data-stu-id="235d9-152">By default there is no limit to the number of concurrent processes.</span></span>  
  
2.  <span data-ttu-id="235d9-153">在发布服务器上，执行[sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="235d9-153">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="235d9-154">为\*\* \@ 发布**指定在步骤1中使用的发布名称以及在 [!INCLUDE[msCoName](../../includes/msconame-md.md)] 连接到发布服务器时用于[复制快照代理](agents/replication-snapshot-agent.md)身份验证的 Windows 凭据，还必须为** \@ publisher_security_mode**指定值**0\*\* ，并 [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 为\*\* \@ publisher_login**和** \@ publisher_password\*\*指定登录信息。</span><span class="sxs-lookup"><span data-stu-id="235d9-154">Specify the publication name used in step 1 for **\@publication** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows credentials under which the [Replication Snapshot Agent](agents/replication-snapshot-agent.md) Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="235d9-155">此操作将为发布创建一个快照代理作业。</span><span class="sxs-lookup"><span data-stu-id="235d9-155">This creates a Snapshot Agent job for the publication.</span></span> <span data-ttu-id="235d9-156">有关生成初始快照和为快照代理定义自定义计划的详细信息，请参阅 [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-156">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="235d9-157">使用远程分发服务器配置发布服务器时，为所有参数提供的值（包括 *job_login* 和 *job_password*）都会以纯文本方式发送到该分发服务器。</span><span class="sxs-lookup"><span data-stu-id="235d9-157">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="235d9-158">在执行此存储过程之前，应该对发布服务器及其远程分发服务器之间的连接进行加密。</span><span class="sxs-lookup"><span data-stu-id="235d9-158">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="235d9-159">有关详细信息，请参阅[启用数据库引擎的加密连接（SQL Server 配置管理器）](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-159">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="235d9-160">执行 [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql)，将项目添加到发布。</span><span class="sxs-lookup"><span data-stu-id="235d9-160">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) to add articles to the publication.</span></span> <span data-ttu-id="235d9-161">必须对发布中的每个项目执行一次此存储过程。</span><span class="sxs-lookup"><span data-stu-id="235d9-161">This stored procedure must be executed once for each article in the publication.</span></span> <span data-ttu-id="235d9-162">使用参数化筛选器时，必须使用 \@subset_filterclause 参数为一个或多个项目指定参数化行筛选器。</span><span class="sxs-lookup"><span data-stu-id="235d9-162">When using parameterized filters, you must specify a parameterized row filter for one or more articles using the **\@subset_filterclause** parameter.</span></span> <span data-ttu-id="235d9-163">有关详细信息，请参阅 [定义和修改合并项目的参数化行筛选器](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-163">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
4.  <span data-ttu-id="235d9-164">如果将基于该参数化行筛选器筛选其他项目，请执行 [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) 定义项目间的联接或逻辑记录关系。</span><span class="sxs-lookup"><span data-stu-id="235d9-164">If other articles will be filtered based on the parameterized row filter, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) to define the join or logical record relationships between articles.</span></span> <span data-ttu-id="235d9-165">必须对要定义的每个关系执行一次此存储过程。</span><span class="sxs-lookup"><span data-stu-id="235d9-165">This stored procedure must be executed once for each relationship being defined.</span></span> <span data-ttu-id="235d9-166">有关详细信息，请参阅 [定义和修改合并项目间的联接筛选器](publish/define-and-modify-a-join-filter-between-merge-articles.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-166">For more information, see [Define and Modify a Join Filter Between Merge Articles](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span></span>  
  
5.  <span data-ttu-id="235d9-167">当合并代理请求快照初始化订阅服务器时，将自动生成请求订阅的分区的快照。</span><span class="sxs-lookup"><span data-stu-id="235d9-167">When the Merge Agent requests the snapshot to initialize the Subscriber, the snapshot for the requesting subscription's partition is automatically generated.</span></span>  
  
#### <a name="to-create-a-publication-and-pre-generate-or-automatically-refresh-snapshots"></a><span data-ttu-id="235d9-168">创建发布并预生成或自动刷新快照</span><span class="sxs-lookup"><span data-stu-id="235d9-168">To create a publication and pre-generate or automatically refresh snapshots</span></span>  
  
1.  <span data-ttu-id="235d9-169">执行 [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) 创建发布。</span><span class="sxs-lookup"><span data-stu-id="235d9-169">Execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) to create the publication.</span></span> <span data-ttu-id="235d9-170">有关详细信息，请参阅 [Create a Publication](publish/create-a-publication.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-170">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="235d9-171">在发布服务器上，执行[sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="235d9-171">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="235d9-172">指定在步骤 1 中对 \@publication 使用的发布名称以及快照代理针对 \@job_login 和 \@password运行的 Windows 凭据  。</span><span class="sxs-lookup"><span data-stu-id="235d9-172">Specify the publication name used in step 1 for **\@publication** and the Windows credentials under which the Snapshot Agent runs for **\@job_login** and **\@password**.</span></span> <span data-ttu-id="235d9-173">如果代理在连接到发布服务器时将使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 身份验证，则还必须将 \@publisher_security_mode 的值指定为 0，并为 \@publisher_login 和\@publisher_password 指定 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 登录信息   。</span><span class="sxs-lookup"><span data-stu-id="235d9-173">If the agent will use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="235d9-174">此操作将为发布创建一个快照代理作业。</span><span class="sxs-lookup"><span data-stu-id="235d9-174">This creates a Snapshot Agent job for the publication.</span></span> <span data-ttu-id="235d9-175">有关生成初始快照和为快照代理定义自定义计划的详细信息，请参阅 [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-175">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="235d9-176">使用远程分发服务器配置发布服务器时，为所有参数提供的值（包括 *job_login* 和 *job_password*）都会以纯文本方式发送到该分发服务器。</span><span class="sxs-lookup"><span data-stu-id="235d9-176">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="235d9-177">在执行此存储过程之前，应该对发布服务器及其远程分发服务器之间的连接进行加密。</span><span class="sxs-lookup"><span data-stu-id="235d9-177">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="235d9-178">有关详细信息，请参阅[启用数据库引擎的加密连接（SQL Server 配置管理器）](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-178">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="235d9-179">执行 [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql)，将项目添加到发布。</span><span class="sxs-lookup"><span data-stu-id="235d9-179">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) to add articles to the publication.</span></span> <span data-ttu-id="235d9-180">必须对发布中的每个项目执行一次此存储过程。</span><span class="sxs-lookup"><span data-stu-id="235d9-180">This stored procedure must be executed once for each article in the publication.</span></span> <span data-ttu-id="235d9-181">使用参数化筛选器时，必须使用 \@subset_filterclause 参数为一个项目指定参数化行筛选器。</span><span class="sxs-lookup"><span data-stu-id="235d9-181">When using parameterized filters, you must specify a parameterized row filter for one article using the **\@subset_filterclause** parameter.</span></span> <span data-ttu-id="235d9-182">有关详细信息，请参阅 [定义和修改合并项目的参数化行筛选器](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-182">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
4.  <span data-ttu-id="235d9-183">如果将基于该参数化行筛选器筛选其他项目，请执行 [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) 定义项目间的联接或逻辑记录关系。</span><span class="sxs-lookup"><span data-stu-id="235d9-183">If other articles will be filtered based on the parameterized row filter, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) to define the join or logical record relationships between articles.</span></span> <span data-ttu-id="235d9-184">必须对要定义的每个关系执行一次此存储过程。</span><span class="sxs-lookup"><span data-stu-id="235d9-184">This stored procedure must be executed once for each relationship being defined.</span></span> <span data-ttu-id="235d9-185">有关详细信息，请参阅 [定义和修改合并项目间的联接筛选器](publish/define-and-modify-a-join-filter-between-merge-articles.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-185">For more information, see [Define and Modify a Join Filter Between Merge Articles](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span></span>  
  
5.  <span data-ttu-id="235d9-186">在发布服务器上，对发布数据库执行 [sp_helpmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql)，并指定步骤 1 中 \@publication 的值。</span><span class="sxs-lookup"><span data-stu-id="235d9-186">At the Publisher on the publication database, execute [sp_helpmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql), specifying the value of **\@publication** from step 1.</span></span> <span data-ttu-id="235d9-187">请注意结果集中的 **snapshot_jobid** 值。</span><span class="sxs-lookup"><span data-stu-id="235d9-187">Note the value of the **snapshot_jobid** in the result set.</span></span>  
  
6.  <span data-ttu-id="235d9-188">将步骤 5 中得到的 **snapshot_jobid** 的值转换为 **uniqueidentifier**。</span><span class="sxs-lookup"><span data-stu-id="235d9-188">Convert the value of the **snapshot_jobid** obtained in step 5 to **uniqueidentifier**.</span></span>  
  
7.  <span data-ttu-id="235d9-189">在 msdb 数据库的发布服务器上，执行 [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql)，将 \@job_id 指定为在步骤 6 中得到的转换后的值 。</span><span class="sxs-lookup"><span data-stu-id="235d9-189">At the Publisher on the **msdb** database, execute [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql), specifying the converted value obtained in step 6 for **\@job_id**.</span></span>  
  
8.  <span data-ttu-id="235d9-190">在发布服务器上，对发布数据库执行 [sp_addmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="235d9-190">At the Publisher on the publication database, execute [sp_addmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql).</span></span> <span data-ttu-id="235d9-191">为 \@publication 指定步骤 1 中发布的名称，并为 \@suser_sname（如果在筛选子句中使用 [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql)）或 \@host_name（如果在筛选子句中使用 [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql)）指定用于定义分区的值  。</span><span class="sxs-lookup"><span data-stu-id="235d9-191">Specify the name of the publication from step 1 for **\@publication** and the value used to define the partition for **\@suser_sname** if [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) is used in the filter clause or for **\@host_name** if [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) is used in the filter clause.</span></span>  
  
9. <span data-ttu-id="235d9-192">在发布服务器上，对发布数据库执行 [sp_adddynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="235d9-192">At the publisher on the publication database, execute [sp_adddynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql).</span></span> <span data-ttu-id="235d9-193">为 \@publication 指定步骤 1 中发布的名称，并为 \@suser_sname 或 \@host_name 指定步骤 8 中的值，同时为作业指定一个计划  。</span><span class="sxs-lookup"><span data-stu-id="235d9-193">Specify the name of the publication from step 1 for **\@publication**, the value of **\@suser_sname** or **\@host_name** from step 8, and a schedule for the job.</span></span> <span data-ttu-id="235d9-194">此操作将创建为指定分区生成参数化快照的作业。</span><span class="sxs-lookup"><span data-stu-id="235d9-194">This creates the job that generates the parameterized snapshot for the specified partition.</span></span> <span data-ttu-id="235d9-195">有关详细信息，请参阅 [Specify Synchronization Schedules](specify-synchronization-schedules.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-195">For more information, see [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="235d9-196">使用在步骤 2 中定义的初始快照作业的 Windows 帐户运行此作业。</span><span class="sxs-lookup"><span data-stu-id="235d9-196">This job runs using the same Windows account as the initial snapshot job defined in step 2.</span></span> <span data-ttu-id="235d9-197">若要删除参数化快照作业及其相关的数据分区，请执行 [sp_dropdynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-dropdynamicsnapshot-job-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="235d9-197">To remove the parameterized snapshot job and its related data partition, execute [sp_dropdynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-dropdynamicsnapshot-job-transact-sql).</span></span>  
  
10. <span data-ttu-id="235d9-198">在发布服务器上的发布数据库中执行 [sp_helpmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepartition-transact-sql)，指定步骤 1 中的 \@publication 值和步骤 8 中的 \@suser_sname 或 \@host_name 值  。</span><span class="sxs-lookup"><span data-stu-id="235d9-198">At the Publisher on the publication database, execute [sp_helpmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepartition-transact-sql), specifying the value of **\@publication** from step 1 and the value of **\@suser_sname** or **\@host_name** from step 8.</span></span> <span data-ttu-id="235d9-199">请注意结果集中的 **dynamic_snapshot_jobid** 值。</span><span class="sxs-lookup"><span data-stu-id="235d9-199">Note the value of the **dynamic_snapshot_jobid** in the result set.</span></span>  
  
11. <span data-ttu-id="235d9-200">在分发服务器上，对 msdb 数据库执行 [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql)，并为 \@job_id 指定在步骤 9 中获取的值 。</span><span class="sxs-lookup"><span data-stu-id="235d9-200">At the Distributor on the **msdb** database, execute [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql), specifying the value obtained in step 9 for **\@job_id**.</span></span> <span data-ttu-id="235d9-201">此操作将启动分区的参数化快照作业。</span><span class="sxs-lookup"><span data-stu-id="235d9-201">This starts the parameterized snapshot job for the partition.</span></span>  
  
12. <span data-ttu-id="235d9-202">重复步骤 8-11，分别为每个订阅生成一个分区快照。</span><span class="sxs-lookup"><span data-stu-id="235d9-202">Repeat steps 8-11 to generate a partitioned snapshot for each subscription.</span></span>  
  
#### <a name="to-create-a-publication-and-manually-create-snapshots-for-each-partition"></a><span data-ttu-id="235d9-203">创建发布并为每个分区手动创建快照</span><span class="sxs-lookup"><span data-stu-id="235d9-203">To create a publication and manually create snapshots for each partition</span></span>  
  
1.  <span data-ttu-id="235d9-204">执行 [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) 创建发布。</span><span class="sxs-lookup"><span data-stu-id="235d9-204">Execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) to create the publication.</span></span> <span data-ttu-id="235d9-205">有关详细信息，请参阅 [Create a Publication](publish/create-a-publication.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-205">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="235d9-206">在发布服务器上，执行[sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="235d9-206">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="235d9-207">指定在步骤 1 中对 \@publication 使用的发布名称以及快照代理针对 \@job_login 和 \@password运行的 Windows 凭据  。</span><span class="sxs-lookup"><span data-stu-id="235d9-207">Specify the publication name used in step 1 for **\@publication** and the Windows credentials under which the Snapshot Agent runs for **\@job_login** and **\@password**.</span></span> <span data-ttu-id="235d9-208">如果代理在连接到发布服务器时将使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 身份验证，则还必须将 \@publisher_security_mode 的值指定为 0，并为 \@publisher_login 和\@publisher_password 指定 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 登录信息   。</span><span class="sxs-lookup"><span data-stu-id="235d9-208">If the agent will use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="235d9-209">此操作将为发布创建一个快照代理作业。</span><span class="sxs-lookup"><span data-stu-id="235d9-209">This creates a Snapshot Agent job for the publication.</span></span> <span data-ttu-id="235d9-210">有关生成初始快照和为快照代理定义自定义计划的详细信息，请参阅 [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-210">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="235d9-211">使用远程分发服务器配置发布服务器时，为所有参数提供的值（包括 *job_login* 和 *job_password*）都会以纯文本方式发送到该分发服务器。</span><span class="sxs-lookup"><span data-stu-id="235d9-211">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="235d9-212">在执行此存储过程之前，应该对发布服务器及其远程分发服务器之间的连接进行加密。</span><span class="sxs-lookup"><span data-stu-id="235d9-212">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="235d9-213">有关详细信息，请参阅[启用数据库引擎的加密连接（SQL Server 配置管理器）](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-213">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="235d9-214">执行 [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql)，将项目添加到发布。</span><span class="sxs-lookup"><span data-stu-id="235d9-214">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) to add articles to the publication.</span></span> <span data-ttu-id="235d9-215">必须对发布中的每个项目执行一次此存储过程。</span><span class="sxs-lookup"><span data-stu-id="235d9-215">This stored procedure must be executed once for each article in the publication.</span></span> <span data-ttu-id="235d9-216">使用参数化筛选器时，必须使用 \@subset_filterclause 参数为至少一个项目指定参数化行筛选器。</span><span class="sxs-lookup"><span data-stu-id="235d9-216">When using parameterized filters, you must specify a parameterized row filter for at least one article using the **\@subset_filterclause** parameter.</span></span> <span data-ttu-id="235d9-217">有关详细信息，请参阅 [定义和修改合并项目的参数化行筛选器](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-217">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
4.  <span data-ttu-id="235d9-218">如果将基于该参数化行筛选器筛选其他项目，请执行 [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) 定义项目间的联接或逻辑记录关系。</span><span class="sxs-lookup"><span data-stu-id="235d9-218">If other articles will be filtered based on the parameterized row filter, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) to define the join or logical record relationships between articles.</span></span> <span data-ttu-id="235d9-219">必须对要定义的每个关系执行一次此存储过程。</span><span class="sxs-lookup"><span data-stu-id="235d9-219">This stored procedure must be executed once for each relationship being defined.</span></span> <span data-ttu-id="235d9-220">有关详细信息，请参阅 [定义和修改合并项目间的联接筛选器](publish/define-and-modify-a-join-filter-between-merge-articles.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-220">For more information, see [Define and Modify a Join Filter Between Merge Articles](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span></span>  
  
5.  <span data-ttu-id="235d9-221">启动快照作业或从命令提示符下运行复制快照代理，以生成标准快照架构及其他文件。</span><span class="sxs-lookup"><span data-stu-id="235d9-221">Start the snapshot job or run the Replication Snapshot Agent from the command prompt to generate the standard snapshot schema and other files.</span></span> <span data-ttu-id="235d9-222">有关详细信息，请参阅 [创建并应用初始快照](create-and-apply-the-initial-snapshot.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-222">For more information, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
6.  <span data-ttu-id="235d9-223">再次从命令提示符下运行复制快照代理以生成大容量复制 (.bcp) 文件，为 **-DynamicSnapshotLocation** 指定分区快照的位置，同时指定用于定义分区的以下一个或两个属性：</span><span class="sxs-lookup"><span data-stu-id="235d9-223">Run the Replication Snapshot Agent again from the command prompt to generate bulk copy (.bcp) files, specifying the location of the partitioned snapshot for **-DynamicSnapshotLocation** and one or both of the following properties that defines the partition:</span></span>  
  
    -   <span data-ttu-id="235d9-224">**-DynamicFilterHostName** - 使用 [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) 时的值。</span><span class="sxs-lookup"><span data-stu-id="235d9-224">**-DynamicFilterHostName** - the value if [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) is used.</span></span>  
  
    -   <span data-ttu-id="235d9-225">**-DynamicFilterLogin** - 使用 [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) 时的值。</span><span class="sxs-lookup"><span data-stu-id="235d9-225">**-DynamicFilterLogin** - the value if [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) is used.</span></span>  
  
7.  <span data-ttu-id="235d9-226">重复步骤 6，分别为每个订阅生成一个分区快照。</span><span class="sxs-lookup"><span data-stu-id="235d9-226">Repeat step 6 to generate a partitioned snapshot for each subscription.</span></span>  
  
8.  <span data-ttu-id="235d9-227">对每个订阅运行合并代理以在订阅服务器上应用初始分区快照，并指定以下属性：</span><span class="sxs-lookup"><span data-stu-id="235d9-227">Run the Merge Agent for each subscription to apply the initial partitioned snapshot at the Subscribers, specifying the following properties:</span></span>  
  
    -   <span data-ttu-id="235d9-228">**-Hostname** - 在 HOST_NAME 的实际值被覆盖时用于定义分区的值。</span><span class="sxs-lookup"><span data-stu-id="235d9-228">**-Hostname** - the value used to define the partition if the actual value of HOST_NAME is being overridden.</span></span>  
  
    -   <span data-ttu-id="235d9-229">**-DynamicSnapshotLocation** - 此分区的动态快照的位置。</span><span class="sxs-lookup"><span data-stu-id="235d9-229">**-DynamicSnapshotLocation** - the location of the dynamic snapshot for this partition.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="235d9-230">有关复制代理编程的详细信息，请参阅[复制代理可执行文件概念](concepts/replication-agent-executables-concepts.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-230">For more information about programming replication agents, see [Replication Agent Executables Concepts](concepts/replication-agent-executables-concepts.md).</span></span>  
  
###  <a name="examples-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="235d9-231">示例 (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="235d9-231">Examples (Transact-SQL)</span></span>  
 <span data-ttu-id="235d9-232">此示例使用参数化筛选器创建合并发布，其中由订阅服务器启动快照生成过程。</span><span class="sxs-lookup"><span data-stu-id="235d9-232">This example creates a merge publication with parameterized filters where Subscribers initiate the snapshot generation process.</span></span> <span data-ttu-id="235d9-233">\@job_login 和 \@job_password 的值通过脚本变量进行传递 。</span><span class="sxs-lookup"><span data-stu-id="235d9-233">Values for **\@job_login** and **\@job_password** are passed in using scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_MergeDynamicPub1](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubdynamic1.sql#sp_mergedynamicpub1)]  
  
 <span data-ttu-id="235d9-234">此示例使用参数筛选器创建发布，通过传递分区信息，其中的每个订阅服务器均有自己的分区（通过执行 [sp_addmergepartition](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql) 进行定义）和经过筛选的快照作业（通过执行 [sp_adddynamicsnapshot_job](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql) 来创建）。</span><span class="sxs-lookup"><span data-stu-id="235d9-234">This example creates a publication using a parameterized filter where each Subscriber has its partition defined by executing [sp_addmergepartition](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql) and the filtered snapshot job created by executing [sp_adddynamicsnapshot_job](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql) passing the partitioning information.</span></span> <span data-ttu-id="235d9-235">\@job_login 和 \@job_password 的值通过脚本变量进行传递 。</span><span class="sxs-lookup"><span data-stu-id="235d9-235">Values for **\@job_login** and **\@job_password** are passed in using scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_MergeDynamicPubPlusPartition](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubdynamic2.sql#sp_mergedynamicpubpluspartition)]  
  
 <span data-ttu-id="235d9-236">此示例使用参数化筛选器创建发布，其中每个订阅服务器都必须通过提供分区信息来创建它自己的数据分区和已筛选的快照作业。</span><span class="sxs-lookup"><span data-stu-id="235d9-236">This example creates a publication using a parameterized filter where each Subscriber must have its data partition and filtered snapshot job created by supplying the partitioning information.</span></span> <span data-ttu-id="235d9-237">手动运行复制代理时，订阅服务器使用命令行参数提供分区信息。</span><span class="sxs-lookup"><span data-stu-id="235d9-237">A Subscriber supplies partitioning information using command-line parameters when manually running the replication agents.</span></span> <span data-ttu-id="235d9-238">此示例假设还对发布创建了订阅。</span><span class="sxs-lookup"><span data-stu-id="235d9-238">This example assumes that a subscription to the publication has also been created.</span></span>  
  
 [!code-sql[HowTo#sp_MergeDynamicPubPartitionManual](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubdynamic3.sql#sp_mergedynamicpubpartitionmanual)]  
  
 
```
REM Line breaks are added to improve readability.   
REM In a batch file, commands must be made in a single line.  
REM Run the Snapshot agent from the command line to generate the standard snapshot   
REM schema and other files.   
SET DistPub=%computername%  
SET PubDB=AdventureWorks2012   
SET PubName=AdvWorksSalesPersonMerge  
  
"C:\Program Files\Microsoft SQL Server\120\COM\SNAPSHOT.EXE" -Publication %PubName%    
-Publisher %DistPub% -Distributor  %DistPub%  -PublisherDB %PubDB%  -ReplicationType 2    
-OutputVerboseLevel 1  -DistributorSecurityMode 1  
  
PAUSE  
```

```
REM Run the Snapshot agent from the command line, this time to generate   
REM the bulk copy (.bcp) data for each Subscriber partition.    
SET DistPub=%computername%  
SET PubDB=AdventureWorks2012   
SET PubName=AdvWorksSalesPersonMerge  
SET SnapshotDir=\\%DistPub%\repldata\unc\fernando  
  
MD %SnapshotDir%  
  
"C:\Program Files\Microsoft SQL Server\120\COM\SNAPSHOT.EXE" -Publication %PubName%    
-Publisher %DistPub%  -Distributor  %DistPub%  -PublisherDB %PubDB%  -ReplicationType 2    
-OutputVerboseLevel 1  -DistributorSecurityMode 1  -DynamicFilterHostName "adventure-works\Fernando"    
-DynamicSnapshotLocation %SnapshotDir%  
  
PAUSE  
```

```
REM Run the Merge Agent for each subscription to apply the partitioned   
REM snapshot for each Subscriber.    
SET Publisher = %computername%  
SET Subscriber = %computername%  
SET PubDB = AdventureWorks2012   
SET SubDB = AdventureWorks2012Replica   
SET PubName = AdvWorksSalesPersonMerge   
SET SnapshotDir=\\%DistPub%\repldata\unc\fernando  
  
"C:\Program Files\Microsoft SQL Server\120\COM\REPLMERG.EXE" -Publisher  %Publisher%    
-Subscriber  %Subscriber%  -Distributor %Publisher%  -PublisherDB %PubDB%    
-SubscriberDB %SubDB% -Publication %PubName%  -PublisherSecurityMode 1  -OutputVerboseLevel 3    
-Output -SubscriberSecurityMode 1  -SubscriptionType 3 -DistributorSecurityMode 1    
-Hostname "adventure-works\Fernando"  -DynamicSnapshotLocation %SnapshotDir%  
  
PAUSE
```
  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="235d9-239">使用复制管理对象 (RMO)</span><span class="sxs-lookup"><span data-stu-id="235d9-239">Using Replication Management Objects (RMO)</span></span>  
 <span data-ttu-id="235d9-240">可以使用复制管理对象 (RMO) 通过以下方法以编程的方式生成分区快照：</span><span class="sxs-lookup"><span data-stu-id="235d9-240">You can use Replication Management Objects (RMO) to generate partitioned snapshots programmatically in the following ways:</span></span>  
  
-   <span data-ttu-id="235d9-241">允许订阅服务器在第一次同步时请求快照生成和应用。</span><span class="sxs-lookup"><span data-stu-id="235d9-241">Allow Subscribers to request snapshot generation and application the first time they synchronize.</span></span>  
  
-   <span data-ttu-id="235d9-242">为每个分区预生成快照。</span><span class="sxs-lookup"><span data-stu-id="235d9-242">Pre-generate snapshots for each partition.</span></span>  
  
-   <span data-ttu-id="235d9-243">通过运行快照代理为每台订阅服务器手动生成一个快照。</span><span class="sxs-lookup"><span data-stu-id="235d9-243">Manually generate a snapshot for each Subscriber by running the Snapshot Agent.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="235d9-244">如果对项目进行筛选后，生成对于每个订阅都唯一的非重叠分区（通过在创建合并项目时将 <xref:Microsoft.SqlServer.Replication.PartitionOptions.NonOverlappingSingleSubscription> 的值指定为 <xref:Microsoft.SqlServer.Replication.MergeArticle.PartitionOption%2A>），则只要合并代理运行，就会清除元数据。</span><span class="sxs-lookup"><span data-stu-id="235d9-244">When filtering for an article yields non-overlapping partitions that are unique for each subscription (by specifying a value of <xref:Microsoft.SqlServer.Replication.PartitionOptions.NonOverlappingSingleSubscription> for <xref:Microsoft.SqlServer.Replication.MergeArticle.PartitionOption%2A> when creating a merge article), metadata is cleaned up whenever the Merge Agent runs.</span></span> <span data-ttu-id="235d9-245">这意味着分区快照会过期得更快。</span><span class="sxs-lookup"><span data-stu-id="235d9-245">This means that the partitioned snapshot expires more quickly.</span></span> <span data-ttu-id="235d9-246">使用此选项时，应考虑允许订阅服务器请求快照生成。</span><span class="sxs-lookup"><span data-stu-id="235d9-246">When you use this option, you should consider allowing Subscribers to request snapshot generation.</span></span> <span data-ttu-id="235d9-247">有关详细信息，请参阅主题 [Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md)中的“使用适当的筛选选项”部分。</span><span class="sxs-lookup"><span data-stu-id="235d9-247">For more information, see the section Using the Appropriate Filtering Options in the topic [Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="235d9-248">如果可能，请在运行时提示用户输入安全凭据。</span><span class="sxs-lookup"><span data-stu-id="235d9-248">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="235d9-249">如果必须存储凭据，请使用 [Windows .NET Framework 提供的](https://go.microsoft.com/fwlink/?LinkId=34733) Cryptographic Services [!INCLUDE[msCoName](../../includes/msconame-md.md)] （加密服务）。</span><span class="sxs-lookup"><span data-stu-id="235d9-249">If you must store credentials, use the [cryptographic services](https://go.microsoft.com/fwlink/?LinkId=34733) provided by the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows .NET Framework.</span></span>  
  
#### <a name="to-create-a-publication-that-allows-subscribers-to-initiate-snapshot-generation-and-delivery"></a><span data-ttu-id="235d9-250">创建允许订阅服务器启动快照生成和传递的发布</span><span class="sxs-lookup"><span data-stu-id="235d9-250">To create a publication that allows Subscribers to initiate snapshot generation and delivery</span></span>  
  
1.  <span data-ttu-id="235d9-251">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 类创建与发布服务器的连接。</span><span class="sxs-lookup"><span data-stu-id="235d9-251">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="235d9-252">为发布数据库创建 <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> 类的实例，将 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> 属性设置为步骤 1 中的 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 的实例，然后调用 <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="235d9-252">Create an instance of the <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> class for the publication database, set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the instance of <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1, and call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="235d9-253">如果 <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> 返回 `false`，请确认该数据库是否存在。</span><span class="sxs-lookup"><span data-stu-id="235d9-253">If <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> returns `false`, confirm that the database exists.</span></span>  
  
3.  <span data-ttu-id="235d9-254">如果 <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledMergePublishing%2A> 属性为 `false`，则将其设置为 `true`，然后调用 <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A>。</span><span class="sxs-lookup"><span data-stu-id="235d9-254">If <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledMergePublishing%2A> property is `false`, set it to `true` and call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A>.</span></span>  
  
4.  <span data-ttu-id="235d9-255">创建 <xref:Microsoft.SqlServer.Replication.MergePublication> 类的实例，并设置此对象的以下属性：</span><span class="sxs-lookup"><span data-stu-id="235d9-255">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class, and set the following properties for this object:</span></span>  
  
    -   <span data-ttu-id="235d9-256">将 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 设置为步骤 1 中的 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>。</span><span class="sxs-lookup"><span data-stu-id="235d9-256">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="235d9-257">将 <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>设置为已发布的数据库的名称。</span><span class="sxs-lookup"><span data-stu-id="235d9-257">The name of the published database for <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="235d9-258">将 <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>属性设置为发布的名称。</span><span class="sxs-lookup"><span data-stu-id="235d9-258">A name for the publication for <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>.</span></span>  
  
    -   <span data-ttu-id="235d9-259">将 <xref:Microsoft.SqlServer.Replication.MergePublication.MaxConcurrentDynamicSnapshots%2A>设置为要运行的动态快照作业的最大数目。</span><span class="sxs-lookup"><span data-stu-id="235d9-259">The maximum number of dynamic snapshot jobs to run for <xref:Microsoft.SqlServer.Replication.MergePublication.MaxConcurrentDynamicSnapshots%2A>.</span></span> <span data-ttu-id="235d9-260">因为订阅服务器启动的快照请求随时都可以发生，所以在多个订阅服务器同时请求其分区快照时，此属性会限制可以同时运行的快照代理作业的数目。</span><span class="sxs-lookup"><span data-stu-id="235d9-260">Because Subscriber initiated snapshot requests can occur at any time, this property limits the number of Snapshot Agent jobs that can run simultaneously when multiple Subscribers request their partitioned snapshot at the same time.</span></span> <span data-ttu-id="235d9-261">运行的作业达到最大数目时，其他分区快照请求会进行排队，直到其前面的一个作业运行完才开始运行。</span><span class="sxs-lookup"><span data-stu-id="235d9-261">When the maximum number of jobs are running, additional partitioned snapshot requests are queued until one of the running jobs is completed.</span></span>  
  
    -   <span data-ttu-id="235d9-262">使用逻辑“位或”（在 Visual C# 中为 `|`，在 Visual Basic 中为 `Or`）运算符将值 <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowSubscriberInitiatedSnapshot> 添加到 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A>。</span><span class="sxs-lookup"><span data-stu-id="235d9-262">Use the bitwise logical OR (`|` in Visual C# and `Or` in Visual Basic) operator to add the value <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowSubscriberInitiatedSnapshot> to <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A>.</span></span>  
  
    -   <span data-ttu-id="235d9-263"><xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> 的 <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> 字段和 <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> 字段，用于提供快照代理作业运行时所用的 [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows 帐户的凭据。</span><span class="sxs-lookup"><span data-stu-id="235d9-263">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> fields of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account under which the Snapshot Agent job runs.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="235d9-264">如果发布是由 `sysadmin` 固定服务器角色的成员创建的，则建议设置 <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>。</span><span class="sxs-lookup"><span data-stu-id="235d9-264">Setting <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> is recommended when the publication is created by a member of the `sysadmin` fixed server role.</span></span> <span data-ttu-id="235d9-265">有关详细信息，请参阅 [复制代理安全模式](security/replication-agent-security-model.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-265">For more information, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
5.  <span data-ttu-id="235d9-266">调用 <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> 方法来创建发布。</span><span class="sxs-lookup"><span data-stu-id="235d9-266">Call the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method to create the publication.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="235d9-267">在使用远程分发服务器配置发布服务器时，为所有属性提供的值（包括 <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>）都会以纯文本形式发送到该分发服务器。</span><span class="sxs-lookup"><span data-stu-id="235d9-267">When configuring a Publisher with a remote Distributor, the values supplied for all properties, including <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="235d9-268">调用 <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> 方法之前，应先对发布服务器与其远程分发服务器之间的连接进行加密。</span><span class="sxs-lookup"><span data-stu-id="235d9-268">You should encrypt the connection between the Publisher and its remote Distributor before calling the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method.</span></span> <span data-ttu-id="235d9-269">有关详细信息，请参阅[启用数据库引擎的加密连接（SQL Server 配置管理器）](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-269">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
6.  <span data-ttu-id="235d9-270">使用 <xref:Microsoft.SqlServer.Replication.MergeArticle> 属性将项目添加到发布。</span><span class="sxs-lookup"><span data-stu-id="235d9-270">Use the <xref:Microsoft.SqlServer.Replication.MergeArticle> property to add articles to the publication.</span></span> <span data-ttu-id="235d9-271">至少为一个项目指定 <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> 属性以定义参数化筛选器。</span><span class="sxs-lookup"><span data-stu-id="235d9-271">Specify the <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> property for at least one article that defines the parameterized filter.</span></span> <span data-ttu-id="235d9-272">（可选）创建 <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> 对象以定义项目之间的联接筛选器。</span><span class="sxs-lookup"><span data-stu-id="235d9-272">(Optional) Create <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> objects that define join filters between articles.</span></span> <span data-ttu-id="235d9-273">有关详细信息，请参阅 [定义项目](publish/define-an-article.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-273">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
7.  <span data-ttu-id="235d9-274">如果 <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> 的值为 `false`，请调用 <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> 为此发布创建初始快照代理作业。</span><span class="sxs-lookup"><span data-stu-id="235d9-274">If the value of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> is `false`, call <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> to create the initial Snapshot Agent job for this publication.</span></span>  
  
8.  <span data-ttu-id="235d9-275">调用在步骤 4 中创建的 <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> 对象的 <xref:Microsoft.SqlServer.Replication.MergePublication> 方法。</span><span class="sxs-lookup"><span data-stu-id="235d9-275">Call the <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> method of the <xref:Microsoft.SqlServer.Replication.MergePublication> object created in step 4.</span></span> <span data-ttu-id="235d9-276">这将启动生成初始快照的代理作业。</span><span class="sxs-lookup"><span data-stu-id="235d9-276">This starts the agent job that generates the initial snapshot.</span></span> <span data-ttu-id="235d9-277">有关生成初始快照和为快照代理定义自定义计划的详细信息，请参阅 [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-277">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
9. <span data-ttu-id="235d9-278">（可选）检查 <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> 属性的值是否为 `true`，以确定初始快照何时可以使用。</span><span class="sxs-lookup"><span data-stu-id="235d9-278">(Optional) Check for a value of `true` for the <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> property to determine when the initial snapshot is ready for use.</span></span>  
  
10. <span data-ttu-id="235d9-279">如果订阅服务器的合并代理是第一次连接，则会自动生成一个分区快照。</span><span class="sxs-lookup"><span data-stu-id="235d9-279">When the Merge Agent for a Subscriber connects for the first time, a partitioned snapshot is generated automatically.</span></span>  
  
#### <a name="to-create-a-publication-and-pregenerate-or-automatically-refresh-snapshots"></a><span data-ttu-id="235d9-280">创建发布并预生成快照或自动刷新快照</span><span class="sxs-lookup"><span data-stu-id="235d9-280">To create a publication and pregenerate or automatically refresh snapshots</span></span>  
  
1.  <span data-ttu-id="235d9-281">使用 <xref:Microsoft.SqlServer.Replication.MergePublication> 类的实例定义一个合并发布。</span><span class="sxs-lookup"><span data-stu-id="235d9-281">Use an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class to define a merge publication.</span></span> <span data-ttu-id="235d9-282">有关详细信息，请参阅 [Create a Publication](publish/create-a-publication.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-282">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="235d9-283">使用 <xref:Microsoft.SqlServer.Replication.MergeArticle> 属性将项目添加到发布。</span><span class="sxs-lookup"><span data-stu-id="235d9-283">Use the <xref:Microsoft.SqlServer.Replication.MergeArticle> property to add articles to the publication.</span></span> <span data-ttu-id="235d9-284">至少为一个项目指定 <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> 属性以定义参数化筛选器，然后创建任何 <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> 对象以定义项目之间的联接筛选器。</span><span class="sxs-lookup"><span data-stu-id="235d9-284">Specify the <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> property for at least one article that defines the parameterized filter, and create any <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> objects that define join filters between articles.</span></span> <span data-ttu-id="235d9-285">有关详细信息，请参阅 [定义项目](publish/define-an-article.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-285">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
3.  <span data-ttu-id="235d9-286">如果 <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> 的值为 `false`，请调用 <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> 为此发布创建快照代理作业。</span><span class="sxs-lookup"><span data-stu-id="235d9-286">If the value of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> is `false`, call <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> to create the snapshot agent job for this publication.</span></span>  
  
4.  <span data-ttu-id="235d9-287">调用在步骤 1 中创建的 <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> 对象的 <xref:Microsoft.SqlServer.Replication.MergePublication> 方法。</span><span class="sxs-lookup"><span data-stu-id="235d9-287">Call the <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> method of the <xref:Microsoft.SqlServer.Replication.MergePublication> object created in step 1.</span></span> <span data-ttu-id="235d9-288">此方法启动生成初始快照的代理作业。</span><span class="sxs-lookup"><span data-stu-id="235d9-288">This method starts the agent job that generates the initial snapshot.</span></span> <span data-ttu-id="235d9-289">有关生成初始快照和为快照代理定义自定义计划的详细信息，请参阅 [创建并应用初始快照](create-and-apply-the-initial-snapshot.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-289">For more information on generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
5.  <span data-ttu-id="235d9-290">检查 <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> 的值是否为 `true`，以确定初始快照何时可以使用。</span><span class="sxs-lookup"><span data-stu-id="235d9-290">Check for a value of `true` for the <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> property to determine when the initial snapshot is ready for use.</span></span>  
  
6.  <span data-ttu-id="235d9-291">创建 <xref:Microsoft.SqlServer.Replication.MergePartition> 类的实例，然后使用下列属性的一个或两个设置订阅服务器的参数化筛选条件：</span><span class="sxs-lookup"><span data-stu-id="235d9-291">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePartition> class, and set the parameterized filtering criteria for the Subscriber by using one or both of the following properties:</span></span>  
  
    -   <span data-ttu-id="235d9-292">如果订阅服务器的分区是通过 [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) 的结果定义的，请使用 <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterLogin%2A>。</span><span class="sxs-lookup"><span data-stu-id="235d9-292">If the Subscriber's partition is defined by the result of [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), use <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterLogin%2A>.</span></span>  
  
    -   <span data-ttu-id="235d9-293">如果订阅服务器的分区是通过 [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) 的结果或此函数的重载定义的，请使用 <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterHostName%2A>。</span><span class="sxs-lookup"><span data-stu-id="235d9-293">If the Subscriber's partition is defined by the result of [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) or an overload of this function, use <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterHostName%2A>.</span></span>  
  
7.  <span data-ttu-id="235d9-294">创建 <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> 类的实例，然后设置与步骤 6 相同的属性。</span><span class="sxs-lookup"><span data-stu-id="235d9-294">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> class, and set the same property as in step 6.</span></span>  
  
8.  <span data-ttu-id="235d9-295">使用 <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> 类定义用于生成订阅服务器分区的筛选快照的计划。</span><span class="sxs-lookup"><span data-stu-id="235d9-295">Use the <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> class to define a schedule for generating the filtered snapshot for the Subscriber partition.</span></span>  
  
9. <span data-ttu-id="235d9-296">使用步骤 1 中的 <xref:Microsoft.SqlServer.Replication.MergePublication> 实例，调用 <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergePartition%2A>。</span><span class="sxs-lookup"><span data-stu-id="235d9-296">Using the instance of <xref:Microsoft.SqlServer.Replication.MergePublication> from step 1, call <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergePartition%2A>.</span></span> <span data-ttu-id="235d9-297">传递步骤 6 中的 <xref:Microsoft.SqlServer.Replication.MergePartition> 对象。</span><span class="sxs-lookup"><span data-stu-id="235d9-297">Pass the <xref:Microsoft.SqlServer.Replication.MergePartition> object from step 6.</span></span>  
  
10. <span data-ttu-id="235d9-298">使用步骤 1 中的 <xref:Microsoft.SqlServer.Replication.MergePublication> 实例，调用 <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergeDynamicSnapshotJob%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="235d9-298">Using the instance of <xref:Microsoft.SqlServer.Replication.MergePublication> from step 1, call the <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergeDynamicSnapshotJob%2A> method.</span></span> <span data-ttu-id="235d9-299">传递步骤 7 中的 <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> 对象和步骤 8 中的 <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> 对象。</span><span class="sxs-lookup"><span data-stu-id="235d9-299">Pass the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> object from step 7 and the <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> object from step 8.</span></span>  
  
11. <span data-ttu-id="235d9-300">调用 <xref:Microsoft.SqlServer.Replication.MergePublication.EnumMergeDynamicSnapshotJobs%2A>，然后在返回的数组中为新添加的分区快照作业找到 <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> 对象。</span><span class="sxs-lookup"><span data-stu-id="235d9-300">Call <xref:Microsoft.SqlServer.Replication.MergePublication.EnumMergeDynamicSnapshotJobs%2A>, and locate the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> object for the newly added partitioned snapshot job in the returned array.</span></span>  
  
12. <span data-ttu-id="235d9-301">为此作业获取 <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob.Name%2A> 属性。</span><span class="sxs-lookup"><span data-stu-id="235d9-301">Get the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob.Name%2A> property for the job.</span></span>  
  
13. <span data-ttu-id="235d9-302">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 类创建与分发服务器的连接。</span><span class="sxs-lookup"><span data-stu-id="235d9-302">Create a connection to the Distributor by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
14. <span data-ttu-id="235d9-303">创建 SQL Server 管理对象 (SMO) <xref:Microsoft.SqlServer.Management.Smo.Server> 类的实例，并传递步骤 13 中的 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 对象。</span><span class="sxs-lookup"><span data-stu-id="235d9-303">Create an instance of the SQL Server Management Objects (SMO) <xref:Microsoft.SqlServer.Management.Smo.Server> class, passing the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> object from step 13.</span></span>  
  
15. <span data-ttu-id="235d9-304">创建 <xref:Microsoft.SqlServer.Management.Smo.Agent.Job> 类的实例，并传递步骤 14 中的 <xref:Microsoft.SqlServer.Management.Smo.Server.JobServer%2A> 对象的 <xref:Microsoft.SqlServer.Management.Smo.Server> 属性和步骤 12 中的作业名称。</span><span class="sxs-lookup"><span data-stu-id="235d9-304">Create an instance of the <xref:Microsoft.SqlServer.Management.Smo.Agent.Job> class, passing the <xref:Microsoft.SqlServer.Management.Smo.Server.JobServer%2A> property of the <xref:Microsoft.SqlServer.Management.Smo.Server> object from step 14 and the job name from step 12.</span></span>  
  
16. <span data-ttu-id="235d9-305">调用 <xref:Microsoft.SqlServer.Management.Smo.Agent.Job.Start%2A> 方法以启动分区快照作业。</span><span class="sxs-lookup"><span data-stu-id="235d9-305">Call the <xref:Microsoft.SqlServer.Management.Smo.Agent.Job.Start%2A> method to start the partitioned snapshot job.</span></span>  
  
17. <span data-ttu-id="235d9-306">为每个订阅服务器重复步骤 6-16。</span><span class="sxs-lookup"><span data-stu-id="235d9-306">Repeat steps 6-16 for each Subscriber.</span></span>  
  
#### <a name="to-create-a-publication-and-manually-create-snapshots-for-each-partition"></a><span data-ttu-id="235d9-307">创建发布并为每个分区手动创建快照</span><span class="sxs-lookup"><span data-stu-id="235d9-307">To create a publication and manually create snapshots for each partition</span></span>  
  
1.  <span data-ttu-id="235d9-308">使用 <xref:Microsoft.SqlServer.Replication.MergePublication> 类的实例定义一个合并发布。</span><span class="sxs-lookup"><span data-stu-id="235d9-308">Use an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class to define a merge publication.</span></span> <span data-ttu-id="235d9-309">有关详细信息，请参阅 [Create a Publication](publish/create-a-publication.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-309">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="235d9-310">使用 <xref:Microsoft.SqlServer.Replication.MergeArticle> 属性将项目添加到发布。为至少一个项目指定 <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> 属性以定义参数化筛选器，然后创建任何 <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> 对象以定义项目之间的联接筛选器。</span><span class="sxs-lookup"><span data-stu-id="235d9-310">Use the <xref:Microsoft.SqlServer.Replication.MergeArticle> property to add articles to the publication Specify the <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> property for at least one article that defines the parameterized filter, and create any <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> objects that define join filters between articles.</span></span> <span data-ttu-id="235d9-311">有关详细信息，请参阅 [定义项目](publish/define-an-article.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-311">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
3.  <span data-ttu-id="235d9-312">生成初始快照。</span><span class="sxs-lookup"><span data-stu-id="235d9-312">Generate the initial snapshot.</span></span> <span data-ttu-id="235d9-313">有关详细信息，请参阅 [创建并应用初始快照](create-and-apply-the-initial-snapshot.md)。</span><span class="sxs-lookup"><span data-stu-id="235d9-313">For more information, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
4.  <span data-ttu-id="235d9-314">创建 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> 类的实例，并设置下列所需属性：</span><span class="sxs-lookup"><span data-stu-id="235d9-314">Create an instance of the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> class, and set the following required properties:</span></span>  
  
    -   <span data-ttu-id="235d9-315"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> - 发布服务器的名称</span><span class="sxs-lookup"><span data-stu-id="235d9-315"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> - name of the Publisher</span></span>  
  
    -   <span data-ttu-id="235d9-316"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> - 发布数据库的名称</span><span class="sxs-lookup"><span data-stu-id="235d9-316"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> - name of the publication database</span></span>  
  
    -   <span data-ttu-id="235d9-317"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> - 发布的名称</span><span class="sxs-lookup"><span data-stu-id="235d9-317"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> - name of the publication</span></span>  
  
    -   <span data-ttu-id="235d9-318"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> - 分发服务器的名称</span><span class="sxs-lookup"><span data-stu-id="235d9-318"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> - name of the Distributor</span></span>  
  
    -   <span data-ttu-id="235d9-319"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> - 若使用 Windows 集成身份验证，则值为 <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> ；若使用 SQL Server 身份验证，则值为 <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> 。</span><span class="sxs-lookup"><span data-stu-id="235d9-319"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to used Windows Integrated Authentication or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> to use SQL Server Authentication.</span></span>  
  
    -   <span data-ttu-id="235d9-320"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> - 若使用 Windows 集成身份验证，则值为 <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> ；若使用 SQL Server 身份验证，则值为 <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> 。</span><span class="sxs-lookup"><span data-stu-id="235d9-320"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to used Windows Integrated Authentication or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> to use SQL Server Authentication.</span></span>  
  
5.  <span data-ttu-id="235d9-321">将 <xref:Microsoft.SqlServer.Replication.ReplicationType.Merge> 的值设置为 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>。</span><span class="sxs-lookup"><span data-stu-id="235d9-321">Set a value of <xref:Microsoft.SqlServer.Replication.ReplicationType.Merge> for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>.</span></span>  
  
6.  <span data-ttu-id="235d9-322">设置一个或多个下列属性以定义分区参数：</span><span class="sxs-lookup"><span data-stu-id="235d9-322">Set one or more of the following properties to define the partitioning parameters:</span></span>  
  
    -   <span data-ttu-id="235d9-323">如果订阅服务器的分区是通过 [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) 的结果定义的，请使用 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterLogin%2A>。</span><span class="sxs-lookup"><span data-stu-id="235d9-323">If the Subscriber's partition is defined by the result of [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), use <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterLogin%2A>.</span></span>  
  
    -   <span data-ttu-id="235d9-324">如果订阅服务器的分区是通过 [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) 的结果或此函数的重载定义的，请使用 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterHostName%2A>。</span><span class="sxs-lookup"><span data-stu-id="235d9-324">If the Subscriber's partition is defined by the result of [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) or an overload of this function, use <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterHostName%2A>.</span></span>  
  
7.  <span data-ttu-id="235d9-325">调用 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="235d9-325">Call the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> method.</span></span>  
  
8.  <span data-ttu-id="235d9-326">为每个订阅服务器重复步骤 4-7。</span><span class="sxs-lookup"><span data-stu-id="235d9-326">Repeat steps 4-7 for each Subscriber.</span></span>  
  
###  <a name="examples-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="235d9-327">示例 (RMO)</span><span class="sxs-lookup"><span data-stu-id="235d9-327">Examples (RMO)</span></span>  
 <span data-ttu-id="235d9-328">此示例创建一个允许订阅服务器请求快照生成的合并发布。</span><span class="sxs-lookup"><span data-stu-id="235d9-328">This example creates a merge publication that allows Subscribers to requested snapshot generation.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepub)]  
  
 <span data-ttu-id="235d9-329">此示例为带有参数化行筛选器的合并发布手动创建订阅服务器分区和筛选快照。</span><span class="sxs-lookup"><span data-stu-id="235d9-329">This example manually creates the Subscriber partition and the filtered snapshot for a merge publication with parameterized row filters.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePartition](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepartition)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePartition](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepartition)]  
  
 <span data-ttu-id="235d9-330">此示例手动启动快照代理，为带有参数化行筛选器的合并发布的订阅服务器生成筛选数据快照。</span><span class="sxs-lookup"><span data-stu-id="235d9-330">This example manually starts the Snapshot Agent to generate the filtered data snapshot for a Subscriber to a merge publication with parameterized row filters.</span></span>  
  
 [!code-csharp[HowTo#rmo_GenerateFilteredSnapshot](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_generatefilteredsnapshot)]  
  
 [!code-vb[HowTo#rmo_vb_GenerateFilteredSnapshot](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_generatefilteredsnapshot)]  
  
## <a name="see-also"></a><span data-ttu-id="235d9-331">另请参阅</span><span class="sxs-lookup"><span data-stu-id="235d9-331">See Also</span></span>  
 <span data-ttu-id="235d9-332">[Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md) </span><span class="sxs-lookup"><span data-stu-id="235d9-332">[Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md) </span></span>  
 <span data-ttu-id="235d9-333">[Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="235d9-333">[Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md) </span></span>  
 <span data-ttu-id="235d9-334">[具有参数化筛选器的合并发布的快照](snapshots-for-merge-publications-with-parameterized-filters.md) </span><span class="sxs-lookup"><span data-stu-id="235d9-334">[Snapshots for Merge Publications with Parameterized Filters](snapshots-for-merge-publications-with-parameterized-filters.md) </span></span>  
 [<span data-ttu-id="235d9-335">复制安全最佳做法</span><span class="sxs-lookup"><span data-stu-id="235d9-335">Replication Security Best Practices</span></span>](security/replication-security-best-practices.md)  
  
  
