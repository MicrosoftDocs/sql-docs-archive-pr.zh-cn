---
title: 创建推送订阅 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- push subscriptions [SQL Server replication], creating
- merge replication subscribing [SQL Server replication], push subscriptions
- subscriptions [SQL Server replication], push
- snapshot replication [SQL Server], subscribing
- transactional replication, subscribing
ms.assetid: adfbbc61-58d1-4330-9ad6-b14ab1142e2b
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 2195d96f4337cc60ba213deb5e3cc2831d27da76
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87591870"
---
# <a name="create-a-push-subscription"></a><span data-ttu-id="6f02a-102">创建推送订阅</span><span class="sxs-lookup"><span data-stu-id="6f02a-102">Create a Push Subscription</span></span>
  <span data-ttu-id="6f02a-103">本主题说明如何使用 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 、 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]或复制管理对象 (RMO) 在 [!INCLUDE[tsql](../../includes/tsql-md.md)]中创建推送订阅。</span><span class="sxs-lookup"><span data-stu-id="6f02a-103">This topic describes how to create a push subscription in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span> <span data-ttu-id="6f02a-104">有关为非订阅服务器创建推送订阅的信息 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ，请参阅[创建非 SQL Server 订阅服务器的订阅](create-a-subscription-for-a-non-sql-server-subscriber.md)。</span><span class="sxs-lookup"><span data-stu-id="6f02a-104">For information about creating a push subscription for a non-[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Subscriber, see [Create a Subscription for a Non-SQL Server Subscriber](create-a-subscription-for-a-non-sql-server-subscriber.md).</span></span>  
  
  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="6f02a-105">使用 SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="6f02a-105">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="6f02a-106">使用新建订阅向导，在发布服务器或订阅服务器上创建推送订阅。</span><span class="sxs-lookup"><span data-stu-id="6f02a-106">Create a push subscription at the Publisher or the Subscriber using the New Subscription Wizard.</span></span> <span data-ttu-id="6f02a-107">按照向导中的页的指示执行下列操作：</span><span class="sxs-lookup"><span data-stu-id="6f02a-107">Follow the pages in the wizard to:</span></span>  
  
-   <span data-ttu-id="6f02a-108">指定发布服务器和发布。</span><span class="sxs-lookup"><span data-stu-id="6f02a-108">Specify the Publisher and publication.</span></span>  
  
-   <span data-ttu-id="6f02a-109">选择运行复制代理的位置。</span><span class="sxs-lookup"><span data-stu-id="6f02a-109">Select where replication agents will run.</span></span> <span data-ttu-id="6f02a-110">对于推送订阅，根据发布类型的不同，在 **“分发代理位置”** 页或 **“合并代理位置”** 页上选择 **“在分发服务器上运行所有代理(推送订阅)”** 。</span><span class="sxs-lookup"><span data-stu-id="6f02a-110">For a push subscription, select **Run all agents at the Distributor (push subscriptions)** on the **Distribution Agent Location** page or **Merge Agent Location** page, depending on the type of publication.</span></span>  
  
-   <span data-ttu-id="6f02a-111">指定订阅服务器和订阅数据库。</span><span class="sxs-lookup"><span data-stu-id="6f02a-111">Specify Subscribers and subscription databases.</span></span>  
  
-   <span data-ttu-id="6f02a-112">指定复制代理建立连接所用的登录名和密码：</span><span class="sxs-lookup"><span data-stu-id="6f02a-112">Specify the logins and passwords used for connections made by replication agents:</span></span>  
  
    -   <span data-ttu-id="6f02a-113">对于快照发布和事务发布的订阅，在 **“分发代理安全性”** 页上指定凭据。</span><span class="sxs-lookup"><span data-stu-id="6f02a-113">For subscriptions to snapshot and transactional publications, specify credentials on the **Distribution Agent Security** page.</span></span>  
  
    -   <span data-ttu-id="6f02a-114">对于合并发布的订阅，在 **“合并代理安全性”** 页上指定凭据。</span><span class="sxs-lookup"><span data-stu-id="6f02a-114">For subscriptions to merge publications, specify credentials on the **Merge Agent Security** page.</span></span>  
  
     <span data-ttu-id="6f02a-115">有关每个代理所需权限的信息，请参阅 [R复制代理安全模式](security/replication-agent-security-model.md)。</span><span class="sxs-lookup"><span data-stu-id="6f02a-115">For information about the permissions required by each agent, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
-   <span data-ttu-id="6f02a-116">指定同步计划和初始化订阅服务器的时间。</span><span class="sxs-lookup"><span data-stu-id="6f02a-116">Specify a synchronization schedule and when the Subscriber should be initialized.</span></span>  
  
-   <span data-ttu-id="6f02a-117">指定合并发布的其他选项：订阅类型以及用于参数化筛选的值。</span><span class="sxs-lookup"><span data-stu-id="6f02a-117">Specify additional options for merge publications: subscription type; and values for parameterized filtering.</span></span>  
  
-   <span data-ttu-id="6f02a-118">指定允许更新订阅的事务发布的其他选项：订阅服务器是立即在发布服务器上提交更改还是将它们写入队列、用于从订阅服务器连接到发布服务器的凭据。</span><span class="sxs-lookup"><span data-stu-id="6f02a-118">Specify additional options for transactional publications that allow updating subscriptions: whether Subscribers should commit changes at the Publisher immediately or write them to a queue; credentials used to connect from the Subscriber to the Publisher.</span></span>  
  
-   <span data-ttu-id="6f02a-119">还可以编写订阅的脚本（可选）。</span><span class="sxs-lookup"><span data-stu-id="6f02a-119">Optionally script the subscription.</span></span>  
  
#### <a name="to-create-a-push-subscription-from-the-publisher"></a><span data-ttu-id="6f02a-120">从发布服务器创建推送订阅</span><span class="sxs-lookup"><span data-stu-id="6f02a-120">To create a push subscription from the Publisher</span></span>  
  
1.  <span data-ttu-id="6f02a-121">在 [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] 中连接到发布服务器，然后展开服务器节点。</span><span class="sxs-lookup"><span data-stu-id="6f02a-121">Connect to the Publisher in [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="6f02a-122">展开 **“复制”** 文件夹，再展开 **“本地发布”** 文件夹。</span><span class="sxs-lookup"><span data-stu-id="6f02a-122">Expand the **Replication** folder, and then expand the **Local Publications** folder.</span></span>  
  
3.  <span data-ttu-id="6f02a-123">右键单击要为其创建一个或多个订阅的发布，然后单击 **“新建订阅”** 。</span><span class="sxs-lookup"><span data-stu-id="6f02a-123">Right-click the publication for which you want to create one or more subscriptions, and then click **New Subscriptions**.</span></span>  
  
4.  <span data-ttu-id="6f02a-124">完成新建订阅向导中的页。</span><span class="sxs-lookup"><span data-stu-id="6f02a-124">Complete the pages in the New Subscription Wizard.</span></span>  
  
#### <a name="to-create-a-push-subscription-from-the-subscriber"></a><span data-ttu-id="6f02a-125">从订阅服务器创建推送订阅</span><span class="sxs-lookup"><span data-stu-id="6f02a-125">To create a push subscription from the Subscriber</span></span>  
  
1.  <span data-ttu-id="6f02a-126">在 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]中连接到订阅服务器，然后展开服务器节点。</span><span class="sxs-lookup"><span data-stu-id="6f02a-126">Connect to the Subscriber in [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="6f02a-127">展开 **“复制”** 文件夹。</span><span class="sxs-lookup"><span data-stu-id="6f02a-127">Expand the **Replication** folder.</span></span>  
  
3.  <span data-ttu-id="6f02a-128">右键单击 **“本地订阅”** 文件夹，再单击 **“新建订阅”** 。</span><span class="sxs-lookup"><span data-stu-id="6f02a-128">Right-click the **Local Subscriptions** folder, and then click **New Subscriptions**.</span></span>  
  
4.  <span data-ttu-id="6f02a-129">在“新建订阅向导”的“发布”页上，从“发布服务器”下拉列表中选择 \<Find SQL Server Publisher> 或 \<Find Oracle Publisher>   。</span><span class="sxs-lookup"><span data-stu-id="6f02a-129">On the **Publication** page of the New Subscription Wizard, select **\<Find SQL Server Publisher>** or **\<Find Oracle Publisher>** from the **Publisher** drop-down list.</span></span>  
  
5.  <span data-ttu-id="6f02a-130">在 **“连接到服务器”** 对话框中连接到发布服务器。</span><span class="sxs-lookup"><span data-stu-id="6f02a-130">Connect to the Publisher in the **Connect to Server** dialog box.</span></span>  
  
6.  <span data-ttu-id="6f02a-131">在 **“发布”** 页上，选择一个发布。</span><span class="sxs-lookup"><span data-stu-id="6f02a-131">Select a publication on the **Publication** page.</span></span>  
  
7.  <span data-ttu-id="6f02a-132">完成新建订阅向导中的页。</span><span class="sxs-lookup"><span data-stu-id="6f02a-132">Complete the pages in the New Subscription Wizard.</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="6f02a-133">使用 Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="6f02a-133">Using Transact-SQL</span></span>  
 <span data-ttu-id="6f02a-134">可以使用复制存储过程以编程方式创建推送订阅。</span><span class="sxs-lookup"><span data-stu-id="6f02a-134">Push subscriptions can be created programmatically using replication stored procedures.</span></span> <span data-ttu-id="6f02a-135">所用的存储过程取决于订阅所属的发布的类型。</span><span class="sxs-lookup"><span data-stu-id="6f02a-135">The stored procedures used will depend on the type of publication to which the subscription belongs.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="6f02a-136">如果可能，请在运行时提示用户输入安全凭据。</span><span class="sxs-lookup"><span data-stu-id="6f02a-136">When possible, prompt users to enter security credentials at run time.</span></span> <span data-ttu-id="6f02a-137">如果必须在脚本文件中存储凭据，则必须保护文件以防止未经授权的访问。</span><span class="sxs-lookup"><span data-stu-id="6f02a-137">If you must store credentials in a script file, you must secure the file to prevent unauthorized access.</span></span>  
  
#### <a name="to-create-a-push-subscription-to-a-snapshot-or-transactional-publication"></a><span data-ttu-id="6f02a-138">创建快照或事务发布的推送订阅</span><span class="sxs-lookup"><span data-stu-id="6f02a-138">To create a push subscription to a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="6f02a-139">在发布服务器的发布数据库中，通过执行 [sp_helppublication](/sql/relational-databases/system-stored-procedures/sp-helppublication-transact-sql)核实发布是否支持推送订阅。</span><span class="sxs-lookup"><span data-stu-id="6f02a-139">At the Publisher on the publication database, verify that the publication supports push subscriptions by executing [sp_helppublication](/sql/relational-databases/system-stored-procedures/sp-helppublication-transact-sql).</span></span>  
  
    -   <span data-ttu-id="6f02a-140">如果 **allow_push** 的值为 **1**，则支持推送订阅。</span><span class="sxs-lookup"><span data-stu-id="6f02a-140">If the value of **allow_push** is **1**, push subscriptions are supported.</span></span>  
  
    -   <span data-ttu-id="6f02a-141">如果**allow_push**的值为**0**，则执行[sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql)，为指定**allow_push** ， **@property** 并为指定 `true` **@value** 。</span><span class="sxs-lookup"><span data-stu-id="6f02a-141">If the value of **allow_push** is **0**, execute [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql), specifying **allow_push** for **@property** and `true` for **@value**.</span></span>  
  
2.  <span data-ttu-id="6f02a-142">在发布服务器的发布数据库中，执行 [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="6f02a-142">At the Publisher on the publication database, execute [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql).</span></span> <span data-ttu-id="6f02a-143">指定 **@publication** 、 **@subscriber** 和 **@destination_db** 。</span><span class="sxs-lookup"><span data-stu-id="6f02a-143">Specify **@publication**, **@subscriber** and **@destination_db**.</span></span> <span data-ttu-id="6f02a-144">将 **@subscription_type** 指定为 **@subscription_type**。</span><span class="sxs-lookup"><span data-stu-id="6f02a-144">Specify a value of **push** for **@subscription_type**.</span></span> <span data-ttu-id="6f02a-145">有关如何更新订阅的信息，请参阅[创建事务发布的可更新订阅](publish/create-an-updatable-subscription-to-a-transactional-publication.md)</span><span class="sxs-lookup"><span data-stu-id="6f02a-145">For information about how to update subscriptions, see [Create an Updatable Subscription to a Transactional Publication](publish/create-an-updatable-subscription-to-a-transactional-publication.md)</span></span>  
  
3.  <span data-ttu-id="6f02a-146">在发布服务器的发布数据库中，执行 [sp_addpushsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpushsubscription-agent-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="6f02a-146">At the Publisher on the publication database, execute [sp_addpushsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpushsubscription-agent-transact-sql).</span></span> <span data-ttu-id="6f02a-147">指定下列各项：</span><span class="sxs-lookup"><span data-stu-id="6f02a-147">Specify the following:</span></span>  
  
    -   <span data-ttu-id="6f02a-148">**@subscriber**、 **@subscriber_db** 和 **@publication** 参数。</span><span class="sxs-lookup"><span data-stu-id="6f02a-148">The **@subscriber**, **@subscriber_db**, and **@publication** parameters.</span></span>  
  
    -   <span data-ttu-id="6f02a-149">[!INCLUDE[msCoName](../../includes/msconame-md.md)]分发服务器上的分发代理针对和运行时所用的 Windows 凭据 **@job_login** **@job_password** 。</span><span class="sxs-lookup"><span data-stu-id="6f02a-149">The [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows credentials under which the Distribution Agent at the Distributor runs for **@job_login** and **@job_password**.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="6f02a-150">使用 Windows 集成身份验证进行的连接始终使用和指定的 Windows 凭据 **@job_login** **@job_password** 。</span><span class="sxs-lookup"><span data-stu-id="6f02a-150">Connections made using Windows Integrated Authentication always use the Windows credentials specified by **@job_login** and **@job_password**.</span></span> <span data-ttu-id="6f02a-151">分发代理始终使用 Windows 集成身份验证与分发服务器建立本地连接。</span><span class="sxs-lookup"><span data-stu-id="6f02a-151">The Distribution Agent always makes the local connection to the Distributor using Windows Integrated Authentication.</span></span> <span data-ttu-id="6f02a-152">默认情况下，该代理将使用 Windows 集成身份验证连接到订阅服务器。</span><span class="sxs-lookup"><span data-stu-id="6f02a-152">By default, the agent will connect to the Subscriber using Windows Integrated Authentication.</span></span>  
  
    -   <span data-ttu-id="6f02a-153">（可选） **0** 指定为 **@subscriber_security_mode** 值以及 [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 和 **@subscriber_login** ，将 **@subscriber_password**。</span><span class="sxs-lookup"><span data-stu-id="6f02a-153">(Optional) A value of **0** for **@subscriber_security_mode** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **@subscriber_login** and **@subscriber_password**.</span></span> <span data-ttu-id="6f02a-154">如果您需要在连接到订阅服务器时使用 SQL Server 身份验证，则指定这些参数。</span><span class="sxs-lookup"><span data-stu-id="6f02a-154">Specify these parameters if you need to use SQL Server Authentication when connecting to the Subscriber.</span></span>  
  
    -   <span data-ttu-id="6f02a-155">该订阅的分发代理作业计划。</span><span class="sxs-lookup"><span data-stu-id="6f02a-155">A schedule for the Distribution Agent job for this subscription.</span></span> <span data-ttu-id="6f02a-156">有关详细信息，请参阅 [Specify Synchronization Schedules](specify-synchronization-schedules.md)。</span><span class="sxs-lookup"><span data-stu-id="6f02a-156">For more information, see [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="6f02a-157">用远程分发服务器在发布服务器上创建推送订阅时，为所有参数（包括 *job_login* 和 *job_password*）提供的值将以纯文本格式发送到分发服务器。</span><span class="sxs-lookup"><span data-stu-id="6f02a-157">When creating a push subscription at a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="6f02a-158">在执行此存储过程之前，应该对发布服务器及其远程分发服务器之间的连接进行加密。</span><span class="sxs-lookup"><span data-stu-id="6f02a-158">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="6f02a-159">有关详细信息，请参阅[启用数据库引擎的加密连接（SQL Server 配置管理器）](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="6f02a-159">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
#### <a name="to-create-a-push-subscription-to-a-merge-publication"></a><span data-ttu-id="6f02a-160">创建合并发布的推送订阅</span><span class="sxs-lookup"><span data-stu-id="6f02a-160">To create a push subscription to a merge publication</span></span>  
  
1.  <span data-ttu-id="6f02a-161">在发布服务器的发布数据库中，通过执行 [sp_helpmergepublication](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql)核实发布是否支持推送订阅。</span><span class="sxs-lookup"><span data-stu-id="6f02a-161">At the Publisher on the publication database, verify that the publication supports push subscriptions by executing [sp_helpmergepublication](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql).</span></span>  
  
    -   <span data-ttu-id="6f02a-162">如果 **allow_push** 的值为 **1**，则发布支持推送订阅。</span><span class="sxs-lookup"><span data-stu-id="6f02a-162">If the value of **allow_push** is **1**, the publication supports push subscriptions.</span></span>  
  
    -   <span data-ttu-id="6f02a-163">如果**allow_push**的值不为**1**，则执行[sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql)，为指定**allow_push** ， **@property** 并为指定 `true` **@value** 。</span><span class="sxs-lookup"><span data-stu-id="6f02a-163">If the value of **allow_push** is not **1**, execute [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql), specifying **allow_push** for **@property** and `true` for **@value**.</span></span>  
  
2.  <span data-ttu-id="6f02a-164">在发布服务器的发布数据库中，执行 [sp_addmergesubscription](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql)，并指定以下参数：</span><span class="sxs-lookup"><span data-stu-id="6f02a-164">At the Publisher on the publication database, execute [sp_addmergesubscription](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql), specifying the following parameters:</span></span>  
  
    -   <span data-ttu-id="6f02a-165">**@publication**.</span><span class="sxs-lookup"><span data-stu-id="6f02a-165">**@publication**.</span></span> <span data-ttu-id="6f02a-166">这是发布的名称。</span><span class="sxs-lookup"><span data-stu-id="6f02a-166">This is the name of the publication.</span></span>  
  
    -   <span data-ttu-id="6f02a-167">**@subscriber_type**.</span><span class="sxs-lookup"><span data-stu-id="6f02a-167">**@subscriber_type**.</span></span> <span data-ttu-id="6f02a-168">对于客户端订阅，请指定 **local** ，对于服务器订阅，请指定 **global**。</span><span class="sxs-lookup"><span data-stu-id="6f02a-168">For a client subscription, specify **local** and for a server subscription, specify **global**.</span></span>  
  
    -   <span data-ttu-id="6f02a-169">**@subscription_priority**.</span><span class="sxs-lookup"><span data-stu-id="6f02a-169">**@subscription_priority**.</span></span> <span data-ttu-id="6f02a-170">对于服务器订阅，请指定订阅的优先级（从**0.00** 到 **99.99**）。</span><span class="sxs-lookup"><span data-stu-id="6f02a-170">For a server subscription, specify a priority for the subscription (**0.00** to **99.99**).</span></span>  
  
         <span data-ttu-id="6f02a-171">有关详细信息，请参阅 [高级合并复制冲突的检测和解决](merge/advanced-merge-replication-conflict-detection-and-resolution.md)。</span><span class="sxs-lookup"><span data-stu-id="6f02a-171">For more information, see [Advanced Merge Replication Conflict Detection and Resolution](merge/advanced-merge-replication-conflict-detection-and-resolution.md).</span></span>  
  
3.  <span data-ttu-id="6f02a-172">在发布服务器的发布数据库中，执行 [sp_addmergepushsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepushsubscription-agent-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="6f02a-172">At the Publisher on the publication database, execute [sp_addmergepushsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepushsubscription-agent-transact-sql).</span></span> <span data-ttu-id="6f02a-173">指定下列各项：</span><span class="sxs-lookup"><span data-stu-id="6f02a-173">Specify the following:</span></span>  
  
    -   <span data-ttu-id="6f02a-174">**@subscriber**、 **@subscriber_db** 和 **@publication** 参数。</span><span class="sxs-lookup"><span data-stu-id="6f02a-174">The **@subscriber**, **@subscriber_db**, and **@publication** parameters.</span></span>  
  
    -   <span data-ttu-id="6f02a-175">分发服务器上的合并代理针对和运行时所用的 Windows 凭据 **@job_login** **@job_password** 。</span><span class="sxs-lookup"><span data-stu-id="6f02a-175">The Windows credentials under which the Merge Agent at the Distributor runs for **@job_login** and **@job_password**.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="6f02a-176">使用 Windows 集成身份验证进行的连接始终使用和指定的 Windows 凭据 **@job_login** **@job_password** 。</span><span class="sxs-lookup"><span data-stu-id="6f02a-176">Connections made using Windows Integrated Authentication always use the Windows credentials specified by **@job_login** and **@job_password**.</span></span> <span data-ttu-id="6f02a-177">合并代理始终使用 Windows 集成身份验证与分发服务器进行本地连接。</span><span class="sxs-lookup"><span data-stu-id="6f02a-177">The Merge Agent always makes the local connection to the Distributor using Windows Integrated Authentication.</span></span> <span data-ttu-id="6f02a-178">默认情况下，该代理将使用 Windows 集成身份验证连接到订阅服务器。</span><span class="sxs-lookup"><span data-stu-id="6f02a-178">By default, the agent will connect to the Subscriber using Windows Integrated Authentication.</span></span>  
  
    -   <span data-ttu-id="6f02a-179">（可选） **0** 指定为 **@subscriber_security_mode** 值以及 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 和 **@subscriber_login** ，将 **@subscriber_password**。</span><span class="sxs-lookup"><span data-stu-id="6f02a-179">(Optional) A value of **0** for **@subscriber_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **@subscriber_login** and **@subscriber_password**.</span></span> <span data-ttu-id="6f02a-180">如果您需要在连接到订阅服务器时使用 SQL Server 身份验证，则指定这些参数。</span><span class="sxs-lookup"><span data-stu-id="6f02a-180">Specify these parameters if you need to use SQL Server Authentication when connecting to the Subscriber.</span></span>  
  
    -   <span data-ttu-id="6f02a-181">（可选） **0** 指定为 **@publisher_security_mode** 值以及 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 和 **@publisher_login** ，将 **@publisher_password**。</span><span class="sxs-lookup"><span data-stu-id="6f02a-181">(Optional) A value of **0** for **@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **@publisher_login** and **@publisher_password**.</span></span> <span data-ttu-id="6f02a-182">如果您需要在连接到发布服务器时使用 SQL Server 身份验证，则指定这些值。</span><span class="sxs-lookup"><span data-stu-id="6f02a-182">Specify these values if you need to use SQL Server Authentication when connecting to the Publisher.</span></span>  
  
    -   <span data-ttu-id="6f02a-183">该订阅的合并代理作业计划。</span><span class="sxs-lookup"><span data-stu-id="6f02a-183">A schedule for the Merge Agent job for this subscription.</span></span> <span data-ttu-id="6f02a-184">有关详细信息，请参阅 [Specify Synchronization Schedules](specify-synchronization-schedules.md)。</span><span class="sxs-lookup"><span data-stu-id="6f02a-184">For more information, see [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="6f02a-185">用远程分发服务器在发布服务器上创建推送订阅时，为所有参数（包括 *job_login* 和 *job_password*）提供的值将以纯文本格式发送到分发服务器。</span><span class="sxs-lookup"><span data-stu-id="6f02a-185">When creating a push subscription at a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="6f02a-186">在执行此存储过程之前，应该对发布服务器及其远程分发服务器之间的连接进行加密。</span><span class="sxs-lookup"><span data-stu-id="6f02a-186">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="6f02a-187">有关详细信息，请参阅[启用数据库引擎的加密连接（SQL Server 配置管理器）](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="6f02a-187">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
###  <a name="examples-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="6f02a-188">示例 (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="6f02a-188">Examples (Transact-SQL)</span></span>  
 <span data-ttu-id="6f02a-189">以下示例创建事务发布的推送订阅。</span><span class="sxs-lookup"><span data-stu-id="6f02a-189">The following example creates a push subscription to a transactional publication.</span></span> <span data-ttu-id="6f02a-190">登录名和密码值在运行时使用 **sqlcmd** 脚本变量提供。</span><span class="sxs-lookup"><span data-stu-id="6f02a-190">Login and password values are supplied at run time by using **sqlcmd** scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_addtranpushsubscription_agent](../../snippets/tsql/SQL15/replication/howto/tsql/createtranpushsub.sql#sp_addtranpushsubscription_agent)]  
  
 <span data-ttu-id="6f02a-191">以下示例创建合并发布的推送订阅。</span><span class="sxs-lookup"><span data-stu-id="6f02a-191">The following example creates a push subscription to a merge publication.</span></span> <span data-ttu-id="6f02a-192">登录名和密码值在运行时使用 **sqlcmd** 脚本变量提供。</span><span class="sxs-lookup"><span data-stu-id="6f02a-192">Login and password values are supplied at run time by using **sqlcmd** scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_addmergepushsubscriptionagent](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepushsub.sql#sp_addmergepushsubscriptionagent)]  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="6f02a-193">使用复制管理对象 (RMO)</span><span class="sxs-lookup"><span data-stu-id="6f02a-193">Using Replication Management Objects (RMO)</span></span>  
 <span data-ttu-id="6f02a-194">可以使用复制管理对象 (RMO) 以编程方式创建推送订阅。</span><span class="sxs-lookup"><span data-stu-id="6f02a-194">You can create push subscriptions programmatically by using Replication Management Objects (RMO).</span></span> <span data-ttu-id="6f02a-195">用于创建推送订阅的 RMO 类取决于对其创建订阅的发布的类型。</span><span class="sxs-lookup"><span data-stu-id="6f02a-195">The RMO classes you use to create a push subscription depend on the type of publication to which the subscription is created.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="6f02a-196">如果可能，请在运行时提示用户输入安全凭据。</span><span class="sxs-lookup"><span data-stu-id="6f02a-196">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="6f02a-197">如果必须存储凭据，请使用 [Windows .NET Framework 提供的](https://go.microsoft.com/fwlink/?LinkId=34733) Cryptographic Services [!INCLUDE[msCoName](../../includes/msconame-md.md)] （加密服务）。</span><span class="sxs-lookup"><span data-stu-id="6f02a-197">If you must store credentials, use the [cryptographic services](https://go.microsoft.com/fwlink/?LinkId=34733) provided by the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows .NET Framework.</span></span>  
  
#### <a name="to-create-a-push-subscription-to-a-snapshot-or-transactional-publication"></a><span data-ttu-id="6f02a-198">创建快照或事务发布的推送订阅</span><span class="sxs-lookup"><span data-stu-id="6f02a-198">To create a push subscription to a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="6f02a-199">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 类创建与发布服务器的连接。</span><span class="sxs-lookup"><span data-stu-id="6f02a-199">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="6f02a-200">使用步骤 1 中的发布服务器连接，创建 <xref:Microsoft.SqlServer.Replication.TransPublication> 类的实例。</span><span class="sxs-lookup"><span data-stu-id="6f02a-200">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransPublication> class by using the Publisher connection from step 1.</span></span> <span data-ttu-id="6f02a-201">指定 <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>、 <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>和 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>。</span><span class="sxs-lookup"><span data-stu-id="6f02a-201">Specify <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>, <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>, and <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
3.  <span data-ttu-id="6f02a-202">调用 <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="6f02a-202">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="6f02a-203">如果此方法返回 `false` ，则说明步骤2中指定的属性不正确，或者服务器上不存在该发布。</span><span class="sxs-lookup"><span data-stu-id="6f02a-203">If this method returns `false`, either the properties specified in step 2 are incorrect or the publication does not exists on the server.</span></span>  
  
4.  <span data-ttu-id="6f02a-204">在 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> 属性和 <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush> 之间执行逻辑位与（在 Visual C# 中为 `&`，在 Visual Basic 中为 `And`）运算。</span><span class="sxs-lookup"><span data-stu-id="6f02a-204">Perform a bitwise logical AND (`&` in Visual C# and `And` in Visual Basic) between the <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> property and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush>.</span></span> <span data-ttu-id="6f02a-205">如果结果为 <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>，则将 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> 设置为 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> 和 <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush> 之间的逻辑位或（在 Visual C# 中为 `|`，在 Visual Basic 为 `Or`）的结果。</span><span class="sxs-lookup"><span data-stu-id="6f02a-205">If the result is <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>, set <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> to the result of a bitwise logical OR (`|` in Visual C# and `Or` in Visual Basic) between <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush>.</span></span> <span data-ttu-id="6f02a-206">然后，调用 <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> 以启用推送订阅。</span><span class="sxs-lookup"><span data-stu-id="6f02a-206">Then, call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> to enable push subscriptions.</span></span>  
  
5.  <span data-ttu-id="6f02a-207">如果订阅数据库不存在，则使用 <xref:Microsoft.SqlServer.Management.Smo.Database> 类创建该数据库。</span><span class="sxs-lookup"><span data-stu-id="6f02a-207">If the subscription database does not exist, create it by using the <xref:Microsoft.SqlServer.Management.Smo.Database> class.</span></span> <span data-ttu-id="6f02a-208">有关详细信息，请参阅[创建、更改和删除数据库](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md)。</span><span class="sxs-lookup"><span data-stu-id="6f02a-208">For more information, see [Creating, Altering, and Removing Databases](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md).</span></span>  
  
6.  <span data-ttu-id="6f02a-209">创建的 <xref:Microsoft.SqlServer.Replication.TransSubscription> 类的实例。</span><span class="sxs-lookup"><span data-stu-id="6f02a-209">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransSubscription> class.</span></span>  
  
7.  <span data-ttu-id="6f02a-210">设置下列订阅属性：</span><span class="sxs-lookup"><span data-stu-id="6f02a-210">Set the following subscription properties:</span></span>  
  
    -   <span data-ttu-id="6f02a-211">在步骤 1 中为 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 创建的与发布服务器的 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>。</span><span class="sxs-lookup"><span data-stu-id="6f02a-211">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> to the Publisher created in step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="6f02a-212">用于 <xref:Microsoft.SqlServer.Replication.Subscription.SubscriptionDBName%2A>的订阅数据库的名称。</span><span class="sxs-lookup"><span data-stu-id="6f02a-212">Name of the subscription database for <xref:Microsoft.SqlServer.Replication.Subscription.SubscriptionDBName%2A>.</span></span>  
  
    -   <span data-ttu-id="6f02a-213">用于 <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberName%2A>的订阅服务器的名称。</span><span class="sxs-lookup"><span data-stu-id="6f02a-213">Name of the Subscriber for <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberName%2A>.</span></span>  
  
    -   <span data-ttu-id="6f02a-214">用于 <xref:Microsoft.SqlServer.Replication.Subscription.DatabaseName%2A>的发布数据库的名称。</span><span class="sxs-lookup"><span data-stu-id="6f02a-214">Name of the publication database for <xref:Microsoft.SqlServer.Replication.Subscription.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="6f02a-215">用于 <xref:Microsoft.SqlServer.Replication.Subscription.PublicationName%2A>的发布的名称。</span><span class="sxs-lookup"><span data-stu-id="6f02a-215">Name of the publication for <xref:Microsoft.SqlServer.Replication.Subscription.PublicationName%2A>.</span></span>  
  
    -   <span data-ttu-id="6f02a-216"><xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> 的 <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> 和 <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> 或 <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A> 字段，用于提供分发代理在分发服务器中运行所使用的 [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows 帐户的凭据。</span><span class="sxs-lookup"><span data-stu-id="6f02a-216">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> or <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> fields of <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account under which the Distribution Agent runs at the Distributor.</span></span> <span data-ttu-id="6f02a-217">该帐户用于与分发服务器进行本地连接，同时还用于使用 Windows 身份验证进行远程连接。</span><span class="sxs-lookup"><span data-stu-id="6f02a-217">This account is used to make local connections to the Distributor and to make remote connections using Windows Authentication.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="6f02a-218">当 `sysadmin` 固定服务器角色的成员创建订阅时，不需要设置 <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>，尽管建议这样做。</span><span class="sxs-lookup"><span data-stu-id="6f02a-218">Setting <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A> is not required when the subscription is created by a member of the `sysadmin` fixed server role, however it is recommended.</span></span> <span data-ttu-id="6f02a-219">在这种情况下，代理会模拟 SQL Server Agent 帐户。</span><span class="sxs-lookup"><span data-stu-id="6f02a-219">In this case, the agent will impersonate the SQL Server Agent account.</span></span> <span data-ttu-id="6f02a-220">有关详细信息，请参阅 [复制代理安全模式](security/replication-agent-security-model.md)。</span><span class="sxs-lookup"><span data-stu-id="6f02a-220">For more information, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
    -   <span data-ttu-id="6f02a-221">（可选）<xref:Microsoft.SqlServer.Replication.Subscription.CreateSyncAgentByDefault%2A> 的 `true` 值（默认值），用于创建用来同步订阅的代理作业。</span><span class="sxs-lookup"><span data-stu-id="6f02a-221">(Optional) A value of `true` (the default) for <xref:Microsoft.SqlServer.Replication.Subscription.CreateSyncAgentByDefault%2A> to create an agent job that is used to synchronize the subscription.</span></span> <span data-ttu-id="6f02a-222">如果您指定了 `false`，则只能以编程的方式同步订阅。</span><span class="sxs-lookup"><span data-stu-id="6f02a-222">If you specify `false`, the subscription can only be synchronized programmatically.</span></span>  
  
    -   <span data-ttu-id="6f02a-223">（可选）在使用 SQL Server 身份验证连接到订阅服务器时设置 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> 的 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> 和 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> 或 <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberSecurity%2A> 字段。</span><span class="sxs-lookup"><span data-stu-id="6f02a-223">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberSecurity%2A> when using SQL Server Authentication to connect to the Subscriber.</span></span>  
  
8.  <span data-ttu-id="6f02a-224">调用 <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="6f02a-224">Call the <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> method.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="6f02a-225">在具有远程分发服务器的发布服务器上创建推送订阅时，为所有属性（包括 <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>）提供的值将作为纯文本发送到分发服务器。</span><span class="sxs-lookup"><span data-stu-id="6f02a-225">When creating a push subscription at a Publisher with a remote Distributor, the values supplied for all properties, including <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="6f02a-226">调用 <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> 方法之前，应先对发布服务器与其远程分发服务器之间的连接进行加密。</span><span class="sxs-lookup"><span data-stu-id="6f02a-226">You should encrypt the connection between the Publisher and its remote Distributor before calling the <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> method.</span></span> <span data-ttu-id="6f02a-227">有关详细信息，请参阅[启用数据库引擎的加密连接（SQL Server 配置管理器）](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="6f02a-227">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
#### <a name="to-create-a-push-subscription-to-a-merge-publication"></a><span data-ttu-id="6f02a-228">创建合并发布的推送订阅</span><span class="sxs-lookup"><span data-stu-id="6f02a-228">To create a push subscription to a merge publication</span></span>  
  
1.  <span data-ttu-id="6f02a-229">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 类创建与发布服务器的连接。</span><span class="sxs-lookup"><span data-stu-id="6f02a-229">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="6f02a-230">使用步骤 1 中的发布服务器连接，创建 <xref:Microsoft.SqlServer.Replication.MergePublication> 类的实例。</span><span class="sxs-lookup"><span data-stu-id="6f02a-230">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class by using the Publisher connection from step 1.</span></span> <span data-ttu-id="6f02a-231">指定 <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>、 <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>和 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>。</span><span class="sxs-lookup"><span data-stu-id="6f02a-231">Specify <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>, <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>, and <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
3.  <span data-ttu-id="6f02a-232">调用 <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="6f02a-232">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="6f02a-233">如果此方法返回 `false` ，则说明步骤2中指定的属性不正确，或者服务器上不存在该发布。</span><span class="sxs-lookup"><span data-stu-id="6f02a-233">If this method returns `false`, either the properties specified in step 2 are incorrect or the publication does not exists on the server.</span></span>  
  
4.  <span data-ttu-id="6f02a-234">在 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> 属性和 <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush> 之间执行逻辑位与（在 Visual C# 中为 `&`，在 Visual Basic 中为 `And`）运算。</span><span class="sxs-lookup"><span data-stu-id="6f02a-234">Perform a bitwise logical AND (`&` in Visual C# and `And` in Visual Basic) between the <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> property and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush>.</span></span> <span data-ttu-id="6f02a-235">如果结果为 <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>，则将 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> 设置为 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> 和 <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush> 之间的逻辑位或（在 Visual C# 中为 `|`，在 Visual Basic 为 `Or`）的结果。</span><span class="sxs-lookup"><span data-stu-id="6f02a-235">If the result is <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>, set <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> to the result of a bitwise logical OR (`|` in Visual C# and `Or` in Visual Basic) between <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush>.</span></span> <span data-ttu-id="6f02a-236">然后，调用 <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> 以启用推送订阅。</span><span class="sxs-lookup"><span data-stu-id="6f02a-236">Then, call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> to enable push subscriptions.</span></span>  
  
5.  <span data-ttu-id="6f02a-237">如果订阅数据库不存在，则使用 <xref:Microsoft.SqlServer.Management.Smo.Database> 类创建该数据库。</span><span class="sxs-lookup"><span data-stu-id="6f02a-237">If the subscription database does not exist, create it by using the <xref:Microsoft.SqlServer.Management.Smo.Database> class.</span></span> <span data-ttu-id="6f02a-238">有关详细信息，请参阅[创建、更改和删除数据库](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md)。</span><span class="sxs-lookup"><span data-stu-id="6f02a-238">For more information, see [Creating, Altering, and Removing Databases](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md).</span></span>  
  
6.  <span data-ttu-id="6f02a-239">创建的 <xref:Microsoft.SqlServer.Replication.MergeSubscription> 类的实例。</span><span class="sxs-lookup"><span data-stu-id="6f02a-239">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergeSubscription> class.</span></span>  
  
7.  <span data-ttu-id="6f02a-240">设置下列订阅属性：</span><span class="sxs-lookup"><span data-stu-id="6f02a-240">Set the following subscription properties:</span></span>  
  
    -   <span data-ttu-id="6f02a-241">在步骤 1 中为 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 创建的与发布服务器的 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>。</span><span class="sxs-lookup"><span data-stu-id="6f02a-241">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> to the Publisher created in step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="6f02a-242">用于 <xref:Microsoft.SqlServer.Replication.Subscription.SubscriptionDBName%2A>的订阅数据库的名称。</span><span class="sxs-lookup"><span data-stu-id="6f02a-242">Name of the subscription database for <xref:Microsoft.SqlServer.Replication.Subscription.SubscriptionDBName%2A>.</span></span>  
  
    -   <span data-ttu-id="6f02a-243">用于 <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberName%2A>的订阅服务器的名称。</span><span class="sxs-lookup"><span data-stu-id="6f02a-243">Name of the Subscriber for <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberName%2A>.</span></span>  
  
    -   <span data-ttu-id="6f02a-244">用于 <xref:Microsoft.SqlServer.Replication.Subscription.DatabaseName%2A>的发布数据库的名称。</span><span class="sxs-lookup"><span data-stu-id="6f02a-244">Name of the publication database for <xref:Microsoft.SqlServer.Replication.Subscription.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="6f02a-245">用于 <xref:Microsoft.SqlServer.Replication.Subscription.PublicationName%2A>的发布的名称。</span><span class="sxs-lookup"><span data-stu-id="6f02a-245">Name of the publication for <xref:Microsoft.SqlServer.Replication.Subscription.PublicationName%2A>.</span></span>  
  
    -   <span data-ttu-id="6f02a-246"><xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> 的 <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> 和 <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> 或 <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A> 字段，用于提供合并代理在分发服务器中运行时所使用的 [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows 帐户的凭据。</span><span class="sxs-lookup"><span data-stu-id="6f02a-246">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> or <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> fields of <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account under which the Merge Agent runs at the Distributor.</span></span> <span data-ttu-id="6f02a-247">该帐户用于与分发服务器进行本地连接，同时还用于使用 Windows 身份验证进行远程连接。</span><span class="sxs-lookup"><span data-stu-id="6f02a-247">This account is used to make local connections to the Distributor and to make remote connections using Windows Authentication.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="6f02a-248">当 `sysadmin` 固定服务器角色的成员创建订阅时，不需要设置 <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>，尽管建议这样做。</span><span class="sxs-lookup"><span data-stu-id="6f02a-248">Setting <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A> is not required when the subscription is created by a member of the `sysadmin` fixed server role, however it is recommended.</span></span> <span data-ttu-id="6f02a-249">在这种情况下，代理会模拟 SQL Server Agent 帐户。</span><span class="sxs-lookup"><span data-stu-id="6f02a-249">In this case, the agent will impersonate the SQL Server Agent account.</span></span> <span data-ttu-id="6f02a-250">有关详细信息，请参阅 [复制代理安全模式](security/replication-agent-security-model.md)。</span><span class="sxs-lookup"><span data-stu-id="6f02a-250">For more information, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
    -   <span data-ttu-id="6f02a-251">（可选）<xref:Microsoft.SqlServer.Replication.Subscription.CreateSyncAgentByDefault%2A> 的 `true` 值（默认值），用于创建用来同步订阅的代理作业。</span><span class="sxs-lookup"><span data-stu-id="6f02a-251">(Optional) A value of `true` (the default) for <xref:Microsoft.SqlServer.Replication.Subscription.CreateSyncAgentByDefault%2A> to create an agent job that is used to synchronize the subscription.</span></span> <span data-ttu-id="6f02a-252">如果您指定了 `false`，则只能以编程的方式同步订阅。</span><span class="sxs-lookup"><span data-stu-id="6f02a-252">If you specify `false`, the subscription can only be synchronized programmatically.</span></span>  
  
    -   <span data-ttu-id="6f02a-253">（可选）在使用 SQL Server 身份验证连接到订阅服务器时设置 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> 的 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> 和 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> 或 <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberSecurity%2A> 字段。</span><span class="sxs-lookup"><span data-stu-id="6f02a-253">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberSecurity%2A> when using SQL Server Authentication to connect to the Subscriber.</span></span>  
  
    -   <span data-ttu-id="6f02a-254">（可选）在使用 SQL Server 身份验证连接到发布服务器时设置 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> 的 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> 和 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> 或 <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherSecurity%2A> 字段。</span><span class="sxs-lookup"><span data-stu-id="6f02a-254">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherSecurity%2A> when using SQL Server Authentication to connect to the Publisher.</span></span>  
  
8.  <span data-ttu-id="6f02a-255">调用 <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="6f02a-255">Call the <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> method.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="6f02a-256">在具有远程分发服务器的发布服务器上创建推送订阅时，为所有属性（包括 <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>）提供的值将作为纯文本发送到分发服务器。</span><span class="sxs-lookup"><span data-stu-id="6f02a-256">When creating a push subscription at a Publisher with a remote Distributor, the values supplied for all properties, including <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="6f02a-257">调用 <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> 方法之前，应先对发布服务器与其远程分发服务器之间的连接进行加密。</span><span class="sxs-lookup"><span data-stu-id="6f02a-257">You should encrypt the connection between the Publisher and its remote Distributor before calling the <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> method.</span></span> <span data-ttu-id="6f02a-258">有关详细信息，请参阅[启用数据库引擎的加密连接（SQL Server 配置管理器）](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="6f02a-258">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
###  <a name="examples-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="6f02a-259">示例 (RMO)</span><span class="sxs-lookup"><span data-stu-id="6f02a-259">Examples (RMO)</span></span>  
 <span data-ttu-id="6f02a-260">该示例创建事务发布的新推送订阅。</span><span class="sxs-lookup"><span data-stu-id="6f02a-260">This example creates a new push subscription to a transactional publication.</span></span> <span data-ttu-id="6f02a-261">用于运行分发代理作业的 Windows 帐户凭据在运行时通过。</span><span class="sxs-lookup"><span data-stu-id="6f02a-261">The Windows account credentials you use to run the Distribution Agent job are passed at runtime.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateTranPushSub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createtranpushsub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateTranPushSub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createtranpushsub)]  
  
 <span data-ttu-id="6f02a-262">该示例创建合并发布的新推送订阅。</span><span class="sxs-lookup"><span data-stu-id="6f02a-262">This example creates a new push subscription to a merge publication.</span></span> <span data-ttu-id="6f02a-263">用于运行合并代理作业的 Windows 帐户凭据在运行时通过。</span><span class="sxs-lookup"><span data-stu-id="6f02a-263">The Windows account credentials you use to run the Merge Agent job are passed at runtime.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePushSub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepushsub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePushSub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepushsub)]  
  
## <a name="see-also"></a><span data-ttu-id="6f02a-264">另请参阅</span><span class="sxs-lookup"><span data-stu-id="6f02a-264">See Also</span></span>  
 <span data-ttu-id="6f02a-265">[查看和修改推送订阅属性](view-and-modify-push-subscription-properties.md) </span><span class="sxs-lookup"><span data-stu-id="6f02a-265">[View and Modify Push Subscription Properties](view-and-modify-push-subscription-properties.md) </span></span>  
 <span data-ttu-id="6f02a-266">[Replication Security Best Practices](security/replication-security-best-practices.md) </span><span class="sxs-lookup"><span data-stu-id="6f02a-266">[Replication Security Best Practices](security/replication-security-best-practices.md) </span></span>  
 <span data-ttu-id="6f02a-267">[Create a Publication](publish/create-a-publication.md) </span><span class="sxs-lookup"><span data-stu-id="6f02a-267">[Create a Publication](publish/create-a-publication.md) </span></span>  
 <span data-ttu-id="6f02a-268">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="6f02a-268">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span></span>  
 <span data-ttu-id="6f02a-269">[同步推送订阅](synchronize-a-push-subscription.md) </span><span class="sxs-lookup"><span data-stu-id="6f02a-269">[Synchronize a Push Subscription](synchronize-a-push-subscription.md) </span></span>  
 <span data-ttu-id="6f02a-270">[Subscribe to Publications](subscribe-to-publications.md) </span><span class="sxs-lookup"><span data-stu-id="6f02a-270">[Subscribe to Publications](subscribe-to-publications.md) </span></span>  
 [<span data-ttu-id="6f02a-271">将 sqlcmd 与脚本变量结合使用</span><span class="sxs-lookup"><span data-stu-id="6f02a-271">Use sqlcmd with Scripting Variables</span></span>](../scripting/sqlcmd-use-with-scripting-variables.md)  
  
  
