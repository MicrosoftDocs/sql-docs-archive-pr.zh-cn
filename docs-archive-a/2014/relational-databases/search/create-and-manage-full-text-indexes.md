---
title: 创建和管理全文索引 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: search
ms.topic: conceptual
helpviewer_keywords:
- full-text indexes [SQL Server], about
ms.assetid: f8a98486-5438-44a8-b454-9e6ecbc74f83
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 603b5e6b929259dc8b1408c0c2a1afab383446e1
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87689842"
---
# <a name="create-and-manage-full-text-indexes"></a><span data-ttu-id="11529-102">创建和管理全文索引</span><span class="sxs-lookup"><span data-stu-id="11529-102">Create and Manage Full-Text Indexes</span></span>
  <span data-ttu-id="11529-103">全文引擎使用全文索引中的信息来编译可快速搜索表中的特定词或词组的全文查询。</span><span class="sxs-lookup"><span data-stu-id="11529-103">The information in full-text indexes is used by the Full-Text Engine to compile full-text queries that can quickly search a table for particular words or combinations of words.</span></span> <span data-ttu-id="11529-104">全文索引将有关重要的词及其位置的信息存储在数据库表的一列或多列中。</span><span class="sxs-lookup"><span data-stu-id="11529-104">A full-text index stores information about significant words and their location within one or more columns of a database table.</span></span> <span data-ttu-id="11529-105">全文索引是一种特殊类型的基于标记的功能性索引，它是由 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]全文引擎生成和维护的。</span><span class="sxs-lookup"><span data-stu-id="11529-105">A full-text index is a special type of token-based functional index that is built and maintained by the Full-Text Engine for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="11529-106">生成全文索引的过程不同于生成其他类型的索引。</span><span class="sxs-lookup"><span data-stu-id="11529-106">The process of building a full-text index differs from building other types of indexes.</span></span> <span data-ttu-id="11529-107">全文引擎并非基于特定行中存储的值来构造 B 树结构，而是基于要编制索引的文本中的各个标记来生成倒排、堆积且压缩的索引结构。</span><span class="sxs-lookup"><span data-stu-id="11529-107">Instead of constructing a B-tree structure based on a value stored in a particular row, the Full-Text Engine builds an inverted, stacked, compressed index structure based on individual tokens from the text being indexed.</span></span>  <span data-ttu-id="11529-108">全文索引大小仅受运行 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例的计算机的可用内存资源限制。</span><span class="sxs-lookup"><span data-stu-id="11529-108">The size of a full-text index is limited only by the available memory resources of the computer on which the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is running.</span></span>  
  
 <span data-ttu-id="11529-109">从 [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)]开始，全文索引与数据库引擎集成在一起，而不是像 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]早期版本那样位于文件系统中。</span><span class="sxs-lookup"><span data-stu-id="11529-109">Beginning in [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)], the full-text indexes are integrated with the Database Engine, instead of residing in the file system as in previous versions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="11529-110">对于新数据库，全文目录现在为不属于任何文件组的虚拟对象；它仅是一个表示一组全文索引的逻辑概念。</span><span class="sxs-lookup"><span data-stu-id="11529-110">For a new database, the full-text catalog is now a virtual object that does not belong to any filegroup; it is merely a logical concept that refers to a group of the full-text indexes.</span></span> <span data-ttu-id="11529-111">然而，请注意，在升级 [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] 数据库（即包含数据文件的任意全文目录）的过程中，将创建一个新文件组。有关详细信息，请参阅 [升级全文搜索](upgrade-full-text-search.md)。</span><span class="sxs-lookup"><span data-stu-id="11529-111">Note, however, that during upgrade of a [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] database, any full-text catalog that contains data files, a new filegroup is created; for more information, see [Upgrade Full-Text Search](upgrade-full-text-search.md).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="11529-112">在 [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] 和更高版本中，全文引擎位于 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 进程中，而不是位于单独的服务中。</span><span class="sxs-lookup"><span data-stu-id="11529-112">In [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] and later versions, the Full-Text Engine resides in the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] process, rather than in a separate service.</span></span> <span data-ttu-id="11529-113">通过将全文引擎集成到数据库引擎中，可提高全文可管理性和总体性能，并进一步优化了混合查询。</span><span class="sxs-lookup"><span data-stu-id="11529-113">Integrating the Full-Text Engine into the Database Engine improves full-text manageability, optimization of mixed query, and overall performance.</span></span>  
  
 <span data-ttu-id="11529-114">每个表只允许有一个全文索引。</span><span class="sxs-lookup"><span data-stu-id="11529-114">Only one full-text index is allowed per table.</span></span> <span data-ttu-id="11529-115">若要对某个表创建全文索引，该表必须具有一个唯一且非 Null 的列。</span><span class="sxs-lookup"><span data-stu-id="11529-115">For a full-text index to be created on a table, the table must have a single, unique nonnull column.</span></span> <span data-ttu-id="11529-116">你可以对以下类型的列创建全文索引：`char`、`varchar`、`nchar`、`nvarchar`、`text`、`ntext`、`image`、`xml`、`varbinary` 和 `varbinary(max)`，从而可对这些列进行全文搜索。</span><span class="sxs-lookup"><span data-stu-id="11529-116">You can build a full-text index on columns of type `char`, `varchar`, `nchar`, `nvarchar`, `text`, `ntext`, `image`, `xml`, `varbinary`, and `varbinary(max)` can be indexed for full-text search.</span></span> <span data-ttu-id="11529-117">对数据类型为 `varbinary`、`varbinary(max)`、`image` 或 `xml` 的列创建全文索引需要您指定类型列。</span><span class="sxs-lookup"><span data-stu-id="11529-117">Creating a full-text index on a column whose data type is  `varbinary`, `varbinary(max)`, `image`, or `xml` requires that you specify a type column.</span></span> <span data-ttu-id="11529-118">*类型列*是用来存储每行中文档的文件扩展名（.doc、.pdf、xls 等）的表列。</span><span class="sxs-lookup"><span data-stu-id="11529-118">A *type column* is a table column in which you store the file extension (.doc, .pdf, .xls, and so forth) of the document in each row.</span></span>  
  
 <span data-ttu-id="11529-119">创建和维护全文索引的过程称为“填充”  （也称为“爬网”  ）。</span><span class="sxs-lookup"><span data-stu-id="11529-119">The process of creating and maintaining a full-text index is called a *population* (also known as a *crawl*).</span></span> <span data-ttu-id="11529-120">有三种类型的全文索引填充：完全填充、基于更改跟踪的填充和基于时间戳的增量式填充。</span><span class="sxs-lookup"><span data-stu-id="11529-120">There are three types of full-text index population: full population, change tracking-based population, and incremental timestamp-based population.</span></span> <span data-ttu-id="11529-121">有关详细信息，请参阅 [填充全文索引](populate-full-text-indexes.md)。</span><span class="sxs-lookup"><span data-stu-id="11529-121">For more information, see [Populate Full-Text Indexes](populate-full-text-indexes.md).</span></span>  
  
##  <a name="common-tasks"></a><a name="tasks"></a><span data-ttu-id="11529-122">常见任务</span><span class="sxs-lookup"><span data-stu-id="11529-122">Common Tasks</span></span>  
 <span data-ttu-id="11529-123">**创建全文索引**</span><span class="sxs-lookup"><span data-stu-id="11529-123">**To create a full-text index**</span></span>  
  
-   [<span data-ttu-id="11529-124">CREATE FULLTEXT INDEX (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="11529-124">CREATE FULLTEXT INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-fulltext-index-transact-sql)  
  
 <span data-ttu-id="11529-125">**更改全文索引**</span><span class="sxs-lookup"><span data-stu-id="11529-125">**To alter a full-text index**</span></span>  
  
-   [<span data-ttu-id="11529-126">ALTER FULLTEXT INDEX (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="11529-126">ALTER FULLTEXT INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-fulltext-index-transact-sql)  
  
 <span data-ttu-id="11529-127">**删除全文索引**</span><span class="sxs-lookup"><span data-stu-id="11529-127">**To drop a full-text index**</span></span>  
  
-   [<span data-ttu-id="11529-128">DROP FULLTEXT INDEX (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="11529-128">DROP FULLTEXT INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/drop-fulltext-index-transact-sql)  
  
 [<span data-ttu-id="11529-129">本主题内容</span><span class="sxs-lookup"><span data-stu-id="11529-129">In This Topic</span></span>](#top)  
  
##  <a name="full-text-index-structure"></a><a name="structure"></a><span data-ttu-id="11529-130">全文索引结构</span><span class="sxs-lookup"><span data-stu-id="11529-130">Full-Text Index Structure</span></span>  
 <span data-ttu-id="11529-131">对全文索引的结构的良好了解将帮助您了解全文引擎的工作方式。</span><span class="sxs-lookup"><span data-stu-id="11529-131">A good understanding of the structure of a full-text index will help you understand how the Full-Text Engine works.</span></span> <span data-ttu-id="11529-132">本主题使用 **中的** Document [!INCLUDE[ssSampleDBCoShort](../../includes/sssampledbcoshort-md.md)] 表的以下摘录部分作为示例表。</span><span class="sxs-lookup"><span data-stu-id="11529-132">This topic uses the following excerpt of the **Document** table in [!INCLUDE[ssSampleDBCoShort](../../includes/sssampledbcoshort-md.md)] as an example table.</span></span> <span data-ttu-id="11529-133">此摘录部分仅显示该表的两个列（ **DocumentID** 列和 **Title** 列）和三行。</span><span class="sxs-lookup"><span data-stu-id="11529-133">This excerpt shows only two columns, the **DocumentID** column and the **Title** column, and three rows from the table.</span></span>  
  
 <span data-ttu-id="11529-134">对于本示例，我们假定已对“标题”列创建全文索引。</span><span class="sxs-lookup"><span data-stu-id="11529-134">For this example, we will assume that a full-text index has been created on the **Title** column.</span></span>  
  
|<span data-ttu-id="11529-135">DocumentID</span><span class="sxs-lookup"><span data-stu-id="11529-135">DocumentID</span></span>|<span data-ttu-id="11529-136">标题</span><span class="sxs-lookup"><span data-stu-id="11529-136">Title</span></span>|  
|----------------|-----------|  
|<span data-ttu-id="11529-137">1</span><span class="sxs-lookup"><span data-stu-id="11529-137">1</span></span>|<span data-ttu-id="11529-138">Crank Arm and Tire Maintenance</span><span class="sxs-lookup"><span data-stu-id="11529-138">Crank Arm and Tire Maintenance</span></span>|  
|<span data-ttu-id="11529-139">2</span><span class="sxs-lookup"><span data-stu-id="11529-139">2</span></span>|<span data-ttu-id="11529-140">Front Reflector Bracket and Reflector Assembly 3</span><span class="sxs-lookup"><span data-stu-id="11529-140">Front Reflector Bracket and Reflector Assembly 3</span></span>|  
|<span data-ttu-id="11529-141">3</span><span class="sxs-lookup"><span data-stu-id="11529-141">3</span></span>|<span data-ttu-id="11529-142">Front Reflector Bracket Installation</span><span class="sxs-lookup"><span data-stu-id="11529-142">Front Reflector Bracket Installation</span></span>|  
  
 <span data-ttu-id="11529-143">例如，下表（显示 Fragment 1）描述对“Document”表的“Title”列创建的全文索引的内容。</span><span class="sxs-lookup"><span data-stu-id="11529-143">For example, the following table, which shows Fragment 1, depicts the contents of the full-text index created on the **Title** column of the **Document** table.</span></span> <span data-ttu-id="11529-144">与该表呈现的信息相比，全文索引包含更多信息。</span><span class="sxs-lookup"><span data-stu-id="11529-144">Full-text indexes contain more information than is presented in this table.</span></span> <span data-ttu-id="11529-145">该表是全文索引的逻辑表示形式，并且仅为演示目的提供。</span><span class="sxs-lookup"><span data-stu-id="11529-145">The table is a logical representation of a full-text index and is provided for demonstration purposes only.</span></span> <span data-ttu-id="11529-146">行以压缩格式存储，以优化磁盘的使用。</span><span class="sxs-lookup"><span data-stu-id="11529-146">The rows are stored in a compressed format to optimize disk usage.</span></span>  
  
 <span data-ttu-id="11529-147">注意，数据已从原始文档倒排。</span><span class="sxs-lookup"><span data-stu-id="11529-147">Notice that the data has been inverted from the original documents.</span></span> <span data-ttu-id="11529-148">发生数据倒排是因为关键字映射到文档 ID。</span><span class="sxs-lookup"><span data-stu-id="11529-148">Inversion occurs because the keywords are mapped to the document IDs.</span></span> <span data-ttu-id="11529-149">因此，全文索引通常称为倒排索引。</span><span class="sxs-lookup"><span data-stu-id="11529-149">For this reason, a full-text index is often referred to as an inverted index.</span></span>  
  
 <span data-ttu-id="11529-150">还要注意，已从全文索引中删除关键字“and”。</span><span class="sxs-lookup"><span data-stu-id="11529-150">Also notice that the keyword "and" has been removed from the full-text index.</span></span> <span data-ttu-id="11529-151">这样做是因为“and”是非索引字，从全文索引中删除非索引字可以大幅节省磁盘空间，并因此提高查询性能。</span><span class="sxs-lookup"><span data-stu-id="11529-151">This is done because "and" is a stopword, and removing stopwords from a full-text index can lead to substantial savings in disk space thereby improving query performance.</span></span> <span data-ttu-id="11529-152">有关非索引字的详细信息，请参阅 [为全文搜索配置和管理非索引字和非索引字表](configure-and-manage-stopwords-and-stoplists-for-full-text-search.md)。</span><span class="sxs-lookup"><span data-stu-id="11529-152">For more information about stopwords, see [Configure and Manage Stopwords and Stoplists for Full-Text Search](configure-and-manage-stopwords-and-stoplists-for-full-text-search.md).</span></span>  
  
 <span data-ttu-id="11529-153">**碎片 1**</span><span class="sxs-lookup"><span data-stu-id="11529-153">**Fragment 1**</span></span>  
  
|<span data-ttu-id="11529-154">关键字</span><span class="sxs-lookup"><span data-stu-id="11529-154">Keyword</span></span>|<span data-ttu-id="11529-155">ColId</span><span class="sxs-lookup"><span data-stu-id="11529-155">ColId</span></span>|<span data-ttu-id="11529-156">DocId</span><span class="sxs-lookup"><span data-stu-id="11529-156">DocId</span></span>|<span data-ttu-id="11529-157">出现次数</span><span class="sxs-lookup"><span data-stu-id="11529-157">Occurrence</span></span>|  
|-------------|-----------|-----------|----------------|  
|<span data-ttu-id="11529-158">Crank</span><span class="sxs-lookup"><span data-stu-id="11529-158">Crank</span></span>|<span data-ttu-id="11529-159">1</span><span class="sxs-lookup"><span data-stu-id="11529-159">1</span></span>|<span data-ttu-id="11529-160">1</span><span class="sxs-lookup"><span data-stu-id="11529-160">1</span></span>|<span data-ttu-id="11529-161">1</span><span class="sxs-lookup"><span data-stu-id="11529-161">1</span></span>|  
|<span data-ttu-id="11529-162">Arm</span><span class="sxs-lookup"><span data-stu-id="11529-162">Arm</span></span>|<span data-ttu-id="11529-163">1</span><span class="sxs-lookup"><span data-stu-id="11529-163">1</span></span>|<span data-ttu-id="11529-164">1</span><span class="sxs-lookup"><span data-stu-id="11529-164">1</span></span>|<span data-ttu-id="11529-165">2</span><span class="sxs-lookup"><span data-stu-id="11529-165">2</span></span>|  
|<span data-ttu-id="11529-166">Tire</span><span class="sxs-lookup"><span data-stu-id="11529-166">Tire</span></span>|<span data-ttu-id="11529-167">1</span><span class="sxs-lookup"><span data-stu-id="11529-167">1</span></span>|<span data-ttu-id="11529-168">1</span><span class="sxs-lookup"><span data-stu-id="11529-168">1</span></span>|<span data-ttu-id="11529-169">4</span><span class="sxs-lookup"><span data-stu-id="11529-169">4</span></span>|  
|<span data-ttu-id="11529-170">维护</span><span class="sxs-lookup"><span data-stu-id="11529-170">Maintenance</span></span>|<span data-ttu-id="11529-171">1</span><span class="sxs-lookup"><span data-stu-id="11529-171">1</span></span>|<span data-ttu-id="11529-172">1</span><span class="sxs-lookup"><span data-stu-id="11529-172">1</span></span>|<span data-ttu-id="11529-173">5</span><span class="sxs-lookup"><span data-stu-id="11529-173">5</span></span>|  
|<span data-ttu-id="11529-174">Front</span><span class="sxs-lookup"><span data-stu-id="11529-174">Front</span></span>|<span data-ttu-id="11529-175">1</span><span class="sxs-lookup"><span data-stu-id="11529-175">1</span></span>|<span data-ttu-id="11529-176">2</span><span class="sxs-lookup"><span data-stu-id="11529-176">2</span></span>|<span data-ttu-id="11529-177">1</span><span class="sxs-lookup"><span data-stu-id="11529-177">1</span></span>|  
|<span data-ttu-id="11529-178">Front</span><span class="sxs-lookup"><span data-stu-id="11529-178">Front</span></span>|<span data-ttu-id="11529-179">1</span><span class="sxs-lookup"><span data-stu-id="11529-179">1</span></span>|<span data-ttu-id="11529-180">3</span><span class="sxs-lookup"><span data-stu-id="11529-180">3</span></span>|<span data-ttu-id="11529-181">1</span><span class="sxs-lookup"><span data-stu-id="11529-181">1</span></span>|  
|<span data-ttu-id="11529-182">Reflector</span><span class="sxs-lookup"><span data-stu-id="11529-182">Reflector</span></span>|<span data-ttu-id="11529-183">1</span><span class="sxs-lookup"><span data-stu-id="11529-183">1</span></span>|<span data-ttu-id="11529-184">2</span><span class="sxs-lookup"><span data-stu-id="11529-184">2</span></span>|<span data-ttu-id="11529-185">2</span><span class="sxs-lookup"><span data-stu-id="11529-185">2</span></span>|  
|<span data-ttu-id="11529-186">Reflector</span><span class="sxs-lookup"><span data-stu-id="11529-186">Reflector</span></span>|<span data-ttu-id="11529-187">1</span><span class="sxs-lookup"><span data-stu-id="11529-187">1</span></span>|<span data-ttu-id="11529-188">2</span><span class="sxs-lookup"><span data-stu-id="11529-188">2</span></span>|<span data-ttu-id="11529-189">5</span><span class="sxs-lookup"><span data-stu-id="11529-189">5</span></span>|  
|<span data-ttu-id="11529-190">Reflector</span><span class="sxs-lookup"><span data-stu-id="11529-190">Reflector</span></span>|<span data-ttu-id="11529-191">1</span><span class="sxs-lookup"><span data-stu-id="11529-191">1</span></span>|<span data-ttu-id="11529-192">3</span><span class="sxs-lookup"><span data-stu-id="11529-192">3</span></span>|<span data-ttu-id="11529-193">2</span><span class="sxs-lookup"><span data-stu-id="11529-193">2</span></span>|  
|<span data-ttu-id="11529-194">Bracket</span><span class="sxs-lookup"><span data-stu-id="11529-194">Bracket</span></span>|<span data-ttu-id="11529-195">1</span><span class="sxs-lookup"><span data-stu-id="11529-195">1</span></span>|<span data-ttu-id="11529-196">2</span><span class="sxs-lookup"><span data-stu-id="11529-196">2</span></span>|<span data-ttu-id="11529-197">3</span><span class="sxs-lookup"><span data-stu-id="11529-197">3</span></span>|  
|<span data-ttu-id="11529-198">Bracket</span><span class="sxs-lookup"><span data-stu-id="11529-198">Bracket</span></span>|<span data-ttu-id="11529-199">1</span><span class="sxs-lookup"><span data-stu-id="11529-199">1</span></span>|<span data-ttu-id="11529-200">3</span><span class="sxs-lookup"><span data-stu-id="11529-200">3</span></span>|<span data-ttu-id="11529-201">3</span><span class="sxs-lookup"><span data-stu-id="11529-201">3</span></span>|  
|<span data-ttu-id="11529-202">Assembly</span><span class="sxs-lookup"><span data-stu-id="11529-202">Assembly</span></span>|<span data-ttu-id="11529-203">1</span><span class="sxs-lookup"><span data-stu-id="11529-203">1</span></span>|<span data-ttu-id="11529-204">2</span><span class="sxs-lookup"><span data-stu-id="11529-204">2</span></span>|<span data-ttu-id="11529-205">6</span><span class="sxs-lookup"><span data-stu-id="11529-205">6</span></span>|  
|<span data-ttu-id="11529-206">3</span><span class="sxs-lookup"><span data-stu-id="11529-206">3</span></span>|<span data-ttu-id="11529-207">1</span><span class="sxs-lookup"><span data-stu-id="11529-207">1</span></span>|<span data-ttu-id="11529-208">2</span><span class="sxs-lookup"><span data-stu-id="11529-208">2</span></span>|<span data-ttu-id="11529-209">7</span><span class="sxs-lookup"><span data-stu-id="11529-209">7</span></span>|  
|<span data-ttu-id="11529-210">安装</span><span class="sxs-lookup"><span data-stu-id="11529-210">Installation</span></span>|<span data-ttu-id="11529-211">1</span><span class="sxs-lookup"><span data-stu-id="11529-211">1</span></span>|<span data-ttu-id="11529-212">3</span><span class="sxs-lookup"><span data-stu-id="11529-212">3</span></span>|<span data-ttu-id="11529-213">4</span><span class="sxs-lookup"><span data-stu-id="11529-213">4</span></span>|  
  
 <span data-ttu-id="11529-214">**Keyword** 列包含在创建索引时提取的单个标记的表示形式。</span><span class="sxs-lookup"><span data-stu-id="11529-214">The **Keyword** column contains a representation of a single token extracted at indexing time.</span></span> <span data-ttu-id="11529-215">断字符可确定组成标记的词。</span><span class="sxs-lookup"><span data-stu-id="11529-215">Word breakers determine what makes up a token.</span></span>  
  
 <span data-ttu-id="11529-216">“ColId” 列包含的值对应于已建立全文索引的特定列。</span><span class="sxs-lookup"><span data-stu-id="11529-216">The **ColId** column contains a value that corresponds to a particular column that is full-text indexed.</span></span>  
  
 <span data-ttu-id="11529-217">`DocId`列包含八字节整数的值，该值映射到全文索引表中的特定全文键值。</span><span class="sxs-lookup"><span data-stu-id="11529-217">The `DocId` column contains values for an eight-byte integer that maps to a particular full-text key value in a full-text indexed table.</span></span> <span data-ttu-id="11529-218">如果全文键不是整数数据类型，则需要此映射。</span><span class="sxs-lookup"><span data-stu-id="11529-218">This mapping is necessary when the full-text key is not an integer data type.</span></span> <span data-ttu-id="11529-219">在这种情况下，全文键值和值之间的映射 `DocId` 将保留在一个名为 DocId 映射表的单独表中。</span><span class="sxs-lookup"><span data-stu-id="11529-219">In such cases, mappings between full-text key values and `DocId` values are maintained in a separate table called the DocId Mapping table.</span></span> <span data-ttu-id="11529-220">若要查询这些映射，请使用 [sp_fulltext_keymappings](/sql/relational-databases/system-stored-procedures/sp-fulltext-keymappings-transact-sql) 系统存储过程。</span><span class="sxs-lookup"><span data-stu-id="11529-220">To query for these mappings use the [sp_fulltext_keymappings](/sql/relational-databases/system-stored-procedures/sp-fulltext-keymappings-transact-sql) system stored procedure.</span></span> <span data-ttu-id="11529-221">若要满足搜索条件，则上述表中的 DocId 值需要与 DocId Mapping 表联接，以便从所查询的基表中检索行。</span><span class="sxs-lookup"><span data-stu-id="11529-221">To satisfy a search condition, DocId values from the above table need to be joined with the DocId Mapping table to retrieve rows from the base table being queried.</span></span> <span data-ttu-id="11529-222">如果基表的全文键值是整数类型，则该值直接充当 DocId，而不需要映射。</span><span class="sxs-lookup"><span data-stu-id="11529-222">If the full-text key value of the base table is an integer type, the value directly serves as the DocId and no mapping is necessary.</span></span> <span data-ttu-id="11529-223">因此，使用整数全文键值有助于优化全文查询。</span><span class="sxs-lookup"><span data-stu-id="11529-223">Therefore, using integer full-text key values can help optimize full-text queries.</span></span>  
  
 <span data-ttu-id="11529-224">**Occurrence** 列包含整数值。</span><span class="sxs-lookup"><span data-stu-id="11529-224">The **Occurrence** column contains an integer value.</span></span> <span data-ttu-id="11529-225">对于每个 DocId 值，均有一个 Occurrence 值的列表对应于该 DocId 值中特定关键字的相对字偏移量。</span><span class="sxs-lookup"><span data-stu-id="11529-225">For each DocId value, there is a list of occurrence values that correspond to the relative word offsets of the particular keyword within that DocId.</span></span> <span data-ttu-id="11529-226">位置值用于确定短语或邻近匹配项，例如具有相邻位置值的短语。</span><span class="sxs-lookup"><span data-stu-id="11529-226">Occurrence values are useful in determining phrase or proximity matches, for example, phrases have numerically adjacent occurrence values.</span></span> <span data-ttu-id="11529-227">它们还用于计算相关性分数，例如记分时可能会用某个关键字在 DocId 中的出现次数。</span><span class="sxs-lookup"><span data-stu-id="11529-227">They are also useful in computing relevance scores; for example, the number of occurrences of a keyword in a DocId may be used in scoring.</span></span>  
  
 [<span data-ttu-id="11529-228">本主题内容</span><span class="sxs-lookup"><span data-stu-id="11529-228">In This Topic</span></span>](#top)  
  
##  <a name="full-text-index-fragments"></a><a name="fragments"></a><span data-ttu-id="11529-229">全文索引片段</span><span class="sxs-lookup"><span data-stu-id="11529-229">Full-Text Index Fragments</span></span>  
 <span data-ttu-id="11529-230">逻辑全文索引通常拆分到多个内部表中。</span><span class="sxs-lookup"><span data-stu-id="11529-230">The logical full-text index is usually split across multiple internal tables.</span></span> <span data-ttu-id="11529-231">每个内部表称为一个全文索引碎片。</span><span class="sxs-lookup"><span data-stu-id="11529-231">Each internal table is called a full-text index fragment.</span></span> <span data-ttu-id="11529-232">这些碎片中的某一些可能包含比其他碎片更新的数据。</span><span class="sxs-lookup"><span data-stu-id="11529-232">Some of these fragments might contain newer data than others.</span></span> <span data-ttu-id="11529-233">例如，如果用户更新其 DocId 是 3 的以下行，并且该表可自动跟踪更改，则会创建新的碎片。</span><span class="sxs-lookup"><span data-stu-id="11529-233">For example, if a user updates the following row whose DocId is 3 and the table is auto change-tracked, a new fragment is created.</span></span>  
  
|<span data-ttu-id="11529-234">DocumentID</span><span class="sxs-lookup"><span data-stu-id="11529-234">DocumentID</span></span>|<span data-ttu-id="11529-235">标题</span><span class="sxs-lookup"><span data-stu-id="11529-235">Title</span></span>|  
|----------------|-----------|  
|<span data-ttu-id="11529-236">3</span><span class="sxs-lookup"><span data-stu-id="11529-236">3</span></span>|<span data-ttu-id="11529-237">Rear Reflector</span><span class="sxs-lookup"><span data-stu-id="11529-237">Rear Reflector</span></span>|  
  
 <span data-ttu-id="11529-238">在下面的示例（显示 Fragment 2）中，碎片中包含比 Fragment 1 中更新的关于 DocId 3 的数据。</span><span class="sxs-lookup"><span data-stu-id="11529-238">In the following example, which shows Fragment 2, the fragment contains newer data about DocId 3 compared to Fragment 1.</span></span> <span data-ttu-id="11529-239">因此，当用户查询“Rear Reflector”时，会将 Fragment 2 中的数据用于 DocId 3。</span><span class="sxs-lookup"><span data-stu-id="11529-239">Therefore, when the user queries for "Rear Reflector" the data from Fragment 2 is used for DocId 3.</span></span> <span data-ttu-id="11529-240">每个碎片都用一个创建时间戳来标记，可以使用 [sys.fulltext_index_fragments](/sql/relational-databases/system-catalog-views/sys-fulltext-index-fragments-transact-sql) 目录视图查询该时间戳。</span><span class="sxs-lookup"><span data-stu-id="11529-240">Each fragment is marked with a creation timestamp that can be queried by using the [sys.fulltext_index_fragments](/sql/relational-databases/system-catalog-views/sys-fulltext-index-fragments-transact-sql) catalog view.</span></span>  
  
 <span data-ttu-id="11529-241">**碎片 2**</span><span class="sxs-lookup"><span data-stu-id="11529-241">**Fragment 2**</span></span>  
  
|<span data-ttu-id="11529-242">关键字</span><span class="sxs-lookup"><span data-stu-id="11529-242">Keyword</span></span>|<span data-ttu-id="11529-243">ColId</span><span class="sxs-lookup"><span data-stu-id="11529-243">ColId</span></span>|<span data-ttu-id="11529-244">DocId</span><span class="sxs-lookup"><span data-stu-id="11529-244">DocId</span></span>|<span data-ttu-id="11529-245">Occ</span><span class="sxs-lookup"><span data-stu-id="11529-245">Occ</span></span>|  
|-------------|-----------|-----------|---------|  
|<span data-ttu-id="11529-246">Rear</span><span class="sxs-lookup"><span data-stu-id="11529-246">Rear</span></span>|<span data-ttu-id="11529-247">1</span><span class="sxs-lookup"><span data-stu-id="11529-247">1</span></span>|<span data-ttu-id="11529-248">3</span><span class="sxs-lookup"><span data-stu-id="11529-248">3</span></span>|<span data-ttu-id="11529-249">1</span><span class="sxs-lookup"><span data-stu-id="11529-249">1</span></span>|  
|<span data-ttu-id="11529-250">Reflector</span><span class="sxs-lookup"><span data-stu-id="11529-250">Reflector</span></span>|<span data-ttu-id="11529-251">1</span><span class="sxs-lookup"><span data-stu-id="11529-251">1</span></span>|<span data-ttu-id="11529-252">3</span><span class="sxs-lookup"><span data-stu-id="11529-252">3</span></span>|<span data-ttu-id="11529-253">2</span><span class="sxs-lookup"><span data-stu-id="11529-253">2</span></span>|  
  
 <span data-ttu-id="11529-254">从 Fragment 2 可以看到，全文查询需要在内部查询每个碎片，并放弃更旧的条目。</span><span class="sxs-lookup"><span data-stu-id="11529-254">As can be seen from Fragment 2, full-text queries need to query each fragment internally and discard older entries.</span></span> <span data-ttu-id="11529-255">因此，全文索引中太多的全文索引碎片会导致查询性能大幅下降。</span><span class="sxs-lookup"><span data-stu-id="11529-255">Therefore, too many full-text index fragments in the full-text index can lead to substantial degradation in query performance.</span></span> <span data-ttu-id="11529-256">若要减少碎片数，请使用 [ALTER FULLTEXT CATALOG](/sql/t-sql/statements/alter-fulltext-catalog-transact-sql)[!INCLUDE[tsql](../../includes/tsql-md.md)] 语句的 REORGANIZE 选项来重新组织全文目录。</span><span class="sxs-lookup"><span data-stu-id="11529-256">To reduce the number of fragments, reorganize the fulltext catalog by using the REORGANIZE option of the [ALTER FULLTEXT CATALOG](/sql/t-sql/statements/alter-fulltext-catalog-transact-sql)[!INCLUDE[tsql](../../includes/tsql-md.md)] statement.</span></span> <span data-ttu-id="11529-257">此语句将执行一次 *主合并*，主合并将碎片合并成一个更大的碎片，并从全文索引中删除所有过时的条目。</span><span class="sxs-lookup"><span data-stu-id="11529-257">This statement performs a *master merge*, which merges the fragments into a single larger fragment and removes all obsolete entries from the full-text index.</span></span>  
  
 <span data-ttu-id="11529-258">经过重新组织后，示例索引会包含以下行：</span><span class="sxs-lookup"><span data-stu-id="11529-258">After being reorganized, the example index would contain the following rows:</span></span>  
  
|<span data-ttu-id="11529-259">关键字</span><span class="sxs-lookup"><span data-stu-id="11529-259">Keyword</span></span>|<span data-ttu-id="11529-260">ColId</span><span class="sxs-lookup"><span data-stu-id="11529-260">ColId</span></span>|<span data-ttu-id="11529-261">DocId</span><span class="sxs-lookup"><span data-stu-id="11529-261">DocId</span></span>|<span data-ttu-id="11529-262">Occ</span><span class="sxs-lookup"><span data-stu-id="11529-262">Occ</span></span>|  
|-------------|-----------|-----------|---------|  
|<span data-ttu-id="11529-263">Crank</span><span class="sxs-lookup"><span data-stu-id="11529-263">Crank</span></span>|<span data-ttu-id="11529-264">1</span><span class="sxs-lookup"><span data-stu-id="11529-264">1</span></span>|<span data-ttu-id="11529-265">1</span><span class="sxs-lookup"><span data-stu-id="11529-265">1</span></span>|<span data-ttu-id="11529-266">1</span><span class="sxs-lookup"><span data-stu-id="11529-266">1</span></span>|  
|<span data-ttu-id="11529-267">Arm</span><span class="sxs-lookup"><span data-stu-id="11529-267">Arm</span></span>|<span data-ttu-id="11529-268">1</span><span class="sxs-lookup"><span data-stu-id="11529-268">1</span></span>|<span data-ttu-id="11529-269">1</span><span class="sxs-lookup"><span data-stu-id="11529-269">1</span></span>|<span data-ttu-id="11529-270">2</span><span class="sxs-lookup"><span data-stu-id="11529-270">2</span></span>|  
|<span data-ttu-id="11529-271">Tire</span><span class="sxs-lookup"><span data-stu-id="11529-271">Tire</span></span>|<span data-ttu-id="11529-272">1</span><span class="sxs-lookup"><span data-stu-id="11529-272">1</span></span>|<span data-ttu-id="11529-273">1</span><span class="sxs-lookup"><span data-stu-id="11529-273">1</span></span>|<span data-ttu-id="11529-274">4</span><span class="sxs-lookup"><span data-stu-id="11529-274">4</span></span>|  
|<span data-ttu-id="11529-275">维护</span><span class="sxs-lookup"><span data-stu-id="11529-275">Maintenance</span></span>|<span data-ttu-id="11529-276">1</span><span class="sxs-lookup"><span data-stu-id="11529-276">1</span></span>|<span data-ttu-id="11529-277">1</span><span class="sxs-lookup"><span data-stu-id="11529-277">1</span></span>|<span data-ttu-id="11529-278">5</span><span class="sxs-lookup"><span data-stu-id="11529-278">5</span></span>|  
|<span data-ttu-id="11529-279">Front</span><span class="sxs-lookup"><span data-stu-id="11529-279">Front</span></span>|<span data-ttu-id="11529-280">1</span><span class="sxs-lookup"><span data-stu-id="11529-280">1</span></span>|<span data-ttu-id="11529-281">2</span><span class="sxs-lookup"><span data-stu-id="11529-281">2</span></span>|<span data-ttu-id="11529-282">1</span><span class="sxs-lookup"><span data-stu-id="11529-282">1</span></span>|  
|<span data-ttu-id="11529-283">Rear</span><span class="sxs-lookup"><span data-stu-id="11529-283">Rear</span></span>|<span data-ttu-id="11529-284">1</span><span class="sxs-lookup"><span data-stu-id="11529-284">1</span></span>|<span data-ttu-id="11529-285">3</span><span class="sxs-lookup"><span data-stu-id="11529-285">3</span></span>|<span data-ttu-id="11529-286">1</span><span class="sxs-lookup"><span data-stu-id="11529-286">1</span></span>|  
|<span data-ttu-id="11529-287">Reflector</span><span class="sxs-lookup"><span data-stu-id="11529-287">Reflector</span></span>|<span data-ttu-id="11529-288">1</span><span class="sxs-lookup"><span data-stu-id="11529-288">1</span></span>|<span data-ttu-id="11529-289">2</span><span class="sxs-lookup"><span data-stu-id="11529-289">2</span></span>|<span data-ttu-id="11529-290">2</span><span class="sxs-lookup"><span data-stu-id="11529-290">2</span></span>|  
|<span data-ttu-id="11529-291">Reflector</span><span class="sxs-lookup"><span data-stu-id="11529-291">Reflector</span></span>|<span data-ttu-id="11529-292">1</span><span class="sxs-lookup"><span data-stu-id="11529-292">1</span></span>|<span data-ttu-id="11529-293">2</span><span class="sxs-lookup"><span data-stu-id="11529-293">2</span></span>|<span data-ttu-id="11529-294">5</span><span class="sxs-lookup"><span data-stu-id="11529-294">5</span></span>|  
|<span data-ttu-id="11529-295">Reflector</span><span class="sxs-lookup"><span data-stu-id="11529-295">Reflector</span></span>|<span data-ttu-id="11529-296">1</span><span class="sxs-lookup"><span data-stu-id="11529-296">1</span></span>|<span data-ttu-id="11529-297">3</span><span class="sxs-lookup"><span data-stu-id="11529-297">3</span></span>|<span data-ttu-id="11529-298">2</span><span class="sxs-lookup"><span data-stu-id="11529-298">2</span></span>|  
|<span data-ttu-id="11529-299">Bracket</span><span class="sxs-lookup"><span data-stu-id="11529-299">Bracket</span></span>|<span data-ttu-id="11529-300">1</span><span class="sxs-lookup"><span data-stu-id="11529-300">1</span></span>|<span data-ttu-id="11529-301">2</span><span class="sxs-lookup"><span data-stu-id="11529-301">2</span></span>|<span data-ttu-id="11529-302">3</span><span class="sxs-lookup"><span data-stu-id="11529-302">3</span></span>|  
|<span data-ttu-id="11529-303">Assembly</span><span class="sxs-lookup"><span data-stu-id="11529-303">Assembly</span></span>|<span data-ttu-id="11529-304">1</span><span class="sxs-lookup"><span data-stu-id="11529-304">1</span></span>|<span data-ttu-id="11529-305">2</span><span class="sxs-lookup"><span data-stu-id="11529-305">2</span></span>|<span data-ttu-id="11529-306">6</span><span class="sxs-lookup"><span data-stu-id="11529-306">6</span></span>|  
|<span data-ttu-id="11529-307">3</span><span class="sxs-lookup"><span data-stu-id="11529-307">3</span></span>|<span data-ttu-id="11529-308">1</span><span class="sxs-lookup"><span data-stu-id="11529-308">1</span></span>|<span data-ttu-id="11529-309">2</span><span class="sxs-lookup"><span data-stu-id="11529-309">2</span></span>|<span data-ttu-id="11529-310">7</span><span class="sxs-lookup"><span data-stu-id="11529-310">7</span></span>|  
  
 [<span data-ttu-id="11529-311">本主题内容</span><span class="sxs-lookup"><span data-stu-id="11529-311">In This Topic</span></span>](#top)  
  
  
