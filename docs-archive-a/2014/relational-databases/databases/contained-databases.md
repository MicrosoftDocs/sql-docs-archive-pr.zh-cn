---
title: 包含的数据库 | Microsoft Docs
ms.custom: ''
ms.date: 07/17/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: configuration
ms.topic: conceptual
helpviewer_keywords:
- contained database
- database_uncontained_usage event
- partially contained database
- contained database, understanding
ms.assetid: 36af59d7-ce96-4a02-8598-ffdd78cdc948
author: stevestein
ms.author: sstein
ms.openlocfilehash: 3efd231a1aa4d2b348bcfe887bd05825fcd40c90
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87690644"
---
# <a name="contained-databases"></a><span data-ttu-id="7054c-102">包含的数据库</span><span class="sxs-lookup"><span data-stu-id="7054c-102">Contained Databases</span></span>
  <span data-ttu-id="7054c-103">“包含数据库”\*\* 是独立于其他数据库以及承载数据库的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例的一种数据库。</span><span class="sxs-lookup"><span data-stu-id="7054c-103">A*contained database* is a database that is isolated from other databases and from the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that hosts the database.</span></span>  [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] <span data-ttu-id="7054c-104">以 4 种方法帮助用户使其数据库独立于实例。</span><span class="sxs-lookup"><span data-stu-id="7054c-104">helps user to isolate their database from the instance in 4 ways.</span></span>  
  
-   <span data-ttu-id="7054c-105">很多用于描述数据库的元数据都在该数据库中维护。</span><span class="sxs-lookup"><span data-stu-id="7054c-105">Much of the metadata that describes a database is maintained in the database.</span></span> <span data-ttu-id="7054c-106">（除此之外或代替在 master 数据库中维护元数据。）</span><span class="sxs-lookup"><span data-stu-id="7054c-106">(In addition to, or instead of, maintaining metadata in the master database.)</span></span>  
  
-   <span data-ttu-id="7054c-107">使用相同的排序规则定义所有元数据。</span><span class="sxs-lookup"><span data-stu-id="7054c-107">All metadata are defined using the same collation.</span></span>  
  
-   <span data-ttu-id="7054c-108">数据库可执行用户身份验证，因此减少了对 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]实例的登录名的数据库依赖关系。</span><span class="sxs-lookup"><span data-stu-id="7054c-108">User authentication can be performed by the database, reducing the databases dependency on the logins of the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
-   <span data-ttu-id="7054c-109">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 环境（DMV、XEvent 等）报告并可以执行包含信息。</span><span class="sxs-lookup"><span data-stu-id="7054c-109">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] environment (DMV's, XEvents, etc.) reports and can act upon containment information.</span></span>  
  
 <span data-ttu-id="7054c-110">部分包含的数据库的某些功能（例如将元数据存储在数据库中）适用于所有 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 数据库。</span><span class="sxs-lookup"><span data-stu-id="7054c-110">Some features of partially contained databases, such as storing metadata in the database, apply to all [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] databases.</span></span> <span data-ttu-id="7054c-111">部分包含的数据库的某些优点（例如数据库级别身份验证和目录排序规则）必须在可用后才能实现。</span><span class="sxs-lookup"><span data-stu-id="7054c-111">Some benefits of partially contained databases, such as database level authentication and catalog collation, must be enabled before they are available.</span></span> <span data-ttu-id="7054c-112">使用 `CREATE DATABASE` 和 `ALTER DATABASE` 语句或者通过使用 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] 可启用部分包含。</span><span class="sxs-lookup"><span data-stu-id="7054c-112">Partial containment is enabled using the `CREATE DATABASE` and `ALTER DATABASE` statements or by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span></span> <span data-ttu-id="7054c-113">有关如何启用部分数据库包含的详细信息，请参阅 [Migrate to a Partially Contained Database](migrate-to-a-partially-contained-database.md)。</span><span class="sxs-lookup"><span data-stu-id="7054c-113">For more information about how to enable partial database containment, see [Migrate to a Partially Contained Database](migrate-to-a-partially-contained-database.md).</span></span>  
  
 <span data-ttu-id="7054c-114">本主题包含以下各节：</span><span class="sxs-lookup"><span data-stu-id="7054c-114">This topic contains the following sections.</span></span>  
  
-   [<span data-ttu-id="7054c-115">部分包含的数据库概念</span><span class="sxs-lookup"><span data-stu-id="7054c-115">Partially Contained Database Concepts</span></span>](#Concepts)  
  
-   [<span data-ttu-id="7054c-116">包含</span><span class="sxs-lookup"><span data-stu-id="7054c-116">Containment</span></span>](#containment)  
  
-   [<span data-ttu-id="7054c-117">使用部分包含数据库的好处</span><span class="sxs-lookup"><span data-stu-id="7054c-117">Benefits of using Partially Contained Databases</span></span>](#benefits)  
  
-   [<span data-ttu-id="7054c-118">限制</span><span class="sxs-lookup"><span data-stu-id="7054c-118">Limitations</span></span>](#Limitations)  
  
-   [<span data-ttu-id="7054c-119">标识数据库包含</span><span class="sxs-lookup"><span data-stu-id="7054c-119">Identifying Database Containment</span></span>](#Identifying)  
  
##  <a name="partially-contained-database-concepts"></a><a name="Concepts"></a> <span data-ttu-id="7054c-120">部分包含的数据库概念</span><span class="sxs-lookup"><span data-stu-id="7054c-120">Partially Contained Database Concepts</span></span>  
 <span data-ttu-id="7054c-121">完全包含的数据库包括定义数据库所需的所有数据库设置和元数据，它与安装数据库的 [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] 实例没有配置依赖关系。</span><span class="sxs-lookup"><span data-stu-id="7054c-121">A fully contained database includes all the settings and metadata required to define the database and has no configuration dependencies on the instance of the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] where the database is installed.</span></span> <span data-ttu-id="7054c-122">在以前的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]版本中，将一个数据库与 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例隔离开来可能会很耗时，并且要求该数据库与 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]实例之间的关系的详细知识。</span><span class="sxs-lookup"><span data-stu-id="7054c-122">In previous versions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], separating a database from the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] could be time consuming and required detailed knowledge of the relationship between the database and the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="7054c-123">通过部分包含的数据库，可以轻松地将 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例上的数据库与其他数据库隔离开来。</span><span class="sxs-lookup"><span data-stu-id="7054c-123">Partially contained databases make it easier to separate a database from the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] and other databases.</span></span>  
  
 <span data-ttu-id="7054c-124">包含数据库将根据包含情况来考虑功能。</span><span class="sxs-lookup"><span data-stu-id="7054c-124">The contained database considers features with regard to containment.</span></span> <span data-ttu-id="7054c-125">任何只依赖于数据库内部功能的用户定义实体均被视为处于完全包含状态。</span><span class="sxs-lookup"><span data-stu-id="7054c-125">Any user-defined entity that relies only on functions that reside in the database is considered fully contained.</span></span> <span data-ttu-id="7054c-126">任何依赖于数据库外部功能的用户定义实体均被视为处于非包含状态。</span><span class="sxs-lookup"><span data-stu-id="7054c-126">Any user-defined entity that relies on functions that reside outside the database is considered uncontained.</span></span> <span data-ttu-id="7054c-127">（有关详细信息，请参阅本主题后面的 [包含](#containment) 部分。）</span><span class="sxs-lookup"><span data-stu-id="7054c-127">(For more information, see the [Containment](#containment) section later in this topic.)</span></span>  
  
 <span data-ttu-id="7054c-128">以下术语适用于包含数据库模型。</span><span class="sxs-lookup"><span data-stu-id="7054c-128">The following terms apply to the contained database model.</span></span>  
  
 <span data-ttu-id="7054c-129">数据库边界</span><span class="sxs-lookup"><span data-stu-id="7054c-129">Database boundary</span></span>  
 <span data-ttu-id="7054c-130">数据库和 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]实例之间的边界。</span><span class="sxs-lookup"><span data-stu-id="7054c-130">The boundary between a database and the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="7054c-131">数据库和其他数据库之间的边界。</span><span class="sxs-lookup"><span data-stu-id="7054c-131">The boundary between a database and other databases.</span></span>  
  
 <span data-ttu-id="7054c-132">包含</span><span class="sxs-lookup"><span data-stu-id="7054c-132">Contained</span></span>  
 <span data-ttu-id="7054c-133">完全在数据库边界中存在的元素。</span><span class="sxs-lookup"><span data-stu-id="7054c-133">An element that exists entirely in the database boundary.</span></span>  
  
 <span data-ttu-id="7054c-134">非包含</span><span class="sxs-lookup"><span data-stu-id="7054c-134">Uncontained</span></span>  
 <span data-ttu-id="7054c-135">跨数据库边界的元素。</span><span class="sxs-lookup"><span data-stu-id="7054c-135">An element that crosses the database boundary.</span></span>  
  
 <span data-ttu-id="7054c-136">非包含数据库</span><span class="sxs-lookup"><span data-stu-id="7054c-136">Non-contained database</span></span>  
 <span data-ttu-id="7054c-137">具有设置为 **NONE**的包含的数据库。</span><span class="sxs-lookup"><span data-stu-id="7054c-137">A database that has containment set to **NONE**.</span></span> <span data-ttu-id="7054c-138">版本早于 [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] 的所有数据库均属于非包含数据库。</span><span class="sxs-lookup"><span data-stu-id="7054c-138">All databases in versions earlier than [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] are non-contained.</span></span> <span data-ttu-id="7054c-139">默认情况下，所有 [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] 和更高版本数据库的包含都设置为 **NONE**。</span><span class="sxs-lookup"><span data-stu-id="7054c-139">By default, all [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] and later databases have a containment set to **NONE**.</span></span>  
  
 <span data-ttu-id="7054c-140">部分包含数据库</span><span class="sxs-lookup"><span data-stu-id="7054c-140">Partially contained database</span></span>  
 <span data-ttu-id="7054c-141">部分包含数据库是一种包含数据库，可允许存在跨越数据库边界的某些功能。</span><span class="sxs-lookup"><span data-stu-id="7054c-141">A partially contained database is a contained database that can allow some features that cross the database boundary.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="7054c-142">包括确定何时跨越包含边界的功能。</span><span class="sxs-lookup"><span data-stu-id="7054c-142">includes the ability to determine when the containment boundary is crossed.</span></span>  
  
 <span data-ttu-id="7054c-143">包含的用户</span><span class="sxs-lookup"><span data-stu-id="7054c-143">Contained user</span></span>  
 <span data-ttu-id="7054c-144">包含数据库有两种用户类型。</span><span class="sxs-lookup"><span data-stu-id="7054c-144">There are two types of users for contained databases.</span></span>  
  
-   <span data-ttu-id="7054c-145">**具有密码的包含数据库用户**</span><span class="sxs-lookup"><span data-stu-id="7054c-145">**Contained database user with password**</span></span>  
  
     <span data-ttu-id="7054c-146">具有密码的包含数据库用户由数据库进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="7054c-146">Contained database users with passwords are authenticated by the database.</span></span>  
  
-   <span data-ttu-id="7054c-147">**Windows 主体**</span><span class="sxs-lookup"><span data-stu-id="7054c-147">**Windows principals**</span></span>  
  
     <span data-ttu-id="7054c-148">授权的 Windows 用户和授权的 Windows 组的成员可直接连接到数据库，而无需登录 **master** 数据库。</span><span class="sxs-lookup"><span data-stu-id="7054c-148">Authorized Windows users and members of authorized Windows groups can connect directly to the database and do not need logins in the **master** database.</span></span> <span data-ttu-id="7054c-149">数据库信任 Windows身份验证。</span><span class="sxs-lookup"><span data-stu-id="7054c-149">The database trusts the authentication by Windows.</span></span>  
  
 <span data-ttu-id="7054c-150">基于 **master** 数据库中登录名的用户可被授予对包含数据库的访问权限，但将在 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例上创建依赖关系。</span><span class="sxs-lookup"><span data-stu-id="7054c-150">Users based on logins in the **master** database can be granted access to a contained database, but that would create a dependency on the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="7054c-151">因此，基于登录名创建用户将会看到针对部分包含数据库的注释。</span><span class="sxs-lookup"><span data-stu-id="7054c-151">Therefore, creating users based on logins see comment for partially contained databases.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="7054c-152">启用部分包含数据库会将对 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的访问控制委托给该数据库的所有者。</span><span class="sxs-lookup"><span data-stu-id="7054c-152">Enabling partially contained databases delegates control over access to the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to the owners of the database.</span></span> <span data-ttu-id="7054c-153">有关详细信息，请参阅 [Security Best Practices with Contained Databases](security-best-practices-with-contained-databases.md)。</span><span class="sxs-lookup"><span data-stu-id="7054c-153">For more information, see [Security Best Practices with Contained Databases](security-best-practices-with-contained-databases.md).</span></span>  
  
 <span data-ttu-id="7054c-154">数据库边界</span><span class="sxs-lookup"><span data-stu-id="7054c-154">Database Boundary</span></span>  
 <span data-ttu-id="7054c-155">由于部分包含数据库会区分数据库功能与实例功能，因此在这两个元素之间存在一条明确定义的边界，称为“数据库边界” 。</span><span class="sxs-lookup"><span data-stu-id="7054c-155">Because partially contained databases separate the database functionality from those of the instance, there is a clearly defined line between these two elements called the *database boundary*.</span></span>  
  
 <span data-ttu-id="7054c-156">数据库边界之内是“数据库模型” ，在这里开发和管理数据库。</span><span class="sxs-lookup"><span data-stu-id="7054c-156">Inside of the database boundary is the *database model*, where the databases are developed and managed.</span></span> <span data-ttu-id="7054c-157">位于数据库模型内部的实体示例包括：系统表（如 **sys.tables**）、具有密码的包含数据库用户以及当前数据库中由特定名称（包含两部分）引用的用户表。</span><span class="sxs-lookup"><span data-stu-id="7054c-157">Examples of entities located inside of the database include, system tables like **sys.tables**, contained database users with passwords, and user tables in the current database referenced by a two-part name.</span></span>  
  
 <span data-ttu-id="7054c-158">数据库边界之外是“管理模型” ，这与实例级别的功能和管理有关。</span><span class="sxs-lookup"><span data-stu-id="7054c-158">Outside of the database boundary is the *management model*, which pertains to instance-level functions and management.</span></span> <span data-ttu-id="7054c-159">位于数据库边界之外的实体示例包括：系统表（如 **sys.endpoints**）、映射到登录名的用户，以及另一个数据库中由特定名称（包含三部分）引用的用户表。</span><span class="sxs-lookup"><span data-stu-id="7054c-159">Examples of entities located outside of the database boundary include, system tables like **sys.endpoints**, users mapped to logins, and user tables in another database referenced by a three-part-name.</span></span>  
  
##  <a name="containment"></a><a name="containment"></a> <span data-ttu-id="7054c-160">包含</span><span class="sxs-lookup"><span data-stu-id="7054c-160">Containment</span></span>  
 <span data-ttu-id="7054c-161">完全位于数据库内部的用户实体被视为“包含” 实体。</span><span class="sxs-lookup"><span data-stu-id="7054c-161">User entities that reside entirely within the database are considered *contained*.</span></span> <span data-ttu-id="7054c-162">任何位于数据库之外的实体或任何需要与数据库之外的功能进行交互的实体均被视为“非包含” 实体。</span><span class="sxs-lookup"><span data-stu-id="7054c-162">Any entities that reside outside of the database, or rely on interaction with functions outside of the database, are considered *uncontained*.</span></span>  
  
 <span data-ttu-id="7054c-163">一般而言，用户实体分为以下几种包含类别：</span><span class="sxs-lookup"><span data-stu-id="7054c-163">In general, user entities fall into the following categories of containment:</span></span>  
  
-   <span data-ttu-id="7054c-164">完全包含的用户实体（从不跨越数据库边界的用户实体），例如 sys.indexes。</span><span class="sxs-lookup"><span data-stu-id="7054c-164">Fully contained user entities (those that never cross the database boundary), for example sys.indexes.</span></span> <span data-ttu-id="7054c-165">任何使用这些功能的代码或任何只引用这些实体的对象也都是完全包含实体。</span><span class="sxs-lookup"><span data-stu-id="7054c-165">Any code that uses these features or any object that references only these entities is also fully contained.</span></span>  
  
-   <span data-ttu-id="7054c-166">非包含用户实体（跨越数据库边界的用户实体），例如 sys.server_principals 或服务器主体（登录名）本身。</span><span class="sxs-lookup"><span data-stu-id="7054c-166">Uncontained user entities (those that cross the database boundary), for example sys.server_principals or a server principal (login) itself.</span></span> <span data-ttu-id="7054c-167">任何使用这些实体的代码或任何引用这些实体的功能都是非包含实体。</span><span class="sxs-lookup"><span data-stu-id="7054c-167">Any code that uses these entities or any functions that references these entities are uncontained.</span></span>  
  
###  <a name="partially-contained-database"></a><a name="partial"></a> <span data-ttu-id="7054c-168">Partially Contained Database</span><span class="sxs-lookup"><span data-stu-id="7054c-168">Partially Contained Database</span></span>  
 <span data-ttu-id="7054c-169">包含数据库的功能目前只在部分包含状态下可用。</span><span class="sxs-lookup"><span data-stu-id="7054c-169">The contained database feature is currently available only in a partially contained state.</span></span> <span data-ttu-id="7054c-170">部分包含数据库是一种允许使用非包含功能的包含数据库。</span><span class="sxs-lookup"><span data-stu-id="7054c-170">A partially contained database is a contained database that allows the use of uncontained features.</span></span>  
  
 <span data-ttu-id="7054c-171">使用 [sys.dm_db_uncontained_entities](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-uncontained-entities-transact-sql) 和 [sys.sql_modules (Transact-SQL)](/sql/relational-databases/system-catalog-views/sys-sql-modules-transact-sql) 视图可返回有关非包含对象或功能的信息。</span><span class="sxs-lookup"><span data-stu-id="7054c-171">Use the [sys.dm_db_uncontained_entities](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-uncontained-entities-transact-sql) and [sys.sql_modules &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-sql-modules-transact-sql) view to return information about uncontained objects or features.</span></span> <span data-ttu-id="7054c-172">通过确定数据库元素的包含状态，可以发现必须替换或更改哪些对象或功能才能提升包含。</span><span class="sxs-lookup"><span data-stu-id="7054c-172">By determining the containment status of the elements of your database, you can discover what objects or features must be replaced or altered to promote containment.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="7054c-173">由于某些对象的默认包含项目设置的是 **NONE**，此视图可能返回误报的结果。</span><span class="sxs-lookup"><span data-stu-id="7054c-173">Because certain objects have a default containment setting of **NONE**, this view can return false positives.</span></span>  
  
 <span data-ttu-id="7054c-174">部分包含数据库与非包含数据库之间在行为方面的最大区别在于排序规则。</span><span class="sxs-lookup"><span data-stu-id="7054c-174">The behavior of partially contained databases differs most distinctly from that of non-contained databases with regard to collation.</span></span> <span data-ttu-id="7054c-175">有关排序规则问题的详细信息，请参阅 [Contained Database Collations](contained-database-collations.md)。</span><span class="sxs-lookup"><span data-stu-id="7054c-175">For more information about collation issues, see [Contained Database Collations](contained-database-collations.md).</span></span>  
  
##  <a name="benefits-of-using-partially-contained-databases"></a><a name="benefits"></a> <span data-ttu-id="7054c-176">使用部分包含数据库的好处</span><span class="sxs-lookup"><span data-stu-id="7054c-176">Benefits of using Partially Contained Databases</span></span>  
 <span data-ttu-id="7054c-177">与非包含数据库关联的某些问题和复杂性可通过使用部分包含数据库加以解决。</span><span class="sxs-lookup"><span data-stu-id="7054c-177">There are issues and complications associated with the non-contained databases that can be resolved by using a partially contained database.</span></span>  
  
### <a name="database-movement"></a><span data-ttu-id="7054c-178">数据库移动</span><span class="sxs-lookup"><span data-stu-id="7054c-178">Database Movement</span></span>  
 <span data-ttu-id="7054c-179">在移动数据库时会发生的问题之一是：在数据库从一个实例移到另一个实例时，某些重要信息可能无法使用。</span><span class="sxs-lookup"><span data-stu-id="7054c-179">One of the problems that occurs when moving databases, is that some important information can be unavailable when a database is moved from one instance to another.</span></span> <span data-ttu-id="7054c-180">例如，登录信息存储在实例中，而不是存储于数据库中。</span><span class="sxs-lookup"><span data-stu-id="7054c-180">For example, login information is stored within the instance instead of in the database.</span></span> <span data-ttu-id="7054c-181">如果将非包含数据库从 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]的一个实例移到另一个实例，则这些信息会留在原地。</span><span class="sxs-lookup"><span data-stu-id="7054c-181">When you move a non-contained database from one instance to another instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], this information is left behind.</span></span> <span data-ttu-id="7054c-182">您必须标识缺失的信息，并将其与数据库一起移到新的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]实例中。</span><span class="sxs-lookup"><span data-stu-id="7054c-182">You must identify the missing information and move it with your database to the new instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="7054c-183">此过程不仅十分困难，而且耗时。</span><span class="sxs-lookup"><span data-stu-id="7054c-183">This process can be difficult and time-consuming.</span></span>  
  
 <span data-ttu-id="7054c-184">部分包含数据库可以在数据库中存储重要信息，因此，在移动信息后数据库仍具有信息。</span><span class="sxs-lookup"><span data-stu-id="7054c-184">The partially contained database can store important information in the database so the database still has the information after it is moved.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="7054c-185">部分包含数据库可提供文档，说明无法独立于实例的数据库所使用的那些功能。</span><span class="sxs-lookup"><span data-stu-id="7054c-185">A partially contained database can provide documentation describing those features that are used by a database that cannot be separated from the instance.</span></span> <span data-ttu-id="7054c-186">这包括其他相关数据库的列表、数据库要求但无法被包含的系统设置等。</span><span class="sxs-lookup"><span data-stu-id="7054c-186">This includes a list of other interrelated databases, system settings that the database requires but cannot be contained, and so on.</span></span>  
  
### <a name="benefit-of-contained-database-users-with-alwayson"></a><span data-ttu-id="7054c-187">使用 AlwaysOn 的包含数据库用户的好处</span><span class="sxs-lookup"><span data-stu-id="7054c-187">Benefit of Contained Database Users with AlwaysOn</span></span>  
 <span data-ttu-id="7054c-188">通过减少与 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]实例的关联，当您使用 [!INCLUDE[ssHADR](../../includes/sshadr-md.md)]时，在故障转移过程中部分包含数据库可能会很有用。</span><span class="sxs-lookup"><span data-stu-id="7054c-188">By reducing the ties to the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], partially contained databases can be useful during failover when you use [!INCLUDE[ssHADR](../../includes/sshadr-md.md)].</span></span>  
  
 <span data-ttu-id="7054c-189">通过创建包含用户，可使用户直接连接到包含数据库。</span><span class="sxs-lookup"><span data-stu-id="7054c-189">Creating contained users enables the user to connect directly to the contained database.</span></span> <span data-ttu-id="7054c-190">这在高可用性和灾难恢复方案中（例如在 AlwaysOn 解决方案中）是非常重要的功能。</span><span class="sxs-lookup"><span data-stu-id="7054c-190">This is a very significant feature in high availability and disaster recovery scenarios such as in an AlwaysOn solution.</span></span> <span data-ttu-id="7054c-191">如果用户是包含用户，则在故障转移时，用户无需在承载辅助副本的实例上创建登录名，就能够连接到辅助副本。</span><span class="sxs-lookup"><span data-stu-id="7054c-191">If the users are contained users, in case of failover, people would be able to connect to the secondary without creating logins on the instance hosting the secondary.</span></span> <span data-ttu-id="7054c-192">这会给用户带来直接的好处。</span><span class="sxs-lookup"><span data-stu-id="7054c-192">This provides an immediate benefit.</span></span> <span data-ttu-id="7054c-193">有关详细信息，请参阅：[AlwaysOn 可用性组概述 (SQL Server)](../../database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md) 和[针对 AlwaysOn 可用性组的先决条件、限制和建议 (SQL Server)](../../database-engine/availability-groups/windows/prereqs-restrictions-recommendations-always-on-availability.md)。</span><span class="sxs-lookup"><span data-stu-id="7054c-193">For more information, see [Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](../../database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md) and [Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups &#40;SQL Server&#41;](../../database-engine/availability-groups/windows/prereqs-restrictions-recommendations-always-on-availability.md).</span></span>  
  
### <a name="initial-database-development"></a><span data-ttu-id="7054c-194">初始数据库开发</span><span class="sxs-lookup"><span data-stu-id="7054c-194">Initial Database Development</span></span>  
 <span data-ttu-id="7054c-195">由于开发人员可能不知道新数据库的部署环境，因此减少部署环境对数据库的影响可使开发人员的工作变得更加轻松。</span><span class="sxs-lookup"><span data-stu-id="7054c-195">Because a developer may not know where a new database will be deployed, limiting the deployed environmental impacts on the database lessens the work and concern for the developer.</span></span> <span data-ttu-id="7054c-196">在非包含模型中，开发人员必须相应考虑环境对新数据库和程序的可能影响。</span><span class="sxs-lookup"><span data-stu-id="7054c-196">In the non-contained model, the developer must consider possible environmental impacts on the new database and program accordingly.</span></span> <span data-ttu-id="7054c-197">但是，通过使用部分包含数据库，开发人员可检测到数据库在实例级别所受的影响，从而减轻了开发人员的心理负担。</span><span class="sxs-lookup"><span data-stu-id="7054c-197">However, by using partially contained databases, developers can detect instance-level impacts on the database and instance-level concerns for the developer.</span></span>  
  
### <a name="database-administration"></a><span data-ttu-id="7054c-198">数据库管理</span><span class="sxs-lookup"><span data-stu-id="7054c-198">Database Administration</span></span>  
 <span data-ttu-id="7054c-199">通过在数据库中维护数据库设置，而非在 master 数据库中进行维护，使每个数据库所有者都可以更好地控制其数据库，而不必向数据库所有者授予 **sysadmin** 权限。</span><span class="sxs-lookup"><span data-stu-id="7054c-199">Maintaining database settings in the database, instead of in the master database, lets each database owner have more control over their database, without giving the database owner **sysadmin** permission.</span></span>  
  
##  <a name="limitations"></a><a name="Limitations"></a> <span data-ttu-id="7054c-200">限制</span><span class="sxs-lookup"><span data-stu-id="7054c-200">Limitations</span></span>  
 <span data-ttu-id="7054c-201">部分包含数据库不允许以下功能。</span><span class="sxs-lookup"><span data-stu-id="7054c-201">Partially contained databases do not allow the following features.</span></span>  
  
-   <span data-ttu-id="7054c-202">部分包含数据库不能使用复制、更改数据捕获或更改跟踪。</span><span class="sxs-lookup"><span data-stu-id="7054c-202">Partially contained databases cannot use replication, change data capture, or change tracking.</span></span>  
  
-   <span data-ttu-id="7054c-203">编号过程</span><span class="sxs-lookup"><span data-stu-id="7054c-203">Numbered procedures</span></span>  
  
-   <span data-ttu-id="7054c-204">绑定到架构的对象，且依赖于可更改排序规则的内置功能</span><span class="sxs-lookup"><span data-stu-id="7054c-204">Schema-bound objects that depend on built-in functions with collation changes</span></span>  
  
-   <span data-ttu-id="7054c-205">绑定因排序规则更改而导致的变化，包括对对象、列、符号或类型的引用。</span><span class="sxs-lookup"><span data-stu-id="7054c-205">Binding change resulting from collation changes, including references to objects, columns, symbols, or types.</span></span>  
  
-   <span data-ttu-id="7054c-206">复制、变更数据捕获和更改跟踪。</span><span class="sxs-lookup"><span data-stu-id="7054c-206">Replication, change data capture, and change tracking.</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="7054c-207">目前允许临时存储过程。</span><span class="sxs-lookup"><span data-stu-id="7054c-207">Temporary stored procedures are currently permitted.</span></span> <span data-ttu-id="7054c-208">因为临时存储过程违反包含，所以，预计在将来的包含数据库版本中将不再支持临时存储过程。</span><span class="sxs-lookup"><span data-stu-id="7054c-208">Because temporary stored procedures breach containment, they are not expected to be supported in future versions of contained database.</span></span>  
  
##  <a name="identifying-database-containment"></a><a name="Identifying"></a> <span data-ttu-id="7054c-209">标识数据库包含关系</span><span class="sxs-lookup"><span data-stu-id="7054c-209">Identifying Database Containment</span></span>  
 <span data-ttu-id="7054c-210">可以借助两个工具来帮助识别数据库的包含状态。</span><span class="sxs-lookup"><span data-stu-id="7054c-210">There are two tools to help identify the containment status of the database.</span></span> <span data-ttu-id="7054c-211">[sys.dm_db_uncontained_entities (Transact-SQL)](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-uncontained-entities-transact-sql) 是可以显示数据库中所有潜在的非包含实体的视图。</span><span class="sxs-lookup"><span data-stu-id="7054c-211">The [sys.dm_db_uncontained_entities &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-uncontained-entities-transact-sql) is a view that shows all the potentially uncontained entities in the database.</span></span> <span data-ttu-id="7054c-212">在运行时识别出任何实际的非包含实体时将 database_uncontained_usage 事件将发生。</span><span class="sxs-lookup"><span data-stu-id="7054c-212">The database_uncontained_usage event occurs when any actual uncontained entity is identified at run time.</span></span>  
  
### <a name="sysdm_db_uncontained_entities"></a><span data-ttu-id="7054c-213">sys.dm_db_uncontained_entities</span><span class="sxs-lookup"><span data-stu-id="7054c-213">sys.dm_db_uncontained_entities</span></span>  
 <span data-ttu-id="7054c-214">此视图显示数据库中有可能成为非包含实体的所有实体（如跨数据库边界的那些实体）。</span><span class="sxs-lookup"><span data-stu-id="7054c-214">This view shows any entities in the database that have the potential to be uncontained, such as those that cross-the database boundary.</span></span> <span data-ttu-id="7054c-215">这包括可能在数据库模型外部使用对象的那些用户实体。</span><span class="sxs-lookup"><span data-stu-id="7054c-215">This includes those user entities that may use objects outside the database model.</span></span> <span data-ttu-id="7054c-216">但是，由于直到运行时才能确定某些实体（例如那些使用动态 SQL 的实体）的包含关系，所以此视图中显示的某些实体实际上可能并不是非包含实体。</span><span class="sxs-lookup"><span data-stu-id="7054c-216">However, because the containment of some entities (for example, those using dynamic SQL) cannot be determined until run time, the view may show some entities that are not actually uncontained.</span></span> <span data-ttu-id="7054c-217">有关详细信息，请参阅 [sys.dm_db_uncontained_entities (Transact-SQL)](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-uncontained-entities-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="7054c-217">For more information, see [sys.dm_db_uncontained_entities &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-uncontained-entities-transact-sql).</span></span>  
  
### <a name="database_uncontained_usage-event"></a><span data-ttu-id="7054c-218">database_uncontained_usage 事件</span><span class="sxs-lookup"><span data-stu-id="7054c-218">database_uncontained_usage event</span></span>  
 <span data-ttu-id="7054c-219">在运行时标识出非包含实体时将发生此 XEvent。</span><span class="sxs-lookup"><span data-stu-id="7054c-219">This XEvent occurs whenever an uncontained entity is identified at run time.</span></span> <span data-ttu-id="7054c-220">这包括源自客户端代码的实体。</span><span class="sxs-lookup"><span data-stu-id="7054c-220">This includes entities originated in client code.</span></span> <span data-ttu-id="7054c-221">此 XEvent 仅针对实际的非包含实体发生。</span><span class="sxs-lookup"><span data-stu-id="7054c-221">This XEvent will occur only for actual uncontained entities.</span></span> <span data-ttu-id="7054c-222">但是，该事件仅在运行时发生。</span><span class="sxs-lookup"><span data-stu-id="7054c-222">However, the event only occurs at run time.</span></span> <span data-ttu-id="7054c-223">因此，此 XEvent 将不能识别您尚未运行的任何非包含用户实体。</span><span class="sxs-lookup"><span data-stu-id="7054c-223">Therefore, any uncontained user entities you have not run will not be identified by this XEvent</span></span>  
  
## <a name="related-content"></a><span data-ttu-id="7054c-224">相关内容</span><span class="sxs-lookup"><span data-stu-id="7054c-224">Related Content</span></span>  
 [<span data-ttu-id="7054c-225">经过修改的功能（包含的数据库）</span><span class="sxs-lookup"><span data-stu-id="7054c-225">Modified Features &#40;Contained Database&#41;</span></span>](modified-features-contained-database.md)  
  
 [<span data-ttu-id="7054c-226">包含数据库的排序规则</span><span class="sxs-lookup"><span data-stu-id="7054c-226">Contained Database Collations</span></span>](contained-database-collations.md)  
  
 [<span data-ttu-id="7054c-227">针对包含的数据库的安全最佳做法</span><span class="sxs-lookup"><span data-stu-id="7054c-227">Security Best Practices with Contained Databases</span></span>](security-best-practices-with-contained-databases.md)  
  
 [<span data-ttu-id="7054c-228">迁移到部分包含的数据库</span><span class="sxs-lookup"><span data-stu-id="7054c-228">Migrate to a Partially Contained Database</span></span>](migrate-to-a-partially-contained-database.md)  
  
  
