---
title: 使数据库在其他服务器实例上可用时管理元数据 (SQL Server) |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- cross-database queries [SQL Server]
- logins [SQL Server], recreating on another server instance
- triggers [SQL Server], DLL
- user-defined error messages [SQL Server]
- permissions [SQL Server], metadata access
- Full-Text Engine [SQL Server]
- metadata [SQL Server], databases available to other instances
- jobs [SQL Server Agent], recreating on another server instance
- failover [SQL Server], managing metadata
- event notifications [SQL Server], metadata
- database mirroring [SQL Server], metadata
- startup options [SQL Server]
- restoring [SQL Server], onto another server instance
- linked servers [SQL Server], metadata
- WMI Provider for Server Events, metadata
- attaching databases [SQL Server]
- log shipping [SQL Server], metadata
- encryption [SQL Server], metadata
- server configuration [SQL Server]
- distributed queries [SQL Server], metadata
- extended stored procedures [SQL Server], metadata
- credentials [SQL Server], metadata
- copying databases
ms.assetid: 5d98cf2a-9fc2-4610-be72-b422b8682681
author: stevestein
ms.author: sstein
ms.openlocfilehash: 5087a925ac163281f4326a5f952c11ce2953c6dd
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87693923"
---
# <a name="manage-metadata-when-making-a-database-available-on-another-server-instance-sql-server"></a><span data-ttu-id="31b19-102">当数据库在其他服务器实例上可用时管理元数据 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="31b19-102">Manage Metadata When Making a Database Available on Another Server Instance (SQL Server)</span></span>
  <span data-ttu-id="31b19-103">本主题与下列情况有关：</span><span class="sxs-lookup"><span data-stu-id="31b19-103">This topic is relevant in the following situations:</span></span>  
  
-   <span data-ttu-id="31b19-104">配置 [!INCLUDE[ssHADR](../../includes/sshadr-md.md)] 可用性组的可用性副本。</span><span class="sxs-lookup"><span data-stu-id="31b19-104">Configuring the availability replicas of an [!INCLUDE[ssHADR](../../includes/sshadr-md.md)] availability group.</span></span>  
  
-   <span data-ttu-id="31b19-105">设置数据库镜像。</span><span class="sxs-lookup"><span data-stu-id="31b19-105">Setting up database mirroring for a database.</span></span>  
  
-   <span data-ttu-id="31b19-106">准备在日志传送配置中交换主服务器和辅助服务器的角色。</span><span class="sxs-lookup"><span data-stu-id="31b19-106">When preparing to change roles between primary and secondary servers in a log shipping configuration.</span></span>  
  
-   <span data-ttu-id="31b19-107">将数据库还原到其他服务器实例。</span><span class="sxs-lookup"><span data-stu-id="31b19-107">Restoring a database to another server instance.</span></span>  
  
-   <span data-ttu-id="31b19-108">在其他服务器实例上附加数据库副本。</span><span class="sxs-lookup"><span data-stu-id="31b19-108">Attaching a copy of a database on another server instance.</span></span>  
  
 <span data-ttu-id="31b19-109">某些应用程序依赖于单个用户数据库范围之外的信息、实体和/或对象。</span><span class="sxs-lookup"><span data-stu-id="31b19-109">Some applications depend on information, entities, and/or objects that are outside of the scope of a single user database.</span></span> <span data-ttu-id="31b19-110">通常，应用程序具有对 **master** 和 **msdb** 数据库的依赖关系，并且还具有对用户数据库的依赖关系。</span><span class="sxs-lookup"><span data-stu-id="31b19-110">Typically, an application has dependencies on the **master** and **msdb** databases, and also on the user database.</span></span> <span data-ttu-id="31b19-111">用户数据库正确运行所需的存储在该数据库外部的任何内容必须在目标服务器实例上可用。</span><span class="sxs-lookup"><span data-stu-id="31b19-111">Anything stored outside of a user database that is required for the correct functioning of that database must be made available on the destination server instance.</span></span> <span data-ttu-id="31b19-112">例如，应用程序的登录名作为元数据存储在 **master** 数据库中，必须在目标服务器上重新创建这些登录名。</span><span class="sxs-lookup"><span data-stu-id="31b19-112">For example, the logins for an application are stored as metadata in the **master** database, and they must be re-created on the destination server.</span></span> <span data-ttu-id="31b19-113">如果应用程序或数据库维护计划依赖于 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理作业（其元数据存储在 **msdb** 数据库中），则必须在目标服务器实例上重新创建这些作业。</span><span class="sxs-lookup"><span data-stu-id="31b19-113">If an application or database maintenance plan depends on [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent jobs, whose metadata is stored in the **msdb** database, you must re-create those jobs on the destination server instance.</span></span> <span data-ttu-id="31b19-114">同样，服务器级触发器的元数据存储在 **master**中。</span><span class="sxs-lookup"><span data-stu-id="31b19-114">Similarly, the metadata for a server-level trigger is stored in **master**.</span></span>  
  
 <span data-ttu-id="31b19-115">将应用程序的数据库移动到其他服务器实例时，必须在目标服务器实例的 master 和 msdb 中重新创建依赖实体和依赖对象的所有元数据   。</span><span class="sxs-lookup"><span data-stu-id="31b19-115">When you move the database for an application to another server instance, you must re-create all the metadata of the dependent entities and objects in **master** and **msdb** on the destination server instance.</span></span> <span data-ttu-id="31b19-116">例如，如果数据库应用程序使用服务器级触发器，则仅在新系统上附加或还原数据库是不够的。</span><span class="sxs-lookup"><span data-stu-id="31b19-116">For example, if a database application uses server-level triggers, just attaching or restoring the database on the new system is not enough.</span></span> <span data-ttu-id="31b19-117">如果不手动在 **master** 数据库中重新创建这些触发器的元数据，则数据库不能按预期方式工作。</span><span class="sxs-lookup"><span data-stu-id="31b19-117">The database will not work as expected unless you manually re-create the metadata for those triggers in the **master** database.</span></span>  
  
##  <a name="information-entities-and-objects-that-are-stored-outside-of-user-databases"></a><a name="information_entities_and_objects"></a> <span data-ttu-id="31b19-118">存储在用户数据库外部的信息、实体和对象</span><span class="sxs-lookup"><span data-stu-id="31b19-118">Information, Entities, and Objects That Are Stored Outside of User Databases</span></span>  
 <span data-ttu-id="31b19-119">此主题的其余部分概要说明了可能影响在其他服务器实例上可用的数据库的潜在问题。</span><span class="sxs-lookup"><span data-stu-id="31b19-119">The remainder of this topic summarizes the potential issues that might affect a database that is being made available on another server instance.</span></span> <span data-ttu-id="31b19-120">最好重新创建以下列表中列出的一种或多种信息、实体或对象。</span><span class="sxs-lookup"><span data-stu-id="31b19-120">You might have to re-create one or more of the types of information, entities, or objects listed in the following list.</span></span> <span data-ttu-id="31b19-121">若要查看概要内容，请单击该项的链接。</span><span class="sxs-lookup"><span data-stu-id="31b19-121">To see a summary, click the link for the item.</span></span>  
  
-   [<span data-ttu-id="31b19-122">服务器配置设置</span><span class="sxs-lookup"><span data-stu-id="31b19-122">Server configuration settings</span></span>](#server_configuration_settings)  
  
-   [<span data-ttu-id="31b19-123">凭据</span><span class="sxs-lookup"><span data-stu-id="31b19-123">Credentials</span></span>](#credentials)  
  
-   [<span data-ttu-id="31b19-124">跨数据库查询</span><span class="sxs-lookup"><span data-stu-id="31b19-124">Cross-database queries</span></span>](#cross_database_queries)  
  
-   [<span data-ttu-id="31b19-125">数据库所有权</span><span class="sxs-lookup"><span data-stu-id="31b19-125">Database ownership</span></span>](#database_ownership)  
  
-   [<span data-ttu-id="31b19-126">分布式查询/链接服务器</span><span class="sxs-lookup"><span data-stu-id="31b19-126">Distributed queries/linked servers</span></span>](#distributed_queries_and_linked_servers)  
  
-   [<span data-ttu-id="31b19-127">加密数据</span><span class="sxs-lookup"><span data-stu-id="31b19-127">Encrypted data</span></span>](#encrypted_data)  
  
-   [<span data-ttu-id="31b19-128">用户定义的错误消息</span><span class="sxs-lookup"><span data-stu-id="31b19-128">User-defined error messages</span></span>](#user_defined_error_messages)  
  
-   [<span data-ttu-id="31b19-129">事件通知和 Windows Management Instrumentation (WMI) 事件（服务器级）</span><span class="sxs-lookup"><span data-stu-id="31b19-129">Event notifications and Windows Management Instrumentation (WMI) events (at server level)</span></span>](#event_notif_and_wmi_events)  
  
-   [<span data-ttu-id="31b19-130">扩展的存储过程</span><span class="sxs-lookup"><span data-stu-id="31b19-130">Extended stored procedures</span></span>](#extended_stored_procedures)  
  
-   [<span data-ttu-id="31b19-131">SQL Server 属性的全文引擎</span><span class="sxs-lookup"><span data-stu-id="31b19-131">Full-text engine for SQL Server properties</span></span>](#ifts_service_properties)  
  
-   [<span data-ttu-id="31b19-132">作业</span><span class="sxs-lookup"><span data-stu-id="31b19-132">Jobs</span></span>](#jobs)  
  
-   [<span data-ttu-id="31b19-133">登录名</span><span class="sxs-lookup"><span data-stu-id="31b19-133">Logins</span></span>](#logins)  
  
-   [<span data-ttu-id="31b19-134">权限</span><span class="sxs-lookup"><span data-stu-id="31b19-134">Permissions</span></span>](#permissions)  
  
-   [<span data-ttu-id="31b19-135">复制设置</span><span class="sxs-lookup"><span data-stu-id="31b19-135">Replication settings</span></span>](#replication_settings)  
  
-   [<span data-ttu-id="31b19-136">Service Broker 应用程序</span><span class="sxs-lookup"><span data-stu-id="31b19-136">Service Broker applications</span></span>](#sb_applications)  
  
-   [<span data-ttu-id="31b19-137">启动过程</span><span class="sxs-lookup"><span data-stu-id="31b19-137">Startup procedures</span></span>](#startup_procedures)  
  
-   [<span data-ttu-id="31b19-138">触发器（服务器级）</span><span class="sxs-lookup"><span data-stu-id="31b19-138">Triggers (at server level)</span></span>](#triggers)  
  
##  <a name="server-configuration-settings"></a><a name="server_configuration_settings"></a> <span data-ttu-id="31b19-139">Server Configuration Settings</span><span class="sxs-lookup"><span data-stu-id="31b19-139">Server Configuration Settings</span></span>  
 [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] <span data-ttu-id="31b19-140">及更高版本会选择性地安装和启动密钥服务和功能。</span><span class="sxs-lookup"><span data-stu-id="31b19-140">and later versions selectively install and starts key services and features.</span></span> <span data-ttu-id="31b19-141">这有助于减少系统可遭受攻击的外围应用。</span><span class="sxs-lookup"><span data-stu-id="31b19-141">This helps reduce the attackable surface area of a system.</span></span> <span data-ttu-id="31b19-142">在新安装的默认配置中，许多功能并未启用。</span><span class="sxs-lookup"><span data-stu-id="31b19-142">In the default configuration of new installations, many features are not enabled.</span></span> <span data-ttu-id="31b19-143">如果数据库依赖于默认处于禁用状态的服务或功能，则必须在目标服务器实例上启用此服务或功能。</span><span class="sxs-lookup"><span data-stu-id="31b19-143">If the database relies on any service or feature that is off by default, this service or feature must be enabled on the destination server instance.</span></span>  
  
 <span data-ttu-id="31b19-144">有关这些设置以及启用或禁用它们的详细信息，请参阅[服务器配置选项 (SQL Server)](../../database-engine/configure-windows/server-configuration-options-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="31b19-144">For more information about these settings and enabling or disabling them, see [Server Configuration Options &#40;SQL Server&#41;](../../database-engine/configure-windows/server-configuration-options-sql-server.md).</span></span>  
  
 <span data-ttu-id="31b19-145">[[返回页首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="31b19-145">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="credentials"></a><a name="credentials"></a><span data-ttu-id="31b19-146">凭据</span><span class="sxs-lookup"><span data-stu-id="31b19-146">Credentials</span></span>  
 <span data-ttu-id="31b19-147">凭据是包含连接到 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]以外的资源时所需的身份验证信息的记录。</span><span class="sxs-lookup"><span data-stu-id="31b19-147">A credential is a record that contains the authentication information that is required to connect to a resource outside [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="31b19-148">大多数凭据包含一个 Windows 登录名和密码。</span><span class="sxs-lookup"><span data-stu-id="31b19-148">Most credentials consist of a Windows login and password.</span></span>  
  
 <span data-ttu-id="31b19-149">有关此功能的详细信息，请参阅 [凭据（数据库引擎）](../security/authentication-access/credentials-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="31b19-149">For more information about this feature, see [Credentials &#40;Database Engine&#41;](../security/authentication-access/credentials-database-engine.md).</span></span>  
  
> [!NOTE]  
>  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="31b19-150">代理的代理帐户使用凭据。</span><span class="sxs-lookup"><span data-stu-id="31b19-150">Agent Proxy accounts use credentials.</span></span> <span data-ttu-id="31b19-151">若要了解代理帐户的凭据 ID，请使用 [sysproxies](/sql/relational-databases/system-tables/dbo-sysproxies-transact-sql) 系统表。</span><span class="sxs-lookup"><span data-stu-id="31b19-151">To learn the credential ID of a proxy account, use the [sysproxies](/sql/relational-databases/system-tables/dbo-sysproxies-transact-sql) system table.</span></span>  
  
 <span data-ttu-id="31b19-152">[[返回页首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="31b19-152">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="cross-database-queries"></a><a name="cross_database_queries"></a><span data-ttu-id="31b19-153">跨数据库查询</span><span class="sxs-lookup"><span data-stu-id="31b19-153">Cross-Database Queries</span></span>  
 <span data-ttu-id="31b19-154">DB_CHAINING 和 TRUSTWORTHY 数据库选项默认设置为 OFF。</span><span class="sxs-lookup"><span data-stu-id="31b19-154">The DB_CHAINING and TRUSTWORTHY database options are OFF by default.</span></span> <span data-ttu-id="31b19-155">如果针对原始数据库将这两个选项之一设置为 ON，则可能必须对目标服务器实例上的数据库启用这两个选项。</span><span class="sxs-lookup"><span data-stu-id="31b19-155">If either of these is set to ON for the original database, you may have to enable them on the database on the destination server instance.</span></span> <span data-ttu-id="31b19-156">有关详细信息，请参阅 [ALTER DATABASE (Transact-SQL)](/sql/t-sql/statements/alter-database-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="31b19-156">For more information, see [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql).</span></span>  
  
 <span data-ttu-id="31b19-157">附加和分离操作都会禁用数据库的跨数据库所有权链接。</span><span class="sxs-lookup"><span data-stu-id="31b19-157">Attach-and-detach operations disable cross-database ownership chaining for the database.</span></span> <span data-ttu-id="31b19-158">有关如何启用链接的详细信息，请参阅 [cross db ownership chaining 服务器配置选项](../../database-engine/configure-windows/cross-db-ownership-chaining-server-configuration-option.md)。</span><span class="sxs-lookup"><span data-stu-id="31b19-158">For information about how to enable chaining, see [cross db ownership chaining Server Configuration Option](../../database-engine/configure-windows/cross-db-ownership-chaining-server-configuration-option.md).</span></span>  
  
 <span data-ttu-id="31b19-159">有关详细信息，另请参阅[设置镜像数据库以使用可信属性 (Transact-SQL)](../../database-engine/database-mirroring/set-up-a-mirror-database-to-use-the-trustworthy-property-transact-sql.md)</span><span class="sxs-lookup"><span data-stu-id="31b19-159">For more information, see also [Set Up a Mirror Database to Use the Trustworthy Property &#40;Transact-SQL&#41;](../../database-engine/database-mirroring/set-up-a-mirror-database-to-use-the-trustworthy-property-transact-sql.md)</span></span>  
  
 <span data-ttu-id="31b19-160">[[返回页首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="31b19-160">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="database-ownership"></a><a name="database_ownership"></a><span data-ttu-id="31b19-161">数据库所有权</span><span class="sxs-lookup"><span data-stu-id="31b19-161">Database Ownership</span></span>  
 <span data-ttu-id="31b19-162">在其他计算机上还原数据库时，启动还原操作的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 登录用户或 Windows 用户将自动成为新数据库的所有者。</span><span class="sxs-lookup"><span data-stu-id="31b19-162">When a database is restored on another computer, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login or Windows user who initiated the restore operation becomes the owner of the new database automatically.</span></span> <span data-ttu-id="31b19-163">还原数据库时，系统管理员或新数据库所有者可以更改数据库所有权。</span><span class="sxs-lookup"><span data-stu-id="31b19-163">When the database is restored, the system administrator or the new database owner can change database ownership.</span></span>  
  
##  <a name="distributed-queries-and-linked-servers"></a><a name="distributed_queries_and_linked_servers"></a> <span data-ttu-id="31b19-164">分布式查询和链接服务器</span><span class="sxs-lookup"><span data-stu-id="31b19-164">Distributed Queries and Linked Servers</span></span>  
 <span data-ttu-id="31b19-165">OLE DB 应用程序支持分布式查询和链接服务器。</span><span class="sxs-lookup"><span data-stu-id="31b19-165">Distributed queries and linked servers are supported for OLE DB applications.</span></span> <span data-ttu-id="31b19-166">分布式查询访问相同或不同计算机上多个异类数据源中的数据。</span><span class="sxs-lookup"><span data-stu-id="31b19-166">Distributed queries access data from multiple heterogeneous data sources on either the same or different computers.</span></span> <span data-ttu-id="31b19-167">链接服务器配置使 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 可以对远程服务器上的 OLE DB 数据源执行命令。</span><span class="sxs-lookup"><span data-stu-id="31b19-167">A linked server configuration enables [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to execute commands against OLE DB data sources on remote servers.</span></span> <span data-ttu-id="31b19-168">有关这些功能的详细信息，请参阅[链接服务器（数据库引擎）](../linked-servers/linked-servers-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="31b19-168">For more information about these features, see [Linked Servers &#40;Database Engine&#41;](../linked-servers/linked-servers-database-engine.md).</span></span>  
  
 <span data-ttu-id="31b19-169">[[返回页首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="31b19-169">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="encrypted-data"></a><a name="encrypted_data"></a><span data-ttu-id="31b19-170">加密数据</span><span class="sxs-lookup"><span data-stu-id="31b19-170">Encrypted Data</span></span>  
 <span data-ttu-id="31b19-171">如果在其他服务器实例上可用的数据库包含加密数据，并且数据库主密钥由原始服务器上的服务主密钥保护，则最好重新进行服务主密钥加密。</span><span class="sxs-lookup"><span data-stu-id="31b19-171">If the database you are making available on another server instance contains encrypted data and if the database master key is protected by the service master key on the original server, it might be necessary to re-create the service master key encryption.</span></span> <span data-ttu-id="31b19-172">“数据库主密钥 \*\* ”是一种对称密钥，用于在加密数据库中保护证书的私钥和非对称密钥的私钥。</span><span class="sxs-lookup"><span data-stu-id="31b19-172">The *database master key* is a symmetric key that is used to protect the private keys of certificates and asymmetric keys in an encrypted database.</span></span> <span data-ttu-id="31b19-173">当创建数据库主密钥时，会使用 Triple DES 算法以及用户提供的密码对其进行加密。</span><span class="sxs-lookup"><span data-stu-id="31b19-173">When created, the database master key is encrypted by using the Triple DES algorithm and a user-supplied password.</span></span>  
  
 <span data-ttu-id="31b19-174">若要对服务器实例上的数据库主密钥启用自动解密，请使用服务主密钥对此密钥的副本进行加密。</span><span class="sxs-lookup"><span data-stu-id="31b19-174">To enable the automatic decryption of the database master key on a server instance, a copy of this key is encrypted by using the service master key.</span></span> <span data-ttu-id="31b19-175">此加密副本存储在此数据库以及 **master**中。</span><span class="sxs-lookup"><span data-stu-id="31b19-175">This encrypted copy is stored in both the database and in **master**.</span></span> <span data-ttu-id="31b19-176">通常，每当主密钥更改时，存储在**master**中的副本都将自动更新。</span><span class="sxs-lookup"><span data-stu-id="31b19-176">Typically, the copy stored in **master** is silently updated whenever the master key is changed.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="31b19-177">最初尝试使用实例的服务主密钥解密数据库主密钥。</span><span class="sxs-lookup"><span data-stu-id="31b19-177">first tries to decrypt the database master key with the service master key of the instance.</span></span> <span data-ttu-id="31b19-178">如果解密失败，则 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 将在凭据存储区中搜索与需要其主密钥的数据库具有相同系列 GUID 的主密钥凭据。</span><span class="sxs-lookup"><span data-stu-id="31b19-178">If that decryption fails, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] searches the credential store for master key credentials that have the same family GUID as the database for which it requires the master key.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="31b19-179">尝试使用每个匹配的凭据对数据库主密钥进行解密，直到成功解密或者没有更多的凭据为止。</span><span class="sxs-lookup"><span data-stu-id="31b19-179">then tries to decrypt the database master key with each matching credential until the decryption succeeds or there are no more credentials.</span></span> <span data-ttu-id="31b19-180">必须使用 OPEN MASTER KEY 语句和密码打开未使用服务主密钥进行加密的主密钥。</span><span class="sxs-lookup"><span data-stu-id="31b19-180">A master key that is not encrypted by the service master key must be opened by using the OPEN MASTER KEY statement and a password.</span></span>  
  
 <span data-ttu-id="31b19-181">对加密数据库执行复制、还原或附加到新的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]实例等操作时，由服务主密钥加密的数据库主密钥的副本不存储在目标服务器实例上的 **master** 中。</span><span class="sxs-lookup"><span data-stu-id="31b19-181">When an encrypted database is copied, restored, or attached to a new instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], a copy of the database master key encrypted by the service master key is not stored in **master** on the destination server instance.</span></span> <span data-ttu-id="31b19-182">在目标服务器实例上，必须打开数据库的主密钥。</span><span class="sxs-lookup"><span data-stu-id="31b19-182">On the destination server instance, you must open the master key of the database.</span></span> <span data-ttu-id="31b19-183">若要打开主密钥，请执行以下语句：OPEN MASTER KEY DECRYPTION BY PASSWORD **='***password***'**。</span><span class="sxs-lookup"><span data-stu-id="31b19-183">To open the master key, execute the following statement: OPEN MASTER KEY DECRYPTION BY PASSWORD **='***password***'**.</span></span> <span data-ttu-id="31b19-184">建议您通过执行下面的语句对数据库主密钥启用自动解密：ALTER MASTER KEY ADD ENCRYPTION BY SERVICE MASTER KEY。</span><span class="sxs-lookup"><span data-stu-id="31b19-184">We recommend that you then enable automatic decryption of the database master key by executing the following statement: ALTER MASTER KEY ADD ENCRYPTION BY SERVICE MASTER KEY.</span></span> <span data-ttu-id="31b19-185">此 ALTER MASTER KEY 语句使用数据库主密钥（使用服务主密钥加密）的副本来设置服务器实例。</span><span class="sxs-lookup"><span data-stu-id="31b19-185">This ALTER MASTER KEY statement provisions the server instance with a copy of the database master key that is encrypted with the service master key.</span></span> <span data-ttu-id="31b19-186">有关详细信息，请参阅 [OPEN MASTER KEY (Transact-SQL)](/sql/t-sql/statements/open-master-key-transact-sql) 和 [ALTER MASTER KEY (Transact-SQL)](/sql/t-sql/statements/alter-master-key-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="31b19-186">For more information, see [OPEN MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/open-master-key-transact-sql) and [ALTER MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-master-key-transact-sql).</span></span>  
  
 <span data-ttu-id="31b19-187">有关如何启用镜像数据库主秘钥自动加密的详细信息，请参阅 [设置加密的镜像数据库](../../database-engine/database-mirroring/set-up-an-encrypted-mirror-database.md)。</span><span class="sxs-lookup"><span data-stu-id="31b19-187">For information about how to enable automatic decryption of the database master key of a mirror database, see [Set Up an Encrypted Mirror Database](../../database-engine/database-mirroring/set-up-an-encrypted-mirror-database.md).</span></span>  
  
 <span data-ttu-id="31b19-188">有关详细信息，请参阅：</span><span class="sxs-lookup"><span data-stu-id="31b19-188">For more information, see also:</span></span>  
  
-   [<span data-ttu-id="31b19-189">加密层次结构</span><span class="sxs-lookup"><span data-stu-id="31b19-189">Encryption Hierarchy</span></span>](../security/encryption/encryption-hierarchy.md)  
  
-   [<span data-ttu-id="31b19-190">设置加密的镜像数据库</span><span class="sxs-lookup"><span data-stu-id="31b19-190">Set Up an Encrypted Mirror Database</span></span>](../../database-engine/database-mirroring/set-up-an-encrypted-mirror-database.md)  
  
-   [<span data-ttu-id="31b19-191">在两个服务器上创建相同的对称密钥</span><span class="sxs-lookup"><span data-stu-id="31b19-191">Create Identical Symmetric Keys on Two Servers</span></span>](../security/encryption/create-identical-symmetric-keys-on-two-servers.md)  
  
 <span data-ttu-id="31b19-192">[[返回页首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="31b19-192">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="user-defined-error-messages"></a><a name="user_defined_error_messages"></a><span data-ttu-id="31b19-193">用户定义的错误消息</span><span class="sxs-lookup"><span data-stu-id="31b19-193">User-defined Error Messages</span></span>  
 <span data-ttu-id="31b19-194">用户定义的错误消息位于 [sys.messages](/sql/relational-databases/system-catalog-views/messages-for-errors-catalog-views-sys-messages) 目录视图中。</span><span class="sxs-lookup"><span data-stu-id="31b19-194">User-defined error messages reside in the [sys.messages](/sql/relational-databases/system-catalog-views/messages-for-errors-catalog-views-sys-messages) catalog view.</span></span> <span data-ttu-id="31b19-195">此目录视图存储在 **master**中。</span><span class="sxs-lookup"><span data-stu-id="31b19-195">This catalog view is stored in **master**.</span></span> <span data-ttu-id="31b19-196">如果数据库应用程序依赖于用户定义的错误消息并且此数据库在其他服务器实例上可用，则请使用 [sp_addmessage](/sql/relational-databases/system-stored-procedures/sp-addmessage-transact-sql) 在目标服务器实例上添加这些用户定义的消息。</span><span class="sxs-lookup"><span data-stu-id="31b19-196">If a database application depends on user-defined error messages and the database is made available on another server instance, use [sp_addmessage](/sql/relational-databases/system-stored-procedures/sp-addmessage-transact-sql) to add those user-defined messages on the destination server instance.</span></span>  
  
 <span data-ttu-id="31b19-197">[[返回页首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="31b19-197">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="event-notifications-and-windows-management-instrumentation-wmi-events-at-server-level"></a><a name="event_notif_and_wmi_events"></a> <span data-ttu-id="31b19-198">事件通知和 Windows Management Instrumentation (WMI) 事件 （在服务器级别）</span><span class="sxs-lookup"><span data-stu-id="31b19-198">Event Notifications and Windows Management Instrumentation (WMI) Events (at Server Level)</span></span>  
  
### <a name="server-level-event-notifications"></a><span data-ttu-id="31b19-199">服务器级事件通知</span><span class="sxs-lookup"><span data-stu-id="31b19-199">Server-Level Event Notifications</span></span>  
 <span data-ttu-id="31b19-200">服务器级事件通知存储在 **msdb**中。</span><span class="sxs-lookup"><span data-stu-id="31b19-200">Server-level event notifications are stored in **msdb**.</span></span> <span data-ttu-id="31b19-201">因此，如果数据库应用程序依赖于服务器级事件通知，则必须在目标服务器实例上重新创建该事件通知。</span><span class="sxs-lookup"><span data-stu-id="31b19-201">Therefore, if a database application relies on a server-level event notifications, that event notification must be re-created on the destination server instance.</span></span> <span data-ttu-id="31b19-202">若要查看服务器实例上的事件通知，请使用 [sys.server_event_notifications](/sql/relational-databases/system-catalog-views/sys-server-event-notifications-transact-sql) 目录视图。</span><span class="sxs-lookup"><span data-stu-id="31b19-202">To view the event notifications on a server instance, use the [sys.server_event_notifications](/sql/relational-databases/system-catalog-views/sys-server-event-notifications-transact-sql) catalog view.</span></span> <span data-ttu-id="31b19-203">有关详细信息，请参阅 [Event Notifications](../service-broker/event-notifications.md)。</span><span class="sxs-lookup"><span data-stu-id="31b19-203">For more information, see [Event Notifications](../service-broker/event-notifications.md).</span></span>  
  
 <span data-ttu-id="31b19-204">此外，使用 [!INCLUDE[ssSB](../../includes/sssb-md.md)]传递事件通知。</span><span class="sxs-lookup"><span data-stu-id="31b19-204">Additionally, event notifications are delivered by using [!INCLUDE[ssSB](../../includes/sssb-md.md)].</span></span> <span data-ttu-id="31b19-205">传入消息的路由不包括在包含服务的数据库中。</span><span class="sxs-lookup"><span data-stu-id="31b19-205">Routes for incoming messages are not included in the database that contains a service.</span></span> <span data-ttu-id="31b19-206">相反，显式路由存储在 **msdb**中。</span><span class="sxs-lookup"><span data-stu-id="31b19-206">Instead, explicit routes are stored in **msdb**.</span></span> <span data-ttu-id="31b19-207">如果服务使用 **msdb** 数据库中的显式路由将传入的消息路由到该服务，则在将数据库附加到其他实例时，必须重新创建此路由。</span><span class="sxs-lookup"><span data-stu-id="31b19-207">If your service uses an explicit route in the **msdb** database to route incoming messages to the service, when you attach a database in a different instance, you must re-create this route.</span></span>  
  
### <a name="windows-management-instrumentation-wmi-events"></a><span data-ttu-id="31b19-208">Windows Management Instrumentation (WMI) 事件</span><span class="sxs-lookup"><span data-stu-id="31b19-208">Windows Management Instrumentation (WMI) Events</span></span>  
 <span data-ttu-id="31b19-209">使用服务器事件的 WMI 提供程序，可以使用 Windows Management Instrumentation (WMI) 监视 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]中的事件。</span><span class="sxs-lookup"><span data-stu-id="31b19-209">The WMI Provider for Server Events lets you use the Windows Management Instrumentation (WMI) to monitor events in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="31b19-210">必须在目标服务器实例所在的计算机上定义任何依赖于服务器级事件（此事件通过数据库所依赖的 WMI 提供程序显示）的应用程序。</span><span class="sxs-lookup"><span data-stu-id="31b19-210">Any application that relies on server-level events exposed through the WMI provider on which a database relies must be defined the computer of the destination server instance.</span></span> <span data-ttu-id="31b19-211">WMI 事件提供程序使用在 **msdb**中定义的目标服务创建事件通知。</span><span class="sxs-lookup"><span data-stu-id="31b19-211">WMI Event provider creates event notifications with a target service that is defined in **msdb**.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="31b19-212">有关详细信息，请参阅 [WMI Provider for Server Events 的概念](../wmi-provider-server-events/wmi-provider-for-server-events-concepts.md)。</span><span class="sxs-lookup"><span data-stu-id="31b19-212">For more information, see [WMI Provider for Server Events Concepts](../wmi-provider-server-events/wmi-provider-for-server-events-concepts.md).</span></span>  
  
 <span data-ttu-id="31b19-213">**使用 SQL Server Management Studio 创建 WMI 警报**</span><span class="sxs-lookup"><span data-stu-id="31b19-213">**To create a WMI alert using SQL Server Management Studio**</span></span>  
  
-   [<span data-ttu-id="31b19-214">创建 WMI 事件警报</span><span class="sxs-lookup"><span data-stu-id="31b19-214">Create a WMI Event Alert</span></span>](../../ssms/agent/create-a-wmi-event-alert.md)  
  
### <a name="how-event-notifications-work-for-a-mirrored-database"></a><span data-ttu-id="31b19-215">镜像数据库事件通知工作原理</span><span class="sxs-lookup"><span data-stu-id="31b19-215">How Event Notifications Work for a Mirrored Database</span></span>  
 <span data-ttu-id="31b19-216">因为镜像数据库可以进行故障转移，所以涉及镜像数据库的事件通知的跨数据库传递是按照定义以远程方式进行的。</span><span class="sxs-lookup"><span data-stu-id="31b19-216">Cross-database delivery of event notifications that involves a mirrored database is remote, by definition, because the mirrored database can fail over.</span></span> [!INCLUDE[ssSB](../../includes/sssb-md.md)]<span data-ttu-id="31b19-217">以*镜像路由*的形式为镜像数据库提供特殊支持。</span><span class="sxs-lookup"><span data-stu-id="31b19-217">provides special support for mirrored databases, in the form of *mirrored routes*.</span></span> <span data-ttu-id="31b19-218">镜像路由有两个地址：一个针对主体服务器实例，另一个针对镜像服务器实例。</span><span class="sxs-lookup"><span data-stu-id="31b19-218">A mirrored route has two addresses: one for the principal server instance and one for the mirror server instance.</span></span>  
  
 <span data-ttu-id="31b19-219">通过设置镜像路由，您可以使 [!INCLUDE[ssSB](../../includes/sssb-md.md)] 路由支持数据库镜像。</span><span class="sxs-lookup"><span data-stu-id="31b19-219">By setting up mirrored routes, you make [!INCLUDE[ssSB](../../includes/sssb-md.md)] routing aware of database mirroring.</span></span> <span data-ttu-id="31b19-220">使用镜像路由， [!INCLUDE[ssSB](../../includes/sssb-md.md)] 能够透明地将会话重定向到当前的主体服务器实例。</span><span class="sxs-lookup"><span data-stu-id="31b19-220">The mirrored routes enable [!INCLUDE[ssSB](../../includes/sssb-md.md)] to transparently redirect conversations to the current principal server instance.</span></span> <span data-ttu-id="31b19-221">例如，有一项由镜像数据库 Database_A 承载的服务 Service_A。</span><span class="sxs-lookup"><span data-stu-id="31b19-221">For example, consider a service, Service_A, which is hosted by a mirrored database, Database_A.</span></span> <span data-ttu-id="31b19-222">假定您需要由 Database_B 承载的另一项服务 Service_B 与 Service_A 进行对话。</span><span class="sxs-lookup"><span data-stu-id="31b19-222">Assume that you need another service, Service_B, which is hosted by Database_B, to have a dialog with Service_A.</span></span> <span data-ttu-id="31b19-223">为了实现此对话，Database_B 必须包含 Service_A 的镜像路由。</span><span class="sxs-lookup"><span data-stu-id="31b19-223">For this dialog to be possible, Database_B must contain a mirrored route for Service_A.</span></span> <span data-ttu-id="31b19-224">此外，Database_A 必须包含 Service_B 的非镜像 TCP 传输路由，与本地路由不同的是，该路由在故障转移后保持有效。</span><span class="sxs-lookup"><span data-stu-id="31b19-224">In addition, Database_A must contain a nonmirrored TCP transport route to Service_B, which, unlike a local route, remains valid after failover.</span></span> <span data-ttu-id="31b19-225">这些路由使 ACK 能够在故障转移后恢复。</span><span class="sxs-lookup"><span data-stu-id="31b19-225">These routes enable ACKs to come back after a failover.</span></span> <span data-ttu-id="31b19-226">由于发送方的服务始终以相同方式命名，因此路由必须指定 Broker 实例。</span><span class="sxs-lookup"><span data-stu-id="31b19-226">Because the service of the sender is always named in the same manner, the route must specify the broker instance.</span></span>  
  
 <span data-ttu-id="31b19-227">不管镜像数据库中的服务是发起方服务还是目标服务，下列情况均要求使用镜像路由：</span><span class="sxs-lookup"><span data-stu-id="31b19-227">The requirement for mirrored routes applies for regardless of whether the service in the mirrored database is the initiator service or the target service:</span></span>  
  
-   <span data-ttu-id="31b19-228">如果目标服务位于镜像数据库中，则发起方服务必须具有返回目标的镜像路由。</span><span class="sxs-lookup"><span data-stu-id="31b19-228">If target service is in the mirrored database, the initiator service must have a mirrored route back to the target.</span></span> <span data-ttu-id="31b19-229">但是，目标可以具有返回发起方的常规路由。</span><span class="sxs-lookup"><span data-stu-id="31b19-229">However, the target can have a regular route back to initiator.</span></span>  
  
-   <span data-ttu-id="31b19-230">如果发起方服务位于镜像数据库中，则目标服务必须具有返回发起方的镜像路由，以传递确认和应答。</span><span class="sxs-lookup"><span data-stu-id="31b19-230">If initiator service is in the mirrored database, the target service must have a mirrored route back to initiator to deliver acknowledgements and replies.</span></span> <span data-ttu-id="31b19-231">但是，发起方可能拥有指向目标的常规路由。</span><span class="sxs-lookup"><span data-stu-id="31b19-231">However, the initiator can have a regular route to the target.</span></span>  
  
 <span data-ttu-id="31b19-232">[[返回页首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="31b19-232">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="extended-stored-procedures"></a><a name="extended_stored_procedures"></a><span data-ttu-id="31b19-233">扩展存储过程</span><span class="sxs-lookup"><span data-stu-id="31b19-233">Extended Stored Procedures</span></span>  
  
> [!IMPORTANT]  
>  [!INCLUDE[ssNoteDepFutureAvoid](../../includes/ssnotedepfutureavoid-md.md)]<span data-ttu-id="31b19-234">请改用[CLR 集成](../clr-integration/common-language-runtime-integration-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="31b19-234">Use [CLR Integration](../clr-integration/common-language-runtime-integration-overview.md) instead.</span></span>  
  
 <span data-ttu-id="31b19-235">扩展存储过程使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 扩展存储过程 API 进行编程。</span><span class="sxs-lookup"><span data-stu-id="31b19-235">Extended stored procedures are programmed by using the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Extended Stored Procedure API.</span></span> <span data-ttu-id="31b19-236">**sysadmin** 固定服务器角色的成员可以使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例注册扩展存储过程，并授予用户执行此过程的权限。</span><span class="sxs-lookup"><span data-stu-id="31b19-236">A member of the **sysadmin** fixed server role can register an extended stored procedure with an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] and grant permission to users to execute the procedure.</span></span> <span data-ttu-id="31b19-237">扩展存储过程只能添加到 **master** 数据库。</span><span class="sxs-lookup"><span data-stu-id="31b19-237">Extended stored procedures can be added only to the **master** database.</span></span>  
  
 <span data-ttu-id="31b19-238">扩展存储过程直接在 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]实例的地址空间中运行，它们可能会引起内存泄漏或其他问题，从而降低服务器的性能和可靠性。</span><span class="sxs-lookup"><span data-stu-id="31b19-238">Extended stored procedures run directly in the address space of an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], and they may produce memory leaks or other problems that reduce the performance and reliability of the server.</span></span> <span data-ttu-id="31b19-239">您应考虑将扩展存储过程存储在独立于包含被引用数据的实例的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例中。</span><span class="sxs-lookup"><span data-stu-id="31b19-239">You should consider storing extended stored procedures in an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that is separate from the instance that contains the referenced data.</span></span> <span data-ttu-id="31b19-240">还应考虑使用分布式查询访问数据库。</span><span class="sxs-lookup"><span data-stu-id="31b19-240">You should also consider using distributed queries to access the database.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="31b19-241">将扩展存储过程添加到服务器并向其他用户授予 EXECUTE 权限之前，系统管理员应全面查看每个扩展存储过程，以确保它不包含有害代码或恶意代码。</span><span class="sxs-lookup"><span data-stu-id="31b19-241">Before adding extended stored procedures to the server and granting EXECUTE permissions to other users, the system administrator should thoroughly review each extended stored procedure to make sure that it does not contain harmful or malicious code.</span></span>  
  
 <span data-ttu-id="31b19-242">有关更多详细信息，请参阅 [GRANT 对象权限 (Transact-SQL)](/sql/t-sql/statements/grant-object-permissions-transact-sql)、[DENY 对象权限 (Transact-SQL)](/sql/t-sql/statements/deny-object-permissions-transact-sql) 和 [REVOKE 对象权限 (Transact-SQL)](/sql/t-sql/statements/revoke-object-permissions-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="31b19-242">For more information, see [GRANT Object Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/grant-object-permissions-transact-sql), [DENY Object Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/deny-object-permissions-transact-sql), and [REVOKE Object Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/revoke-object-permissions-transact-sql).</span></span>  
  
 <span data-ttu-id="31b19-243">[[返回页首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="31b19-243">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="full-text-engine-for-sql-server-properties"></a><a name="ifts_service_properties"></a><span data-ttu-id="31b19-244">SQL Server 属性的全文引擎</span><span class="sxs-lookup"><span data-stu-id="31b19-244">Full-Text Engine for SQL Server Properties</span></span>  
 <span data-ttu-id="31b19-245">全文引擎的属性是通过 [sp_fulltext_service](/sql/relational-databases/system-stored-procedures/sp-fulltext-service-transact-sql)设置的。</span><span class="sxs-lookup"><span data-stu-id="31b19-245">Properties are set on the Full-Text Engine by [sp_fulltext_service](/sql/relational-databases/system-stored-procedures/sp-fulltext-service-transact-sql).</span></span> <span data-ttu-id="31b19-246">请确保目标服务器实例具有这些属性的必需设置。</span><span class="sxs-lookup"><span data-stu-id="31b19-246">Make sure that the destination server instance has the required settings for these properties.</span></span> <span data-ttu-id="31b19-247">有关这些属性的详细信息，请参阅 [FULLTEXTSERVICEPROPERTY (Transact SQL)](/sql/t-sql/functions/fulltextserviceproperty-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="31b19-247">For more information about these properties, see [FULLTEXTSERVICEPROPERTY &#40;Transact-SQL&#41;](/sql/t-sql/functions/fulltextserviceproperty-transact-sql).</span></span>  
  
 <span data-ttu-id="31b19-248">此外，如果原始服务器实例和目标服务器示例具有不同版本的 [断字符和词干分析器](../search/configure-and-manage-word-breakers-and-stemmers-for-search.md) 组件或 [全文搜索筛选器](../search/configure-and-manage-filters-for-search.md) 组件，则全文索引和查询的行为可能有所不同。</span><span class="sxs-lookup"><span data-stu-id="31b19-248">Additionally, if the [word breakers and stemmers](../search/configure-and-manage-word-breakers-and-stemmers-for-search.md) component or [full-text search filters](../search/configure-and-manage-filters-for-search.md) component have different versions on the original and destination server instances, full-text index and queries may behave differently.</span></span> <span data-ttu-id="31b19-249">此外， [同义词库](../search/full-text-search.md) 存储在特定于实例的文件中。</span><span class="sxs-lookup"><span data-stu-id="31b19-249">Also, the [thesaurus](../search/full-text-search.md) is stored in instance-specific files.</span></span> <span data-ttu-id="31b19-250">您必须将这些文件的副本传输到目标服务器实例上的相同位置，或者在新的实例上重新创建这些文件。</span><span class="sxs-lookup"><span data-stu-id="31b19-250">You must either transfer a copy of those files to an equivalent location on the destination server instance or re-create them on new instance.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="31b19-251">当将包含全文目录文件的 [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] 数据库附加到 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 服务器实例上时，会将目录文件从其以前的位置与其他数据库文件一起附加，这与 [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)]中的情况相同。</span><span class="sxs-lookup"><span data-stu-id="31b19-251">When you attach a [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] database that contains full-text catalog files onto a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] server instance, the catalog files are attached from their previous location along with the other database files, the same as in [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)].</span></span> <span data-ttu-id="31b19-252">有关详细信息，请参阅 [全文搜索升级](../search/upgrade-full-text-search.md)。</span><span class="sxs-lookup"><span data-stu-id="31b19-252">For more information, see [Upgrade Full-Text Search](../search/upgrade-full-text-search.md).</span></span>  
  
 <span data-ttu-id="31b19-253">有关详细信息，请参阅：</span><span class="sxs-lookup"><span data-stu-id="31b19-253">For more information, see also:</span></span>  
  
-   [<span data-ttu-id="31b19-254">备份和还原全文目录和索引</span><span class="sxs-lookup"><span data-stu-id="31b19-254">Back Up and Restore Full-Text Catalogs and Indexes</span></span>](../search/back-up-and-restore-full-text-catalogs-and-indexes.md)  
  
-   [<span data-ttu-id="31b19-255">数据库镜像和全文目录 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="31b19-255">Database Mirroring and Full-Text Catalogs &#40;SQL Server&#41;</span></span>](../../database-engine/database-mirroring/database-mirroring-and-full-text-catalogs-sql-server.md)  
  
 <span data-ttu-id="31b19-256">[[返回页首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="31b19-256">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="jobs"></a><a name="jobs"></a><span data-ttu-id="31b19-257">作业</span><span class="sxs-lookup"><span data-stu-id="31b19-257">Jobs</span></span>  
 <span data-ttu-id="31b19-258">如果数据库依赖于 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理作业，则必须在目标服务器实例上重新创建这些作业。</span><span class="sxs-lookup"><span data-stu-id="31b19-258">If the database relies on [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent jobs, you will have to re-create them on the destination server instance.</span></span> <span data-ttu-id="31b19-259">作业取决于其环境。</span><span class="sxs-lookup"><span data-stu-id="31b19-259">Jobs depend on their environments.</span></span> <span data-ttu-id="31b19-260">如果计划在目标服务器实例上重新创建现有作业，则可能必须修改目标服务器实例，以便与原始服务器实例上此作业的环境相匹配。</span><span class="sxs-lookup"><span data-stu-id="31b19-260">If you plan to re-create an existing job on the destination server instance, the destination server instance might have to be modified to match the environment of that job on the original server instance.</span></span> <span data-ttu-id="31b19-261">下面是重要的环境因素：</span><span class="sxs-lookup"><span data-stu-id="31b19-261">The following environmental factors are significant:</span></span>  
  
-   <span data-ttu-id="31b19-262">作业使用的登录名</span><span class="sxs-lookup"><span data-stu-id="31b19-262">The login used by the job</span></span>  
  
     <span data-ttu-id="31b19-263">若要创建或执行 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理作业，首先必须将作业所需的所有 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 登录名添加到目标服务器实例。</span><span class="sxs-lookup"><span data-stu-id="31b19-263">To create or execute [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent jobs, you must first add any [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] logins required by the job to the destination server instance.</span></span> <span data-ttu-id="31b19-264">有关详细信息，请参阅 [配置帐户以创建和管理 SQL Server 代理作业](../../ssms/agent/configure-a-user-to-create-and-manage-sql-server-agent-jobs.md)。</span><span class="sxs-lookup"><span data-stu-id="31b19-264">For more information, see [Configure a User to Create and Manage SQL Server Agent Jobs](../../ssms/agent/configure-a-user-to-create-and-manage-sql-server-agent-jobs.md).</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="31b19-265">代理服务启动帐户</span><span class="sxs-lookup"><span data-stu-id="31b19-265">Agent service startup account</span></span>  
  
     <span data-ttu-id="31b19-266">服务启动帐户可以定义运行 [!INCLUDE[msCoName](../../includes/msconame-md.md)] 代理的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Windows 帐户及其网络权限。</span><span class="sxs-lookup"><span data-stu-id="31b19-266">The service startup account defines the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account in which [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent runs and its network permissions.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="31b19-267">代理在指定的用户帐户下运行。</span><span class="sxs-lookup"><span data-stu-id="31b19-267">Agent runs as a specified user account.</span></span> <span data-ttu-id="31b19-268">代理服务的上下文会影响作业及其运行环境的设置。</span><span class="sxs-lookup"><span data-stu-id="31b19-268">The context of the Agent service affects the settings for the job and its run environment.</span></span> <span data-ttu-id="31b19-269">帐户必须有权访问作业所需的资源（如网络共享）。</span><span class="sxs-lookup"><span data-stu-id="31b19-269">The account must have access to the resources, such as network shares, required by the job.</span></span> <span data-ttu-id="31b19-270">有关如何选择和修改服务启动帐户的信息，请参阅 [选择 SQL Server 代理服务帐户](../../ssms/agent/select-an-account-for-the-sql-server-agent-service.md)。</span><span class="sxs-lookup"><span data-stu-id="31b19-270">For information about how to select and modify the service startup account, see [Select an Account for the SQL Server Agent Service](../../ssms/agent/select-an-account-for-the-sql-server-agent-service.md).</span></span>  
  
     <span data-ttu-id="31b19-271">为了正常操作，必须对服务启动帐户进行配置，使其具有正确的域、文件系统和注册表权限。</span><span class="sxs-lookup"><span data-stu-id="31b19-271">To operate correctly, the service startup account must be configured to have the correct domain, file system, and registry permissions.</span></span> <span data-ttu-id="31b19-272">此外，作业可能还需要必须针对服务帐户配置的共享网络资源。</span><span class="sxs-lookup"><span data-stu-id="31b19-272">Also, a job might require a shared network resource that must be configured for the service account.</span></span> <span data-ttu-id="31b19-273">有关详细信息，请参阅 [配置 Windows 服务帐户和权限](../../database-engine/configure-windows/configure-windows-service-accounts-and-permissions.md)。</span><span class="sxs-lookup"><span data-stu-id="31b19-273">For information, see [Configure Windows Service Accounts and Permissions](../../database-engine/configure-windows/configure-windows-service-accounts-and-permissions.md).</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="31b19-274">代理服务与特定的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]实例关联，具有自己的注册表配置单元，并且其作业通常与此注册表配置单元中的一个或多个设置具有依赖关系。</span><span class="sxs-lookup"><span data-stu-id="31b19-274">Agent service, which is associated with a specific instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], has its own registry hive, and its jobs typically have dependencies on one or more of the settings in this registry hive.</span></span> <span data-ttu-id="31b19-275">若要按预期方式运行，作业需要这些注册表设置。</span><span class="sxs-lookup"><span data-stu-id="31b19-275">To behave as intended, a job requires those registry settings.</span></span> <span data-ttu-id="31b19-276">如果使用脚本在其他 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理服务中重新创建一个作业，则此服务的注册表中可能没有用于该作业的正确设置。</span><span class="sxs-lookup"><span data-stu-id="31b19-276">If you use a script to re-create a job in another [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent service, its registry might not have the correct settings for that job.</span></span> <span data-ttu-id="31b19-277">为使重新创建的作业在目标服务器实例上正常运行，原始和目标 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理服务应具有相同的注册表设置。</span><span class="sxs-lookup"><span data-stu-id="31b19-277">For re-created jobs to behave correctly on a destination server instance, the original and destination [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent services should have the same registry settings.</span></span>  
  
    > [!CAUTION]  
    >  <span data-ttu-id="31b19-278">如果其他作业需要当前设置，则通过更改目标 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理服务上的注册表设置来处理重新创建的作业可能会出现问题。</span><span class="sxs-lookup"><span data-stu-id="31b19-278">Changing registry settings on the destination [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent service to handle a re-created job could be problematic if the current settings are required by other jobs.</span></span> <span data-ttu-id="31b19-279">此外，错误编辑注册表可能会严重损坏您的系统。</span><span class="sxs-lookup"><span data-stu-id="31b19-279">Furthermore, incorrectly editing the registry can severely damage your system.</span></span> <span data-ttu-id="31b19-280">更改注册表项之前，建议您备份计算机中的所有重要数据。</span><span class="sxs-lookup"><span data-stu-id="31b19-280">Before you make changes to the registry, we recommend that you back up any valued data on the computer.</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="31b19-281">代理的代理帐户</span><span class="sxs-lookup"><span data-stu-id="31b19-281">Agent Proxies</span></span>  
  
     <span data-ttu-id="31b19-282">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理的代理帐户定义指定作业步骤的安全上下文。</span><span class="sxs-lookup"><span data-stu-id="31b19-282">A [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent proxy defines the security context for a specified job step.</span></span> <span data-ttu-id="31b19-283">对于要在目标服务器实例上运行的作业，必须在此实例上手动重新创建此作业所需的所有代理。</span><span class="sxs-lookup"><span data-stu-id="31b19-283">For a job to run on the destination server instance, all the proxies it requires must be manually re-created on that instance.</span></span> <span data-ttu-id="31b19-284">有关详细信息，请参阅 [创建 SQL Server 代理程序代理](../../ssms/agent/create-a-sql-server-agent-proxy.md) 和 [对使用代理的多服务器作业进行故障排除](../../ssms/agent/troubleshoot-multiserver-jobs-that-use-proxies.md)。</span><span class="sxs-lookup"><span data-stu-id="31b19-284">For more information, see [Create a SQL Server Agent Proxy](../../ssms/agent/create-a-sql-server-agent-proxy.md) and [Troubleshoot Multiserver Jobs That Use Proxies](../../ssms/agent/troubleshoot-multiserver-jobs-that-use-proxies.md).</span></span>  
  
 <span data-ttu-id="31b19-285">有关详细信息，请参阅：</span><span class="sxs-lookup"><span data-stu-id="31b19-285">For more information, see also:</span></span>  
  
-   [<span data-ttu-id="31b19-286">执行作业</span><span class="sxs-lookup"><span data-stu-id="31b19-286">Implement Jobs</span></span>](../../ssms/agent/implement-jobs.md)  
  
-   <span data-ttu-id="31b19-287">[角色切换后登录名和作业的管理 (SQL Server)](../../sql-server/failover-clusters/management-of-logins-and-jobs-after-role-switching-sql-server.md)（为镜像数据库）</span><span class="sxs-lookup"><span data-stu-id="31b19-287">[Management of Logins and Jobs After Role Switching &#40;SQL Server&#41;](../../sql-server/failover-clusters/management-of-logins-and-jobs-after-role-switching-sql-server.md) (for database mirroring)</span></span>  
  
-   <span data-ttu-id="31b19-288">[配置 Windows 服务帐户和权限](../../database-engine/configure-windows/configure-windows-service-accounts-and-permissions.md) （安装 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]实例时）</span><span class="sxs-lookup"><span data-stu-id="31b19-288">[Configure Windows Service Accounts and Permissions](../../database-engine/configure-windows/configure-windows-service-accounts-and-permissions.md) (when you install an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)])</span></span>  
  
-   <span data-ttu-id="31b19-289">[配置 SQL Server 代理](../../ssms/agent/sql-server-agent.md) （安装 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]实例时）</span><span class="sxs-lookup"><span data-stu-id="31b19-289">[Configure SQL Server Agent](../../ssms/agent/sql-server-agent.md) (when you install an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)])</span></span>  
  
-   [<span data-ttu-id="31b19-290">实现 SQL Server 代理安全性</span><span class="sxs-lookup"><span data-stu-id="31b19-290">Implement SQL Server Agent Security</span></span>](../../ssms/agent/implement-sql-server-agent-security.md)  
  
 <span data-ttu-id="31b19-291">**查看现有作业及其属性**</span><span class="sxs-lookup"><span data-stu-id="31b19-291">**To view existing jobs and their properties**</span></span>  
  
-   [<span data-ttu-id="31b19-292">监视作业活动</span><span class="sxs-lookup"><span data-stu-id="31b19-292">Monitor Job Activity</span></span>](../../ssms/agent/monitor-job-activity.md)  
  
-   [<span data-ttu-id="31b19-293">sp_help_job (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="31b19-293">sp_help_job &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-job-transact-sql)  
  
-   [<span data-ttu-id="31b19-294">View Job Step Information</span><span class="sxs-lookup"><span data-stu-id="31b19-294">View Job Step Information</span></span>](../../ssms/agent/view-job-step-information.md)  
  
-   [<span data-ttu-id="31b19-295">dbo.sysjobs (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="31b19-295">dbo.sysjobs &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-tables/dbo-sysjobs-transact-sql)  
  
 <span data-ttu-id="31b19-296">**创建作业**</span><span class="sxs-lookup"><span data-stu-id="31b19-296">**To create a job**</span></span>  
  
-   [<span data-ttu-id="31b19-297">创建作业</span><span class="sxs-lookup"><span data-stu-id="31b19-297">Create a Job</span></span>](../../ssms/agent/create-a-job.md)  
  
-   [<span data-ttu-id="31b19-298">创建作业</span><span class="sxs-lookup"><span data-stu-id="31b19-298">Create a Job</span></span>](../../ssms/agent/create-a-job.md)  
  
#### <a name="best-practices-for-using-a-script-to-re-create-a-job"></a><span data-ttu-id="31b19-299">使用脚本重新创建作业的最佳实践</span><span class="sxs-lookup"><span data-stu-id="31b19-299">Best Practices for Using a Script to Re-create a Job</span></span>  
 <span data-ttu-id="31b19-300">建议您首先编写简单作业的脚本，接下来在其他 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理服务上重新创建此作业，然后运行此作业以查看它是否按预期方式工作。</span><span class="sxs-lookup"><span data-stu-id="31b19-300">We recommend that you start by scripting a simple job, re-creating the job on the other [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent service, and running the job to see whether it works as intended.</span></span> <span data-ttu-id="31b19-301">这样便可确定不兼容性并尝试进行解决。</span><span class="sxs-lookup"><span data-stu-id="31b19-301">This will let you to identify incompatibilities and try to resolve them.</span></span> <span data-ttu-id="31b19-302">如果已编写脚本的作业在新环境中未按预期方式工作，则建议您创建可在此环境中正常工作的等价作业。</span><span class="sxs-lookup"><span data-stu-id="31b19-302">If a scripted job does not work as intended in its new environment, we recommend that you create an equivalent job that works correctly in that environment.</span></span>  
  
 <span data-ttu-id="31b19-303">[[返回页首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="31b19-303">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="logins"></a><a name="logins"></a><span data-ttu-id="31b19-304">登录名</span><span class="sxs-lookup"><span data-stu-id="31b19-304">Logins</span></span>  
 <span data-ttu-id="31b19-305">登录到 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例需要有效的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 登录名。</span><span class="sxs-lookup"><span data-stu-id="31b19-305">Logging into an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] requires a valid [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login.</span></span> <span data-ttu-id="31b19-306">在身份验证过程中会使用此登录名，以验证主体是否可以连接到 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]实例。</span><span class="sxs-lookup"><span data-stu-id="31b19-306">This login is used in the authentication process that verifies whether the principal can connect to the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="31b19-307">在服务器实例上未定义或错误定义了其相应 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 登录名的数据库用户无法登录到实例。</span><span class="sxs-lookup"><span data-stu-id="31b19-307">A database user for which the corresponding [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login is undefined or is incorrectly defined on a server instance cannot log in to the instance.</span></span> <span data-ttu-id="31b19-308">这样的用户被称为此服务器实例上的数据库的“孤立用户” \*\* 。</span><span class="sxs-lookup"><span data-stu-id="31b19-308">Such a user is said to be an *orphaned user* of the database on that server instance.</span></span> <span data-ttu-id="31b19-309">当数据库还原、附加或复制到 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]的其他实例之后，数据库用户便可变为孤立用户。</span><span class="sxs-lookup"><span data-stu-id="31b19-309">A database user can become orphaned if after a database is restored, attached, or copied to a different instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
 <span data-ttu-id="31b19-310">若要为数据库原始副本中的部分或全部对象生成脚本，可以使用生成脚本向导，并在 **“选择脚本选项”** 对话框中将 **“编写登录脚本”** 选项设置为 **True**。</span><span class="sxs-lookup"><span data-stu-id="31b19-310">To generate a script for some or all the objects in the original copy of the database, you can use the Generate Scripts Wizard, and in the **Choose Script Options** dialog box, set the **Script Logins** option to **True**.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="31b19-311">有关如何为镜像数据库设置登录名的信息，请参阅[数据库镜像或 AlwaysOn 可用性组设置登录帐户 (SQL Server)](../../database-engine/database-mirroring/set-up-login-accounts-database-mirroring-always-on-availability.md) 和[角色切换后登录名和作业的管理 (SQL Server)](../../sql-server/failover-clusters/management-of-logins-and-jobs-after-role-switching-sql-server.md)</span><span class="sxs-lookup"><span data-stu-id="31b19-311">For information about how to set up logins for a mirrored database, see [Set Up Login Accounts for Database Mirroring or AlwaysOn Availability Groups &#40;SQL Server&#41;](../../database-engine/database-mirroring/set-up-login-accounts-database-mirroring-always-on-availability.md) and [Management of Logins and Jobs After Role Switching &#40;SQL Server&#41;](../../sql-server/failover-clusters/management-of-logins-and-jobs-after-role-switching-sql-server.md).</span></span>  
  
 <span data-ttu-id="31b19-312">[[返回页首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="31b19-312">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="permissions"></a><a name="permissions"></a> <span data-ttu-id="31b19-313">权限</span><span class="sxs-lookup"><span data-stu-id="31b19-313">Permissions</span></span>  
 <span data-ttu-id="31b19-314">当数据库在其他服务器实例上可用时，下列类型的权限可能受到影响。</span><span class="sxs-lookup"><span data-stu-id="31b19-314">The following types of permissions might be affected when a database is made available on another server instance.</span></span>  
  
-   <span data-ttu-id="31b19-315">对系统对象的 GRANT、REVOKE 或 DENY 权限</span><span class="sxs-lookup"><span data-stu-id="31b19-315">GRANT, REVOKE, or DENY permissions on system objects</span></span>  
  
-   <span data-ttu-id="31b19-316">对服务器实例的 GRANT、REVOKE 或 DENY 权限（*服务器级权限*）</span><span class="sxs-lookup"><span data-stu-id="31b19-316">GRANT, REVOKE, or DENY permissions on server instance (*server-level permissions*)</span></span>  
  
### <a name="grant-revoke-and-deny-permissions-on-system-objects"></a><span data-ttu-id="31b19-317">对系统对象的 GRANT、REVOKE 和 DENY 权限</span><span class="sxs-lookup"><span data-stu-id="31b19-317">GRANT, REVOKE, and DENY Permissions on System Objects</span></span>  
 <span data-ttu-id="31b19-318">对系统对象（例如存储过程、扩展存储过程、函数和视图）的权限存储在 **master** 数据库中，并且必须在目标服务器实例上进行配置。</span><span class="sxs-lookup"><span data-stu-id="31b19-318">Permissions on system objects such as stored procedures, extended stored procedures, functions, and views, are stored in the **master** database and must be configured on the destination server instance.</span></span>  
  
 <span data-ttu-id="31b19-319">若要为数据库原始副本中的部分或全部对象生成脚本，可以使用生成脚本向导，并在“选择脚本选项”\*\*\*\* 对话框中将“编写对象级权限脚本”\*\*\*\* 选项设置为 **True**。</span><span class="sxs-lookup"><span data-stu-id="31b19-319">To generate a script for some or all the objects in the original copy of the database, you can use the Generate Scripts Wizard, and in the **Choose Script Options** dialog box, set the **Script Object-Level Permissions** option to **True**.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="31b19-320">如果编写登录脚本，则不编写密码的脚本。</span><span class="sxs-lookup"><span data-stu-id="31b19-320">If you script logins, the passwords are not scripted.</span></span> <span data-ttu-id="31b19-321">如果登录名使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 身份验证，则必须在目标上修改脚本。</span><span class="sxs-lookup"><span data-stu-id="31b19-321">If you have logins that use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication, you have to modify the script on the destination.</span></span>  
  
 <span data-ttu-id="31b19-322">在 [sys.system_objects](/sql/relational-databases/system-catalog-views/sys-system-objects-transact-sql) 目录视图中可以查看系统对象。</span><span class="sxs-lookup"><span data-stu-id="31b19-322">System objects are visible in the [sys.system_objects](/sql/relational-databases/system-catalog-views/sys-system-objects-transact-sql) catalog view.</span></span> <span data-ttu-id="31b19-323">对系统对象的权限在**master**数据库的[sys.databases. database_permissions](/sql/relational-databases/system-catalog-views/sys-database-permissions-transact-sql)目录视图中可见。</span><span class="sxs-lookup"><span data-stu-id="31b19-323">The permissions on system objects are visible in the [sys.database_permissions](/sql/relational-databases/system-catalog-views/sys-database-permissions-transact-sql) catalog view in the **master** database.</span></span> <span data-ttu-id="31b19-324">有关查询这些目录视图并授予系统对象权限的信息，请参阅 [GRANT 系统对象权限 (Transact-SQL)](/sql/t-sql/statements/grant-system-object-permissions-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="31b19-324">For information about querying these catalog views and granting system-object permissions, see [GRANT System Object Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/grant-system-object-permissions-transact-sql).</span></span> <span data-ttu-id="31b19-325">有关更多详细信息，请参阅 [REVOKE 系统对象权限 (Transact-SQL)](/sql/t-sql/statements/revoke-system-object-permissions-transact-sql) 和 [DENY 系统权限 (Transact-SQL)](/sql/t-sql/statements/deny-system-object-permissions-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="31b19-325">For more information, see [REVOKE System Object Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/revoke-system-object-permissions-transact-sql) and [DENY System Object Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/deny-system-object-permissions-transact-sql).</span></span>  
  
### <a name="grant-revoke-and-deny-permissions-on-a-server-instance"></a><span data-ttu-id="31b19-326">对服务器实例的 GRANT、REVOKE 和 DENY 权限</span><span class="sxs-lookup"><span data-stu-id="31b19-326">GRANT, REVOKE, and DENY Permissions on a Server Instance</span></span>  
 <span data-ttu-id="31b19-327">服务器范围的权限存储在 **master** 数据库中，并且必须在目标服务器实例上进行配置。</span><span class="sxs-lookup"><span data-stu-id="31b19-327">Permissions at the server scope are stored in the **master** database and must be configured on the destination server instance.</span></span> <span data-ttu-id="31b19-328">有关服务器实例的服务器权限的信息，请查询 [sys.server_permissions](/sql/relational-databases/system-catalog-views/sys-server-permissions-transact-sql) 目录视图；有关服务器主体的信息，请查询 [sys.server_principals](/sql/relational-databases/system-catalog-views/sys-server-principals-transact-sql)目录视图；有关服务器角色成员身份的信息，请查询 [sys.server_role_members](/sql/relational-databases/system-catalog-views/sys-server-role-members-transact-sql) 目录视图。</span><span class="sxs-lookup"><span data-stu-id="31b19-328">For information about the server permissions of a server instance, query the [sys.server_permissions](/sql/relational-databases/system-catalog-views/sys-server-permissions-transact-sql) catalog view, for information about server principals query the [sys.server_principals](/sql/relational-databases/system-catalog-views/sys-server-principals-transact-sql)s catalog view, and for information about membership of server roles query the [sys.server_role_members](/sql/relational-databases/system-catalog-views/sys-server-role-members-transact-sql) catalog view.</span></span>  
  
 <span data-ttu-id="31b19-329">有关更多详细信息，请参阅 [GRANT 服务器权限 (Transact-SQL)](/sql/t-sql/statements/grant-server-permissions-transact-sql)、[REVOKE 服务器权限 (Transact-SQL)](/sql/t-sql/statements/revoke-server-permissions-transact-sql) 和 [DENY 服务器权限 (Transact-SQL)](/sql/t-sql/statements/deny-server-permissions-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="31b19-329">For more information, see [GRANT Server Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/grant-server-permissions-transact-sql), [REVOKE Server Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/revoke-server-permissions-transact-sql), and [DENY Server Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/deny-server-permissions-transact-sql).</span></span>  
  
#### <a name="server-level-permissions-for-a-certificate-or-asymmetric-key"></a><span data-ttu-id="31b19-330">证书或非对称密钥的服务器级权限</span><span class="sxs-lookup"><span data-stu-id="31b19-330">Server-Level Permissions for a Certificate or Asymmetric Key</span></span>  
 <span data-ttu-id="31b19-331">不能向证书或非对称密钥直接授予服务器级权限。</span><span class="sxs-lookup"><span data-stu-id="31b19-331">Server-level permissions cannot be granted directly to a certificate or asymmetric key.</span></span> <span data-ttu-id="31b19-332">相反，可以向专门针对特定证书或非对称密钥创建的映射登录名授予服务器级权限。</span><span class="sxs-lookup"><span data-stu-id="31b19-332">Instead, server-level permissions are granted to a mapped login that is created exclusively for a specific certificate or asymmetric key.</span></span> <span data-ttu-id="31b19-333">因此，每个需要服务器级权限的证书或非对称密钥都需要自己的“证书映射登录名 \*\* ”或“非对称密钥映射登录名 \*\*”。</span><span class="sxs-lookup"><span data-stu-id="31b19-333">Therefore, each certificate or asymmetric key that requires server-level permissions, requires its own *certificate-mapped login* or *asymmetric key-mapped login*.</span></span> <span data-ttu-id="31b19-334">若要为证书或非对称密钥授予服务器级权限，请向其映射登录名授予相应权限。</span><span class="sxs-lookup"><span data-stu-id="31b19-334">To grant server-level permissions for a certificate or asymmetric key, grant the permissions to its mapped login.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="31b19-335">映射登录名仅用于对使用相应证书或非对称密钥签名的代码进行授权。</span><span class="sxs-lookup"><span data-stu-id="31b19-335">A mapped login is used only for authorization of code signed with the corresponding certificate or asymmetric key.</span></span> <span data-ttu-id="31b19-336">映射登录名不能用于身份验证。</span><span class="sxs-lookup"><span data-stu-id="31b19-336">Mapped logins cannot be used for authentication.</span></span>  
  
 <span data-ttu-id="31b19-337">映射登录名及其权限都位于 **master**中。</span><span class="sxs-lookup"><span data-stu-id="31b19-337">The mapped login and its permissions both reside in **master**.</span></span> <span data-ttu-id="31b19-338">如果证书或非对称密钥位于 **master**之外的数据库中，则必须在 **master** 中重新创建证书或非对称密钥并将其映射到登录名。</span><span class="sxs-lookup"><span data-stu-id="31b19-338">If a certificate or asymmetric key resides in a database other than **master**, you must re-create it in **master** and map it to a login.</span></span> <span data-ttu-id="31b19-339">如果将数据库移动、复制或还原到其他服务器实例，则必须在目标服务器实例的 **master** 数据库中重新创建其证书或非对称密钥，将证书或非对称密钥映射到登录名，并向此登录名授予必需的服务器级权限。</span><span class="sxs-lookup"><span data-stu-id="31b19-339">If you move, copy, or restore the database to another server instance, you must re-create its certificate or asymmetric key in the **master** database of the destination server instance, map to a login, and grant the required server-level permissions to the login.</span></span>  
  
 <span data-ttu-id="31b19-340">**创建证书或非对称密钥**</span><span class="sxs-lookup"><span data-stu-id="31b19-340">**To create a certificate or asymmetric key**</span></span>  
  
-   [<span data-ttu-id="31b19-341">CREATE CERTIFICATE (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="31b19-341">CREATE CERTIFICATE &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-certificate-transact-sql)  
  
-   [<span data-ttu-id="31b19-342">CREATE ASYMMETRIC KEY &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="31b19-342">CREATE ASYMMETRIC KEY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-asymmetric-key-transact-sql)  
  
 <span data-ttu-id="31b19-343">**将证书或非对称密钥映射到登录名**</span><span class="sxs-lookup"><span data-stu-id="31b19-343">**To map a certificate or asymmetric key to a login**</span></span>  
  
-   [<span data-ttu-id="31b19-344">CREATE LOGIN &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="31b19-344">CREATE LOGIN &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-login-transact-sql)  
  
 <span data-ttu-id="31b19-345">**为映射登录名分配权限**</span><span class="sxs-lookup"><span data-stu-id="31b19-345">**To assign permissions to the mapped login**</span></span>  
  
-   [<span data-ttu-id="31b19-346">GRANT 服务器权限 (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="31b19-346">GRANT Server Permissions &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/grant-server-permissions-transact-sql)  
  
 <span data-ttu-id="31b19-347">有关证书和非对称密钥的详细信息，请参阅 [Encryption Hierarchy](../security/encryption/encryption-hierarchy.md)。</span><span class="sxs-lookup"><span data-stu-id="31b19-347">For more information about certificates and asymmetric keys, see [Encryption Hierarchy](../security/encryption/encryption-hierarchy.md).</span></span>  
  
 <span data-ttu-id="31b19-348">[[返回页首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="31b19-348">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="replication-settings"></a><a name="replication_settings"></a><span data-ttu-id="31b19-349">复制设置</span><span class="sxs-lookup"><span data-stu-id="31b19-349">Replication Settings</span></span>  
 <span data-ttu-id="31b19-350">如果将复制数据库的备份还原到其他服务器或数据库，则无法保留复制设置。</span><span class="sxs-lookup"><span data-stu-id="31b19-350">If you restore a backup of a replicated database to another server or database, replication settings cannot be preserved.</span></span> <span data-ttu-id="31b19-351">在这种情况下，您必须在还原备份后重新创建所有发布和订阅。</span><span class="sxs-lookup"><span data-stu-id="31b19-351">In this case, you must re-create all publications and subscriptions after backups are restored.</span></span> <span data-ttu-id="31b19-352">为使此过程更加简单，请创建用于当前复制设置以及启用和禁用复制的脚本。</span><span class="sxs-lookup"><span data-stu-id="31b19-352">To make this process easier, create scripts for your current replication settings and, also, for the enabling and disabling of replication.</span></span> <span data-ttu-id="31b19-353">为了帮助重新创建复制设置，请复制这些脚本，并更改服务器名称引用以用于目标服务器实例。</span><span class="sxs-lookup"><span data-stu-id="31b19-353">To help re-create your replication settings, copy these scripts and change the server name references to work for the destination server instance.</span></span>  
  
 <span data-ttu-id="31b19-354">有关详细信息，请参阅[备份和还原复制的数据库](../replication/administration/back-up-and-restore-replicated-databases.md)、[数据库镜像和复制 (SQL Server)](../../database-engine/database-mirroring/database-mirroring-and-replication-sql-server.md) 以及[日志传送和复制 (SQL Server)](../../database-engine/log-shipping/log-shipping-and-replication-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="31b19-354">For more information, see [Back Up and Restore Replicated Databases](../replication/administration/back-up-and-restore-replicated-databases.md), [Database Mirroring and Replication &#40;SQL Server&#41;](../../database-engine/database-mirroring/database-mirroring-and-replication-sql-server.md), and [Log Shipping and Replication &#40;SQL Server&#41;](../../database-engine/log-shipping/log-shipping-and-replication-sql-server.md).</span></span>  
  
 <span data-ttu-id="31b19-355">[[返回页首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="31b19-355">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="service-broker-applications"></a><a name="sb_applications"></a><span data-ttu-id="31b19-356">Service Broker 应用程序</span><span class="sxs-lookup"><span data-stu-id="31b19-356">Service Broker Applications</span></span>  
 <span data-ttu-id="31b19-357">[!INCLUDE[ssSB](../../includes/sssb-md.md)] 应用程序的许多相关内容都将随数据库一起移动。</span><span class="sxs-lookup"><span data-stu-id="31b19-357">Many aspects of a [!INCLUDE[ssSB](../../includes/sssb-md.md)] application move with the database.</span></span> <span data-ttu-id="31b19-358">但是，应用程序的某些相关内容必须在新位置重新创建或重新配置。</span><span class="sxs-lookup"><span data-stu-id="31b19-358">However, some aspects of the application must be re-created or reconfigured in the new location.</span></span>  
  
 <span data-ttu-id="31b19-359">[[返回页首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="31b19-359">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="startup-procedures"></a><a name="startup_procedures"></a><span data-ttu-id="31b19-360">启动过程</span><span class="sxs-lookup"><span data-stu-id="31b19-360">Startup Procedures</span></span>  
 <span data-ttu-id="31b19-361">启动过程是指标记为自动执行并在每次启动 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 时执行的存储过程。</span><span class="sxs-lookup"><span data-stu-id="31b19-361">A startup procedure is a stored procedure that is marked for automatic execution and is executed every time [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] starts.</span></span> <span data-ttu-id="31b19-362">如果数据库依赖于启动过程，则必须在目标服务器实例上定义这些启动过程并将其配置为启动时自动执行。</span><span class="sxs-lookup"><span data-stu-id="31b19-362">If the database depends on any startup procedures, they must be defined on the destination server instance and be configured to be automatically executed at startup.</span></span>  
  
 <span data-ttu-id="31b19-363">[[返回页首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="31b19-363">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="triggers-at-server-level"></a><a name="triggers"></a><span data-ttu-id="31b19-364">在服务器级别 (触发) </span><span class="sxs-lookup"><span data-stu-id="31b19-364">Triggers (at Server Level)</span></span>  
 <span data-ttu-id="31b19-365">DDL 触发器激发存储过程以响应各种数据定义语言 (DDL) 事件。</span><span class="sxs-lookup"><span data-stu-id="31b19-365">DDL triggers fire stored procedures in response to a variety of Data Definition Language (DDL) events.</span></span> <span data-ttu-id="31b19-366">这些事件主要与以关键字 CREATE、ALTER 和 DROP 开头的 [!INCLUDE[tsql](../../includes/tsql-md.md)] 语句对应。</span><span class="sxs-lookup"><span data-stu-id="31b19-366">These events primarily correspond to [!INCLUDE[tsql](../../includes/tsql-md.md)] statements that start with the keywords CREATE, ALTER, and DROP.</span></span> <span data-ttu-id="31b19-367">执行 DDL 式操作的系统存储过程也可以激发 DDL 触发器。</span><span class="sxs-lookup"><span data-stu-id="31b19-367">Certain system stored procedures that perform DDL-like operations can also fire DDL triggers.</span></span>  
  
 <span data-ttu-id="31b19-368">有关此功能的详细信息，请参阅 [DDL Triggers](../triggers/ddl-triggers.md)。</span><span class="sxs-lookup"><span data-stu-id="31b19-368">For more information about this feature, see [DDL Triggers](../triggers/ddl-triggers.md).</span></span>  
  
 <span data-ttu-id="31b19-369">[[返回页首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="31b19-369">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="31b19-370">另请参阅</span><span class="sxs-lookup"><span data-stu-id="31b19-370">See Also</span></span>  
 <span data-ttu-id="31b19-371">[包含的数据库](contained-databases.md) </span><span class="sxs-lookup"><span data-stu-id="31b19-371">[Contained Databases](contained-databases.md) </span></span>  
 <span data-ttu-id="31b19-372">[将数据库复制到其他服务器](copy-databases-to-other-servers.md) </span><span class="sxs-lookup"><span data-stu-id="31b19-372">[Copy Databases to Other Servers](copy-databases-to-other-servers.md) </span></span>  
 <span data-ttu-id="31b19-373">[数据库分离和附加 (SQL Server)](database-detach-and-attach-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="31b19-373">[Database Detach and Attach &#40;SQL Server&#41;](database-detach-and-attach-sql-server.md) </span></span>  
 <span data-ttu-id="31b19-374">[故障转移到日志传送辅助 &#40;SQL Server&#41;](../../database-engine/log-shipping/fail-over-to-a-log-shipping-secondary-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="31b19-374">[Fail Over to a Log Shipping Secondary &#40;SQL Server&#41;](../../database-engine/log-shipping/fail-over-to-a-log-shipping-secondary-sql-server.md) </span></span>  
 <span data-ttu-id="31b19-375">[数据库镜像会话期间的角色切换 (SQL Server)](../../database-engine/database-mirroring/role-switching-during-a-database-mirroring-session-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="31b19-375">[Role Switching During a Database Mirroring Session &#40;SQL Server&#41;](../../database-engine/database-mirroring/role-switching-during-a-database-mirroring-session-sql-server.md) </span></span>  
 <span data-ttu-id="31b19-376">[设置加密的镜像数据库](../../database-engine/database-mirroring/set-up-an-encrypted-mirror-database.md) </span><span class="sxs-lookup"><span data-stu-id="31b19-376">[Set Up an Encrypted Mirror Database](../../database-engine/database-mirroring/set-up-an-encrypted-mirror-database.md) </span></span>  
 <span data-ttu-id="31b19-377">[SQL Server 配置管理器](../sql-server-configuration-manager.md) </span><span class="sxs-lookup"><span data-stu-id="31b19-377">[SQL Server Configuration Manager](../sql-server-configuration-manager.md) </span></span>  
 [<span data-ttu-id="31b19-378">孤立用户故障排除 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="31b19-378">Troubleshoot Orphaned Users &#40;SQL Server&#41;</span></span>](../../sql-server/failover-clusters/troubleshoot-orphaned-users-sql-server.md)  
  
  
