---
title: 系统数据库的备份和还原 (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 03/07/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- system databases [SQL Server], backing up and restoring
- restoring system databases [SQL Server]
- backing up [SQL Server], system databases
- database backups [SQL Server], system databases
- servers [SQL Server], backup
ms.assetid: aef0c4fa-ba67-413d-9359-1a67682fdaab
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 51ccf1aeadcf4ab9a662cdd629a812d3ee4b82aa
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87591433"
---
# <a name="back-up-and-restore-of-system-databases-sql-server"></a><span data-ttu-id="8e8a6-102">系统数据库的备份和还原 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="8e8a6-102">Back Up and Restore of System Databases (SQL Server)</span></span>
  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="8e8a6-103">维护一组系统级数据库（称为“系统数据库”  ），这些数据库对于服务器实例的运行至关重要。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-103">maintains a set of system-level databases, s*ystem databases*, which are essential for the operation of a server instance.</span></span> <span data-ttu-id="8e8a6-104">每次进行大量更新后，都必须备份多个系统数据库。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-104">Several of the system databases must be backed up after every significant update.</span></span> <span data-ttu-id="8e8a6-105">必须备份的系统数据库包括 **msdb**、 **master**和 **model**。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-105">The system databases that you must always back up include **msdb**, **master**, and **model**.</span></span> <span data-ttu-id="8e8a6-106">如果有任何数据库在服务器实例上使用了复制，则还必须备份 **distribution** 系统数据库。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-106">If any database uses replication on the server instance, there is a **distribution** system database that you must also back up.</span></span> <span data-ttu-id="8e8a6-107">备份这些系统数据库，就可以在发生系统故障（例如硬盘丢失）时还原和恢复 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 系统。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-107">Backups of these system databases let you restore and recover the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] system in the event of system failure, such as the loss of a hard disk.</span></span>  
  
 <span data-ttu-id="8e8a6-108">下表概述了所有的系统数据库。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-108">The following table summarizes all of the system databases.</span></span>  
  
|<span data-ttu-id="8e8a6-109">系统数据库</span><span class="sxs-lookup"><span data-stu-id="8e8a6-109">System database</span></span>|<span data-ttu-id="8e8a6-110">说明</span><span class="sxs-lookup"><span data-stu-id="8e8a6-110">Description</span></span>|<span data-ttu-id="8e8a6-111">是否需要备份？</span><span class="sxs-lookup"><span data-stu-id="8e8a6-111">Are backups required?</span></span>|<span data-ttu-id="8e8a6-112">恢复模式</span><span class="sxs-lookup"><span data-stu-id="8e8a6-112">Recovery model</span></span>|<span data-ttu-id="8e8a6-113">注释</span><span class="sxs-lookup"><span data-stu-id="8e8a6-113">Comments</span></span>|  
|---------------------|-----------------|---------------------------|--------------------|--------------|  
|[<span data-ttu-id="8e8a6-114">master</span><span class="sxs-lookup"><span data-stu-id="8e8a6-114">master</span></span>](../databases/master-database.md)|<span data-ttu-id="8e8a6-115">记录 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 系统的所有系统级信息的数据库。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-115">The database that records all of the system level information for a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] system.</span></span>|<span data-ttu-id="8e8a6-116">是</span><span class="sxs-lookup"><span data-stu-id="8e8a6-116">Yes</span></span>|<span data-ttu-id="8e8a6-117">简单</span><span class="sxs-lookup"><span data-stu-id="8e8a6-117">Simple</span></span>|<span data-ttu-id="8e8a6-118">必须经常备份 **master** ，以便根据业务需要充分保护数据。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-118">Back up **master** as often as necessary to protect the data sufficiently for your business needs.</span></span> <span data-ttu-id="8e8a6-119">建议使用定期备份计划，这样在大量更新之后可以补充更多的备份。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-119">We recommend a regular backup schedule, which you can supplement with an additional backup after a substantial update.</span></span>|  
|[<span data-ttu-id="8e8a6-120">model</span><span class="sxs-lookup"><span data-stu-id="8e8a6-120">model</span></span>](../databases/model-database.md)|<span data-ttu-id="8e8a6-121">在 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]实例上为所有数据库创建的模板。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-121">The template for all databases that are created on the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>|<span data-ttu-id="8e8a6-122">是</span><span class="sxs-lookup"><span data-stu-id="8e8a6-122">Yes</span></span>|<span data-ttu-id="8e8a6-123">用户可配置<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="8e8a6-123">User configurable<sup>1</sup></span></span>|<span data-ttu-id="8e8a6-124">仅在业务需要时备份 **model** ，例如自定义其数据库选项后立即备份。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-124">Back up **model** only when necessary for your business needs; for example, immediately after customizing its database options.</span></span><br /><br /> <span data-ttu-id="8e8a6-125">**最佳做法：** 建议根据需要仅创建“model”的完整数据库备份  。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-125">**Best practice:** We recommend that you create only full database backups of **model**, as required.</span></span> <span data-ttu-id="8e8a6-126">由于 **model** 较小而且很少更改，因此无需备份日志。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-126">Because **model** is small and rarely changes, backing up the log is unnecessary.</span></span>|  
|[<span data-ttu-id="8e8a6-127">msdb</span><span class="sxs-lookup"><span data-stu-id="8e8a6-127">msdb</span></span>](../databases/msdb-database.md)|<span data-ttu-id="8e8a6-128">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理用来安排警报和作业以及记录操作员信息的数据库。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-128">The database used by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent for scheduling alerts and jobs, and for recording operators.</span></span> <span data-ttu-id="8e8a6-129">**msdb** 还包含历史记录表，例如备份和还原历史记录表。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-129">**msdb** also contains history tables such as the backup and restore history tables.</span></span>|<span data-ttu-id="8e8a6-130">是</span><span class="sxs-lookup"><span data-stu-id="8e8a6-130">Yes</span></span>|<span data-ttu-id="8e8a6-131">简单（默认值）</span><span class="sxs-lookup"><span data-stu-id="8e8a6-131">Simple (default)</span></span>|<span data-ttu-id="8e8a6-132">更新时备份 **msdb** 。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-132">Back up **msdb** whenever it is updated.</span></span>|  
|<span data-ttu-id="8e8a6-133">[Resource](../databases/resource-database.md) (RDB)</span><span class="sxs-lookup"><span data-stu-id="8e8a6-133">[Resource](../databases/resource-database.md) (RDB)</span></span>|<span data-ttu-id="8e8a6-134">包含附带的所有系统对象副本的只读数据库 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]</span><span class="sxs-lookup"><span data-stu-id="8e8a6-134">A read-only database that contains copies of all system objects that ship with [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]</span></span>|<span data-ttu-id="8e8a6-135">否</span><span class="sxs-lookup"><span data-stu-id="8e8a6-135">No</span></span>|-|<span data-ttu-id="8e8a6-136">**Resource** 数据库位于 mssqlsystemresource.mdf 文件中，该文件仅包含代码。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-136">The **Resource** database resides in the mssqlsystemresource.mdf file, which contains only code.</span></span> <span data-ttu-id="8e8a6-137">因此， [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 不能备份 **Resource** 数据库。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-137">Therefore, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] cannot back up the **Resource** database.</span></span><br /><br /> <span data-ttu-id="8e8a6-138">注意：通过将 mssqlsystemresource.mdf 文件作为二进制 (.exe) 文件而不是作为数据库文件处理，可以对该文件执行基于文件的备份或基于磁盘的备份。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-138">Note: You can perform a file-based or a disk-based backup on the mssqlsystemresource.mdf file by treating the file as if it were a binary (.exe) file, instead of a database file.</span></span> <span data-ttu-id="8e8a6-139">但是不能使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 还原这些备份。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-139">But you cannot use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] restore on the backups.</span></span> <span data-ttu-id="8e8a6-140">只能手动还原 mssqlsystemresource.mdf 的备份副本，并且必须谨慎，不要使用过时版本或可能不安全的版本覆盖当前的 **Resource** 数据库。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-140">Restoring a backup copy of mssqlsystemresource.mdf can only be done manually, and you must be careful not to overwrite the current **Resource** database with an out-of-date or potentially insecure version.</span></span>|  
|[<span data-ttu-id="8e8a6-141">tempdb</span><span class="sxs-lookup"><span data-stu-id="8e8a6-141">tempdb</span></span>](../databases/tempdb-database.md)|<span data-ttu-id="8e8a6-142">用于保存临时或中间结果集的工作空间。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-142">A workspace for holding temporary or intermediate result sets.</span></span> <span data-ttu-id="8e8a6-143">每次启动 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例时都会重新创建此数据库。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-143">This database is re-created every time an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is started.</span></span> <span data-ttu-id="8e8a6-144">服务器实例关闭时，将永久删除 **tempdb** 中的所有数据。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-144">When the server instance is shut down, any data in **tempdb** is deleted permanently.</span></span>|<span data-ttu-id="8e8a6-145">否</span><span class="sxs-lookup"><span data-stu-id="8e8a6-145">No</span></span>|<span data-ttu-id="8e8a6-146">简单</span><span class="sxs-lookup"><span data-stu-id="8e8a6-146">Simple</span></span>|<span data-ttu-id="8e8a6-147">无法备份 **tempdb** 系统数据库。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-147">You cannot back up the **tempdb** system database.</span></span>|  
|[<span data-ttu-id="8e8a6-148">配置分发</span><span class="sxs-lookup"><span data-stu-id="8e8a6-148">Configure Distribution</span></span>](../replication/configure-distribution.md)|<span data-ttu-id="8e8a6-149">只有将服务器配置为复制分发服务器时才存在此数据库。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-149">A database that exists only if the server is configured as a replication Distributor.</span></span> <span data-ttu-id="8e8a6-150">此数据库存储元数据、各种复制的历史记录数据以及用于事务复制的事务。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-150">This database stores metadata and history data for all types of replication, and transactions for transactional replication.</span></span>|<span data-ttu-id="8e8a6-151">是</span><span class="sxs-lookup"><span data-stu-id="8e8a6-151">Yes</span></span>|<span data-ttu-id="8e8a6-152">简单</span><span class="sxs-lookup"><span data-stu-id="8e8a6-152">Simple</span></span>|<span data-ttu-id="8e8a6-153">有关何时备份 **distribution** 数据库的信息，请参阅 [备份和还原复制的数据库](../replication/administration/back-up-and-restore-replicated-databases.md)。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-153">For information about when to back up the **distribution** database, see [Back Up and Restore Replicated Databases](../replication/administration/back-up-and-restore-replicated-databases.md).</span></span>|  
  
 <span data-ttu-id="8e8a6-154"><sup>1</sup>若要了解模型的当前恢复模式，请参阅[查看或更改数据库的恢复模式 &#40;SQL Server&#41;](view-or-change-the-recovery-model-of-a-database-sql-server.md)或[sys.databases &#40;transact-sql&#41;](/sql/relational-databases/system-catalog-views/sys-databases-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-154"><sup>1</sup> To learn the current recovery model of the model, see [View or Change the Recovery Model of a Database &#40;SQL Server&#41;](view-or-change-the-recovery-model-of-a-database-sql-server.md) or [sys.databases &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-databases-transact-sql).</span></span>  
  
## <a name="limitations-on-restoring-system-databases"></a><span data-ttu-id="8e8a6-155">对还原系统数据库的限制</span><span class="sxs-lookup"><span data-stu-id="8e8a6-155">Limitations on Restoring System Databases</span></span>  
  
-   <span data-ttu-id="8e8a6-156">只能从在服务器实例当前运行的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 版本上创建的备份中还原系统数据库。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-156">System databases can be restored only from backups that are created on the version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that the server instance is currently running.</span></span> <span data-ttu-id="8e8a6-157">例如，若要还原在 SP1 上运行的服务器实例上的系统数据库 [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-157">For example, to restore a system database on a server instance that is running on [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] SP1.</span></span>  
  
-   <span data-ttu-id="8e8a6-158">若要还原任何数据库，必须运行 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-158">To restore any database, the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] must be running.</span></span> <span data-ttu-id="8e8a6-159">只有在 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] master **数据库可供访问且至少部分可用时，才能启动** 实例。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-159">Startup of an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] requires that the **master** database is accessible and at least partly usable.</span></span> <span data-ttu-id="8e8a6-160">如果 **master** 数据库不可用，则可以通过下列两种方式之一将该数据库返回到可用状态：</span><span class="sxs-lookup"><span data-stu-id="8e8a6-160">If **master** becomes unusable, you can return the database to a usable state in either of the following ways:</span></span>  
  
    -   <span data-ttu-id="8e8a6-161">从当前数据库备份还原 **master** 。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-161">Restore **master** from a current database backup.</span></span>  
  
         <span data-ttu-id="8e8a6-162">如果你可以启动服务器实例，则应该能够从完整数据库备份还原 **master** 。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-162">If you can start the server instance, you should be able to restore **master** from a full database backup.</span></span>  
  
    -   <span data-ttu-id="8e8a6-163">完全重新生成 **master** 。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-163">Rebuild **master** completely.</span></span>  
  
         <span data-ttu-id="8e8a6-164">如果由于 **master** 严重损坏而无法启动 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]，则必须重新生成 **master**。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-164">If severe damage to **master** prevents you from starting [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], you must rebuild **master**.</span></span> <span data-ttu-id="8e8a6-165">有关详细信息，请参阅 [重新生成系统数据库](../databases/system-databases.md)。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-165">For more information, see [Rebuild System Databases](../databases/system-databases.md).</span></span>  
  
        > [!IMPORTANT]  
        >  <span data-ttu-id="8e8a6-166">重新生成 **master** 将重新生成所有系统数据库。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-166">Rebuilding **master** rebuilds all of the system databases.</span></span>  
  
-   <span data-ttu-id="8e8a6-167">某些情况下，恢复模型数据库时发生的问题可能需要重新生成系统数据库或替换模型数据库的 mdf 和 ldf 文件。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-167">Under some circumstances, problems recovering the model database may require rebuilding the system databases or replacing the mdf and ldf files for the model database.</span></span> <span data-ttu-id="8e8a6-168">有关详细信息，请参阅 [重新生成系统数据库](../databases/system-databases.md)。</span><span class="sxs-lookup"><span data-stu-id="8e8a6-168">For more information, see [Rebuild System Databases](../databases/system-databases.md).</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="8e8a6-169">相关任务</span><span class="sxs-lookup"><span data-stu-id="8e8a6-169">Related Tasks</span></span>  
  
-   [<span data-ttu-id="8e8a6-170">创建完整数据库备份 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="8e8a6-170">Create a Full Database Backup &#40;SQL Server&#41;</span></span>](create-a-full-database-backup-sql-server.md)  
  
-   [<span data-ttu-id="8e8a6-171">完整数据库还原（简单恢复模式）</span><span class="sxs-lookup"><span data-stu-id="8e8a6-171">Complete Database Restores &#40;Simple Recovery Model&#41;</span></span>](complete-database-restores-simple-recovery-model.md)  
  
-   [<span data-ttu-id="8e8a6-172">还原 master 数据库 (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="8e8a6-172">Restore the master Database &#40;Transact-SQL&#41;</span></span>](restore-the-master-database-transact-sql.md)  
  
-   [<span data-ttu-id="8e8a6-173">查看或更改数据库的恢复模式 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="8e8a6-173">View or Change the Recovery Model of a Database &#40;SQL Server&#41;</span></span>](view-or-change-the-recovery-model-of-a-database-sql-server.md)  
  
-   [<span data-ttu-id="8e8a6-174">移动系统数据库</span><span class="sxs-lookup"><span data-stu-id="8e8a6-174">Move System Databases</span></span>](../databases/move-system-databases.md)  
  
## <a name="see-also"></a><span data-ttu-id="8e8a6-175">另请参阅</span><span class="sxs-lookup"><span data-stu-id="8e8a6-175">See Also</span></span>  
 <span data-ttu-id="8e8a6-176">[分发数据库](../../relational-databases/replication/distribution-database.md) </span><span class="sxs-lookup"><span data-stu-id="8e8a6-176">[Distribution Database](../../relational-databases/replication/distribution-database.md) </span></span>  
 <span data-ttu-id="8e8a6-177">[master 数据库](../databases/master-database.md) </span><span class="sxs-lookup"><span data-stu-id="8e8a6-177">[master Database](../databases/master-database.md) </span></span>  
 <span data-ttu-id="8e8a6-178">[msdb 数据库](../databases/msdb-database.md) </span><span class="sxs-lookup"><span data-stu-id="8e8a6-178">[msdb Database](../databases/msdb-database.md) </span></span>  
 <span data-ttu-id="8e8a6-179">[model 数据库](../databases/model-database.md) </span><span class="sxs-lookup"><span data-stu-id="8e8a6-179">[model Database](../databases/model-database.md) </span></span>  
 <span data-ttu-id="8e8a6-180">[Resource 数据库](../databases/resource-database.md) </span><span class="sxs-lookup"><span data-stu-id="8e8a6-180">[Resource Database](../databases/resource-database.md) </span></span>  
 [<span data-ttu-id="8e8a6-181">tempdb 数据库</span><span class="sxs-lookup"><span data-stu-id="8e8a6-181">tempdb Database</span></span>](../databases/tempdb-database.md)  
  
  
