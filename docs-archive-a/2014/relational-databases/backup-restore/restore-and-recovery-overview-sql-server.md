---
title: 还原与恢复概述 (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- restoring tables [SQL Server]
- backups [SQL Server], restore scenarios
- database backups [SQL Server], restore scenarios
- database restores [SQL Server]
- restoring [SQL Server]
- restores [SQL Server]
- table restores [SQL Server]
- restoring databases [SQL Server], about restoring databases
- database restores [SQL Server], scenarios
ms.assetid: e985c9a6-4230-4087-9fdb-de8571ba5a5f
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 2b8f032dce4f2eb09ef80cfa8c6333de2d563a81
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87691757"
---
# <a name="restore-and-recovery-overview-sql-server"></a><span data-ttu-id="ec6f1-102">还原与恢复概述 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="ec6f1-102">Restore and Recovery Overview (SQL Server)</span></span>
  <span data-ttu-id="ec6f1-103">若要从故障中恢复 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 数据库，数据库管理员必须按照逻辑正确并且有意义的还原顺序还原一组 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 备份。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-103">To recover a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database from a failure, a database administrator has to restore a set of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] backups in a logically correct and meaningful restore sequence.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="ec6f1-104">还原和恢复支持从整个数据库、数据文件或数据页的备份还原数据，如下所示：</span><span class="sxs-lookup"><span data-stu-id="ec6f1-104">restore and recovery supports restoring data from backups of a whole database, a data file, or a data page, as follows:</span></span>  
  
-   <span data-ttu-id="ec6f1-105">数据库（“数据库完整还原”  ）</span><span class="sxs-lookup"><span data-stu-id="ec6f1-105">The database (a *complete database restore*)</span></span>  
  
     <span data-ttu-id="ec6f1-106">还原和恢复整个数据库，并且数据库在还原和恢复操作期间处于脱机状态。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-106">The whole database is restored and recovered, and the database is offline for the duration of the restore and recovery operations.</span></span>  
  
-   <span data-ttu-id="ec6f1-107">数据文件（“文件还原”  ）</span><span class="sxs-lookup"><span data-stu-id="ec6f1-107">The data file (a *file restore*)</span></span>  
  
     <span data-ttu-id="ec6f1-108">还原和恢复一个数据文件或一组文件。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-108">A data file or a set of files is restored and recovered.</span></span> <span data-ttu-id="ec6f1-109">在文件还原过程中，包含相应文件的文件组在还原过程中自动变为脱机状态。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-109">During a file restore, the filegroups that contain the files are automatically offline for the duration of the restore.</span></span> <span data-ttu-id="ec6f1-110">访问脱机文件组的任何尝试都会导致错误。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-110">Any attempt to access an offline filegroup causes an error.</span></span>  
  
-   <span data-ttu-id="ec6f1-111">数据页（“页面还原”  ）</span><span class="sxs-lookup"><span data-stu-id="ec6f1-111">The data page (a *page restore*)</span></span>  
  
     <span data-ttu-id="ec6f1-112">在完整恢复模式或大容量日志恢复模式下，可以还原单个数据库。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-112">Under the full recovery model or bulk-logged recovery model, you can restore individual databases.</span></span> <span data-ttu-id="ec6f1-113">可以对任何数据库执行页面还原，而不管文件组数为多少。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-113">Page restores can be performed on any database, regardless of the number of filegroups.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="ec6f1-114">备份和还原对所有支持的操作系统都有效，不管它们是 64 位还是 32 位系统。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-114">backup and restore work across all supported operating systems, whether they are 64-bit or 32-bit systems.</span></span> <span data-ttu-id="ec6f1-115">有关支持的操作系统的信息，请参阅[安装 SQL Server 2014 的硬件和软件要求](../../sql-server/install/hardware-and-software-requirements-for-installing-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-115">For information about the supported operating systems, see [Hardware and Software Requirements for Installing SQL Server 2014](../../sql-server/install/hardware-and-software-requirements-for-installing-sql-server.md).</span></span> <span data-ttu-id="ec6f1-116">有关支持从 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]的早期版本进行备份的信息，请参阅 [RESTORE (Transact-SQL)](/sql/t-sql/statements/restore-statements-transact-sql)中的“兼容性支持”部分。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-116">For information about support for backups from earlier versions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], see the "Compatibility Support" section of [RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql).</span></span>  
  
 <span data-ttu-id="ec6f1-117">**本主题内容：**</span><span class="sxs-lookup"><span data-stu-id="ec6f1-117">**In this Topic:**</span></span>  
  
-   [<span data-ttu-id="ec6f1-118">还原方案概述</span><span class="sxs-lookup"><span data-stu-id="ec6f1-118">Overview of Restore Scenarios</span></span>](#RestoreScenariosOv)  
  
-   [<span data-ttu-id="ec6f1-119">恢复模式和支持的还原操作</span><span class="sxs-lookup"><span data-stu-id="ec6f1-119">Recovery Models and Supported Restore Operations</span></span>](#RMsAndSupportedRestoreOps)  
  
-   [<span data-ttu-id="ec6f1-120">简单恢复模式下的还原限制</span><span class="sxs-lookup"><span data-stu-id="ec6f1-120">Restore Restrictions Under the Simple Recovery Model</span></span>](#RMsimpleScenarios)  
  
-   [<span data-ttu-id="ec6f1-121">在大容量日志恢复模式下还原</span><span class="sxs-lookup"><span data-stu-id="ec6f1-121">Restore Under the Bulk-Logged Recovery Model</span></span>](#RMblogRestore)  
  
-   [<span data-ttu-id="ec6f1-122">数据库恢复顾问 (SQL Server Management Studio) </span><span class="sxs-lookup"><span data-stu-id="ec6f1-122">Database Recovery Advisor (SQL Server Management Studio)</span></span>](#DRA)  
  
-   [<span data-ttu-id="ec6f1-123">相关内容</span><span class="sxs-lookup"><span data-stu-id="ec6f1-123">Related Content</span></span>](#RelatedContent)  
  
##  <a name="overview-of-restore-scenarios"></a><a name="RestoreScenariosOv"></a> <span data-ttu-id="ec6f1-124">还原方案概述</span><span class="sxs-lookup"><span data-stu-id="ec6f1-124">Overview of Restore Scenarios</span></span>  
 <span data-ttu-id="ec6f1-125">*中的“还原方案*[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ”是从一个或多个备份还原数据、继而恢复数据库的过程。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-125">A *restore scenario* in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is the process of restoring data from one or more backups and then recovering the database.</span></span> <span data-ttu-id="ec6f1-126">支持的还原方案取决于数据库的恢复模式和 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]的版本。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-126">The supported restore scenarios depend on the recovery model of the database and the edition of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
 <span data-ttu-id="ec6f1-127">下表介绍了不同恢复模式所支持的可行还原方案。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-127">The following table introduces the possible restore scenarios that are supported for different recovery models.</span></span>  
  
|<span data-ttu-id="ec6f1-128">还原方案</span><span class="sxs-lookup"><span data-stu-id="ec6f1-128">Restore scenario</span></span>|<span data-ttu-id="ec6f1-129">在简单恢复模式下</span><span class="sxs-lookup"><span data-stu-id="ec6f1-129">Under simple recovery model</span></span>|<span data-ttu-id="ec6f1-130">在完整/大容量日志恢复模式下</span><span class="sxs-lookup"><span data-stu-id="ec6f1-130">Under full/bulk-logged recovery models</span></span>|  
|----------------------|---------------------------------|----------------------------------------------|  
|<span data-ttu-id="ec6f1-131">数据库完整还原</span><span class="sxs-lookup"><span data-stu-id="ec6f1-131">Complete database restore</span></span>|<span data-ttu-id="ec6f1-132">这是基本的还原策略。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-132">This is the basic restore strategy.</span></span> <span data-ttu-id="ec6f1-133">数据库完整还原可能涉及完整数据库备份的简单还原和恢复。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-133">A complete database restore might involve simply restoring and recovering a full database backup.</span></span> <span data-ttu-id="ec6f1-134">另外，完整的数据库还原还可能涉及还原完整数据库备份，以及还原和恢复差异备份。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-134">Alternatively, a complete database restore might involve restoring a full database backup followed by restoring and recovering a differential backup.</span></span><br /><br /> <span data-ttu-id="ec6f1-135">有关详细信息，请参阅[完整数据库还原（简单恢复模式）](complete-database-restores-simple-recovery-model.md)。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-135">For more information, see [Complete Database Restores &#40;Simple Recovery Model&#41;](complete-database-restores-simple-recovery-model.md).</span></span>|<span data-ttu-id="ec6f1-136">这是基本的还原策略。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-136">This is the basic restore strategy.</span></span> <span data-ttu-id="ec6f1-137">数据库完整还原涉及还原完整数据库备份或差异备份（如果有），以及还原所有后续日志备份（按顺序）。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-137">A complete database restore involve restoring a full database backup and, optionally, a differential backup (if any), followed by restoring all subsequent log backups (in sequence).</span></span> <span data-ttu-id="ec6f1-138">通过恢复并还原上一次日志备份 (RESTORE WITH RECOVERY) 完成数据库完整还原。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-138">The complete database restore is finished by recovering the last log backup and also restoring it (RESTORE WITH RECOVERY).</span></span><br /><br /> <span data-ttu-id="ec6f1-139">有关详细信息，请参阅[完整数据库还原（完整恢复模式）](complete-database-restores-full-recovery-model.md)。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-139">For more information, see [Complete Database Restores &#40;Full Recovery Model&#41;](complete-database-restores-full-recovery-model.md)</span></span>|  
|<span data-ttu-id="ec6f1-140">文件还原 **\***</span><span class="sxs-lookup"><span data-stu-id="ec6f1-140">File restore **\***</span></span>|<span data-ttu-id="ec6f1-141">还原损坏的只读文件，但不还原整个数据库。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-141">Restore one or more damaged read-only files, without restoring the entire database.</span></span> <span data-ttu-id="ec6f1-142">仅在数据库至少有一个只读文件组时才可以进行文件还原。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-142">File restore is available only if the database has at least one read-only filegroup.</span></span>|<span data-ttu-id="ec6f1-143">还原一个或多个文件，而不还原整个数据库。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-143">Restores one or more files, without restoring the entire database.</span></span> <span data-ttu-id="ec6f1-144">可以在数据库处于脱机状态时执行文件还原，对于 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]的某些版本，也可以在数据库仍处于联机状态时执行。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-144">File restore can be performed while the database is offline or, for some editions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], while the database remains online.</span></span> <span data-ttu-id="ec6f1-145">在文件还原过程中，包含正在还原的文件的文件组一直处于脱机状态。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-145">During a file restore, the filegroups that contain the files that are being restored are always offline.</span></span>|  
|<span data-ttu-id="ec6f1-146">页面还原</span><span class="sxs-lookup"><span data-stu-id="ec6f1-146">Page restore</span></span>|<span data-ttu-id="ec6f1-147">不适用</span><span class="sxs-lookup"><span data-stu-id="ec6f1-147">Not applicable</span></span>|<span data-ttu-id="ec6f1-148">还原损坏的页面。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-148">Restores one or more damaged pages.</span></span> <span data-ttu-id="ec6f1-149">可以在数据库处于脱机状态时执行页面还原，对于 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]的某些版本，也可以在数据库仍处于联机状态时执行。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-149">Page restore can be performed while the database is offline or, for some editions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], while the database remains online.</span></span> <span data-ttu-id="ec6f1-150">在页面还原过程中，正在还原的页面一直处于脱机状态。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-150">During a page restore, the pages that are being restored are always offline.</span></span><br /><br /> <span data-ttu-id="ec6f1-151">必须具有完整的日志备份链（包含当前日志文件），并且必须应用所有这些日志备份以使页面与当前日志文件保持一致。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-151">An unbroken chain of log backups must be available, up to the current log file, and they must all be applied to bring the page up to date with the current log file.</span></span><br /><br /> <span data-ttu-id="ec6f1-152">有关详细信息，请参阅[还原页 (SQL Server)](restore-pages-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-152">For more information, see [Restore Pages &#40;SQL Server&#41;](restore-pages-sql-server.md).</span></span>|  
|<span data-ttu-id="ec6f1-153">段落还原 **\***</span><span class="sxs-lookup"><span data-stu-id="ec6f1-153">Piecemeal restore **\***</span></span>|<span data-ttu-id="ec6f1-154">按文件组级别并从主文件组和所有读写辅助文件组开始，分阶段还原和恢复数据库。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-154">Restore and recover the database in stages at the filegroup level, starting with the primary and all read/write, secondary filegroups.</span></span>|<span data-ttu-id="ec6f1-155">按文件组级别并从主文件组开始，分阶段还原和恢复数据库。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-155">Restore and recover the database in stages at the filegroup level, starting with the primary filegroup.</span></span>|  
  
 <span data-ttu-id="ec6f1-156">**\*** 仅在 Enterprise Edition 中支持联机还原。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-156">**\*** Online restore is supported only in the Enterprise edition.</span></span>  
  
 <span data-ttu-id="ec6f1-157">无论以何种方式还原数据，在恢复数据库前， [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] 都会保证整个数据库在逻辑上的一致性。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-157">Regardless of how data is restored, before a database can be recovered, the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] guarantees that the whole database is logically consistent.</span></span> <span data-ttu-id="ec6f1-158">例如，若要还原一个文件，则必须将该文件前滚足够长度，以便与数据库保持一致，才能恢复该文件并使其联机。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-158">For example, if you restore a file, you cannot recover it and bring it online until it has been rolled far enough forward to be consistent with the database.</span></span>  
  
### <a name="advantages-of-a-file-or-page-restore"></a><span data-ttu-id="ec6f1-159">文件还原或页面还原的优点</span><span class="sxs-lookup"><span data-stu-id="ec6f1-159">Advantages of a File or Page Restore</span></span>  
 <span data-ttu-id="ec6f1-160">只还原和恢复个别文件或页面（而非整个数据库）的方法具有以下优点：</span><span class="sxs-lookup"><span data-stu-id="ec6f1-160">Restoring and recovering files or pages, instead of the whole database, provides the following advantages:</span></span>  
  
-   <span data-ttu-id="ec6f1-161">还原少量数据可以缩短复制和恢复数据的时间。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-161">Restoring less data reduces the time required to copy and recover it.</span></span>  
  
-   <span data-ttu-id="ec6f1-162">在 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 中，还原文件或页面的操作可能会允许数据库中的其他数据在还原操作期间仍保持联机状态。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-162">On [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] restoring files or pages might allow other data in the database to remain online during the restore operation.</span></span>  
  
##  <a name="recovery-models-and-supported-restore-operations"></a><a name="RMsAndSupportedRestoreOps"></a><span data-ttu-id="ec6f1-163">恢复模式和支持的还原操作</span><span class="sxs-lookup"><span data-stu-id="ec6f1-163">Recovery Models and Supported Restore Operations</span></span>  
 <span data-ttu-id="ec6f1-164">可用于数据库的还原操作取决于所用的恢复模式。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-164">The restore operations that are available for a database depend on its recovery model.</span></span> <span data-ttu-id="ec6f1-165">下表简要说明了每种恢复模式是否支持给定的还原方案以及适用范围。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-165">The following table summarizes whether and to what extent each of the recovery models supports a given restore scenario.</span></span>  
  
|<span data-ttu-id="ec6f1-166">还原操作</span><span class="sxs-lookup"><span data-stu-id="ec6f1-166">Restore operation</span></span>|<span data-ttu-id="ec6f1-167">完整恢复模式</span><span class="sxs-lookup"><span data-stu-id="ec6f1-167">Full recovery model</span></span>|<span data-ttu-id="ec6f1-168">大容量日志恢复模式</span><span class="sxs-lookup"><span data-stu-id="ec6f1-168">Bulk-logged recovery model</span></span>|<span data-ttu-id="ec6f1-169">简单恢复模式</span><span class="sxs-lookup"><span data-stu-id="ec6f1-169">Simple recovery model</span></span>|  
|-----------------------|-------------------------|---------------------------------|---------------------------|  
|<span data-ttu-id="ec6f1-170">数据恢复</span><span class="sxs-lookup"><span data-stu-id="ec6f1-170">Data recovery</span></span>|<span data-ttu-id="ec6f1-171">完整还原（如果日志可用）。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-171">Complete recovery (if the log is available).</span></span>|<span data-ttu-id="ec6f1-172">某些数据将丢失。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-172">Some data-loss exposure.</span></span>|<span data-ttu-id="ec6f1-173">自上次完整备份或差异备份后的任何数据将丢失。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-173">Any data since last full or differential backup is lost.</span></span>|  
|<span data-ttu-id="ec6f1-174">时点还原</span><span class="sxs-lookup"><span data-stu-id="ec6f1-174">Point-in-time restore</span></span>|<span data-ttu-id="ec6f1-175">日志备份所涵盖的任何时间。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-175">Any time covered by the log backups.</span></span>|<span data-ttu-id="ec6f1-176">日志备份包含任何大容量日志更改时不允许。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-176">Disallowed if the log backup contains any bulk-logged changes.</span></span>|<span data-ttu-id="ec6f1-177">不支持。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-177">Not supported.</span></span>|  
|<span data-ttu-id="ec6f1-178">文件还原 **\***</span><span class="sxs-lookup"><span data-stu-id="ec6f1-178">File restore **\***</span></span>|<span data-ttu-id="ec6f1-179">完全支持。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-179">Full support.</span></span>|<span data-ttu-id="ec6f1-180">不完全支持。 **\*\***</span><span class="sxs-lookup"><span data-stu-id="ec6f1-180">Sometimes.**\*\***</span></span>|<span data-ttu-id="ec6f1-181">仅对只读辅助文件可用。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-181">Available only for read-only secondary files.</span></span>|  
|<span data-ttu-id="ec6f1-182">页面还原 **\***</span><span class="sxs-lookup"><span data-stu-id="ec6f1-182">Page restore **\***</span></span>|<span data-ttu-id="ec6f1-183">完全支持。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-183">Full support.</span></span>|<span data-ttu-id="ec6f1-184">不完全支持。 **\*\***</span><span class="sxs-lookup"><span data-stu-id="ec6f1-184">Sometimes.**\*\***</span></span>|<span data-ttu-id="ec6f1-185">无。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-185">None.</span></span>|  
|<span data-ttu-id="ec6f1-186">段落（文件组级）还原 **\***</span><span class="sxs-lookup"><span data-stu-id="ec6f1-186">Piecemeal (filegroup-level) restore **\***</span></span>|<span data-ttu-id="ec6f1-187">完全支持。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-187">Full support.</span></span>|<span data-ttu-id="ec6f1-188">不完全支持。 **\*\***</span><span class="sxs-lookup"><span data-stu-id="ec6f1-188">Sometimes.**\*\***</span></span>|<span data-ttu-id="ec6f1-189">仅对只读辅助文件可用。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-189">Available only for read-only secondary files.</span></span>|  
  
 <span data-ttu-id="ec6f1-190">**\*** 在 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]</span><span class="sxs-lookup"><span data-stu-id="ec6f1-190">**\*** Available only in the Enterprise edition of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]</span></span>  
  
 <span data-ttu-id="ec6f1-191">**\*\*** 对于所需条件，请参阅本主题后面的 [简单恢复模式下的还原限制](#RMsimpleScenarios)。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-191">**\*\*** For the required conditions, see [Restore Restrictions Under the Simple Recovery Model](#RMsimpleScenarios), later in this topic.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="ec6f1-192">无论数据库的恢复模式如何， [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 备份都无法从早于创建该备份的版本的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 版本还原。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-192">Regardless of the recovery model of a database, a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] backup cannot be restored by a version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that is older than the version that created the backup.</span></span>  
  
##  <a name="restore-scenarios-under-the-simple-recovery-model"></a><a name="RMsimpleScenarios"></a><span data-ttu-id="ec6f1-193">简单恢复模式下的还原方案</span><span class="sxs-lookup"><span data-stu-id="ec6f1-193">Restore Scenarios Under the Simple Recovery Model</span></span>  
 <span data-ttu-id="ec6f1-194">简单恢复模式对还原操作有下列限制：</span><span class="sxs-lookup"><span data-stu-id="ec6f1-194">The simple recovery model imposes the following restrictions on restore operations:</span></span>  
  
-   <span data-ttu-id="ec6f1-195">文件还原和段落还原仅对只读辅助文件组可用。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-195">File restore and piecemeal restore are available only for read-only secondary filegroups.</span></span> <span data-ttu-id="ec6f1-196">有关这些还原方案的信息，请参阅 [文件还原（简单恢复模式）](file-restores-simple-recovery-model.md) 和[段落还原 (SQL Server)](piecemeal-restores-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-196">For information about these restore scenarios, see [File Restores &#40;Simple Recovery Model&#41;](file-restores-simple-recovery-model.md) and [Piecemeal Restores &#40;SQL Server&#41;](piecemeal-restores-sql-server.md).</span></span>  
  
-   <span data-ttu-id="ec6f1-197">不允许进行页面还原。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-197">Page restore is not allowed.</span></span>  
  
-   <span data-ttu-id="ec6f1-198">不支持时点还原。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-198">Point-in-time restore is not allowed.</span></span>  
  
 <span data-ttu-id="ec6f1-199">如果这些限制中有任何不适合于恢复要求的内容，我们建议您考虑使用完整恢复模式。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-199">If any of these restrictions are inappropriate for your recovery needs, we recommend that you consider using the full recovery model.</span></span> <span data-ttu-id="ec6f1-200">有关详细信息，请参阅 [备份概述 (SQL Server)](backup-overview-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-200">For more information, see [Backup Overview &#40;SQL Server&#41;](backup-overview-sql-server.md).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="ec6f1-201">无论数据库的恢复模式如何， [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 备份都无法从早于创建该备份的版本的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 版本还原。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-201">Regardless of the recovery model of a database, a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] backup cannot be restored by a version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that is older than the version that created the backup.</span></span>  
  
##  <a name="restore-under-the-bulk-logged-recovery-model"></a><a name="RMblogRestore"></a> <span data-ttu-id="ec6f1-202">在大容量日志恢复模式下进行还原</span><span class="sxs-lookup"><span data-stu-id="ec6f1-202">Restore Under the Bulk-Logged Recovery Model</span></span>  
 <span data-ttu-id="ec6f1-203">本节讨论特定于大容量日志恢复模式的还原注意事项，大容量日志恢复模式专门用于补充完整恢复模式。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-203">This section discusses restore considerations that are unique to bulk-logged recovery model, which is intended exclusively as a supplement to the full recovery model.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ec6f1-204">有关大容量日志恢复模式的介绍，请参阅[事务日志 (SQL Server)](../logs/the-transaction-log-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-204">For an introduction to the bulk-logged recovery model, see [The Transaction Log &#40;SQL Server&#41;](../logs/the-transaction-log-sql-server.md).</span></span>  
  
 <span data-ttu-id="ec6f1-205">通常，大容量日志恢复模式与完整恢复模式相似，针对完整恢复模式的说明信息对两者都适用。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-205">Generally, the bulk-logged recovery model is similar to the full recovery model, and the information described for the full recovery model also applies to both.</span></span> <span data-ttu-id="ec6f1-206">但是，大容量日志恢复模式对时点恢复和联机还原存在影响。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-206">However, point-in-time recovery and online restore are affected by the bulk-logged recovery model.</span></span>  
  
### <a name="restrictions-for-point-in-time-recovery"></a><span data-ttu-id="ec6f1-207">对时点恢复的限制</span><span class="sxs-lookup"><span data-stu-id="ec6f1-207">Restrictions for Point-in-time Recovery</span></span>  
 <span data-ttu-id="ec6f1-208">如果在大容量恢复模式下执行的日志备份包含大容量日志更改，则不允许时点恢复。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-208">If a log backup taken under the bulk-logged recovery model contains bulk-logged changes, point-in-time recovery is not allowed.</span></span> <span data-ttu-id="ec6f1-209">试图对包含大容量更改的日志备份执行时点恢复将导致还原操作失败。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-209">Trying to perform point-in-time recovery on a log backup that contains bulk changes will cause the restore operation to fail.</span></span>  
  
### <a name="restrictions-for-online-restore"></a><span data-ttu-id="ec6f1-210">对联机还原的限制</span><span class="sxs-lookup"><span data-stu-id="ec6f1-210">Restrictions for Online Restore</span></span>  
 <span data-ttu-id="ec6f1-211">仅在满足下列条件时，联机还原顺序才有效：</span><span class="sxs-lookup"><span data-stu-id="ec6f1-211">An online restore sequence works only if the following conditions are met:</span></span>  
  
-   <span data-ttu-id="ec6f1-212">在启动还原顺序之前必须执行所有必要的日志备份。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-212">All required log backups must have been taken before the restore sequence starts.</span></span>  
  
-   <span data-ttu-id="ec6f1-213">在启动联机还原顺序之前必须备份大容量更改。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-213">Bulk changes must be backed before starting the online restore sequence.</span></span>  
  
-   <span data-ttu-id="ec6f1-214">如果数据库中存在大容量更改，则所有文件必须处于联机或[失效](remove-defunct-filegroups-sql-server.md)状态。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-214">If bulk changes exist in the database, all files must be either online or[defunct](remove-defunct-filegroups-sql-server.md).</span></span> <span data-ttu-id="ec6f1-215">（这意味着它不再是数据库的一部分。）</span><span class="sxs-lookup"><span data-stu-id="ec6f1-215">(This means that it is no longer part of the database.)</span></span>  
  
 <span data-ttu-id="ec6f1-216">如果这些条件不满足，则联机还原顺序失败。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-216">If these conditions are not met, the online restore sequence fails.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ec6f1-217">建议在启动联机还原之前切换为完整恢复模式。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-217">We recommend switching to the full recovery model before starting an online restore.</span></span> <span data-ttu-id="ec6f1-218">有关详细信息，请参阅[恢复模式 (SQL Server)](recovery-models-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-218">For more information, see [Recovery Models &#40;SQL Server&#41;](recovery-models-sql-server.md).</span></span>  
  
 <span data-ttu-id="ec6f1-219">有关如何执行联机还原的信息，请参阅[联机还原 (SQL Server)](online-restore-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-219">For information about how to perform an online restore, see [Online Restore &#40;SQL Server&#41;](online-restore-sql-server.md).</span></span>  
  
##  <a name="database-recovery-advisor-sql-server-management-studio"></a><a name="DRA"></a> <span data-ttu-id="ec6f1-220">数据库恢复顾问 (SQL Server Management Studio)</span><span class="sxs-lookup"><span data-stu-id="ec6f1-220">Database Recovery Advisor (SQL Server Management Studio)</span></span>  
 <span data-ttu-id="ec6f1-221">数据库恢复顾问简化了制定还原计划的过程，可以很轻松地实现最优的正确还原顺序。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-221">The Database Recovery Advisor facilitates constructing restore plans that implement optimal correct restore sequences.</span></span> <span data-ttu-id="ec6f1-222">很多已知数据库还原问题和客户所要求的增强功能已得到解决。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-222">Many known database restore issues and enhancements requested by customers have been addressed.</span></span> <span data-ttu-id="ec6f1-223">数据库恢复顾问引入的主要增强功能包括：</span><span class="sxs-lookup"><span data-stu-id="ec6f1-223">Major enhancements introduced by the Database Recovery Advisor include the following:</span></span>  
  
-   <span data-ttu-id="ec6f1-224">**还原计划算法：** 用于制定还原计划的算法已得到明显改进，特别是对于复杂的还原方案。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-224">**Restore-plan algorithm:**  The algorithm used to construct restore plans has improved significantly, particularly for complex restore scenarios.</span></span> <span data-ttu-id="ec6f1-225">对于许多边缘案例（包括时点还原中存在分支的情形），处理效率要比以前版本的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]更高。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-225">Many edge cases, including forking scenarios in point-in-time restores, are handled more efficiently than in previous versions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
-   <span data-ttu-id="ec6f1-226">**时间点还原：** 数据库恢复顾问极大地简化了将数据库还原到给定时间点的过程。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-226">**Point-in-time restores:**  The Database Recovery Advisor greatly simplifies restoring a database to a given point in time.</span></span> <span data-ttu-id="ec6f1-227">可视备份时间线明显增强了对时点还原的支持。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-227">A visual backup timeline significantly enhances support for point-in-time restores.</span></span> <span data-ttu-id="ec6f1-228">此可视时间线允许您将合适的时点标识为还原数据库的目标恢复点。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-228">This visual timeline allows you to identify a feasible point in time as the target recovery point for restoring a database.</span></span> <span data-ttu-id="ec6f1-229">时间线简化了遍历有分支恢复路径（跨恢复分支的路径）的过程。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-229">The timeline facilitates traversing a forked recovery path (a path that spans recovery forks).</span></span> <span data-ttu-id="ec6f1-230">给定时点还原计划自动包括与还原到目标时点（日期和时间）相关的备份。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-230">A given point-in-time restore plan automatically includes the backups that are relevant to the restoring to your target point in time (date and time).</span></span> <span data-ttu-id="ec6f1-231">有关详细信息，请参阅[将 SQL Server 数据库还原到某个时间点（完整恢复模式）](restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md)。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-231">For more information, see [Restore a SQL Server Database to a Point in Time &#40;Full Recovery Model&#41;](restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md).</span></span>  
  
 <span data-ttu-id="ec6f1-232">有关详细信息，请参阅下列 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 可管理性博客中有关数据库恢复顾问的信息：</span><span class="sxs-lookup"><span data-stu-id="ec6f1-232">For more information, see about the Database Recovery Advisor, see the following [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Manageability blogs:</span></span>  
  
-   [<span data-ttu-id="ec6f1-233">恢复顾问：简介</span><span class="sxs-lookup"><span data-stu-id="ec6f1-233">Recovery Advisor: An Introduction</span></span>](https://blogs.msdn.com/b/managingsql/archive/2011/07/13/recovery-advisor-an-introduction.aspx)  
  
-   [<span data-ttu-id="ec6f1-234">恢复顾问：使用 SSMS 创建/还原拆分备份</span><span class="sxs-lookup"><span data-stu-id="ec6f1-234">Recovery Advisor: Using SSMS to create/restore split backups</span></span>](https://docs.microsoft.com/archive/blogs/managingsql/recovery-advisor-using-ssms-to-createrestore-split-backups)  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="ec6f1-235">相关内容</span><span class="sxs-lookup"><span data-stu-id="ec6f1-235">Related Content</span></span>  
 <span data-ttu-id="ec6f1-236">无。</span><span class="sxs-lookup"><span data-stu-id="ec6f1-236">None.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ec6f1-237">另请参阅</span><span class="sxs-lookup"><span data-stu-id="ec6f1-237">See Also</span></span>  
 [<span data-ttu-id="ec6f1-238">备份概述 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="ec6f1-238">Backup Overview &#40;SQL Server&#41;</span></span>](backup-overview-sql-server.md)  
  
  
