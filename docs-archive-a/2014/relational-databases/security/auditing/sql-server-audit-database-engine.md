---
title: SQL Server 审核（数据库引擎）| Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: security
ms.topic: conceptual
f1_keywords:
- audit
helpviewer_keywords:
- SQL Server Audit
- audits [SQL Server], SQL Server Audit
ms.assetid: 0c1fca2e-f22b-4fe8-806f-c87806664f00
author: VanMSFT
ms.author: vanto
ms.openlocfilehash: 2f4f291e5dc4aaa8a240757713cc65bd2a6a8230
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87578766"
---
# <a name="sql-server-audit-database-engine"></a><span data-ttu-id="49859-102">SQL Server 审核（数据库引擎）</span><span class="sxs-lookup"><span data-stu-id="49859-102">SQL Server Audit (Database Engine)</span></span>
  <span data-ttu-id="49859-103">“审核”[!INCLUDE[ssDEnoversion](../../../includes/ssdenoversion-md.md)] 实例或单独的数据库涉及到 [!INCLUDE[ssDE](../../../includes/ssde-md.md)] 中发生的跟踪和记录事件。</span><span class="sxs-lookup"><span data-stu-id="49859-103">*Auditing* an instance of the [!INCLUDE[ssDEnoversion](../../../includes/ssdenoversion-md.md)] or an individual database involves tracking and logging events that occur on the [!INCLUDE[ssDE](../../../includes/ssde-md.md)].</span></span> <span data-ttu-id="49859-104">通过[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 审核，您可以创建服务器审核，其中可以包含针对服务器级别事件的服务器审核规范和针对数据库级别事件的数据库审核规范。</span><span class="sxs-lookup"><span data-stu-id="49859-104">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] audit lets you create server audits, which can contain server audit specifications for server level events, and database audit specifications for database level events.</span></span> <span data-ttu-id="49859-105">可将审核的事件写入事件日志或审核文件。</span><span class="sxs-lookup"><span data-stu-id="49859-105">Audited events can be written to the event logs or to audit files.</span></span>  
  
 <span data-ttu-id="49859-106">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]的审核级别有若干种，具体取决于您的安装的政府要求或标准要求。</span><span class="sxs-lookup"><span data-stu-id="49859-106">There are several levels of auditing for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], depending on government or standards requirements for your installation.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="49859-107">审核提供若干必需的工具和进程，用于启用、存储和查看对各个服务器和数据库对象的审核。</span><span class="sxs-lookup"><span data-stu-id="49859-107">Audit provides the tools and processes you must have to enable, store, and view audits on various server and database objects.</span></span>  
  
 <span data-ttu-id="49859-108">您可以记录每个实例的服务器审核操作组，或记录每个数据库的数据库审核操作组或数据库审核操作。</span><span class="sxs-lookup"><span data-stu-id="49859-108">You can record server audit action groups per-instance, and either database audit action groups or database audit actions per database.</span></span> <span data-ttu-id="49859-109">在每次遇到可审核操作时，都将发生审核事件。</span><span class="sxs-lookup"><span data-stu-id="49859-109">The audit event will occur every time that the auditable action is encountered.</span></span>  
  
 <span data-ttu-id="49859-110">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 的所有版本均支持服务器级审核。</span><span class="sxs-lookup"><span data-stu-id="49859-110">All editions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] support server level audits.</span></span> <span data-ttu-id="49859-111">数据库级审核限制为 Enterprise、Developer 和 Evaluation 版本。</span><span class="sxs-lookup"><span data-stu-id="49859-111">Database level auditing is limited to Enterprise, Developer, and Evaluation editions.</span></span> <span data-ttu-id="49859-112">有关详细信息，请参阅 [Features Supported by the Editions of SQL Server 2014](../../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md)。</span><span class="sxs-lookup"><span data-stu-id="49859-112">For more information, see [Features Supported by the Editions of SQL Server 2014](../../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md).</span></span>  
  
## <a name="sql-server-audit-components"></a><span data-ttu-id="49859-113">SQL Server 审核组件</span><span class="sxs-lookup"><span data-stu-id="49859-113">SQL Server Audit Components</span></span>  
 <span data-ttu-id="49859-114"> “审核”是将若干元素组合到一个包中，用于执行一组特定服务器操作或数据库操作。</span><span class="sxs-lookup"><span data-stu-id="49859-114">An *audit* is the combination of several elements into a single package for a specific group of server actions or database actions.</span></span> <span data-ttu-id="49859-115">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 审核的组件组合生成的输出就称为审核，就如同报表定义与图形和数据元素组合生成报表一样。</span><span class="sxs-lookup"><span data-stu-id="49859-115">The components of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] audit combine to produce an output that is called an audit, just as a report definition combined with graphics and data elements produces a report.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="49859-116">审核使用“扩展事件”  以帮助创建审核。</span><span class="sxs-lookup"><span data-stu-id="49859-116">audit uses *Extended Events* to help create an audit.</span></span> <span data-ttu-id="49859-117">有关扩展事件的详细信息，请参阅 [扩展事件](../../extended-events/extended-events.md)。</span><span class="sxs-lookup"><span data-stu-id="49859-117">For more information about Extended Events, see [Extended Events](../../extended-events/extended-events.md).</span></span>  
  
### <a name="sql-server-audit"></a><span data-ttu-id="49859-118">SQL Server 审核</span><span class="sxs-lookup"><span data-stu-id="49859-118">SQL Server Audit</span></span>  
 <span data-ttu-id="49859-119">“SQL Server 审核”  对象收集单个服务器实例或数据库级操作和操作组以进行监视。</span><span class="sxs-lookup"><span data-stu-id="49859-119">The *SQL Server Audit* object collects a single instance of server or database-level actions and groups of actions to monitor.</span></span> <span data-ttu-id="49859-120">这种审核处于 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例级别。</span><span class="sxs-lookup"><span data-stu-id="49859-120">The audit is at the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance level.</span></span> <span data-ttu-id="49859-121">每个 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例可以具有多个审核。</span><span class="sxs-lookup"><span data-stu-id="49859-121">You can have multiple audits per [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance.</span></span>  
  
 <span data-ttu-id="49859-122">定义审核时，将指定结果的输出位置。</span><span class="sxs-lookup"><span data-stu-id="49859-122">When you define an audit, you specify the location for the output of the results.</span></span> <span data-ttu-id="49859-123">这是审核的目标位置。</span><span class="sxs-lookup"><span data-stu-id="49859-123">This is the audit destination.</span></span> <span data-ttu-id="49859-124">审核是在 *禁用* 状态下创建的，因此不会自动审核任何操作。</span><span class="sxs-lookup"><span data-stu-id="49859-124">The audit is created in a *disabled* state, and does not automatically audit any actions.</span></span> <span data-ttu-id="49859-125">启用审核后，审核目标将从审核接收数据。</span><span class="sxs-lookup"><span data-stu-id="49859-125">After the audit is enabled, the audit destination receives data from the audit.</span></span>  
  
### <a name="server-audit-specification"></a><span data-ttu-id="49859-126">服务器审核规范</span><span class="sxs-lookup"><span data-stu-id="49859-126">Server Audit Specification</span></span>  
 <span data-ttu-id="49859-127">“服务器审核规范”  对象属于审核。</span><span class="sxs-lookup"><span data-stu-id="49859-127">The *Server Audit Specification* object belongs to an audit.</span></span> <span data-ttu-id="49859-128">您可以为每个审核创建一个服务器审核规范，因为它们都是在 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例范围内创建的。</span><span class="sxs-lookup"><span data-stu-id="49859-128">You can create one server audit specification per audit, because both are created at the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance scope.</span></span>  
  
 <span data-ttu-id="49859-129">服务器审核规范可收集许多由扩展事件功能引发的服务器级操作组。</span><span class="sxs-lookup"><span data-stu-id="49859-129">The server audit specification collects many server-level action groups raised by the Extended Events feature.</span></span> <span data-ttu-id="49859-130">您可以在服务器审核规范中包括“审核操作组”  。</span><span class="sxs-lookup"><span data-stu-id="49859-130">You can include *audit action groups* in a server audit specification.</span></span> <span data-ttu-id="49859-131">审核操作组是预定义的操作组，它们是 [!INCLUDE[ssDE](../../../includes/ssde-md.md)]中发生的原子事件。</span><span class="sxs-lookup"><span data-stu-id="49859-131">Audit action groups are predefined groups of actions, which are atomic events occurring in the [!INCLUDE[ssDE](../../../includes/ssde-md.md)].</span></span> <span data-ttu-id="49859-132">这些操作将发送到审核，审核将它们记录到目标中。</span><span class="sxs-lookup"><span data-stu-id="49859-132">These actions are sent to the audit, which records them in the target.</span></span>  
  
 <span data-ttu-id="49859-133">[SQL Server 审核操作组和操作](sql-server-audit-action-groups-and-actions.md)主题介绍了服务器级别审核操作组。</span><span class="sxs-lookup"><span data-stu-id="49859-133">Server-level audit action groups are described in the topic [SQL Server Audit Action Groups and Actions](sql-server-audit-action-groups-and-actions.md).</span></span>  
  
### <a name="database-audit-specification"></a><span data-ttu-id="49859-134">数据库审核规范</span><span class="sxs-lookup"><span data-stu-id="49859-134">Database Audit Specification</span></span>  
 <span data-ttu-id="49859-135">“数据库审核规范”  对象也属于 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 审核。</span><span class="sxs-lookup"><span data-stu-id="49859-135">The *Database Audit Specification* object also belongs to a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] audit.</span></span> <span data-ttu-id="49859-136">针对每个审核，您可以为每个 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 数据库创建一个数据库审核规范。</span><span class="sxs-lookup"><span data-stu-id="49859-136">You can create one database audit specification per [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database per audit.</span></span>  
  
 <span data-ttu-id="49859-137">数据库审核规范可收集由扩展事件功能引发的数据库级审核操作。</span><span class="sxs-lookup"><span data-stu-id="49859-137">The database audit specification collects database-level audit actions raised by the Extended Events feature.</span></span> <span data-ttu-id="49859-138">你可以向数据库审核规范添加审核操作组或审核事件。</span><span class="sxs-lookup"><span data-stu-id="49859-138">You can add either audit action groups or audit events to a database audit specification.</span></span> <span data-ttu-id="49859-139">*审核事件* 是可以由 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 引擎审核的原子操作。</span><span class="sxs-lookup"><span data-stu-id="49859-139">*Audit events* are the atomic actions that can be audited by the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] engine.</span></span> <span data-ttu-id="49859-140"> “审核操作组”是预定义的操作组。</span><span class="sxs-lookup"><span data-stu-id="49859-140">*Audit action groups* are predefined groups of actions.</span></span> <span data-ttu-id="49859-141">它们都位于 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 数据库作用域。</span><span class="sxs-lookup"><span data-stu-id="49859-141">Both are at the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database scope.</span></span> <span data-ttu-id="49859-142">这些操作将发送到审核，审核将它们记录到目标中。</span><span class="sxs-lookup"><span data-stu-id="49859-142">These actions are sent to the audit, which records them in the target.</span></span> <span data-ttu-id="49859-143">在用户数据库审核规范中不要包括服务器范围的对象，例如系统视图。</span><span class="sxs-lookup"><span data-stu-id="49859-143">Do not include server-scoped objects, such as the system views, in a user database audit specification.</span></span>  
  
 <span data-ttu-id="49859-144">[SQL Server 审核操作组和操作](sql-server-audit-action-groups-and-actions.md)主题介绍了数据库级别的审核操作组和审核操作。</span><span class="sxs-lookup"><span data-stu-id="49859-144">Database-level audit action groups and audit actions are described in the topic [SQL Server Audit Action Groups and Actions](sql-server-audit-action-groups-and-actions.md).</span></span>  
  
### <a name="target"></a><span data-ttu-id="49859-145">目标</span><span class="sxs-lookup"><span data-stu-id="49859-145">Target</span></span>  
 <span data-ttu-id="49859-146">审核结果将发送到目标，目标可以是文件、Windows 安全事件日志或 Windows 应用程序事件日志。</span><span class="sxs-lookup"><span data-stu-id="49859-146">The results of an audit are sent to a target, which can be a file, the Windows Security event log, or the Windows Application event log.</span></span> <span data-ttu-id="49859-147">必须定期查看和归档这些日志，以确保目标具有足够的空间来写入更多记录。</span><span class="sxs-lookup"><span data-stu-id="49859-147">Logs must be reviewed and archived periodically to make sure that the target has sufficient space to write additional records.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="49859-148">任何经过身份验证的用户可以读取和写入到 Windows 应用程序事件日志。</span><span class="sxs-lookup"><span data-stu-id="49859-148">Any authenticated user can read and write to the Windows Application event log.</span></span> <span data-ttu-id="49859-149">应用程序事件日志要求的权限比 Windows 安全事件日志低，安全性低于 Windows 安全事件日志。</span><span class="sxs-lookup"><span data-stu-id="49859-149">The Application event log requires lower permissions than the Windows Security event log and is less secure than the Windows Security event log.</span></span>  
  
 <span data-ttu-id="49859-150">必须将 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 服务帐户应添加到 **生成安全审核** 策略中才能写入 Windows 安全日志。</span><span class="sxs-lookup"><span data-stu-id="49859-150">Writing to the Windows Security log requires the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] service account to be added to the **Generate security audits** policy.</span></span> <span data-ttu-id="49859-151">默认情况下，本地系统、本地服务和网络服务都是此策略的一部分。</span><span class="sxs-lookup"><span data-stu-id="49859-151">By default, the Local System, Local Service, and Network Service are part of this policy.</span></span> <span data-ttu-id="49859-152">此设置可通过使用安全策略管理单元 (secpol.msc) 配置。</span><span class="sxs-lookup"><span data-stu-id="49859-152">This setting can be configured by using the security policy snap-in (secpol.msc).</span></span> <span data-ttu-id="49859-153">此外，对于“成功”  和“失败”  均必须启用“审核对象访问” 安全策略。</span><span class="sxs-lookup"><span data-stu-id="49859-153">Additionally, the **Audit object access** security policy must be enabled for both **Success** and **Failure**.</span></span> <span data-ttu-id="49859-154">此设置可通过使用安全策略管理单元 (secpol.msc) 配置。</span><span class="sxs-lookup"><span data-stu-id="49859-154">This setting can be configured by using the security policy snap-in (secpol.msc).</span></span> <span data-ttu-id="49859-155">在 [!INCLUDE[wiprlhext](../../../includes/wiprlhext-md.md)] 或 Windows Server 2008 中，可以通过使用审核策略程序 (，从命令行设置更详细的**应用程序生成**策略 `AuditPol.exe)` 。</span><span class="sxs-lookup"><span data-stu-id="49859-155">In [!INCLUDE[wiprlhext](../../../includes/wiprlhext-md.md)] or Windows Server 2008, you can set the more granular **application generated** policy from the command line by using the audit policy program (`AuditPol.exe)`.</span></span> <span data-ttu-id="49859-156">有关启用 Windows 安全日志写入的步骤的详细信息，请参阅 [将 SQL Server 审核事件写入安全日志](write-sql-server-audit-events-to-the-security-log.md)。</span><span class="sxs-lookup"><span data-stu-id="49859-156">For more information about the steps to enable writing to the Windows Security log, see [Write SQL Server Audit Events to the Security Log](write-sql-server-audit-events-to-the-security-log.md).</span></span> <span data-ttu-id="49859-157">有关 Auditpol.exe 程序的详细信息，请参阅知识库文章 921469 [如何使用组策略配置详细的安全审核设置](https://support.microsoft.com/kb/921469/)。</span><span class="sxs-lookup"><span data-stu-id="49859-157">For more information about the Auditpol.exe program, see Knowledge Base article 921469, [How to use Group Policy to configure detailed security auditing](https://support.microsoft.com/kb/921469/).</span></span> <span data-ttu-id="49859-158">Windows 事件日志对于 Windows 操作系统具有全局性。</span><span class="sxs-lookup"><span data-stu-id="49859-158">The Windows event logs are global to the Windows operating system.</span></span> <span data-ttu-id="49859-159">有关 Windows 事件日志的详细信息，请参阅 [事件查看器概述](https://go.microsoft.com/fwlink/?LinkId=101455)。</span><span class="sxs-lookup"><span data-stu-id="49859-159">For more information about the Windows event logs, see [Event Viewer Overview](https://go.microsoft.com/fwlink/?LinkId=101455).</span></span> <span data-ttu-id="49859-160">如果需要关于审核的更精准权限，请使用二进制文件目标。</span><span class="sxs-lookup"><span data-stu-id="49859-160">If you need more precise permissions on the audit, use the binary file target.</span></span>  
  
 <span data-ttu-id="49859-161">在您将审核信息保存到某一文件时，为了帮助避免被篡改，可以通过以下方式限制对文件位置的访问：</span><span class="sxs-lookup"><span data-stu-id="49859-161">When you are saving audit information to a file, to help prevent tampering, you can restrict access to the file location in the following ways:</span></span>  
  
-   <span data-ttu-id="49859-162">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 服务帐户必须同时具有读取和写入权限。</span><span class="sxs-lookup"><span data-stu-id="49859-162">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Service Account must have both Read and Write permission.</span></span>  
  
-   <span data-ttu-id="49859-163">审核管理员通常需要读取和写入权限。</span><span class="sxs-lookup"><span data-stu-id="49859-163">Audit Administrators typically require Read and Write permission.</span></span> <span data-ttu-id="49859-164">这就假设审核管理员是 Windows 帐户，可以管理审核文件（例如，将审核文件复制到其他共享、备份这些文件等等）。</span><span class="sxs-lookup"><span data-stu-id="49859-164">This assumes that the Audit Administrators are Windows accounts for administration of audit files, such as: copying them to different shares, backing them up, and so on.</span></span>  
  
-   <span data-ttu-id="49859-165">获得授权可读取审核文件的审核读取者必须具有读取权限。</span><span class="sxs-lookup"><span data-stu-id="49859-165">Audit Readers that are authorized to read audit files must have Read permission.</span></span>  
  
 <span data-ttu-id="49859-166">甚至当 [!INCLUDE[ssDE](../../../includes/ssde-md.md)] 正在写入某个文件时，其他 Windows 用户如果具有权限，也可以读取该审核文件。</span><span class="sxs-lookup"><span data-stu-id="49859-166">Even when the [!INCLUDE[ssDE](../../../includes/ssde-md.md)] is writing to a file, other Windows users can read the audit file if they have permission.</span></span> <span data-ttu-id="49859-167">[!INCLUDE[ssDE](../../../includes/ssde-md.md)] 并未采用排他锁来防止读取操作。</span><span class="sxs-lookup"><span data-stu-id="49859-167">The [!INCLUDE[ssDE](../../../includes/ssde-md.md)] does not take an exclusive lock that prevents read operations.</span></span>  
  
 <span data-ttu-id="49859-168">因为 [!INCLUDE[ssDE](../../../includes/ssde-md.md)] 可以访问文件，所以，具有 CONTROL SERVER 权限的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 登录名可以使用 [!INCLUDE[ssDE](../../../includes/ssde-md.md)] 来访问审核文件。</span><span class="sxs-lookup"><span data-stu-id="49859-168">Because the [!INCLUDE[ssDE](../../../includes/ssde-md.md)] can access the file, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] logins that have CONTROL SERVER permission can use the [!INCLUDE[ssDE](../../../includes/ssde-md.md)] to access the audit files.</span></span> <span data-ttu-id="49859-169">若要记录任何正在读取审核文件的用户，请在 master.sys.fn_get_audit_file 中定义审核。</span><span class="sxs-lookup"><span data-stu-id="49859-169">To record any user that is reading the audit file, define an audit on master.sys.fn_get_audit_file.</span></span> <span data-ttu-id="49859-170">这将记录具有 CONTROL SERVER 权限且已通过 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]访问审核文件的登录名。</span><span class="sxs-lookup"><span data-stu-id="49859-170">This records the logins with CONTROL SERVER permission that have accessed the audit file through [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
 <span data-ttu-id="49859-171">如果审核管理员将文件复制到其他位置（用于存档等），新位置的 ACL 应降至以下权限：</span><span class="sxs-lookup"><span data-stu-id="49859-171">If an Audit Administrator copies the file to a different location (for archive purposes, and so on), the ACLs on the new location should be reduced to the following permissions:</span></span>  
  
-   <span data-ttu-id="49859-172">审核管理员 - 读/写</span><span class="sxs-lookup"><span data-stu-id="49859-172">Audit Administrator - Read / Write</span></span>  
  
-   <span data-ttu-id="49859-173">审核读取者 - 读</span><span class="sxs-lookup"><span data-stu-id="49859-173">Audit Reader - Read</span></span>  
  
 <span data-ttu-id="49859-174">建议您从 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]的单独实例（例如， [!INCLUDE[ssExpress](../../../includes/ssexpress-md.md)]的单独实例）生成审核报告（如果只有审核管理员或审核读取者可以访问此实例）。</span><span class="sxs-lookup"><span data-stu-id="49859-174">We recommend that you generate audit reports from a separate instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], such as an instance of [!INCLUDE[ssExpress](../../../includes/ssexpress-md.md)], to which only Audit Administrators or Audit Readers have access.</span></span> <span data-ttu-id="49859-175">通过使用 [!INCLUDE[ssDE](../../../includes/ssde-md.md)] 的单独实例进行报告，可以帮助防止未获授权的用户访问审核记录。</span><span class="sxs-lookup"><span data-stu-id="49859-175">By using a separate instance of the [!INCLUDE[ssDE](../../../includes/ssde-md.md)] for reporting, you can help prevent unauthorized users from obtaining access to the audit record.</span></span>  
  
 <span data-ttu-id="49859-176">可以通过使用 Windows BitLocker 数据加密或 Windows 加密文件系统对存储审核文件的文件夹进行加密，从而提供附加保护机制来防止未授权访问。</span><span class="sxs-lookup"><span data-stu-id="49859-176">You can offer additional protection against unauthorized access by encrypting the folder in which the audit file is stored by using Windows BitLocker Drive Encryption or Windows Encrypting File System.</span></span>  
  
 <span data-ttu-id="49859-177">有关写入目标的审核记录的详细信息，请参阅 [SQL Server Audit Records](sql-server-audit-records.md)。</span><span class="sxs-lookup"><span data-stu-id="49859-177">For more information about the audit records that are written to the target, see [SQL Server Audit Records](sql-server-audit-records.md).</span></span>  
  
## <a name="overview-of-using-sql-server-audit"></a><span data-ttu-id="49859-178">使用 SQL Server 审核概述</span><span class="sxs-lookup"><span data-stu-id="49859-178">Overview of Using SQL Server Audit</span></span>  
 <span data-ttu-id="49859-179">可以使用 [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] 或 [!INCLUDE[tsql](../../../includes/tsql-md.md)] 定义审核。</span><span class="sxs-lookup"><span data-stu-id="49859-179">You can use [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] or [!INCLUDE[tsql](../../../includes/tsql-md.md)] to define an audit.</span></span> <span data-ttu-id="49859-180">在创建并启用审核后，目标将接收各项。</span><span class="sxs-lookup"><span data-stu-id="49859-180">After the audit is created and enabled, the target will receive entries.</span></span>  
  
 <span data-ttu-id="49859-181">您可以使用 Windows 中的 **“事件查看器”** 实用工具来读取 Windows 事件。</span><span class="sxs-lookup"><span data-stu-id="49859-181">You can read the Windows event logs by using the **Event Viewer** utility in Windows.</span></span> <span data-ttu-id="49859-182">对于文件目标，你可以使用 **中的“日志文件查看器”** [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] 或 [fn_get_audit_file](/sql/relational-databases/system-functions/sys-fn-get-audit-file-transact-sql) 函数来读取目标文件。</span><span class="sxs-lookup"><span data-stu-id="49859-182">For file targets, you can use either the **Log File Viewer** in [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] or the [fn_get_audit_file](/sql/relational-databases/system-functions/sys-fn-get-audit-file-transact-sql) function to read the target file.</span></span>  
  
 <span data-ttu-id="49859-183">以下是创建和使用审核的一般过程。</span><span class="sxs-lookup"><span data-stu-id="49859-183">The general process for creating and using an audit is as follows.</span></span>  
  
1.  <span data-ttu-id="49859-184">创建审核并定义目标。</span><span class="sxs-lookup"><span data-stu-id="49859-184">Create an audit and define the target.</span></span>  
  
2.  <span data-ttu-id="49859-185">创建映射到审核的服务器审核规范或数据库审核规范。</span><span class="sxs-lookup"><span data-stu-id="49859-185">Create either a server audit specification or database audit specification that maps to the audit.</span></span> <span data-ttu-id="49859-186">启用审核规范。</span><span class="sxs-lookup"><span data-stu-id="49859-186">Enable the audit specification.</span></span>  
  
3.  <span data-ttu-id="49859-187">启用审核。</span><span class="sxs-lookup"><span data-stu-id="49859-187">Enable the audit.</span></span>  
  
4.  <span data-ttu-id="49859-188">通过使用 Windows“事件查看器” 、“日志文件查看器” 或 fn_get_audit_file 函数来读取审核事件。</span><span class="sxs-lookup"><span data-stu-id="49859-188">Read the audit events by using the Windows **Event Viewer**, **Log File Viewe**r, or the fn_get_audit_file function.</span></span>  
  
 <span data-ttu-id="49859-189">有关详细信息，请参阅 [创建服务器审核和服务器审核规范](create-a-server-audit-and-server-audit-specification.md) 和 [创建服务器审核和数据库审核规范](create-a-server-audit-and-database-audit-specification.md)。</span><span class="sxs-lookup"><span data-stu-id="49859-189">For more information, see [Create a Server Audit and Server Audit Specification](create-a-server-audit-and-server-audit-specification.md) and [Create a Server Audit and Database Audit Specification](create-a-server-audit-and-database-audit-specification.md).</span></span>  
  
## <a name="considerations"></a><span data-ttu-id="49859-190">注意事项</span><span class="sxs-lookup"><span data-stu-id="49859-190">Considerations</span></span>  
 <span data-ttu-id="49859-191">如果在启动审核期间出现问题，则服务器将不会启动。</span><span class="sxs-lookup"><span data-stu-id="49859-191">In the case of a failure during audit initiation, the server will not start.</span></span> <span data-ttu-id="49859-192">在这种情况下，可以在命令行中使用 -f 选项来启动服务器。</span><span class="sxs-lookup"><span data-stu-id="49859-192">In this case, the server can be started by using the **-f** option at the command line.</span></span>  
  
 <span data-ttu-id="49859-193">如果由于为审核指定了 ON_FAILURE=SHUTDOWN 而使得审核失败导致服务器关闭或不启动，则 MSG_AUDIT_FORCED_SHUTDOWN 事件将写入日志。</span><span class="sxs-lookup"><span data-stu-id="49859-193">When an audit failure causes the server to shut down or not to start because ON_FAILURE=SHUTDOWN is specified for the audit, the MSG_AUDIT_FORCED_SHUTDOWN event will be written to the log.</span></span> <span data-ttu-id="49859-194">由于在第一次遇到此设置时将出现关机，此事件将写入一次。</span><span class="sxs-lookup"><span data-stu-id="49859-194">Because the shutdown will occur on the first encounter of this setting, the event will be written one time.</span></span> <span data-ttu-id="49859-195">在出现有关审核导致关闭的失败消息后，将写入此事件。</span><span class="sxs-lookup"><span data-stu-id="49859-195">This event is written after the failure message for the audit causing the shutdown.</span></span> <span data-ttu-id="49859-196">管理员可以使用 -m 标志以单用户模式启动 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]，从而绕过审核引起的关闭。</span><span class="sxs-lookup"><span data-stu-id="49859-196">An administrator can bypass audit-induced shutdowns by starting [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] in Single User mode using the **-m** flag.</span></span> <span data-ttu-id="49859-197">如果在单用户模式下启动，则会将指定了 ON_FAILURE=SHUTDOWN 的任何审核降级为在相应会话中以 ON_FAILURE=CONTINUE 运行。</span><span class="sxs-lookup"><span data-stu-id="49859-197">If you start in Single User mode, you will downgrade any audit where ON_FAILURE=SHUTDOWN is specified to run in that session as ON_FAILURE=CONTINUE.</span></span> <span data-ttu-id="49859-198">使用 -m 标志启动 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 时，MSG_AUDIT_SHUTDOWN_BYPASSED 消息将写入错误日志。</span><span class="sxs-lookup"><span data-stu-id="49859-198">When [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is started by using the **-m** flag, the MSG_AUDIT_SHUTDOWN_BYPASSED message will be written to the error log.</span></span>  
  
 <span data-ttu-id="49859-199">有关服务启动选项的详细信息，请参阅 [数据库引擎服务启动选项](../../../database-engine/configure-windows/database-engine-service-startup-options.md)。</span><span class="sxs-lookup"><span data-stu-id="49859-199">For more information about service startup options, see [Database Engine Service Startup Options](../../../database-engine/configure-windows/database-engine-service-startup-options.md).</span></span>  
  
### <a name="attaching-a-database-with-an-audit-defined"></a><span data-ttu-id="49859-200">将数据库附加到已定义的审核</span><span class="sxs-lookup"><span data-stu-id="49859-200">Attaching a Database with an Audit Defined</span></span>  
 <span data-ttu-id="49859-201">如果附加的数据库具有审核规范并且指定的 GUID 在服务器上不存在，则将导致“  孤立”审核规范。</span><span class="sxs-lookup"><span data-stu-id="49859-201">Attaching a database that has an audit specification and specifies a GUID that does not exist on the server will cause an *orphaned* audit specification.</span></span> <span data-ttu-id="49859-202">因为服务器实例上不存在具有匹配 GUID 的审核，所以将不记录审核事件。</span><span class="sxs-lookup"><span data-stu-id="49859-202">Because an audit with a matching GUID does not exist on the server instance, no audit events will be recorded.</span></span> <span data-ttu-id="49859-203">若要更正此情况，请使用 ALTER DATABASE AUDIT SPECIFICATION 命令将孤立审核规范连接到现有服务器审核。</span><span class="sxs-lookup"><span data-stu-id="49859-203">To correct this situation, use the ALTER DATABASE AUDIT SPECIFICATION command to connect the orphaned audit specification to an existing server audit.</span></span> <span data-ttu-id="49859-204">或者，使用 CREATE SERVER AUDIT 命令创建一个具有指定 GUID 的新服务器审核。</span><span class="sxs-lookup"><span data-stu-id="49859-204">Or, use the CREATE SERVER AUDIT command to create a new server audit with the specified GUID.</span></span>  
  
 <span data-ttu-id="49859-205">您可以将定义了审核规范的数据库连接到不支持 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 审核的另一 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 版本，如 [!INCLUDE[ssExpress](../../../includes/ssexpress-md.md)] ，但它不会记录审核事件。</span><span class="sxs-lookup"><span data-stu-id="49859-205">You can attach a database that has an audit specification defined on it to another edition of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] that does not support [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] audit, such as [!INCLUDE[ssExpress](../../../includes/ssexpress-md.md)] but it will not record audit events.</span></span>  
  
### <a name="database-mirroring-and-sql-server-audit"></a><span data-ttu-id="49859-206">数据库镜像和 SQL Server 审核</span><span class="sxs-lookup"><span data-stu-id="49859-206">Database Mirroring and SQL Server Audit</span></span>  
 <span data-ttu-id="49859-207">已定义了数据库审核规范并使用数据库镜像的数据库将包括此数据库审核规范。</span><span class="sxs-lookup"><span data-stu-id="49859-207">A database that has a database audit specification defined and that uses database mirroring will include the database audit specification.</span></span> <span data-ttu-id="49859-208">若要对已镜像的 SQL 实例进行正确的处理，必须配置下列项：</span><span class="sxs-lookup"><span data-stu-id="49859-208">To work correctly on the mirrored SQL instance, the following items must be configured:</span></span>  
  
-   <span data-ttu-id="49859-209">镜像服务器必须拥有具有相同 GUID 的审核才能使数据库审核规范能够写入审核记录。</span><span class="sxs-lookup"><span data-stu-id="49859-209">The mirror server must have an audit with the same GUID to enable the database audit specification to write audit records.</span></span> <span data-ttu-id="49859-210">这可以通过使用命令 CREATE AUDIT WITH GUID 来进行配置 `=` \* \<GUID from source Server Audit*> 。</span><span class="sxs-lookup"><span data-stu-id="49859-210">This can be configured by using the command CREATE AUDIT WITH GUID`=`\*\<GUID from source Server Audit*>.</span></span>  
  
-   <span data-ttu-id="49859-211">对于二进制文件目标，镜像服务器服务帐户对要写入审核记录的位置必须具有相应的权限。</span><span class="sxs-lookup"><span data-stu-id="49859-211">For binary file targets, the mirror server service account must have appropriate permissions to the location where the audit trail is being written.</span></span>  
  
-   <span data-ttu-id="49859-212">对于 Windows 事件日志目标，镜像服务器所在计算机上的安全策略必须允许服务帐户访问安全事件日志或应用程序事件日志。</span><span class="sxs-lookup"><span data-stu-id="49859-212">For Windows event log targets, the security policy on the computer where the mirror server is located must allow for service account access to the security or application event log.</span></span>  
  
### <a name="auditing-administrators"></a><span data-ttu-id="49859-213">审核管理员</span><span class="sxs-lookup"><span data-stu-id="49859-213">Auditing Administrators</span></span>  
 <span data-ttu-id="49859-214">`sysadmin`固定服务器角色的成员在每个数据库中被标识为**dbo**用户。</span><span class="sxs-lookup"><span data-stu-id="49859-214">Members of the `sysadmin` fixed server role are identified as the **dbo** user in each database.</span></span> <span data-ttu-id="49859-215">若要审核管理员的操作，请审核 **dbo** 用户的操作。</span><span class="sxs-lookup"><span data-stu-id="49859-215">To audit actions of the administrators, audit the actions of the **dbo** user.</span></span>  
  
## <a name="creating-and-managing-audits-with-transact-sql"></a><span data-ttu-id="49859-216">使用 Transact-SQL 创建和管理审核</span><span class="sxs-lookup"><span data-stu-id="49859-216">Creating and Managing Audits with Transact-SQL</span></span>  
 <span data-ttu-id="49859-217">可以使用 DDL 语句、动态管理视图和函数以及目录视图来实现 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 审核的所有方面。</span><span class="sxs-lookup"><span data-stu-id="49859-217">You can use DDL statements, dynamic management views and functions, and catalog views to implement all aspects of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Audit.</span></span>  
  
### <a name="data-definition-language-statements"></a><span data-ttu-id="49859-218">数据定义语言语句</span><span class="sxs-lookup"><span data-stu-id="49859-218">Data Definition Language Statements</span></span>  
 <span data-ttu-id="49859-219">可以使用下列 DDL 语句创建、更改和删除审核规范：</span><span class="sxs-lookup"><span data-stu-id="49859-219">You can use the following DDL statements to create, alter, and drop audit specifications:</span></span>  
  
|||  
|-|-|  
|[<span data-ttu-id="49859-220">ALTER AUTHORIZATION</span><span class="sxs-lookup"><span data-stu-id="49859-220">ALTER AUTHORIZATION</span></span>](/sql/t-sql/statements/alter-authorization-transact-sql)|[<span data-ttu-id="49859-221">CREATE SERVER AUDIT</span><span class="sxs-lookup"><span data-stu-id="49859-221">CREATE SERVER AUDIT</span></span>](/sql/t-sql/statements/create-server-audit-transact-sql)|  
|[<span data-ttu-id="49859-222">ALTER DATABASE AUDIT SPECIFICATION</span><span class="sxs-lookup"><span data-stu-id="49859-222">ALTER DATABASE AUDIT SPECIFICATION</span></span>](/sql/t-sql/statements/alter-database-audit-specification-transact-sql)|[<span data-ttu-id="49859-223">CREATE SERVER AUDIT SPECIFICATION</span><span class="sxs-lookup"><span data-stu-id="49859-223">CREATE SERVER AUDIT SPECIFICATION</span></span>](/sql/t-sql/statements/create-server-audit-specification-transact-sql)|  
|[<span data-ttu-id="49859-224">ALTER SERVER AUDIT</span><span class="sxs-lookup"><span data-stu-id="49859-224">ALTER SERVER AUDIT</span></span>](/sql/t-sql/statements/alter-server-audit-specification-transact-sql)|[<span data-ttu-id="49859-225">DROP DATABASE AUDIT SPECIFICATION</span><span class="sxs-lookup"><span data-stu-id="49859-225">DROP DATABASE AUDIT SPECIFICATION</span></span>](/sql/t-sql/statements/drop-database-encryption-key-transact-sql)|  
|[<span data-ttu-id="49859-226">ALTER SERVER AUDIT SPECIFICATION</span><span class="sxs-lookup"><span data-stu-id="49859-226">ALTER SERVER AUDIT SPECIFICATION</span></span>](/sql/t-sql/statements/alter-server-audit-transact-sql)|[<span data-ttu-id="49859-227">DROP SERVER AUDIT</span><span class="sxs-lookup"><span data-stu-id="49859-227">DROP SERVER AUDIT</span></span>](/sql/t-sql/statements/drop-server-audit-transact-sql)|  
|[<span data-ttu-id="49859-228">CREATE DATABASE AUDIT SPECIFICATION</span><span class="sxs-lookup"><span data-stu-id="49859-228">CREATE DATABASE AUDIT SPECIFICATION</span></span>](/sql/t-sql/statements/create-database-audit-specification-transact-sql)|[<span data-ttu-id="49859-229">DROP SERVER AUDIT SPECIFICATION</span><span class="sxs-lookup"><span data-stu-id="49859-229">DROP SERVER AUDIT SPECIFICATION</span></span>](/sql/t-sql/statements/drop-server-audit-specification-transact-sql)|  
  
### <a name="dynamic-views-and-functions"></a><span data-ttu-id="49859-230">动态视图和函数</span><span class="sxs-lookup"><span data-stu-id="49859-230">Dynamic Views and Functions</span></span>  
 <span data-ttu-id="49859-231">下表列出了可用于 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 审核的动态视图和函数。</span><span class="sxs-lookup"><span data-stu-id="49859-231">The following table lists the dynamic views and function that you can use for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Auditing.</span></span>  
  
|<span data-ttu-id="49859-232">动态视图和函数</span><span class="sxs-lookup"><span data-stu-id="49859-232">Dynamic views and functions</span></span>|<span data-ttu-id="49859-233">说明</span><span class="sxs-lookup"><span data-stu-id="49859-233">Description</span></span>|  
|---------------------------------|-----------------|  
|[<span data-ttu-id="49859-234">sys.dm_audit_actions</span><span class="sxs-lookup"><span data-stu-id="49859-234">sys.dm_audit_actions</span></span>](/sql/relational-databases/system-dynamic-management-views/sys-dm-audit-actions-transact-sql)|<span data-ttu-id="49859-235">为可在审核日志中报告的每项审核操作以及可配置为 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Audit 一部分的每个审核操作组返回一行。</span><span class="sxs-lookup"><span data-stu-id="49859-235">Returns a row for every audit action that can be reported in the audit log and every audit action group that can be configured as part of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Audit.</span></span>|  
|[<span data-ttu-id="49859-236">sys.dm_server_audit_status</span><span class="sxs-lookup"><span data-stu-id="49859-236">sys.dm_server_audit_status</span></span>](/sql/relational-databases/system-dynamic-management-views/sys-dm-server-audit-status-transact-sql)|<span data-ttu-id="49859-237">提供有关当前审核状态的信息。</span><span class="sxs-lookup"><span data-stu-id="49859-237">Provides information about the current state of the audit.</span></span>|  
|[<span data-ttu-id="49859-238">sys.dm_audit_class_type_map</span><span class="sxs-lookup"><span data-stu-id="49859-238">sys.dm_audit_class_type_map</span></span>](/sql/relational-databases/system-dynamic-management-views/sys-dm-audit-class-type-map-transact-sql)|<span data-ttu-id="49859-239">返回一个表，将审核日志中的 class_type 字段映射到 sys.dm_audit_actions 中的 class_desc 字段。</span><span class="sxs-lookup"><span data-stu-id="49859-239">Returns a table that maps the class_type field in the audit log to the class_desc field in sys.dm_audit_actions.</span></span>|  
|[<span data-ttu-id="49859-240">fn_get_audit_file</span><span class="sxs-lookup"><span data-stu-id="49859-240">fn_get_audit_file</span></span>](/sql/relational-databases/system-functions/sys-fn-get-audit-file-transact-sql)|<span data-ttu-id="49859-241">从由服务器审核创建的审核文件返回信息。</span><span class="sxs-lookup"><span data-stu-id="49859-241">Returns information from an audit file created by a server audit.</span></span>|  
  
### <a name="catalog-views"></a><span data-ttu-id="49859-242">目录视图</span><span class="sxs-lookup"><span data-stu-id="49859-242">Catalog Views</span></span>  
 <span data-ttu-id="49859-243">下表列出了可用于 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 审核的目录视图。</span><span class="sxs-lookup"><span data-stu-id="49859-243">The following table lists the catalog views that you can use for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] auditing.</span></span>  
  
|<span data-ttu-id="49859-244">目录视图</span><span class="sxs-lookup"><span data-stu-id="49859-244">Catalog views</span></span>|<span data-ttu-id="49859-245">说明</span><span class="sxs-lookup"><span data-stu-id="49859-245">Description</span></span>|  
|-------------------|-----------------|  
|[<span data-ttu-id="49859-246">sys.database_ audit_specifications</span><span class="sxs-lookup"><span data-stu-id="49859-246">sys.database_ audit_specifications</span></span>](/sql/relational-databases/system-catalog-views/sys-database-audit-specifications-transact-sql)|<span data-ttu-id="49859-247">包含服务器实例上的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 审核中的数据库审核规范的相关信息。</span><span class="sxs-lookup"><span data-stu-id="49859-247">Contains information about the database audit specifications in a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] audit on a server instance.</span></span>|  
|[<span data-ttu-id="49859-248">sys.database_audit_specification_details</span><span class="sxs-lookup"><span data-stu-id="49859-248">sys.database_audit_specification_details</span></span>](/sql/relational-databases/system-catalog-views/sys-database-audit-specification-details-transact-sql)|<span data-ttu-id="49859-249">包含所有数据库的服务器实例上 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 审核中的数据库审核规范的相关信息。</span><span class="sxs-lookup"><span data-stu-id="49859-249">Contains information about the database audit specifications in a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] audit on a server instance for all databases.</span></span>|  
|[<span data-ttu-id="49859-250">sys.server_audits</span><span class="sxs-lookup"><span data-stu-id="49859-250">sys.server_audits</span></span>](/sql/relational-databases/system-catalog-views/sys-server-audits-transact-sql)|<span data-ttu-id="49859-251">服务器实例中每个 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 审核都各占一行。</span><span class="sxs-lookup"><span data-stu-id="49859-251">Contains one row for each [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] audit in a server instance.</span></span>|  
|[<span data-ttu-id="49859-252">sys.server_audit_specifications</span><span class="sxs-lookup"><span data-stu-id="49859-252">sys.server_audit_specifications</span></span>](/sql/relational-databases/system-catalog-views/sys-server-audit-specifications-transact-sql)|<span data-ttu-id="49859-253">包含有关服务器实例上 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 审核中的服务器审核规范的信息。</span><span class="sxs-lookup"><span data-stu-id="49859-253">Contains information about the server audit specifications in a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] audit on a server instance.</span></span>|  
|[<span data-ttu-id="49859-254">sys.server_audit_specifications_details</span><span class="sxs-lookup"><span data-stu-id="49859-254">sys.server_audit_specifications_details</span></span>](/sql/relational-databases/system-catalog-views/sys-server-audit-specification-details-transact-sql)|<span data-ttu-id="49859-255">包含服务器实例上的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 审核中的服务器审核规范详细信息（操作）的相关信息。</span><span class="sxs-lookup"><span data-stu-id="49859-255">Contains information about the server audit specification details (actions) in a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] audit on a server instance.</span></span>|  
|[<span data-ttu-id="49859-256">sys.server_file_audits</span><span class="sxs-lookup"><span data-stu-id="49859-256">sys.server_file_audits</span></span>](/sql/relational-databases/system-catalog-views/sys-server-file-audits-transact-sql)|<span data-ttu-id="49859-257">包含有关服务器实例上 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 审核中的文件审核类型的存储扩展信息。</span><span class="sxs-lookup"><span data-stu-id="49859-257">Contains stores extended information about the file audit type in a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] audit on a server instance.</span></span>|  
  
## <a name="permissions"></a><span data-ttu-id="49859-258">权限</span><span class="sxs-lookup"><span data-stu-id="49859-258">Permissions</span></span>  
 <span data-ttu-id="49859-259">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Audit 的每一个功能和命令都有其独特的权限需求。</span><span class="sxs-lookup"><span data-stu-id="49859-259">Each feature and command for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Audit has individual permission requirements.</span></span>  
  
 <span data-ttu-id="49859-260">若要创建、更改或删除服务器审核或服务器审核规范，服务器主体要求具有 ALTER ANY SERVER AUDIT 或 CONTROL SERVER 权限。</span><span class="sxs-lookup"><span data-stu-id="49859-260">To create, alter, or drop a Server Audit or Server Audit Specification, server principals require the ALTER ANY SERVER AUDIT or the CONTROL SERVER permission.</span></span> <span data-ttu-id="49859-261">若要创建、更改或删除数据库审核规范，数据库主体必须具有 ALTER ANY DATABASE AUDIT 权限或针对该数据库的 ALTER 或 CONTROL 权限。</span><span class="sxs-lookup"><span data-stu-id="49859-261">To create, alter, or drop a Database Audit Specification, database principals require the ALTER ANY DATABASE AUDIT permission or the ALTER or CONTROL permission on the database.</span></span> <span data-ttu-id="49859-262">此外，主题还必须具有连接到数据库的权限或者具有 ALTER ANY SERVER AUDIT 或 CONTROL SERVER 权限。</span><span class="sxs-lookup"><span data-stu-id="49859-262">In addition, principals must have permission to connect to the database, or ALTER ANY SERVER AUDIT or CONTROL SERVER permissions.</span></span>  
  
 <span data-ttu-id="49859-263">除非另有规定，否则查看目录视图的操作会要求主体具有以下身份或权限之一：</span><span class="sxs-lookup"><span data-stu-id="49859-263">Unless otherwise specified, viewing catalog views requires a principal to have one of the following:</span></span>  
  
-   <span data-ttu-id="49859-264">sysadmin 固定服务器角色成员身份。</span><span class="sxs-lookup"><span data-stu-id="49859-264">Membership in the sysadmin fixed server role.</span></span>  
  
-   <span data-ttu-id="49859-265">CONTROL SERVER 权限。</span><span class="sxs-lookup"><span data-stu-id="49859-265">The CONTROL SERVER permission.</span></span>  
  
-   <span data-ttu-id="49859-266">VIEW SERVER STATE 权限。</span><span class="sxs-lookup"><span data-stu-id="49859-266">The VIEW SERVER STATE permission.</span></span>  
  
-   <span data-ttu-id="49859-267">ALTER ANY AUDIT 权限。</span><span class="sxs-lookup"><span data-stu-id="49859-267">The ALTER ANY AUDIT permission.</span></span>  
  
-   <span data-ttu-id="49859-268">VIEW AUDIT STATE 权限（仅允许主体访问 sys.server_audits 目录视图）。</span><span class="sxs-lookup"><span data-stu-id="49859-268">The VIEW AUDIT STATE permission (gives only the principal access to the sys.server_audits catalog view).</span></span>  
  
 <span data-ttu-id="49859-269">若要使用动态管理视图，主体必须具有 VIEW SERVER STATE 或 ALTER ANY AUDIT 权限。</span><span class="sxs-lookup"><span data-stu-id="49859-269">A principal must have the VIEW SERVER STATE or ALTER ANY AUDIT permission to use the Dynamic Management Views.</span></span>  
  
 <span data-ttu-id="49859-270">有关如何授予权限的详细信息，请参阅[GRANT(Transact-SQL)](/sql/t-sql/statements/grant-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="49859-270">For more information about how to grant rights and permissions, see [GRANT &#40;Transact-SQL&#41;](/sql/t-sql/statements/grant-transact-sql).</span></span>  
  
> [!CAUTION]  
>  <span data-ttu-id="49859-271">具有 sysadmin 角色的主体可以篡改任意审核组件；具有 db_owner 角色的主体可以篡改数据库中的审核规范。</span><span class="sxs-lookup"><span data-stu-id="49859-271">Principals in the sysadmin role can tamper with any audit component and those in the db_owner role can tamper with audit specifications in a database.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="49859-272">Audit 将验证将创建或更改审核规范的登录帐户是否至少具有 ALTER ANY DATABASE AUDIT 权限。</span><span class="sxs-lookup"><span data-stu-id="49859-272">Audit will validate that a logon that creates or alters an audit specification has at least the ALTER ANY DATABASE AUDIT permission.</span></span> <span data-ttu-id="49859-273">但是，它不会在您附加数据库时进行验证。</span><span class="sxs-lookup"><span data-stu-id="49859-273">However, it does no validation when you attach a database.</span></span> <span data-ttu-id="49859-274">您应假定所有的数据库审核规范的可信度只是相当于具有 sysadmin 或 db_owner 角色的主体。</span><span class="sxs-lookup"><span data-stu-id="49859-274">You should assume all Database Audit Specifications are only as trustworthy as those principals in the sysadmin or db_owner role.</span></span>  
  
## <a name="related-tasks"></a><span data-ttu-id="49859-275">Related Tasks</span><span class="sxs-lookup"><span data-stu-id="49859-275">Related Tasks</span></span>  
 [<span data-ttu-id="49859-276">创建服务器审核和服务器审核规范</span><span class="sxs-lookup"><span data-stu-id="49859-276">Create a Server Audit and Server Audit Specification</span></span>](create-a-server-audit-and-server-audit-specification.md)  
  
 [<span data-ttu-id="49859-277">创建服务器审核和数据库审核规范</span><span class="sxs-lookup"><span data-stu-id="49859-277">Create a Server Audit and Database Audit Specification</span></span>](create-a-server-audit-and-database-audit-specification.md)  
  
 [<span data-ttu-id="49859-278">查看 SQL Server 审核日志</span><span class="sxs-lookup"><span data-stu-id="49859-278">View a SQL Server Audit Log</span></span>](view-a-sql-server-audit-log.md)  
  
 [<span data-ttu-id="49859-279">将 SQL Server 审核事件写入安全日志</span><span class="sxs-lookup"><span data-stu-id="49859-279">Write SQL Server Audit Events to the Security Log</span></span>](write-sql-server-audit-events-to-the-security-log.md)  
  
## <a name="topics-closely-related-to-auditing"></a><span data-ttu-id="49859-280">与审核密切相关的主题</span><span class="sxs-lookup"><span data-stu-id="49859-280">Topics Closely Related to Auditing</span></span>  
 [<span data-ttu-id="49859-281">服务器属性（“安全性”页）</span><span class="sxs-lookup"><span data-stu-id="49859-281">Server Properties &#40;Security Page&#41;</span></span>](../../../database-engine/configure-windows/server-properties-security-page.md)  
 <span data-ttu-id="49859-282">介绍如何为 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]启用登录审核。</span><span class="sxs-lookup"><span data-stu-id="49859-282">Explains how to turn on login auditing for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="49859-283">审核记录存储在 Windows 应用程序日志中。</span><span class="sxs-lookup"><span data-stu-id="49859-283">The audit records are stored in the Windows application log.</span></span>  
  
 [<span data-ttu-id="49859-284">c2 审核模式服务器配置选项</span><span class="sxs-lookup"><span data-stu-id="49859-284">c2 audit mode Server Configuration Option</span></span>](../../../database-engine/configure-windows/c2-audit-mode-server-configuration-option.md)  
 <span data-ttu-id="49859-285">介绍 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]中的 C2 符合安全标准审核模式。</span><span class="sxs-lookup"><span data-stu-id="49859-285">Explains the C2 security compliance auditing mode in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
 [<span data-ttu-id="49859-286">安全审核事件类别 (SQL Server Profiler)</span><span class="sxs-lookup"><span data-stu-id="49859-286">Security Audit Event Category &#40;SQL Server Profiler&#41;</span></span>](../../../relational-databases/event-classes/security-audit-event-category-sql-server-profiler.md)  
 <span data-ttu-id="49859-287">介绍您可以在 [!INCLUDE[ssSqlProfiler](../../../includes/sssqlprofiler-md.md)]中使用的审核事件。</span><span class="sxs-lookup"><span data-stu-id="49859-287">Explains the audit events you can use in [!INCLUDE[ssSqlProfiler](../../../includes/sssqlprofiler-md.md)].</span></span> <span data-ttu-id="49859-288">有关详细信息，请参阅 [SQL Server Profiler](../../../tools/sql-server-profiler/sql-server-profiler.md)。</span><span class="sxs-lookup"><span data-stu-id="49859-288">For more information, see [SQL Server Profiler](../../../tools/sql-server-profiler/sql-server-profiler.md).</span></span>  
  
 [<span data-ttu-id="49859-289">SQL 跟踪</span><span class="sxs-lookup"><span data-stu-id="49859-289">SQL Trace</span></span>](../../sql-trace/sql-trace.md)  
 <span data-ttu-id="49859-290">介绍如何使用 SQL 跟踪（而不使用 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 事件探查器）从你自己的应用程序中手动创建跟踪。</span><span class="sxs-lookup"><span data-stu-id="49859-290">Explains how SQL Trace can be used from within your own applications to create traces manually, instead of using [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Profiler.</span></span>  
  
 [<span data-ttu-id="49859-291">DDL 触发器</span><span class="sxs-lookup"><span data-stu-id="49859-291">DDL Triggers</span></span>](../../triggers/ddl-triggers.md)  
 <span data-ttu-id="49859-292">介绍如何使用数据定义语言 (DDL) 触发器来跟踪对数据库的更改。</span><span class="sxs-lookup"><span data-stu-id="49859-292">Explains how you can use Data Definition Language (DDL) triggers to track changes to your databases.</span></span>  
  
 [<span data-ttu-id="49859-293">Microsoft TechNet：SQL Server 技术中心：SQL Server 2005 安全性和保护</span><span class="sxs-lookup"><span data-stu-id="49859-293">Microsoft TechNet: SQL Server TechCenter: SQL Server 2005 Security and Protection</span></span>](https://go.microsoft.com/fwlink/?LinkId=101152)  
 <span data-ttu-id="49859-294">提供有关 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 安全性的最新信息。</span><span class="sxs-lookup"><span data-stu-id="49859-294">Provides up-to-date information about [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] security.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="49859-295">另请参阅</span><span class="sxs-lookup"><span data-stu-id="49859-295">See Also</span></span>  
 <span data-ttu-id="49859-296">[SQL Server 审核操作组和操作](sql-server-audit-action-groups-and-actions.md) </span><span class="sxs-lookup"><span data-stu-id="49859-296">[SQL Server Audit Action Groups and Actions](sql-server-audit-action-groups-and-actions.md) </span></span>  
 [<span data-ttu-id="49859-297">SQL Server 审核记录</span><span class="sxs-lookup"><span data-stu-id="49859-297">SQL Server Audit Records</span></span>](sql-server-audit-records.md)  
  
  
