---
title: SQL Server Native Client 对高可用性、灾难恢复的支持 |Microsoft Docs
ms.custom: ''
ms.date: 08/31/2016
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
ms.assetid: 2b06186b-4090-4728-b96b-90d6ebd9f66f
author: rothja
ms.author: jroth
ms.openlocfilehash: 43c835d5c0e1c064387aee7fb0db65f577c3aa26
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87590178"
---
# <a name="sql-server-native-client-support-for-high-availability-disaster-recovery"></a><span data-ttu-id="2be86-102">对高可用性、灾难恢复的 SQL Server Native Client 支持</span><span class="sxs-lookup"><span data-stu-id="2be86-102">SQL Server Native Client Support for High Availability, Disaster Recovery</span></span>
  <span data-ttu-id="2be86-103">本主题讨论 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 对于 [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)]的支持（[!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 新增功能）。</span><span class="sxs-lookup"><span data-stu-id="2be86-103">This topic discusses [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client support (added in [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)]) for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="2be86-104">有关 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 的详细信息，请参阅[可用性组侦听程序、客户端连接和应用程序故障转移 (SQL Server)](../../../database-engine/listeners-client-connectivity-application-failover.md)、[创建和配置可用性组 (SQL Server)](../../../database-engine/availability-groups/windows/creation-and-configuration-of-availability-groups-sql-server.md)、[故障转移群集和 AlwaysOn 可用性组 (SQL Server)](../../../database-engine/availability-groups/windows/failover-clustering-and-always-on-availability-groups-sql-server.md) 和[活动次要副本：可读次要副本（AlwaysOn 可用性组）](../../../database-engine/availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md)。</span><span class="sxs-lookup"><span data-stu-id="2be86-104">For more information about [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], see [Availability Group Listeners, Client Connectivity, and Application Failover &#40;SQL Server&#41;](../../../database-engine/listeners-client-connectivity-application-failover.md), [Creation and Configuration of Availability Groups &#40;SQL Server&#41;](../../../database-engine/availability-groups/windows/creation-and-configuration-of-availability-groups-sql-server.md), [Failover Clustering and AlwaysOn Availability Groups &#40;SQL Server&#41;](../../../database-engine/availability-groups/windows/failover-clustering-and-always-on-availability-groups-sql-server.md), and [Active Secondaries: Readable Secondary Replicas (AlwaysOn Availability Groups)](../../../database-engine/availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md).</span></span>  
  
 <span data-ttu-id="2be86-105">您可以在连接字符串中指定给定可用性组的可用性组侦听器。</span><span class="sxs-lookup"><span data-stu-id="2be86-105">You can specify the availability group listener of a given availability group in the connection string.</span></span> <span data-ttu-id="2be86-106">如果某一 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 应用程序连接到故障转移的可用性组中的某个数据库，则原始连接将被断开，并且应用程序必须打开一个新连接，以便在故障转移后继续工作。</span><span class="sxs-lookup"><span data-stu-id="2be86-106">If a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client application is connected to a database in an availability group that fails over, the original connection is broken, and the application must open a new connection to continue work after the failover.</span></span>  
  
 <span data-ttu-id="2be86-107">如果您未连接到某一可用性组侦听器，并且多个 IP 地址与主机名相关联，则 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 将按顺序遍历与 DNS 条目关联的所有 IP 地址。</span><span class="sxs-lookup"><span data-stu-id="2be86-107">If you are not connecting to an availability group listener, and if multiple IP addresses are associated with a hostname, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client will iterate sequentially through all IP addresses associated with DNS entry.</span></span> <span data-ttu-id="2be86-108">如果 DNS 服务器返回的第一个 IP 地址未绑定到任何网络接口卡 (NIC)，则上述遍历操作可能会用时较长。</span><span class="sxs-lookup"><span data-stu-id="2be86-108">This can be time consuming if the first IP address returned by DNS server is not bound to any network interface card (NIC).</span></span> <span data-ttu-id="2be86-109">在连接到某一可用性组侦听器时，[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 将尝试并行建立与所有 IP 地址的连接；如果某一连接尝试成功，则驱动程序将放弃所有挂起的连接尝试。</span><span class="sxs-lookup"><span data-stu-id="2be86-109">When connecting to an availability group listener, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client attempts to establish connections to all IP addresses in parallel and if a connection attempt succeeds, the driver will discard any pending connection attempts.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="2be86-110">增大连接超时值和实现连接重试逻辑将增加应用程序连接到可用性组的概率。</span><span class="sxs-lookup"><span data-stu-id="2be86-110">Increasing connection timeout and implementing connection retry logic will increase the probability that an application will connect to an availability group.</span></span> <span data-ttu-id="2be86-111">此外，由于可用性组进行故障转移而可能使连接失败，您应实现连接重试逻辑，重试失败的连接，直至重新连接。</span><span class="sxs-lookup"><span data-stu-id="2be86-111">Also, because a connection can fail because of an availability group failover, you should implement connection retry logic, retrying a failed connection until it reconnects.</span></span>  
  
## <a name="connecting-with-multisubnetfailover"></a><span data-ttu-id="2be86-112">使用 MultiSubnetFailover 进行连接</span><span class="sxs-lookup"><span data-stu-id="2be86-112">Connecting With MultiSubnetFailover</span></span>  
 <span data-ttu-id="2be86-113">在连接到 SQL Server 2012 可用性组侦听器或 SQL Server 2012 故障转移群集实例时，应始终指定 `MultiSubnetFailover=Yes`。</span><span class="sxs-lookup"><span data-stu-id="2be86-113">Always specify `MultiSubnetFailover=Yes` when connecting to a SQL Server 2012 availability group listener or SQL Server 2012 Failover Cluster Instance.</span></span> <span data-ttu-id="2be86-114">`MultiSubnetFailover` 可加快 SQL Server 2012 中所有可用性组和故障转移群集实例的故障转移速度，并且将显著缩短单子网和多子网 AlwaysOn 拓扑的故障转移时间。</span><span class="sxs-lookup"><span data-stu-id="2be86-114">`MultiSubnetFailover` enables faster failover for all Availability Groups and failover cluster instance in SQL Server 2012 and will significantly reduce failover time for single and multi-subnet AlwaysOn topologies.</span></span> <span data-ttu-id="2be86-115">在多子网故障转移过程中，客户端将尝试并行进行连接。</span><span class="sxs-lookup"><span data-stu-id="2be86-115">During a multi-subnet failover, the client will attempt connections in parallel.</span></span> <span data-ttu-id="2be86-116">在子网故障转移过程中，[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 将会主动重试 TCP 连接。</span><span class="sxs-lookup"><span data-stu-id="2be86-116">During a subnet failover, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client will aggressively retry the TCP connection.</span></span>  
  
 <span data-ttu-id="2be86-117">`MultiSubnetFailover` 连接属性指示应用程序正部署在某一可用性组或故障转移群集实例中，并且 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 将尝试通过连接到所有 IP 地址来连接到主 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例上的数据库。</span><span class="sxs-lookup"><span data-stu-id="2be86-117">The `MultiSubnetFailover` connection property indicates that the application is being deployed in an availability group or Failover Cluster Instance, and that [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client will try to connect to the database on the primary [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance by trying to connect to all the IP addresses.</span></span> <span data-ttu-id="2be86-118">为 `MultiSubnetFailover=Yes` 连接指定时，客户端将以比操作系统的默认 tcp 重新传输间隔更快的速度重试 TCP 连接尝试。</span><span class="sxs-lookup"><span data-stu-id="2be86-118">When `MultiSubnetFailover=Yes` is specified for a connection, the client retries TCP connection attempts faster than the operating system's default TCP retransmit intervals.</span></span> <span data-ttu-id="2be86-119">这样，就可以在对 AlwaysOn 可用性组或 AlwaysOn 故障转移群集实例执行故障转移之后更快地进行重新连接，这一点同时适用于单子网和多子网可用性组和故障转移群集实例。</span><span class="sxs-lookup"><span data-stu-id="2be86-119">This enables faster reconnection after failover of either an AlwaysOn Availability Group or an AlwaysOn Failover Cluster Instance, and is applicable to both single- and multi-subnet Availability Groups and Failover Cluster Instances.</span></span>  
  
 <span data-ttu-id="2be86-120">有关连接字符串关键字的详细信息，请参阅 [将连接字符串关键字用于 SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md)。</span><span class="sxs-lookup"><span data-stu-id="2be86-120">For more information about connection string keywords, see [Using Connection String Keywords with SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md).</span></span>  
  
 <span data-ttu-id="2be86-121">如果在连接到非可用性组侦听器或非故障转移群集实例时指定了 `MultiSubnetFailover=Yes`，可能会对性能造成负面影响，因此不支持这样做。</span><span class="sxs-lookup"><span data-stu-id="2be86-121">Specifying `MultiSubnetFailover=Yes` when connecting to something other than an availability group listener or Failover Cluster Instance may result in a negative performance impact, and is not supported.</span></span>  
  
 <span data-ttu-id="2be86-122">使用以下准则可以连接到可用性组或故障转移群集实例中的服务器：</span><span class="sxs-lookup"><span data-stu-id="2be86-122">Use the following guidelines to connect to a server in an availability group or Failover Cluster Instance:</span></span>  
  
-   <span data-ttu-id="2be86-123">在连接到单子网或多子网时使用 `MultiSubnetFailover` 连接属性；这将改进这两者的性能。</span><span class="sxs-lookup"><span data-stu-id="2be86-123">Use the `MultiSubnetFailover` connection property when connecting to a single subnet or multi-subnet; it will improve performance for both.</span></span>  
  
-   <span data-ttu-id="2be86-124">若要连接到某一可用性组，请在您的连接字符串中将该可用性组的可用性组侦听器指定为服务器。</span><span class="sxs-lookup"><span data-stu-id="2be86-124">To connect to an availability group, specify the availability group listener of the availability group as the server in your connection string.</span></span>  
  
-   <span data-ttu-id="2be86-125">连接到配置有超过 64 个 IP 地址的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 实例将导致连接失败。</span><span class="sxs-lookup"><span data-stu-id="2be86-125">Connecting to a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance configured with more than 64 IP addresses will cause a connection failure.</span></span>  
  
-   <span data-ttu-id="2be86-126">基于以下身份验证类型，使用 `MultiSubnetFailover` 连接属性的应用程序的行为将不会受到影响：[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 身份验证、Kerberos 身份验证或 Windows 身份验证。</span><span class="sxs-lookup"><span data-stu-id="2be86-126">Behavior of an application that uses the `MultiSubnetFailover` connection property is not affected based on the type of authentication: [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Authentication, Kerberos Authentication, or Windows Authentication.</span></span>  
  
-   <span data-ttu-id="2be86-127">您可以增加 `loginTimeout` 的值，以便满足故障转移时间和减少应用程序连接重试次数。</span><span class="sxs-lookup"><span data-stu-id="2be86-127">You can increase the value of `loginTimeout` to accommodate for failover time and reduce application connection retry attempts.</span></span>  
  
-   <span data-ttu-id="2be86-128">不支持分布式事务。</span><span class="sxs-lookup"><span data-stu-id="2be86-128">Distributed transactions are not supported.</span></span>  
  
 <span data-ttu-id="2be86-129">如果只读路由不起作用，则连接到可用性组中的辅助副本位置在以下情况下将失败：</span><span class="sxs-lookup"><span data-stu-id="2be86-129">If read-only routing is not in effect, connecting to a secondary replica location in an availability group will fail in the following situations:</span></span>  
  
1.  <span data-ttu-id="2be86-130">如果未将辅助副本位置配置为接受连接。</span><span class="sxs-lookup"><span data-stu-id="2be86-130">If the secondary replica location is not configured to accept connections.</span></span>  
  
2.  <span data-ttu-id="2be86-131">如果应用程序使用 `ApplicationIntent=ReadWrite`（在下面论述）且将辅助副本位置配置为只读访问。</span><span class="sxs-lookup"><span data-stu-id="2be86-131">If an application uses `ApplicationIntent=ReadWrite` (discussed below) and the secondary replica location is configured for read-only access.</span></span>  
  
 <span data-ttu-id="2be86-132">如果将主副本配置为拒绝只读工作负荷且连接字符串包含 `ApplicationIntent=ReadOnly`，连接将失败。</span><span class="sxs-lookup"><span data-stu-id="2be86-132">A connection will fail if a primary replica is configured to reject read-only workloads and the connection string contains `ApplicationIntent=ReadOnly`.</span></span>  
  
## <a name="upgrading-to-use-multi-subnet-clusters-from-database-mirroring"></a><span data-ttu-id="2be86-133">升级以便使用来自数据库镜像的多子网群集</span><span class="sxs-lookup"><span data-stu-id="2be86-133">Upgrading to Use Multi-Subnet Clusters from Database Mirroring</span></span>  
 <span data-ttu-id="2be86-134">如果连接字符串中已存在 `MultiSubnetFailover` 和 `Failover_Partner` 连接关键字，将出现连接错误。</span><span class="sxs-lookup"><span data-stu-id="2be86-134">A connection error will occur if the `MultiSubnetFailover` and `Failover_Partner` connection keywords are present in the connection string.</span></span> <span data-ttu-id="2be86-135">如果使用 `MultiSubnetFailover` 且 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 返回一个故障转移伙伴响应指示它是数据库镜像对的一部分，也将出现错误。</span><span class="sxs-lookup"><span data-stu-id="2be86-135">An error will also occur if `MultiSubnetFailover` is used and the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] returns a failover partner response indicating it is part of a database mirroring pair.</span></span>  
  
 <span data-ttu-id="2be86-136">如果您将当前使用数据库镜像的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 应用程序升级到多子网方案，则应删除 `Failover_Partner` 连接属性并且使用设置为 `MultiSubnetFailover` 的 `Yes` 替换它，并且还应使用可用性组侦听器替换连接字符串中的服务器名称。</span><span class="sxs-lookup"><span data-stu-id="2be86-136">If you upgrade a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client application that currently uses database mirroring to a multi-subnet scenario, you should remove the `Failover_Partner` connection property and replace it with `MultiSubnetFailover` set to `Yes` and replace the server name in the connection string with an availability group listener.</span></span> <span data-ttu-id="2be86-137">如果连接字符串使用 `Failover_Partner` 和 `MultiSubnetFailover=Yes`，则驱动程序将生成错误。</span><span class="sxs-lookup"><span data-stu-id="2be86-137">If a connection string uses `Failover_Partner` and `MultiSubnetFailover=Yes`, the driver will generate an error.</span></span> <span data-ttu-id="2be86-138">但是，如果连接字符串使用 `Failover_Partner` 和 `MultiSubnetFailover=No`（或 `ApplicationIntent=ReadWrite`），则应用程序将使用数据库镜像。</span><span class="sxs-lookup"><span data-stu-id="2be86-138">However, if a connection string uses `Failover_Partner` and `MultiSubnetFailover=No` (or `ApplicationIntent=ReadWrite`), the application will use database mirroring.</span></span>  
  
 <span data-ttu-id="2be86-139">如果数据库镜像用于可用性组中的主数据库，并且 `MultiSubnetFailover=Yes` 用于连接到主数据库（而非连接到可用性组侦听器）的连接字符串中，则驱动程序将返回错误。</span><span class="sxs-lookup"><span data-stu-id="2be86-139">The driver will return an error if database mirroring is used on the primary database in the availability group, and if `MultiSubnetFailover=Yes` is used in the connection string that connects to a primary database instead of to an availability group listener.</span></span>  
  
## <a name="specifying-application-intent"></a><span data-ttu-id="2be86-140">指定应用程序意向</span><span class="sxs-lookup"><span data-stu-id="2be86-140">Specifying Application Intent</span></span>  
 <span data-ttu-id="2be86-141">如果 `ApplicationIntent=ReadOnly`，在连接到某一启用了 AlwaysOn 的数据库时，客户端将请求读取工作负荷。</span><span class="sxs-lookup"><span data-stu-id="2be86-141">When `ApplicationIntent=ReadOnly`, the client requests a read workload when connecting to an AlwaysOn enabled database.</span></span> <span data-ttu-id="2be86-142">服务器在连接时和在执行 USE 数据库语句的过程中将强制该意向，但仅针对启用了 AlwaysOn 的数据库。</span><span class="sxs-lookup"><span data-stu-id="2be86-142">The server will enforce the intent at connection time and during a USE database statement but only to an Always On enabled database.</span></span>  
  
 <span data-ttu-id="2be86-143">`ApplicationIntent` 关键字不适用于早期的只读数据库。</span><span class="sxs-lookup"><span data-stu-id="2be86-143">The `ApplicationIntent` keyword does not work with legacy, read-only databases.</span></span>  
  
 <span data-ttu-id="2be86-144">数据库可允许或禁止目标 AlwaysOn 数据库上的读取工作负荷。</span><span class="sxs-lookup"><span data-stu-id="2be86-144">A database can allow or disallow read workloads on the targeted AlwaysOn database.</span></span> <span data-ttu-id="2be86-145">（使用 `ALLOW_CONNECTIONS` 和 `PRIMARY_ROLE``SECONDARY_ROLE` 语句的 [!INCLUDE[tsql](../../../includes/tsql-md.md)] 子句可做到这点。）</span><span class="sxs-lookup"><span data-stu-id="2be86-145">(This is done with the `ALLOW_CONNECTIONS` clause of the `PRIMARY_ROLE` and `SECONDARY_ROLE`[!INCLUDE[tsql](../../../includes/tsql-md.md)] statements.)</span></span>  
  
 <span data-ttu-id="2be86-146">`ApplicationIntent` 关键字用于启用只读路由。</span><span class="sxs-lookup"><span data-stu-id="2be86-146">The `ApplicationIntent` keyword is used to enable read-only routing.</span></span>  
  
## <a name="read-only-routing"></a><span data-ttu-id="2be86-147">只读路由</span><span class="sxs-lookup"><span data-stu-id="2be86-147">Read-Only Routing</span></span>  
 <span data-ttu-id="2be86-148">只读路由是一项可确保数据库只读副本的可用性的功能。</span><span class="sxs-lookup"><span data-stu-id="2be86-148">Read-only routing is a feature that can ensure the availability of a read only replica of a database.</span></span> <span data-ttu-id="2be86-149">启用只读路由：</span><span class="sxs-lookup"><span data-stu-id="2be86-149">To enable read-only routing:</span></span>  
  
1.  <span data-ttu-id="2be86-150">您必须连接到某一 AlwaysOn 可用性组侦听器。</span><span class="sxs-lookup"><span data-stu-id="2be86-150">You must connect to an Always On Availability Group availability group listener.</span></span>  
  
2.  <span data-ttu-id="2be86-151">`ApplicationIntent` 连接字符串关键字必须设置为 `ReadOnly`。</span><span class="sxs-lookup"><span data-stu-id="2be86-151">The `ApplicationIntent` connection string keyword must be set to `ReadOnly`.</span></span>  
  
3.  <span data-ttu-id="2be86-152">数据库管理员必须配置该可用性组以便启用只读路由。</span><span class="sxs-lookup"><span data-stu-id="2be86-152">The Availability Group must be configured by the database administrator to enable read-only routing.</span></span>  
  
 <span data-ttu-id="2be86-153">使用只读路由的多个连接可能不会全部连接到相同的只读副本。</span><span class="sxs-lookup"><span data-stu-id="2be86-153">It is possible that multiple connections using read-only routing will not all connect to the same read-only replica.</span></span> <span data-ttu-id="2be86-154">对数据库同步进行更改或对服务器的路由配置进行更改可能导致客户端连接到不同的只读副本。</span><span class="sxs-lookup"><span data-stu-id="2be86-154">Changes in database synchronization or changes in the server's routing configuration can result in client connections to different read-only replicas.</span></span> <span data-ttu-id="2be86-155">若要确保所有只读请求都连接到相同的只读副本，请勿将可用性组侦听器传递到 `Server` 连接字符串关键字。</span><span class="sxs-lookup"><span data-stu-id="2be86-155">To ensure that all read-only requests connect to the same read-only replica, do not pass an availability group listener to the `Server` connection string keyword.</span></span> <span data-ttu-id="2be86-156">而是指定只读实例的名称。</span><span class="sxs-lookup"><span data-stu-id="2be86-156">Instead, specify the name of the read-only instance.</span></span>  
  
 <span data-ttu-id="2be86-157">只读路由所用的时间可能会长于连接到主副本的时间，因为只读路由首先连接到主副本，然后查找可用的最佳可读取辅助副本。</span><span class="sxs-lookup"><span data-stu-id="2be86-157">Read-only routing may take longer than connecting to the primary because read only routing first connects to the primary and then looks for the best available readable secondary.</span></span> <span data-ttu-id="2be86-158">为此，应增加您的登录超时。</span><span class="sxs-lookup"><span data-stu-id="2be86-158">Because of this, you should increase your login timeout.</span></span>  
  
## <a name="odbc"></a><span data-ttu-id="2be86-159">ODBC</span><span class="sxs-lookup"><span data-stu-id="2be86-159">ODBC</span></span>  
 <span data-ttu-id="2be86-160">添加了两个 ODBC 连接字符串关键字以在 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] Native Client 中支持 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]：</span><span class="sxs-lookup"><span data-stu-id="2be86-160">Two ODBC connection string keywords were added to support [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client:</span></span>  
  
-   `ApplicationIntent`  
  
-   `MultiSubnetFailover`  
  
 <span data-ttu-id="2be86-161">有关 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 中 ODBC 连接字符串关键字的详细信息，请参阅[将连接字符串关键字用于 SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md)。</span><span class="sxs-lookup"><span data-stu-id="2be86-161">For more information about ODBC connection string keywords in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client, see [Using Connection String Keywords with SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md).</span></span>  
  
 <span data-ttu-id="2be86-162">等效的连接属性为：</span><span class="sxs-lookup"><span data-stu-id="2be86-162">The equivalent connection properties are:</span></span>  
  
-   `SQL_COPT_SS_APPLICATION_INTENT`  
  
-   `SQL_COPT_SS_MULTISUBNET_FAILOVER`  
  
 <span data-ttu-id="2be86-163">有关 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 中的 ODBC 连接属性的详细信息，请参阅 [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md)。</span><span class="sxs-lookup"><span data-stu-id="2be86-163">For more information about ODBC connection properties in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client, see [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md).</span></span>  
  
 <span data-ttu-id="2be86-164">从 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 开始，将在使用 [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)] Native Client 驱动程序的 DSN 的 ODBC 数据源管理器中公开 `ApplicationIntent` 和 `MultiSubnetFailover` 关键字的功能。</span><span class="sxs-lookup"><span data-stu-id="2be86-164">The functionality of the `ApplicationIntent` and `MultiSubnetFailover` keywords will be exposed in the ODBC Data Source Administrator for DSNs that use the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client driver, beginning in [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)].</span></span>  
  
 <span data-ttu-id="2be86-165">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC 应用程序可以使用以下三个函数之一进行连接：</span><span class="sxs-lookup"><span data-stu-id="2be86-165">A [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC application can use one of three functions to make the connection:</span></span>  
  
|<span data-ttu-id="2be86-166">函数</span><span class="sxs-lookup"><span data-stu-id="2be86-166">Function</span></span>|<span data-ttu-id="2be86-167">说明</span><span class="sxs-lookup"><span data-stu-id="2be86-167">Description</span></span>|  
|--------------|-----------------|  
|[<span data-ttu-id="2be86-168">SQLBrowseConnect</span><span class="sxs-lookup"><span data-stu-id="2be86-168">SQLBrowseConnect</span></span>](../../native-client-odbc-api/sqlbrowseconnect.md)|<span data-ttu-id="2be86-169">`SQLBrowseConnect` 返回的服务器列表将不包括 VNN。</span><span class="sxs-lookup"><span data-stu-id="2be86-169">The list of servers returned by `SQLBrowseConnect` will not include VNNs.</span></span> <span data-ttu-id="2be86-170">如果服务器是独立服务器，或是 Windows Server Failover Clustering (WSFC) 群集中的主服务器或辅助服务器，该群集包含已为 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 启用的两个或多个 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 实例，您将只能看到不带任何指示信息的服务器列表。</span><span class="sxs-lookup"><span data-stu-id="2be86-170">You will only see a list of servers without any indication if the server is a standalone server, or a primary or secondary server in a Windows Server Failover Clustering (WSFC) cluster that contains two or more [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instances that have been enabled for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="2be86-171">如果连接到服务器失败，可能是因为您已连接到某服务器而 `ApplicationIntent` 设置与该服务器配置不兼容。</span><span class="sxs-lookup"><span data-stu-id="2be86-171">If you connect to a server and get a failure, it may be because you have connected to a server, and the `ApplicationIntent` setting is not compatible with the server configuration.</span></span><br /><br /> <span data-ttu-id="2be86-172">由于 `SQLBrowseConnect` 无法识别 Windows Server Failover Clustering (WSFC) 群集（该群集包含已为 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 启用的两个或多个 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 实例）中的服务器，`SQLBrowseConnect` 将忽略 `MultiSubnetFailover` 连接字符串关键字。</span><span class="sxs-lookup"><span data-stu-id="2be86-172">Because `SQLBrowseConnect` does not recognize servers in a Windows Server Failover Clustering (WSFC) cluster that contains two or more [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instances that have been enabled for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], `SQLBrowseConnect` ignores the `MultiSubnetFailover` connection string keyword.</span></span>|  
|[<span data-ttu-id="2be86-173">SQLConnect</span><span class="sxs-lookup"><span data-stu-id="2be86-173">SQLConnect</span></span>](../../native-client-odbc-api/sqlconnect.md)|<span data-ttu-id="2be86-174">`SQLConnect` 通过数据源名称 (DSN) 或连接属性支持 `ApplicationIntent` 和 `MultiSubnetFailover`。</span><span class="sxs-lookup"><span data-stu-id="2be86-174">`SQLConnect` supports both `ApplicationIntent` and `MultiSubnetFailover` via a data source name (DSN) or connection properties.</span></span>|  
|[<span data-ttu-id="2be86-175">SQLDriverConnect</span><span class="sxs-lookup"><span data-stu-id="2be86-175">SQLDriverConnect</span></span>](../../native-client-odbc-api/sqldriverconnect.md)|<span data-ttu-id="2be86-176">`SQLDriverConnect` 通过连接字符串关键字、连接属性或 DSN 支持 `ApplicationIntent` 和 `MultiSubnetFailover`。</span><span class="sxs-lookup"><span data-stu-id="2be86-176">`SQLDriverConnect` supports `ApplicationIntent` and `MultiSubnetFailover` via connection string keywords, connection properties, or DSN.</span></span>|  
  
## <a name="ole-db"></a><span data-ttu-id="2be86-177">OLE DB</span><span class="sxs-lookup"><span data-stu-id="2be86-177">OLE DB</span></span>  
 <span data-ttu-id="2be86-178">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 中的 OLE DB 不支持 `MultiSubnetFailover` 关键字。</span><span class="sxs-lookup"><span data-stu-id="2be86-178">OLE DB in the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client does not support the `MultiSubnetFailover` keyword.</span></span>  
  
 <span data-ttu-id="2be86-179">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 中的 OLE DB 将支持应用程序意向。</span><span class="sxs-lookup"><span data-stu-id="2be86-179">OLE DB in the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client will support application intent.</span></span> <span data-ttu-id="2be86-180">对于 OLE DB 应用程序，应用程序意向的行为将与 ODBC 应用程序的行为相同（请参阅上文）。</span><span class="sxs-lookup"><span data-stu-id="2be86-180">Application intent will behave the same for OLE DB applications as ODBC applications (see above).</span></span>  
  
 <span data-ttu-id="2be86-181">添加了一个 OLE DB 连接字符串关键字以在 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] Native Client 中支持 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]：</span><span class="sxs-lookup"><span data-stu-id="2be86-181">One OLE DB connection string keyword added to support [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client:</span></span>  
  
-   `Application Intent`  
  
 <span data-ttu-id="2be86-182">有关 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 中连接字符串关键字的详细信息，请参阅[将连接字符串关键字用于 SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md)。</span><span class="sxs-lookup"><span data-stu-id="2be86-182">For more information about connection string keywords in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client, see [Using Connection String Keywords with SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md).</span></span>  
  
 <span data-ttu-id="2be86-183">等效的连接属性为：</span><span class="sxs-lookup"><span data-stu-id="2be86-183">The equivalent connection properties are:</span></span>  
  
-   `SSPROP_INIT_APPLICATIONINTENT`  
  
-   `DBPROP_INIT_PROVIDERSTRING`  
  
 <span data-ttu-id="2be86-184">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB 应用程序可以使用以下方法之一来指定应用程序意向：</span><span class="sxs-lookup"><span data-stu-id="2be86-184">A [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB application can use one of the methods to specify application intent:</span></span>  
  
 `IDBInitialize::Initialize`  
 <span data-ttu-id="2be86-185">`IDBInitialize::Initialize` 使用以前配置的属性集来初始化数据源并创建数据源对象。</span><span class="sxs-lookup"><span data-stu-id="2be86-185">`IDBInitialize::Initialize` uses the previously configured set of properties to initialize the data source and create the data source object.</span></span> <span data-ttu-id="2be86-186">将应用程序意向指定为访问接口属性或作为扩展属性字符串的一部分。</span><span class="sxs-lookup"><span data-stu-id="2be86-186">Specify application intent as a provider property or as part of the extended properties string.</span></span>  
  
 `IDataInitialize::GetDataSource`  
 <span data-ttu-id="2be86-187">`IDataInitialize::GetDataSource` 提取可以包含 `Application Intent` 关键字的输入连接字符串。</span><span class="sxs-lookup"><span data-stu-id="2be86-187">`IDataInitialize::GetDataSource` takes an input connection string that can contain the `Application Intent` keyword.</span></span>  
  
 `IDBProperties::GetProperties`  
 <span data-ttu-id="2be86-188">`IDBProperties::GetProperties` 检索当前为数据源设置的属性的值。</span><span class="sxs-lookup"><span data-stu-id="2be86-188">`IDBProperties::GetProperties` retrieves the value of the property that is currently set on the data source.</span></span>  <span data-ttu-id="2be86-189">您可以通过 DBPROP_INIT_PROVIDERSTRING 属性和 SSPROP_INIT_APPLICATIONINTENT 属性检索 `Application Intent` 值。</span><span class="sxs-lookup"><span data-stu-id="2be86-189">You can retrieve the `Application Intent` value through the DBPROP_INIT_PROVIDERSTRING property and SSPROP_INIT_APPLICATIONINTENT property.</span></span>  
  
 `IDBProperties::SetProperties`  
 <span data-ttu-id="2be86-190">若要设置 `ApplicationIntent` 属性值，请调用 `IDBProperties::SetProperties`，它传递 `SSPROP_INIT_APPLICATIONINTENT` 属性的值 `ReadWrite` 或 `ReadOnly` 或传递 `DBPROP_INIT_PROVIDERSTRING` 属性的值（该值包含 `ApplicationIntent=ReadOnly` 或 `ApplicationIntent=ReadWrite`）。</span><span class="sxs-lookup"><span data-stu-id="2be86-190">To set the `ApplicationIntent` property value, call `IDBProperties::SetProperties` passing in the `SSPROP_INIT_APPLICATIONINTENT` property with value "`ReadWrite`" or "`ReadOnly`" or `DBPROP_INIT_PROVIDERSTRING` property with value containing "`ApplicationIntent=ReadOnly`" or "`ApplicationIntent=ReadWrite`".</span></span>  
  
 <span data-ttu-id="2be86-191">可以在“数据链接属性”\*\*\*\* 对话框的“全部”选项卡的“应用程序意向属性”字段中指定应用程序意向。</span><span class="sxs-lookup"><span data-stu-id="2be86-191">You can specify application intent in the Application Intent Properties field of the All tab in the **Data Link Properties** dialog box.</span></span>  
  
 <span data-ttu-id="2be86-192">建立隐式连接时，隐式连接将使用父连接的应用程序意向设置。</span><span class="sxs-lookup"><span data-stu-id="2be86-192">When implicit connections are established, the implicit connection will use the application intent setting of the parent connection.</span></span> <span data-ttu-id="2be86-193">同样，从同一数据源创建的多个会话将继承数据源的应用程序意向设置。</span><span class="sxs-lookup"><span data-stu-id="2be86-193">Similarly, multiple sessions created from the same data source will inherit the data source's application intent setting.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="2be86-194">另请参阅</span><span class="sxs-lookup"><span data-stu-id="2be86-194">See Also</span></span>  
 <span data-ttu-id="2be86-195">[SQL Server Native Client 功能](sql-server-native-client-features.md) </span><span class="sxs-lookup"><span data-stu-id="2be86-195">[SQL Server Native Client Features](sql-server-native-client-features.md) </span></span>  
 [<span data-ttu-id="2be86-196">将连接字符串关键字用于 SQL Server 本机客户端</span><span class="sxs-lookup"><span data-stu-id="2be86-196">Using Connection String Keywords with SQL Server Native Client</span></span>](../applications/using-connection-string-keywords-with-sql-server-native-client.md)  
  
  
