---
title: 使用 XML 数据类型 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- IRowsetChange interface
- IRowsetUpdate interface
- data access [SQL Server Native Client], xml data type
- SQL Server Native Client OLE DB schema rowsets
- PROVIDER_TYPES rowset
- IColumnsInfo interface
- IRowsetFind interface
- IColumnsRowset interface
- PROCEDURE_PARAMETERS rowset
- SQLNCLI, XML
- xml data type [SQL Server], SQL Server Native Client
- SQL Server Native Client, XML
- IRowset interface
- ISequentialStream interface
- ISSCommandWithParameters interface
- SS_XMLSCHEMA rowset
- SQL Server Native Client OLE DB interfaces
- XML [SQL Server], SQL Server Native Client
- COLUMNS rowset
ms.assetid: a7af5b72-c5c2-418d-a636-ae4ac6270ee5
author: rothja
ms.author: jroth
ms.openlocfilehash: 3d0dcc8cf7259a24e53281724d8440c6ff2209f1
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87589019"
---
# <a name="using-xml-data-types"></a><span data-ttu-id="3f805-102">使用 XML 数据类型</span><span class="sxs-lookup"><span data-stu-id="3f805-102">Using XML Data Types</span></span>
  [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] <span data-ttu-id="3f805-103">引入了 xml 数据类型，它可用于在 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 数据库中存储 XML 文档和片段\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="3f805-103">introduced an **xml** data type that enables you to store XML documents and fragments in a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database.</span></span> <span data-ttu-id="3f805-104">xml 数据类型是 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 中的内置数据类型，在某些方面类似于其他内置类型（如 int 和 varchar）    。</span><span class="sxs-lookup"><span data-stu-id="3f805-104">The **xml** data type is a built-in data type in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], and is in some ways similar to other built-in types, such as **int** and **varchar**.</span></span> <span data-ttu-id="3f805-105">与使用其他内置类型一样，可以在创建表时将 xml 数据类型用作列类型，也可以将其用作变量类型、参数类型或函数返回类型，还可以将其用在 CAST 和 CONVERT 函数中\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="3f805-105">As with other built-in types, you can use the **xml** data type as a column type when creating a table; as a variable type, a parameter type, or a function-return type; or in CAST and CONVERT functions.</span></span>  
  
## <a name="programming-considerations"></a><span data-ttu-id="3f805-106">编程注意事项</span><span class="sxs-lookup"><span data-stu-id="3f805-106">Programming Considerations</span></span>  
 <span data-ttu-id="3f805-107">XML 可以是自描述的，即可以根据需要包含一个 XML 标头来指定文档的编码，例如：</span><span class="sxs-lookup"><span data-stu-id="3f805-107">XML can be self-describing in that it can optionally include an XML header that specifies the encoding of the document, for example:</span></span>  
  
 `<?xml version="1.0" encoding="windows-1252"?><doc/>`  
  
 <span data-ttu-id="3f805-108">XML 标准描述 XML 处理器如何通过检查文档的前若干个字节来检测用于文档的编码。</span><span class="sxs-lookup"><span data-stu-id="3f805-108">The XML standard describes how an XML processor can detect the encoding used for a document by examining the first few bytes of the document.</span></span> <span data-ttu-id="3f805-109">有时，应用程序指定的编码可能与文档指定的编码相冲突。</span><span class="sxs-lookup"><span data-stu-id="3f805-109">There are opportunities for the encoding specified by the application to conflict with the encoding specified by the document.</span></span> <span data-ttu-id="3f805-110">对于作为绑定参数传递的文档，[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 将 XML 视为二进制数据，因此不执行转换，并且 XML 分析器可以使用在文档内指定的编码而不会出现问题。</span><span class="sxs-lookup"><span data-stu-id="3f805-110">For documents passed as bound parameters, XML is treated as binary data by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], so no conversions are made and the XML parser can use the encoding specified within the document without problems.</span></span> <span data-ttu-id="3f805-111">然而，对于绑定为 WSTR 的 XML 数据，应用程序必须确保将文档编码为 Unicode。</span><span class="sxs-lookup"><span data-stu-id="3f805-111">However, for XML data that is bound as WSTR, then the application must ensure that the document is encoded as Unicode.</span></span> <span data-ttu-id="3f805-112">这可能需要将文件加载到 DOM 中，同时将编码更改为 Unicode 并对文档进行序列化。</span><span class="sxs-lookup"><span data-stu-id="3f805-112">This may entail loading the document into a DOM, changing the encoding to Unicode and serializing the document.</span></span> <span data-ttu-id="3f805-113">否则，可能发生数据转换，而导致 XML 无效或损坏。</span><span class="sxs-lookup"><span data-stu-id="3f805-113">If this is not done, data conversions may occur, resulting in invalid or corrupt XML.</span></span>  
  
 <span data-ttu-id="3f805-114">当在文字中指定 XML 时，也可能发生冲突。</span><span class="sxs-lookup"><span data-stu-id="3f805-114">There is also potential for conflict when XML is specified in literals.</span></span> <span data-ttu-id="3f805-115">例如，下面的内容无效：</span><span class="sxs-lookup"><span data-stu-id="3f805-115">For example the following are invalid:</span></span>  
  
 `INSERT INTO xmltable(xmlcol) VALUES('<?xml version="1.0" encoding="UTF-16"?><doc/>')`  
  
 `INSERT INTO xmltable(xmlcol) VALUES(N'<?xml version="1.0" encoding="UTF-8"?><doc/>')`  
  
## <a name="sql-server-native-client-ole-db-provider"></a><span data-ttu-id="3f805-116">SQL Server Native Client OLE DB 访问接口</span><span class="sxs-lookup"><span data-stu-id="3f805-116">SQL Server Native Client OLE DB Provider</span></span>  
 <span data-ttu-id="3f805-117">DBTYPE_XML 是 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB 访问接口中特定于 XML 的新数据类型。</span><span class="sxs-lookup"><span data-stu-id="3f805-117">DBTYPE_XML is a new data type specific to XML in the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider.</span></span> <span data-ttu-id="3f805-118">此外，可以通过现有的 OLE DB 类型（DBTYPE_BYTES、DBTYPE_WSTR、DBTYPE_BSTR、DBTYPE_XML、DBTYPE_STR、DBTYPE_VARIANT 和 DBTYPE_IUNKNOWN）访问 XML 数据。</span><span class="sxs-lookup"><span data-stu-id="3f805-118">In addition, XML data can be accessed through the existing OLE DB types of DBTYPE_BYTES, DBTYPE_WSTR, DBTYPE_BSTR, DBTYPE_XML, DBTYPE_STR, DBTYPE_VARIANT, and DBTYPE_IUNKNOWN.</span></span> <span data-ttu-id="3f805-119">可以从 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB 访问接口行集的列中按以下格式检索存储在类型为 XML 的列中的数据：</span><span class="sxs-lookup"><span data-stu-id="3f805-119">Data stored in columns of type XML can be retrieved from a column in a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider rowset in the following formats:</span></span>  
  
-   <span data-ttu-id="3f805-120">文本字符串</span><span class="sxs-lookup"><span data-stu-id="3f805-120">A text string</span></span>  
  
-   <span data-ttu-id="3f805-121">**ISequentialStream**</span><span class="sxs-lookup"><span data-stu-id="3f805-121">An **ISequentialStream**</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="3f805-122">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Native Client OLE DB 提供程序不包括 SAX 读取器，但可以轻松地将**ISequentialStream**传递给 MSXML 中的 sax 和 DOM 对象。</span><span class="sxs-lookup"><span data-stu-id="3f805-122">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider does not include a SAX reader, but the **ISequentialStream** can be easily passed to SAX and DOM objects in MSXML.</span></span>  
  
 <span data-ttu-id="3f805-123">**ISequentialStream**应用于检索大型 XML 文档。</span><span class="sxs-lookup"><span data-stu-id="3f805-123">**ISequentialStream** should be use used for retrieval of large XML documents.</span></span> <span data-ttu-id="3f805-124">用于其他大值类型的相同技术也适用于 XML。</span><span class="sxs-lookup"><span data-stu-id="3f805-124">The same techniques used for other large value types also apply to XML.</span></span> <span data-ttu-id="3f805-125">有关详细信息，请参阅[使用大型数据类型](using-large-value-types.md)。</span><span class="sxs-lookup"><span data-stu-id="3f805-125">For more information, see [Using Large Value Types](using-large-value-types.md).</span></span>  
  
 <span data-ttu-id="3f805-126">还可以通过常见接口（如 IRow::GetColumns、IRowChange::SetColumns 和 ICommand::Execute）检索、插入或更新行集中类型为 XML 的列中存储的数据\*\*\*\*\*\*\*\*\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="3f805-126">Data stored in columns of type XML in a rowset can also be retrieved, inserted, or updated by an application via the usual interfaces such as **IRow::GetColumns**, **IRowChange::SetColumns**, and **ICommand::Execute**.</span></span> <span data-ttu-id="3f805-127">与检索案例类似，应用程序可以将文本字符串或**ISequentialStream**传递给 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB 提供程序。</span><span class="sxs-lookup"><span data-stu-id="3f805-127">Similarly to the retrieval case, an application program can pass either a text string or an **ISequentialStream** to the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="3f805-128">要通过 ISequentialStream 接口以字符串格式发送 XML 数据，必须通过指定 DBTYPE_IUNKNOWN 获取 ISequentialStream 并在绑定中将其 pObject 参数设置为 Null\*\*\*\*\*\*\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="3f805-128">To send XML data in string format through the **ISequentialStream** interface, you must obtain **ISequentialStream** by specifying DBTYPE_IUNKNOWN and set its *pObject* argument to null in the binding.</span></span>  
  
 <span data-ttu-id="3f805-129">当由于使用者缓冲区过小而导致已检索的 XML 数据被截断时，长度可能作为 0xffffffff 返回，这意味着长度为未知的。</span><span class="sxs-lookup"><span data-stu-id="3f805-129">When retrieved XML data is truncated due to the consumer buffer being too small, the length may be returned as 0xffffffff, which means that the length is unknown.</span></span> <span data-ttu-id="3f805-130">这与将它实现为针对客户端进行流处理的数据类型而未在发送实际数据之前发送长度信息是一致的。</span><span class="sxs-lookup"><span data-stu-id="3f805-130">This is consistent with its implementation as a data type that is streamed to the client without sending length information ahead of the actual data.</span></span> <span data-ttu-id="3f805-131">在某些情况下，当提供程序缓冲了整个值（如**IRowset：：：：** ）并执行数据转换时，可能会返回实际长度。</span><span class="sxs-lookup"><span data-stu-id="3f805-131">In some cases the actual length may be returned when the provider has buffered the whole value, such as **IRowset::GetData** and where data conversion is performed.</span></span>  
  
 <span data-ttu-id="3f805-132">服务器会将发送到 SQL Server 的 XML 数据视为二进制数据。</span><span class="sxs-lookup"><span data-stu-id="3f805-132">XML data sent to SQL Server is treated as binary data by the server.</span></span> <span data-ttu-id="3f805-133">这可防止发生任何转换并允许 XML 分析器自动检测 XML 编码。</span><span class="sxs-lookup"><span data-stu-id="3f805-133">This prevents any conversions occurring and allows the XML parser to auto-detect the XML encoding.</span></span> <span data-ttu-id="3f805-134">这样，就可以接受更广泛的 XML 文档（例如，以 UTF-8 编码的文档）作为 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 的输入。</span><span class="sxs-lookup"><span data-stu-id="3f805-134">This allows a wider range of XML documents (for example those encoded in UTF-8) to be accepted as input to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
 <span data-ttu-id="3f805-135">如果将输入 XML 绑定为 DBTYPE_WSTR，则应用程序必须确保已对其进行 Unicode 编码，以避免由于不必要的数据转换而可能导致损坏。</span><span class="sxs-lookup"><span data-stu-id="3f805-135">If input XML is bound as DBTYPE_WSTR, the application must ensure it is already Unicode encoded to avoid any possibility of corruption by unwanted data conversions.</span></span>  
  
### <a name="data-bindings-and-coercions"></a><span data-ttu-id="3f805-136">数据绑定和强制</span><span class="sxs-lookup"><span data-stu-id="3f805-136">Data Bindings and Coercions</span></span>  
 <span data-ttu-id="3f805-137">下表描述将所列数据类型与  xml[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] \*\*\*\* 数据类型一同使用时出现的绑定和强制转换。</span><span class="sxs-lookup"><span data-stu-id="3f805-137">The following table describes the binding and coercion that occurs when using the listed data types with the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] **xml** data type.</span></span>  
  
|<span data-ttu-id="3f805-138">数据类型</span><span class="sxs-lookup"><span data-stu-id="3f805-138">Data type</span></span>|<span data-ttu-id="3f805-139">到服务器</span><span class="sxs-lookup"><span data-stu-id="3f805-139">To Server</span></span><br /><br /> <span data-ttu-id="3f805-140">**XML**</span><span class="sxs-lookup"><span data-stu-id="3f805-140">**XML**</span></span>|<span data-ttu-id="3f805-141">到服务器</span><span class="sxs-lookup"><span data-stu-id="3f805-141">To Server</span></span><br /><br /> <span data-ttu-id="3f805-142">**Non-XML**</span><span class="sxs-lookup"><span data-stu-id="3f805-142">**Non-XML**</span></span>|<span data-ttu-id="3f805-143">从服务器</span><span class="sxs-lookup"><span data-stu-id="3f805-143">From Server</span></span><br /><br /> <span data-ttu-id="3f805-144">**XML**</span><span class="sxs-lookup"><span data-stu-id="3f805-144">**XML**</span></span>|<span data-ttu-id="3f805-145">从服务器</span><span class="sxs-lookup"><span data-stu-id="3f805-145">From Server</span></span><br /><br /> <span data-ttu-id="3f805-146">**Non-XML**</span><span class="sxs-lookup"><span data-stu-id="3f805-146">**Non-XML**</span></span>|  
|---------------|---------------------------|--------------------------------|-----------------------------|----------------------------------|  
|<span data-ttu-id="3f805-147">DBTYPE_XML</span><span class="sxs-lookup"><span data-stu-id="3f805-147">DBTYPE_XML</span></span>|<span data-ttu-id="3f805-148">传递<sup>6，7</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-148">Pass through<sup>6,7</sup></span></span>|<span data-ttu-id="3f805-149">错误<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-149">Error<sup>1</sup></span></span>|<span data-ttu-id="3f805-150">确定<sup>11, 6</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-150">OK<sup>11, 6</sup></span></span>|<span data-ttu-id="3f805-151">错误<sup>8</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-151">Error<sup>8</sup></span></span>|  
|<span data-ttu-id="3f805-152">DBTYPE_BYTES</span><span class="sxs-lookup"><span data-stu-id="3f805-152">DBTYPE_BYTES</span></span>|<span data-ttu-id="3f805-153">传递<sup>6，7</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-153">Pass through<sup>6,7</sup></span></span>|<span data-ttu-id="3f805-154">N/A<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-154">N/A<sup>2</sup></span></span>|<span data-ttu-id="3f805-155">成功 <sup>11，6</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-155">OK <sup>11, 6</sup></span></span>|<span data-ttu-id="3f805-156">N/A <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-156">N/A <sup>2</sup></span></span>|  
|<span data-ttu-id="3f805-157">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="3f805-157">DBTYPE_WSTR</span></span>|<span data-ttu-id="3f805-158">传递<sup>6，10</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-158">Pass through<sup>6,10</sup></span></span>|<span data-ttu-id="3f805-159">N/A <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-159">N/A <sup>2</sup></span></span>|<span data-ttu-id="3f805-160">成功<sup>4，6，12</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-160">OK<sup>4, 6, 12</sup></span></span>|<span data-ttu-id="3f805-161">N/A <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-161">N/A <sup>2</sup></span></span>|  
|<span data-ttu-id="3f805-162">DBTYPE_BSTR</span><span class="sxs-lookup"><span data-stu-id="3f805-162">DBTYPE_BSTR</span></span>|<span data-ttu-id="3f805-163">传递<sup>6，10</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-163">Pass through<sup>6,10</sup></span></span>|<span data-ttu-id="3f805-164">N/A <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-164">N/A <sup>2</sup></span></span>|<span data-ttu-id="3f805-165">成功 <sup>3</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-165">OK <sup>3</sup></span></span>|<span data-ttu-id="3f805-166">N/A <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-166">N/A <sup>2</sup></span></span>|  
|<span data-ttu-id="3f805-167">DBTYPE_STR</span><span class="sxs-lookup"><span data-stu-id="3f805-167">DBTYPE_STR</span></span>|<span data-ttu-id="3f805-168">成功<sup>6，9，10</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-168">OK<sup>6, 9, 10</sup></span></span>|<span data-ttu-id="3f805-169">N/A <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-169">N/A <sup>2</sup></span></span>|<span data-ttu-id="3f805-170">成功<sup>5，6，12</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-170">OK<sup>5, 6, 12</sup></span></span>|<span data-ttu-id="3f805-171">N/A <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-171">N/A <sup>2</sup></span></span>|  
|<span data-ttu-id="3f805-172">DBTYPE_IUNKNOWN</span><span class="sxs-lookup"><span data-stu-id="3f805-172">DBTYPE_IUNKNOWN</span></span>|<span data-ttu-id="3f805-173">通过 ISequentialStream 的字节流<sup>7</sup>\*\*\*\*</span><span class="sxs-lookup"><span data-stu-id="3f805-173">Byte stream via **ISequentialStream**<sup>7</sup></span></span>|<span data-ttu-id="3f805-174">N/A <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-174">N/A <sup>2</sup></span></span>|<span data-ttu-id="3f805-175">通过 ISequentialStream 的字节流<sup>11</sup>\*\*\*\*</span><span class="sxs-lookup"><span data-stu-id="3f805-175">Byte stream via **ISequentialStream**<sup>11</sup></span></span>|<span data-ttu-id="3f805-176">N/A <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-176">N/A <sup>2</sup></span></span>|  
|<span data-ttu-id="3f805-177">DBTYPE_VARIANT (VT_UI1 &#124; VT_ARRAY)</span><span class="sxs-lookup"><span data-stu-id="3f805-177">DBTYPE_VARIANT (VT_UI1 &#124; VT_ARRAY)</span></span>|<span data-ttu-id="3f805-178">传递<sup>6，7</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-178">Pass through<sup>6,7</sup></span></span>|<span data-ttu-id="3f805-179">N/A <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-179">N/A <sup>2</sup></span></span>|<span data-ttu-id="3f805-180">空值</span><span class="sxs-lookup"><span data-stu-id="3f805-180">N/A</span></span>|<span data-ttu-id="3f805-181">N/A <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-181">N/A <sup>2</sup></span></span>|  
|<span data-ttu-id="3f805-182">DBTYPE_VARIANT (VT_BSTR)</span><span class="sxs-lookup"><span data-stu-id="3f805-182">DBTYPE_VARIANT (VT_BSTR)</span></span>|<span data-ttu-id="3f805-183">传递<sup>6，10</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-183">Pass through<sup>6,10</sup></span></span>|<span data-ttu-id="3f805-184">N/A <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-184">N/A <sup>2</sup></span></span>|<span data-ttu-id="3f805-185">成功<sup>3</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-185">OK<sup>3</sup></span></span>|<span data-ttu-id="3f805-186">N/A <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="3f805-186">N/A <sup>2</sup></span></span>|  
  
 <span data-ttu-id="3f805-187"><sup>1</sup>如果使用**ICommandWithParameters：： SetParameterInfo**指定了除 DBTYPE_XML 之外的服务器类型，且访问器类型为 DBTYPE_XML，则 (DB_E_ERRORSOCCURRED 执行该语句时，将会发生错误，DBSTATUS_E_BADACCESSOR) 参数状态。否则，会将数据发送到服务器，但服务器将返回一个错误，指示不存在从 XML 到参数的数据类型的隐式转换。</span><span class="sxs-lookup"><span data-stu-id="3f805-187"><sup>1</sup>If a server type other than DBTYPE_XML is specified with **ICommandWithParameters::SetParameterInfo** and the accessor type is DBTYPE_XML, an error occurs when the statement is executed (DB_E_ERRORSOCCURRED, the parameter status is DBSTATUS_E_BADACCESSOR); otherwise the data is sent to the server, but the server returns an error indicating that there is no implicit conversion from XML to the parameter's data type.</span></span>  
  
 <span data-ttu-id="3f805-188"><sup>2</sup>超出了本主题的范围。</span><span class="sxs-lookup"><span data-stu-id="3f805-188"><sup>2</sup>Beyond the scope of this topic.</span></span>  
  
 <span data-ttu-id="3f805-189"><sup>3</sup>格式为 UTF-16、无字节顺序标记 (BOM)、无编码规格，且无空终止。</span><span class="sxs-lookup"><span data-stu-id="3f805-189"><sup>3</sup>Format is UTF-16, no bye-order mark (BOM), no encoding specification, no null termination.</span></span>  
  
 <span data-ttu-id="3f805-190"><sup>4</sup>格式为 UTF-16、无 BOM、无编码规格，且空终止。</span><span class="sxs-lookup"><span data-stu-id="3f805-190"><sup>4</sup>Format is UTF-16, no BOM, no encoding specification, null termination.</span></span>  
  
 <span data-ttu-id="3f805-191"><sup>5</sup>格式为在客户端代码页中编码的带有空终止符的多字节字符。</span><span class="sxs-lookup"><span data-stu-id="3f805-191"><sup>5</sup>Format is multibyte characters encoded in client code page with null terminator.</span></span> <span data-ttu-id="3f805-192">从服务器提供的 Unicode 进行转换可能导致数据损坏，因此，强烈建议不要使用此绑定。</span><span class="sxs-lookup"><span data-stu-id="3f805-192">Conversion from server supplied Unicode may cause data corruption, so this binding is strongly discouraged.</span></span>  
  
 <span data-ttu-id="3f805-193"><sup>6</sup>可使用 BY_REF。</span><span class="sxs-lookup"><span data-stu-id="3f805-193"><sup>6</sup>BY_REF may be used.</span></span>  
  
 <span data-ttu-id="3f805-194"><sup>7</sup>UTF-16 必须以 BOM 开头。</span><span class="sxs-lookup"><span data-stu-id="3f805-194"><sup>7</sup>UTF-16 data must start with a BOM.</span></span> <span data-ttu-id="3f805-195">否则，服务器可能无法正确地识别编码。</span><span class="sxs-lookup"><span data-stu-id="3f805-195">If it does not, the encoding may not be correctly recognized by the server.</span></span>  
  
 <span data-ttu-id="3f805-196"><sup>8</sup>在创建取值函数时或在提取时，可能进行验证。</span><span class="sxs-lookup"><span data-stu-id="3f805-196"><sup>8</sup>Validation can happen at create accessor time, or at fetch time.</span></span> <span data-ttu-id="3f805-197">此错误为 DB_E_ERRORSOCCURRED，绑定状态设置为 DBBINDSTATUS_UNSUPPORTEDCONVERSION。</span><span class="sxs-lookup"><span data-stu-id="3f805-197">The error is DB_E_ERRORSOCCURRED, binding status set to DBBINDSTATUS_UNSUPPORTEDCONVERSION.</span></span>  
  
 <span data-ttu-id="3f805-198"><sup>9</sup>使用客户端代码页将数据转换为 Unicode，然后发送到服务器。</span><span class="sxs-lookup"><span data-stu-id="3f805-198"><sup>9</sup>Data is converted to Unicode using the client codepage before being sent to the server.</span></span> <span data-ttu-id="3f805-199">如果文档编码与客户端代码页不匹配，则这可能导致数据损坏，因此强烈建议不要使用此绑定。</span><span class="sxs-lookup"><span data-stu-id="3f805-199">If the document encoding does not match the client codepage, this can result in data corruption, so this binding is strongly discouraged.</span></span>  
  
 <span data-ttu-id="3f805-200"><sup>10</sup>始终向发送到服务器的数据添加一个 BOM。</span><span class="sxs-lookup"><span data-stu-id="3f805-200"><sup>10</sup>A BOM is always added to data sent to the server.</span></span> <span data-ttu-id="3f805-201">如果数据已经以一个 BOM 开始，则这可能导致在缓冲区的开头具有两个 BOM。</span><span class="sxs-lookup"><span data-stu-id="3f805-201">If the data already started with a BOM, this results in two BOMs at the start of the buffer.</span></span> <span data-ttu-id="3f805-202">服务器使用第一个 BOM 将编码识别为 UTF-16，然后放弃它。</span><span class="sxs-lookup"><span data-stu-id="3f805-202">The server uses the first BOM to recognize the encoding as UTF-16 and then discards it.</span></span> <span data-ttu-id="3f805-203">第二个 BOM 将被解释为零宽度不间断空格字符。</span><span class="sxs-lookup"><span data-stu-id="3f805-203">The second BOM is interpreted as a zero-width nonbreaking space character.</span></span>  
  
 <span data-ttu-id="3f805-204"><sup>11</sup>格式为 UTF-16、无编码规格，且向从服务器收到的数据添加一个 BOM。</span><span class="sxs-lookup"><span data-stu-id="3f805-204"><sup>11</sup>Format is UTF-16, no encoding specification, a BOM is added to data received from the server.</span></span> <span data-ttu-id="3f805-205">如果服务器返回了空字符串，则仍将 BOM 返回给应用程序。</span><span class="sxs-lookup"><span data-stu-id="3f805-205">If an empty string is returned by the server, a BOM is still returned to the application.</span></span> <span data-ttu-id="3f805-206">如果缓冲区长度的字节数为奇数，则正确截断数据。</span><span class="sxs-lookup"><span data-stu-id="3f805-206">If the buffer length is an odd number of bytes, the data is truncated correctly.</span></span> <span data-ttu-id="3f805-207">如果分块区返回了整个值，则可将其进行连接，重新构建正确的值。</span><span class="sxs-lookup"><span data-stu-id="3f805-207">If the whole value is returned in chunks, they can be concatenated to reconstitute the correct value.</span></span>  
  
 <span data-ttu-id="3f805-208"><sup>12</sup>如果缓冲区长度小于两个字符（即，空值没有足够的空间），则会报告溢出错误。</span><span class="sxs-lookup"><span data-stu-id="3f805-208"><sup>12</sup>If the buffer length is less than two characters--that is, not enough space for null termination--an overflow error is reported.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="3f805-209">对于 NULL XML 值，不返回值。</span><span class="sxs-lookup"><span data-stu-id="3f805-209">No data is returned for NULL XML values.</span></span>  
  
 <span data-ttu-id="3f805-210">XML 标准要求 UTF-16 编码的 XML，以便以字节顺序标记 (BOM) UTF-16 字符代码 0xFEFF 开头。</span><span class="sxs-lookup"><span data-stu-id="3f805-210">The XML standard requires UTF-16 encoded XML to start with a byte-order mark (BOM), UTF-16 character code 0xFEFF.</span></span> <span data-ttu-id="3f805-211">使用 WSTR 和 BSTR 绑定时， [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 不需要或添加 BOM，因为绑定隐含了编码。</span><span class="sxs-lookup"><span data-stu-id="3f805-211">When working with WSTR and BSTR bindings, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client does not require or add a BOM as the encoding is implied by the binding.</span></span> <span data-ttu-id="3f805-212">当使用 BYTES、XML 或 IUNKNOWN 绑定时，目的是为了在处理其他 XML 处理器和存储系统时提供简便性。</span><span class="sxs-lookup"><span data-stu-id="3f805-212">When working with BYTES, XML, or IUNKNOWN bindings, the intent is to provide simplicity in dealing with other XML processors and storage systems.</span></span> <span data-ttu-id="3f805-213">在此情况下，应向 UTF-16 编码的 XML 提供 BOM，并且应用程序无需关心实际编码，因为绝大多数的 XML 处理器（包括 SQL Server）会通过检查该值的前几个字节推导出编码。</span><span class="sxs-lookup"><span data-stu-id="3f805-213">In this case a BOM should be present with UTF-16 encoded XML, and the application need not be concerned with the actual encoding, since the majority of XML processors (including SQL Server) deduces the encoding by inspecting the first few bytes of the value.</span></span> <span data-ttu-id="3f805-214">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]使用字节、XML 或 IUNKNOWN 绑定从 Native Client 收到的 XML 数据始终以 utf-16 进行编码，并且具有 BOM 并且没有嵌入的编码声明。</span><span class="sxs-lookup"><span data-stu-id="3f805-214">XML data received from [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client using BYTES, XML, or IUNKNOWN bindings is always encoded in UTF-16 with a BOM and without an embedded encoding declaration.</span></span>  
  
 <span data-ttu-id="3f805-215">OLE DB 核心服务 (IDataConvert) 提供的数据转换不适用于 DBTYPE_XML\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="3f805-215">Data conversions supplied by OLE DB core services (**IDataConvert**) are not applicable to DBTYPE_XML.</span></span>  
  
 <span data-ttu-id="3f805-216">当向服务器发送数据时将执行验证。</span><span class="sxs-lookup"><span data-stu-id="3f805-216">Validation is done when data is sent to the server.</span></span> <span data-ttu-id="3f805-217">应由应用程序处理客户端验证和编码更改，强烈建议您不要直接处理 XML 数据，而应使用 DOM 或 SAX 读取器来处理此数据。</span><span class="sxs-lookup"><span data-stu-id="3f805-217">Client-side validation and encoding changes should be handled by your application, and it is strongly recommended that you not process the XML data directly, but should instead use a DOM or SAX reader to process it.</span></span>  
  
 <span data-ttu-id="3f805-218">可绑定 DBTYPE_NULL 和 DBTYPE_EMPTY 用于输入参数，但不能用于输出参数或结果。</span><span class="sxs-lookup"><span data-stu-id="3f805-218">DBTYPE_NULL and DBTYPE_EMPTY can be bound for input parameters but not for output parameters or results.</span></span> <span data-ttu-id="3f805-219">当将它们绑定用于输入参数时，状态必须设置为 DBSTATUS_S_ISNULL 或 DBSTATUS_S_DEFAULT。</span><span class="sxs-lookup"><span data-stu-id="3f805-219">When bound for input parameters the status must be set to DBSTATUS_S_ISNULL or DBSTATUS_S_DEFAULT.</span></span>  
  
 <span data-ttu-id="3f805-220">可以将 DBTYPE_XML 转换为 DBTYPE_EMPTY 和 DBTYPE_NULL，并可以将 DBTYPE_EMPTY 转换为 DBTYPE_XML，但无法将 DBTYPE_NULL 转换为 DBTYPE_XML。</span><span class="sxs-lookup"><span data-stu-id="3f805-220">DBTYPE_XML can be converted to DBTYPE_EMPTY and DBTYPE_NULL, DBTYPE_EMPTY can be converted to DBTYPE_XML, but DBTYPE_NULL cannot be converted to DBTYPE_XML.</span></span> <span data-ttu-id="3f805-221">这与 DBTYPE_WSTR 相一致。</span><span class="sxs-lookup"><span data-stu-id="3f805-221">This is consistent with DBTYPE_WSTR.</span></span>  
  
 <span data-ttu-id="3f805-222">DBTYPE_IUNKNOWN 是支持的绑定（如上表中所示），但在 DBTYPE_XML 与 DBTYPE_IUNKNOWN 之间不存在转换。</span><span class="sxs-lookup"><span data-stu-id="3f805-222">DBTYPE_IUNKNOWN is a supported binding (as shown in the above table), but there are no conversions between DBTYPE_XML and DBTYPE_IUNKNOWN.</span></span> <span data-ttu-id="3f805-223">DBTYPE_IUNKNOWN 不能与 DBTYPE_BYREF 一起使用。</span><span class="sxs-lookup"><span data-stu-id="3f805-223">DBTYPE_IUNKNOWN may not be used with DBTYPE_BYREF.</span></span>  
  
### <a name="ole-db-rowset-additions-and-changes"></a><span data-ttu-id="3f805-224">OLE DB 行集的添加和更改内容</span><span class="sxs-lookup"><span data-stu-id="3f805-224">OLE DB Rowset Additions and Changes</span></span>  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]<span data-ttu-id="3f805-225">Native Client 将新值或更改添加到许多核心 OLE DB 架构行集。</span><span class="sxs-lookup"><span data-stu-id="3f805-225">Native Client adds new values or changes to many of the core OLE DB schema rowsets.</span></span>  
  
#### <a name="the-columns-and-procedure_parameters-schema-rowsets"></a><span data-ttu-id="3f805-226">COLUMNS 和 PROCEDURE_PARAMETERS 架构行集</span><span class="sxs-lookup"><span data-stu-id="3f805-226">The COLUMNS and PROCEDURE_PARAMETERS Schema Rowsets</span></span>  
 <span data-ttu-id="3f805-227">COLUMNS 和 PROCEDURE_PARAMETERS 架构行集添加了以下列。</span><span class="sxs-lookup"><span data-stu-id="3f805-227">Additions to the COLUMNS and PROCEDURE_PARAMETERS schema rowsets include the following columns.</span></span>  
  
|<span data-ttu-id="3f805-228">列名称</span><span class="sxs-lookup"><span data-stu-id="3f805-228">Column name</span></span>|<span data-ttu-id="3f805-229">类型</span><span class="sxs-lookup"><span data-stu-id="3f805-229">Type</span></span>|<span data-ttu-id="3f805-230">说明</span><span class="sxs-lookup"><span data-stu-id="3f805-230">Description</span></span>|  
|-----------------|----------|-----------------|  
|<span data-ttu-id="3f805-231">SS_XML_SCHEMACOLLECTION_CATALOGNAME</span><span class="sxs-lookup"><span data-stu-id="3f805-231">SS_XML_SCHEMACOLLECTION_CATALOGNAME</span></span>|<span data-ttu-id="3f805-232">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="3f805-232">DBTYPE_WSTR</span></span>|<span data-ttu-id="3f805-233">在其中定义 XML 架构集合的目录的名称。</span><span class="sxs-lookup"><span data-stu-id="3f805-233">The name of a catalog in which an XML schema collection is defined.</span></span> <span data-ttu-id="3f805-234">对于非 XML 列或非类型化 XML 列，为 NULL。</span><span class="sxs-lookup"><span data-stu-id="3f805-234">NULL for a non-XML column or un-typed XML column.</span></span>|  
|<span data-ttu-id="3f805-235">SS_XML_SCHEMACOLLECTION_SCHEMANAME</span><span class="sxs-lookup"><span data-stu-id="3f805-235">SS_XML_SCHEMACOLLECTION_SCHEMANAME</span></span>|<span data-ttu-id="3f805-236">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="3f805-236">DBTYPE_WSTR</span></span>|<span data-ttu-id="3f805-237">在其中定义 XML 架构集合的架构的名称。</span><span class="sxs-lookup"><span data-stu-id="3f805-237">The name of a schema in which an XML schema collection is defined.</span></span> <span data-ttu-id="3f805-238">对于非 XML 列或非类型化 XML 列，为 NULL。</span><span class="sxs-lookup"><span data-stu-id="3f805-238">NULL for a non-XML column or un-typed XML column.</span></span>|  
|<span data-ttu-id="3f805-239">SS_XML_SCHEMACOLLECTIONNAME</span><span class="sxs-lookup"><span data-stu-id="3f805-239">SS_XML_SCHEMACOLLECTIONNAME</span></span>|<span data-ttu-id="3f805-240">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="3f805-240">DBTYPE_WSTR</span></span>|<span data-ttu-id="3f805-241">XML 架构集合的名称。</span><span class="sxs-lookup"><span data-stu-id="3f805-241">The name of XML schema collection.</span></span> <span data-ttu-id="3f805-242">对于非 XML 列或非类型化 XML 列，为 NULL。</span><span class="sxs-lookup"><span data-stu-id="3f805-242">NULL for a non-XML column or un-typed XML column.</span></span>|  
  
#### <a name="the-provider_types-schema-rowset"></a><span data-ttu-id="3f805-243">PROVIDER_TYPES 架构行集</span><span class="sxs-lookup"><span data-stu-id="3f805-243">The PROVIDER_TYPES Schema Rowset</span></span>  
 <span data-ttu-id="3f805-244">在 PROVIDER_TYPES 架构行集中，xml 数据类型的 COLUMN_SIZE 值为 0，且 DATA_TYPE 为 DBTYPE_XML\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="3f805-244">In the PROVIDER_TYPES schema rowset, the COLUMN_SIZE value is 0 for the **xml** data type, and the DATA_TYPE is DBTYPE_XML.</span></span>  
  
#### <a name="the-ss_xmlschema-schema-rowset"></a><span data-ttu-id="3f805-245">SS_XMLSCHEMA 架构行集</span><span class="sxs-lookup"><span data-stu-id="3f805-245">The SS_XMLSCHEMA Schema Rowset</span></span>  
 <span data-ttu-id="3f805-246">所引入的新的架构行集 SS_XMLSCHEMA 可供客户端检索 XML 架构信息。</span><span class="sxs-lookup"><span data-stu-id="3f805-246">A new schema rowset SS_XMLSCHEMA is introduced for clients to retrieve XML schema information.</span></span> <span data-ttu-id="3f805-247">SS_XMLSCHEMA 行集包含以下列。</span><span class="sxs-lookup"><span data-stu-id="3f805-247">The SS_XMLSCHEMA rowset contains the following columns.</span></span>  
  
|<span data-ttu-id="3f805-248">列名称</span><span class="sxs-lookup"><span data-stu-id="3f805-248">Column name</span></span>|<span data-ttu-id="3f805-249">类型</span><span class="sxs-lookup"><span data-stu-id="3f805-249">Type</span></span>|<span data-ttu-id="3f805-250">说明</span><span class="sxs-lookup"><span data-stu-id="3f805-250">Description</span></span>|  
|-----------------|----------|-----------------|  
|<span data-ttu-id="3f805-251">SCHEMACOLLECTION_CATALOGNAME</span><span class="sxs-lookup"><span data-stu-id="3f805-251">SCHEMACOLLECTION_CATALOGNAME</span></span>|<span data-ttu-id="3f805-252">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="3f805-252">DBTYPE_WSTR</span></span>|<span data-ttu-id="3f805-253">XML 集合所属的目录。</span><span class="sxs-lookup"><span data-stu-id="3f805-253">The catalog an XML collection belongs to.</span></span>|  
|<span data-ttu-id="3f805-254">SCHEMACOLLECTION_SCHEMANAME</span><span class="sxs-lookup"><span data-stu-id="3f805-254">SCHEMACOLLECTION_SCHEMANAME</span></span>|<span data-ttu-id="3f805-255">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="3f805-255">DBTYPE_WSTR</span></span>|<span data-ttu-id="3f805-256">XML 集合所属的架构。</span><span class="sxs-lookup"><span data-stu-id="3f805-256">The schema an XML collection belongs to.</span></span>|  
|<span data-ttu-id="3f805-257">SCHEMACOLLECTIONNAME</span><span class="sxs-lookup"><span data-stu-id="3f805-257">SCHEMACOLLECTIONNAME</span></span>|<span data-ttu-id="3f805-258">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="3f805-258">DBTYPE_WSTR</span></span>|<span data-ttu-id="3f805-259">类型化的 XML 列的 XML 架构集合名称；否则为 NULL。</span><span class="sxs-lookup"><span data-stu-id="3f805-259">The name of an XML schema collection for typed XML columns, NULL otherwise.</span></span>|  
|<span data-ttu-id="3f805-260">TARGETNAMESPACEURI</span><span class="sxs-lookup"><span data-stu-id="3f805-260">TARGETNAMESPACEURI</span></span>|<span data-ttu-id="3f805-261">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="3f805-261">DBTYPE_WSTR</span></span>|<span data-ttu-id="3f805-262">XML 架构的目标命名空间。</span><span class="sxs-lookup"><span data-stu-id="3f805-262">The target name space of an XML schema.</span></span>|  
|<span data-ttu-id="3f805-263">SCHEMACONTENT</span><span class="sxs-lookup"><span data-stu-id="3f805-263">SCHEMACONTENT</span></span>|<span data-ttu-id="3f805-264">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="3f805-264">DBTYPE_WSTR</span></span>|<span data-ttu-id="3f805-265">XML 架构内容。</span><span class="sxs-lookup"><span data-stu-id="3f805-265">The XML schema content.</span></span>|  
  
 <span data-ttu-id="3f805-266">每个 XML 架构都按目录名称、架构名称、架构集合名称和目标命名空间统一资源标识符 (URI) 限定范围。</span><span class="sxs-lookup"><span data-stu-id="3f805-266">Each XML schema is scoped by catalog name, schema name, schema collection name, and target name space Uniform Resource Identifier (URI).</span></span> <span data-ttu-id="3f805-267">此外，还定义了新的 GUID，其名称为 DBSCHEMA_XML_COLLECTIONS。</span><span class="sxs-lookup"><span data-stu-id="3f805-267">In addition, a new GUID with the name DBSCHEMA_XML_COLLECTIONS is also defined.</span></span> <span data-ttu-id="3f805-268">SS_XMLSCHEMA 架构行集的限制数和受限列定义如下。</span><span class="sxs-lookup"><span data-stu-id="3f805-268">The number of restrictions and restricted columns for the SS_XMLSCHEMA schema rowset are defined as follows.</span></span>  
  
|<span data-ttu-id="3f805-269">GUID</span><span class="sxs-lookup"><span data-stu-id="3f805-269">GUID</span></span>|<span data-ttu-id="3f805-270">限制数</span><span class="sxs-lookup"><span data-stu-id="3f805-270">Number of restrictions</span></span>|<span data-ttu-id="3f805-271">受限列</span><span class="sxs-lookup"><span data-stu-id="3f805-271">Restricted columns</span></span>|  
|----------|----------------------------|------------------------|  
|<span data-ttu-id="3f805-272">DBSCHEMA_XML_COLLECTIONS</span><span class="sxs-lookup"><span data-stu-id="3f805-272">DBSCHEMA_XML_COLLECTIONS</span></span>|<span data-ttu-id="3f805-273">4</span><span class="sxs-lookup"><span data-stu-id="3f805-273">4</span></span>|<span data-ttu-id="3f805-274">SCHEMACOLLECTION_CATALOGNAME</span><span class="sxs-lookup"><span data-stu-id="3f805-274">SCHEMACOLLECTION_CATALOGNAME</span></span><br /><br /> <span data-ttu-id="3f805-275">SCHEMACOLLECTION_SCHEMANAME</span><span class="sxs-lookup"><span data-stu-id="3f805-275">SCHEMACOLLECTION_SCHEMANAME</span></span><br /><br /> <span data-ttu-id="3f805-276">SCHEMACOLLECTIONNAME</span><span class="sxs-lookup"><span data-stu-id="3f805-276">SCHEMACOLLECTIONNAME</span></span><br /><br /> <span data-ttu-id="3f805-277">TARGETNAMESPACEURI</span><span class="sxs-lookup"><span data-stu-id="3f805-277">TARGETNAMESPACEURI</span></span>|  
  
### <a name="ole-db-property-set-additions-and-changes"></a><span data-ttu-id="3f805-278">OLE DB 属性集的添加和更改内容</span><span class="sxs-lookup"><span data-stu-id="3f805-278">OLE DB Property Set Additions and Changes</span></span>  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]<span data-ttu-id="3f805-279">Native Client 向许多 core OLE DB 属性集添加新值或更改。</span><span class="sxs-lookup"><span data-stu-id="3f805-279">Native Client adds new values or changes to many of the core OLE DB property sets.</span></span>  
  
#### <a name="the-dbpropset_sqlserverparameter-property-set"></a><span data-ttu-id="3f805-280">DBPROPSET_SQLSERVERPARAMETER 属性集</span><span class="sxs-lookup"><span data-stu-id="3f805-280">The DBPROPSET_SQLSERVERPARAMETER Property Set</span></span>  
 <span data-ttu-id="3f805-281">为了通过 OLE DB 支持**xml**数据类型， [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 实现了新的 DBPROPSET_SQLSERVERPARAMETER 属性集，该属性集包含以下值。</span><span class="sxs-lookup"><span data-stu-id="3f805-281">In order to support the **xml** data type through OLE DB, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client implements the new DBPROPSET_SQLSERVERPARAMETER property set, which contains the following values.</span></span>  
  
|<span data-ttu-id="3f805-282">名称</span><span class="sxs-lookup"><span data-stu-id="3f805-282">Name</span></span>|<span data-ttu-id="3f805-283">类型</span><span class="sxs-lookup"><span data-stu-id="3f805-283">Type</span></span>|<span data-ttu-id="3f805-284">说明</span><span class="sxs-lookup"><span data-stu-id="3f805-284">Description</span></span>|  
|----------|----------|-----------------|  
|<span data-ttu-id="3f805-285">SSPROP_PARAM_XML_SCHEMACOLLECTION_CATALOGNAME</span><span class="sxs-lookup"><span data-stu-id="3f805-285">SSPROP_PARAM_XML_SCHEMACOLLECTION_CATALOGNAME</span></span>|<span data-ttu-id="3f805-286">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="3f805-286">DBTYPE_WSTR</span></span>|<span data-ttu-id="3f805-287">在其中定义 XML 架构集合的目录（数据库）的名称。</span><span class="sxs-lookup"><span data-stu-id="3f805-287">The name of a catalog (database) in which an XML schema collection is defined.</span></span> <span data-ttu-id="3f805-288">由三部分组成的 SQL 名称标识符的一部分。</span><span class="sxs-lookup"><span data-stu-id="3f805-288">A part of the SQL three-part name identifier.</span></span>|  
|<span data-ttu-id="3f805-289">SSPROP_PARAM_XML_SCHEMACOLLECTION_SCHEMANAME</span><span class="sxs-lookup"><span data-stu-id="3f805-289">SSPROP_PARAM_XML_SCHEMACOLLECTION_SCHEMANAME</span></span>|<span data-ttu-id="3f805-290">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="3f805-290">DBTYPE_WSTR</span></span>|<span data-ttu-id="3f805-291">架构集合内 XML 架构的名称。</span><span class="sxs-lookup"><span data-stu-id="3f805-291">The name of an XML schema within the schema collection.</span></span> <span data-ttu-id="3f805-292">由三部分组成的 SQL 名称标识符的一部分。</span><span class="sxs-lookup"><span data-stu-id="3f805-292">A part of the SQL three -part name identifier.</span></span>|  
|<span data-ttu-id="3f805-293">SSPROP_PARAM_XML_SCHEMACOLLECTIONNAME</span><span class="sxs-lookup"><span data-stu-id="3f805-293">SSPROP_PARAM_XML_SCHEMACOLLECTIONNAME</span></span>|<span data-ttu-id="3f805-294">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="3f805-294">DBTYPE_WSTR</span></span>|<span data-ttu-id="3f805-295">目录内 XML 架构集合的名称。由三部分组成的 SQL 名称标识符的一部分。</span><span class="sxs-lookup"><span data-stu-id="3f805-295">The name of the XML schema collection within the catalog A part of the SQL three -part name identifier.</span></span>|  
  
#### <a name="the-dbpropset_sqlservercolumn-property-set"></a><span data-ttu-id="3f805-296">DBPROPSET_SQLSERVERCOLUMN 属性集</span><span class="sxs-lookup"><span data-stu-id="3f805-296">The DBPROPSET_SQLSERVERCOLUMN Property Set</span></span>  
 <span data-ttu-id="3f805-297">为了支持在**ITableDefinition**接口中创建表， [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 将三个新列添加到 DBPROPSET_SQLSERVERCOLUMN 属性集。</span><span class="sxs-lookup"><span data-stu-id="3f805-297">To support the creation of tables in the **ITableDefinition** interface, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client adds three new columns to the DBPROPSET_SQLSERVERCOLUMN property set.</span></span>  
  
|<span data-ttu-id="3f805-298">名称</span><span class="sxs-lookup"><span data-stu-id="3f805-298">Name</span></span>|<span data-ttu-id="3f805-299">类型</span><span class="sxs-lookup"><span data-stu-id="3f805-299">Type</span></span>|<span data-ttu-id="3f805-300">说明</span><span class="sxs-lookup"><span data-stu-id="3f805-300">Description</span></span>|  
|----------|----------|-----------------|  
|<span data-ttu-id="3f805-301">SSPROP_COL_XML_SCHEMACOLLECTION_CATALOGNAME</span><span class="sxs-lookup"><span data-stu-id="3f805-301">SSPROP_COL_XML_SCHEMACOLLECTION_CATALOGNAME</span></span>|<span data-ttu-id="3f805-302">VT_BSTR</span><span class="sxs-lookup"><span data-stu-id="3f805-302">VT_BSTR</span></span>|<span data-ttu-id="3f805-303">对于类型化 XML 列，此属性是一个字符串，它指定在其中存储 XML 架构的目录的名称。</span><span class="sxs-lookup"><span data-stu-id="3f805-303">For typed XML columns, this property is a string specifying the name of the catalog where the XML schema is stored.</span></span> <span data-ttu-id="3f805-304">对于其他列类型，此属性返回空字符串。</span><span class="sxs-lookup"><span data-stu-id="3f805-304">For other column types this property returns an empty string.</span></span>|  
|<span data-ttu-id="3f805-305">SSPROP_COL_XML_SCHEMACOLLECTION_SCHEMANAME</span><span class="sxs-lookup"><span data-stu-id="3f805-305">SSPROP_COL_XML_SCHEMACOLLECTION_SCHEMANAME</span></span>|<span data-ttu-id="3f805-306">VT_BSTR</span><span class="sxs-lookup"><span data-stu-id="3f805-306">VT_BSTR</span></span>|<span data-ttu-id="3f805-307">对于类型化 XML 列，此属性是一个字符串，它指定定义此列的 XML 架构的名称。</span><span class="sxs-lookup"><span data-stu-id="3f805-307">For typed XML columns, this property is a string specifying the name of XML schema that defines this column.</span></span>|  
|<span data-ttu-id="3f805-308">SSPROP_COL_XML_SCHEMACOLLECTIONNAME</span><span class="sxs-lookup"><span data-stu-id="3f805-308">SSPROP_COL_XML_SCHEMACOLLECTIONNAME</span></span>|<span data-ttu-id="3f805-309">VT_BSTR</span><span class="sxs-lookup"><span data-stu-id="3f805-309">VT_BSTR</span></span>|<span data-ttu-id="3f805-310">对于类型化 XML 列，此属性是一个字符串，它指定定义此值的 XML 架构集合的名称。</span><span class="sxs-lookup"><span data-stu-id="3f805-310">For typed XML columns, this property is a string specifying the name of the schema XML schema collection defining the value.</span></span>|  
  
 <span data-ttu-id="3f805-311">与 SSPROP_PARAM 值类似，所有这些属性都是可选的且默认值为空。</span><span class="sxs-lookup"><span data-stu-id="3f805-311">Like the SSPROP_PARAM values, all of these properties are optional and default to empty.</span></span> <span data-ttu-id="3f805-312">仅当指定 SSPROP_COL_XML_SCHEMACOLLECTIONNAME 时，才能指定 SSPROP_COL_XML_SCHEMACOLLECTION_CATALOGNAME 和 SSPROP_COL_XML_SCHEMACOLLECTION_SCHEMANAME。</span><span class="sxs-lookup"><span data-stu-id="3f805-312">SSPROP_COL_XML_SCHEMACOLLECTION_CATALOGNAME and SSPROP_COL_XML_SCHEMACOLLECTION_SCHEMANAME may only be specified if SSPROP_COL_XML_SCHEMACOLLECTIONNAME is specified.</span></span> <span data-ttu-id="3f805-313">在将 XML 传递到服务器时，如果包含这些值，则将针对当前数据库检查它们是否存在（有效性），并且针对架构检查实例数据。</span><span class="sxs-lookup"><span data-stu-id="3f805-313">When passing XML to the server, if these values are included they are checked for existence (validity) against the current database and the instance data is checked against the schema.</span></span> <span data-ttu-id="3f805-314">在所有情况下，要使这些值有效，它们必须全部为空或全部添入这些值。</span><span class="sxs-lookup"><span data-stu-id="3f805-314">In all cases, to be valid they are either all empty or all filled in.</span></span>  
  
### <a name="ole-db-interface-additions-and-changes"></a><span data-ttu-id="3f805-315">OLE DB 接口的添加和更改内容</span><span class="sxs-lookup"><span data-stu-id="3f805-315">OLE DB Interface Additions and Changes</span></span>  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]<span data-ttu-id="3f805-316">Native Client 将新值或更改添加到许多核心 OLE DB 接口。</span><span class="sxs-lookup"><span data-stu-id="3f805-316">Native Client adds new values or changes to many of the core OLE DB interfaces.</span></span>  
  
#### <a name="the-isscommandwithparameters-interface"></a><span data-ttu-id="3f805-317">ISSCommandWithParameters 接口</span><span class="sxs-lookup"><span data-stu-id="3f805-317">The ISSCommandWithParameters Interface</span></span>  
 <span data-ttu-id="3f805-318">为了通过 OLE DB 支持**xml**数据类型， [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 实现了许多更改，包括添加[ISSCommandWithParameters](../../native-client-ole-db-interfaces/isscommandwithparameters-ole-db.md)接口。</span><span class="sxs-lookup"><span data-stu-id="3f805-318">In order to support the **xml** data type through OLE DB, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client implements a number of changes including the addition of the [ISSCommandWithParameters](../../native-client-ole-db-interfaces/isscommandwithparameters-ole-db.md) interface.</span></span> <span data-ttu-id="3f805-319">这一新接口继承自核心 OLE DB 接口 ICommandWithParameters\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="3f805-319">This new interface inherits from the core OLE DB interface **ICommandWithParameters**.</span></span> <span data-ttu-id="3f805-320">除了从**ICommandWithParameters**继承的三个方法;**GetParameterInfo**、 **MapParameterNames**和**SetParameterInfo**;**ISSCommandWithParameters**提供了用于处理服务器特定数据类型的[GetParameterProperties](../../native-client-ole-db-interfaces/isscommandwithparameters-getparameterproperties-ole-db.md)和[SetParameterProperties](../../native-client-ole-db-interfaces/isscommandwithparameters-setparameterproperties-ole-db.md)方法。</span><span class="sxs-lookup"><span data-stu-id="3f805-320">In addition to the three methods inherited from **ICommandWithParameters**; **GetParameterInfo**, **MapParameterNames**, and **SetParameterInfo**; **ISSCommandWithParameters** provides the [GetParameterProperties](../../native-client-ole-db-interfaces/isscommandwithparameters-getparameterproperties-ole-db.md) and [SetParameterProperties](../../native-client-ole-db-interfaces/isscommandwithparameters-setparameterproperties-ole-db.md) methods that are used to handle server specific data types.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="3f805-321">ISSCommandWithParameters 接口也利用新的 SSPARAMPROPS 结构\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="3f805-321">The **ISSCommandWithParameters** interface also makes use of the new SSPARAMPROPS structure.</span></span>  
  
#### <a name="the-icolumnsrowset-interface"></a><span data-ttu-id="3f805-322">IColumnsRowset 接口</span><span class="sxs-lookup"><span data-stu-id="3f805-322">The IColumnsRowset Interface</span></span>  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]<span data-ttu-id="3f805-323">Native Client 将以下 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 特定列添加到**IColumnRowset：： GetColumnsRowset**方法返回的行集。</span><span class="sxs-lookup"><span data-stu-id="3f805-323">Native Client adds the following [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]-specific columns to the rowset returned by the **IColumnRowset::GetColumnsRowset** method.</span></span> <span data-ttu-id="3f805-324">这些列包含 XML 架构集合的由三个部分组成的名称。</span><span class="sxs-lookup"><span data-stu-id="3f805-324">These columns contain the three-part name of an XML schema collection.</span></span> <span data-ttu-id="3f805-325">对于非 XML 列或非类型化 XML 列，所有这三列均取默认值 NULL。</span><span class="sxs-lookup"><span data-stu-id="3f805-325">For non-XML columns or untyped XML columns, all three columns take the default value of NULL.</span></span>  
  
|<span data-ttu-id="3f805-326">列名称</span><span class="sxs-lookup"><span data-stu-id="3f805-326">Column name</span></span>|<span data-ttu-id="3f805-327">类型</span><span class="sxs-lookup"><span data-stu-id="3f805-327">Type</span></span>|<span data-ttu-id="3f805-328">说明</span><span class="sxs-lookup"><span data-stu-id="3f805-328">Description</span></span>|  
|-----------------|----------|-----------------|  
|<span data-ttu-id="3f805-329">DBCOLUMN_SS_XML_SCHEMACOLLECTION_CATALOGNAME</span><span class="sxs-lookup"><span data-stu-id="3f805-329">DBCOLUMN_SS_XML_SCHEMACOLLECTION_CATALOGNAME</span></span>|<span data-ttu-id="3f805-330">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="3f805-330">DBTYPE_WSTR</span></span>|<span data-ttu-id="3f805-331">XML 架构集合所属的目录，</span><span class="sxs-lookup"><span data-stu-id="3f805-331">The catalog an XML schema collection belongs to,</span></span><br /><br /> <span data-ttu-id="3f805-332">否则为 Null。</span><span class="sxs-lookup"><span data-stu-id="3f805-332">NULL otherwise.</span></span>|  
|<span data-ttu-id="3f805-333">DBCOLUMN_SS_XML_SCHEMACOLLECTION_SCHEMANAME</span><span class="sxs-lookup"><span data-stu-id="3f805-333">DBCOLUMN_SS_XML_SCHEMACOLLECTION_SCHEMANAME</span></span>|<span data-ttu-id="3f805-334">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="3f805-334">DBTYPE_WSTR</span></span>|<span data-ttu-id="3f805-335">XML 架构集合所属的架构。</span><span class="sxs-lookup"><span data-stu-id="3f805-335">The schema an XML schema collection belongs to.</span></span> <span data-ttu-id="3f805-336">否则为 Null。</span><span class="sxs-lookup"><span data-stu-id="3f805-336">NULL otherwise.</span></span>|  
|<span data-ttu-id="3f805-337">DBCOLUMN_SS_XML_SCHEMACOLLECTIONNAME</span><span class="sxs-lookup"><span data-stu-id="3f805-337">DBCOLUMN_SS_XML_SCHEMACOLLECTIONNAME</span></span>|<span data-ttu-id="3f805-338">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="3f805-338">DBTYPE_WSTR</span></span>|<span data-ttu-id="3f805-339">类型化 XML 列的 XML 架构集合的名称，否则为 NULL。</span><span class="sxs-lookup"><span data-stu-id="3f805-339">The name of XML schema collection for typed XML column, NULL otherwise.</span></span>|  
  
#### <a name="the-irowset-interface"></a><span data-ttu-id="3f805-340">IRowset 接口</span><span class="sxs-lookup"><span data-stu-id="3f805-340">The IRowset Interface</span></span>  
 <span data-ttu-id="3f805-341">通过 IRowset::GetData 方法检索 XML 列中的 XML 实例\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="3f805-341">An XML instance in an XML column is retrieved through the **IRowset::GetData** method.</span></span> <span data-ttu-id="3f805-342">根据由客户端指定的绑定，可以将 XML 实例作为 DBTYPE_BSTR、DBTYPE_WSTR、DBTYPE_VARIANT、DBTYPE_XML、DBTYPE_STR、DBTYPE_BYTES 进行检索，或者通过 DBTYPE_IUNKNOWN 将其作为接口检索。</span><span class="sxs-lookup"><span data-stu-id="3f805-342">Depending on the binding specified by the client, an XML instance can be retrieved as DBTYPE_BSTR, DBTYPE_WSTR, DBTYPE_VARIANT, DBTYPE_XML, DBTYPE_STR, DBTYPE_BYTES, or as an interface via DBTYPE_IUNKNOWN.</span></span> <span data-ttu-id="3f805-343">如果使用者指定 DBTYPE_BSTR、DBTYPE_WSTR 或 DBTYPE_VARIANT，则访问接口将 XML 实例转换为用户请求的类型，并将其放入在相应绑定中指定的位置。</span><span class="sxs-lookup"><span data-stu-id="3f805-343">If the consumer specifies DBTYPE_BSTR, DBTYPE_WSTR, or DBTYPE_VARIANT, the provider converts the XML instance to the user requested type and put it into the location specified in the corresponding binding.</span></span>  
  
 <span data-ttu-id="3f805-344">如果使用者指定 DBTYPE_IUNKNOWN 并将 pObject 参数设置为 NULL，或将 pObject 参数设置为 IID_ISequentialStream，则提供程序将 ISequentialStream 接口返回到使用者，让其可流式处理该列之外的 XML 数据\*\*\*\*\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="3f805-344">If the consumer specifies DBTYPE_IUNKNOWN and sets the *pObject* argument to NULL, or sets the *pObject* argument to IID_ISequentialStream, the provider returns an **ISequentialStream** interface to the consumer so that the consumer can stream the XML data out of the column.</span></span> <span data-ttu-id="3f805-345">然后，ISequentialStream 将 XML 数据作为 Unicode 字符流返回\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="3f805-345">**ISequentialStream** then returns the XML data as a Unicode character stream.</span></span>  
  
 <span data-ttu-id="3f805-346">当返回与 DBTYPE_IUNKNOWN 绑定的 XML 值时，访问接口将报告 `sizeof (IUnknown *)` 的大小值。</span><span class="sxs-lookup"><span data-stu-id="3f805-346">When returning an XML value bound to DBTYPE_IUNKNOWN, the provider reports a size value of `sizeof (IUnknown *)`.</span></span> <span data-ttu-id="3f805-347">请注意，这与在将某列绑定为 DBTYPE_IUnknown 或 DBTYPE_IDISPATCH 时所采取的方法相一致；当无法确定实际列大小时，将返回 DBTYPE_IUNKNOWN/ISequentialStream。</span><span class="sxs-lookup"><span data-stu-id="3f805-347">Note that this is consistent with the approach taken when a column is bound as DBTYPE_IUnknown or DBTYPE_IDISPATCH, and by DBTYPE_IUNKNOWN/ISequentialStream when the exact column size cannot be determined.</span></span>  
  
#### <a name="the-irowsetchange-interface"></a><span data-ttu-id="3f805-348">IRowsetChange 接口</span><span class="sxs-lookup"><span data-stu-id="3f805-348">The IRowsetChange Interface</span></span>  
 <span data-ttu-id="3f805-349">使用者可以通过两种方法更新列中的 XML 实例。</span><span class="sxs-lookup"><span data-stu-id="3f805-349">There are two ways a consumer can update an XML instance in a column.</span></span> <span data-ttu-id="3f805-350">第一种方法是使用提供程序创建的存储对象 ISequentialStream\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="3f805-350">The first one is through the storage object **ISequentialStream** created by the provider.</span></span> <span data-ttu-id="3f805-351">使用者可调用 ISequentialStream::Write 方法直接更新提供程序返回的 XML 实例\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="3f805-351">The consumer can call the **ISequentialStream::Write** method to directly update the XML instance returned by the provider.</span></span>  
  
 <span data-ttu-id="3f805-352">第二种方法是通过 IRowsetChange::SetData 或 IRowsetChange::InsertRow 方法\*\*\*\*\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="3f805-352">The second approach is through **IRowsetChange::SetData** or **IRowsetChange::InsertRow** methods.</span></span> <span data-ttu-id="3f805-353">使用这种方法，可以在类型为 DBTYPE_BSTR、DBTYPE_WSTR、DBTYPE_VARIANT、DBTYPE_XML 或 DBTYPE_IUNKNOWN 的绑定中，指定使用者缓冲区内的 XML 实例。</span><span class="sxs-lookup"><span data-stu-id="3f805-353">In this approach, an XML instance in the consumer's buffer can be specified in a binding of type DBTYPE_BSTR, DBTYPE_WSTR, DBTYPE_VARIANT, DBTYPE_XML or DBTYPE_IUNKNOWN.</span></span>  
  
 <span data-ttu-id="3f805-354">对于 DBTYPE_BSTR、DBTYPE_WSTR 或 DBTYPE_VARIANT，访问接口将位于使用者缓冲区中的 XML 实例存储到适当的列中。</span><span class="sxs-lookup"><span data-stu-id="3f805-354">In case of DBTYPE_BSTR, DBTYPE_WSTR, or DBTYPE_VARIANT, the provider stores the XML instance residing in the consumer buffer into the proper column.</span></span>  
  
 <span data-ttu-id="3f805-355">在 DBTYPE_IUNKNOWN/ISequentialStream 的情况下，如果使用者未指定任何存储对象，则使用者必须事先创建**ISequentialStream**对象，将 XML 文档与对象绑定，然后通过**IRowsetChange：： SetData**方法将该对象传递给提供程序。</span><span class="sxs-lookup"><span data-stu-id="3f805-355">In the case of DBTYPE_IUNKNOWN/ISequentialStream, if the consumer does not specify any storage object, the consumer must create an **ISequentialStream** object in advance, bind the XML document with the object, and then pass the object to the provider through the **IRowsetChange::SetData** method.</span></span> <span data-ttu-id="3f805-356">使用者还可以创建存储对象，将 pObject 参数设置为 IID_ISequentialStream，创建 ISequentialStream 对象，然后将 ISequentialStream 对象传递给 IRowsetChange::SetData 方法\*\*\*\*\*\*\*\*\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="3f805-356">The consumer can also create a storage object, set the pObject argument to IID_ISequentialStream, create an **ISequentialStream** object and then pass the **ISequentialStream** object to the **IRowsetChange::SetData** method.</span></span> <span data-ttu-id="3f805-357">在这两种情况下，提供程序都可以通过 ISequentialStream 对象检索 XML 对象，然后将其插入适当的列中\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="3f805-357">In both cases, the provider can retrieve the XML object through the **ISequentialStream** object and insert it into a proper column.</span></span>  
  
#### <a name="the-irowsetupdate-interface"></a><span data-ttu-id="3f805-358">IRowsetUpdate 接口</span><span class="sxs-lookup"><span data-stu-id="3f805-358">The IRowsetUpdate Interface</span></span>  
 <span data-ttu-id="3f805-359">IRowsetUpdate 接口提供了用于延迟更新的功能\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="3f805-359">**IRowsetUpdate** interface provides functionality for delayed updates.</span></span> <span data-ttu-id="3f805-360">在使用者调用**IRowsetUpdate： Update**方法之前，对行集可用的数据不会提供给其他事务。</span><span class="sxs-lookup"><span data-stu-id="3f805-360">The data made available to the rowsets is not made available to other transactions until the consumer calls the **IRowsetUpdate:Update** method.</span></span>  
  
#### <a name="the-irowsetfind-interface"></a><span data-ttu-id="3f805-361">IRowsetFind 接口</span><span class="sxs-lookup"><span data-stu-id="3f805-361">The IRowsetFind Interface</span></span>  
 <span data-ttu-id="3f805-362">IRowsetFind::FindNextRow 方法不使用 xml 数据类型\*\*\*\*\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="3f805-362">The **IRowsetFind::FindNextRow** method does not work with the **xml** data type.</span></span> <span data-ttu-id="3f805-363">调用 IRowsetFind::FindNextRow 且 hAccessor 参数指定 DBTYPE_XML 列时，返回 DB_E_BADBINDINFO\*\*\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="3f805-363">When **IRowsetFind::FindNextRow** is called and the *hAccessor* argument specifies a column of DBTYPE_XML, DB_E_BADBINDINFO is returned.</span></span> <span data-ttu-id="3f805-364">此时不考虑正在搜索的列的类型。</span><span class="sxs-lookup"><span data-stu-id="3f805-364">This occurs regardless of the type of column that is being searched.</span></span> <span data-ttu-id="3f805-365">对于任何其他绑定类型，如果要搜索的列属于 xml 数据类型，则 FindNextRow 将失败并返回 DB_E_BADCOMPAREOP\*\*\*\*\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="3f805-365">For any other binding type, the **FindNextRow** fails with DB_E_BADCOMPAREOP if the column to be searched is of the **xml** data type.</span></span>  
  
## <a name="sql-server-native-client-odbc-driver"></a><span data-ttu-id="3f805-366">SQL Server Native Client ODBC 驱动程序</span><span class="sxs-lookup"><span data-stu-id="3f805-366">SQL Server Native Client ODBC Driver</span></span>  
 <span data-ttu-id="3f805-367">在 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native CLIENT ODBC 驱动程序中，对各种函数进行了一些更改以支持**xml**数据类型。</span><span class="sxs-lookup"><span data-stu-id="3f805-367">In the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver, a number of changes have been made to various functions to support the **xml** data type.</span></span>  
  
### <a name="sqlcolattribute"></a><span data-ttu-id="3f805-368">SQLColAttribute</span><span class="sxs-lookup"><span data-stu-id="3f805-368">SQLColAttribute</span></span>  
 <span data-ttu-id="3f805-369">[SQLColAttribute](../../native-client-odbc-api/sqlcolattribute.md)函数具有三个新的字段标识符，包括 SQL_CA_SS_XML_SCHEMACOLLECTION_CATALOG_NAME、SQL_CA_SS_XML_SCHEMACOLLECTION_SCHEMA_NAME 和 SQL_CA_SS _XML_SCHEMACOLLECTION_NAME。</span><span class="sxs-lookup"><span data-stu-id="3f805-369">The [SQLColAttribute](../../native-client-odbc-api/sqlcolattribute.md) function has three new field identifiers, including SQL_CA_SS_XML_SCHEMACOLLECTION_CATALOG_NAME, SQL_CA_SS_XML_SCHEMACOLLECTION_SCHEMA_NAME, and SQL_CA_SS _XML_SCHEMACOLLECTION_NAME.</span></span>  
  
 <span data-ttu-id="3f805-370">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Native CLIENT ODBC 驱动程序报告 SQL_DESC_DISPLAY_SIZE 和 SQL_DESC_LENGTH 列 SQL_SS_LENGTH_UNLIMITED。</span><span class="sxs-lookup"><span data-stu-id="3f805-370">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver reports SQL_SS_LENGTH_UNLIMITED for the SQL_DESC_DISPLAY_SIZE and SQL_DESC_LENGTH columns.</span></span>  
  
### <a name="sqlcolumns"></a><span data-ttu-id="3f805-371">SQLColumns</span><span class="sxs-lookup"><span data-stu-id="3f805-371">SQLColumns</span></span>  
 <span data-ttu-id="3f805-372">[SQLColumns](../../native-client-odbc-api/sqlcolumns.md)函数包含三个新列，其中包括 SS_XML_SCHEMACOLLECTION_CATALOG_NAME、SS_XML_SCHEMACOLLECTION_SCHEMA_NAME 和 SS_XML_SCHEMACOLLECTION_NAME。</span><span class="sxs-lookup"><span data-stu-id="3f805-372">The [SQLColumns](../../native-client-odbc-api/sqlcolumns.md) function has three new columns including SS_XML_SCHEMACOLLECTION_CATALOG_NAME, SS_XML_SCHEMACOLLECTION_SCHEMA_NAME, and SS_XML_SCHEMACOLLECTION_NAME.</span></span> <span data-ttu-id="3f805-373">现有的 TYPE_NAME 列用于指示 XML 类型的名称，而 XML 类型列或参数的 DATA_TYPE 为 SQL_SS_XML。</span><span class="sxs-lookup"><span data-stu-id="3f805-373">The existing TYPE_NAME column is used to indicate the name of the XML type, and the DATA_TYPE for a XML type column or parameter is SQL_SS_XML.</span></span>  
  
 <span data-ttu-id="3f805-374">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Native CLIENT ODBC 驱动程序报告 COLUMN_SIZE 和 CHAR_OCTET_LENGTH 值 SQL_SS_LENGTH_UNLIMITED。</span><span class="sxs-lookup"><span data-stu-id="3f805-374">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver reports SQL_SS_LENGTH_UNLIMITED for the COLUMN_SIZE and CHAR_OCTET_LENGTH values.</span></span>  
  
### <a name="sqldescribecol"></a><span data-ttu-id="3f805-375">SQLDescribeCol</span><span class="sxs-lookup"><span data-stu-id="3f805-375">SQLDescribeCol</span></span>  
 <span data-ttu-id="3f805-376">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]当无法在[SQLDescribeCol](../../native-client-odbc-api/sqldescribecol.md)函数中确定列大小时，Native Client ODBC 驱动程序将报告 SQL_SS_LENGTH_UNLIMITED。</span><span class="sxs-lookup"><span data-stu-id="3f805-376">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver reports SQL_SS_LENGTH_UNLIMITED when the column size cannot be determined in the [SQLDescribeCol](../../native-client-odbc-api/sqldescribecol.md) function.</span></span>  
  
### <a name="sqlgettypeinfo"></a><span data-ttu-id="3f805-377">SQLGetTypeInfo</span><span class="sxs-lookup"><span data-stu-id="3f805-377">SQLGetTypeInfo</span></span>  
 <span data-ttu-id="3f805-378">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Native CLIENT ODBC 驱动程序报告 SQL_SS_LENGTH_UNLIMITED 作为[SQLGetTypeInfo](../../native-client-odbc-api/sqlgettypeinfo.md)函数中**xml**数据类型的最大 COLUMN_SIZE。</span><span class="sxs-lookup"><span data-stu-id="3f805-378">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver reports SQL_SS_LENGTH_UNLIMITED as the maximum COLUMN_SIZE for the **xml** data type in the [SQLGetTypeInfo](../../native-client-odbc-api/sqlgettypeinfo.md) function.</span></span>  
  
### <a name="sqlprocedurecolumns"></a><span data-ttu-id="3f805-379">SQLProcedureColumns</span><span class="sxs-lookup"><span data-stu-id="3f805-379">SQLProcedureColumns</span></span>  
 <span data-ttu-id="3f805-380">[SQLProcedureColumns](../../native-client-odbc-api/sqlprocedurecolumns.md)函数具有与**SQLColumns**函数相同的列添加。</span><span class="sxs-lookup"><span data-stu-id="3f805-380">The [SQLProcedureColumns](../../native-client-odbc-api/sqlprocedurecolumns.md) function has the same column additions as the **SQLColumns** function.</span></span>  
  
 <span data-ttu-id="3f805-381">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Native CLIENT ODBC 驱动程序报告 SQL_SS_LENGTH_UNLIMITED 作为**xml**数据类型的最大 COLUMN_SIZE。</span><span class="sxs-lookup"><span data-stu-id="3f805-381">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver reports SQL_SS_LENGTH_UNLIMITED as the maximum COLUMN_SIZE for the **xml** data type.</span></span>  
  
### <a name="supported-conversions"></a><span data-ttu-id="3f805-382">支持的转换</span><span class="sxs-lookup"><span data-stu-id="3f805-382">Supported Conversions</span></span>  
 <span data-ttu-id="3f805-383">当从 SQL 转换为 C 数据类型时，SQL_C_WCHAR、SQL_C_BINARY 和 SQL_C_CHAR 可全部转换为 SQL_SS_XML，但必须符合以下规定：</span><span class="sxs-lookup"><span data-stu-id="3f805-383">When converting from SQL to C data types, SQL_C_WCHAR, SQL_C_BINARY, and SQL_C_CHAR can all be converted to SQL_SS_XML, with the following stipulations:</span></span>  
  
-   <span data-ttu-id="3f805-384">SQL_C_WCHAR：格式为 UTF-16，无字节顺序标记 (BOM)，无空终止。</span><span class="sxs-lookup"><span data-stu-id="3f805-384">SQL_C_WCHAR: Format is UTF-16, no byte-order mark (BOM), with null termination.</span></span>  
  
-   <span data-ttu-id="3f805-385">SQL_C_BINARY：格式为 UTF-16，无空终止。</span><span class="sxs-lookup"><span data-stu-id="3f805-385">SQL_C_BINARY: Format is UTF-16, with no null termination.</span></span> <span data-ttu-id="3f805-386">向从服务器接收的数据添加一个 BOM。</span><span class="sxs-lookup"><span data-stu-id="3f805-386">A BOM is added to data received from the server.</span></span> <span data-ttu-id="3f805-387">如果服务器返回了空字符串，则仍然将 BOM 返回给应用程序。</span><span class="sxs-lookup"><span data-stu-id="3f805-387">If an empty string is returned by the server a BOM is still returned to the application.</span></span> <span data-ttu-id="3f805-388">如果缓冲区长度的字节数为奇数，则会正确地截断数据。</span><span class="sxs-lookup"><span data-stu-id="3f805-388">If the buffer length is an odd number of bytes the data ise truncated correctly.</span></span> <span data-ttu-id="3f805-389">如果分块区返回了整个值，则可以将它们连接起来以重新构建正确的值。</span><span class="sxs-lookup"><span data-stu-id="3f805-389">If the whole value is returned in chunks they can be concatenated to re-constitute the correct value</span></span>  
  
-   <span data-ttu-id="3f805-390">SQL_C_CHAR：格式为在客户端代码页中编码的带有空终止的多字节字符。</span><span class="sxs-lookup"><span data-stu-id="3f805-390">SQL_C_CHAR: Format is multibyte characters encoded in client code page with null termination.</span></span> <span data-ttu-id="3f805-391">从服务器提供的 UTF-16 进行转换可能导致数据损坏，因此，强烈建议不要使用此绑定。</span><span class="sxs-lookup"><span data-stu-id="3f805-391">Conversion from server supplied UTF-16 may cause data corruption, so this binding is strongly discouraged.</span></span>  
  
 <span data-ttu-id="3f805-392">当从 C 转换为 SQL 数据类型时，SQL_C_WCHAR、SQL_C_BINARY 和 SQL_C_CHAR 可全部转换为 SQL_SS_XML，但必须符合以下规定：</span><span class="sxs-lookup"><span data-stu-id="3f805-392">When converting from C to SQL data types, SQL_C_WCHAR, SQL_C_BINARY, and SQL_C_CHAR can all be converted to SQL_SS_XML, with the following stipulations:</span></span>  
  
-   <span data-ttu-id="3f805-393">SQL_C_WCHAR：始终向发送到服务器的数据添加一个 BOM。</span><span class="sxs-lookup"><span data-stu-id="3f805-393">SQL_C_WCHAR: A BOM is always be added to data sent to the server.</span></span> <span data-ttu-id="3f805-394">如果数据已经以一个 BOM 开始，则这可能导致在缓冲区的开头具有两个 BOM。</span><span class="sxs-lookup"><span data-stu-id="3f805-394">If the data already started with a BOM, this results in two BOMs at the start of the buffer.</span></span> <span data-ttu-id="3f805-395">服务器使用第一个 BOM 将编码识别为 UTF-16，然后放弃它。</span><span class="sxs-lookup"><span data-stu-id="3f805-395">The server uses the first BOM to recognize the encoding as UTF-16 and then discard it.</span></span> <span data-ttu-id="3f805-396">第二个 BOM 将被解释为零宽度不间断空格字符。</span><span class="sxs-lookup"><span data-stu-id="3f805-396">The second BOM is interpreted as a zero-width nonbreaking space character.</span></span>  
  
-   <span data-ttu-id="3f805-397">SQL_C_BINARY：不执行转换，数据“按原样”传递到服务器。</span><span class="sxs-lookup"><span data-stu-id="3f805-397">SQL_C_BINARY: No conversion is performed, and the data is passed to the server "as is."</span></span> <span data-ttu-id="3f805-398">UTF-16 数据必须以 BOM 为开头；否则，服务器可能无法正确地识别编码。</span><span class="sxs-lookup"><span data-stu-id="3f805-398">UTF-16 data must start with a BOM; if it does not, the encoding may not be correctly recognized by the server.</span></span>  
  
-   <span data-ttu-id="3f805-399">SQL_C_CHAR：数据在客户端上转换为 UTF-16 并发送到服务器，就像 SQL_C_WCHAR 一样（包括添加 BOM）。</span><span class="sxs-lookup"><span data-stu-id="3f805-399">SQL_C_CHAR: The data is converted to UTF-16 on the client and sent to the server just as SQL_C_WCHAR (including the addition of a BOM).</span></span> <span data-ttu-id="3f805-400">如果未在客户端代码页中对 XML 进行编码，则这可能导致数据损坏。</span><span class="sxs-lookup"><span data-stu-id="3f805-400">If the XML is not encoded in the client code page this can cause data corruption.</span></span>  
  
 <span data-ttu-id="3f805-401">XML 标准要求 UTF-16 编码的 XML，以便以字节顺序标记 (BOM) UTF-16 字符代码 0xFEFF 开头。</span><span class="sxs-lookup"><span data-stu-id="3f805-401">The XML standard requires UTF-16 encoded XML to start with a byte-order mark (BOM), UTF-16 character code 0xFEFF.</span></span> <span data-ttu-id="3f805-402">使用 SQL_C_BINARY 绑定时， [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 不需要或添加 BOM，因为绑定隐含了编码。</span><span class="sxs-lookup"><span data-stu-id="3f805-402">When working with a SQL_C_BINARY binding, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client does not require or add a BOM, as the encoding is implied by the binding.</span></span> <span data-ttu-id="3f805-403">其目的是为了在处理其他 XML 处理器和存储系统时提供简便性。</span><span class="sxs-lookup"><span data-stu-id="3f805-403">The intent is to provide simplicity in dealing with other XML processors and storage systems.</span></span> <span data-ttu-id="3f805-404">在此情况下，应向 UTF-16 编码的 XML 提供 BOM，并且应用程序无需关心实际编码，因为绝大多数的 XML 处理器（包括 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]）会通过检查该值的前几个字节推导出编码。</span><span class="sxs-lookup"><span data-stu-id="3f805-404">In this case a BOM should be present with UTF-16 encoded XML, and the application need not be concerned with the actual encoding, because the majority of XML processors (including [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]) deduce the encoding by inspecting the first few bytes of the value.</span></span> <span data-ttu-id="3f805-405">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]使用 SQL_C_BINARY 绑定从 Native Client 收到的 XML 数据始终以 utf-16 进行编码，并且具有 BOM，不带嵌入的编码声明。</span><span class="sxs-lookup"><span data-stu-id="3f805-405">XML data received from [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client using SQL_C_BINARY bindings are always encoded in UTF-16 with a BOM and without an embedded encoding declaration.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="3f805-406">另请参阅</span><span class="sxs-lookup"><span data-stu-id="3f805-406">See Also</span></span>  
 <span data-ttu-id="3f805-407">[SQL Server Native Client 功能](sql-server-native-client-features.md) </span><span class="sxs-lookup"><span data-stu-id="3f805-407">[SQL Server Native Client Features](sql-server-native-client-features.md) </span></span>  
 [<span data-ttu-id="3f805-408">ISSCommandWithParameters &#40;OLE DB&#41;</span><span class="sxs-lookup"><span data-stu-id="3f805-408">ISSCommandWithParameters &#40;OLE DB&#41;</span></span>](../../native-client-ole-db-interfaces/isscommandwithparameters-ole-db.md)  
  
  
