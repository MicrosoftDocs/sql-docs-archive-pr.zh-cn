---
title: 使用不带验证的加密 | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- data access [SQL Server Native Client], encryption
- cryptography [SQL Server Native Client]
- SQLNCLI, encryption
- encryption [SQL Server Native Client]
- SQL Server Native Client, encryption
ms.assetid: f4c63206-80bb-4d31-84ae-ccfcd563effa
author: rothja
ms.author: jroth
ms.openlocfilehash: 0a6d2e8b3d696a92e3fa3e1b7de7604551d4f9ce
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87578852"
---
# <a name="using-encryption-without-validation"></a><span data-ttu-id="4b9df-102">使用不带验证的加密</span><span class="sxs-lookup"><span data-stu-id="4b9df-102">Using Encryption Without Validation</span></span>
  [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="4b9df-103">始终对与登录相关的网络数据包进行加密。</span><span class="sxs-lookup"><span data-stu-id="4b9df-103">always encrypts network packets associated with logging in.</span></span> <span data-ttu-id="4b9df-104">如果在服务器启动时未为其提供任何证书，[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 将生成可用于对登录数据包进行加密的自签名证书。</span><span class="sxs-lookup"><span data-stu-id="4b9df-104">If no certificate has been provisioned on the server when it starts up, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] generates a self-signed certificate which is used to encrypt login packets.</span></span>  
  
 <span data-ttu-id="4b9df-105">应用程序还可以通过使用连接字符串关键字或连接属性请求对所有网络流量加密。</span><span class="sxs-lookup"><span data-stu-id="4b9df-105">Applications may also request encryption of all network traffic by using connection string keywords or connection properties.</span></span> <span data-ttu-id="4b9df-106">当使用包含**IDbInitialize：： Initialize**的提供程序字符串或在 OLE DB 将初始化字符串与**IDataInitialize**结合使用时，这些关键字对 ODBC 和 OLE DB 使用提供程序字符串。</span><span class="sxs-lookup"><span data-stu-id="4b9df-106">The keywords are "Encrypt" for ODBC and OLE DB when using a provider string with **IDbInitialize::Initialize**, or "Use Encryption for Data" for ADO and OLE DB when using an initialization string with **IDataInitialize**.</span></span> <span data-ttu-id="4b9df-107">这还可以 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 使用 "**强制协议加密**" 选项 Configuration Manager 进行配置。</span><span class="sxs-lookup"><span data-stu-id="4b9df-107">This may also be configured by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Configuration Manager using the **Force Protocol Encryption** option.</span></span> <span data-ttu-id="4b9df-108">默认情况下，对某一连接的所有网络流量加密要求在服务器上设置证书。</span><span class="sxs-lookup"><span data-stu-id="4b9df-108">By default, encryption of all network traffic for a connection requires that a certificate be provisioned on the server.</span></span>  
  
 <span data-ttu-id="4b9df-109">有关连接字符串关键字的详细信息，请参阅将[连接字符串关键字用于 SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md)。</span><span class="sxs-lookup"><span data-stu-id="4b9df-109">For information about connection string keywords, see [Using Connection String Keywords with SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md).</span></span>  
  
 <span data-ttu-id="4b9df-110">若要在服务器上未设置证书时启用加密，可以使用 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 配置管理器设置“强制协议加密”和“信任服务器证书”选项\*\*\*\*\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="4b9df-110">To enable encryption to be used when a certificate has not been provisioned on the server, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Configuration Manager can be used to set both the **Force Protocol Encryption** and the **Trust Server Certificate** options.</span></span> <span data-ttu-id="4b9df-111">在这种情况下，如果服务器上未设置可验证的证书，加密将使用不带验证的自签名服务器证书。</span><span class="sxs-lookup"><span data-stu-id="4b9df-111">In this case, encryption will use a self-signed server certificate without validation if no verifiable certificate has been provisioned on the server.</span></span>  
  
 <span data-ttu-id="4b9df-112">应用程序还可以使用 "TrustServerCertificate" 关键字或与其关联的连接属性确保执行加密。</span><span class="sxs-lookup"><span data-stu-id="4b9df-112">Applications may also use the "TrustServerCertificate" keyword or its associated connection attribute to guarantee that encryption takes place.</span></span> <span data-ttu-id="4b9df-113">应用程序设置从不会降低 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 客户端配置管理器设置的安全级别，相反还可能提高安全级别。</span><span class="sxs-lookup"><span data-stu-id="4b9df-113">Application settings never reduce the level of security set by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Client Configuration Manager, but may strengthen it.</span></span> <span data-ttu-id="4b9df-114">例如，如果没有为客户端设置“强制协议加密”，应用程序可能自行请求加密\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="4b9df-114">For example, if **Force Protocol Encryption** is not set for the client, an application may request encryption itself.</span></span> <span data-ttu-id="4b9df-115">甚至是在未设置服务器证书的情况下，为保证加密，应用程序也可能请求加密和 "TrustServerCertificate"。</span><span class="sxs-lookup"><span data-stu-id="4b9df-115">To guarantee encryption even when a server certificate has not been provisioned, an application may request encryption and "TrustServerCertificate".</span></span> <span data-ttu-id="4b9df-116">不过，如果在客户端配置中未启用 "TrustServerCertificate"，则仍需要已设置的服务器证书。</span><span class="sxs-lookup"><span data-stu-id="4b9df-116">However, if "TrustServerCertificate" is not enabled in the client configuration, a provisioned server certificate is still required.</span></span> <span data-ttu-id="4b9df-117">下表介绍了各种情况：</span><span class="sxs-lookup"><span data-stu-id="4b9df-117">The following table describes all cases:</span></span>  
  
|<span data-ttu-id="4b9df-118">“强制协议加密”客户端设置</span><span class="sxs-lookup"><span data-stu-id="4b9df-118">Force Protocol Encryption client setting</span></span>|<span data-ttu-id="4b9df-119">“信任服务器证书”客户端设置</span><span class="sxs-lookup"><span data-stu-id="4b9df-119">Trust Server Certificate client setting</span></span>|<span data-ttu-id="4b9df-120">连接字符串/连接属性加密/对数据使用加密</span><span class="sxs-lookup"><span data-stu-id="4b9df-120">Connection string/connection attribute Encrypt/Use Encryption for Data</span></span>|<span data-ttu-id="4b9df-121">连接字符串/连接属性信任服务器证书</span><span class="sxs-lookup"><span data-stu-id="4b9df-121">Connection string/connection attribute Trust Server Certificate</span></span>|<span data-ttu-id="4b9df-122">结果</span><span class="sxs-lookup"><span data-stu-id="4b9df-122">Result</span></span>|  
|----------------------------------------------|---------------------------------------------|------------------------------------------------------------------------------|----------------------------------------------------------------------|------------|  
|<span data-ttu-id="4b9df-123">否</span><span class="sxs-lookup"><span data-stu-id="4b9df-123">No</span></span>|<span data-ttu-id="4b9df-124">空值</span><span class="sxs-lookup"><span data-stu-id="4b9df-124">N/A</span></span>|<span data-ttu-id="4b9df-125">否（默认值）</span><span class="sxs-lookup"><span data-stu-id="4b9df-125">No (default)</span></span>|<span data-ttu-id="4b9df-126">忽略</span><span class="sxs-lookup"><span data-stu-id="4b9df-126">Ignored</span></span>|<span data-ttu-id="4b9df-127">无加密。</span><span class="sxs-lookup"><span data-stu-id="4b9df-127">No encryption occurs.</span></span>|  
|<span data-ttu-id="4b9df-128">否</span><span class="sxs-lookup"><span data-stu-id="4b9df-128">No</span></span>|<span data-ttu-id="4b9df-129">空值</span><span class="sxs-lookup"><span data-stu-id="4b9df-129">N/A</span></span>|<span data-ttu-id="4b9df-130">是</span><span class="sxs-lookup"><span data-stu-id="4b9df-130">Yes</span></span>|<span data-ttu-id="4b9df-131">否（默认值）</span><span class="sxs-lookup"><span data-stu-id="4b9df-131">No (default)</span></span>|<span data-ttu-id="4b9df-132">仅当存在可验证的服务器证书时才加密，否则连接尝试将失败。</span><span class="sxs-lookup"><span data-stu-id="4b9df-132">Encryption occurs only if there is a verifiable server certificate, otherwise the connection attempt fails.</span></span>|  
|<span data-ttu-id="4b9df-133">否</span><span class="sxs-lookup"><span data-stu-id="4b9df-133">No</span></span>|<span data-ttu-id="4b9df-134">空值</span><span class="sxs-lookup"><span data-stu-id="4b9df-134">N/A</span></span>|<span data-ttu-id="4b9df-135">是</span><span class="sxs-lookup"><span data-stu-id="4b9df-135">Yes</span></span>|<span data-ttu-id="4b9df-136">是</span><span class="sxs-lookup"><span data-stu-id="4b9df-136">Yes</span></span>|<span data-ttu-id="4b9df-137">始终加密，但可能使用自签名的服务器证书。</span><span class="sxs-lookup"><span data-stu-id="4b9df-137">Encryption always occurs, but may use a self-signed server certificate.</span></span>|  
|<span data-ttu-id="4b9df-138">是</span><span class="sxs-lookup"><span data-stu-id="4b9df-138">Yes</span></span>|<span data-ttu-id="4b9df-139">否</span><span class="sxs-lookup"><span data-stu-id="4b9df-139">No</span></span>|<span data-ttu-id="4b9df-140">忽略</span><span class="sxs-lookup"><span data-stu-id="4b9df-140">Ignored</span></span>|<span data-ttu-id="4b9df-141">忽略</span><span class="sxs-lookup"><span data-stu-id="4b9df-141">Ignored</span></span>|<span data-ttu-id="4b9df-142">仅当存在可验证的服务器证书时才加密，否则连接尝试将失败。</span><span class="sxs-lookup"><span data-stu-id="4b9df-142">Encryption occurs only if there is a verifiable server certificate, otherwise the connection attempt fails.</span></span>|  
|<span data-ttu-id="4b9df-143">是</span><span class="sxs-lookup"><span data-stu-id="4b9df-143">Yes</span></span>|<span data-ttu-id="4b9df-144">是</span><span class="sxs-lookup"><span data-stu-id="4b9df-144">Yes</span></span>|<span data-ttu-id="4b9df-145">否（默认值）</span><span class="sxs-lookup"><span data-stu-id="4b9df-145">No (default)</span></span>|<span data-ttu-id="4b9df-146">忽略</span><span class="sxs-lookup"><span data-stu-id="4b9df-146">Ignored</span></span>|<span data-ttu-id="4b9df-147">始终加密，但可能使用自签名的服务器证书。</span><span class="sxs-lookup"><span data-stu-id="4b9df-147">Encryption always occurs, but may use a self-signed server certificate.</span></span>|  
|<span data-ttu-id="4b9df-148">是</span><span class="sxs-lookup"><span data-stu-id="4b9df-148">Yes</span></span>|<span data-ttu-id="4b9df-149">是</span><span class="sxs-lookup"><span data-stu-id="4b9df-149">Yes</span></span>|<span data-ttu-id="4b9df-150">是</span><span class="sxs-lookup"><span data-stu-id="4b9df-150">Yes</span></span>|<span data-ttu-id="4b9df-151">否（默认值）</span><span class="sxs-lookup"><span data-stu-id="4b9df-151">No (default)</span></span>|<span data-ttu-id="4b9df-152">仅当存在可验证的服务器证书时才加密，否则连接尝试将失败。</span><span class="sxs-lookup"><span data-stu-id="4b9df-152">Encryption occurs only if there is a verifiable server certificate, otherwise the connection attempt fails.</span></span>|  
|<span data-ttu-id="4b9df-153">是</span><span class="sxs-lookup"><span data-stu-id="4b9df-153">Yes</span></span>|<span data-ttu-id="4b9df-154">是</span><span class="sxs-lookup"><span data-stu-id="4b9df-154">Yes</span></span>|<span data-ttu-id="4b9df-155">是</span><span class="sxs-lookup"><span data-stu-id="4b9df-155">Yes</span></span>|<span data-ttu-id="4b9df-156">是</span><span class="sxs-lookup"><span data-stu-id="4b9df-156">Yes</span></span>|<span data-ttu-id="4b9df-157">始终加密，但可能使用自签名的服务器证书。</span><span class="sxs-lookup"><span data-stu-id="4b9df-157">Encryption always occurs, but might use a self-signed server certificate.</span></span>|  
  
## <a name="sql-server-native-client-ole-db-provider"></a><span data-ttu-id="4b9df-158">SQL Server Native Client OLE DB 访问接口</span><span class="sxs-lookup"><span data-stu-id="4b9df-158">SQL Server Native Client OLE DB Provider</span></span>  
 <span data-ttu-id="4b9df-159">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Native Client OLE DB 提供程序通过添加 SSPROP_INIT_TRUST_SERVER_CERTIFICATE 数据源初始化属性（在 DBPROPSET_SQLSERVERDBINIT 属性集中实现）来支持未经验证的加密。</span><span class="sxs-lookup"><span data-stu-id="4b9df-159">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports encryption without validation through the addition of the SSPROP_INIT_TRUST_SERVER_CERTIFICATE data source initialization property, which is implemented in the DBPROPSET_SQLSERVERDBINIT property set.</span></span> <span data-ttu-id="4b9df-160">此外，还添加了新的连接字符串关键字“TrustServerCertificate”。</span><span class="sxs-lookup"><span data-stu-id="4b9df-160">In addition, a new connection string keyword, "TrustServerCertificate", as been added.</span></span> <span data-ttu-id="4b9df-161">它接受值 yes 或 no；默认值为 no。</span><span class="sxs-lookup"><span data-stu-id="4b9df-161">It accepts yes or no values; no is the default.</span></span> <span data-ttu-id="4b9df-162">使用服务组件时，它接受值 true 或 false；默认值为 false。</span><span class="sxs-lookup"><span data-stu-id="4b9df-162">When using service components, it accepts true or false values; false is the default.</span></span>  
  
 <span data-ttu-id="4b9df-163">若要详细了解 DBPROPSET_SQLSERVERDBINIT 属性集的增强，请参阅[初始化和授权属性](../../native-client-ole-db-data-source-objects/initialization-and-authorization-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="4b9df-163">For more information about enhancements made to the DBPROPSET_SQLSERVERDBINIT property set, see [Initialization and Authorization Properties](../../native-client-ole-db-data-source-objects/initialization-and-authorization-properties.md).</span></span>  
  
## <a name="sql-server-native-client-odbc-driver"></a><span data-ttu-id="4b9df-164">SQL Server Native Client ODBC 驱动程序</span><span class="sxs-lookup"><span data-stu-id="4b9df-164">SQL Server Native Client ODBC Driver</span></span>  
 <span data-ttu-id="4b9df-165">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Native CLIENT ODBC 驱动程序通过向[SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md)和[SQLGetConnectAttr](../../native-client-odbc-api/sqlgetconnectattr.md)函数添加内容来支持未经验证的加密。</span><span class="sxs-lookup"><span data-stu-id="4b9df-165">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver supports encryption without validation through additions to the [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) and [SQLGetConnectAttr](../../native-client-odbc-api/sqlgetconnectattr.md) functions.</span></span> <span data-ttu-id="4b9df-166">添加了 SQL_COPT_SS_TRUST_SERVER_CERTIFICATE 以接受 SQL_TRUST_SERVER_CERTIFICATE_YES 或 SQL_TRUST_SERVER_CERTIFICATE_NO，默认值为 SQL_TRUST_SERVER_CERTIFICATE_NO。</span><span class="sxs-lookup"><span data-stu-id="4b9df-166">SQL_COPT_SS_TRUST_SERVER_CERTIFICATE has been added to accept either SQL_TRUST_SERVER_CERTIFICATE_YES or SQL_TRUST_SERVER_CERTIFICATE_NO, with SQL_TRUST_SERVER_CERTIFICATE_NO being the default.</span></span> <span data-ttu-id="4b9df-167">此外，还添加了新的连接字符串关键字 "TrustServerCertificate"。</span><span class="sxs-lookup"><span data-stu-id="4b9df-167">In addition, a new connection string keyword, "TrustServerCertificate", has been added.</span></span> <span data-ttu-id="4b9df-168">它接受值 yes 或 no；默认值为 no。</span><span class="sxs-lookup"><span data-stu-id="4b9df-168">It accepts yes or no values; "no" is the default.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4b9df-169">另请参阅</span><span class="sxs-lookup"><span data-stu-id="4b9df-169">See Also</span></span>  
 [<span data-ttu-id="4b9df-170">SQL Server Native Client 功能</span><span class="sxs-lookup"><span data-stu-id="4b9df-170">SQL Server Native Client Features</span></span>](sql-server-native-client-features.md)  
  
  
