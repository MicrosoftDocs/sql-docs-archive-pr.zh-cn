---
title: " (ODBC) 的客户端连接中的服务主体名称 (Spn) Microsoft Docs"
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
ms.assetid: 1d60cb30-4c46-49b2-89ab-701e77a330a2
author: rothja
ms.author: jroth
ms.openlocfilehash: 752cbdbf017fac6d086b9493c23ea7a490ac6ef7
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87690589"
---
# <a name="service-principal-names-spns-in-client-connections-odbc"></a><span data-ttu-id="d7836-102">客户端连接中的服务主体名称 (SPN) (ODBC)</span><span class="sxs-lookup"><span data-stu-id="d7836-102">Service Principal Names (SPNs) in Client Connections (ODBC)</span></span>
  <span data-ttu-id="d7836-103">本主题介绍支持客户端应用程序中的服务主体名称 (SPN) 的 ODBC 属性和函数。</span><span class="sxs-lookup"><span data-stu-id="d7836-103">This topic describes ODBC attributes and functions that support service principal names (SPNs) in client applications.</span></span> <span data-ttu-id="d7836-104">有关客户端应用程序中的 Spn 的详细信息，请参阅[客户端连接中的服务主体名称 &#40;spn&#41; 支持](../features/service-principal-name-spn-support-in-client-connections.md)和[获取相互 Kerberos 身份验证](../../native-client-odbc-how-to/get-mutual-kerberos-authentication.md)。</span><span class="sxs-lookup"><span data-stu-id="d7836-104">For more information about SPNs in client applications, see [Service Principal Name &#40;SPN&#41; Support in Client Connections](../features/service-principal-name-spn-support-in-client-connections.md) and [Get Mutual Kerberos Authentication](../../native-client-odbc-how-to/get-mutual-kerberos-authentication.md).</span></span>  
  
## <a name="connection-string-keywords"></a><span data-ttu-id="d7836-105">连接字符串关键字</span><span class="sxs-lookup"><span data-stu-id="d7836-105">Connection String Keywords</span></span>  
 <span data-ttu-id="d7836-106">客户端应用程序使用以下连接字符串关键字可指定 SPN。</span><span class="sxs-lookup"><span data-stu-id="d7836-106">The following connection string keywords enable client applications to specify an SPN.</span></span>  
  
|<span data-ttu-id="d7836-107">关键字</span><span class="sxs-lookup"><span data-stu-id="d7836-107">Keyword</span></span>|<span data-ttu-id="d7836-108">值</span><span class="sxs-lookup"><span data-stu-id="d7836-108">Value</span></span>|  
|-------------|-----------|  
|`ServerSPN`|<span data-ttu-id="d7836-109">服务器的 SPN。</span><span class="sxs-lookup"><span data-stu-id="d7836-109">The SPN for the server.</span></span> <span data-ttu-id="d7836-110">默认值是空字符串，这将导致 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 使用默认的驱动程序生成的 SPN。</span><span class="sxs-lookup"><span data-stu-id="d7836-110">The default value is an empty string, which causes [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client to use the default, driver-generated SPN.</span></span>|  
|`FailoverPartnerSPN`|<span data-ttu-id="d7836-111">故障转移伙伴的 SPN。</span><span class="sxs-lookup"><span data-stu-id="d7836-111">The SPN for the failover partner.</span></span> <span data-ttu-id="d7836-112">默认值是空字符串，这将导致 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 使用默认的驱动程序生成的 SPN。</span><span class="sxs-lookup"><span data-stu-id="d7836-112">The default value is an empty string, which causes [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client to use the default, driver-generated SPN.</span></span>|  
  
## <a name="connection-attributes"></a><span data-ttu-id="d7836-113">连接属性</span><span class="sxs-lookup"><span data-stu-id="d7836-113">Connection Attributes</span></span>  
 <span data-ttu-id="d7836-114">客户端应用程序使用以下连接属性可指定 SPN 和查询身份验证方法。</span><span class="sxs-lookup"><span data-stu-id="d7836-114">The following connection attributes enable client applications to specify an SPN and query for the authentication method.</span></span>  
  
|<span data-ttu-id="d7836-115">名称</span><span class="sxs-lookup"><span data-stu-id="d7836-115">Name</span></span>|<span data-ttu-id="d7836-116">类型</span><span class="sxs-lookup"><span data-stu-id="d7836-116">Type</span></span>|<span data-ttu-id="d7836-117">使用情况</span><span class="sxs-lookup"><span data-stu-id="d7836-117">Usage</span></span>|  
|----------|----------|-----------|  
|<span data-ttu-id="d7836-118">SQL_COPT_SS_SERVER_SPN</span><span class="sxs-lookup"><span data-stu-id="d7836-118">SQL_COPT_SS_SERVER_SPN</span></span><br /><br /> <span data-ttu-id="d7836-119">SQL_COPT_SS_FAILOVER_PARTNER_SPN</span><span class="sxs-lookup"><span data-stu-id="d7836-119">SQL_COPT_SS_FAILOVER_PARTNER_SPN</span></span>|<span data-ttu-id="d7836-120">SQLTCHAR，读/写</span><span class="sxs-lookup"><span data-stu-id="d7836-120">SQLTCHAR, read/write</span></span>|<span data-ttu-id="d7836-121">指定服务器的 SPN。</span><span class="sxs-lookup"><span data-stu-id="d7836-121">Specifies the SPN for the server.</span></span> <span data-ttu-id="d7836-122">默认值是空字符串，这将导致 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 使用默认的驱动程序生成的 SPN。</span><span class="sxs-lookup"><span data-stu-id="d7836-122">The default value is an empty string, which causes [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client to use the default, driver-generated SPN.</span></span><br /><br /> <span data-ttu-id="d7836-123">只有在以编程方式设置该属性或打开连接之后才能查询该属性。</span><span class="sxs-lookup"><span data-stu-id="d7836-123">This attribute can be queried only after it has been set programmatically, or after a connection has been opened.</span></span> <span data-ttu-id="d7836-124">如果试图对未打开的连接查询该属性，并且尚未以编程方式设置该属性，则返回 SQL_ERROR 并生成具有 SQLState 08003 和消息“连接未打开”的诊断记录。</span><span class="sxs-lookup"><span data-stu-id="d7836-124">If an attempt is made to query this attribute on a connection that is not open and the attribute has not been set programmatically, SQL_ERROR is returned, and a diagnostic record is logged with SQLState 08003 and the message "Connection not open".</span></span><br /><br /> <span data-ttu-id="d7836-125">如果在连接打开时试图设置该属性，则返回 SQL_ERROR 并生成具有 SQLState HY011 和消息“操作此时无效”的诊断记录。</span><span class="sxs-lookup"><span data-stu-id="d7836-125">If an attempt is made to set this attribute when a connection is open, SQL_ERROR is returned, and a diagnostic record is logged with SQLState HY011 and the message "Operation invalid at this time".</span></span>|  
|<span data-ttu-id="d7836-126">SQL_COPT_SS_INTEGRATED_AUTHENTICATION_METHOD</span><span class="sxs-lookup"><span data-stu-id="d7836-126">SQL_COPT_SS_INTEGRATED_AUTHENTICATION_METHOD</span></span>|<span data-ttu-id="d7836-127">SQLTCHAR，只读</span><span class="sxs-lookup"><span data-stu-id="d7836-127">SQLTCHAR, read-only</span></span>|<span data-ttu-id="d7836-128">返回用于连接的身份验证方法。</span><span class="sxs-lookup"><span data-stu-id="d7836-128">Returns the authentication method used for the connection.</span></span> <span data-ttu-id="d7836-129">返回到应用程序的值是 Windows 返回到 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 的值。</span><span class="sxs-lookup"><span data-stu-id="d7836-129">The value returned to the application is the value that Windows returns to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client.</span></span> <span data-ttu-id="d7836-130">可能的值包括：</span><span class="sxs-lookup"><span data-stu-id="d7836-130">Possible values are:</span></span><br /><br /> <span data-ttu-id="d7836-131">-"NTLM"，在使用 NTLM 身份验证打开连接时返回。</span><span class="sxs-lookup"><span data-stu-id="d7836-131">-   "NTLM", which is returned when a connection is opened using NTLM authentication.</span></span><br /><span data-ttu-id="d7836-132">-"Kerberos"，在使用 Kerberos 身份验证打开连接时返回。</span><span class="sxs-lookup"><span data-stu-id="d7836-132">-   "Kerberos", which is returned when a connection is opened using Kerberos authentication.</span></span><br /><br /> <span data-ttu-id="d7836-133">只能为使用 Windows 身份验证的打开的连接读取该属性。</span><span class="sxs-lookup"><span data-stu-id="d7836-133">This attribute can only be read for an open connection that used Windows Authentication.</span></span> <span data-ttu-id="d7836-134">如果试图在连接打开之前读取它，则返回 SQL_ERROR 并以 SQLState 08003 和消息“连接未打开”记录错误。</span><span class="sxs-lookup"><span data-stu-id="d7836-134">If an attempt is made to read it before a connection has been opened, SQL_ERROR is returned, and an error is logged with SQLState 08003 and the message "Connection not open".</span></span><br /><br /> <span data-ttu-id="d7836-135">如果对未使用 Windows 身份验证的连接查询该属性，则返回 SQL_ERROR 并以 SQLState HY092 和消息“属性/选项标识符无效(SQL_COPT_SS_INTEGRATED_AUTHENTICATION_METHOD 只适用于可信连接)”记录错误。</span><span class="sxs-lookup"><span data-stu-id="d7836-135">If this attribute is queried on a connection that did not use Windows Authentication, SQL_ERROR is returned, and an error is logged with SQLState HY092 and the message "Invalid attribute/option identifier (SQL_COPT_SS_INTEGRATED_AUTHENTICATION_METHOD is only available for Trusted Connections)".</span></span><br /><br /> <span data-ttu-id="d7836-136">如果无法确定身份验证方法，则返回 SQL_ERROR 并以 SQLState HY000 和消息“常规错误”记录错误。</span><span class="sxs-lookup"><span data-stu-id="d7836-136">If the authentication method cannot be determined, SQL_ERROR is returned, and an error is logged with SQLState HY000 and the message "General error".</span></span>|  
|<span data-ttu-id="d7836-137">SQL_COPT_SS_MUTUALLY_AUTHENTICATED</span><span class="sxs-lookup"><span data-stu-id="d7836-137">SQL_COPT_SS_MUTUALLY_AUTHENTICATED</span></span>|<span data-ttu-id="d7836-138">SQLSMALLINT，只读</span><span class="sxs-lookup"><span data-stu-id="d7836-138">SQLSMALLINT, read-only</span></span>|<span data-ttu-id="d7836-139">如果连接中的服务器相互验证，则返回 SQL_TRUE；否则，返回 SQL_FALSE。</span><span class="sxs-lookup"><span data-stu-id="d7836-139">Returns SQL_TRUE if the server in the connection was mutually authenticated; otherwise, returns SQL_FALSE.</span></span><br /><br /> <span data-ttu-id="d7836-140">只能为打开的连接读取该属性。</span><span class="sxs-lookup"><span data-stu-id="d7836-140">This attribute can only be read for an open connection.</span></span> <span data-ttu-id="d7836-141">如果试图在连接打开之前读取它，则返回 SQL_ERROR 并以 SQLState 08003 和消息“连接未打开”记录错误。</span><span class="sxs-lookup"><span data-stu-id="d7836-141">If an attempt is made to read it before a connection has been opened, SQL_ERROR is returned, and an error is logged with SQLState 08003 and the message "Connection not open".</span></span><br /><br /> <span data-ttu-id="d7836-142">如果为未使用 Windows 身份验证的连接查询该属性，则返回 SQL_FALSE。</span><span class="sxs-lookup"><span data-stu-id="d7836-142">If this attribute is queried for a connection that did not use Windows Authentication, SQL_FALSE is returned.</span></span>|  
  
## <a name="odbc-function-support-for-specifying-spns"></a><span data-ttu-id="d7836-143">支持指定 SPN 的 ODBC 函数</span><span class="sxs-lookup"><span data-stu-id="d7836-143">ODBC Function Support for Specifying SPNs</span></span>  
 <span data-ttu-id="d7836-144">以下 ODBC 函数支持客户端应用程序和 SPN：</span><span class="sxs-lookup"><span data-stu-id="d7836-144">The following ODBC functions support client applications and SPNs:</span></span>  
  
-   [<span data-ttu-id="d7836-145">SQLBrowseConnect</span><span class="sxs-lookup"><span data-stu-id="d7836-145">SQLBrowseConnect</span></span>](../../native-client-odbc-api/sqlbrowseconnect.md)  
  
-   [<span data-ttu-id="d7836-146">SQLConnect</span><span class="sxs-lookup"><span data-stu-id="d7836-146">SQLConnect</span></span>](../../native-client-odbc-api/sqlconnect.md)  
  
-   [<span data-ttu-id="d7836-147">SQLDriverConnect</span><span class="sxs-lookup"><span data-stu-id="d7836-147">SQLDriverConnect</span></span>](../../native-client-odbc-api/sqldriverconnect.md)  
  
-   [<span data-ttu-id="d7836-148">SQLGetConnectAttr</span><span class="sxs-lookup"><span data-stu-id="d7836-148">SQLGetConnectAttr</span></span>](../../native-client-odbc-api/sqlgetconnectattr.md)  
  
-   [<span data-ttu-id="d7836-149">SQLSetConnectAttr</span><span class="sxs-lookup"><span data-stu-id="d7836-149">SQLSetConnectAttr</span></span>](../../native-client-odbc-api/sqlsetconnectattr.md)  
  
## <a name="see-also"></a><span data-ttu-id="d7836-150">另请参阅</span><span class="sxs-lookup"><span data-stu-id="d7836-150">See Also</span></span>  
 [<span data-ttu-id="d7836-151">SQL Server Native Client (ODBC)</span><span class="sxs-lookup"><span data-stu-id="d7836-151">SQL Server Native Client &#40;ODBC&#41;</span></span>](sql-server-native-client-odbc.md)  
  
  
