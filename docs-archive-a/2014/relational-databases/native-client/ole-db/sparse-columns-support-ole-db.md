---
title: 稀疏列支持 (OLE DB) | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
ms.assetid: 918574b3-c62e-4937-9e5f-37310dedc8f9
author: rothja
ms.author: jroth
ms.openlocfilehash: 2d40964b3c433b35b5ab9af2637389a022cc3961
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87578842"
---
# <a name="sparse-columns-support-ole-db"></a><span data-ttu-id="f8444-102">稀疏列支持 (OLE DB)</span><span class="sxs-lookup"><span data-stu-id="f8444-102">Sparse Columns Support (OLE DB)</span></span>
  <span data-ttu-id="f8444-103">本主题提供有关 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB 对稀疏列的支持的信息。</span><span class="sxs-lookup"><span data-stu-id="f8444-103">This topic provides information about [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB support for sparse columns.</span></span> <span data-ttu-id="f8444-104">有关稀疏列的详细信息，请参阅[SQL Server Native Client 中的稀疏列支持](../features/sparse-columns-support-in-sql-server-native-client.md)。</span><span class="sxs-lookup"><span data-stu-id="f8444-104">For more information about sparse columns, see [Sparse Columns Support in SQL Server Native Client](../features/sparse-columns-support-in-sql-server-native-client.md).</span></span> <span data-ttu-id="f8444-105">例如，请参阅[显示稀疏列的列和目录元数据 &#40;OLE DB&#41;](../../native-client-ole-db-how-to/display-column-and-catalog-metadata-for-sparse-columns-ole-db.md)。</span><span class="sxs-lookup"><span data-stu-id="f8444-105">For a sample, see [Display Column and Catalog Metadata for Sparse Columns &#40;OLE DB&#41;](../../native-client-ole-db-how-to/display-column-and-catalog-metadata-for-sparse-columns-ole-db.md).</span></span>  
  
## <a name="ole-db-statement-metadata"></a><span data-ttu-id="f8444-106">OLE DB 语句元数据</span><span class="sxs-lookup"><span data-stu-id="f8444-106">OLE DB Statement Metadata</span></span>  
 <span data-ttu-id="f8444-107">从 [!INCLUDE[ssKatmai](../../../includes/sskatmai-md.md)] 开始，可以使用新的 DBCOLUMNFLAGS 标记值 DBCOLUMNFLAGS_SS_ISCOLUMNSET。</span><span class="sxs-lookup"><span data-stu-id="f8444-107">Beginning with [!INCLUDE[ssKatmai](../../../includes/sskatmai-md.md)], a new DBCOLUMNFLAGS flag value, DBCOLUMNFLAGS_SS_ISCOLUMNSET, is available.</span></span> <span data-ttu-id="f8444-108">应当为是 `column_set` 值的列设置该值。</span><span class="sxs-lookup"><span data-stu-id="f8444-108">This value should be set for columns that are `column_set` values.</span></span> <span data-ttu-id="f8444-109">可以通过 IColumnsInfo::GetColumnsInfo 的 dwFlags\*\* 参数和 IColumnsRowset::GetColumnsRowset 返回的行集的 DBCOLUMN_FLAGS 列来检索 DBCOLUMNFLAGS 标志。</span><span class="sxs-lookup"><span data-stu-id="f8444-109">The DBCOLUMNFLAGS flag can be retrieved through the *dwFlags* parameter of IColumnsInfo::GetColumnsInfo and the DBCOLUMN_FLAGS column of the rowset returned by IColumnsRowset::GetColumnsRowset.</span></span>  
  
## <a name="ole-db-catalog-metadata"></a><span data-ttu-id="f8444-110">OLE DB 目录元数据</span><span class="sxs-lookup"><span data-stu-id="f8444-110">OLE DB Catalog Metadata</span></span>  
 <span data-ttu-id="f8444-111">其他两个特定于 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 的列已添加到 DBSCHEMA_COLUMNS 中。</span><span class="sxs-lookup"><span data-stu-id="f8444-111">Two additional [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]-specific columns have been added to DBSCHEMA_COLUMNS.</span></span>  
  
|<span data-ttu-id="f8444-112">列名称</span><span class="sxs-lookup"><span data-stu-id="f8444-112">Column name</span></span>|<span data-ttu-id="f8444-113">数据类型</span><span class="sxs-lookup"><span data-stu-id="f8444-113">Data type</span></span>|<span data-ttu-id="f8444-114">值/注释</span><span class="sxs-lookup"><span data-stu-id="f8444-114">Value/comments</span></span>|  
|-----------------|---------------|---------------------|  
|<span data-ttu-id="f8444-115">SS_IS_SPARSE</span><span class="sxs-lookup"><span data-stu-id="f8444-115">SS_IS_SPARSE</span></span>|<span data-ttu-id="f8444-116">DBTYPE_BOOL</span><span class="sxs-lookup"><span data-stu-id="f8444-116">DBTYPE_BOOL</span></span>|<span data-ttu-id="f8444-117">如果该列是稀疏列，它将具有值 VARIANT_TRUE；否则，为 VARIANT_FALSE。</span><span class="sxs-lookup"><span data-stu-id="f8444-117">If the column is a sparse column, this has the value VARIANT_TRUE; otherwise, VARIANT_FALSE.</span></span>|  
|<span data-ttu-id="f8444-118">SS_IS_COLUMN_SET</span><span class="sxs-lookup"><span data-stu-id="f8444-118">SS_IS_COLUMN_SET</span></span>|<span data-ttu-id="f8444-119">DBTYPE_BOOL</span><span class="sxs-lookup"><span data-stu-id="f8444-119">DBTYPE_BOOL</span></span>|<span data-ttu-id="f8444-120">如果该列是稀疏 `column_set` 列，则它具有值 VARIANT_TRUE；否则，为 VARIANT_FALSE。</span><span class="sxs-lookup"><span data-stu-id="f8444-120">If the column is the sparse `column_set` column, this has the value VARIANT_TRUE; otherwise, VARIANT_FALSE.</span></span>|  
  
 <span data-ttu-id="f8444-121">还添加了其他两个架构行集。</span><span class="sxs-lookup"><span data-stu-id="f8444-121">Two additional schema rowsets have also been added.</span></span> <span data-ttu-id="f8444-122">这些行集具有与 DBSCHEMA_COLUMNS 相同的结构，但返回不同内容。</span><span class="sxs-lookup"><span data-stu-id="f8444-122">These rowsets have the same structure as DBSCHEMA_COLUMNS but return different content.</span></span> <span data-ttu-id="f8444-123">不管 `column_set` 成员身份是什么，DBSCHEMA_COLUMNS_EXTENDED 都将返回所有列。</span><span class="sxs-lookup"><span data-stu-id="f8444-123">DBSCHEMA_COLUMNS_EXTENDED returns all columns regardless of `column_set` membership.</span></span> <span data-ttu-id="f8444-124">DBSCHEMA_SPARSE_COLUMN_SET 仅返回属于稀疏 `column_set` 的成员的列。</span><span class="sxs-lookup"><span data-stu-id="f8444-124">DBSCHEMA_SPARSE_COLUMN_SET returns only columns that are members of the sparse `column_set`.</span></span>  
  
## <a name="ole-db-datatypecompatibility-behavior"></a><span data-ttu-id="f8444-125">OLE DB DataTypeCompatibility 行为</span><span class="sxs-lookup"><span data-stu-id="f8444-125">OLE DB DataTypeCompatibility Behavior</span></span>  
 <span data-ttu-id="f8444-126">在 `DataTypeCompatibility=80` 时（在连接字符串中）的行为与 [!INCLUDE[ssVersion2000](../../../includes/ssversion2000-md.md)] 客户端一致，如下所示：</span><span class="sxs-lookup"><span data-stu-id="f8444-126">Behavior with `DataTypeCompatibility=80` (in the connection string) is consistent with a [!INCLUDE[ssVersion2000](../../../includes/ssversion2000-md.md)] client, as follows:</span></span>  
  
-   <span data-ttu-id="f8444-127">新架构行集是不可见的，并且在架构行集中没有它们的行。</span><span class="sxs-lookup"><span data-stu-id="f8444-127">The new schema rowsets are not visible, and there are no rows for them in the schema rowsets rowset.</span></span>  
  
-   <span data-ttu-id="f8444-128">COLUMNS 行集中的新列是不可见的。</span><span class="sxs-lookup"><span data-stu-id="f8444-128">New columns in the COLUMNS rowset are not visible.</span></span>  
  
-   <span data-ttu-id="f8444-129">不为 `column_set` 列设置 DBCOLUMNFLAGS_SS_ISCOLUMNSET。</span><span class="sxs-lookup"><span data-stu-id="f8444-129">DBCOLUMNFLAGS_SS_ISCOLUMNSET is not set for `column_set` columns.</span></span>  
  
-   <span data-ttu-id="f8444-130">为 `column_set` 列设置 DBCOMPUTEMODE_NOTCOMPUTED。</span><span class="sxs-lookup"><span data-stu-id="f8444-130">DBCOMPUTEMODE_NOTCOMPUTED is set for `column_set` columns.</span></span>  
  
## <a name="ole-db-support-for-sparse-columns"></a><span data-ttu-id="f8444-131">OLE DB 对稀疏列的支持</span><span class="sxs-lookup"><span data-stu-id="f8444-131">OLE DB Support for Sparse Columns</span></span>  
 <span data-ttu-id="f8444-132">在 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 中修改了以下 OLE DB 接口以支持稀疏列：</span><span class="sxs-lookup"><span data-stu-id="f8444-132">The following OLE DB interfaces were modified in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client to support sparse columns:</span></span>  
  
|<span data-ttu-id="f8444-133">类型或成员函数</span><span class="sxs-lookup"><span data-stu-id="f8444-133">Type or member function</span></span>|<span data-ttu-id="f8444-134">说明</span><span class="sxs-lookup"><span data-stu-id="f8444-134">Description</span></span>|  
|-----------------------------|-----------------|  
|<span data-ttu-id="f8444-135">IColumnsInfo::GetColumnsInfo</span><span class="sxs-lookup"><span data-stu-id="f8444-135">IColumnsInfo::GetColumnsInfo</span></span>|<span data-ttu-id="f8444-136">为 DwFlags 中的列设置了新的 DBCOLUMNFLAGS 标志值 DBCOLUMNFLAGS_SS_ISCOLUMNSET `column_set` 。 *dwFlags*</span><span class="sxs-lookup"><span data-stu-id="f8444-136">A new DBCOLUMNFLAGS flag value DBCOLUMNFLAGS_SS_ISCOLUMNSET is set for `column_set` columns in *dwFlags*.</span></span><br /><br /> <span data-ttu-id="f8444-137">为 `column_set` 列设置了 DBCOLUMNFLAGS_WRITE。</span><span class="sxs-lookup"><span data-stu-id="f8444-137">DBCOLUMNFLAGS_WRITE is set for `column_set` columns.</span></span>|  
|<span data-ttu-id="f8444-138">IColumsRowset::GetColumnsRowset</span><span class="sxs-lookup"><span data-stu-id="f8444-138">IColumsRowset::GetColumnsRowset</span></span>|<span data-ttu-id="f8444-139">为 DBCOLUMN_FLAGS 中的 `column_set` 列设置了新的 DBCOLUMNFLAGS 标记值 DBCOLUMNFLAGS_SS_ISCOLUMNSET。</span><span class="sxs-lookup"><span data-stu-id="f8444-139">A new DBCOLUMNFLAGS flag value, DBCOLUMNFLAGS_SS_ISCOLUMNSET, is set for `column_set` columns in DBCOLUMN_FLAGS.</span></span><br /><br /> <span data-ttu-id="f8444-140">对于 `column_set` 列，将 DBCOLUMN_COMPUTEMODE 设置为 DBCOMPUTEMODE_DYNAMIC。</span><span class="sxs-lookup"><span data-stu-id="f8444-140">DBCOLUMN_COMPUTEMODE is set to DBCOMPUTEMODE_DYNAMIC for `column_set` columns.</span></span>|  
|<span data-ttu-id="f8444-141">IDBSchemaRowset::GetSchemaRowset</span><span class="sxs-lookup"><span data-stu-id="f8444-141">IDBSchemaRowset::GetSchemaRowset</span></span>|<span data-ttu-id="f8444-142">DBSCHEMA_COLUMNS 返回两个新列：SS_IS_COLUMN_SET 和 SS_IS_SPARSE。</span><span class="sxs-lookup"><span data-stu-id="f8444-142">DBSCHEMA_COLUMNS returns two new columns: SS_IS_COLUMN_SET and SS_IS_SPARSE.</span></span><br /><br /> <span data-ttu-id="f8444-143">DBSCHEMA_COLUMNS 仅返回不属于 `column_set` 成员的列。</span><span class="sxs-lookup"><span data-stu-id="f8444-143">DBSCHEMA_COLUMNS returns only columns that are not members of a `column_set`.</span></span><br /><br /> <span data-ttu-id="f8444-144">已添加两个新架构行集：不管 `column_set` 成员身份的稀疏性如何，DBSCHEMA_COLUMNS_EXTENDED 都将返回所有列。</span><span class="sxs-lookup"><span data-stu-id="f8444-144">Two new schema rowsets have been added: DBSCHEMA_COLUMNS_EXTENDED will return all columns regardless of sparseness of `column_set` membership.</span></span> <span data-ttu-id="f8444-145">DBSCHEMA_SPARSE_COLUMN_SET 仅返回属于 `column_set` 成员的列。</span><span class="sxs-lookup"><span data-stu-id="f8444-145">DBSCHEMA_SPARSE_COLUMN_SET returns only columns that are members of a `column_set`.</span></span> <span data-ttu-id="f8444-146">这些新行集具有与 DBSCHEMA_COLUMNS 相同的列和限制。</span><span class="sxs-lookup"><span data-stu-id="f8444-146">These new rowsets have the same columns and restrictions as DBSCHEMA_COLUMNS.</span></span>|  
|<span data-ttu-id="f8444-147">IDBSchemaRowset::GetSchemas</span><span class="sxs-lookup"><span data-stu-id="f8444-147">IDBSchemaRowset::GetSchemas</span></span>|<span data-ttu-id="f8444-148">IDBSchemaRowset::GetSchemas 将新行集 DBSCHEMA_COLUMNS_EXTENDED 和 DBSCHEMA_SPARSE_COLUMN_SET 的 GUID 包括在可用架构行集的列表中。</span><span class="sxs-lookup"><span data-stu-id="f8444-148">IDBSchemaRowset::GetSchemas includes the GUIDs for the new rowsets DBSCHEMA_COLUMNS_EXTENDED and DBSCHEMA_SPARSE_COLUMN_SET in the list of available schema rowsets.</span></span>|  
|<span data-ttu-id="f8444-149">ICommand::Execute</span><span class="sxs-lookup"><span data-stu-id="f8444-149">ICommand::Execute</span></span>|<span data-ttu-id="f8444-150">如果使用**select \* from** *table* ，则它将返回不是稀疏成员的所有列 `column_set` ，以及包含作为稀疏的成员 `column_set` （如果存在）的所有非 null 列的值的 XML 列。</span><span class="sxs-lookup"><span data-stu-id="f8444-150">If **select \* from** *table* is used, it returns all columns that are not members of the sparse `column_set`, plus an XML column that contains values of all non-null columns that are members of the sparse `column_set`, if present.</span></span>|  
|<span data-ttu-id="f8444-151">IOpenRowset::OpenRowset</span><span class="sxs-lookup"><span data-stu-id="f8444-151">IOpenRowset::OpenRowset</span></span>|<span data-ttu-id="f8444-152">IOpenRowset::OpenRowset 通过同一表上的 select\*\*\*\*\* 查询返回与 ICommand::Execute 具有相同列的行集。</span><span class="sxs-lookup"><span data-stu-id="f8444-152">IOpenRowset::OpenRowset returns a rowset with the same columns as ICommand::Execute, with a **select \*** query on the same table.</span></span>|  
|<span data-ttu-id="f8444-153">ITableDefinition</span><span class="sxs-lookup"><span data-stu-id="f8444-153">ITableDefinition</span></span>|<span data-ttu-id="f8444-154">对于稀疏列或 `column_set` 列，该接口没有更改。</span><span class="sxs-lookup"><span data-stu-id="f8444-154">There is no change to this interface for sparse columns or for `column_set` columns.</span></span> <span data-ttu-id="f8444-155">必须进行架构修改的应用程序必须直接执行正确的 [!INCLUDE[tsql](../../../includes/tsql-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="f8444-155">Applications that have to make schema modifications must execute the appropriate [!INCLUDE[tsql](../../../includes/tsql-md.md)] directly.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="f8444-156">另请参阅</span><span class="sxs-lookup"><span data-stu-id="f8444-156">See Also</span></span>  
 [<span data-ttu-id="f8444-157">SQL Server Native Client (OLE DB)</span><span class="sxs-lookup"><span data-stu-id="f8444-157">SQL Server Native Client &#40;OLE DB&#41;</span></span>](sql-server-native-client-ole-db.md)  
  
  
