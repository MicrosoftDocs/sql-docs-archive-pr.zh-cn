---
title: 使用内存优化表的要求 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: 47d9a7e8-c597-4b95-a58a-dcf66df8e572
author: CarlRabeler
ms.author: carlrab
ms.openlocfilehash: ecb9d388fd0e1362bb8844e874cd89162912e93e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87692936"
---
# <a name="requirements-for-using-memory-optimized-tables"></a><span data-ttu-id="71d82-102">使用内存优化表的要求</span><span class="sxs-lookup"><span data-stu-id="71d82-102">Requirements for Using Memory-Optimized Tables</span></span>
  <span data-ttu-id="71d82-103">除了[安装 SQL Server 2014 的硬件和软件要求](../../sql-server/install/hardware-and-software-requirements-for-installing-sql-server.md)以外，还需要满足以下要求才能使用内存中 OLTP：</span><span class="sxs-lookup"><span data-stu-id="71d82-103">In addition to the [Hardware and Software Requirements for Installing SQL Server 2014](../../sql-server/install/hardware-and-software-requirements-for-installing-sql-server.md), the following are requirements to use In-Memory OLTP:</span></span>  
  
-   <span data-ttu-id="71d82-104">64 位 Enterprise、Developer 或 Evaluation 版 [!INCLUDE[ssSQL14](../../includes/sssql14-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="71d82-104">64-bit Enterprise, Developer, or Evaluation edition of [!INCLUDE[ssSQL14](../../includes/sssql14-md.md)].</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="71d82-105">需要有足够的内存来保留内存优化表和索引中的数据。</span><span class="sxs-lookup"><span data-stu-id="71d82-105">needs enough memory to hold the data in memory-optimized tables and indexes.</span></span> <span data-ttu-id="71d82-106">若要容纳行版本，您应当提供两倍于内存优化表和索引预期大小的内存量。</span><span class="sxs-lookup"><span data-stu-id="71d82-106">To account for row versions, you should provide an amount of memory that is two times the expected size of memory-optimized tables and indexes.</span></span> <span data-ttu-id="71d82-107">但是，所需的实际内存量将依赖于您的工作负荷。</span><span class="sxs-lookup"><span data-stu-id="71d82-107">But the actual amount of memory needed will depend on your workload.</span></span> <span data-ttu-id="71d82-108">您应当监视内存用量并根据需要进行调整。</span><span class="sxs-lookup"><span data-stu-id="71d82-108">You should monitor your memory usage and make adjustments as needed.</span></span> <span data-ttu-id="71d82-109">内存优化表中数据的大小不能超过允许的池百分比。</span><span class="sxs-lookup"><span data-stu-id="71d82-109">The size of data in memory-optimized tables must not exceed the allowed percentage of the pool.</span></span> <span data-ttu-id="71d82-110">若要发现内存优化表的大小，请参阅[&#40;transact-sql&#41;dm_db_xtp_table_memory_stats ](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-table-memory-stats-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="71d82-110">To discover the size of a memory-optimized table, see [sys.dm_db_xtp_table_memory_stats &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-table-memory-stats-transact-sql).</span></span>  
  
     <span data-ttu-id="71d82-111">如果您在数据库具有基于磁盘的表，则需要为这些表上的缓冲池和查询处理提供足够的内存。</span><span class="sxs-lookup"><span data-stu-id="71d82-111">If you have disk-based tables in the database, you need to provide enough memory for the buffer pool and query processing on those tables.</span></span>  
  
     <span data-ttu-id="71d82-112">知道您的内存中 OLTP 应用程序将要求的内存量十分重要。</span><span class="sxs-lookup"><span data-stu-id="71d82-112">It is important to know how much memory your In-Memory OLTP application will require.</span></span> <span data-ttu-id="71d82-113">有关详细信息，请参阅 [估算内存优化表的内存需求](memory-optimized-tables.md) 。</span><span class="sxs-lookup"><span data-stu-id="71d82-113">See [Estimate Memory Requirements for Memory-Optimized Tables](memory-optimized-tables.md) for more information.</span></span>  
  
-   <span data-ttu-id="71d82-114">释放是您的持久内存优化表大小的两倍的磁盘空间。</span><span class="sxs-lookup"><span data-stu-id="71d82-114">Free disk space for that is two times the size of your durable memory-optimized tables.</span></span>  
  
-   <span data-ttu-id="71d82-115">处理器必须支持指令 **cmpxchg16b** 才能使用内存中 OLTP。</span><span class="sxs-lookup"><span data-stu-id="71d82-115">A processor needs to support the instruction **cmpxchg16b** to use In-Memory OLTP.</span></span> <span data-ttu-id="71d82-116">所有新式 64 位处理器都支持 **cmpxchg16b**。</span><span class="sxs-lookup"><span data-stu-id="71d82-116">All modern 64-bit processors support **cmpxchg16b**.</span></span>  
  
     <span data-ttu-id="71d82-117">如果你使用的是 VM 主机应用程序，并且 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 显示因处理器较旧而生成的错误消息，请检查应用程序是否将配置选项设置为允许使用 **cmpxchg16b**。</span><span class="sxs-lookup"><span data-stu-id="71d82-117">If you are using a VM host application and [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] displays an error caused by an older processor, see if the application has a configuration option to allow **cmpxchg16b**.</span></span> <span data-ttu-id="71d82-118">如果没有设置，你可以使用支持 **cmpxchg16b** 的 Hyper-V，而无需修改配置选项。</span><span class="sxs-lookup"><span data-stu-id="71d82-118">If not, you could use Hyper-V, which supports **cmpxchg16b** without needing to modify a configuration option.</span></span>  
  
-   <span data-ttu-id="71d82-119">要安装内存中 OLTP，请在安装 **时选择** “数据库引擎服务” [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="71d82-119">To install In-Memory OLTP, select **Database Engine Services** when you install [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span></span>  
  
     <span data-ttu-id="71d82-120">若要 ([确定表或存储过程是否应移植到内存中 oltp](determining-if-a-table-or-stored-procedure-should-be-ported-to-in-memory-oltp.md)) 并 [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] (通过对象资源管理器) 来管理内存中 oltp [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] ，请选择安装报表生成（"**管理工具-基本**" 或 "**管理工具-高级**" [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="71d82-120">To install report generation ([Determining if a Table or Stored Procedure Should Be Ported to In-Memory OLTP](determining-if-a-table-or-stored-procedure-should-be-ported-to-in-memory-oltp.md)) and [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] (to manage In-Memory OLTP via [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] Object Explorer), select **Management Tools-Basic** or **Management Tools-Advanced** when you install [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span></span>  
  
## <a name="important-notes-on-using-hek_2"></a><span data-ttu-id="71d82-121">有关使用 [!INCLUDE[hek_2](../../../includes/hek-2-md.md)]的重要说明</span><span class="sxs-lookup"><span data-stu-id="71d82-121">Important Notes on Using [!INCLUDE[hek_2](../../../includes/hek-2-md.md)]</span></span>  
  
-   <span data-ttu-id="71d82-122">数据库中所有持久表在内存中的总大小不应超过 250 GB。</span><span class="sxs-lookup"><span data-stu-id="71d82-122">The total in-memory size of all durable tables in a database should not exceed 250 GB.</span></span> <span data-ttu-id="71d82-123">有关详细信息，请参阅[内存优化表的持续](durability-for-memory-optimized-tables.md)性。</span><span class="sxs-lookup"><span data-stu-id="71d82-123">For more information, see [Durability for Memory-Optimized Tables](durability-for-memory-optimized-tables.md).</span></span>  
  
-   <span data-ttu-id="71d82-124">此版本的 [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] 的目标是在具有 2 或 4 个插槽和少于 60 个内核的系统上实现最佳执行。</span><span class="sxs-lookup"><span data-stu-id="71d82-124">This release of [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] is targeted to perform optimally on systems with 2 or 4 sockets and fewer than 60 cores.</span></span>  
  
-   <span data-ttu-id="71d82-125">不得手动删除检查点文件。</span><span class="sxs-lookup"><span data-stu-id="71d82-125">Checkpoint files must not be manually deleted.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="71d82-126">自动对不需要的检查点文件执行垃圾回收。</span><span class="sxs-lookup"><span data-stu-id="71d82-126">automatically performs garbage collection on unneeded checkpoint files.</span></span> <span data-ttu-id="71d82-127">有关详细信息，请参阅针对[内存优化表的持久性](durability-for-memory-optimized-tables.md)合并数据和差异文件的讨论。</span><span class="sxs-lookup"><span data-stu-id="71d82-127">For more information, see the discussion on merging data and delta files in [Durability for Memory-Optimized Tables](durability-for-memory-optimized-tables.md).</span></span>  
  
-   <span data-ttu-id="71d82-128">在内存中 OLTP 的第一个版本中（ [!INCLUDE[ssSQL14](../../includes/sssql14-md.md)]中），只有删除数据库才能删除内存优化的文件组。</span><span class="sxs-lookup"><span data-stu-id="71d82-128">In this first release of In-Memory OLTP (in [!INCLUDE[ssSQL14](../../includes/sssql14-md.md)]), the only way to remove a memory-optimized filegroup is to drop the database.</span></span>  
  
-   <span data-ttu-id="71d82-129">如果在有并发插入或更新工作负荷会影响要删除行范围时尝试删除大量行，删除可能失败。</span><span class="sxs-lookup"><span data-stu-id="71d82-129">If you attempt to delete a large batch of rows while there is a concurrent insert or update workload affecting the range of rows you are trying to delete, the delete will likely fail.</span></span> <span data-ttu-id="71d82-130">解决方法是先停止插入或更新工作负荷，然后再删除。</span><span class="sxs-lookup"><span data-stu-id="71d82-130">The workaround is to stop the insert or update workload before doing the delete.</span></span> <span data-ttu-id="71d82-131">或者，也可以将事务配置为较小的事务，这样会减小被并发工作负荷中断的可能性。</span><span class="sxs-lookup"><span data-stu-id="71d82-131">Alternatively, you could configure the transaction into smaller transactions, which would be less likely to be disrupted by a concurrent workload.</span></span> <span data-ttu-id="71d82-132">像对所有内存优化表的写入操作一样，使用重试逻辑（[Guidelines for Retry Logic for Transactions on Memory-Optimized Tables](../../database-engine/guidelines-for-retry-logic-for-transactions-on-memory-optimized-tables.md)）。</span><span class="sxs-lookup"><span data-stu-id="71d82-132">As with all write operations on memory-optimized tables, use retry logic ([Guidelines for Retry Logic for Transactions on Memory-Optimized Tables](../../database-engine/guidelines-for-retry-logic-for-transactions-on-memory-optimized-tables.md)).</span></span>  
  
-   <span data-ttu-id="71d82-133">如果创建一个或多个包含内存优化表的数据库，应对 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 实例启用即时文件初始化（授予 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 服务启动帐户 SE_MANAGE_VOLUME_NAME 用户权限）。</span><span class="sxs-lookup"><span data-stu-id="71d82-133">If you create one or more databases with memory-optimized tables, you should enable Instant File Initialization (grant the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] service startup account the SE_MANAGE_VOLUME_NAME user right) for the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="71d82-134">如果没有即时文件初始化，内存优化存储文件（数据和差异文件）将在创建时初始化，这会对工作负荷性能产生负面影响。</span><span class="sxs-lookup"><span data-stu-id="71d82-134">Without Instant File Initialization, memory-optimized storage files (data and delta files) will be initialized upon creation, which can have negative impact on the performance of your workload.</span></span> <span data-ttu-id="71d82-135">有关即时文件初始化的详细信息，请参阅 [数据库文件初始化](../databases/database-instant-file-initialization.md)。</span><span class="sxs-lookup"><span data-stu-id="71d82-135">For more information about Instant File Initialization, see [Database File Initialization](../databases/database-instant-file-initialization.md).</span></span> <span data-ttu-id="71d82-136">有关如何启用即时文件初始化的信息，请参阅 [启用即时文件初始化的方法和原因](https://blogs.msdn.com/b/sql_pfe_blog/archive/2009/12/23/how-and-why-to-enable-instant-file-initialization.aspx)。</span><span class="sxs-lookup"><span data-stu-id="71d82-136">For information on how to enable Instant File Initialization, see [How and Why to Enable Instant File Initialization](https://blogs.msdn.com/b/sql_pfe_blog/archive/2009/12/23/how-and-why-to-enable-instant-file-initialization.aspx).</span></span>  
  
## <a name="did-this-article-help-you-were-listening"></a><span data-ttu-id="71d82-137">本文是否对你有帮助？</span><span class="sxs-lookup"><span data-stu-id="71d82-137">Did this Article Help You?</span></span> <span data-ttu-id="71d82-138">正在侦听</span><span class="sxs-lookup"><span data-stu-id="71d82-138">We're Listening</span></span>  
 <span data-ttu-id="71d82-139">你正在查找哪些信息，是否已经找到？</span><span class="sxs-lookup"><span data-stu-id="71d82-139">What information are you looking for, and did you find it?</span></span> <span data-ttu-id="71d82-140">我们正在倾听你的反馈来改进内容。</span><span class="sxs-lookup"><span data-stu-id="71d82-140">We're listening to your feedback to improve the content.</span></span> <span data-ttu-id="71d82-141">请将你的评论提交到 [sqlfeedback@microsoft.com](mailto:sqlfeedback@microsoft.com?subject=Your%20feedback%20about%20the%20Requirements%20for%20Using%20Memory-Optimized%20Tables%20page) 。</span><span class="sxs-lookup"><span data-stu-id="71d82-141">Please submit your comments to [sqlfeedback@microsoft.com](mailto:sqlfeedback@microsoft.com?subject=Your%20feedback%20about%20the%20Requirements%20for%20Using%20Memory-Optimized%20Tables%20page).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="71d82-142">另请参阅</span><span class="sxs-lookup"><span data-stu-id="71d82-142">See Also</span></span>  
 [<span data-ttu-id="71d82-143">内存中 OLTP（内存中优化）</span><span class="sxs-lookup"><span data-stu-id="71d82-143">In-Memory OLTP &#40;In-Memory Optimization&#41;</span></span>](in-memory-oltp-in-memory-optimization.md)  
  
  
