---
title: 在 OPENXML 中指定元属性 | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xml
ms.topic: conceptual
helpviewer_keywords:
- overflow in XML document [SQL Server]
- metaproperties [XML in SQL Server]
- unconsumed data
- extracting information of XML nodes [SQL Server]
- OPENXML statement, metaproperties
ms.assetid: 29bfd1c6-3f9a-43c4-924a-53d438e442f4
author: rothja
ms.author: jroth
ms.openlocfilehash: c52d1162aa495deff8a0fde314fdcde0735d9c2f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87691145"
---
# <a name="specify-metaproperties-in-openxml"></a><span data-ttu-id="178ef-102">在 OPENXML 中指定元属性</span><span class="sxs-lookup"><span data-stu-id="178ef-102">Specify Metaproperties in OPENXML</span></span>
  <span data-ttu-id="178ef-103">XML 文档中的元属性特性用于描述 XML 项（例如元素节点、属性节点或其他任何 DOM 节点）的属性。</span><span class="sxs-lookup"><span data-stu-id="178ef-103">Metaproperty attributes in an XML document are attributes that describe the properties of an XML item, such as element, attribute, or any other DOM node.</span></span> <span data-ttu-id="178ef-104">这些特性并不实际存在于 XML 文档文本中。</span><span class="sxs-lookup"><span data-stu-id="178ef-104">These attributes do not physically exist in the XML document text.</span></span> <span data-ttu-id="178ef-105">但是，OPENXML 将为所有 XML 项提供这些元属性。</span><span class="sxs-lookup"><span data-stu-id="178ef-105">However, OPENXML provides these metaproperties for all the XML items.</span></span> <span data-ttu-id="178ef-106">通过这些元属性可以提取 XML 节点的信息（例如本地定位和命名空间信息）。</span><span class="sxs-lookup"><span data-stu-id="178ef-106">These metaproperties allow you to extract information, such as local positioning and namespace information, of XML nodes.</span></span> <span data-ttu-id="178ef-107">这些信息将提供比文字表现形式更加详细的信息。</span><span class="sxs-lookup"><span data-stu-id="178ef-107">This information provides you with more details than are apparent in the textual representation.</span></span>  
  
 <span data-ttu-id="178ef-108">可以使用 *ColPattern* 参数将这些元属性映射到 OPENXML 语句中的行集列。</span><span class="sxs-lookup"><span data-stu-id="178ef-108">You can map these metaproperties to the rowset columns in an OPENXML statement by using the *ColPattern* parameter.</span></span> <span data-ttu-id="178ef-109">这些列将包含它们所映射到的元属性的值。</span><span class="sxs-lookup"><span data-stu-id="178ef-109">The columns will contain the values of the metaproperties to which they are mapped.</span></span> <span data-ttu-id="178ef-110">有关 OPENXML 语法的详细信息，请参见 [OPENXML (Transact-SQL)](/sql/t-sql/functions/openxml-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="178ef-110">For more information about the syntax of OPENXML, see [OPENXML &#40;Transact-SQL&#41;](/sql/t-sql/functions/openxml-transact-sql).</span></span>  
  
 <span data-ttu-id="178ef-111">若要访问元属性特性，应提供特定于 SQL Server 的命名空间。</span><span class="sxs-lookup"><span data-stu-id="178ef-111">To access the metaproperty attributes, a namespace that is specific to SQL Server is provided.</span></span> <span data-ttu-id="178ef-112">此命名空间 ( **urn:schemas-microsoft-com:xml-metaprop** ) 使用户能够访问元属性特性。</span><span class="sxs-lookup"><span data-stu-id="178ef-112">This namespace, **urn:schemas-microsoft-com:xml-metaprop** allows the user to access the metaproperty attributes.</span></span> <span data-ttu-id="178ef-113">如果 OPENXML 查询结果以边缘表的格式返回，则每个元属性特性在边缘表中都有相应的一列（ **xmltext** 元属性除外）。</span><span class="sxs-lookup"><span data-stu-id="178ef-113">If the result of an OPENXML query is returned in an edge table format, the edge table contains one column for each metaproperty attribute, except the **xmltext** metaproperty.</span></span>  
  
 <span data-ttu-id="178ef-114">有些元属性特性用于处理目的。</span><span class="sxs-lookup"><span data-stu-id="178ef-114">Some of the metaproperty attributes are used for processing purposes.</span></span> <span data-ttu-id="178ef-115">例如， **xmltext** 元属性特性用于溢出处理。</span><span class="sxs-lookup"><span data-stu-id="178ef-115">For example, the **xmltext** metaproperty attribute is used for overflow handling.</span></span> <span data-ttu-id="178ef-116">溢出处理针对文档中未用完/未处理的数据。</span><span class="sxs-lookup"><span data-stu-id="178ef-116">Overflow handling refers to the unconsumed, unprocessed data in the document.</span></span> <span data-ttu-id="178ef-117">可以将 OPENXML 所生成的行集中的一列标识为溢出列。</span><span class="sxs-lookup"><span data-stu-id="178ef-117">One of the columns in the rowset that is generated by OPENXML can be identified as the overflow column.</span></span> <span data-ttu-id="178ef-118">可以通过使用 **ColPattern** 参数将该列映射到 *xmltext* 元属性来执行此操作。</span><span class="sxs-lookup"><span data-stu-id="178ef-118">You do this by mapping it to the **xmltext** metaproperty by using the *ColPattern* parameter.</span></span> <span data-ttu-id="178ef-119">然后，该列将接收溢出数据。</span><span class="sxs-lookup"><span data-stu-id="178ef-119">The column then receives the overflow data.</span></span> <span data-ttu-id="178ef-120">*flags* 参数用于确定该列是包含所有数据还是只包含未用完的数据。</span><span class="sxs-lookup"><span data-stu-id="178ef-120">The *flags* parameter determines whether the column contains everything or only the unconsumed data.</span></span>  
  
 <span data-ttu-id="178ef-121">下表列出了每个经过分析的 XML 元素所具有的元属性特性。</span><span class="sxs-lookup"><span data-stu-id="178ef-121">The following table lists the metaproperty attributes that each parsed XML element possesses.</span></span> <span data-ttu-id="178ef-122">可以使用命名空间 **urn:schemas-microsoft-com:xml-metaprop**来访问这些元属性特性。</span><span class="sxs-lookup"><span data-stu-id="178ef-122">These metaproperty attributes can be accessed by using the namespace **urn:schemas-microsoft-com:xml-metaprop**.</span></span> <span data-ttu-id="178ef-123">用户使用这些元属性在 XML 文档中直接设置的任何值均会被忽略。</span><span class="sxs-lookup"><span data-stu-id="178ef-123">Any value that the user sets directly in the XML document by using these metaproperties is ignored.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="178ef-124">不能在任何 XPath 导航中引用这些元属性。</span><span class="sxs-lookup"><span data-stu-id="178ef-124">You cannot reference these metaproperties in any XPath navigation.</span></span>  
  
|<span data-ttu-id="178ef-125">元属性特性</span><span class="sxs-lookup"><span data-stu-id="178ef-125">Metaproperty attribute</span></span>|<span data-ttu-id="178ef-126">说明</span><span class="sxs-lookup"><span data-stu-id="178ef-126">Description</span></span>|  
|----------------------------|-----------------|  
|<span data-ttu-id="178ef-127">**\@mp:id**</span><span class="sxs-lookup"><span data-stu-id="178ef-127">**\@mp:id**</span></span>|<span data-ttu-id="178ef-128">提供由系统生成的、文档范围的 DOM 节点标识符。</span><span class="sxs-lookup"><span data-stu-id="178ef-128">Provides a system-generated, document-wide identifier of the DOM node.</span></span> <span data-ttu-id="178ef-129">只要文档未被重新分析，此 ID 就会引用同一个 XML 节点。</span><span class="sxs-lookup"><span data-stu-id="178ef-129">As long as the document is not reparsed, this ID refers to the same XML node.</span></span><br /><br /> <span data-ttu-id="178ef-130">XML ID 为 **0** 表明该元素是根元素。</span><span class="sxs-lookup"><span data-stu-id="178ef-130">An XML ID of **0** indicates that the element is a root element.</span></span> <span data-ttu-id="178ef-131">其父 XML ID 为 NULL。</span><span class="sxs-lookup"><span data-stu-id="178ef-131">Its parent XML ID is NULL.</span></span>|  
|<span data-ttu-id="178ef-132">**\@mp:localname**</span><span class="sxs-lookup"><span data-stu-id="178ef-132">**\@mp:localname**</span></span>|<span data-ttu-id="178ef-133">存储节点名的本地部分。</span><span class="sxs-lookup"><span data-stu-id="178ef-133">Stores the local part of the name of the node.</span></span> <span data-ttu-id="178ef-134">与前缀及命名空间 URI 一起用于命名元素节点或属性节点。</span><span class="sxs-lookup"><span data-stu-id="178ef-134">It is used with a prefix and a namespace URI to name element or attribute nodes.</span></span>|  
|<span data-ttu-id="178ef-135">**\@mp:namespaceuri**</span><span class="sxs-lookup"><span data-stu-id="178ef-135">**\@mp:namespaceuri**</span></span>|<span data-ttu-id="178ef-136">提供当前元素的命名空间 URI。</span><span class="sxs-lookup"><span data-stu-id="178ef-136">Provides the namespace URI of the current element.</span></span> <span data-ttu-id="178ef-137">如果此特性的值为 NULL，则表明不存在命名空间。</span><span class="sxs-lookup"><span data-stu-id="178ef-137">If the value of this attribute is NULL, no namespace is present</span></span>|  
|<span data-ttu-id="178ef-138">**\@mp:prefix**</span><span class="sxs-lookup"><span data-stu-id="178ef-138">**\@mp:prefix**</span></span>|<span data-ttu-id="178ef-139">存储当前元素名的命名空间前缀。</span><span class="sxs-lookup"><span data-stu-id="178ef-139">Stores the namespace prefix of the current element name.</span></span><br /><br /> <span data-ttu-id="178ef-140">如果不存在前缀 (NULL) 且给定了 URI，则表明指定的命名空间为默认命名空间。</span><span class="sxs-lookup"><span data-stu-id="178ef-140">If no prefix is present (NULL) and a URI is given, it indicates that the specified namespace is the default namespace.</span></span> <span data-ttu-id="178ef-141">如果没有给定 URI，则表明没有附加命名空间。</span><span class="sxs-lookup"><span data-stu-id="178ef-141">If no URI is given, no namespace is attached.</span></span>|  
|<span data-ttu-id="178ef-142">**\@mp:prev**</span><span class="sxs-lookup"><span data-stu-id="178ef-142">**\@mp:prev**</span></span>|<span data-ttu-id="178ef-143">存储相对于节点的前一个同级元素。</span><span class="sxs-lookup"><span data-stu-id="178ef-143">Stores the previous sibling relative to a node.</span></span> <span data-ttu-id="178ef-144">此特性将提供有关元素在文档中的排序顺序的信息。</span><span class="sxs-lookup"><span data-stu-id="178ef-144">This provides information about the ordering of elements in the document.</span></span><br /><br /> <span data-ttu-id="178ef-145">\@mp:prev 包含父元素相同的上一个同级元素的 XML ID。</span><span class="sxs-lookup"><span data-stu-id="178ef-145">**\@mp:prev** contains the XML ID of the previous sibling that has the same parent element.</span></span> <span data-ttu-id="178ef-146">如果元素是同级列表的首个元素，\@mp:prev 为空。</span><span class="sxs-lookup"><span data-stu-id="178ef-146">If an element is at the front of the sibling list, **\@mp:prev** is NULL.</span></span>|  
|<span data-ttu-id="178ef-147">**\@mp:xmltext**</span><span class="sxs-lookup"><span data-stu-id="178ef-147">**\@mp:xmltext**</span></span>|<span data-ttu-id="178ef-148">用于处理目的。</span><span class="sxs-lookup"><span data-stu-id="178ef-148">Used for processing purposes.</span></span> <span data-ttu-id="178ef-149">它是元素及其属性以及 OPENXML 溢出处理中所使用的子元素的文本序列化。</span><span class="sxs-lookup"><span data-stu-id="178ef-149">It is the textual serialization of the element and its attributes, and also the subelements, as used in the overflow handling of OPENXML.</span></span>|  
  
 <span data-ttu-id="178ef-150">下表显示了使您得以检索关于层次结构的信息的其他父属性。</span><span class="sxs-lookup"><span data-stu-id="178ef-150">This table shows the additional parent properties that are provided and which allow you to retrieve information about the hierarchy.</span></span>  
  
|<span data-ttu-id="178ef-151">父元属性特性</span><span class="sxs-lookup"><span data-stu-id="178ef-151">Parent metaproperty attribute</span></span>|<span data-ttu-id="178ef-152">说明</span><span class="sxs-lookup"><span data-stu-id="178ef-152">Description</span></span>|  
|-----------------------------------|-----------------|  
|<span data-ttu-id="178ef-153">**\@mp:parentid**</span><span class="sxs-lookup"><span data-stu-id="178ef-153">**\@mp:parentid**</span></span>|<span data-ttu-id="178ef-154">对应于 ../\@mp:id</span><span class="sxs-lookup"><span data-stu-id="178ef-154">Corresponds to **../\@mp:id**</span></span>|  
|<span data-ttu-id="178ef-155">**\@mp:parentlocalname**</span><span class="sxs-lookup"><span data-stu-id="178ef-155">**\@mp:parentlocalname**</span></span>|<span data-ttu-id="178ef-156">对应于 ../\@mp:localname</span><span class="sxs-lookup"><span data-stu-id="178ef-156">Corresponds to **../\@mp:localname**</span></span>|  
|<span data-ttu-id="178ef-157">**\@mp:parentnamespacerui**</span><span class="sxs-lookup"><span data-stu-id="178ef-157">**\@mp:parentnamespacerui**</span></span>|<span data-ttu-id="178ef-158">对应于 ../\@mp:namespaceuri</span><span class="sxs-lookup"><span data-stu-id="178ef-158">Corresponds to **../\@mp:namespaceuri**</span></span>|  
|<span data-ttu-id="178ef-159">**\@mp:parentprefix**</span><span class="sxs-lookup"><span data-stu-id="178ef-159">**\@mp:parentprefix**</span></span>|<span data-ttu-id="178ef-160">对应于 ../\@mp:prefix</span><span class="sxs-lookup"><span data-stu-id="178ef-160">Corresponds to **../\@mp:prefix**</span></span>|  
  
## <a name="examples"></a><span data-ttu-id="178ef-161">示例</span><span class="sxs-lookup"><span data-stu-id="178ef-161">Examples</span></span>  
 <span data-ttu-id="178ef-162">下列示例说明了如何使用 OPENXML 来创建不同的行集视图。</span><span class="sxs-lookup"><span data-stu-id="178ef-162">The following examples illustrate how OPENXML is used to create different rowset views.</span></span>  
  
### <a name="a-mapping-the-openxml-rowset-columns-to-the-metaproperties"></a><span data-ttu-id="178ef-163">A.</span><span class="sxs-lookup"><span data-stu-id="178ef-163">A.</span></span> <span data-ttu-id="178ef-164">将 OPENXML 行集列映射到元属性</span><span class="sxs-lookup"><span data-stu-id="178ef-164">Mapping the OPENXML rowset columns to the metaproperties</span></span>  
 <span data-ttu-id="178ef-165">此示例使用 OPENXML 创建该示例 XML 文档的行集视图。</span><span class="sxs-lookup"><span data-stu-id="178ef-165">This example uses OPENXML to create a rowset view of the sample XML document.</span></span> <span data-ttu-id="178ef-166">它专门显示了如何使用 *ColPattern* 参数将各种元属性特性映射到 OPENXML 语句中的行集列。</span><span class="sxs-lookup"><span data-stu-id="178ef-166">Specifically, it shows how the various metaproperty attributes can be mapped to rowset columns in an OPENXML statement by using the *ColPattern* parameter.</span></span>  
  
 <span data-ttu-id="178ef-167">OPENXML 语句说明了以下信息：</span><span class="sxs-lookup"><span data-stu-id="178ef-167">The OPENXML statement illustrates the following:</span></span>  
  
-   <span data-ttu-id="178ef-168">id 列映射到 \@mp:id 元属性，并指明列中包含元素的系统生成唯一 XML ID。</span><span class="sxs-lookup"><span data-stu-id="178ef-168">The **id** column is mapped to the **\@mp:id** metaproperty attribute and indicates that the column contains the system-generated unique XML ID of the element.</span></span>  
  
-   <span data-ttu-id="178ef-169">parent 列映射到 \@mp:parentid，并指明列中包含元素的父元素的 XML ID。</span><span class="sxs-lookup"><span data-stu-id="178ef-169">The **parent** column is mapped to **\@mp:parentid** and indicates that the column contains the XML ID of the parent of the element.</span></span>  
  
-   <span data-ttu-id="178ef-170">parentLocalName 列映射到 \@mp:parentlocalname，并指明列中包含父元素的本地名称。</span><span class="sxs-lookup"><span data-stu-id="178ef-170">The **parentLocalName** column is mapped to **\@mp:parentlocalname** and indicates that the column contains the local name of the parent.</span></span>  
  
 <span data-ttu-id="178ef-171">然后，SELECT 语句将返回由 OPENXML 生成的行集：</span><span class="sxs-lookup"><span data-stu-id="178ef-171">The SELECT statement then returns the rowset that is provided by OPENXML:</span></span>  
  
```  
DECLARE @idoc int  
DECLARE @doc nvarchar(1000)  
-- Sample XML document  
SET @doc = N'<root>  
  <Customer cid= "C1" name="Janine" city="Issaquah">  
      <Order oid="O1" date="1/20/1996" amount="3.5" />  
      <Order oid="O2" date="4/30/1997" amount="13.4">Customer was very satisfied</Order>  
   </Customer>  
   <Customer cid="C2" name="Ursula" city="Oelde" >  
      <Order oid="O3" date="7/14/1999" amount="100" note="Wrap it blue white red">  
          <Urgency>Important</Urgency>  
      </Order>  
      <Order oid="O4" date="1/20/1996" amount="10000"/>  
   </Customer>  
</root>'  
-- Create an internal representation of the XML document.  
EXEC sp_xml_preparedocument @idoc OUTPUT, @doc  
  
-- Execute a SELECT statement using OPENXML rowset provider.  
SELECT *  
FROM OPENXML (@idoc, '/root/Customer/Order', 9)  
      WITH (id int '@mp:id',   
            oid char(5),   
            date datetime,   
            amount real,   
            parentIDNo int '@mp:parentid',   
            parentLocalName varchar(40) '@mp:parentlocalname')  
EXEC sp_xml_removedocument @idoc  
```  
  
 <span data-ttu-id="178ef-172">结果如下：</span><span class="sxs-lookup"><span data-stu-id="178ef-172">This is the result:</span></span>  
  
```  
id   oid         date                amount    parentIDNo  parentLocalName    
--- ------- ---------------------- ---------- ------------ ---------------  
6    O1    1996-01-20 00:00:00.000     3.5         2        Customer  
10   O2    1997-04-30 00:00:00.000     13.4        2        Customer  
19   O3    1999-07-14 00:00:00.000     100.0       15       Customer  
25   O4    1996-01-20 00:00:00.000     10000.0     15       Customer  
```  
  
### <a name="b-retrieving-the-whole-xml-document"></a><span data-ttu-id="178ef-173">B.</span><span class="sxs-lookup"><span data-stu-id="178ef-173">B.</span></span> <span data-ttu-id="178ef-174">检索整个 XML 文档</span><span class="sxs-lookup"><span data-stu-id="178ef-174">Retrieving the whole XML document</span></span>  
 <span data-ttu-id="178ef-175">在本例中，使用 OPENXML 来创建示例 XML 文档的单列行集视图。</span><span class="sxs-lookup"><span data-stu-id="178ef-175">In this example, OPENXML is used to create a one-column rowset view of the sample XML document.</span></span> <span data-ttu-id="178ef-176">此列 ( **Col1**) 将映射到 **xmltext** 元属性，并成为一个溢出列。</span><span class="sxs-lookup"><span data-stu-id="178ef-176">This column, **Col1**, is mapped to the **xmltext** metaproperty and becomes an overflow column.</span></span> <span data-ttu-id="178ef-177">因此，此列将接收未用完的数据。</span><span class="sxs-lookup"><span data-stu-id="178ef-177">As a result, the column receives the unconsumed data.</span></span> <span data-ttu-id="178ef-178">在这种情况下，它就是整个文档。</span><span class="sxs-lookup"><span data-stu-id="178ef-178">In this case, it is the whole document.</span></span>  
  
 <span data-ttu-id="178ef-179">然后，SELECT 语句将返回整个行集。</span><span class="sxs-lookup"><span data-stu-id="178ef-179">The SELECT statement then returns the complete rowset.</span></span>  
  
```  
DECLARE @idoc int  
DECLARE @doc nvarchar(1000)  
SET @doc = N'<?xml version="1.0"?>  
<root>  
  <Customer cid= "C1" name="Janine" city="Issaquah">  
      <Order oid="O1" date="1/20/1996" amount="3.5" />  
      <Order oid="O2" date="4/30/1997" amount="13.4">Customer was very   
             satisfied</Order>  
   </Customer>  
   <Customer cid="C2" name="Ursula" city="Oelde" >  
      <Order oid="O3" date="7/14/1999" amount="100" note="Wrap it blue   
             white red">  
     <MyTag>Testing to see if all the subelements are returned</MyTag>  
          <Urgency>Important</Urgency>  
      </Order>  
      <Order oid="O4" date="1/20/1996" amount="10000"/>  
   </Customer>  
</root>'  
-- Create an internal representation of the XML document.  
EXEC sp_xml_preparedocument @idoc OUTPUT, @doc  
  
-- Execute a SELECT statement using OPENXML rowset provider.  
SELECT *  
FROM OPENXML (@idoc, '/')  
   WITH (Col1 ntext '@mp:xmltext')  
```  
  
 <span data-ttu-id="178ef-180">若要在没有 XML 声明的情况下检索整个文档，可以将查询指定为以下形式：</span><span class="sxs-lookup"><span data-stu-id="178ef-180">To retrieve the whole document without the XML declaration, the query can be specified as shown in the following:</span></span>  
  
```  
SELECT *  
FROM OPENXML (@idoc, '/root')  
   WITH (Col1 ntext '@mp:xmltext')  
EXEC sp_xml_removedocument @idoc  
```  
  
 <span data-ttu-id="178ef-181">查询将返回带有名称根的根元素以及根元素所包含的数据。</span><span class="sxs-lookup"><span data-stu-id="178ef-181">The query returns the root element that has the name root and the data that is contained by the root element</span></span>  
  
### <a name="c-specifying-the-xmltext-metaproperty-to-retrieve-the-unconsumed-data-in-a-column"></a><span data-ttu-id="178ef-182">C.</span><span class="sxs-lookup"><span data-stu-id="178ef-182">C.</span></span> <span data-ttu-id="178ef-183">指定 xmltext 元属性来检索列中未使用的数据</span><span class="sxs-lookup"><span data-stu-id="178ef-183">Specifying the xmltext metaproperty to retrieve the unconsumed data in a column</span></span>  
 <span data-ttu-id="178ef-184">此示例使用 OPENXML 创建该示例 XML 文档的行集视图。</span><span class="sxs-lookup"><span data-stu-id="178ef-184">This example uses OPENXML to create a rowset view of the sample XML document.</span></span> <span data-ttu-id="178ef-185">本例显示了如何通过将 **xmltext** 元属性特性映射到 OPENXML 中的行集列来检索未用完的 XML 数据。</span><span class="sxs-lookup"><span data-stu-id="178ef-185">The example shows how to retrieve unconsumed XML data by mapping the **xmltext** metaproperty attribute to a rowset column in OPENXML.</span></span>  
  
 <span data-ttu-id="178ef-186">通过将 comment 列映射到 \@mp:xmltext 元属性，把它标识为溢出列。</span><span class="sxs-lookup"><span data-stu-id="178ef-186">The **comment** column is identified as the overflow column by mapping it to the **\@mp:xmltext** metaproperty.</span></span> <span data-ttu-id="178ef-187">*flags* 参数将设置为 **9** （XML_ATTRIBUTE 和 XML_NOCOPY）。</span><span class="sxs-lookup"><span data-stu-id="178ef-187">The *flags* parameter is set to **9** (XML_ATTRIBUTE and XML_NOCOPY).</span></span> <span data-ttu-id="178ef-188">这指明了 **attribute-centric** 映射，并指明只有未用完的数据才应当被复制到溢出列中。</span><span class="sxs-lookup"><span data-stu-id="178ef-188">This indicates **attribute-centric** mapping and indicates that only the unconsumed data should be copied to the overflow column.</span></span>  
  
 <span data-ttu-id="178ef-189">然后，SELECT 语句返回由 OPENXML 生成的行集。</span><span class="sxs-lookup"><span data-stu-id="178ef-189">The SELECT statement then returns the rowset provided by OPENXML.</span></span>  
  
 <span data-ttu-id="178ef-190">此示例为 OPENXML 所生成行集中的 ParentLocalName 列设置了 \@mp:parentlocalname 元属性。</span><span class="sxs-lookup"><span data-stu-id="178ef-190">In this example, the **\@mp:parentlocalname** metaproperty is set for a column, **ParentLocalName**, in the rowset generated by OPENXML.</span></span> <span data-ttu-id="178ef-191">因此，此列包含父元素的本地名。</span><span class="sxs-lookup"><span data-stu-id="178ef-191">As a result, this column contains the local name of the parent element.</span></span>  
  
 <span data-ttu-id="178ef-192">在行集中另外还指定了两列， **parent** 和 **comment**。</span><span class="sxs-lookup"><span data-stu-id="178ef-192">Two additional columns are specified in the rowset, **parent** and **comment**.</span></span> <span data-ttu-id="178ef-193">parent 列映射到 \@mp:parentid，并指明列中包含元素的父元素的 XML ID。</span><span class="sxs-lookup"><span data-stu-id="178ef-193">The **parent** column is mapped to **\@mp:parentid** and indicates that the column contains the XML ID of the parent element of the element.</span></span> <span data-ttu-id="178ef-194">通过将 comment 列映射到 \@mp:xmltext 元属性，把它标识为溢出列。</span><span class="sxs-lookup"><span data-stu-id="178ef-194">The comment column is identified as the overflow column by mapping it to the **\@mp:xmltext** metaproperty.</span></span>  
  
```  
DECLARE @idoc int  
DECLARE @doc nvarchar(1000)  
-- sample XML document  
SET @doc = N'<root>  
  <Customer cid= "C1" name="Janine" city="Issaquah">  
      <Order oid="O1" date="1/20/1996" amount="3.5" />  
      <Order oid="O2" date="4/30/1997" amount="13.4">Customer was very satisfied</Order>  
   </Customer>  
   <Customer cid="C2" name="Ursula" city="Oelde" >  
      <Order oid="O3" date="7/14/1999" amount="100" note="Wrap it blue white red">  
          <Urgency>Important</Urgency>  
      </Order>  
      <Order oid="O4" date="1/20/1996" amount="10000"/>  
   </Customer>  
</root>  
'  
-- Create an internal representation of the XML document.  
EXEC sp_xml_preparedocument @idoc OUTPUT, @doc  
  
-- Execute a SELECT statement using OPENXML rowset provider.  
SELECT *  
FROM OPENXML (@idoc, '/root/Customer/Order', 9)  
      WITH (oid char(5),   
            date datetime,  
            comment ntext '@mp:xmltext')  
EXEC sp_xml_removedocument @idoc  
```  
  
 <span data-ttu-id="178ef-195">结果如下：</span><span class="sxs-lookup"><span data-stu-id="178ef-195">This is the result.</span></span> <span data-ttu-id="178ef-196">因为 oid 列和 date 列已经用完，因此它们不会出现在溢出列中。</span><span class="sxs-lookup"><span data-stu-id="178ef-196">Because the oid columns and date columns are already consumed, they do not appear in the overflow column.</span></span>  
  
```  
oid   date                        comment                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
----- --------------------------- ----------------------------------------  
O1    1996-01-20 00:00:00.000     <Order amount="3.5"/>  
O2    1997-04-30 00:00:00.000     <Order amount="13.4">Customer was very   
                                   satisfied</Order>  
O3    1999-07-14 00:00:00.000     <Order amount="100" note="Wrap it blue   
                                   white red"><Urgency>   
                                   Important</Urgency></Order>  
O4    1996-01-20 00:00:00.000     <Order amount="10000"/>  
```  
  
## <a name="see-also"></a><span data-ttu-id="178ef-197">另请参阅</span><span class="sxs-lookup"><span data-stu-id="178ef-197">See Also</span></span>  
 <span data-ttu-id="178ef-198">[OPENXML (Transact-SQL)](/sql/t-sql/functions/openxml-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="178ef-198">[OPENXML &#40;Transact-SQL&#41;](/sql/t-sql/functions/openxml-transact-sql) </span></span>  
 [<span data-ttu-id="178ef-199">OPENXML (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="178ef-199">OPENXML &#40;SQL Server&#41;</span></span>](../xml/openxml-sql-server.md)  
  
  
