---
title: CLR 集成概述 |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: clr
ms.topic: reference
helpviewer_keywords:
- common language runtime [SQL Server], about CLR integration
- extended stored procedures [SQL Server], vs. managed code
- objects [CLR integration]
- Transact-SQL vs. managed code
- managed code [SQL Server], vs. Transact-SQL
- managed code [SQL Server], vs. extended stored procedures
- execution at client vs. execution at server [CLR integration]
ms.assetid: 5aa176da-3652-4afa-a742-4c40c77ce5c3
author: rothja
ms.author: jroth
ms.openlocfilehash: ab7bb50109fa6b0a313da24f0e6164350a6160e3
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87691233"
---
# <a name="overview-of-clr-integration"></a><span data-ttu-id="1454b-102">CLR 集成的概述</span><span class="sxs-lookup"><span data-stu-id="1454b-102">Overview of CLR Integration</span></span>
  <span data-ttu-id="1454b-103">公共语言运行时 (CLR) 是 Microsoft .NET Framework 的核心，它为所有 .NET Framework 代码提供执行环境。</span><span class="sxs-lookup"><span data-stu-id="1454b-103">The common language runtime (CLR) is the heart of the Microsoft .NET Framework and provides the execution environment for all .NET Framework code.</span></span> <span data-ttu-id="1454b-104">在 CLR 中运行的代码称为托管代码。</span><span class="sxs-lookup"><span data-stu-id="1454b-104">Code that runs within the CLR is referred to as managed code.</span></span> <span data-ttu-id="1454b-105">CLR 提供执行程序所需的各种函数和服务，包括实时 (JIT) 编译、分配和管理内存、强制类型安全、异常处理、线程管理和安全性。</span><span class="sxs-lookup"><span data-stu-id="1454b-105">The CLR provides various functions and services required for program execution, including just-in-time (JIT) compilation, allocating and managing memory, enforcing type safety, exception handling, thread management, and security.</span></span>  <span data-ttu-id="1454b-106">有关详细信息，请参阅 .NET Framework SDK。</span><span class="sxs-lookup"><span data-stu-id="1454b-106">See the .NET Framework SDK for more information.</span></span>  
  
 <span data-ttu-id="1454b-107">使用在 Microsoft SQL Server 中驻留的 CLR（称为 CLR 集成），可以在托管代码中编写存储过程、触发器、用户定义函数、用户定义类型和用户定义聚合。</span><span class="sxs-lookup"><span data-stu-id="1454b-107">With the CLR hosted in Microsoft SQL Server (called CLR integration), you can author stored procedures, triggers, user-defined functions, user-defined types, and user-defined aggregates in managed code.</span></span> <span data-ttu-id="1454b-108">由于托管代码在执行之前才编译为本机代码，因此在某些情形下可以大幅提高性能。</span><span class="sxs-lookup"><span data-stu-id="1454b-108">Because managed code compiles to native code prior to execution, you can achieve significant performance increases in some scenarios.</span></span>  
  
 <span data-ttu-id="1454b-109">托管代码使用代码访问安全性 (CAS) 来阻止程序集执行某些操作。</span><span class="sxs-lookup"><span data-stu-id="1454b-109">Managed code uses Code Access Security (CAS) to prevent assemblies from performing certain operations.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="1454b-110">使用 CAS 来帮助保护托管代码，并阻止对操作系统或数据库服务器的侵害。</span><span class="sxs-lookup"><span data-stu-id="1454b-110">uses CAS to help secure the managed code and prevent compromise of the operating system or database server.</span></span>  
  
## <a name="advantages-of-clr-integration"></a><span data-ttu-id="1454b-111">CLR 集成的优点</span><span class="sxs-lookup"><span data-stu-id="1454b-111">Advantages of CLR Integration</span></span>  
 [!INCLUDE[tsql](../../../includes/tsql-md.md)] <span data-ttu-id="1454b-112">是为了在数据库中直接进行数据访问和操纵而专门设计的。</span><span class="sxs-lookup"><span data-stu-id="1454b-112">is specifically designed for direct data access and manipulation in the database.</span></span> <span data-ttu-id="1454b-113">虽然 [!INCLUDE[tsql](../../../includes/tsql-md.md)] 在数据访问和管理方面表现很好，但它不是完整的编程语言。</span><span class="sxs-lookup"><span data-stu-id="1454b-113">While [!INCLUDE[tsql](../../../includes/tsql-md.md)] excels at data access and management, it is not a full-fledged programming language.</span></span> <span data-ttu-id="1454b-114">例如，[!INCLUDE[tsql](../../../includes/tsql-md.md)] 不支持数组、集合、for-each 循环、移位或类。</span><span class="sxs-lookup"><span data-stu-id="1454b-114">For example, [!INCLUDE[tsql](../../../includes/tsql-md.md)] does not support arrays, collections, for-each loops, bit shifting, or classes.</span></span> <span data-ttu-id="1454b-115">虽然可以在 [!INCLUDE[tsql](../../../includes/tsql-md.md)] 中模拟某些这样的构造，但托管代码已经集成了对这些构造的支持。</span><span class="sxs-lookup"><span data-stu-id="1454b-115">While some of these constructs can be simulated in [!INCLUDE[tsql](../../../includes/tsql-md.md)], managed code has integrated support for these constructs.</span></span> <span data-ttu-id="1454b-116">根据具体情况，这些功能足以为在托管代码中实现某些数据库功能提供充分理由。</span><span class="sxs-lookup"><span data-stu-id="1454b-116">Depending on the scenario, these features can provide a compelling reason to implement certain database functionality in managed code.</span></span>  
  
 <span data-ttu-id="1454b-117">Microsoft Visual Basic .NET 和 Microsoft Visual C# 提供面向对象的功能，例如包装、继承和多态性。</span><span class="sxs-lookup"><span data-stu-id="1454b-117">Microsoft Visual Basic .NET and Microsoft Visual C# offer object-oriented capabilities such as encapsulation, inheritance, and polymorphism.</span></span> <span data-ttu-id="1454b-118">现在可以很容易将相关代码组织到类和命名空间中。</span><span class="sxs-lookup"><span data-stu-id="1454b-118">Related code can now be easily organized into classes and namespaces.</span></span> <span data-ttu-id="1454b-119">如果正在处理大量服务器代码，这将允许您更容易组织和维护代码。</span><span class="sxs-lookup"><span data-stu-id="1454b-119">When you are working with large amounts of server code, this allows you to more easily organize and maintain your code.</span></span>  
  
 <span data-ttu-id="1454b-120">托管代码比 [!INCLUDE[tsql](../../../includes/tsql-md.md)] 更适合用于计算和复杂的执行逻辑，并可提供对很多复杂任务（包括字符串处理和正则表达式）的广泛支持。</span><span class="sxs-lookup"><span data-stu-id="1454b-120">Managed code is better suited than [!INCLUDE[tsql](../../../includes/tsql-md.md)] for calculations and complicated execution logic, and features extensive support for many complex tasks, including string handling and regular expressions.</span></span> <span data-ttu-id="1454b-121">使用在 .NET Framework 库中提供的功能，可以访问数千个预建的类和例程。</span><span class="sxs-lookup"><span data-stu-id="1454b-121">With the functionality found in the .NET Framework Library, you have access to thousands of pre-built classes and routines.</span></span> <span data-ttu-id="1454b-122">可以很容易从任何存储过程、触发器或用户定义函数访问它们。</span><span class="sxs-lookup"><span data-stu-id="1454b-122">These can be easily accessed from any stored procedure, trigger or user defined function.</span></span> <span data-ttu-id="1454b-123">基类库 (BCL) 包括可为字符串操纵、高级数学操作、文件访问、加密等提供功能的类。</span><span class="sxs-lookup"><span data-stu-id="1454b-123">The Base Class Library (BCL) includes classes that provide functionality for string manipulation, advanced math operations, file access, cryptography, and more.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="1454b-124">虽然可以在 SQL Server 中从 CLR 代码的内部使用很多这样的类，但那些不适合用于服务器端的类（例如，窗口类）将不可用。</span><span class="sxs-lookup"><span data-stu-id="1454b-124">While many of these classes are available for use from within CLR code in SQL Server, those that are not appropriate for server-side use (for example, windowing classes), are not available.</span></span> <span data-ttu-id="1454b-125">有关详细信息，请参阅[支持的 .NET Framework 库](database-objects/supported-net-framework-libraries.md)。</span><span class="sxs-lookup"><span data-stu-id="1454b-125">For more information, see [Supported .NET Framework Libraries](database-objects/supported-net-framework-libraries.md).</span></span>  
  
 <span data-ttu-id="1454b-126">托管代码的一个好处是类型安全，即确保代码仅以明确定义和许可的方式访问类型。</span><span class="sxs-lookup"><span data-stu-id="1454b-126">One of the benefits of managed code is type safety, or the assurance that code accesses types only in well-defined, permissible ways.</span></span> <span data-ttu-id="1454b-127">在执行托管代码之前，CLR 将验证该代码是否安全。</span><span class="sxs-lookup"><span data-stu-id="1454b-127">Before managed code is executed, the CLR verifies that the code is safe.</span></span> <span data-ttu-id="1454b-128">例如，系统将检查代码以确保其不会读取以前未曾写入的内存。</span><span class="sxs-lookup"><span data-stu-id="1454b-128">For example, the code is checked to ensure that no memory is read that has not previously been written.</span></span> <span data-ttu-id="1454b-129">CLR 还可以帮助确保代码不会操纵非托管内存。</span><span class="sxs-lookup"><span data-stu-id="1454b-129">The CLR can also help ensure that code does not manipulate unmanaged memory.</span></span>  
  
 <span data-ttu-id="1454b-130">CLR 集成为提高性能提供了可能。</span><span class="sxs-lookup"><span data-stu-id="1454b-130">CLR integration offers the potential for improved performance.</span></span> <span data-ttu-id="1454b-131">有关信息，请参阅[CLR 集成的性能](clr-integration-architecture-performance.md)。</span><span class="sxs-lookup"><span data-stu-id="1454b-131">For information, see [Performance of CLR Integration](clr-integration-architecture-performance.md).</span></span>  
  
## <a name="choosing-between-transact-sql-and-managed-code"></a><span data-ttu-id="1454b-132">选择 Transact-SQL 还是托管代码</span><span class="sxs-lookup"><span data-stu-id="1454b-132">Choosing Between Transact-SQL and Managed Code</span></span>  
 <span data-ttu-id="1454b-133">编写存储过程、触发器和用户定义函数时，必须决定是使用传统的 [!INCLUDE[tsql](../../../includes/tsql-md.md)] 还是使用诸如 Visual Basic .NET 或 Visual C# 这样的 .NET Framework 语言。</span><span class="sxs-lookup"><span data-stu-id="1454b-133">When writing stored procedures, triggers, and user-defined functions, one decision you must make is whether to use traditional [!INCLUDE[tsql](../../../includes/tsql-md.md)], or a .NET Framework language such as Visual Basic .NET or Visual C#.</span></span> <span data-ttu-id="1454b-134">如果代码主要执行没有或只有很少过程逻辑的数据访问，请使用 [!INCLUDE[tsql](../../../includes/tsql-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="1454b-134">Use [!INCLUDE[tsql](../../../includes/tsql-md.md)] when the code will mostly perform data access with little or no procedural logic.</span></span> <span data-ttu-id="1454b-135">如果要编写有复杂逻辑并且 CPU 占用量大的函数和过程，或者想使用 .NET Framework 的 BCL，则使用托管代码。</span><span class="sxs-lookup"><span data-stu-id="1454b-135">Use managed code for CPU-intensive functions and procedures that feature complex logic, or when you want to make use of the BCL of the .NET Framework.</span></span>  
  
### <a name="choosing-between-execution-in-the-server-and-execution-in-the-client"></a><span data-ttu-id="1454b-136">选择在服务器中执行还是在客户端中执行</span><span class="sxs-lookup"><span data-stu-id="1454b-136">Choosing Between Execution in the Server and Execution in the Client</span></span>  
 <span data-ttu-id="1454b-137">影响使用 [!INCLUDE[tsql](../../../includes/tsql-md.md)] 还是托管代码的另一个因素是您想将代码驻留在服务器计算机上，还是在客户端计算机上。</span><span class="sxs-lookup"><span data-stu-id="1454b-137">Another factor in your decision about whether to use [!INCLUDE[tsql](../../../includes/tsql-md.md)] or managed code is where you would like your code to reside, the server computer or the client computer.</span></span> <span data-ttu-id="1454b-138">[!INCLUDE[tsql](../../../includes/tsql-md.md)] 和托管代码都可以在服务器上运行。</span><span class="sxs-lookup"><span data-stu-id="1454b-138">Both [!INCLUDE[tsql](../../../includes/tsql-md.md)] and managed code can be run on the server.</span></span> <span data-ttu-id="1454b-139">这种方式可以将代码和数据靠近放在一起，并允许您利用服务器的强大处理能力。</span><span class="sxs-lookup"><span data-stu-id="1454b-139">This places code and data close together, and allows you to take advantage of the processing power of the server.</span></span> <span data-ttu-id="1454b-140">另一方面，您可能希望避免将处理器占用量大的任务放在数据库服务器上。</span><span class="sxs-lookup"><span data-stu-id="1454b-140">On the other hand, you may wish to avoid placing processor intensive tasks on your database server.</span></span> <span data-ttu-id="1454b-141">目前大多数客户端计算机都有非常强大的功能，因此您可能希望通过将尽可能多的代码放在客户端上，来利用这种处理能力。</span><span class="sxs-lookup"><span data-stu-id="1454b-141">Most client computers today are very powerful, and you may wish to take advantage of this processing power by placing as much code as possible on the client.</span></span> <span data-ttu-id="1454b-142">托管代码可以在客户端计算机上运行，而 [!INCLUDE[tsql](../../../includes/tsql-md.md)] 不能。</span><span class="sxs-lookup"><span data-stu-id="1454b-142">Managed code can run on a client computer, while [!INCLUDE[tsql](../../../includes/tsql-md.md)] cannot.</span></span>  
  
## <a name="choosing-between-extended-stored-procedures-and-managed-code"></a><span data-ttu-id="1454b-143">选择扩展存储过程还是托管代码</span><span class="sxs-lookup"><span data-stu-id="1454b-143">Choosing Between Extended Stored Procedures and Managed Code</span></span>  
 <span data-ttu-id="1454b-144">可以生成扩展存储过程来执行使用 [!INCLUDE[tsql](../../../includes/tsql-md.md)] 存储过程无法实现的功能。</span><span class="sxs-lookup"><span data-stu-id="1454b-144">Extended stored procedures can be built to perform functionality not possible with [!INCLUDE[tsql](../../../includes/tsql-md.md)] stored procedures.</span></span> <span data-ttu-id="1454b-145">但是，扩展存储过程可能有损于 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 进程的完整性，而经过验证确定为类型安全的托管代码则不会。</span><span class="sxs-lookup"><span data-stu-id="1454b-145">Extended stored procedures can, however, compromise the integrity of the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] process, while managed code that is verified to be type-safe cannot.</span></span> <span data-ttu-id="1454b-146">进一步来说，在 CLR 的托管代码与 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 之间更深入地集成了内存管理、线程及纤程的调度以及同步服务。</span><span class="sxs-lookup"><span data-stu-id="1454b-146">Further, memory management, scheduling of threads and fibers, and synchronization services are more deeply integrated between the managed code of the CLR and [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="1454b-147">如果所编写的存储过程需要执行在 [!INCLUDE[tsql](../../../includes/tsql-md.md)] 中不可能完成的任务，则 CLR 集成有比扩展存储过程更安全的方式来实现它。</span><span class="sxs-lookup"><span data-stu-id="1454b-147">With CLR integration, you have a more secure way than extended stored procedures to write the stored procedures you need to perform tasks not possible in [!INCLUDE[tsql](../../../includes/tsql-md.md)].</span></span> <span data-ttu-id="1454b-148">有关 CLR 集成和扩展存储过程的详细信息，请参阅[Clr 集成的性能](clr-integration-architecture-performance.md)。</span><span class="sxs-lookup"><span data-stu-id="1454b-148">For more information about CLR integration and extended stored procedures, see [Performance of CLR Integration](clr-integration-architecture-performance.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="1454b-149">另请参阅</span><span class="sxs-lookup"><span data-stu-id="1454b-149">See Also</span></span>  
 <span data-ttu-id="1454b-150">[安装 .NET Framework](https://technet.microsoft.com/library/ms166014\(v=SQL.105\).aspx) </span><span class="sxs-lookup"><span data-stu-id="1454b-150">[Installing the .NET Framework](https://technet.microsoft.com/library/ms166014\(v=SQL.105\).aspx) </span></span>  
 <span data-ttu-id="1454b-151">[CLR 集成的体系结构](../../database-engine/dev-guide/architecture-of-clr-integration.md) </span><span class="sxs-lookup"><span data-stu-id="1454b-151">[Architecture of CLR Integration](../../database-engine/dev-guide/architecture-of-clr-integration.md) </span></span>  
 <span data-ttu-id="1454b-152">[从 CLR 数据库对象进行数据访问](data-access/data-access-from-clr-database-objects.md) </span><span class="sxs-lookup"><span data-stu-id="1454b-152">[Data Access from CLR Database Objects](data-access/data-access-from-clr-database-objects.md) </span></span>  
 [<span data-ttu-id="1454b-153">CLR 集成入门</span><span class="sxs-lookup"><span data-stu-id="1454b-153">Getting Started with CLR Integration</span></span>](database-objects/getting-started-with-clr-integration.md)  
  
  
