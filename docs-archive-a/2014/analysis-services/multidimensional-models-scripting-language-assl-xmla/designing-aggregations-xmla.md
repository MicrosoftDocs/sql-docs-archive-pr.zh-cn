---
title: " (XMLA) 设计聚合 |Microsoft Docs"
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: reference
helpviewer_keywords:
- statistical information [XML for Analysis]
- batches [XML for Analysis]
- aggregations [Analysis Services], XML for Analysis
- XMLA, aggregations
- queries [XMLA]
- XML for Analysis, aggregations
- iterative aggregation process [XMLA]
ms.assetid: 4dd27afa-10c7-408d-bc24-ca74217ddbcb
author: minewiskan
ms.author: owend
ms.openlocfilehash: 632cc071605cff6e42adec4acd32c9bd9949fc77
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87589931"
---
# <a name="designing-aggregations-xmla"></a><span data-ttu-id="ef74e-102">设计聚合 (XMLA)</span><span class="sxs-lookup"><span data-stu-id="ef74e-102">Designing Aggregations (XMLA)</span></span>
  <span data-ttu-id="ef74e-103">聚合设计与特定度量值组的分区相关联，以确保分区在存储聚合时使用相同的结构。</span><span class="sxs-lookup"><span data-stu-id="ef74e-103">Aggregation designs are associated with the partitions of a particular measure group to make sure that the partitions use the same structure when storing aggregations.</span></span> <span data-ttu-id="ef74e-104">使用分区的相同存储结构使你能够轻松定义以后可以使用[MergePartitions](https://docs.microsoft.com/bi-reference/xmla/xml-elements-commands/mergepartitions-element-xmla)命令合并的分区。</span><span class="sxs-lookup"><span data-stu-id="ef74e-104">Using the same storage structure for partitions lets you to easily define partitions that can be later merged using the [MergePartitions](https://docs.microsoft.com/bi-reference/xmla/xml-elements-commands/mergepartitions-element-xmla) command.</span></span> <span data-ttu-id="ef74e-105">有关聚合设计的详细信息，请参阅[聚合和聚合设计](../multidimensional-models-olap-logical-cube-objects/aggregations-and-aggregation-designs.md)。</span><span class="sxs-lookup"><span data-stu-id="ef74e-105">For more information about aggregation designs, see [Aggregations and Aggregation Designs](../multidimensional-models-olap-logical-cube-objects/aggregations-and-aggregation-designs.md).</span></span>  
  
 <span data-ttu-id="ef74e-106">若要为聚合设计定义聚合，可以使用 XML for Analysis (XMLA) 中的[DesignAggregations](https://docs.microsoft.com/bi-reference/xmla/xml-elements-commands/designaggregations-element-xmla)命令。</span><span class="sxs-lookup"><span data-stu-id="ef74e-106">To define aggregations for an aggregation design, you can use the [DesignAggregations](https://docs.microsoft.com/bi-reference/xmla/xml-elements-commands/designaggregations-element-xmla) command in XML for Analysis (XMLA).</span></span> <span data-ttu-id="ef74e-107">`DesignAggregations` 命令拥有一些属性，这些属性可标识要用作引用的聚合设计以及如何基于该引用控制设计过程。</span><span class="sxs-lookup"><span data-stu-id="ef74e-107">The `DesignAggregations` command has properties that identify which aggregation design to use as a reference and how to control the design process based upon that reference.</span></span> <span data-ttu-id="ef74e-108">使用 `DesignAggregations` 命令及其属性，可以采用迭代方式设计聚合或成批设计聚合，并可查看生成的设计统计信息，以评估设计过程。</span><span class="sxs-lookup"><span data-stu-id="ef74e-108">Using the `DesignAggregations` command and its properties, you can design aggregations iteratively or in batch, and then view the resulting design statistics to evaluate the design process.</span></span>  
  
## <a name="specifying-an-aggregation-design"></a><span data-ttu-id="ef74e-109">指定聚合设计</span><span class="sxs-lookup"><span data-stu-id="ef74e-109">Specifying an Aggregation Design</span></span>  
 <span data-ttu-id="ef74e-110">命令的[object](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/object-element-xmla)属性 `DesignAggregations` 必须包含对现有聚合设计的对象引用。</span><span class="sxs-lookup"><span data-stu-id="ef74e-110">The [Object](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/object-element-xmla) property of the `DesignAggregations` command must contain an object reference to an existing aggregation design.</span></span> <span data-ttu-id="ef74e-111">该对象引用包含数据库标识符、多维数据集标识符、度量值组标识符和聚合设计标识符。</span><span class="sxs-lookup"><span data-stu-id="ef74e-111">The object reference contains a database identifier, cube identifier, measure group identifier, and aggregation design identifier.</span></span> <span data-ttu-id="ef74e-112">如果该聚合设计不存在，则会出现错误。</span><span class="sxs-lookup"><span data-stu-id="ef74e-112">If the aggregation design does not already exist, an error occurs.</span></span>  
  
## <a name="controlling-the-design-process"></a><span data-ttu-id="ef74e-113">控制设计过程</span><span class="sxs-lookup"><span data-stu-id="ef74e-113">Controlling the Design Process</span></span>  
 <span data-ttu-id="ef74e-114">您可以使用 `DesignAggregations` 命令的下列属性控制用于为聚合设计定义聚合的算法：</span><span class="sxs-lookup"><span data-stu-id="ef74e-114">You can use the following properties of the `DesignAggregations` command to control the algorithm used to define aggregations for the aggregation design:</span></span>  
  
-   <span data-ttu-id="ef74e-115">[步骤](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/steps-element-xmla)属性确定命令在将 `DesignAggregations` 控制权返回给客户端应用程序之前应执行的迭代次数。</span><span class="sxs-lookup"><span data-stu-id="ef74e-115">The [Steps](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/steps-element-xmla) property determines how many iterations the `DesignAggregations` command should take before it returns control to the client application.</span></span>  
  
-   <span data-ttu-id="ef74e-116">[Time](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/time-element-xmla)属性确定命令在将 `DesignAggregations` 控制权返回给客户端应用程序之前应执行的毫秒数。</span><span class="sxs-lookup"><span data-stu-id="ef74e-116">The [Time](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/time-element-xmla) property determines how many milliseconds the `DesignAggregations` command should take before it returns control to the client application.</span></span>  
  
-   <span data-ttu-id="ef74e-117">"[优化](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/optimization-element-xmla)" 属性确定 `DesignAggregations` 命令应尝试实现的性能改进的估计百分比。</span><span class="sxs-lookup"><span data-stu-id="ef74e-117">The [Optimization](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/optimization-element-xmla) property determines the estimated percentage of performance improvement the `DesignAggregations` command should try to achieve.</span></span> <span data-ttu-id="ef74e-118">如果要以迭代方式设计聚合，只需在第一条命令中发送此属性。</span><span class="sxs-lookup"><span data-stu-id="ef74e-118">If you are iteratively designing aggregations, you only have to send this property on the first command.</span></span>  
  
-   <span data-ttu-id="ef74e-119">[存储](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/storage-element-xmla)属性用于确定命令所使用的磁盘存储量（以字节为单位） `DesignAggregations` 。</span><span class="sxs-lookup"><span data-stu-id="ef74e-119">The [Storage](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/storage-element-xmla) property determines the estimated amount of disk storage, in bytes, used by the `DesignAggregations` command.</span></span> <span data-ttu-id="ef74e-120">如果要以迭代方式设计聚合，只需在第一条命令中发送此属性。</span><span class="sxs-lookup"><span data-stu-id="ef74e-120">If you are iteratively designing aggregations, you only have to send this property on the first command.</span></span>  
  
-   <span data-ttu-id="ef74e-121">[具体化](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/materialize-element-xmla)属性确定 `DesignAggregations` 命令是否应创建在设计过程中定义的聚合。</span><span class="sxs-lookup"><span data-stu-id="ef74e-121">The [Materialize](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/materialize-element-xmla) property determines whether the `DesignAggregations` command should create the aggregations defined during the design process.</span></span> <span data-ttu-id="ef74e-122">如果要以迭代方式设计聚合，则应在准备好保存所设计的聚合之前，将此属性设置为 false。</span><span class="sxs-lookup"><span data-stu-id="ef74e-122">If you are iteratively designing aggregations, this property should be set to false until you are ready to save the designed aggregations.</span></span> <span data-ttu-id="ef74e-123">如果设置为 true，则当前设计过程将会终止，并会将所定义的聚合添加到指定的聚合设计中。</span><span class="sxs-lookup"><span data-stu-id="ef74e-123">When set to true, the current design process ends and the defined aggregations are added to the specified aggregation design.</span></span>  
  
## <a name="specifying-queries"></a><span data-ttu-id="ef74e-124">指定查询</span><span class="sxs-lookup"><span data-stu-id="ef74e-124">Specifying Queries</span></span>  
 <span data-ttu-id="ef74e-125">DesignAggregations 命令通过在 `Query` "[查询](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/queries-element-xmla)" 属性中包含一个或多个元素来支持基于使用情况的优化命令。</span><span class="sxs-lookup"><span data-stu-id="ef74e-125">The DesignAggregations command supports usage-based optimization command by including one or more `Query` elements in the [Queries](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/queries-element-xmla) property.</span></span> <span data-ttu-id="ef74e-126">`Queries`属性可以包含一个或多个[查询](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/query-element-xmla)元素。</span><span class="sxs-lookup"><span data-stu-id="ef74e-126">The `Queries` property can contain one or more [Query](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/query-element-xmla) elements.</span></span> <span data-ttu-id="ef74e-127">如果 `Queries` 属性不包含任何 `Query` 元素，则 `Object` 元素中指定的聚合设计将使用包含一组常规聚合的默认结构。</span><span class="sxs-lookup"><span data-stu-id="ef74e-127">If the `Queries` property does not contain any `Query` elements, the aggregation design specified in the `Object` element uses a default structure that contains a general set of aggregations.</span></span> <span data-ttu-id="ef74e-128">设计此组常规聚合的目的是为了满足 `Optimization` 命令的 `Storage` 和 `DesignAggregations` 属性中指定的条件。</span><span class="sxs-lookup"><span data-stu-id="ef74e-128">This general set of aggregations is designed to meet the criteria specified in the `Optimization` and `Storage` properties of the `DesignAggregations` command.</span></span>  
  
 <span data-ttu-id="ef74e-129">每个 `Query` 元素表示一个目标查询，设计进程使用这些查询定义以最常用的查询为目标的聚合。</span><span class="sxs-lookup"><span data-stu-id="ef74e-129">Each `Query` element represents a goal query that the design process uses to define aggregations that target the most frequently used queries.</span></span> <span data-ttu-id="ef74e-130">您可以指定自己的目标查询，也可以使用查询日志中实例存储的信息 [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 来检索最常用查询的相关信息。</span><span class="sxs-lookup"><span data-stu-id="ef74e-130">You can either specify your own goal queries, or you can use the information stored by an instance of [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] in the query log to retrieve information about the most frequently used queries.</span></span> <span data-ttu-id="ef74e-131">基于使用情况的优化向导会在发送 `DesignAggregations` 命令时，基于时间、使用情况或指定的用户，使用查询日志来检索目标查询。</span><span class="sxs-lookup"><span data-stu-id="ef74e-131">The Usage-Based Optimization Wizard uses the query log to retrieve goal queries based on time, usage, or a specified user when it sends a `DesignAggregations` command.</span></span> <span data-ttu-id="ef74e-132">有关详细信息，请参阅[基于使用情况的优化向导的 F1 帮助](../usage-based-optimization-wizard-f1-help.md)。</span><span class="sxs-lookup"><span data-stu-id="ef74e-132">For more information, see [Usage-Based Optimization Wizard F1 Help](../usage-based-optimization-wizard-f1-help.md).</span></span>  
  
 <span data-ttu-id="ef74e-133">如果您迭代式地设计聚合，则只需要在第一个 `DesignAggregations` 命令中传递目标查询，这是因为 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 实例存储这些目标查询，并在执行后续 `DesignAggregations` 命令时使用这些查询。</span><span class="sxs-lookup"><span data-stu-id="ef74e-133">If you are iteratively designing aggregations, you only have to pass goal queries in the first `DesignAggregations` command because the [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] instance stores these goal queries and uses these queries during subsequent `DesignAggregations` commands.</span></span> <span data-ttu-id="ef74e-134">在迭代进程的第一个`DesignAggregations` 命令中传递目标查询后，任何在 `DesignAggregations` 属性中包含目标查询的后续 `Queries` 命令都会生成错误。</span><span class="sxs-lookup"><span data-stu-id="ef74e-134">After you pass goal queries in the first `DesignAggregations` command of an iterative process, any subsequent `DesignAggregations` command that contains goal queries in the `Queries` property generates an error.</span></span>  
  
 <span data-ttu-id="ef74e-135">`Query` 元素包含一个以逗号分隔的值，该值包含以下参数：</span><span class="sxs-lookup"><span data-stu-id="ef74e-135">The `Query` element contains a comma-delimited value that contains the following arguments:</span></span>  
  
 <span data-ttu-id="ef74e-136">*Frequency*,*Dataset*[,*Dataset*...]</span><span class="sxs-lookup"><span data-stu-id="ef74e-136">*Frequency*,*Dataset*[,*Dataset*...]</span></span>  
  
 <span data-ttu-id="ef74e-137">*频率*</span><span class="sxs-lookup"><span data-stu-id="ef74e-137">*Frequency*</span></span>  
 <span data-ttu-id="ef74e-138">与该查询此前执行的次数对应的加权系数。</span><span class="sxs-lookup"><span data-stu-id="ef74e-138">A weighting factor that corresponds to the number of times that the query has previously been executed.</span></span> <span data-ttu-id="ef74e-139">如果该 `Query` 元素表示一个新查询，则*Frequency*值表示设计进程用于评估该查询的加权系数。</span><span class="sxs-lookup"><span data-stu-id="ef74e-139">If the `Query` element represents a new query, the *Frequency* value represents the weighting factor used by the design process to evaluate the query.</span></span> <span data-ttu-id="ef74e-140">在设计进程中，随着频率值变大，该查询的权重也会增加。</span><span class="sxs-lookup"><span data-stu-id="ef74e-140">As the frequency value becomes larger, the weight that is put on the query during the design process increases.</span></span>  
  
 <span data-ttu-id="ef74e-141">数据集</span><span class="sxs-lookup"><span data-stu-id="ef74e-141">*Dataset*</span></span>  
 <span data-ttu-id="ef74e-142">一个数字字符串，该字符串指定维度中的哪些属性要包括在该查询中。</span><span class="sxs-lookup"><span data-stu-id="ef74e-142">A numeric string that specifies which attributes from a dimension are to be included in the query.</span></span> <span data-ttu-id="ef74e-143">此字符串的字符个数必须与维度中的属性个数相同。</span><span class="sxs-lookup"><span data-stu-id="ef74e-143">This string must have the same number of characters as the number of attributes in the dimension.</span></span> <span data-ttu-id="ef74e-144">零 (0) 指示指定序号位置的属性不包括在指定维度的查询中，而 1 指示指定序号位置的属性包括在指定维度的查询中。</span><span class="sxs-lookup"><span data-stu-id="ef74e-144">Zero (0) indicates that the attribute in the specified ordinal position is not included in the query for the specified dimension, while one (1) indicates that the attribute in the specified ordinal position is included in the query for the specified dimension.</span></span>  
  
 <span data-ttu-id="ef74e-145">例如，字符串“011”所指的查询涉及具有三个属性的维度，其中第二个和第三个属性包括在该查询中。</span><span class="sxs-lookup"><span data-stu-id="ef74e-145">For example, the string "011" would refer to a query involving a dimension with three attributes, from which the second and third attributes are included in the query.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ef74e-146">某些属性与数据集无关。</span><span class="sxs-lookup"><span data-stu-id="ef74e-146">Some attributes are excluded from consideration in the dataset.</span></span> <span data-ttu-id="ef74e-147">有关排除的属性的详细信息，请参阅[&#40;XMLA&#41;的 Query 元素](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/query-element-xmla)。</span><span class="sxs-lookup"><span data-stu-id="ef74e-147">For more information about excluded attributes, see [Query Element &#40;XMLA&#41;](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/query-element-xmla).</span></span>  
  
 <span data-ttu-id="ef74e-148">包含聚合设计的度量值组中的每个维度都由元素中的*数据集*值表示 `Query` 。</span><span class="sxs-lookup"><span data-stu-id="ef74e-148">Each dimension in the measure group that contains the aggregation design is represented by a *Dataset* value in the `Query` element.</span></span> <span data-ttu-id="ef74e-149">*Dataset* 值的顺序必须与包括在度量值组中的维度的顺序一致。</span><span class="sxs-lookup"><span data-stu-id="ef74e-149">The order of *Dataset* values must match the order of dimensions included in the measure group.</span></span>  
  
## <a name="designing-aggregations-using-iterative-or-batch-processes"></a><span data-ttu-id="ef74e-150">使用迭代过程或批处理过程设计聚合</span><span class="sxs-lookup"><span data-stu-id="ef74e-150">Designing Aggregations Using Iterative or Batch Processes</span></span>  
 <span data-ttu-id="ef74e-151">您可以根据设计过程所要求的交互性，将 `DesignAggregations` 命令用作迭代过程或批处理过程的一部分。</span><span class="sxs-lookup"><span data-stu-id="ef74e-151">You can use the `DesignAggregations` command as part of an iterative process or a batch process, depending on the interactivity required by the design process.</span></span>  
  
### <a name="designing-aggregations-using-an-iterative-process"></a><span data-ttu-id="ef74e-152">使用迭代过程设计聚合</span><span class="sxs-lookup"><span data-stu-id="ef74e-152">Designing Aggregations Using an Iterative Process</span></span>  
 <span data-ttu-id="ef74e-153">若要以迭代方式设计聚合，请发送多个 `DesignAggregations` 命令，以精确地控制设计过程。</span><span class="sxs-lookup"><span data-stu-id="ef74e-153">To iteratively design aggregations, you send multiple `DesignAggregations` commands to provide fine control over the design process.</span></span> <span data-ttu-id="ef74e-154">聚合设计向导使用同样的方法精确控制设计过程。</span><span class="sxs-lookup"><span data-stu-id="ef74e-154">The Aggregation Design Wizard uses this same approach to provide fine control over the design process.</span></span> <span data-ttu-id="ef74e-155">有关详细信息，请参阅[聚合设计向导 F1 帮助](../aggregation-design-wizard-f1-help.md)。</span><span class="sxs-lookup"><span data-stu-id="ef74e-155">For more information, see [Aggregation Design Wizard F1 Help](../aggregation-design-wizard-f1-help.md).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ef74e-156">以迭代方式设计聚合需要显式会话。</span><span class="sxs-lookup"><span data-stu-id="ef74e-156">An explicit session is required to iteratively design aggregations.</span></span> <span data-ttu-id="ef74e-157">有关显式会话的详细信息，请参阅[&#40;XMLA&#41;管理连接和会话](managing-connections-and-sessions-xmla.md)。</span><span class="sxs-lookup"><span data-stu-id="ef74e-157">For more information about explicit sessions, see [Managing Connections and Sessions &#40;XMLA&#41;](managing-connections-and-sessions-xmla.md).</span></span>  
  
 <span data-ttu-id="ef74e-158">若要开始迭代过程，先要发送一条包含以下信息的 `DesignAggregations` 命令：</span><span class="sxs-lookup"><span data-stu-id="ef74e-158">To start the iterative process, you first send a `DesignAggregations` command that contains the following information:</span></span>  
  
-   <span data-ttu-id="ef74e-159">整个设计过程的目标 `Storage` 和 `Optimization` 属性值。</span><span class="sxs-lookup"><span data-stu-id="ef74e-159">The `Storage` and `Optimization` property values on which the whole design process is targeted.</span></span>  
  
-   <span data-ttu-id="ef74e-160">对设计过程的第一步进行限制的 `Steps` 和 `Time` 属性值。</span><span class="sxs-lookup"><span data-stu-id="ef74e-160">The `Steps` and `Time` property values on which the first step of the design process is limited.</span></span>  
  
-   <span data-ttu-id="ef74e-161">如果希望进行基于使用情况的优化，则还要提供包含作为整个设计过程目标的目标查询的 `Queries` 属性。</span><span class="sxs-lookup"><span data-stu-id="ef74e-161">If you want usage-based optimization, the `Queries` property that contains the goal queries on which the whole design process is targeted.</span></span>  
  
-   <span data-ttu-id="ef74e-162">设置为 false 的 `Materialize` 属性。</span><span class="sxs-lookup"><span data-stu-id="ef74e-162">The `Materialize` property set to false.</span></span> <span data-ttu-id="ef74e-163">将此属性设置为 false 指示当命令完成时，设计过程不会将所定义的聚合保存到聚合设计中。</span><span class="sxs-lookup"><span data-stu-id="ef74e-163">Setting this property to false indicates that the design process does not save the defined aggregations to the aggregation design when the command is completed.</span></span>  
  
 <span data-ttu-id="ef74e-164">当第一条 `DesignAggregations` 命令执行完毕后，它会返回一个包含设计统计信息的行集。</span><span class="sxs-lookup"><span data-stu-id="ef74e-164">When the first `DesignAggregations` command finishes, the command returns a rowset that contains design statistics.</span></span> <span data-ttu-id="ef74e-165">您可以对这些设计统计信息进行评估，以确定设计过程是应继续还是已完成。</span><span class="sxs-lookup"><span data-stu-id="ef74e-165">You can evaluate these design statistics to determine whether the design process should continue or whether the design process is finished.</span></span> <span data-ttu-id="ef74e-166">如果设计过程应继续，则应发送另一条 `DesignAggregations` 命令，其中包含对此步设计过程进行限制的 `Steps` 和 `Time` 值。</span><span class="sxs-lookup"><span data-stu-id="ef74e-166">If the process should continue, you then send another `DesignAggregations` command that contains the `Steps` and `Time` values with which this step of the design process is limited.</span></span> <span data-ttu-id="ef74e-167">您要对结果统计信息进行评估，然后确定设计过程是否应继续。</span><span class="sxs-lookup"><span data-stu-id="ef74e-167">You evaluate the resulting statistics and then determine whether the design process should continue.</span></span> <span data-ttu-id="ef74e-168">这种发送 `DesignAggregations` 命令并对结果进行评估的迭代过程将一直继续下去，直至达到目标并定义了一组适当的聚合为止。</span><span class="sxs-lookup"><span data-stu-id="ef74e-168">This iterative process of sending `DesignAggregations` commands and evaluating the results continues until you reach your goals and have a appropriate set of aggregations defined.</span></span>  
  
 <span data-ttu-id="ef74e-169">得到一组您需要的聚合后，应发送最后一条 `DesignAggregations` 命令。</span><span class="sxs-lookup"><span data-stu-id="ef74e-169">After you have reached the set of aggregations that you want, you send one final `DesignAggregations` command.</span></span> <span data-ttu-id="ef74e-170">最后一条 `DesignAggregations` 命令的 `Steps` 属性应设置为 1，`Materialize` 属性应设置为 true。</span><span class="sxs-lookup"><span data-stu-id="ef74e-170">This final `DesignAggregations` command should have its `Steps` property set to 1 and its `Materialize` property set to true.</span></span> <span data-ttu-id="ef74e-171">通过这些设置，此最后一条 `DesignAggregations` 命令将结束设计过程，并将所设计的聚合保存到聚合设计中。</span><span class="sxs-lookup"><span data-stu-id="ef74e-171">By using these settings, this final `DesignAggregations` command completes the design process and saves the defined aggregation to the aggregation design.</span></span>  
  
### <a name="designing-aggregations-using-a-batch-process"></a><span data-ttu-id="ef74e-172">使用批处理过程设计聚合</span><span class="sxs-lookup"><span data-stu-id="ef74e-172">Designing Aggregations Using a Batch Process</span></span>  
 <span data-ttu-id="ef74e-173">您还可以发送包含作为整个设计过程目标和对整个设计过程进行限制的 `DesignAggregations`、`Steps`、`Time` 和 `Storage` 属性的单条 `Optimization` 命令，从而以批处理方式设计聚合。</span><span class="sxs-lookup"><span data-stu-id="ef74e-173">You can also design aggregations in a batch process by sending a single `DesignAggregations` command that contains the `Steps`, `Time`, `Storage`, and `Optimization` property values on which the whole design process is targeted and limited.</span></span> <span data-ttu-id="ef74e-174">如果希望进行基于使用情况的优化，则 `Queries` 属性中还应包含作为整个设计过程目标的目标查询。</span><span class="sxs-lookup"><span data-stu-id="ef74e-174">If you want usage-based optimization, the goal queries on which the design process is targeted should also be included in the `Queries` property.</span></span> <span data-ttu-id="ef74e-175">此外，请确保将 `Materialize` 属性设置为 true，以使命令执行完毕时，设计过程会将所设计的聚合保存到聚合设计中。</span><span class="sxs-lookup"><span data-stu-id="ef74e-175">Also make sure that the `Materialize` property is set to true, so that the design process saves the defined aggregations to the aggregation design when the command finishes.</span></span>  
  
 <span data-ttu-id="ef74e-176">您可以在隐式或显式会话中使用批处理过程来设计聚合。</span><span class="sxs-lookup"><span data-stu-id="ef74e-176">You can design aggregations using a batch process in either an implicit or explicit session.</span></span> <span data-ttu-id="ef74e-177">有关隐式和显式会话的详细信息，请参阅[&#40;XMLA&#41;管理连接和会话](managing-connections-and-sessions-xmla.md)。</span><span class="sxs-lookup"><span data-stu-id="ef74e-177">For more information about implicit and explicit sessions, see [Managing Connections and Sessions &#40;XMLA&#41;](managing-connections-and-sessions-xmla.md).</span></span>  
  
## <a name="returning-design-statistics"></a><span data-ttu-id="ef74e-178">返回设计统计信息</span><span class="sxs-lookup"><span data-stu-id="ef74e-178">Returning Design Statistics</span></span>  
 <span data-ttu-id="ef74e-179">当 `DesignAggregations` 命令将控制权返还给客户端应用程序之后，该命令会返回一个包含一行的行集，该行包含命令的设计统计信息。</span><span class="sxs-lookup"><span data-stu-id="ef74e-179">When the `DesignAggregations` command returns control to the client application, the command returns a rowset that contains a single row representing the design statistics for the command.</span></span> <span data-ttu-id="ef74e-180">下表列出了该行集包含的列。</span><span class="sxs-lookup"><span data-stu-id="ef74e-180">The rowset contains the columns listed in the following table.</span></span>  
  
|<span data-ttu-id="ef74e-181">列</span><span class="sxs-lookup"><span data-stu-id="ef74e-181">Column</span></span>|<span data-ttu-id="ef74e-182">数据类型</span><span class="sxs-lookup"><span data-stu-id="ef74e-182">Data type</span></span>|<span data-ttu-id="ef74e-183">说明</span><span class="sxs-lookup"><span data-stu-id="ef74e-183">Description</span></span>|  
|------------|---------------|-----------------|  
|<span data-ttu-id="ef74e-184">步骤</span><span class="sxs-lookup"><span data-stu-id="ef74e-184">Steps</span></span>|<span data-ttu-id="ef74e-185">Integer</span><span class="sxs-lookup"><span data-stu-id="ef74e-185">Integer</span></span>|<span data-ttu-id="ef74e-186">在将控制权返还给客户端应用程序之前，命令执行的步数。</span><span class="sxs-lookup"><span data-stu-id="ef74e-186">The number of steps taken by the command before returning control to the client application.</span></span>|  
|<span data-ttu-id="ef74e-187">时间</span><span class="sxs-lookup"><span data-stu-id="ef74e-187">Time</span></span>|<span data-ttu-id="ef74e-188">Long integer</span><span class="sxs-lookup"><span data-stu-id="ef74e-188">Long integer</span></span>|<span data-ttu-id="ef74e-189">在将控制权返还给客户端应用程序之前，命令运行的毫秒数。</span><span class="sxs-lookup"><span data-stu-id="ef74e-189">The number of milliseconds taken by the command before returning control to the client application.</span></span>|  
|<span data-ttu-id="ef74e-190">优化</span><span class="sxs-lookup"><span data-stu-id="ef74e-190">Optimization</span></span>|<span data-ttu-id="ef74e-191">Double</span><span class="sxs-lookup"><span data-stu-id="ef74e-191">Double</span></span>|<span data-ttu-id="ef74e-192">在将控制权返还给客户端应用程序之前，命令获得的性能提高百分比估计值。</span><span class="sxs-lookup"><span data-stu-id="ef74e-192">The estimated percentage of performance improvement achieved by the command before returning control to the client application.</span></span>|  
|<span data-ttu-id="ef74e-193">存储</span><span class="sxs-lookup"><span data-stu-id="ef74e-193">Storage</span></span>|<span data-ttu-id="ef74e-194">Long integer</span><span class="sxs-lookup"><span data-stu-id="ef74e-194">Long integer</span></span>|<span data-ttu-id="ef74e-195">在将控制权返还给客户端应用程序之前，命令占用的存储空间的估计字节数。</span><span class="sxs-lookup"><span data-stu-id="ef74e-195">The estimated number of bytes taken by the command before returning control to the client application.</span></span>|  
|<span data-ttu-id="ef74e-196">聚合</span><span class="sxs-lookup"><span data-stu-id="ef74e-196">Aggregations</span></span>|<span data-ttu-id="ef74e-197">Long integer</span><span class="sxs-lookup"><span data-stu-id="ef74e-197">Long integer</span></span>|<span data-ttu-id="ef74e-198">在将控制权返还给客户端应用程序之前，命令定义的聚合数。</span><span class="sxs-lookup"><span data-stu-id="ef74e-198">The number of aggregations defined by the command before returning control to the client application.</span></span>|  
|<span data-ttu-id="ef74e-199">LastStep</span><span class="sxs-lookup"><span data-stu-id="ef74e-199">LastStep</span></span>|<span data-ttu-id="ef74e-200">Boolean</span><span class="sxs-lookup"><span data-stu-id="ef74e-200">Boolean</span></span>|<span data-ttu-id="ef74e-201">指示行集中的数据是否表示设计过程的最后一步。</span><span class="sxs-lookup"><span data-stu-id="ef74e-201">Indicates whether the data in the rowset represents the last step in the design process.</span></span> <span data-ttu-id="ef74e-202">如果命令的 `Materialize` 属性设置为 true，则此列的值设置为 true。</span><span class="sxs-lookup"><span data-stu-id="ef74e-202">If the `Materialize` property of the command was set to true,  the value of this column is set to true.</span></span>|  
  
 <span data-ttu-id="ef74e-203">在迭代和批处理设计过程中，您都可以使用每个 `DesignAggregations` 命令执行完毕之后所返回的行集中包含的设计统计信息。</span><span class="sxs-lookup"><span data-stu-id="ef74e-203">You can use the design statistics that are contained in the rowset returned after each `DesignAggregations` command in both iterative and batch design.</span></span> <span data-ttu-id="ef74e-204">在迭代设计过程中，您可以使用设计统计信息来确定并显示进度。</span><span class="sxs-lookup"><span data-stu-id="ef74e-204">In iterative design, you can use the design statistics to determine and display progress.</span></span> <span data-ttu-id="ef74e-205">以批处理方式设计聚合时，您可以使用设计统计信息来确定命令所创建的聚合数。</span><span class="sxs-lookup"><span data-stu-id="ef74e-205">When you are designing aggregations in batch, you can use the design statistics to determine the number of aggregations created by the command.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ef74e-206">另请参阅</span><span class="sxs-lookup"><span data-stu-id="ef74e-206">See Also</span></span>  
 [<span data-ttu-id="ef74e-207">在 Analysis Services 中使用 XMLA 开发</span><span class="sxs-lookup"><span data-stu-id="ef74e-207">Developing with XMLA in Analysis Services</span></span>](developing-with-xmla-in-analysis-services.md)  
  
  
