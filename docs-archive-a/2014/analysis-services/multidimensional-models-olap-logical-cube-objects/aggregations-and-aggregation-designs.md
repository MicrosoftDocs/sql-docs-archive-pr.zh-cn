---
title: 聚合和聚合设计 |Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: reference
helpviewer_keywords:
- aggregations [Analysis Services], about aggregations
- storage [Analysis Services], aggregations
- Storage Design Wizard
- data summary [Analysis Services]
- data storage [Analysis Services]
- storing data [Analysis Services], aggregations
- aggregations [Analysis Services]
ms.assetid: 35bd8589-39fa-4e0b-b28f-5a07d70da0a2
author: minewiskan
ms.author: owend
ms.openlocfilehash: c56e80482ef71e8041f8518ae9901691a1809990
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87689650"
---
# <a name="aggregations-and-aggregation-designs"></a><span data-ttu-id="46a84-102">聚合和聚合设计</span><span class="sxs-lookup"><span data-stu-id="46a84-102">Aggregations and Aggregation Designs</span></span>
  <span data-ttu-id="46a84-103"> 对象定义一组可在多个分区间共享的聚合定义。</span><span class="sxs-lookup"><span data-stu-id="46a84-103">An <xref:Microsoft.AnalysisServices.AggregationDesign> object defines a set of aggregation definitions that can be shared across multiple partitions.</span></span>  
  
 <span data-ttu-id="46a84-104"><xref:Microsoft.AnalysisServices.Aggregation> 对象表示某一维度粒度级别上的度量值组数据的汇总。</span><span class="sxs-lookup"><span data-stu-id="46a84-104">An <xref:Microsoft.AnalysisServices.Aggregation> object represents the summarization of measure group data at certain granularity of the dimensions.</span></span>  
  
 <span data-ttu-id="46a84-105">简单 <xref:Microsoft.AnalysisServices.Aggregation> 对象由基本信息和维度组成。</span><span class="sxs-lookup"><span data-stu-id="46a84-105">A simple <xref:Microsoft.AnalysisServices.Aggregation> object is composed of: basic information and dimensions.</span></span> <span data-ttu-id="46a84-106">基本信息包括聚合的名称、ID、批注和说明。</span><span class="sxs-lookup"><span data-stu-id="46a84-106">Basic information includes the name of the aggregation, the ID, annotations, and a description.</span></span> <span data-ttu-id="46a84-107">维度是包含维度的粒度属性列表的 <xref:Microsoft.AnalysisServices.AggregationDimension> 对象的集合。</span><span class="sxs-lookup"><span data-stu-id="46a84-107">The dimensions are a collection of <xref:Microsoft.AnalysisServices.AggregationDimension> objects that contain the list of granularity attributes for the dimension.</span></span>  
  
 <span data-ttu-id="46a84-108">聚合是预先计算好的叶单元数据汇总，</span><span class="sxs-lookup"><span data-stu-id="46a84-108">Aggregations are precalculated summaries of data from leaf cells.</span></span> <span data-ttu-id="46a84-109">它通过在问题提出之前就准备好答案来缩短查询响应时间。</span><span class="sxs-lookup"><span data-stu-id="46a84-109">Aggregations improve query response time by preparing the answers before the questions are asked.</span></span> <span data-ttu-id="46a84-110">例如，当数据仓库事实数据表包含数十万行时，如果在查询时必须扫描事实数据表中的所有行并计算总和以计算答案，则请求某个特定产品系列每周销售总额的查询需花费很长时间。</span><span class="sxs-lookup"><span data-stu-id="46a84-110">For example, when a data warehouse fact table contains hundreds of thousands of rows, a query requesting the weekly sales totals for a particular product line can take a long time to answer if all the rows in the fact table have to be scanned and summed at query time to compute the answer.</span></span> <span data-ttu-id="46a84-111">但是，如果用于回答此查询的汇总数据已经预先计算好，则几乎可以立即响应。</span><span class="sxs-lookup"><span data-stu-id="46a84-111">However, the response can be almost immediate if the summarization data to answer this query has been precalculated.</span></span> <span data-ttu-id="46a84-112">这种对汇总数据的预先计算在处理过程中进行，是 OLAP 技术快速响应时间的基础。</span><span class="sxs-lookup"><span data-stu-id="46a84-112">This precalculation of summary data occurs during processing and is the foundation for the rapid response times of OLAP technology.</span></span>  
  
 <span data-ttu-id="46a84-113">多维数据集是 OLAP 技术将汇总数据组织成为多维结构所使用的方式。</span><span class="sxs-lookup"><span data-stu-id="46a84-113">Cubes are the way that OLAP technology organizes summary data into multidimensional structures.</span></span> <span data-ttu-id="46a84-114">维度及其属性层次结构反映了可以向多维数据集提出哪些查询。</span><span class="sxs-lookup"><span data-stu-id="46a84-114">Dimensions and their hierarchies of attributes reflect the queries that can be asked of the cube.</span></span> <span data-ttu-id="46a84-115">聚合按维度所指定的坐标存储在多维结构单元中。</span><span class="sxs-lookup"><span data-stu-id="46a84-115">Aggregations are stored in the multidimensional structure in cells at coordinates specified by the dimensions.</span></span> <span data-ttu-id="46a84-116">例如，问题“1998 年产品 X 在西北地区的销售额是多少？”</span><span class="sxs-lookup"><span data-stu-id="46a84-116">For example, the question "What were the sales of product X in 1998 for the Northwest region?"</span></span> <span data-ttu-id="46a84-117">涉及到三个维度（产品、时间和地域）和一个度量值（销售额）。</span><span class="sxs-lookup"><span data-stu-id="46a84-117">involves three dimensions (Product, Time, and Geography) and one measure (Sales).</span></span> <span data-ttu-id="46a84-118">在多维数据集中指定坐标（产品 X, 1998, 西北）处单元的值就是这个问题的答案，这是一个单一的数值。</span><span class="sxs-lookup"><span data-stu-id="46a84-118">The value of the cell in the cube at the specified coordinates (product X, 1998, Northwest) is the answer, a single numeric value.</span></span>  
  
 <span data-ttu-id="46a84-119">其他问题可能返回多个值。</span><span class="sxs-lookup"><span data-stu-id="46a84-119">Other questions may return multiple values.</span></span> <span data-ttu-id="46a84-120">例如，“1998 年硬件产品按季度按区域的销售额是多少？”</span><span class="sxs-lookup"><span data-stu-id="46a84-120">For example, "How much were the sales of hardware products by quarter by region for 1998?"</span></span> <span data-ttu-id="46a84-121">这类查询会从满足所指定条件的坐标处返回很多单元集。</span><span class="sxs-lookup"><span data-stu-id="46a84-121">Such queries return sets of cells from the coordinates that satisfy the specified conditions.</span></span> <span data-ttu-id="46a84-122">查询返回的单元数目取决于“产品”维度“硬件”级别中的项目数、1998 年的四个季度和“地域”维度中的地区数目。</span><span class="sxs-lookup"><span data-stu-id="46a84-122">The number of cells returned by the query depends on the number of items in the Hardware level of the Product dimension, the four quarters in 1998, and the number of regions in the Geography dimension.</span></span> <span data-ttu-id="46a84-123">如果所有的汇总数据都已经预先计算到聚合中，则这种查询的响应时间仅取决于提取指定单元所需的时间。</span><span class="sxs-lookup"><span data-stu-id="46a84-123">If all summary data has been precalculated into aggregations, the response time of the query will depend only on the time that is required to extract the specified cells.</span></span> <span data-ttu-id="46a84-124">无需从事实数据表中计算或读取数据。</span><span class="sxs-lookup"><span data-stu-id="46a84-124">No calculation or reading of data from the fact table is required.</span></span>  
  
 <span data-ttu-id="46a84-125">虽然对多维数据集中所有可能的聚合进行预先计算可以使所有查询以最短的时间做出响应，但 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 也可以通过其他预先计算好的聚合轻松地计算某些聚合值。</span><span class="sxs-lookup"><span data-stu-id="46a84-125">Although precalculation of all possible aggregations in a cube might provide the fastest possible response time for all queries, [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] can easily calculate some aggregrated values from other precalculated aggregations.</span></span> <span data-ttu-id="46a84-126">另外，计算所有可能的聚合需要大量的处理时间和存储空间。</span><span class="sxs-lookup"><span data-stu-id="46a84-126">Additionally, calculating all possible aggregations requires significant processing time and storage.</span></span> <span data-ttu-id="46a84-127">因此，应该综合考虑存储要求和预先计算的可能聚合百分比两方面因素，采纳一个折中方案。</span><span class="sxs-lookup"><span data-stu-id="46a84-127">Therefore, there is a tradeoff between storage requirements and the percentage of possible aggregations that are precalculated.</span></span> <span data-ttu-id="46a84-128">如果没有预先计算任何聚合（即 0%），则多维数据集所需要的处理时间和存储空间量达到最低，但由于必须从叶单元检索回答每个查询所需的数据，然后在查询时聚合数据以回答每个查询，因而查询响应时间可能会很长。</span><span class="sxs-lookup"><span data-stu-id="46a84-128">If no aggregations are precalculated (0%), the amount of required processing time and storage space for a cube is minimized, but query response time may be slow because the data required to answer each query must be retrieved from the leaf cells and then aggregated at query time to answer each query.</span></span> <span data-ttu-id="46a84-129">例如，为了回答前面提出的问题（“1998 年产品 X 在西北地区的销售额是多少”）而返回单一数值可能需要读取数千行数据，再从每一行提取用于提供“销售额”度量值的列的值，然后再计算总和。</span><span class="sxs-lookup"><span data-stu-id="46a84-129">For example, returning a single number that answers the question asked earlier ("What were the sales of product X in 1998 for the Northwest region") might require reading thousands of rows of data, extracting the value of the column used to provide the Sales measure from each row, and then calculating the sum.</span></span> <span data-ttu-id="46a84-130">此外，检索数据所需的时间取决于为数据-MOLAP、HOLAP 或 ROLAP 选择的存储模式。</span><span class="sxs-lookup"><span data-stu-id="46a84-130">Moreover, the length of time required to retrieve that data will very depending on the storage mode chosen for the data-MOLAP, HOLAP, or ROLAP.</span></span>  
  
## <a name="designing-aggregations"></a><span data-ttu-id="46a84-131">设计聚合</span><span class="sxs-lookup"><span data-stu-id="46a84-131">Designing Aggregations</span></span>  
 [!INCLUDE[msCoName](../../includes/msconame-md.md)] <span data-ttu-id="46a84-132">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 采用了一种复杂算法来选择要进行预先计算的聚合，这样其他聚合就可以很快地通过预先计算好的值计算出来。</span><span class="sxs-lookup"><span data-stu-id="46a84-132">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] incorporates a sophisticated algorithm to select aggregations for precalculation so that other aggregations can be quickly computed from the precalculated values.</span></span> <span data-ttu-id="46a84-133">例如，如果“时间”层次结构中“月份”级别的聚合已经预先计算好，则某个“季度”级别的计算只要求对三个数字进行汇总，就可以根据需要很快地计算出结果。</span><span class="sxs-lookup"><span data-stu-id="46a84-133">For example, if the aggregations are precalculated for the Month level of a Time hierarchy, the calculation for a Quarter level requires only the summarization of three numbers, which can be quickly computed on demand.</span></span> <span data-ttu-id="46a84-134">这种技术可节省处理时间并降低存储要求，同时对查询响应时间的影响也最小。</span><span class="sxs-lookup"><span data-stu-id="46a84-134">This technique saves processing time and reduces storage requirements, with minimal effect on query response time.</span></span>  
  
 <span data-ttu-id="46a84-135">聚合设计向导提供了一些选项，允许在算法中指定存储和百分比约束，从而综合查询响应时间和存储要求两个因素，采纳一个令人满意的折中方案。</span><span class="sxs-lookup"><span data-stu-id="46a84-135">The Aggregation Design Wizard provides options for you to specify storage and percentage constraints on the algorithm to achieve a satisfactory tradeoff between query response time and storage requirements.</span></span> <span data-ttu-id="46a84-136">但是，聚合设计向导的算法假定所有可能的查询具有相同的概率。</span><span class="sxs-lookup"><span data-stu-id="46a84-136">However, the Aggregation Design Wizard's algorithm assumes that all possible queries are equally likely.</span></span> <span data-ttu-id="46a84-137">使用基于使用情况的优化向导，您可以通过分析客户端应用程序所提交的查询来针对度量值组调整聚合设计。</span><span class="sxs-lookup"><span data-stu-id="46a84-137">The Usage-Based Optimization Wizard lets you adjust the aggregation design for a measure group by analyzing the queries that have been submitted by client applications.</span></span> <span data-ttu-id="46a84-138">通过使用向导来优化多维数据集的聚合，可以使频繁出现的查询迅速地做出响应，而不经常出现的查询则可以以稍慢的速度做出响应，这样就不会对多维数据集所需的存储空间造成较大影响。</span><span class="sxs-lookup"><span data-stu-id="46a84-138">By using the wizard to tune a cube's aggregation you can increase responsiveness to frequent queries and decrease responsiveness to infrequent queries without significantly affecting the storage needed for the cube.</span></span>  
  
 <span data-ttu-id="46a84-139">聚合通过使用向导进行设计，但实际上在处理为其设计聚合的分区时才得以计算。</span><span class="sxs-lookup"><span data-stu-id="46a84-139">Aggregations are designed by using the wizards but are not actually calculated until the partition for which the aggregations are designed is processed.</span></span> <span data-ttu-id="46a84-140">创建聚合后，如果多维数据集的结构发生更改，或者多维数据集源表中的数据有所添加或更改，则通常都需要检查多维数据集的聚合，并重新处理该多维数据集。</span><span class="sxs-lookup"><span data-stu-id="46a84-140">After the aggregation has been created, if the structure of a cube ever changes, or if data is added to or changed in a cube's source tables, it is usually necessary to review the cube's aggregations and process the cube again.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="46a84-141">另请参阅</span><span class="sxs-lookup"><span data-stu-id="46a84-141">See Also</span></span>  
 [<span data-ttu-id="46a84-142">分区存储模式和处理</span><span class="sxs-lookup"><span data-stu-id="46a84-142">Partition Storage Modes and Processing</span></span>](partitions-partition-storage-modes-and-processing.md)  
  
  
