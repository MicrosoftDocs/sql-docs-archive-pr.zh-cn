---
title: 为 (PowerPivot for SharePoint 配置使用情况数据收集 |Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
ms.assetid: 955ca6d6-9d5b-47a4-a87c-59bd23f1bf74
author: minewiskan
ms.author: owend
ms.openlocfilehash: 90a071cf8380d1a951fcc413d659a22e7e420853
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87589287"
---
# <a name="configure-usage-data-collection-for-powerpivot-for-sharepoint"></a><span data-ttu-id="acdbc-102">配置使用情况数据收集 (PowerPivot for SharePoint)</span><span class="sxs-lookup"><span data-stu-id="acdbc-102">Configure Usage Data Collection for (PowerPivot for SharePoint</span></span>
  <span data-ttu-id="acdbc-103">使用情况数据收集是场级 SharePoint 功能。</span><span class="sxs-lookup"><span data-stu-id="acdbc-103">Usage data collection is a farm-level SharePoint feature.</span></span> <span data-ttu-id="acdbc-104">PowerPivot for SharePoint 使用并扩展此系统以便在 PowerPivot 管理面板中提供显示 PowerPivot 数据和服务的使用情况的报告。</span><span class="sxs-lookup"><span data-stu-id="acdbc-104">PowerPivot for SharePoint uses and extends this system to provide reports in the PowerPivot Management Dashboard that show how PowerPivot data and services are used.</span></span> <span data-ttu-id="acdbc-105">根据您安装 SharePoint 的方式，可能会为场禁用使用情况数据收集。</span><span class="sxs-lookup"><span data-stu-id="acdbc-105">Depending on how you install SharePoint, usage data collection might be turned off for the farm.</span></span> <span data-ttu-id="acdbc-106">场管理员必须启用使用情况日志记录，才能创建显示在 PowerPivot 管理面板中的使用情况数据。</span><span class="sxs-lookup"><span data-stu-id="acdbc-106">A farm administrator must enable usage logging to create the usage data that appears in the PowerPivot Management Dashboard.</span></span>  
  
 <span data-ttu-id="acdbc-107">有关 PowerPivot 管理面板中使用情况数据的信息，请参阅 [PowerPivot Management Dashboard and Usage Data](power-pivot-management-dashboard-and-usage-data.md)。</span><span class="sxs-lookup"><span data-stu-id="acdbc-107">For information on usage data in the PowerPivot Management Dashboard, see [PowerPivot Management Dashboard and Usage Data](power-pivot-management-dashboard-and-usage-data.md).</span></span>  
  
 <span data-ttu-id="acdbc-108">**本主题内容：**</span><span class="sxs-lookup"><span data-stu-id="acdbc-108">**In this topic:**</span></span>  
  
 [<span data-ttu-id="acdbc-109">启用使用情况数据收集并选择触发数据收集的事件</span><span class="sxs-lookup"><span data-stu-id="acdbc-109">Enable usage data collection and choose events that trigger data collection</span></span>](#events)  
  
 [<span data-ttu-id="acdbc-110">设置日志文件位置</span><span class="sxs-lookup"><span data-stu-id="acdbc-110">Set log file location</span></span>](#configdb)  
  
 [<span data-ttu-id="acdbc-111">配置使用情况数据收集中使用的计时器作业</span><span class="sxs-lookup"><span data-stu-id="acdbc-111">Configure the timer jobs used in usage data collection</span></span>](#jobs)  
  
 [<span data-ttu-id="acdbc-112">限制存储使用情况数据历史记录的时间长度</span><span class="sxs-lookup"><span data-stu-id="acdbc-112">Limit how long usage data history is stored</span></span>](#confighist)  
  
 [<span data-ttu-id="acdbc-113">出于报告目的定义快速、中等和较慢的查询响应类别</span><span class="sxs-lookup"><span data-stu-id="acdbc-113">Define fast, medium and slow query response categories for reporting purposes</span></span>](#qrh)  
  
 [<span data-ttu-id="acdbc-114">指定向使用情况数据收集系统报告查询统计信息的频率</span><span class="sxs-lookup"><span data-stu-id="acdbc-114">Specify how often query statistics are reported to the usage data collection system</span></span>](#ttr)  
  
 [<span data-ttu-id="acdbc-115">打开“PowerPivot 服务应用程序”页以访问配置设置</span><span class="sxs-lookup"><span data-stu-id="acdbc-115">Open the PowerPivot Service Application page to access configuration settings</span></span>](#openconfig)  
  
 [<span data-ttu-id="acdbc-116">PowerPivot 使用情况数据收集的默认配置</span><span class="sxs-lookup"><span data-stu-id="acdbc-116">The default configuration for PowerPivot usage data collection</span></span>](#defaultconfig)  
  
> [!IMPORTANT]  
>  <span data-ttu-id="acdbc-117">使用情况数据帮助您深入了解用户访问数据和资源的方式，但它不保证提供有关服务器操作和用户访问的可靠的永久数据。</span><span class="sxs-lookup"><span data-stu-id="acdbc-117">Usage data provides insight into how users are accessing data and resources, but it does not guarantee reliable, persistent data about server operations and user access.</span></span> <span data-ttu-id="acdbc-118">例如，如果存在服务器重新启动，则事件使用情况数据将丢失，并且将无法恢复。</span><span class="sxs-lookup"><span data-stu-id="acdbc-118">For example, if there is a server restart, event usage data will be lost and will not be recoverable.</span></span> <span data-ttu-id="acdbc-119">同样，如果临时日志文件达到最大大小，则在清除文件前将不会添加任何新数据。</span><span class="sxs-lookup"><span data-stu-id="acdbc-119">Similarly, if the temporary log files reach maximum size, no new data will be added until the files are cleared.</span></span> <span data-ttu-id="acdbc-120">如果您需要审核功能，请考虑使用 SharePoint 提供的工作流和内容类型功能来为您的场构建审核子系统。</span><span class="sxs-lookup"><span data-stu-id="acdbc-120">If you require audit capability, consider using the workflow and content type features that SharePoint provides to build out an auditing subsystem for your farm.</span></span> <span data-ttu-id="acdbc-121">有关详细信息，请查找网站上的产品和社区文档。</span><span class="sxs-lookup"><span data-stu-id="acdbc-121">For more information, look for product and community documentation on the web.</span></span>  
  
##  <a name="enable-usage-data-collection-and-choose-events-that-trigger-data-collection"></a><a name="events"></a><span data-ttu-id="acdbc-122">启用使用情况数据收集并选择触发数据收集的事件</span><span class="sxs-lookup"><span data-stu-id="acdbc-122">Enable usage data collection and choose events that trigger data collection</span></span>  
 <span data-ttu-id="acdbc-123">在 SharePoint 管理中心中配置使用情况数据收集。</span><span class="sxs-lookup"><span data-stu-id="acdbc-123">Configure usage data collection in SharePoint Central Administration.</span></span>  
  
1.  <span data-ttu-id="acdbc-124">在管理中心中，单击 **“监视”**。</span><span class="sxs-lookup"><span data-stu-id="acdbc-124">In Central Administration, click **Monitoring**.</span></span>  
  
2.  <span data-ttu-id="acdbc-125">在 **“报告”** 部分中，单击 **“配置 Usage and Health Data Collection”**。</span><span class="sxs-lookup"><span data-stu-id="acdbc-125">In the **Reporting section**, click **Configure usage and health data collection.**</span></span>  
  
3.  <span data-ttu-id="acdbc-126">选中 **“启用使用率数据集”**。</span><span class="sxs-lookup"><span data-stu-id="acdbc-126">Select the **Enable usage data collection**.</span></span>  
  
4.  <span data-ttu-id="acdbc-127">在 **“要记录的事件”** 部分中，选中或清除有关复选框以启用或禁用以下 Analysis Services 事件：</span><span class="sxs-lookup"><span data-stu-id="acdbc-127">In the **Events to log** section, select or clear the checkboxes to either enable or disable the following Analysis Services events:</span></span>  
  
    |<span data-ttu-id="acdbc-128">事件</span><span class="sxs-lookup"><span data-stu-id="acdbc-128">Event</span></span>|<span data-ttu-id="acdbc-129">说明</span><span class="sxs-lookup"><span data-stu-id="acdbc-129">Description</span></span>|  
    |-----------|-----------------|  
    |<span data-ttu-id="acdbc-130">**PowerPivot 连接**</span><span class="sxs-lookup"><span data-stu-id="acdbc-130">**PowerPivot Connections**</span></span>|<span data-ttu-id="acdbc-131">PowerPivot 连接事件用于监视代表用户进行的 PowerPivot 服务器连接。</span><span class="sxs-lookup"><span data-stu-id="acdbc-131">PowerPivot Connection event is used to monitor PowerPivot server connections that are made on behalf of a user.</span></span>|  
    |<span data-ttu-id="acdbc-132">**PowerPivot 加载数据使用情况**</span><span class="sxs-lookup"><span data-stu-id="acdbc-132">**PowerPivot Load Data Usage**</span></span>|<span data-ttu-id="acdbc-133">PowerPivot 加载数据使用情况用于监视将 PowerPivot 数据加载到服务器内存中的请求。</span><span class="sxs-lookup"><span data-stu-id="acdbc-133">PowerPivot Load Data Usage is used to monitor requests that load PowerPivot data into server memory.</span></span> <span data-ttu-id="acdbc-134">将为从内容数据库或从缓存加载的 PowerPivot 数据文件生成加载事件。</span><span class="sxs-lookup"><span data-stu-id="acdbc-134">A load event is generated for PowerPivot data files loaded from a content database or from cache.</span></span>|  
    |<span data-ttu-id="acdbc-135">**PowerPivot 卸载数据使用情况**</span><span class="sxs-lookup"><span data-stu-id="acdbc-135">**PowerPivot Unload Data Usage**</span></span>|<span data-ttu-id="acdbc-136">PowerPivot 卸载数据使用情况用于监视在一段非活动期后卸载 PowerPivot 数据源的请求。</span><span class="sxs-lookup"><span data-stu-id="acdbc-136">PowerPivot Unload Data Usage is used to monitor requests for unloading a PowerPivot data source after a period of inactivity.</span></span> <span data-ttu-id="acdbc-137">将 PowerPivot 数据源缓存到磁盘将报告为卸载事件。</span><span class="sxs-lookup"><span data-stu-id="acdbc-137">Caching a PowerPivot data source to disk will be reported as an unload event.</span></span>|  
    |<span data-ttu-id="acdbc-138">**PowerPivot 查询使用情况**</span><span class="sxs-lookup"><span data-stu-id="acdbc-138">**PowerPivot Query Usage**</span></span>|<span data-ttu-id="acdbc-139">PowerPivot 查询使用情况用于监视在 [!INCLUDE[ssGeminiSrv](../../includes/ssgeminisrv-md.md)] 实例中加载的数据的查询处理时间。</span><span class="sxs-lookup"><span data-stu-id="acdbc-139">PowerPivot Query Usage is used to monitor query processing times for data that is loaded in an [!INCLUDE[ssGeminiSrv](../../includes/ssgeminisrv-md.md)] instance.</span></span>|  
  
    > [!NOTE]  
    >  <span data-ttu-id="acdbc-140">服务器运行状况和数据刷新操作也生成使用情况数据，但没有与这些进程相关联的事件。</span><span class="sxs-lookup"><span data-stu-id="acdbc-140">Server health and data refresh operations also generate usage data, but there is no event associated with these processes.</span></span>  
  
5.  <span data-ttu-id="acdbc-141">您还可以更新日志文件的位置。</span><span class="sxs-lookup"><span data-stu-id="acdbc-141">You can also update the log file location.</span></span> <span data-ttu-id="acdbc-142">有关详细信息，请参阅下一节。</span><span class="sxs-lookup"><span data-stu-id="acdbc-142">For more information, see the next section.</span></span>  
  
6.  <span data-ttu-id="acdbc-143">\*\*\*\* 单击“确定”以保存你的更改。</span><span class="sxs-lookup"><span data-stu-id="acdbc-143">Click **OK** to save your changes.</span></span>  
  
7.  <span data-ttu-id="acdbc-144">或者，您可以指定是记录所有消息还是只记录错误。</span><span class="sxs-lookup"><span data-stu-id="acdbc-144">Optionally, you can specify whether all messages or just errors are logged.</span></span> <span data-ttu-id="acdbc-145">有关如何限制事件消息的详细信息，请参阅[配置和查看 SharePoint 日志文件和诊断日志记录 &#40;PowerPivot for SharePoint&#41;](configure-and-view-sharepoint-and-diagnostic-logging.md)。</span><span class="sxs-lookup"><span data-stu-id="acdbc-145">For more information on how to throttle event messages, see [Configure and View SharePoint Log Files  and Diagnostic Logging &#40;PowerPivot for SharePoint&#41;](configure-and-view-sharepoint-and-diagnostic-logging.md).</span></span>  
  
##  <a name="set-log-file-location"></a><a name="configdb"></a><span data-ttu-id="acdbc-146">设置日志文件位置</span><span class="sxs-lookup"><span data-stu-id="acdbc-146">Set log file location</span></span>  
 <span data-ttu-id="acdbc-147">PowerPivot 使用情况数据最初存储于本地服务器上的使用情况日志文件中，然后定期移到 PowerPivot 服务应用程序数据库。</span><span class="sxs-lookup"><span data-stu-id="acdbc-147">PowerPivot usage data is initially stored in usage log files on the local server, and then moved at regular intervals to the PowerPivot service application databases.</span></span> <span data-ttu-id="acdbc-148">在管理中心中设置日志文件的位置。</span><span class="sxs-lookup"><span data-stu-id="acdbc-148">The log file location is set in Central Administration.</span></span> <span data-ttu-id="acdbc-149">默认位置为：</span><span class="sxs-lookup"><span data-stu-id="acdbc-149">The default location is:</span></span>  
  
 `C:\Program Files\Common Files\Microsoft Shared\Web Server Extensions\15\logs`  
  
 <span data-ttu-id="acdbc-150">若要查看或更改这些属性，请使用 **“Usage and Health Data Collection”** 页。</span><span class="sxs-lookup"><span data-stu-id="acdbc-150">To view or change these properties, use the **Usage and health data collection** page.</span></span>  
  
1.  <span data-ttu-id="acdbc-151">在管理中心的主页上，单击 **“监视”**。</span><span class="sxs-lookup"><span data-stu-id="acdbc-151">On the Home page in Central Administration, click **Monitoring**.</span></span>  
  
2.  <span data-ttu-id="acdbc-152">在“监视”部分中，单击 **“配置 Usage and Health Data Collection”**。</span><span class="sxs-lookup"><span data-stu-id="acdbc-152">In the Monitoring section, click **Configure usage and health data collection.**</span></span>  
  
3.  <span data-ttu-id="acdbc-153">在“使用率数据集设置”中，查看或修改文件位置、名称或最大文件大小。</span><span class="sxs-lookup"><span data-stu-id="acdbc-153">In Usage Data Collection Settings, view or modify the file location, name, or maximum file size.</span></span> <span data-ttu-id="acdbc-154">如果您指定的最大文件大小过小，则该文件大小将很快达到最大值限制，并且在其内容移到中心使用情况数据收集数据库之前，不会有新条目添加到该文件。</span><span class="sxs-lookup"><span data-stu-id="acdbc-154">If you specify a file size that is too low, the file size will reach the maximum limit and no new entries will be added to it until its contents are moved to the central usage data collection database.</span></span>  
  
##  <a name="configure-the-timer-jobs-used-in-usage-data-collection"></a><a name="jobs"></a><span data-ttu-id="acdbc-155">配置使用情况数据收集中使用的计时器作业</span><span class="sxs-lookup"><span data-stu-id="acdbc-155">Configure the timer jobs used in usage data collection</span></span>  
 <span data-ttu-id="acdbc-156">PowerPivot 服务器运行状况和使用情况数据通过两个计时器作业移到使用情况数据收集系统中的不同位置。</span><span class="sxs-lookup"><span data-stu-id="acdbc-156">PowerPivot server health and usage data is moved to different locations in the usage data collection system through two timer jobs.:</span></span>  
  
-   <span data-ttu-id="acdbc-157">"Microsoft SharePoint Foundation 使用率数据导入" 计时器作业将 PowerPivot 使用情况移动到 PowerPivot 服务应用程序数据库。</span><span class="sxs-lookup"><span data-stu-id="acdbc-157">The "Microsoft SharePoint Foundation Usage Data Import" timer job moves PowerPivot usage to the PowerPivot service application database.</span></span>  
  
-   <span data-ttu-id="acdbc-158">"PowerPivot 管理面板处理计时器作业" 将数据到 PowerPivot 工作簿，该工作簿是内置管理报表的数据源。</span><span class="sxs-lookup"><span data-stu-id="acdbc-158">The "PowerPivot Management Dashboard Processing timer job" the data to PowerPivot workbook that is the source of data for built-in administrative reports.</span></span>  
  
 <span data-ttu-id="acdbc-159">如果您需要更频繁地刷新出现在 PowerPivot 管理面板中的管理报告，则按照以下步骤执行。</span><span class="sxs-lookup"><span data-stu-id="acdbc-159">If you need to refresh the administrative reports that appear in the PowerPivot Management Dashboard more frequently, follow these steps.</span></span>  
  
1.  <span data-ttu-id="acdbc-160">在管理中心中，单击 **“监视”**。</span><span class="sxs-lookup"><span data-stu-id="acdbc-160">In Central Administration, click **Monitoring**.</span></span>  
  
2.  <span data-ttu-id="acdbc-161">单击 "**查看作业定义"。**</span><span class="sxs-lookup"><span data-stu-id="acdbc-161">Click **Review job definitions.**</span></span> <span data-ttu-id="acdbc-162">在“计时器作业”\*\*\*\* 部分中：</span><span class="sxs-lookup"><span data-stu-id="acdbc-162">In the **Timer jobs** section.</span></span>  
  
3.  <span data-ttu-id="acdbc-163">单击 **“Microsoft SharePoint Foundation 使用情况数据导入”**。</span><span class="sxs-lookup"><span data-stu-id="acdbc-163">Click **Microsoft SharePoint Foundation Usage Data Import**.</span></span>  
  
4.  <span data-ttu-id="acdbc-164">单击 "**立即运行**"。</span><span class="sxs-lookup"><span data-stu-id="acdbc-164">Click **Run Now**.</span></span> <span data-ttu-id="acdbc-165">如果禁用 **“立即运行”** 按钮，请依次单击 **“启用”** 和 **“立即运行”**。</span><span class="sxs-lookup"><span data-stu-id="acdbc-165">If the **Run Now** button is disabled, click **Enable** and then click **Run Now**.</span></span>  
  
5.  <span data-ttu-id="acdbc-166">在“作业定义”列表中，单击 **“PowerPivot 数据管理面板处理计时器作业”**。</span><span class="sxs-lookup"><span data-stu-id="acdbc-166">In the Job Definitions list, click **PowerPivot Data Management Dashboard Processing Timer Job**.</span></span>  
  
6.  <span data-ttu-id="acdbc-167">单击 "**立即运行**"。</span><span class="sxs-lookup"><span data-stu-id="acdbc-167">Click **Run Now**.</span></span>  
  
7.  <span data-ttu-id="acdbc-168">检查报告以查看刷新数据。</span><span class="sxs-lookup"><span data-stu-id="acdbc-168">Check the reports to view the refresh data.</span></span> <span data-ttu-id="acdbc-169">有关详细信息，请参阅 [PowerPivot Management Dashboard and Usage Data](power-pivot-management-dashboard-and-usage-data.md)。</span><span class="sxs-lookup"><span data-stu-id="acdbc-169">For more information, see [PowerPivot Management Dashboard and Usage Data](power-pivot-management-dashboard-and-usage-data.md).</span></span>  
  
##  <a name="limit-how-long-usage-data-history-is-stored"></a><a name="confighist"></a><span data-ttu-id="acdbc-170">限制存储使用情况数据历史记录的时间长度</span><span class="sxs-lookup"><span data-stu-id="acdbc-170">Limit how long usage data history is stored</span></span>  
 <span data-ttu-id="acdbc-171">为事件（连接、加载、卸载和按需查询处理）和数据刷新（计划的数据处理）存储使用情况数据历史记录。</span><span class="sxs-lookup"><span data-stu-id="acdbc-171">Usage data history is stored for events (connections, load, unload, and on-demand query processing) and data refresh (scheduled data processing).</span></span> <span data-ttu-id="acdbc-172">尽管使用情况数据是通过 SharePoint 使用情况数据收集系统收集的，但报告的数据将移到 PowerPivot 应用程序数据库和报表数据库以便更长期地存储。</span><span class="sxs-lookup"><span data-stu-id="acdbc-172">Although usage data is collected through the SharePoint usage data collection system, the reporting data is moved to a PowerPivot application database and a reporting database for longer term storage.</span></span> <span data-ttu-id="acdbc-173">使用情况数据历史设置控制使用情况数据在 PowerPivot 应用程序数据库中应保留多长的时间。</span><span class="sxs-lookup"><span data-stu-id="acdbc-173">The usage data history setting controls how long usage data is retained in the PowerPivot application databases.</span></span> <span data-ttu-id="acdbc-174">相同的限制同样适用于同一 PowerPivot 服务应用程序数据库中存储的所有类型的使用情况数据。</span><span class="sxs-lookup"><span data-stu-id="acdbc-174">The same limit is applied equally to all types of stored usage data in the same PowerPivot service application database.</span></span>  
  
1.  <span data-ttu-id="acdbc-175">[打开“PowerPivot 服务应用程序”页](#openconfig)。</span><span class="sxs-lookup"><span data-stu-id="acdbc-175">[Open the PowerPivot Service Application Page](#openconfig).</span></span>  
  
2.  <span data-ttu-id="acdbc-176">在 **“使用情况数据收集”** 部分的 **“使用情况数据历史记录”** 中，输入您希望为每个工作簿保留数据刷新活动记录的天数。</span><span class="sxs-lookup"><span data-stu-id="acdbc-176">In the **Usage Data Collection** section, in **Usage Data History**, enter the number of days for which you want to keep a record of data refresh activity for each workbook.</span></span>  
  
    -   <span data-ttu-id="acdbc-177">默认值为 365 天。</span><span class="sxs-lookup"><span data-stu-id="acdbc-177">The default is 365 days.</span></span>  
  
    -   <span data-ttu-id="acdbc-178">0 指定不受限制的存储，使用情况数据将无限期地保留。</span><span class="sxs-lookup"><span data-stu-id="acdbc-178">0 specifies unlimited storage where usage data is kept indefinitely.</span></span>  
  
    -   <span data-ttu-id="acdbc-179">或者，也可以指定一个介于 1 和 5000 之间的范围。</span><span class="sxs-lookup"><span data-stu-id="acdbc-179">Alternatively, you can also specify a range between 1 and 5000.</span></span>  
  
     <span data-ttu-id="acdbc-180">将保留期减小到较少的天数将删除超过这个新限制的任何数据。</span><span class="sxs-lookup"><span data-stu-id="acdbc-180">Decreasing the retention period to a smaller number of days will delete any data that exceeds the new limit.</span></span> <span data-ttu-id="acdbc-181">例如，将该值从 365 更改为 30 将导致删除超过 30 天前发生的所有历史记录信息的使用情况数据。</span><span class="sxs-lookup"><span data-stu-id="acdbc-181">For example, changing the value from 365 to 30 will result in usage data deletion for all historical information that occurred more than 30 days ago.</span></span> <span data-ttu-id="acdbc-182">仅保留最近 30 天内的数据。</span><span class="sxs-lookup"><span data-stu-id="acdbc-182">Only data from the last 30 days is retained.</span></span>  
  
     <span data-ttu-id="acdbc-183">数据实际在发生下一个事件时被数据。</span><span class="sxs-lookup"><span data-stu-id="acdbc-183">Data is actually deleted when the next event occurs.</span></span> <span data-ttu-id="acdbc-184">仅当系统处理某一事件时，才检查对使用情况数据历史记录的限制。</span><span class="sxs-lookup"><span data-stu-id="acdbc-184">The limit on usage data history is checked only when the system processes an event.</span></span>  
  
3.  <span data-ttu-id="acdbc-185">单击“确定”。</span><span class="sxs-lookup"><span data-stu-id="acdbc-185">Click **OK**.</span></span>  
  
 <span data-ttu-id="acdbc-186">有关如何收集和存储使用情况数据的详细信息，请参阅[PowerPivot 使用情况数据收集](power-pivot-usage-data-collection.md)。</span><span class="sxs-lookup"><span data-stu-id="acdbc-186">For more information about how usage data is collected and stored, see [PowerPivot Usage Data Collection](power-pivot-usage-data-collection.md).</span></span>  
  
##  <a name="define-fast-medium-and-slow-query-response-categories-for-reporting-purposes"></a><a name="qrh"></a><span data-ttu-id="acdbc-187">出于报告目的定义快速、中等和慢的查询响应类别</span><span class="sxs-lookup"><span data-stu-id="acdbc-187">Define fast, medium and slow query response categories for reporting purposes</span></span>  
 <span data-ttu-id="acdbc-188">查询处理性能根据预定义的类别进行测量，这些预定义的类别按完成所用的时间长度定义请求-响应周期。</span><span class="sxs-lookup"><span data-stu-id="acdbc-188">Query processing performance is measured against predefined categories that define a request-response cycle by how long it takes to complete.</span></span> <span data-ttu-id="acdbc-189">预定义的类别包括：一般、快速、预期、长时间运行和超出。</span><span class="sxs-lookup"><span data-stu-id="acdbc-189">Predefined categories include: Trivial, Quick, Expected, Long-running, and Exceeded.</span></span> <span data-ttu-id="acdbc-190">对 PowerPivot 服务器的每个请求都将基于完成时间属于上述类别之一。</span><span class="sxs-lookup"><span data-stu-id="acdbc-190">Every request to a PowerPivot server will fall into one of the categories based on time to completion.</span></span>  
  
 <span data-ttu-id="acdbc-191">查询响应信息用于活动报告中。</span><span class="sxs-lookup"><span data-stu-id="acdbc-191">Query response information is used in activity reports.</span></span> <span data-ttu-id="acdbc-192">在这些报告内，为了更好地揭示 PowerPivot 系统的性能趋势，每种类别的用法各不相同。</span><span class="sxs-lookup"><span data-stu-id="acdbc-192">Within the reports, each category is used differently to better reveal the performance trends of the PowerPivot system.</span></span> <span data-ttu-id="acdbc-193">例如，一般请求将被完全排除，因为这样做可以消除数据中的干扰并且使用其余类别显示更有意义的趋势。</span><span class="sxs-lookup"><span data-stu-id="acdbc-193">For example, trivial requests are excluded completely because doing so removes noise in the data and shows more meaningful trends using the remaining categories.</span></span> <span data-ttu-id="acdbc-194">相反，长时间运行或超出的请求统计信息是报告中的重点，以便管理员或工作簿所有者可以立即采取纠正措施。</span><span class="sxs-lookup"><span data-stu-id="acdbc-194">In contrast, Long-running or Exceeded request statistics are prominent in the report so that administrators or workbook owners can take corrective action immediately.</span></span>  
  
 <span data-ttu-id="acdbc-195">虽然您不能添加或删除类别，但可以定义上限和下限，以确定一个类别从哪里结束、另一个类别从哪里开始。</span><span class="sxs-lookup"><span data-stu-id="acdbc-195">Although you cannot add or delete categories, you can define the upper and lower limits that determine where one category stops and the next one begins.</span></span> <span data-ttu-id="acdbc-196">如果您的组织使用服务级别协议 (SLA) 定义服务器可用性和性能的可接受级别，则您可以优化这些类别以反映您创建的 SLA。</span><span class="sxs-lookup"><span data-stu-id="acdbc-196">If your organization uses Service Level Agreements (SLA) to define acceptable levels of server availability and performance, you can tune these categories to reflect the SLA you create.</span></span>  
  
1.  <span data-ttu-id="acdbc-197">[打开“PowerPivot 服务应用程序”页](#openconfig)。</span><span class="sxs-lookup"><span data-stu-id="acdbc-197">[Open the PowerPivot Service Application Page](#openconfig).</span></span>  
  
2.  <span data-ttu-id="acdbc-198">在“使用情况数据收集”\*\*\*\* 部分的“一般响应上限”\*\*\*\* 中，输入设置完成一般响应的上限的值（毫秒）。</span><span class="sxs-lookup"><span data-stu-id="acdbc-198">In the **Usage Data Collection** section, in **Trivial Response upper limit** , enter a value (in milliseconds) that sets the upper boundary for completing a trivial response.</span></span> <span data-ttu-id="acdbc-199">属于此类别的请求通常包括服务器 ping、会话初始化和元数据查询。</span><span class="sxs-lookup"><span data-stu-id="acdbc-199">Requests that fall into this category typically include server pings, session initiation, and metadata query.</span></span> <span data-ttu-id="acdbc-200">默认值为 500 毫秒（或半秒钟）。</span><span class="sxs-lookup"><span data-stu-id="acdbc-200">The default is 500 milliseconds (or half a second).</span></span>  
  
3.  <span data-ttu-id="acdbc-201">在“快速请求上限”中，输入设置完成快速响应的上限的值（毫秒）。</span><span class="sxs-lookup"><span data-stu-id="acdbc-201">In Quick Requests Upper Limit, enter a value (in milliseconds) that sets the upper boundary for completing a quick response.</span></span> <span data-ttu-id="acdbc-202">属于此类别的请求包含对非常小的数据集或大型数据集的元数据服务器的查询。</span><span class="sxs-lookup"><span data-stu-id="acdbc-202">Requests that fall into this category include queries of very small datasets or metadata servers of large datasets.</span></span> <span data-ttu-id="acdbc-203">默认值为 1000 毫秒（或 1 秒钟）。</span><span class="sxs-lookup"><span data-stu-id="acdbc-203">The default is 1000 milliseconds (or 1 second).</span></span>  
  
4.  <span data-ttu-id="acdbc-204">在“预期响应上限”\*\*\*\* 中，输入设置在预期或平均时间范围内完成某一响应的上限的值（毫秒）。</span><span class="sxs-lookup"><span data-stu-id="acdbc-204">In **Expected Response Upper Limit**, enter a value (in milliseconds) that sets the upper boundary for completing a response in an expected or average time frame.</span></span> <span data-ttu-id="acdbc-205">属于此类别的请求包括将数据加载到查看器中。</span><span class="sxs-lookup"><span data-stu-id="acdbc-205">Requests that fall into this category include loading data into a viewer.</span></span> <span data-ttu-id="acdbc-206">默认值为 3000 毫秒（或 3 秒钟）。</span><span class="sxs-lookup"><span data-stu-id="acdbc-206">The default is 3000 milliseconds (or 3 seconds).</span></span>  
  
5.  <span data-ttu-id="acdbc-207">在“长时间响应上限”\*\*\*\* 中，输入设置完成长时间运行响应的上限的值（毫秒）。</span><span class="sxs-lookup"><span data-stu-id="acdbc-207">In **Long Response Upper Limit**, enter a value (in milliseconds) that sets the upper boundary for completing long running response.</span></span> <span data-ttu-id="acdbc-208">属于此类别的请求的运行时间比预期时间要长，但仍在可接受的范围内。</span><span class="sxs-lookup"><span data-stu-id="acdbc-208">Requests that fall into this category run longer than expected, but within range that is still acceptable.</span></span> <span data-ttu-id="acdbc-209">默认值为 10000 毫秒（或 10 秒钟）。</span><span class="sxs-lookup"><span data-stu-id="acdbc-209">The default is 10000 milliseconds (or 10 seconds).</span></span>  
  
     <span data-ttu-id="acdbc-210">超出此限制的任何请求输入“超出” \*\* 类别。</span><span class="sxs-lookup"><span data-stu-id="acdbc-210">Any requests that exceed this limit are categorized as *Exceeded*.</span></span> <span data-ttu-id="acdbc-211">对于“超出” \*\* 类别，没有可配置的阈值。</span><span class="sxs-lookup"><span data-stu-id="acdbc-211">There is no configurable threshold for *Exceeded*.</span></span> <span data-ttu-id="acdbc-212">根据您在“长请求上限”中指定的上限推断出该值。</span><span class="sxs-lookup"><span data-stu-id="acdbc-212">It is inferred from the upper limit you specify on Long Requests Upper Limit.</span></span> <span data-ttu-id="acdbc-213">属于“超出”类别的请求的运行时间长于您定义的 SLA 所允许的时间。</span><span class="sxs-lookup"><span data-stu-id="acdbc-213">Requests that fall into the Exceeded category run longer than is allowed by an SLA you have defined.</span></span>  
  
6.  <span data-ttu-id="acdbc-214">单击“确定”。</span><span class="sxs-lookup"><span data-stu-id="acdbc-214">Click **OK**.</span></span>  
  
##  <a name="specify-how-often-query-statistics-are-reported-to-the-usage-data-collection-system"></a><a name="ttr"></a><span data-ttu-id="acdbc-215">指定向使用情况数据收集系统报告查询统计信息的频率</span><span class="sxs-lookup"><span data-stu-id="acdbc-215">Specify how often query statistics are reported to the usage data collection system</span></span>  
 <span data-ttu-id="acdbc-216">生成报告的时间间隔指定向使用情况数据收集系统报告查询统计信息的频率。</span><span class="sxs-lookup"><span data-stu-id="acdbc-216">The time-to-report interval specifies how often query statistics are reported to the usage data collection system.</span></span> <span data-ttu-id="acdbc-217">查询统计信息在进程中累积，并且定期作为单个事件报告。</span><span class="sxs-lookup"><span data-stu-id="acdbc-217">Query statistics accumulate in a process and are reported as a single event at regular intervals.</span></span> <span data-ttu-id="acdbc-218">您可以调整该时间间隔以便写入日志文件的间隔更长或更短。</span><span class="sxs-lookup"><span data-stu-id="acdbc-218">You can adjust the interval to write to the log file more or less often.</span></span>  
  
1.  <span data-ttu-id="acdbc-219">[打开“PowerPivot 服务应用程序”页](#openconfig)。</span><span class="sxs-lookup"><span data-stu-id="acdbc-219">[Open the PowerPivot Service Application Page](#openconfig).</span></span>  
  
2.  <span data-ttu-id="acdbc-220">在“使用情况数据收集”\*\*\*\* 部分的“查询报告间隔”\*\*\*\* 中，输入经过多少秒后服务器将所有类别（一般、快速、预期、长时间运行和超出）的查询统计信息作为单个事件报告给使用情况数据收集系统。</span><span class="sxs-lookup"><span data-stu-id="acdbc-220">In the **Usage Data Collection** section, in **Query Reporting Interval**, enter the number of seconds after which the server will report the query statistics for all categories (trivial, quick, expected, long running, and exceed) as a single event to the usage data collection system.</span></span>  
  
    -   <span data-ttu-id="acdbc-221">该范围是 1 到任意正整数。</span><span class="sxs-lookup"><span data-stu-id="acdbc-221">The range is 1 to any positive integer.</span></span>  
  
    -   <span data-ttu-id="acdbc-222">默认值为 300 秒（或 5 分钟）。</span><span class="sxs-lookup"><span data-stu-id="acdbc-222">The default is 300 seconds (or 5 minutes).</span></span> <span data-ttu-id="acdbc-223">对于运行多种应用程序和服务的动态场环境推荐此值。</span><span class="sxs-lookup"><span data-stu-id="acdbc-223">This value is recommended for dynamic farm environments that run a variety of applications and services.</span></span>  
  
     <span data-ttu-id="acdbc-224">如果您将该值提高得过多，则在报告之前可能会丢失统计信息。</span><span class="sxs-lookup"><span data-stu-id="acdbc-224">If you raise this value to a much larger number, you might lose statistical data before it can be reported.</span></span> <span data-ttu-id="acdbc-225">例如，服务重新启动将导致查询统计信息丢失。</span><span class="sxs-lookup"><span data-stu-id="acdbc-225">For example, a service restart will cause query statistics to be lost.</span></span> <span data-ttu-id="acdbc-226">相反，如果内置活动报告中显示数据不足，请考虑减少该时间间隔以便更频繁地获取生成报告事件。</span><span class="sxs-lookup"><span data-stu-id="acdbc-226">Conversely, if your built-in activity reports show insufficient data, consider decreasing the interval to get time-to-report events more frequently.</span></span>  
  
3.  <span data-ttu-id="acdbc-227">单击“确定”。</span><span class="sxs-lookup"><span data-stu-id="acdbc-227">Click **OK**.</span></span>  
  
##  <a name="open-the-powerpivot-service-application-page-to-access-configuration-settings"></a><a name="openconfig"></a><span data-ttu-id="acdbc-228">打开 "PowerPivot 服务应用程序" 页以访问配置设置</span><span class="sxs-lookup"><span data-stu-id="acdbc-228">Open the PowerPivot Service Application page to access configuration settings</span></span>  
 <span data-ttu-id="acdbc-229">您必须是场管理员或服务管理员才能修改服务应用程序设置。</span><span class="sxs-lookup"><span data-stu-id="acdbc-229">You must be a farm or service administrator to modify service application settings.</span></span> <span data-ttu-id="acdbc-230">如果您在场中定义了多个 PowerPivot 服务应用程序，则必须单独修改每个应用程序。</span><span class="sxs-lookup"><span data-stu-id="acdbc-230">If you defined multiple PowerPivot service applications in the farm, you must modify each one individually.</span></span>  
  
1.  <span data-ttu-id="acdbc-231">在 SharePoint 管理中心内，在 **“应用程序管理”** 中单击 **“管理服务应用程序”**。</span><span class="sxs-lookup"><span data-stu-id="acdbc-231">In SharePoint Central Administration, in **Application Management**, click **Manage service applications**.</span></span>  
  
2.  <span data-ttu-id="acdbc-232">找到 PowerPivot 服务应用程序。</span><span class="sxs-lookup"><span data-stu-id="acdbc-232">Find the PowerPivot Service application.</span></span> <span data-ttu-id="acdbc-233">您可以通过类型来确定服务应用程序。</span><span class="sxs-lookup"><span data-stu-id="acdbc-233">You can identify a service application by its type.</span></span> <span data-ttu-id="acdbc-234">PowerPivot 服务应用程序的类型为 **“PowerPivot 服务应用程序”**。</span><span class="sxs-lookup"><span data-stu-id="acdbc-234">A PowerPivot service application type is **PowerPivot Service Application**.</span></span>  
  
3.  <span data-ttu-id="acdbc-235">单击 PowerPivot 服务应用程序名称。</span><span class="sxs-lookup"><span data-stu-id="acdbc-235">Click the PowerPivot service application name.</span></span> <span data-ttu-id="acdbc-236">将打开 PowerPivot 管理面板。</span><span class="sxs-lookup"><span data-stu-id="acdbc-236">The PowerPivot Management Dashboard opens.</span></span>  
  
4.  <span data-ttu-id="acdbc-237">在 **“操作”** 中，单击 **“配置服务应用程序设置”**。</span><span class="sxs-lookup"><span data-stu-id="acdbc-237">In **Actions**, click **Configure service application settings**.</span></span> <span data-ttu-id="acdbc-238">将打开“PowerPivot 服务应用程序设置”页。</span><span class="sxs-lookup"><span data-stu-id="acdbc-238">The PowerPivot Service Application Settings page will open.</span></span>  
  
##  <a name="the-default-configuration-for-powerpivot-usage-data-collection"></a><a name="defaultconfig"></a><span data-ttu-id="acdbc-239">PowerPivot 使用情况数据收集的默认配置</span><span class="sxs-lookup"><span data-stu-id="acdbc-239">The default configuration for PowerPivot usage data collection</span></span>  
 <span data-ttu-id="acdbc-240">可以使用默认设置启用针对 PowerPivot 服务操作的使用情况数据收集，以使其立即可用于支持 Analysis Services 集成功能的应用程序。</span><span class="sxs-lookup"><span data-stu-id="acdbc-240">Usage data collection for PowerPivot service operations can be enabled with default settings to make it immediately available in applications that support the Analysis Services integration feature.</span></span> <span data-ttu-id="acdbc-241">默认设置包括触发使用情况数据收集的事件、对存储多长时间的使用情况数据的限制以及用于对查询响应时间进行分类的阈值。</span><span class="sxs-lookup"><span data-stu-id="acdbc-241">The default settings include events that trigger usage data collection, limits on how long usage data is stored, and thresholds for categorizing query response times.</span></span>  
  
 <span data-ttu-id="acdbc-242">下表显示了使用情况数据收集配置的默认值。</span><span class="sxs-lookup"><span data-stu-id="acdbc-242">The following table shows the default values for usage data collection configuration.</span></span>  
  
|<span data-ttu-id="acdbc-243">设置</span><span class="sxs-lookup"><span data-stu-id="acdbc-243">Setting</span></span>|<span data-ttu-id="acdbc-244">默认值</span><span class="sxs-lookup"><span data-stu-id="acdbc-244">Default Value</span></span>|<span data-ttu-id="acdbc-245">类型</span><span class="sxs-lookup"><span data-stu-id="acdbc-245">Type</span></span>|<span data-ttu-id="acdbc-246">有效范围</span><span class="sxs-lookup"><span data-stu-id="acdbc-246">Valid range</span></span>|  
|-------------|-------------------|----------|-----------------|  
|<span data-ttu-id="acdbc-247">**Analysis Services 使用事件** （连接、加载、卸载、请求）</span><span class="sxs-lookup"><span data-stu-id="acdbc-247">**Analysis Services usage events** (Connection, Load, Unload, Requests)</span></span>|\<enabled>|<span data-ttu-id="acdbc-248">Boolean</span><span class="sxs-lookup"><span data-stu-id="acdbc-248">Boolean</span></span>|<span data-ttu-id="acdbc-249">这些值可以启用或禁用。</span><span class="sxs-lookup"><span data-stu-id="acdbc-249">These values are either enabled or disabled.</span></span>|  
|<span data-ttu-id="acdbc-250">**查询报告间隔**</span><span class="sxs-lookup"><span data-stu-id="acdbc-250">**Query Reporting interval**</span></span>|<span data-ttu-id="acdbc-251">300（以秒为单位）</span><span class="sxs-lookup"><span data-stu-id="acdbc-251">300 (in seconds)</span></span>|<span data-ttu-id="acdbc-252">Integer</span><span class="sxs-lookup"><span data-stu-id="acdbc-252">Integer</span></span>|<span data-ttu-id="acdbc-253">1 到任意正整数。</span><span class="sxs-lookup"><span data-stu-id="acdbc-253">1 to any positive integer.</span></span> <span data-ttu-id="acdbc-254">默认为 5 分钟。</span><span class="sxs-lookup"><span data-stu-id="acdbc-254">The default is 5 minutes.</span></span>|  
|<span data-ttu-id="acdbc-255">**“使用情况数据历史记录”**</span><span class="sxs-lookup"><span data-stu-id="acdbc-255">**Usage data history**</span></span>|<span data-ttu-id="acdbc-256">365（以天为单位）</span><span class="sxs-lookup"><span data-stu-id="acdbc-256">365 (in days)</span></span>|<span data-ttu-id="acdbc-257">Integer</span><span class="sxs-lookup"><span data-stu-id="acdbc-257">Integer</span></span>|<span data-ttu-id="acdbc-258">0 指定无限制，但您也可以设置使历史数据过期并将自动删除它的上限。</span><span class="sxs-lookup"><span data-stu-id="acdbc-258">0 specifies unlimited, but you can also set an upper limit to expire historical data and have it deleted automatically.</span></span> <span data-ttu-id="acdbc-259">有限保留期的有效值为 1 到 5000（单位为天）。</span><span class="sxs-lookup"><span data-stu-id="acdbc-259">Valid values for a limited retention period are 1 to 5000 (in days).</span></span>|  
|<span data-ttu-id="acdbc-260">一般响应上限</span><span class="sxs-lookup"><span data-stu-id="acdbc-260">Trivial Response Upper Limit</span></span>|<span data-ttu-id="acdbc-261">500（以毫秒为单位）</span><span class="sxs-lookup"><span data-stu-id="acdbc-261">500 (in milliseconds)</span></span>|<span data-ttu-id="acdbc-262">Integer</span><span class="sxs-lookup"><span data-stu-id="acdbc-262">Integer</span></span>|<span data-ttu-id="acdbc-263">设置定义一般请求-响应交换的上限。</span><span class="sxs-lookup"><span data-stu-id="acdbc-263">Sets an upper boundary that defines a trivial request-response exchange.</span></span> <span data-ttu-id="acdbc-264">在 0 到 500 毫秒之间完成的任何请求都是一般请求，并且出于报告目的将被忽略。</span><span class="sxs-lookup"><span data-stu-id="acdbc-264">Any request that completes between 0 to 500 milliseconds is a trivial request, and ignored for reporting purposes.</span></span>|  
|<span data-ttu-id="acdbc-265">快速响应上限</span><span class="sxs-lookup"><span data-stu-id="acdbc-265">Quick Response Upper Limit</span></span>|<span data-ttu-id="acdbc-266">1000（以毫秒为单位）</span><span class="sxs-lookup"><span data-stu-id="acdbc-266">1000 (in milliseconds)</span></span>|<span data-ttu-id="acdbc-267">Integer</span><span class="sxs-lookup"><span data-stu-id="acdbc-267">Integer</span></span>|<span data-ttu-id="acdbc-268">设置定义快速请求-响应交换的上限。</span><span class="sxs-lookup"><span data-stu-id="acdbc-268">Sets an upper boundary that defines a quick request-response exchange.</span></span>|  
|<span data-ttu-id="acdbc-269">“预期响应上限”</span><span class="sxs-lookup"><span data-stu-id="acdbc-269">Expected Response Upper Limit</span></span>|<span data-ttu-id="acdbc-270">3000（以毫秒为单位）</span><span class="sxs-lookup"><span data-stu-id="acdbc-270">3000 (in milliseconds)</span></span>|<span data-ttu-id="acdbc-271">Integer</span><span class="sxs-lookup"><span data-stu-id="acdbc-271">Integer</span></span>|<span data-ttu-id="acdbc-272">设置定义预期请求-响应交换的上限。</span><span class="sxs-lookup"><span data-stu-id="acdbc-272">Sets an upper boundary that defines an expected request-response exchange.</span></span>|  
|<span data-ttu-id="acdbc-273">长时间运行响应上限</span><span class="sxs-lookup"><span data-stu-id="acdbc-273">Long Running Response Upper Limit</span></span>|<span data-ttu-id="acdbc-274">10000（以毫秒为单位）</span><span class="sxs-lookup"><span data-stu-id="acdbc-274">10000 (in milliseconds)</span></span>|<span data-ttu-id="acdbc-275">Integer</span><span class="sxs-lookup"><span data-stu-id="acdbc-275">Integer</span></span>|<span data-ttu-id="acdbc-276">设置定义长时间运行的请求-响应交换的上限。</span><span class="sxs-lookup"><span data-stu-id="acdbc-276">Sets an upper boundary that defines a long running request-response exchange.</span></span> <span data-ttu-id="acdbc-277">超出此上限的任何请求都属于“超出”类别，因此没有上限。</span><span class="sxs-lookup"><span data-stu-id="acdbc-277">Any requests that exceed this upper limit fall into the Exceeded category, which has no upper threshold.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="acdbc-278">另请参阅</span><span class="sxs-lookup"><span data-stu-id="acdbc-278">See Also</span></span>  
 <span data-ttu-id="acdbc-279">[配置设置引用 &#40;PowerPivot for SharePoint&#41;](configuration-setting-reference-power-pivot-for-sharepoint.md) </span><span class="sxs-lookup"><span data-stu-id="acdbc-279">[Configuration Setting Reference &#40;PowerPivot for SharePoint&#41;](configuration-setting-reference-power-pivot-for-sharepoint.md) </span></span>  
 [<span data-ttu-id="acdbc-280">PowerPivot 使用情况数据收集</span><span class="sxs-lookup"><span data-stu-id="acdbc-280">PowerPivot Usage Data Collection</span></span>](power-pivot-usage-data-collection.md)  
  
  
