---
title: 了解 (SSAS 表格) 的表格模型中的 DAX |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
ms.assetid: b2693985-1bea-4861-a100-cea4761ba809
author: minewiskan
ms.author: owend
ms.openlocfilehash: 4bf7dc2f41a1d42e8b565459c3b094479d937a91
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87589887"
---
# <a name="understanding-dax-in-tabular-models-ssas-tabular"></a><span data-ttu-id="8bf17-102">了解表格模型中的 DAX（SSAS 表格）</span><span class="sxs-lookup"><span data-stu-id="8bf17-102">Understanding DAX in Tabular Models (SSAS Tabular)</span></span>
  <span data-ttu-id="8bf17-103">数据分析表达式 (DAX) 是一种公式语言，用于在针对 Microsoft Excel 工作簿的 [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] 和 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 表格模型项目中创建自定义计算。</span><span class="sxs-lookup"><span data-stu-id="8bf17-103">Data Analysis Expressions (DAX) is the formula language used to create custom calculations in [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] for Microsoft Excel workbooks and [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] tabular model projects.</span></span> <span data-ttu-id="8bf17-104">DAX 公式包括一些函数、运算符和值，用于对表和列中的数据执行高级计算。</span><span class="sxs-lookup"><span data-stu-id="8bf17-104">DAX formulas include functions, operators, and values to perform advanced calculations on data in tables and columns.</span></span>  
  
 <span data-ttu-id="8bf17-105">尽管 DAX 同时适用于 [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] 工作簿和表格模型项目，但本主题主要介绍在 [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)]中创建的表格模型项目。</span><span class="sxs-lookup"><span data-stu-id="8bf17-105">While DAX applies to both [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] workbooks and tabular model projects, this topic applies more to tabular model projects authored in [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)].</span></span> <span data-ttu-id="8bf17-106">阅读本主题之前，您应该对 [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)]中的表格模型和表格模型项目创作环境有充分的了解。</span><span class="sxs-lookup"><span data-stu-id="8bf17-106">Before reading this topic, you should have a good understanding of tabular models and the tabular model project authoring environment in [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)].</span></span>  
  
 <span data-ttu-id="8bf17-107">本主题的内容：</span><span class="sxs-lookup"><span data-stu-id="8bf17-107">Sections in this topic:</span></span>  
  
-   [<span data-ttu-id="8bf17-108">表格模型中的 DAX</span><span class="sxs-lookup"><span data-stu-id="8bf17-108">DAX in Tabular Models</span></span>](#bkmk_DAXintm)  
  
-   [<span data-ttu-id="8bf17-109">计算列、度量值和行筛选器中的 DAX 公式</span><span class="sxs-lookup"><span data-stu-id="8bf17-109">DAX Formulas in Calculated Columns, Measures, and Row Filters</span></span>](#bkmk_DAX)  
  
-   [<span data-ttu-id="8bf17-110">DAX 数据类型</span><span class="sxs-lookup"><span data-stu-id="8bf17-110">DAX Data Types</span></span>](#bkmk_DAX_datatypes)  
  
-   [<span data-ttu-id="8bf17-111">DAX 运算符</span><span class="sxs-lookup"><span data-stu-id="8bf17-111">DAX Operators</span></span>](#bkmk_DAX_opertors)  
  
-   [<span data-ttu-id="8bf17-112">DAX 公式</span><span class="sxs-lookup"><span data-stu-id="8bf17-112">DAX Formulas</span></span>](#bkmk_DAX_Formulas)  
  
-   [<span data-ttu-id="8bf17-113">DAX 函数</span><span class="sxs-lookup"><span data-stu-id="8bf17-113">DAX Functions</span></span>](#bkmk_DAX_functions)  
  
-   [<span data-ttu-id="8bf17-114">DAX 公式中的上下文</span><span class="sxs-lookup"><span data-stu-id="8bf17-114">Context in DAX Formulas</span></span>](#bkmk_context)  
  
-   [<span data-ttu-id="8bf17-115">公式和表格模型</span><span class="sxs-lookup"><span data-stu-id="8bf17-115">Formulas and the Tabular Model</span></span>](#bkmk_RelModel)  
  
-   [<span data-ttu-id="8bf17-116">使用表和列</span><span class="sxs-lookup"><span data-stu-id="8bf17-116">Working with Tables and Columns</span></span>](#bkmk_tables)  
  
-   [<span data-ttu-id="8bf17-117">更新公式的结果（过程）</span><span class="sxs-lookup"><span data-stu-id="8bf17-117">Updating the Results of Formulas (Process)</span></span>](#bkmk_RefreshRecalc)  
  
-   [<span data-ttu-id="8bf17-118">更正公式中的错误</span><span class="sxs-lookup"><span data-stu-id="8bf17-118">Troubleshooting Errors in Formulas</span></span>](#bkmk_troubleshoot)  
  
-   [<span data-ttu-id="8bf17-119">其他资源</span><span class="sxs-lookup"><span data-stu-id="8bf17-119">Additional Resources</span></span>](#bkmk_addional_resources)  
  
##  <a name="dax-in-tabular-models"></a><a name="bkmk_DAXintm"></a><span data-ttu-id="8bf17-120">表格模型中的 DAX</span><span class="sxs-lookup"><span data-stu-id="8bf17-120">DAX in Tabular Models</span></span>  
 <span data-ttu-id="8bf17-121">在 [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] 和表格模型中，就功能而言，DAX 公式通过各自数据集计算值时所采用的方式并无区别。</span><span class="sxs-lookup"><span data-stu-id="8bf17-121">In both [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] and tabular models, functionally, there is no difference in how DAX formulas calculate values from their respective data sets.</span></span> <span data-ttu-id="8bf17-122">但是，DAX 公式在工作簿和模型创作工具中的创建是不同的，而且特定度量值中上下文的计算也是不同的。</span><span class="sxs-lookup"><span data-stu-id="8bf17-122">However, where DAX formulas are created in the workbook and model authoring tools is different, as well as where context in certain measures is evaluated.</span></span>  
  
 <span data-ttu-id="8bf17-123">在 [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)]中，计算公式通常由工作薄用户创建，用于自助式商业智能分析。</span><span class="sxs-lookup"><span data-stu-id="8bf17-123">In [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)], calculation formulas are typically created by the workbook user for self-service business intelligence analysis.</span></span> <span data-ttu-id="8bf17-124">在 PowerPivot 窗口中为表创建计算列，在数据透视表或计算区域中创建度量值。</span><span class="sxs-lookup"><span data-stu-id="8bf17-124">Calculated columns are created for a table in the PowerPivot window, and measures are created in PivotTables or the calculation area.</span></span> <span data-ttu-id="8bf17-125">与表格模型项目不同，PowerPivot 工作簿不提供基于角色的安全性，这种安全性可以使用 DAX 公式来保护数据。</span><span class="sxs-lookup"><span data-stu-id="8bf17-125">Unlike tabular model projects, PowerPivot workbooks do not provide role-based security, which can use DAX formulas to secure data.</span></span>  
  
 <span data-ttu-id="8bf17-126">在表格模型项目中，计算公式由模型作者在 [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)] 的模型设计器中创建。</span><span class="sxs-lookup"><span data-stu-id="8bf17-126">In tabular model projects, calculation formulas are created in the model designer in [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)] by model authors.</span></span> <span data-ttu-id="8bf17-127">尽管使用 DAX 公式计算的计算列值会立即显示在模型设计器的表中（度量值网格中的度量值预览功能除外），但只有用户在 [!INCLUDE[ssCrescent](../../includes/sscrescent-md.md)] 等报告客户端或 Microsoft Excel 的数据透视表中指定筛选器后，系统才会计算度量值。</span><span class="sxs-lookup"><span data-stu-id="8bf17-127">While values for calculated columns, calculated by using DAX formulas, appear immediately in the table in the model designer, with exception to the measure preview feature in the measure grid, measures are not calculated until a user specifies a filter in a reporting client such as [!INCLUDE[ssCrescent](../../includes/sscrescent-md.md)] or in PivotTables in Microsoft Excel.</span></span>  
  
 <span data-ttu-id="8bf17-128">如果使用 PowerPivot 项目模板中的“导入”将 PowerPivot 工作簿导入新的表格模型项目，则将在新的表格模型中自动创建计算列的 DAX 公式。</span><span class="sxs-lookup"><span data-stu-id="8bf17-128">If you import a PowerPivot workbook into a new tabular model project by using the Import from PowerPivot project template, DAX formulas for calculated columns will be automatically created in the new tabular model.</span></span> <span data-ttu-id="8bf17-129">工作簿中的隐式和显式度量值的 DAX 公式将在新的表格模型中自动创建为显式度量值。</span><span class="sxs-lookup"><span data-stu-id="8bf17-129">DAX formulas for implicit and explicit measures in the workbook will be automatically created in the new tabular model as explicit measures.</span></span> <span data-ttu-id="8bf17-130">由于 PowerPivot 工作簿中尚不存在角色和安全行筛选器功能，您将需要在新的表格模型中创建至少一个角色，以便为角色成员提供模型数据访问。</span><span class="sxs-lookup"><span data-stu-id="8bf17-130">Because role and secure row filter functionality do not already exist in PowerPivot workbooks, you will need to create at least one role in the new tabular model to provide model data access to role members.</span></span> <span data-ttu-id="8bf17-131">仅当需要在行一级保护表数据时，才需要行筛选器中的 DAX 公式。</span><span class="sxs-lookup"><span data-stu-id="8bf17-131">DAX formulas in row filters are necessary only if you want to secure table data at the row-level.</span></span>  
  
##  <a name="dax-formulas-in-calculated-columns-measures-and-row-filters"></a><a name="bkmk_DAX"></a><span data-ttu-id="8bf17-132">计算列、度量值和行筛选器中的 DAX 公式</span><span class="sxs-lookup"><span data-stu-id="8bf17-132">DAX Formulas in Calculated Columns, Measures, and Row Filters</span></span>  
 <span data-ttu-id="8bf17-133">对于在 [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)]中创作的表格模型，DAX 公式用在计算列、度量值和行筛选器中。</span><span class="sxs-lookup"><span data-stu-id="8bf17-133">For tabular models authored in [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)], DAX formulas are used in calculated columns, measures, and row filters.</span></span>  
  
### <a name="calculated-columns"></a><span data-ttu-id="8bf17-134">计算列</span><span class="sxs-lookup"><span data-stu-id="8bf17-134">Calculated Columns</span></span>  
 <span data-ttu-id="8bf17-135">计算列是您在模型设计器中向现有表添加的一列，然后您需要创建一个 DAX 公式来定义列值。</span><span class="sxs-lookup"><span data-stu-id="8bf17-135">A calculated column is a column that you add to an existing table (in the model designer) and then create a DAX formula that defines the column values.</span></span> <span data-ttu-id="8bf17-136">您需要在模型设计器中使用公式栏创建用于计算列的公式。</span><span class="sxs-lookup"><span data-stu-id="8bf17-136">You create formulas for calculated columns in the model designer by using the formula bar.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="8bf17-137">使用 DirectQuery 模式从关系数据源检索数据的模型不支持计算列。</span><span class="sxs-lookup"><span data-stu-id="8bf17-137">Calculated columns are not supported for models that retrieve data from a relational data source using DirectQuery mode.</span></span>  
  
 <span data-ttu-id="8bf17-138">当计算列包含有效的 DAX 公式时，一输入公式就会为每行计算值。</span><span class="sxs-lookup"><span data-stu-id="8bf17-138">When a calculated column contains a valid DAX formula, values are calculated for each row as soon as the formula is entered.</span></span> <span data-ttu-id="8bf17-139">值随后存储在数据库中。</span><span class="sxs-lookup"><span data-stu-id="8bf17-139">Values are then stored in the database.</span></span> <span data-ttu-id="8bf17-140">例如，在 Date 表中，在公式栏中输入公式 `=[Calendar Year] & " Q" & [Calendar Quarter]` 时，将通过从 Calendar Year 列（在同一 Date 表中）中取值，添加一个空格和大写字母 Q，然后添加 Calendar Quarter 列（在同一 Date 表中）中的值，为该表中的每行计算值。</span><span class="sxs-lookup"><span data-stu-id="8bf17-140">For example, in a Date table, when the formula `=[Calendar Year] & " Q" & [Calendar Quarter]` is entered into the formula bar, a value for each row in the table is calculated by taking values from the Calendar Year column (in the same Date table), adding a space and the capital letter Q, and then adding the values from the Calendar Quarter column (in the same Date table).</span></span> <span data-ttu-id="8bf17-141">系统将立即计算并显示计算列中每行的结果，例如，显示为 **2010 Q1**。</span><span class="sxs-lookup"><span data-stu-id="8bf17-141">The result for each row in the calculated column is calculated immediately and appears, for example, as **2010 Q1**.</span></span> <span data-ttu-id="8bf17-142">仅当重新处理数据时才会重新计算列值。</span><span class="sxs-lookup"><span data-stu-id="8bf17-142">Column values are only recalculated if the data is re-processed.</span></span>  
  
 <span data-ttu-id="8bf17-143">有关详细信息，请参阅 [计算列（SSAS 表格）](ssas-calculated-columns.md)中创建的表格模型项目。</span><span class="sxs-lookup"><span data-stu-id="8bf17-143">For more information, see [Calculated Columns &#40;SSAS Tabular&#41;](ssas-calculated-columns.md).</span></span>  
  
### <a name="measures"></a><span data-ttu-id="8bf17-144">度量值</span><span class="sxs-lookup"><span data-stu-id="8bf17-144">Measures</span></span>  
 <span data-ttu-id="8bf17-145">度量值是结果随上下文而变化的动态公式。</span><span class="sxs-lookup"><span data-stu-id="8bf17-145">Measures are dynamic formulas where the results change depending on context.</span></span> <span data-ttu-id="8bf17-146">度量值用在支持使用多个属性合并和筛选模型数据的报表格式中，如 [!INCLUDE[ssCrescent](../../includes/sscrescent-md.md)] 报表、Excel 数据透视表或数据透视图。</span><span class="sxs-lookup"><span data-stu-id="8bf17-146">Measures are used in reporting formats that support combining and filtering model data by using multiple attributes such as a [!INCLUDE[ssCrescent](../../includes/sscrescent-md.md)] report or Excel PivotTable or PivotChart.</span></span> <span data-ttu-id="8bf17-147">在表格模型项目中，度量值是模型作者使用 [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)]的表格模型设计器中的度量值网格（和公式栏）定义的。</span><span class="sxs-lookup"><span data-stu-id="8bf17-147">In tabular model projects, measures are defined by the model author by using the measure grid (and formula bar) in the model designer in [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)].</span></span>  
  
 <span data-ttu-id="8bf17-148">度量值中的公式可以使用标准聚合函数（通过使用 COUNT 或 SUM 之类的自动求和功能自动创建），您也可以通过使用 DAX 定义自己的公式。</span><span class="sxs-lookup"><span data-stu-id="8bf17-148">A formula in a measure can use standard aggregation functions automatically created by using the Autosum feature, such as COUNT or SUM, or you can define your own formula by using DAX.</span></span> <span data-ttu-id="8bf17-149">在公式栏中为某一度量值定义公式时，工具提示功能会显示当前上下文中的总结果预览，但除此之外，在任何位置都不会立即输出结果。</span><span class="sxs-lookup"><span data-stu-id="8bf17-149">When you define a formula for a measure in the formula bar, a Tooltip feature shows a preview of what the results would be for the total in the current context, but otherwise the results are not immediately output anywhere.</span></span> <span data-ttu-id="8bf17-150">其他度量值详细信息也会显示在 **“属性”** 窗格中。</span><span class="sxs-lookup"><span data-stu-id="8bf17-150">Other measure details also appear in the **Properties** pane.</span></span>  
  
 <span data-ttu-id="8bf17-151">您不能立即看到计算的（筛选）结果的原因是，在没有上下文的情况下无法确定度量值的结果。</span><span class="sxs-lookup"><span data-stu-id="8bf17-151">The reason you cannot see the (filtered) results of the calculation immediately is because the result of a measure cannot be determined without context.</span></span> <span data-ttu-id="8bf17-152">若要计算度量值，需要一个可以提供上下文的报表客户端应用程序，在检索与每个单元相关的数据然后针对每个单元计算表达式时需要该应用程序提供的上下文。</span><span class="sxs-lookup"><span data-stu-id="8bf17-152">To evaluate a measure requires a reporting client application that can provide the context needed to retrieve the data relevant to each cell and then evaluate the expression for each cell.</span></span> <span data-ttu-id="8bf17-153">该客户端可能是 Excel 数据透视表或数据透视图、 [!INCLUDE[ssCrescent](../../includes/sscrescent-md.md)] 报表或 MDX 查询。</span><span class="sxs-lookup"><span data-stu-id="8bf17-153">That client might be an Excel PivotTable or PivotChart, a [!INCLUDE[ssCrescent](../../includes/sscrescent-md.md)] report, or an MDX query.</span></span> <span data-ttu-id="8bf17-154">无论报表客户端是什么，都会对结果中的每个单元运行单独的查询。</span><span class="sxs-lookup"><span data-stu-id="8bf17-154">Regardless of the reporting client, a separate query is run for each cell in the results.</span></span> <span data-ttu-id="8bf17-155">也就是说，数据透视表中行与列标题的每个组合或 [!INCLUDE[ssCrescent](../../includes/sscrescent-md.md)] 报表中切片器和筛选器的每种选择会生成依据其计算度量值的不同数据子集。</span><span class="sxs-lookup"><span data-stu-id="8bf17-155">That is to say, each combination of row and column headers in a PivotTable, or each selection of slicers and filters in a [!INCLUDE[ssCrescent](../../includes/sscrescent-md.md)] report, generates a different subset of data over which the measure is calculated.</span></span> <span data-ttu-id="8bf17-156">例如，在使用公式 `Total Sales:=SUM([Sales Amount])`的度量值中，当用户将 Total Sales 度量值放入数据透视表中的“值”窗口，然后将 Product 表中的 Product Category 列放入“筛选器”窗口时，将计算 Sales Amount 的总和并为每个产品类别显示该总和。</span><span class="sxs-lookup"><span data-stu-id="8bf17-156">For example, in a measure with the formula, `Total Sales:=SUM([Sales Amount])`, when a user places the Total Sales measure in the Values window in a PivotTable, and then places the Product Category column from a Product table into the Filters window, the sum of Sales Amount is calculated and displayed for each product category.</span></span>  
  
 <span data-ttu-id="8bf17-157">与计算列和行筛选器不同，度量值的语法包括公式前面的度量值名称。</span><span class="sxs-lookup"><span data-stu-id="8bf17-157">Unlike calculated columns and row filters, the syntax for a measure includes the measure's name preceding the formula.</span></span> <span data-ttu-id="8bf17-158">在刚才提供的示例中，名称 **Total Sales:** 显示在公式之前。</span><span class="sxs-lookup"><span data-stu-id="8bf17-158">In the example just provided, the name **Total Sales:** appears preceding the formula.</span></span> <span data-ttu-id="8bf17-159">创建一个度量值后，其名称和定义将显示在报表客户端应用程序的“字段”列表中，可供模型的所有用户使用（具体取决于透视和角色）。</span><span class="sxs-lookup"><span data-stu-id="8bf17-159">After you have created a measure, the name and its definition appear in the reporting client application Field List and depending on perspectives and roles is available to all users of the model.</span></span>  
  
 <span data-ttu-id="8bf17-160">有关详细信息，请参阅 [度量值（SSAS 表格）](measures-ssas-tabular.md)中创建的表格模型项目。</span><span class="sxs-lookup"><span data-stu-id="8bf17-160">For more information, see [Measures &#40;SSAS Tabular&#41;](measures-ssas-tabular.md).</span></span>  
  
### <a name="row-filters"></a><span data-ttu-id="8bf17-161">行筛选器</span><span class="sxs-lookup"><span data-stu-id="8bf17-161">Row Filters</span></span>  
 <span data-ttu-id="8bf17-162">行筛选器定义表中对特定角色的成员可见的行。</span><span class="sxs-lookup"><span data-stu-id="8bf17-162">Row filters define which rows in a table are visible to members of a particular role.</span></span> <span data-ttu-id="8bf17-163">通过使用 DAX 公式可为模型中的每个表创建行筛选器。</span><span class="sxs-lookup"><span data-stu-id="8bf17-163">Row filters can be created for each table in a model by using DAX formulas.</span></span> <span data-ttu-id="8bf17-164">通过使用 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]中的角色管理器可以为特定角色创建行筛选器。</span><span class="sxs-lookup"><span data-stu-id="8bf17-164">Row filters are created for a particular role by using Role Manager in [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span></span> <span data-ttu-id="8bf17-165">还可以通过使用 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]中的角色属性为已部署的模型定义行筛选器。</span><span class="sxs-lookup"><span data-stu-id="8bf17-165">Row filters can also be defined for a deployed model by using Role Properties in [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span></span>  
  
 <span data-ttu-id="8bf17-166">在行筛选器中，DAX 公式（求值结果必须为 TRUE/FALSE 布尔值条件）定义该特定角色的成员执行查询的结果可返回的行。</span><span class="sxs-lookup"><span data-stu-id="8bf17-166">In a row filter, a DAX formula, which must evaluate to a Boolean TRUE/FALSE condition, defines which rows can be returned by the results of a query by members of that particular role.</span></span> <span data-ttu-id="8bf17-167">不能返回未包含在 DAX 公式中的行。</span><span class="sxs-lookup"><span data-stu-id="8bf17-167">Rows not included in the DAX formula cannot be returned.</span></span> <span data-ttu-id="8bf17-168">例如，对于具有以下 DAX 公式 `=Customers[Country] = "USA"`的 Customers 表，Sales 角色的成员将只能查看美国境内客户的数据和聚合值，例如仅为美国客户返回 SUM。</span><span class="sxs-lookup"><span data-stu-id="8bf17-168">For example, for members of the Sales role, the Customers table with the following DAX formula, `=Customers[Country] = "USA"`, members of the Sales role will only be able to view data for customers in the USA, and aggregates, such as SUM are returned only for customers in the USA.</span></span>  
  
 <span data-ttu-id="8bf17-169">使用 DAX 公式定义行筛选器时，您将创建一个允许的行集。</span><span class="sxs-lookup"><span data-stu-id="8bf17-169">When you define a row filter by using DAX formula, you are creating an allowed row set.</span></span> <span data-ttu-id="8bf17-170">这并不影响访问其他行；其他行只是不会作为允许的行集的一部分返回。</span><span class="sxs-lookup"><span data-stu-id="8bf17-170">This does not deny access to other rows; rather, they are simply not returned as part of the allowed row set.</span></span> <span data-ttu-id="8bf17-171">其他角色可允许访问 DAX 公式所排除的行。</span><span class="sxs-lookup"><span data-stu-id="8bf17-171">Other roles can allow access to the rows excluded by the DAX formula.</span></span> <span data-ttu-id="8bf17-172">如果用户是其他角色的成员，并且该角色的行筛选器允许访问该特定行集，则该用户可以查看该行的数据。</span><span class="sxs-lookup"><span data-stu-id="8bf17-172">If a user is a member of another role, and that role's row filters allow access to that particular row set, the user can view data for that row.</span></span>  
  
 <span data-ttu-id="8bf17-173">行筛选器应用于指定的行以及相关行。</span><span class="sxs-lookup"><span data-stu-id="8bf17-173">Row filters apply to the specified rows as well as related rows.</span></span> <span data-ttu-id="8bf17-174">如果表具有多个关系，筛选器将对处于活动状态的关系应用安全性。</span><span class="sxs-lookup"><span data-stu-id="8bf17-174">When a table has multiple relationships, filters apply security for the relationship that is active.</span></span> <span data-ttu-id="8bf17-175">行筛选器将与为相关表定义的其他行筛选器相交。</span><span class="sxs-lookup"><span data-stu-id="8bf17-175">Row filters will be intersected with other row filters defined for related tables.</span></span>  
  
 <span data-ttu-id="8bf17-176">有关详细信息，请参阅 [角色（SSAS 表格）](roles-ssas-tabular.md)中创建的表格模型项目。</span><span class="sxs-lookup"><span data-stu-id="8bf17-176">For more information, see [Roles &#40;SSAS Tabular&#41;](roles-ssas-tabular.md).</span></span>  
  
##  <a name="dax-data-types"></a><a name="bkmk_DAX_datatypes"></a><span data-ttu-id="8bf17-177">DAX 数据类型</span><span class="sxs-lookup"><span data-stu-id="8bf17-177">DAX Data Types</span></span>  
 <span data-ttu-id="8bf17-178">您可以将数据从可能支持不同数据类型的众多不同数据源导入到模型中。</span><span class="sxs-lookup"><span data-stu-id="8bf17-178">You can import data into a model from many different data sources that might support different data types.</span></span> <span data-ttu-id="8bf17-179">将数据导入模型时，数据将转换为表格模型数据类型之一。</span><span class="sxs-lookup"><span data-stu-id="8bf17-179">When you import data into a model, the data is converted to one of the tabular model data types.</span></span> <span data-ttu-id="8bf17-180">当在计算中使用模型数据时，数据则会因计算的持续时间和输出而转换为 DAX 数据类型。</span><span class="sxs-lookup"><span data-stu-id="8bf17-180">When the model data is used in a calculation, the data is then converted to a DAX data type for the duration and output of the calculation.</span></span> <span data-ttu-id="8bf17-181">当您创建一个 DAX 公式时，该公式中使用的项将自动确定返回的值数据类型。</span><span class="sxs-lookup"><span data-stu-id="8bf17-181">When you create a DAX formula, the terms used in the formula will automatically determine the value data type returned.</span></span>  
  
 <span data-ttu-id="8bf17-182">表格模型和 DAX 支持下列数据类型：</span><span class="sxs-lookup"><span data-stu-id="8bf17-182">Tabular models, and DAX, support the following data types:</span></span>  
  
|<span data-ttu-id="8bf17-183">模型中的数据类型</span><span class="sxs-lookup"><span data-stu-id="8bf17-183">Data type in model</span></span>|<span data-ttu-id="8bf17-184">DAX 中的数据类型</span><span class="sxs-lookup"><span data-stu-id="8bf17-184">Data type in DAX</span></span>|<span data-ttu-id="8bf17-185">说明</span><span class="sxs-lookup"><span data-stu-id="8bf17-185">Description</span></span>|  
|------------------------|----------------------|-----------------|  
|<span data-ttu-id="8bf17-186">整数</span><span class="sxs-lookup"><span data-stu-id="8bf17-186">Whole Number</span></span>|<span data-ttu-id="8bf17-187">一个 64 位（八字节）整数值 <sup>1、2</sup></span><span class="sxs-lookup"><span data-stu-id="8bf17-187">A 64 bit (eight-bytes) integer value <sup>1, 2</sup></span></span>|<span data-ttu-id="8bf17-188">没有小数位的数字。</span><span class="sxs-lookup"><span data-stu-id="8bf17-188">Numbers that have no decimal places.</span></span> <span data-ttu-id="8bf17-189">整数可以是正数或负数，但必须是介于 -9,223,372,036,854,775,808 (-2^63) 和 9,223,372,036,854,775,807 (2^63-1) 之间的整数。</span><span class="sxs-lookup"><span data-stu-id="8bf17-189">Integers can be positive or negative numbers, but must be whole numbers between -9,223,372,036,854,775,808 (-2^63) and 9,223,372,036,854,775,807 (2^63-1).</span></span>|  
|<span data-ttu-id="8bf17-190">十进制数</span><span class="sxs-lookup"><span data-stu-id="8bf17-190">Decimal Number</span></span>|<span data-ttu-id="8bf17-191">一个 64 位（八字节）实数 <sup>1、2</sup></span><span class="sxs-lookup"><span data-stu-id="8bf17-191">A 64 bit (eight-bytes) real number <sup>1, 2</sup></span></span>|<span data-ttu-id="8bf17-192">实数是可具有小数位的数字。</span><span class="sxs-lookup"><span data-stu-id="8bf17-192">Real numbers are numbers that can have decimal places.</span></span> <span data-ttu-id="8bf17-193">实数涵盖很广范围的值：</span><span class="sxs-lookup"><span data-stu-id="8bf17-193">Real numbers cover a wide range of values:</span></span><br /><br /> <span data-ttu-id="8bf17-194">从 -1.79E +308 到 -2.23E -308 的负值</span><span class="sxs-lookup"><span data-stu-id="8bf17-194">Negative values from -1.79E +308 through -2.23E -308</span></span><br /><br /> <span data-ttu-id="8bf17-195">零</span><span class="sxs-lookup"><span data-stu-id="8bf17-195">Zero</span></span><br /><br /> <span data-ttu-id="8bf17-196">从 2.23E -308 到 1.79E + 308 的正值</span><span class="sxs-lookup"><span data-stu-id="8bf17-196">Positive values from 2.23E -308 through 1.79E + 308</span></span><br /><br /> <span data-ttu-id="8bf17-197">但是，有效位数限制为 17 个小数位。</span><span class="sxs-lookup"><span data-stu-id="8bf17-197">However, the number of significant digits is limited to 17 decimal digits.</span></span>|  
|<span data-ttu-id="8bf17-198">布尔</span><span class="sxs-lookup"><span data-stu-id="8bf17-198">Boolean</span></span>|<span data-ttu-id="8bf17-199">布尔</span><span class="sxs-lookup"><span data-stu-id="8bf17-199">Boolean</span></span>|<span data-ttu-id="8bf17-200">True 或 False 值。</span><span class="sxs-lookup"><span data-stu-id="8bf17-200">Either a True or False value.</span></span>|  
|<span data-ttu-id="8bf17-201">文本</span><span class="sxs-lookup"><span data-stu-id="8bf17-201">Text</span></span>|<span data-ttu-id="8bf17-202">String</span><span class="sxs-lookup"><span data-stu-id="8bf17-202">String</span></span>|<span data-ttu-id="8bf17-203">一个 Unicode 字符数据字符串。</span><span class="sxs-lookup"><span data-stu-id="8bf17-203">A Unicode character data string.</span></span> <span data-ttu-id="8bf17-204">可以是字符串，或以文本格式表示的数字或日期。</span><span class="sxs-lookup"><span data-stu-id="8bf17-204">Can be strings, numbers or dates represented in a text format.</span></span>|  
|<span data-ttu-id="8bf17-205">Date</span><span class="sxs-lookup"><span data-stu-id="8bf17-205">Date</span></span>|<span data-ttu-id="8bf17-206">日期/时间</span><span class="sxs-lookup"><span data-stu-id="8bf17-206">Date/time</span></span>|<span data-ttu-id="8bf17-207">采用接受的日期-时间表示形式的日期和时间。</span><span class="sxs-lookup"><span data-stu-id="8bf17-207">Dates and times in an accepted date-time representation.</span></span><br /><br /> <span data-ttu-id="8bf17-208">有效值是 1900 年 3 月 1 日后的所有日期。</span><span class="sxs-lookup"><span data-stu-id="8bf17-208">Valid dates are all dates after March 1, 1900.</span></span>|  
|<span data-ttu-id="8bf17-209">货币</span><span class="sxs-lookup"><span data-stu-id="8bf17-209">Currency</span></span>|<span data-ttu-id="8bf17-210">货币</span><span class="sxs-lookup"><span data-stu-id="8bf17-210">Currency</span></span>|<span data-ttu-id="8bf17-211">货币数据类型允许值介于 -922,337,203,685,477.5808 到 922,337,203,685,477.5807 之间，并且具有四个小数位的固定精度。</span><span class="sxs-lookup"><span data-stu-id="8bf17-211">Currency data type allows values between -922,337,203,685,477.5808 to 922,337,203,685,477.5807 with four decimal digits of fixed precision.</span></span>|  
|<span data-ttu-id="8bf17-212">空值</span><span class="sxs-lookup"><span data-stu-id="8bf17-212">N/A</span></span>|<span data-ttu-id="8bf17-213">空</span><span class="sxs-lookup"><span data-stu-id="8bf17-213">Blank</span></span>|<span data-ttu-id="8bf17-214">空白是 DAX 中的一种数据类型，表示并替代 SQL 中的 Null。</span><span class="sxs-lookup"><span data-stu-id="8bf17-214">A blank is a data type in DAX that represents and replaces SQL nulls.</span></span> <span data-ttu-id="8bf17-215">您可以通过使用 BLANK 函数创建空白，并通过使用逻辑函数 ISBLANK 测试是否存在空白。</span><span class="sxs-lookup"><span data-stu-id="8bf17-215">You can create a blank by using the BLANK function, and test for blanks by using the logical function, ISBLANK.</span></span>|  
  
 <span data-ttu-id="8bf17-216">表格模型还包括 Table 数据类型，作为许多 DAX 函数的输入或输出。</span><span class="sxs-lookup"><span data-stu-id="8bf17-216">Tabular models also include the Table data type as the input or output to many DAX functions.</span></span> <span data-ttu-id="8bf17-217">例如，FILTER 函数采用表作为输入，并输出仅包含满足筛选条件的行的另一个表。</span><span class="sxs-lookup"><span data-stu-id="8bf17-217">For example, the FILTER function takes a table as input and outputs another table that contains only the rows that meet the filter conditions.</span></span> <span data-ttu-id="8bf17-218">通过组合表函数与聚合函数，您可以对动态定义的数据集执行复杂计算。</span><span class="sxs-lookup"><span data-stu-id="8bf17-218">By combining table functions with aggregation functions, you can perform complex calculations over dynamically defined data sets.</span></span>  
  
 <span data-ttu-id="8bf17-219">尽管数据类型通常都是自动设置的，但还是需要了解数据类型，尤其是它们如何应用到 DAX 公式，这一点非常重要。</span><span class="sxs-lookup"><span data-stu-id="8bf17-219">While data types are typically automatically set, it is important to understand data types and how they apply, in-particular, to DAX formulas.</span></span> <span data-ttu-id="8bf17-220">举例来说，公式中的错误或是意外结果通常都是因为对参数中指定的数据类型使用了不该使用的特定运算符而导致的。</span><span class="sxs-lookup"><span data-stu-id="8bf17-220">Errors in formulas or unexpected results, for example, are often caused by using a particular operator that cannot be used with a data type specified in an argument.</span></span> <span data-ttu-id="8bf17-221">例如，公式 `= 1 & 2`返回结果为 12 的字符串。</span><span class="sxs-lookup"><span data-stu-id="8bf17-221">For example, the formula, `= 1 & 2`, returns a string result of 12.</span></span> <span data-ttu-id="8bf17-222">但是公式 `= "1" + "2"`返回的结果为整数 3。</span><span class="sxs-lookup"><span data-stu-id="8bf17-222">The formula, `= "1" + "2"`, however, returns an integer result of 3.</span></span>  
  
 <span data-ttu-id="8bf17-223">有关表格模型的数据类型以及 DAX 中数据类型的显式和隐式转换的详细信息，请参阅[支持的数据类型（SSAS 表格）](data-types-supported-ssas-tabular.md)。</span><span class="sxs-lookup"><span data-stu-id="8bf17-223">For detailed information about data types in tabular models and explicit and implicit conversions of data types in DAX, see [Data Types Supported &#40;SSAS Tabular&#41;](data-types-supported-ssas-tabular.md).</span></span>  
  
##  <a name="dax-operators"></a><a name="bkmk_DAX_opertors"></a><span data-ttu-id="8bf17-224">DAX 运算符</span><span class="sxs-lookup"><span data-stu-id="8bf17-224">DAX Operators</span></span>  
 <span data-ttu-id="8bf17-225">DAX 语言在公式中使用四种不同类型的运算符：</span><span class="sxs-lookup"><span data-stu-id="8bf17-225">The DAX language uses four different types of calculation operators in formulas:</span></span>  
  
-   <span data-ttu-id="8bf17-226">对值进行比较，并返回一个逻辑 TRUE\FALSE 值的比较运算符。</span><span class="sxs-lookup"><span data-stu-id="8bf17-226">Comparison operators to compare values and return a logical TRUE\FALSE value.</span></span>  
  
-   <span data-ttu-id="8bf17-227">执行返回数值的算术运算的算术运算符。</span><span class="sxs-lookup"><span data-stu-id="8bf17-227">Arithmetic operators to perform arithmetic calculations that return numeric values.</span></span>  
  
-   <span data-ttu-id="8bf17-228">联接两个或更多文本字符串的文本连接运算符。</span><span class="sxs-lookup"><span data-stu-id="8bf17-228">Text concatenation operators to join two or more text strings.</span></span>  
  
-   <span data-ttu-id="8bf17-229">将两个或更多表达式组合起来以返回单个结果的逻辑运算符。</span><span class="sxs-lookup"><span data-stu-id="8bf17-229">Logical operators that combine two or more expressions to return a single result.</span></span>  
  
 <span data-ttu-id="8bf17-230">有关 DAX 公式中使用的运算符的详细信息，请参阅[PowerPivot 的 Dax 运算符参考](/dax/dax-operator-reference)。</span><span class="sxs-lookup"><span data-stu-id="8bf17-230">For detailed information about operators used in DAX formulas, see [DAX Operator Reference for PowerPivot](/dax/dax-operator-reference).</span></span>  
  
##  <a name="dax-formulas"></a><a name="bkmk_DAX_Formulas"></a><span data-ttu-id="8bf17-231">DAX 公式</span><span class="sxs-lookup"><span data-stu-id="8bf17-231">DAX Formulas</span></span>  
 <span data-ttu-id="8bf17-232">DAX 公式对于在计算列和度量值中创建计算以及使用行级别筛选器保护数据方面非常重要。</span><span class="sxs-lookup"><span data-stu-id="8bf17-232">DAX formulas are essential for creating calculations in calculated columns and measures, and securing your data by using row level filters.</span></span> <span data-ttu-id="8bf17-233">若要创建用于计算列和度量值的公式，您需要使用模型设计器窗口顶部的公式栏。</span><span class="sxs-lookup"><span data-stu-id="8bf17-233">To create formulas for calculated columns and measures, you will use the formula bar along the top of the model designer window.</span></span> <span data-ttu-id="8bf17-234">若要创建用于行筛选器的公式，您需要使用“角色管理器”对话框。</span><span class="sxs-lookup"><span data-stu-id="8bf17-234">To create formulas for row filters, you will use the Role Manager dialog box.</span></span> <span data-ttu-id="8bf17-235">本节中的信息旨在帮助您开始了解 DAX 公式的基础知识。</span><span class="sxs-lookup"><span data-stu-id="8bf17-235">Information in this section is meant to get you started with understanding the basics of DAX formulas.</span></span>  
  
###  <a name="formula-basics"></a><a name="basics"></a><span data-ttu-id="8bf17-236">公式基础知识</span><span class="sxs-lookup"><span data-stu-id="8bf17-236">Formula Basics</span></span>  
 <span data-ttu-id="8bf17-237">利用 DAX，表格模型作者既可以将自定义计算定义为模型表中的计算列的一部分，也可以将其定义为与表关联但不直接显示在表中的度量值。</span><span class="sxs-lookup"><span data-stu-id="8bf17-237">DAX enables tabular model authors to define custom calculations in both model tables, as part of calculated columns, and as measures associated with tables, but not appearing directly in them.</span></span> <span data-ttu-id="8bf17-238">DAX 还支持模型作者保护数据，因为 DAX 支持创建返回布尔值的计算，由布尔值定义可供关联角色的成员用户查询的特定或相关表中的行。</span><span class="sxs-lookup"><span data-stu-id="8bf17-238">DAX also enables model authors to secure data, by creating calculations that return a Boolean value defining which rows in a particular or related table can be queried by member users of the associated role.</span></span>  
  
 <span data-ttu-id="8bf17-239">DAX 公式可以很简单，也可以很复杂。</span><span class="sxs-lookup"><span data-stu-id="8bf17-239">DAX formulas can be very simple or quite complex.</span></span> <span data-ttu-id="8bf17-240">下表显示了可以在计算列中使用的简单公式的一些示例。</span><span class="sxs-lookup"><span data-stu-id="8bf17-240">The following table shows some examples of simple formulas that could be used in a calculated column.</span></span>  
  
|||  
|-|-|  
|<span data-ttu-id="8bf17-241">公式</span><span class="sxs-lookup"><span data-stu-id="8bf17-241">Formula</span></span>|<span data-ttu-id="8bf17-242">说明</span><span class="sxs-lookup"><span data-stu-id="8bf17-242">Description</span></span>|  
|`=TODAY()`|<span data-ttu-id="8bf17-243">将今天的日期插入列中的每一行。</span><span class="sxs-lookup"><span data-stu-id="8bf17-243">Inserts today's date in every row of the column.</span></span>|  
|`=3`|<span data-ttu-id="8bf17-244">将值 3 插入列中的每一行。</span><span class="sxs-lookup"><span data-stu-id="8bf17-244">Inserts the value 3 in every row of the column.</span></span>|  
|`=[Column1] + [Column2]`|<span data-ttu-id="8bf17-245">将 [Column1] 和 [Column2] 的同一行中的值相加，并且将结果放置于同一行的计算列中。</span><span class="sxs-lookup"><span data-stu-id="8bf17-245">Adds the values in the same row of [Column1] and [Column2] and puts the results in the calculated column of the same row.</span></span>|  
  
 <span data-ttu-id="8bf17-246">无论您创建的公式是繁是简，您都可以在构建公式时使用以下步骤：</span><span class="sxs-lookup"><span data-stu-id="8bf17-246">Whether the formula you create is simple or complex, you can use the following steps when building a formula:</span></span>  
  
1.  <span data-ttu-id="8bf17-247">每个公式必须以等号开头。</span><span class="sxs-lookup"><span data-stu-id="8bf17-247">Each formula must begin with an equal sign.</span></span>  
  
2.  <span data-ttu-id="8bf17-248">可以键入或选择一个函数名称，也可以键入一个表达式。</span><span class="sxs-lookup"><span data-stu-id="8bf17-248">You can either type or select a function name, or type an expression.</span></span>  
  
3.  <span data-ttu-id="8bf17-249">开始键入所需函数或名称的前几个字母，记忆式键入功能将显示可用函数、表和列的列表。</span><span class="sxs-lookup"><span data-stu-id="8bf17-249">Begin to type the first few letters of the function or name you want, and AutoComplete displays a list of available functions, tables, and columns.</span></span> <span data-ttu-id="8bf17-250">按 Tab 从记忆式键入列表向公式中添加项。</span><span class="sxs-lookup"><span data-stu-id="8bf17-250">Press TAB to add an item from the AutoComplete list to the formula.</span></span>  
  
     <span data-ttu-id="8bf17-251">还可以单击 **Fx** 按钮显示可用函数的列表。</span><span class="sxs-lookup"><span data-stu-id="8bf17-251">You can also click the **Fx** button to display a list of available functions.</span></span> <span data-ttu-id="8bf17-252">若要从下拉列表中选择某一函数，请使用箭头键突出显示该项，然后单击 **“确定”** 将该函数添加到公式中。</span><span class="sxs-lookup"><span data-stu-id="8bf17-252">To select a function from the dropdown list, use the arrow keys to highlight the item, and click **OK** to add the function to the formula.</span></span>  
  
4.  <span data-ttu-id="8bf17-253">通过从可能的表和列的下拉列表中选择参数，或者通过键入值，向函数提供参数。</span><span class="sxs-lookup"><span data-stu-id="8bf17-253">Supply the arguments to the function by selecting them from a dropdown list of possible tables and columns, or by typing in values.</span></span>  
  
5.  <span data-ttu-id="8bf17-254">检查是否有语法错误：确保所有括号都成对出现且正确引用列、表和值。</span><span class="sxs-lookup"><span data-stu-id="8bf17-254">Check for syntax errors: ensure that all parentheses are closed and columns, tables and values are referenced correctly.</span></span>  
  
6.  <span data-ttu-id="8bf17-255">按 Enter 以接受该公式。</span><span class="sxs-lookup"><span data-stu-id="8bf17-255">Press ENTER to accept the formula.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="8bf17-256">在计算列中，只要接受公式并完成验证，该列即会填充值。</span><span class="sxs-lookup"><span data-stu-id="8bf17-256">In a calculated column, as soon as you accept the formula and the formula is validated, the column is populated with values.</span></span> <span data-ttu-id="8bf17-257">在度量值中，按 Enter 可在表的度量值网格中保存度量值定义。</span><span class="sxs-lookup"><span data-stu-id="8bf17-257">In a measure, pressing ENTER saves the measure definition in the measure grid with the table.</span></span> <span data-ttu-id="8bf17-258">如果公式无效，将会显示错误。</span><span class="sxs-lookup"><span data-stu-id="8bf17-258">If a formula is invalid, an error will be displayed.</span></span>  
  
 <span data-ttu-id="8bf17-259">在此示例中，我们将查看名为 Days in Current Quarter 的度量值中一个更为复杂的公式：</span><span class="sxs-lookup"><span data-stu-id="8bf17-259">In this example, we will look at a more complex formula in a measure named Days in Current Quarter:</span></span>  
  
```  
Days in Current Quarter:=COUNTROWS( DATESBETWEEN( 'Date'[Date], STARTOFQUARTER( LASTDATE('Date'[Date])), ENDOFQUARTER('Date'[Date])))  
```  
  
 <span data-ttu-id="8bf17-260">此度量值用于创建一个不完整期间与前一个期间之间的比率。</span><span class="sxs-lookup"><span data-stu-id="8bf17-260">This measure is used to create a comparison ratio between an incomplete period and the previous period.</span></span> <span data-ttu-id="8bf17-261">该公式必须考虑期间中已消逝的比例，并将其与前一期间中的同一比例进行比较。</span><span class="sxs-lookup"><span data-stu-id="8bf17-261">The formula must take into account the proportion of the period that has elapsed, and compare it to the same proportion in the previous period.</span></span> <span data-ttu-id="8bf17-262">在此情况下，[Days Current Quarter to Date]/[Days in Current Quarter] 给出当前期间中已消逝的比例。</span><span class="sxs-lookup"><span data-stu-id="8bf17-262">In this case, [Days Current Quarter to Date]/[Days in Current Quarter] gives the proportion elapsed in the current period.</span></span>  
  
 <span data-ttu-id="8bf17-263">此公式包含以下元素：</span><span class="sxs-lookup"><span data-stu-id="8bf17-263">This formula contains the following elements:</span></span>  
  
|<span data-ttu-id="8bf17-264">公式元素</span><span class="sxs-lookup"><span data-stu-id="8bf17-264">Formula element</span></span>|<span data-ttu-id="8bf17-265">说明</span><span class="sxs-lookup"><span data-stu-id="8bf17-265">Description</span></span>|  
|---------------------|-----------------|  
|`Days in Current Quarter:=`|<span data-ttu-id="8bf17-266">度量值的名称。</span><span class="sxs-lookup"><span data-stu-id="8bf17-266">The name of the measure.</span></span>|  
|`=`|<span data-ttu-id="8bf17-267">公式以等号 (=) 开头。</span><span class="sxs-lookup"><span data-stu-id="8bf17-267">The equals sign (=) begins the formula.</span></span>|  
|`COUNTROWS`|<span data-ttu-id="8bf17-268">[COUNTROWS 函数 &#40;DAX&#41;](/dax/countrows-function-dax)计算 Date 表中的行数</span><span class="sxs-lookup"><span data-stu-id="8bf17-268">The [COUNTROWS Function &#40;DAX&#41;](/dax/countrows-function-dax) counts the number of rows in the Date table</span></span>|  
|`()`|<span data-ttu-id="8bf17-269">左括号和右括号指定参数。</span><span class="sxs-lookup"><span data-stu-id="8bf17-269">Open and closing parenthesis specifies arguments.</span></span>|  
|`DATESBETWEEN`|<span data-ttu-id="8bf17-270">DATESBETWEEN 函数返回 Date 表的 Date 列中每个值的最后日期之间的天数。</span><span class="sxs-lookup"><span data-stu-id="8bf17-270">The DATESBETWEEN function returns the dates between the last date for each value in the Date column in the Date table.</span></span>|  
|`'Date'`|<span data-ttu-id="8bf17-271">指定 Date 表。</span><span class="sxs-lookup"><span data-stu-id="8bf17-271">Specifies the Date table.</span></span> <span data-ttu-id="8bf17-272">表引在单引号中。</span><span class="sxs-lookup"><span data-stu-id="8bf17-272">Tables are in single quotes.</span></span>|  
|`[Date]`|<span data-ttu-id="8bf17-273">指定 Date 表中的 Date 列。</span><span class="sxs-lookup"><span data-stu-id="8bf17-273">Specifies the Date column in the Date table.</span></span> <span data-ttu-id="8bf17-274">列括在方括号中。</span><span class="sxs-lookup"><span data-stu-id="8bf17-274">Columns are in brackets.</span></span>|  
|`,`||  
|`STARTOFQUARTER`|<span data-ttu-id="8bf17-275">STARTOFQUARTER 函数返回季度的开始日期。</span><span class="sxs-lookup"><span data-stu-id="8bf17-275">The STARTOFQUARTER function returns the date of the start of the quarter.</span></span>|  
|`LASTDATE`|<span data-ttu-id="8bf17-276">LASTDATE 函数返回季度的最后日期。</span><span class="sxs-lookup"><span data-stu-id="8bf17-276">The LASTDATE function returns the last date of the quarter.</span></span>|  
|`'Date'`|<span data-ttu-id="8bf17-277">指定 Date 表。</span><span class="sxs-lookup"><span data-stu-id="8bf17-277">Specifies the Date table.</span></span>|  
|`[Date]`|<span data-ttu-id="8bf17-278">指定 Date 表中的 Date 列。</span><span class="sxs-lookup"><span data-stu-id="8bf17-278">Specifies the Date column in the Date table.</span></span>|  
|`,`||  
|`ENDOFQUARTER`|<span data-ttu-id="8bf17-279">ENDOFQUARTER 函数</span><span class="sxs-lookup"><span data-stu-id="8bf17-279">The ENDOFQUARTER function</span></span>|  
|`'Date'`|<span data-ttu-id="8bf17-280">指定 Date 表。</span><span class="sxs-lookup"><span data-stu-id="8bf17-280">Specifies the Date table.</span></span>|  
|`[Date]`|<span data-ttu-id="8bf17-281">指定 Date 表中的 Date 列。</span><span class="sxs-lookup"><span data-stu-id="8bf17-281">Specifies the Date column in the Date table.</span></span>|  
  
#### <a name="using-formula-autocomplete"></a><span data-ttu-id="8bf17-282">使用公式记忆式键入功能</span><span class="sxs-lookup"><span data-stu-id="8bf17-282">Using Formula AutoComplete</span></span>  
 <span data-ttu-id="8bf17-283">模型设计器中的公式栏和“角色管理器”对话框中的公式“行筛选器”窗口都提供记忆式键入功能。</span><span class="sxs-lookup"><span data-stu-id="8bf17-283">Both the formula bar in the model designer and the formula Row Filters window in the Role Manager dialog box provide an AutoComplete feature.</span></span> <span data-ttu-id="8bf17-284">记忆式键入功能通过为您提供公式中每个元素的选项，可帮助您输入有效的公式语法。</span><span class="sxs-lookup"><span data-stu-id="8bf17-284">AutoComplete helps you enter a valid formula syntax by providing you with options for each element in the formula.</span></span>  
  
-   <span data-ttu-id="8bf17-285">可以在具有嵌套函数的现有公式中使用公式记忆式键入功能。</span><span class="sxs-lookup"><span data-stu-id="8bf17-285">You can use Formula AutoComplete in the middle of an existing formula with nested functions.</span></span> <span data-ttu-id="8bf17-286">刚好在插入点之前的文本将用于显示下拉列表中的值，并且插入点之后的所有文本都保持不变。</span><span class="sxs-lookup"><span data-stu-id="8bf17-286">The text immediately before the insertion point is used to display values in the drop-down list, and all of the text after the insertion point remains unchanged.</span></span>  
  
-   <span data-ttu-id="8bf17-287">记忆式键入功能不添加函数的右括号或自动匹配括号。</span><span class="sxs-lookup"><span data-stu-id="8bf17-287">AutoComplete does not add the closing parenthesis of functions or automatically match parentheses.</span></span> <span data-ttu-id="8bf17-288">您必须确保每个函数在语法上都是正确的，否则不能保存或使用公式。</span><span class="sxs-lookup"><span data-stu-id="8bf17-288">You must make sure that each function is syntactically correct or you cannot save or use the formula.</span></span>  
  
#### <a name="using-multiple-functions-in-a-formula"></a><span data-ttu-id="8bf17-289">在公式中使用多个函数</span><span class="sxs-lookup"><span data-stu-id="8bf17-289">Using Multiple Functions in a Formula</span></span>  
 <span data-ttu-id="8bf17-290">您可以嵌套函数，这意味着您可以使用一个函数的结果作为另一个函数的参数。</span><span class="sxs-lookup"><span data-stu-id="8bf17-290">You can nest functions, meaning that you use the results from one function as an argument of another function.</span></span> <span data-ttu-id="8bf17-291">在计算列中，最多可以嵌套 64 个级别的函数。</span><span class="sxs-lookup"><span data-stu-id="8bf17-291">You can nest up to 64 levels of functions in calculated columns.</span></span> <span data-ttu-id="8bf17-292">但是，嵌套可能会导致很难创建公式或者排除公式问题。</span><span class="sxs-lookup"><span data-stu-id="8bf17-292">However, nesting can make it difficult to create or troubleshoot formulas.</span></span>  
  
 <span data-ttu-id="8bf17-293">许多函数设计为仅用作嵌套函数。</span><span class="sxs-lookup"><span data-stu-id="8bf17-293">Many functions are designed to be used solely as nested functions.</span></span> <span data-ttu-id="8bf17-294">这些函数返回一个表，该表不能直接保存为结果，而必须作为表函数的输入提供。</span><span class="sxs-lookup"><span data-stu-id="8bf17-294">These functions return a table, which cannot be directly saved as a result; it must be provided as input to a table function.</span></span> <span data-ttu-id="8bf17-295">例如，函数 SUMX、AVERAGEX 和 MINX 全都要求将表作为第一个参数。</span><span class="sxs-lookup"><span data-stu-id="8bf17-295">For example, the functions SUMX, AVERAGEX, and MINX all require a table as the first argument.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="8bf17-296">在度量值内嵌套函数时会应用一些限制，以确保不会由于列之间的依赖关系所要求的许多计算而影响性能。</span><span class="sxs-lookup"><span data-stu-id="8bf17-296">Some limits are applied within measures on nesting of functions to ensure that performance is not affected by the many calculations required by dependencies among columns.</span></span>  
  
##  <a name="dax-functions"></a><a name="bkmk_DAX_functions"></a><span data-ttu-id="8bf17-297">DAX 函数</span><span class="sxs-lookup"><span data-stu-id="8bf17-297">DAX Functions</span></span>  
 <span data-ttu-id="8bf17-298">本节概述 DAX 中支持的函数“类型”。 \*\*</span><span class="sxs-lookup"><span data-stu-id="8bf17-298">This section provides an overview of the *types* of functions supported in DAX.</span></span> <span data-ttu-id="8bf17-299">有关详细信息，请参阅 [DAX 函数参考](/dax/dax-function-reference)。</span><span class="sxs-lookup"><span data-stu-id="8bf17-299">For more detailed information, see [DAX Function Reference](/dax/dax-function-reference).</span></span>  
  
 <span data-ttu-id="8bf17-300">DAX 提供多种函数，可用于使用日期和时间执行计算、创建条件值、处理字符串、基于关系执行查找，以及循环访问某个表以执行递归计算。</span><span class="sxs-lookup"><span data-stu-id="8bf17-300">DAX provides a variety of functions you can use perform calculations using dates and times, create conditional values, work with strings, perform lookups based on relationships, and the ability to iterate over a table to perform recursive calculations.</span></span> <span data-ttu-id="8bf17-301">如果您熟悉 Excel 公式，会发现 Excel 公式与 DAX 公式中的多数函数都极为相似；但是，DAX 公式在以下方面显著不同：</span><span class="sxs-lookup"><span data-stu-id="8bf17-301">If you are familiar with Excel formulas, many of these functions will appear very similar; however, DAX formulas are different in the following important ways:</span></span>  
  
-   <span data-ttu-id="8bf17-302">DAX 函数始终引用完整的列或表。</span><span class="sxs-lookup"><span data-stu-id="8bf17-302">A DAX function always references a complete column or a table.</span></span> <span data-ttu-id="8bf17-303">如果您想要仅使用表或列中的特定值，则可以向公式中添加筛选器。</span><span class="sxs-lookup"><span data-stu-id="8bf17-303">If you want to use only particular values from a table or column, you can add filters to the formula.</span></span>  
  
-   <span data-ttu-id="8bf17-304">如果需要逐行自定义计算，DAX 可提供允许您使用当前行值或相关值作为一种参数来执行计算（因上下文而异）的函数。</span><span class="sxs-lookup"><span data-stu-id="8bf17-304">If you need to customize calculations on a row-by-row basis, DAX provides functions that let you use the current row value or a related value as a kind of parameter, to perform calculations that vary by context.</span></span> <span data-ttu-id="8bf17-305">若要了解这些函数的使用原理，请参阅本主题后面的“DAX 公式中的上下文”。</span><span class="sxs-lookup"><span data-stu-id="8bf17-305">To understand how these functions work, see Context in DAX Formulas later in this topic.</span></span>  
  
-   <span data-ttu-id="8bf17-306">DAX 包含的许多函数都将返回表，而不是返回值。</span><span class="sxs-lookup"><span data-stu-id="8bf17-306">DAX includes many functions that return a table, rather than a value.</span></span> <span data-ttu-id="8bf17-307">表不会显示在报告客户端中，而是用于向其他函数提供输入。</span><span class="sxs-lookup"><span data-stu-id="8bf17-307">The table is not displayed in a reporting client, but is used to provide input to other functions.</span></span> <span data-ttu-id="8bf17-308">例如，您可以检索一个表，然后对该表中的非重复值进行计数，或者计算多个已筛选表或列的动态总和。</span><span class="sxs-lookup"><span data-stu-id="8bf17-308">For example, you can retrieve a table and then count the distinct values in it, or calculate dynamic sums across filtered tables or columns.</span></span>  
  
-   <span data-ttu-id="8bf17-309">\*\* DAX 函数包含多种“时间智能”函数。</span><span class="sxs-lookup"><span data-stu-id="8bf17-309">DAX functions include a variety of *time intelligence* functions.</span></span> <span data-ttu-id="8bf17-310">利用这些函数，您可以定义或选择日期范围，并基于这些日期或范围执行动态计算。</span><span class="sxs-lookup"><span data-stu-id="8bf17-310">These functions let you define or select date ranges, and perform dynamic calculations based on these dates or range.</span></span> <span data-ttu-id="8bf17-311">例如，您可以比较并行时段内的总和。</span><span class="sxs-lookup"><span data-stu-id="8bf17-311">For example, you can compare sums across parallel periods.</span></span>  
  
### <a name="date-and-time-functions"></a><span data-ttu-id="8bf17-312">日期和时间函数</span><span class="sxs-lookup"><span data-stu-id="8bf17-312">Date and Time Functions</span></span>  
 <span data-ttu-id="8bf17-313">DAX 中的日期和时间函数类似于 Microsoft Excel 中的日期和时间函数。</span><span class="sxs-lookup"><span data-stu-id="8bf17-313">The date and time functions in DAX are similar to date and time functions in Microsoft Excel.</span></span> <span data-ttu-id="8bf17-314">但是，DAX 函数基于 Microsoft SQL Server 使用的 `datetime` 数据类型。</span><span class="sxs-lookup"><span data-stu-id="8bf17-314">However, DAX functions are based on the `datetime` data types used by Microsoft SQL Server.</span></span> <span data-ttu-id="8bf17-315">有关详细信息，请参阅[&#40;DAX&#41;的日期和时间函数](/dax/date-and-time-functions-dax)。</span><span class="sxs-lookup"><span data-stu-id="8bf17-315">For more information, see [Date and Time Functions &#40;DAX&#41;](/dax/date-and-time-functions-dax).</span></span>  
  
### <a name="filter-functions"></a><span data-ttu-id="8bf17-316">筛选器函数</span><span class="sxs-lookup"><span data-stu-id="8bf17-316">Filter Functions</span></span>  
 <span data-ttu-id="8bf17-317">DAX 中的筛选器函数可以返回特定数据类型、在相关表中查找值以及按相关值进行筛选。</span><span class="sxs-lookup"><span data-stu-id="8bf17-317">The filter functions in DAX return specific data types, look up values in related tales, and filter by related values.</span></span> <span data-ttu-id="8bf17-318">查找函数通过使用表和关系进行工作，与数据库类似。</span><span class="sxs-lookup"><span data-stu-id="8bf17-318">The lookup functions work by using tables and relationships, like a database.</span></span> <span data-ttu-id="8bf17-319">筛选函数可用于操作数据上下文来创建动态计算。</span><span class="sxs-lookup"><span data-stu-id="8bf17-319">The filtering functions let you manipulate data context to create dynamic calculations.</span></span> <span data-ttu-id="8bf17-320">有关详细信息，请参阅[Filter 函数 &#40;DAX&#41;](/dax/filter-functions-dax)。</span><span class="sxs-lookup"><span data-stu-id="8bf17-320">For more information, see [Filter Functions &#40;DAX&#41;](/dax/filter-functions-dax).</span></span>  
  
### <a name="information-functions"></a><span data-ttu-id="8bf17-321">信息函数</span><span class="sxs-lookup"><span data-stu-id="8bf17-321">Information Functions</span></span>  
 <span data-ttu-id="8bf17-322">信息函数查找作为参数提供的单元格或行，并且指示值是否与预期的类型匹配。</span><span class="sxs-lookup"><span data-stu-id="8bf17-322">An information function looks at the cell or row that is provided as an argument and tells you whether the value matches the expected type.</span></span> <span data-ttu-id="8bf17-323">例如，如果您引用的值包含错误，则 ISERROR 函数将返回 TRUE。</span><span class="sxs-lookup"><span data-stu-id="8bf17-323">For example, the ISERROR function returns TRUE if the value that you reference contains an error.</span></span> <span data-ttu-id="8bf17-324">有关详细信息，请参阅[&#40;DAX&#41;的信息函数](/dax/information-functions-dax)。</span><span class="sxs-lookup"><span data-stu-id="8bf17-324">For more information, see [Information Functions &#40;DAX&#41;](/dax/information-functions-dax).</span></span>  
  
### <a name="logical-functions"></a><span data-ttu-id="8bf17-325">逻辑函数</span><span class="sxs-lookup"><span data-stu-id="8bf17-325">Logical Functions</span></span>  
 <span data-ttu-id="8bf17-326">逻辑函数对表达式执行操作，以返回表达式中有关值的信息。</span><span class="sxs-lookup"><span data-stu-id="8bf17-326">Logical functions act upon an expression to return information about the values in the expression.</span></span> <span data-ttu-id="8bf17-327">例如，TRUE 函数可以让你了解正在计算的表达式是否返回 TRUE 值。</span><span class="sxs-lookup"><span data-stu-id="8bf17-327">For example, the TRUE function lets you know whether an expression that you are evaluating returns a TRUE value.</span></span> <span data-ttu-id="8bf17-328">有关详细信息，请参阅[&#40;DAX&#41;的逻辑函数](/dax/logical-functions-dax)。</span><span class="sxs-lookup"><span data-stu-id="8bf17-328">For more information, see [Logical Functions &#40;DAX&#41;](/dax/logical-functions-dax).</span></span>  
  
### <a name="mathematical-and-trigonometric-functions"></a><span data-ttu-id="8bf17-329">数学和三角函数</span><span class="sxs-lookup"><span data-stu-id="8bf17-329">Mathematical and Trigonometric Functions</span></span>  
 <span data-ttu-id="8bf17-330">DAX 中的数学函数与 Excel 中的数学和三角函数非常相似。</span><span class="sxs-lookup"><span data-stu-id="8bf17-330">The mathematical functions in DAX are very similar to the Excel mathematical and trigonometric functions.</span></span> <span data-ttu-id="8bf17-331">DAX 函数使用的数值数据类型存在一些细微的差别。</span><span class="sxs-lookup"><span data-stu-id="8bf17-331">Some minor differences exist in the numeric data types used by DAX functions.</span></span> <span data-ttu-id="8bf17-332">有关详细信息，请参阅[&#40;DAX&#41;的数学和三角函数](/dax/math-and-trig-functions-dax)。</span><span class="sxs-lookup"><span data-stu-id="8bf17-332">For more information, see [Math and Trig Functions &#40;DAX&#41;](/dax/math-and-trig-functions-dax).</span></span>  
  
### <a name="statistical-functions"></a><span data-ttu-id="8bf17-333">统计函数</span><span class="sxs-lookup"><span data-stu-id="8bf17-333">Statistical Functions</span></span>  
 <span data-ttu-id="8bf17-334">DAX 提供执行聚合的统计函数。</span><span class="sxs-lookup"><span data-stu-id="8bf17-334">DAX provides statistical functions that perform aggregations.</span></span> <span data-ttu-id="8bf17-335">除了求和与平均值或者查找最小值和最大值外，您还可以通过 DAX 在聚合之前筛选列或基于相关表创建聚合。</span><span class="sxs-lookup"><span data-stu-id="8bf17-335">In addition to creating sums and averages, or finding the minimum and maximum values, in DAX you can also filter a column before aggregating or create aggregations based on related tables.</span></span> <span data-ttu-id="8bf17-336">有关详细信息，请参阅[&#40;DAX&#41;的统计函数](/dax/statistical-functions-dax)。</span><span class="sxs-lookup"><span data-stu-id="8bf17-336">For more information, see [Statistical Functions &#40;DAX&#41;](/dax/statistical-functions-dax).</span></span>  
  
### <a name="text-functions"></a><span data-ttu-id="8bf17-337">文本函数</span><span class="sxs-lookup"><span data-stu-id="8bf17-337">Text Functions</span></span>  
 <span data-ttu-id="8bf17-338">DAX 中的文本函数与 Excel 中的同等函数非常相似。</span><span class="sxs-lookup"><span data-stu-id="8bf17-338">The text functions in DAX are very similar to their counterparts in Excel.</span></span> <span data-ttu-id="8bf17-339">可以返回部分字符串、搜索字符串中的文本或连接字符串。</span><span class="sxs-lookup"><span data-stu-id="8bf17-339">You can return part of a string, search for text within a string, or concatenate string values.</span></span> <span data-ttu-id="8bf17-340">DAX 还提供了用于控制日期、时间和数字格式的函数。</span><span class="sxs-lookup"><span data-stu-id="8bf17-340">DAX also provides functions for controlling the formats for dates, times, and numbers.</span></span> <span data-ttu-id="8bf17-341">有关详细信息，请参阅[&#40;DAX&#41;的文本函数](/dax/text-functions-dax)。</span><span class="sxs-lookup"><span data-stu-id="8bf17-341">For more information, see [Text Functions &#40;DAX&#41;](/dax/text-functions-dax).</span></span>  
  
### <a name="time-intelligence-functions"></a><span data-ttu-id="8bf17-342">时间智能函数</span><span class="sxs-lookup"><span data-stu-id="8bf17-342">Time Intelligence Functions</span></span>  
 <span data-ttu-id="8bf17-343">DAX 中提供的时间智能函数允许您创建使用日历和日期的相关内置信息的计算。</span><span class="sxs-lookup"><span data-stu-id="8bf17-343">The time intelligence functions provided in DAX let you create calculations that use built-in knowledge about calendars and dates.</span></span> <span data-ttu-id="8bf17-344">通过将时间和日期范围与聚合或计算结合使用，你可以跨可比时间段为销售、库存等生成有意义的比较。</span><span class="sxs-lookup"><span data-stu-id="8bf17-344">By using time and date ranges in combination with aggregations or calculations, you can build meaningful comparisons across comparable time periods for sales, inventory, and so on.</span></span> <span data-ttu-id="8bf17-345">有关详细信息，请参阅[&#40;DAX&#41;的时间智能函数](/dax/time-intelligence-functions-dax)。</span><span class="sxs-lookup"><span data-stu-id="8bf17-345">For more information, see [Time Intelligence Functions &#40;DAX&#41;](/dax/time-intelligence-functions-dax).</span></span>  
  
###  <a name="table-valued-functions"></a><a name="bkmk_TableFunc"></a><span data-ttu-id="8bf17-346">表值函数</span><span class="sxs-lookup"><span data-stu-id="8bf17-346">Table-Valued Functions</span></span>  
 <span data-ttu-id="8bf17-347">有许多 DAX 函数可输出表并且/或者将表作为输入。</span><span class="sxs-lookup"><span data-stu-id="8bf17-347">There are DAX functions that output tables, take tables as input, or do both.</span></span> <span data-ttu-id="8bf17-348">因为表可以包含单个列，所以表值函数还可以将单个列作为输入。</span><span class="sxs-lookup"><span data-stu-id="8bf17-348">Because a table can have a single column, table-valued functions also take single columns as inputs.</span></span> <span data-ttu-id="8bf17-349">了解如何使用这些表值函数对于充分利用 DAX 公式很重要。</span><span class="sxs-lookup"><span data-stu-id="8bf17-349">Understanding how to use these table-valued functions is important for fully utilizing DAX formulas.</span></span> <span data-ttu-id="8bf17-350">DAX 包括以下类型的表值函数：</span><span class="sxs-lookup"><span data-stu-id="8bf17-350">DAX includes the following types of table-valued functions:</span></span>  
  
 <span data-ttu-id="8bf17-351">**筛选函数** 返回列、表或与当前行相关的值。</span><span class="sxs-lookup"><span data-stu-id="8bf17-351">**Filter functions** Return a column, table, or values related to the current row.</span></span>  
  
 <span data-ttu-id="8bf17-352">**聚合函数** 聚合表中各行上的任何表达式。</span><span class="sxs-lookup"><span data-stu-id="8bf17-352">**Aggregation functions** Aggregate any expression over the rows of a table.</span></span>  
  
 <span data-ttu-id="8bf17-353">**时间智能函数** 返回日期表或使用日期表计算聚合。</span><span class="sxs-lookup"><span data-stu-id="8bf17-353">**Time intelligence functions** Return a table of dates, or use a table of dates to calculate an aggregation.</span></span>  
  
##  <a name="context-in-dax-formulas"></a><a name="bkmk_context"></a><span data-ttu-id="8bf17-354">DAX 公式中的上下文</span><span class="sxs-lookup"><span data-stu-id="8bf17-354">Context in DAX Formulas</span></span>  
 <span data-ttu-id="8bf17-355">\*\* “上下文”是在使用 DAX 创建公式时需要了解的一个重要概念。</span><span class="sxs-lookup"><span data-stu-id="8bf17-355">*Context* is an important concept to understand when creating formulas using DAX.</span></span> <span data-ttu-id="8bf17-356">您可以通过上下文执行动态分析，因为公式的结果会发生更改以反映当前行或单元选择以及任何相关数据。</span><span class="sxs-lookup"><span data-stu-id="8bf17-356">Context is what enables you to perform dynamic analysis, as the results of a formula change to reflect the current row or cell selection and also any related data.</span></span> <span data-ttu-id="8bf17-357">了解上下文并有效使用上下文对构建高性能的动态分析和解决公式中的问题至关重要。</span><span class="sxs-lookup"><span data-stu-id="8bf17-357">Understanding context and using context effectively are critical for building high-performing, dynamic analyses, and for troubleshooting problems in formulas.</span></span>  
  
 <span data-ttu-id="8bf17-358">可以在不同的上下文中计算表格模型中的公式，这取决于其他设计元素：</span><span class="sxs-lookup"><span data-stu-id="8bf17-358">Formulas in tabular models can be evaluated in a different context, depending on other design elements:</span></span>  
  
-   <span data-ttu-id="8bf17-359">数据透视表或报表中应用的筛选器</span><span class="sxs-lookup"><span data-stu-id="8bf17-359">Filters applied in a PivotTable or report</span></span>  
  
-   <span data-ttu-id="8bf17-360">公式中定义的筛选器</span><span class="sxs-lookup"><span data-stu-id="8bf17-360">Filters defined within a formula</span></span>  
  
-   <span data-ttu-id="8bf17-361">使用公式中的特殊函数指定的关系</span><span class="sxs-lookup"><span data-stu-id="8bf17-361">Relationships specified by using special functions within a formula</span></span>  
  
 <span data-ttu-id="8bf17-362">\*\* 有许多类型的上下文：“行上下文” \*\*、“查询上下文” \*\* 和“筛选上下文”。</span><span class="sxs-lookup"><span data-stu-id="8bf17-362">There are different types of context: *row context*, *query context*, and *filter context*.</span></span>  
  
###  <a name="row-context"></a><a name="bkmk_row_context"></a><span data-ttu-id="8bf17-363">行上下文</span><span class="sxs-lookup"><span data-stu-id="8bf17-363">Row Context</span></span>  
 <span data-ttu-id="8bf17-364">可以将*行上下文*视为 "当前行"。</span><span class="sxs-lookup"><span data-stu-id="8bf17-364">*Row context* can be thought of as "the current row".</span></span> <span data-ttu-id="8bf17-365">如果您在计算列中创建某一公式，则该公式的“行上下文”将包括来自当前行中所有列的值。</span><span class="sxs-lookup"><span data-stu-id="8bf17-365">If you create a formula in a calculated column, the row context for that formula includes the values from all columns in the current row.</span></span> <span data-ttu-id="8bf17-366">如果该表与其他表相关，则上下文还包括来自另一个表中与当前行相关的所有值。</span><span class="sxs-lookup"><span data-stu-id="8bf17-366">If the table is related to another table, the content also includes all the values from the other table that are related to the current row.</span></span>  
  
 <span data-ttu-id="8bf17-367">例如，假设创建将同一表中的两列（Freight 和 Tax）的值相加的计算列 `=[Freight] + [Tax]`。</span><span class="sxs-lookup"><span data-stu-id="8bf17-367">For example, suppose you create a calculated column, `=[Freight] + [Tax]`, that adds together values from two columns, Freight and Tax, from the same table.</span></span> <span data-ttu-id="8bf17-368">此公式仅自动获取指定列中当前行的值。</span><span class="sxs-lookup"><span data-stu-id="8bf17-368">This formula automatically gets only the values from the current row in the specified columns.</span></span>  
  
 <span data-ttu-id="8bf17-369">行上下文还会依照已定义的表之间的任何关系（包括使用 DAX 公式在计算列中定义的关系）来确定相关表中与当前行关联的行。</span><span class="sxs-lookup"><span data-stu-id="8bf17-369">Row context also follows any relationships that have been defined between tables, including relationships defined within a calculated column by using DAX formulas, to determine which rows in related tables are associated with the current row.</span></span>  
  
 <span data-ttu-id="8bf17-370">例如，下面的公式使用 RELATED 函数根据订单的发货目的地从相关表提取税金值。</span><span class="sxs-lookup"><span data-stu-id="8bf17-370">For example, the following formula uses the RELATED function to fetch a tax value from a related table, based on the region that the order was shipped to.</span></span> <span data-ttu-id="8bf17-371">通过使用当前表中的区域值，在相关表中查找该区域，然后从相关表中获取该区域的税率，从而确定税金值。</span><span class="sxs-lookup"><span data-stu-id="8bf17-371">The tax value is determined by using the value for region in the current table, looking up the region in the related table, and then getting the tax rate for that region from the related table.</span></span>  
  
```  
= [Freight] + RELATED('Region'[TaxRate])  
```  
  
 <span data-ttu-id="8bf17-372">此公式从 Region 表中获取当前区域的税率，并将其与 Freight 列中的值相加。</span><span class="sxs-lookup"><span data-stu-id="8bf17-372">This formula gets the tax rate for the current region from the Region table and adds it to the value of the Freight column.</span></span> <span data-ttu-id="8bf17-373">在 DAX 公式中，您无需了解或指定连接各表的特定关系。</span><span class="sxs-lookup"><span data-stu-id="8bf17-373">In DAX formulas, you do not need to know or specify the specific relationship that connects the tables.</span></span>  
  
#### <a name="multiple-row-context"></a><span data-ttu-id="8bf17-374">多行上下文</span><span class="sxs-lookup"><span data-stu-id="8bf17-374">Multiple Row Context</span></span>  
 <span data-ttu-id="8bf17-375">DAX 包括对表执行迭代计算的函数。</span><span class="sxs-lookup"><span data-stu-id="8bf17-375">DAX includes functions that iterate calculations over a table.</span></span> <span data-ttu-id="8bf17-376">这些函数可以具有多个当前行，其中每个行都有自己的行上下文。</span><span class="sxs-lookup"><span data-stu-id="8bf17-376">These functions can have multiple current rows, each with its own row context.</span></span>  <span data-ttu-id="8bf17-377">实际上，可以利用这些函数创建用于以递归方式对内部和外部循环进行操作的公式。</span><span class="sxs-lookup"><span data-stu-id="8bf17-377">In essence, these functions let you create formulas that perform operations recursively over an inner and outer loop.</span></span>  
  
 <span data-ttu-id="8bf17-378">例如，假设您的模型包含一个 **Products** 表和一个 **Sales** 表。</span><span class="sxs-lookup"><span data-stu-id="8bf17-378">For example, suppose your model contains a **Products** table and a **Sales** table.</span></span> <span data-ttu-id="8bf17-379">用户可能想要遍历整个 Sales 表，该表中全都是涉及多个产品的交易，并且您还要找到在任何一个交易中为每个产品订购的最大数量。</span><span class="sxs-lookup"><span data-stu-id="8bf17-379">Users might want to go through the entire sales table, which is full of transactions involving multiple products, and find the largest quantity ordered for each product in any one transaction.</span></span>  
  
 <span data-ttu-id="8bf17-380">使用 DAX，您可以生成返回正确值的单个公式，并且只要用户向表中添加数据，结果就自动更新。</span><span class="sxs-lookup"><span data-stu-id="8bf17-380">With DAX you can build a single formula that returns the correct value, and the results are automatically updated any time a user adds data to the tables.</span></span>  
  
```  
=MAXX(FILTER(Sales,[ProdKey]=EARLIER([ProdKey])),Sales[OrderQty])  
```  
  
 <span data-ttu-id="8bf17-381">有关此公式的详细演练，请参阅[前面的函数](/dax/earlier-function-dax)。</span><span class="sxs-lookup"><span data-stu-id="8bf17-381">For a detailed walkthrough of this formula, see the [EARLIER Function](/dax/earlier-function-dax).</span></span>  
  
 <span data-ttu-id="8bf17-382">总之，该 EARLIER 函数存储来自当前运算之前的运算中的行上下文。</span><span class="sxs-lookup"><span data-stu-id="8bf17-382">To summarize, the EARLIER function stores the row context from the operation that preceded the current operation.</span></span> <span data-ttu-id="8bf17-383">在任何时候，该函数都在内存中存储两组上下文：一组上下文表示公式的内部循环的当前行，另一组上下文表示公式的外部循环的当前行。</span><span class="sxs-lookup"><span data-stu-id="8bf17-383">At all times, the function stores in memory two sets of context: one set of context represents the current row for the inner loop of the formula, and another set of context represents the current row for the outer loop of the formula.</span></span> <span data-ttu-id="8bf17-384">DAX 自动在两个循环之间馈送值，以便您可以创建复杂的聚合。</span><span class="sxs-lookup"><span data-stu-id="8bf17-384">DAX automatically feeds values between the two loops so that you can create complex aggregates.</span></span>  
  
####  <a name="query-context"></a><a name="bkmk_query_context"></a><span data-ttu-id="8bf17-385">查询上下文</span><span class="sxs-lookup"><span data-stu-id="8bf17-385">Query Context</span></span>  
 <span data-ttu-id="8bf17-386">\*\* “查询上下文”是指为公式隐式检索的数据子集。</span><span class="sxs-lookup"><span data-stu-id="8bf17-386">*Query context* refers to the subset of data that is implicitly retrieved for a formula.</span></span> <span data-ttu-id="8bf17-387">当用户将度量值字段或其他值字段放入数据透视表或基于表格模型的报表后，引擎将检查行和列标题、切片器和报表筛选器以便确定上下文。</span><span class="sxs-lookup"><span data-stu-id="8bf17-387">When a user places a measure or other value field into a PivotTable or into a report based on a tabular model, the engine examines the row and column headers, Slicers, and report filters to determine the context.</span></span> <span data-ttu-id="8bf17-388">之后，将对数据源运行必要的查询以获取正确的数据子集，执行公式所定义的计算，然后填充数据透视表或报表中的每个单元。</span><span class="sxs-lookup"><span data-stu-id="8bf17-388">Then, the necessary queries are run against the data source to get the correct subset of data, make the calculations defined by the formula, and then populate each cell in the PivotTable or report.</span></span> <span data-ttu-id="8bf17-389">检索的数据集是各单元的查询上下文。</span><span class="sxs-lookup"><span data-stu-id="8bf17-389">The set of data that is retrieved is the query context for each cell.</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="8bf17-390">对于 DirectQuery 模式中的模型，先计算上下文，然后将用于检索正确的数据子集并计算结果的集运算转换为 SQL 语句。</span><span class="sxs-lookup"><span data-stu-id="8bf17-390">For a model in DirectQuery mode, the context is evaluated, and then the set operations to retrieve the correct subset of data and calculate the results are translated to SQL statements.</span></span> <span data-ttu-id="8bf17-391">随后直接对关系数据存储区运行这些语句。</span><span class="sxs-lookup"><span data-stu-id="8bf17-391">Those statements are then directly run against the relational data store.</span></span> <span data-ttu-id="8bf17-392">因此，虽然用于获取数据并计算结果的方法是不同的，但上下文本身不会更改。</span><span class="sxs-lookup"><span data-stu-id="8bf17-392">Therefore, although the method of getting the data and calculating the results is different, the context itself does not change.</span></span>  
  
 <span data-ttu-id="8bf17-393">由于上下文会随公式位置的不同而不同，因此，公式的结果可能随之更改。</span><span class="sxs-lookup"><span data-stu-id="8bf17-393">Because context changes depending on where you place the formula, the results of the formula can also change.</span></span>  
  
 <span data-ttu-id="8bf17-394">例如，假设您创建下面的简单公式，用来计算 **Sales** 表的 **Profit** 列中的各值之和： `=SUM('Sales'[Profit])`。</span><span class="sxs-lookup"><span data-stu-id="8bf17-394">For example, suppose you create a formula that sums the values in the **Profit** column of the **Sales** table: `=SUM('Sales'[Profit])`.</span></span>  <span data-ttu-id="8bf17-395">如果您在 **Sales** 表内的计算列中使用该公式，则该公式的结果对于整个表将是相同的，因为公式的查询上下文始终是 **Sales** 表的整个数据集。</span><span class="sxs-lookup"><span data-stu-id="8bf17-395">If you use this formula in a calculated column within the **Sales** table, the results for the formula will be the same for the entire table, because the query context for the formula is always the entire data set of the **Sales** table.</span></span> <span data-ttu-id="8bf17-396">结果会包含所有地区、所有产品、所有年份等的利润。</span><span class="sxs-lookup"><span data-stu-id="8bf17-396">Results will have profit for all regions, all products, all years, and so on.</span></span>  
  
 <span data-ttu-id="8bf17-397">但是，用户通常不想数百次看到相同的结果，而是希望获取特定年份、特定国家/地区、特定产品或这些项的某些组合的利润，然后获取总计。</span><span class="sxs-lookup"><span data-stu-id="8bf17-397">However, users typically don't want to see the same result hundreds of times, but instead want to get the profit for a particular year, a particular country, a particular product, or some combination of these, and then get a grand total.</span></span>  
  
 <span data-ttu-id="8bf17-398">在数据透视表中，可以通过添加或删除列和行标题以及添加或删除切片器来更改上下文。</span><span class="sxs-lookup"><span data-stu-id="8bf17-398">In a PivotTable, context can be changed by adding or removing column and row headers and by adding or removing Slicers.</span></span> <span data-ttu-id="8bf17-399">只要用户将列或行标题添加到数据透视表中，就可以更改在其中计算度量值的查询上下文。</span><span class="sxs-lookup"><span data-stu-id="8bf17-399">Whenever users add column or row headings to the PivotTable, they change the query context in which the measure is evaluated.</span></span> <span data-ttu-id="8bf17-400">切片和筛选运算也会影响上下文。</span><span class="sxs-lookup"><span data-stu-id="8bf17-400">Slicing and filtering operations also affect context.</span></span> <span data-ttu-id="8bf17-401">\*\* 因此，对于每个单元，在不同的“查询上下文”中计算在度量值中使用的相同公式。</span><span class="sxs-lookup"><span data-stu-id="8bf17-401">Therefore, the same formula, used in a measure, is evaluated in a different *query context* for each cell.</span></span>  
  
####  <a name="filter-context"></a><a name="bkmk_filter_context"></a><span data-ttu-id="8bf17-402">筛选上下文</span><span class="sxs-lookup"><span data-stu-id="8bf17-402">Filter Context</span></span>  
 <span data-ttu-id="8bf17-403">\*\* “筛选上下文”是指每个列中允许存在的一组值，或可属于从相关表中检索到的值的一组值。</span><span class="sxs-lookup"><span data-stu-id="8bf17-403">*Filter context* is the set of values allowed in each column, or in the values retrieved from a related table.</span></span> <span data-ttu-id="8bf17-404">可以对设计器或表示层（报表和数据透视表）中的列应用筛选器。</span><span class="sxs-lookup"><span data-stu-id="8bf17-404">Filters can be applied to the column in the designer, or in the presentation layer (reports and PivotTables).</span></span> <span data-ttu-id="8bf17-405">也可以通过公式中的筛选表达式来显式定义筛选器。</span><span class="sxs-lookup"><span data-stu-id="8bf17-405">Filters can also be defined explicitly by filter expressions within the formula.</span></span>  
  
 <span data-ttu-id="8bf17-406">通过在公式中使用参数，为列或表中允许存在的值集指定筛选约束时，将添加“筛选上下文”。</span><span class="sxs-lookup"><span data-stu-id="8bf17-406">Filter context is added when you specify filter constraints on the set of values allowed in a column or table, by using arguments to a formula.</span></span> <span data-ttu-id="8bf17-407">基于其他上下文（如行上下文或查询上下文）应用筛选上下文。</span><span class="sxs-lookup"><span data-stu-id="8bf17-407">Filter context applies on top of other contexts, such as row context or query context.</span></span>  
  
 <span data-ttu-id="8bf17-408">在表格模型中，可通过多种方式来创建筛选上下文。</span><span class="sxs-lookup"><span data-stu-id="8bf17-408">In tabular models, there are many ways to create filter context.</span></span> <span data-ttu-id="8bf17-409">在可使用该模型的客户端的上下文（如 [!INCLUDE[ssCrescent](../../includes/sscrescent-md.md)] 报表）中，用户可以随时通过在行和列标题上添加切片器或报表筛选器来创建筛选器。</span><span class="sxs-lookup"><span data-stu-id="8bf17-409">Within the context of clients that can consume the model, such as [!INCLUDE[ssCrescent](../../includes/sscrescent-md.md)] reports, users can create filters on the fly by adding slicers or report filters on the row and column headings.</span></span> <span data-ttu-id="8bf17-410">还可以在公式中直接指定筛选表达式来执行以下操作：指定相关的值、筛选用作输入的表或动态获取计算中使用的值的上下文。</span><span class="sxs-lookup"><span data-stu-id="8bf17-410">You can also specify filter expressions directly within the formula, to specify related values, to filter tables that are used as inputs, or to dynamically get context for the values that are used in calculations.</span></span> <span data-ttu-id="8bf17-411">您还可以完全清除或有选择地清除特定列上的筛选器。</span><span class="sxs-lookup"><span data-stu-id="8bf17-411">You can also completely clear or selectively clear the filters on particular columns.</span></span> <span data-ttu-id="8bf17-412">这在创建用于计算总计的公式时很有用。</span><span class="sxs-lookup"><span data-stu-id="8bf17-412">This is very useful when creating formulas that calculate grand totals.</span></span>  
  
 <span data-ttu-id="8bf17-413">有关如何在公式内创建筛选器的详细信息，请参阅[FILTER 函数](/dax/filter-function-dax)。</span><span class="sxs-lookup"><span data-stu-id="8bf17-413">For more information about how to create filters within formulas, see the [FILTER Function](/dax/filter-function-dax).</span></span>  
  
 <span data-ttu-id="8bf17-414">有关如何清除筛选器以便创建总计的示例，请参阅[ALL 函数](/dax/all-function-dax)。</span><span class="sxs-lookup"><span data-stu-id="8bf17-414">For an example of how filters can be cleared to create grand totals, see the [ALL Function](/dax/all-function-dax).</span></span>  
  
 <span data-ttu-id="8bf17-415">有关如何在公式内有选择地清除和应用筛选器的示例，请参阅[ALLEXCEPT 函数](/dax/allexcept-function-dax)。</span><span class="sxs-lookup"><span data-stu-id="8bf17-415">For examples of how to selectively clear and apply filters within formulas, see the [ALLEXCEPT Function](/dax/allexcept-function-dax).</span></span>  
  
####  <a name="determining-context-in-formulas"></a><a name="bkmk_determine_context"></a><span data-ttu-id="8bf17-416">确定公式中的上下文</span><span class="sxs-lookup"><span data-stu-id="8bf17-416">Determining Context in Formulas</span></span>  
 <span data-ttu-id="8bf17-417">在创建一个 DAX 公式时，首先会测试该公式的语法是否有效，然后测试该公式以确保其包含的列和表的名称位于当前上下文中。</span><span class="sxs-lookup"><span data-stu-id="8bf17-417">When you create a DAX formula, the formula is first tested for valid syntax, and then tested to make sure the names of the columns and tables included in the formula can be found in the current context.</span></span> <span data-ttu-id="8bf17-418">如果找不到该公式指定的任一列或表，则将返回错误。</span><span class="sxs-lookup"><span data-stu-id="8bf17-418">If any column or table specified by the formula cannot be found, an error is returned.</span></span>  
  
 <span data-ttu-id="8bf17-419">如前所述，通过使用模型中的可用表、表之间的所有关系和所应用的所有筛选器来确定验证（和重新计算操作）期间的上下文。</span><span class="sxs-lookup"><span data-stu-id="8bf17-419">Context during validation (and recalculation operations) is determined as described in the preceding sections, by using the available tables in the model, any relationships between the tables, and any filters that have been applied.</span></span>  
  
 <span data-ttu-id="8bf17-420">例如，如果刚刚将一些数据导入到一个新表中，而该表未与任何其他表关联（并且尚未应用任何筛选器），则当前上下文\*\* 是表中的完整列集。</span><span class="sxs-lookup"><span data-stu-id="8bf17-420">For example, if you have just imported some data into a new table and it is not related to any other tables (and you have not applied any filters), the *current context* is the entire set of columns in the table.</span></span> <span data-ttu-id="8bf17-421">如果通过关系将该表与其他表链接，则当前上下文将包括相关的表。</span><span class="sxs-lookup"><span data-stu-id="8bf17-421">If the table is linked by relationships to other tables, the current context includes the related tables.</span></span> <span data-ttu-id="8bf17-422">如果将该表中的某个列添加到一个报表中，该报表具有切片器并且可能具有一些报表筛选器，则公式的上下文是报表的每个单元中的数据子集。</span><span class="sxs-lookup"><span data-stu-id="8bf17-422">If you add a column from the table to a report that has Slicers and maybe some report filters, the context for the formula is the subset of data in each cell of the report.</span></span>  
  
 <span data-ttu-id="8bf17-423">上下文是一个很有用的概念，但也可能导致很难排除公式问题。</span><span class="sxs-lookup"><span data-stu-id="8bf17-423">Context is a powerful concept that can also make it difficult to troubleshoot formulas.</span></span> <span data-ttu-id="8bf17-424">我们建议您从简单的公式和关系入手，了解上下文的工作原理。</span><span class="sxs-lookup"><span data-stu-id="8bf17-424">We recommend that you begin with simple formulas and relationships to see how context works.</span></span> <span data-ttu-id="8bf17-425">下一节提供了一些示例，说明公式如何使用不同类型的上下文来动态返回结果。</span><span class="sxs-lookup"><span data-stu-id="8bf17-425">The following section provides some examples of how formulas use different types of context to dynamically return results.</span></span>  
  
##### <a name="examples-of-context-in-formulas"></a><span data-ttu-id="8bf17-426">公式中上下文的示例</span><span class="sxs-lookup"><span data-stu-id="8bf17-426">Examples of Context in Formulas</span></span>  
  
1.  <span data-ttu-id="8bf17-427">[相关函数](/dax/related-function-dax)函数展开当前行的上下文以包括相关列中的值。</span><span class="sxs-lookup"><span data-stu-id="8bf17-427">The [RELATED Function](/dax/related-function-dax) function expands the context of the current row to include values in a related column.</span></span> <span data-ttu-id="8bf17-428">这允许您执行查找。</span><span class="sxs-lookup"><span data-stu-id="8bf17-428">This lets you perform lookups.</span></span> <span data-ttu-id="8bf17-429">该主题中的示例阐释筛选和行上下文的交互情况。</span><span class="sxs-lookup"><span data-stu-id="8bf17-429">The example in this topic illustrates the interaction of filtering and row context.</span></span>  
  
2.  <span data-ttu-id="8bf17-430">[FILTER function](/dax/filter-function-dax)函数允许您指定要包含在当前上下文中的行。</span><span class="sxs-lookup"><span data-stu-id="8bf17-430">The [FILTER Function](/dax/filter-function-dax) function lets you specify the rows to include in the current context.</span></span> <span data-ttu-id="8bf17-431">该主题中的示例还演示如何在执行聚合的其他函数内嵌入筛选器。</span><span class="sxs-lookup"><span data-stu-id="8bf17-431">The examples in this topic also illustrate how to embed filters within other functions that perform aggregates.</span></span>  
  
3.  <span data-ttu-id="8bf17-432">[ALL 函数](/dax/all-function-dax)函数在公式中设置上下文。</span><span class="sxs-lookup"><span data-stu-id="8bf17-432">The [ALL Function](/dax/all-function-dax) function sets context within a formula.</span></span> <span data-ttu-id="8bf17-433">使用此函数可以覆盖因查询上下文而应用的筛选器。</span><span class="sxs-lookup"><span data-stu-id="8bf17-433">You can use it to override filters that are applied as result of query context.</span></span>  
  
4.  <span data-ttu-id="8bf17-434">[ALLEXCEPT 函数](/dax/allexcept-function-dax)函数允许删除除指定的筛选器之外的所有筛选器。</span><span class="sxs-lookup"><span data-stu-id="8bf17-434">The [ALLEXCEPT Function](/dax/allexcept-function-dax) function lets you remove all filters except one that you specify.</span></span> <span data-ttu-id="8bf17-435">以上两个主题包括的示例将引导您构建公式和了解复杂的上下文。</span><span class="sxs-lookup"><span data-stu-id="8bf17-435">Both topics include examples that walk you through building formulas and understanding complex contexts.</span></span>  
  
5.  <span data-ttu-id="8bf17-436">使用[早期函数](/dax/earlier-function-dax)函数和[最早函数](/dax/earliest-function-dax)函数可以通过执行计算来循环遍历表，同时引用内部循环中的值。</span><span class="sxs-lookup"><span data-stu-id="8bf17-436">The [EARLIER Function](/dax/earlier-function-dax) and [EARLIEST Function](/dax/earliest-function-dax) functions let you loop through tables by performing calculations, while referencing a value from an inner loop.</span></span> <span data-ttu-id="8bf17-437">如果您熟悉递归的概念以及内部循环和外部循环，将领会到 EARLIER 和 EARLIEST 函数所提供的强大功能。</span><span class="sxs-lookup"><span data-stu-id="8bf17-437">If you are familiar with the concept of recursion and with inner and outer loops, you will appreciate the power that the EARLIER and EARLIEST functions provide.</span></span> <span data-ttu-id="8bf17-438">如果这些概念对您来说是全新的，则应仔细按照示例中的步骤执行，以便了解如何在计算中使用内部上下文和外部上下文。</span><span class="sxs-lookup"><span data-stu-id="8bf17-438">If you are new to these concepts, you should follow the steps in the example carefully to see how the inner and outer contexts are used in calculations.</span></span>  
  
##  <a name="formulas-and-the-tabular-model"></a><a name="bkmk_RelModel"></a><span data-ttu-id="8bf17-439">公式和表格模型</span><span class="sxs-lookup"><span data-stu-id="8bf17-439">Formulas and the Tabular Model</span></span>  
 <span data-ttu-id="8bf17-440">模型设计器（位于 [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)]中）是一个区域，您可以在其中处理多个数据表，并连接表格模型中的这些表。</span><span class="sxs-lookup"><span data-stu-id="8bf17-440">The model designer, in [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)], is an area where you can work with multiple tables of data and connect the tables in a tabular model.</span></span> <span data-ttu-id="8bf17-441">在此模型内，表通过具有公用值（键）的各列之间的关系联接起来。</span><span class="sxs-lookup"><span data-stu-id="8bf17-441">Within this model, tables are joined by relationships on columns with common values (keys).</span></span> <span data-ttu-id="8bf17-442">利用表格模型，您可以将值链接到其他表中的列，从而创建更有趣的计算。</span><span class="sxs-lookup"><span data-stu-id="8bf17-442">The tabular model lets you link values to columns in other tables and create more interesting calculations.</span></span> <span data-ttu-id="8bf17-443">正如在关系数据库中一样，您可以连接多个级别的关系表，也可以在结果中使用任何表中的列。</span><span class="sxs-lookup"><span data-stu-id="8bf17-443">Just as in a relational database, you can connect many levels of related tables and use columns from any of the tables in the results.</span></span>  
  
 <span data-ttu-id="8bf17-444">例如，您可以链接销售表、产品表和产品类别表，用户可以在数据透视表和报表中使用列的各种组合。</span><span class="sxs-lookup"><span data-stu-id="8bf17-444">For example, you can link a sales table, a products table, and a product categories table, and users can use various combinations of the columns in PivotTables and reports.</span></span> <span data-ttu-id="8bf17-445">关系字段可用于对连接的表进行筛选，或针对子集创建计算。</span><span class="sxs-lookup"><span data-stu-id="8bf17-445">Related fields can be used to filter connected tables, or to create calculations over subsets.</span></span> <span data-ttu-id="8bf17-446">（如果不熟悉关系数据库以及表和联接的用法，请参阅[关系（SSAS 表格）](relationships-ssas-tabular.md)。）</span><span class="sxs-lookup"><span data-stu-id="8bf17-446">(If you are not familiar with relational database and working with tables and joins, see [Relationships &#40;SSAS Tabular&#41;](relationships-ssas-tabular.md).)</span></span>  
  
 <span data-ttu-id="8bf17-447">表格模型支持表之间的多种关系。</span><span class="sxs-lookup"><span data-stu-id="8bf17-447">Tabular models support multiple relationships among tables.</span></span> <span data-ttu-id="8bf17-448">为避免混淆或结果错误，每次只将一个关系指定为活动关系，但您可以根据需要更改活动关系以便遍历计算数据中的不同连接。</span><span class="sxs-lookup"><span data-stu-id="8bf17-448">To avoid confusion or wrong results, only one relationship at a time is designated as the active relationship, but you can change the active relationship as necessary to traverse different connections in the data in calculations.</span></span> <span data-ttu-id="8bf17-449">[&#40;DAX&#41;的 USERELATIONSHIP 函数](/dax/userelationship-function-dax)可用于指定一个或多个要在特定计算中使用的关系。</span><span class="sxs-lookup"><span data-stu-id="8bf17-449">The [USERELATIONSHIP Function &#40;DAX&#41;](/dax/userelationship-function-dax) can be used to specify one or more relationships to be used in a specific calculation.</span></span>  
  
 <span data-ttu-id="8bf17-450">在表格模型中，您应遵守以下公式设计规则：</span><span class="sxs-lookup"><span data-stu-id="8bf17-450">In a tabular model, you should observe these formula design rules:</span></span>  
  
-   <span data-ttu-id="8bf17-451">在通过关系连接表时，必须确保用作键的两列具有匹配的值。</span><span class="sxs-lookup"><span data-stu-id="8bf17-451">When tables are connected by a relationship, you must ensure that the two columns used as keys have values that match.</span></span> <span data-ttu-id="8bf17-452">但不强制引用完整性，因此有可能在键列中具有不匹配值的情况下仍创建关系。</span><span class="sxs-lookup"><span data-stu-id="8bf17-452">Referential integrity is not enforced, however; therefore it is possible to have non-matching values in a key column and still create a relationship.</span></span> <span data-ttu-id="8bf17-453">如果发生这种情况，您应注意空值或不匹配值可能会影响公式的结果。</span><span class="sxs-lookup"><span data-stu-id="8bf17-453">If this happens, you should be aware that blank values or non-matching values might affect the results of formulas.</span></span>  
  
-   <span data-ttu-id="8bf17-454">\*\* 使用关系在模型中链接表时，可以扩大公式的计算范围（或“上下文”）。</span><span class="sxs-lookup"><span data-stu-id="8bf17-454">When you link tables in your model by using relationships, you enlarge the scope, or *context*, in which your formulas are evaluated.</span></span> <span data-ttu-id="8bf17-455">因添加新表、新关系或因活动关系改变而引起的上下文变化可能会导致结果发生意外变化。</span><span class="sxs-lookup"><span data-stu-id="8bf17-455">Changes in context resulting from the addition of new tables, new relationships, or from changes in the active relationship can cause your results to change in ways that you might not anticipate.</span></span> <span data-ttu-id="8bf17-456">有关详细信息，请参阅本主题前面的 [DAX 公式中的上下文](#bkmk_context) 。</span><span class="sxs-lookup"><span data-stu-id="8bf17-456">For more information, see [Context in DAX Formulas](#bkmk_context) earlier in this topic.</span></span>  
  
##  <a name="working-with-tables-and-columns"></a><a name="bkmk_tables"></a><span data-ttu-id="8bf17-457">使用表和列</span><span class="sxs-lookup"><span data-stu-id="8bf17-457">Working with Tables and Columns</span></span>  
 <span data-ttu-id="8bf17-458">表格模型中的表在外观上与 Excel 表类似，但在处理数据和公式的方式上却有所不同：</span><span class="sxs-lookup"><span data-stu-id="8bf17-458">Tables in tabular models look like Excel tables, but are different in the way they work with data and with formulas:</span></span>  
  
-   <span data-ttu-id="8bf17-459">公式只使用表和列，而不使用各个单元格、范围引用或数组。</span><span class="sxs-lookup"><span data-stu-id="8bf17-459">Formulas work only with tables and columns, not with individual cells, range references, or arrays.</span></span>  
  
-   <span data-ttu-id="8bf17-460">公式可以使用关系从相关表中获取值。</span><span class="sxs-lookup"><span data-stu-id="8bf17-460">Formulas can use relationships to get values from related tables.</span></span> <span data-ttu-id="8bf17-461">检索到的值始终与当前行值相关。</span><span class="sxs-lookup"><span data-stu-id="8bf17-461">The values that are retrieved are always related to the current row value.</span></span>  
  
-   <span data-ttu-id="8bf17-462">您不能像在 Excel 工作表中一样使用不规则或“不齐整”的数据。</span><span class="sxs-lookup"><span data-stu-id="8bf17-462">You cannot have irregular or "ragged" data like you can in an Excel worksheet.</span></span> <span data-ttu-id="8bf17-463">表中每行所包含的列数必须相同。</span><span class="sxs-lookup"><span data-stu-id="8bf17-463">Each row in a table must contain the same number of columns.</span></span> <span data-ttu-id="8bf17-464">然而，一些列中可以包含空值。</span><span class="sxs-lookup"><span data-stu-id="8bf17-464">However, you can have empty values in some columns.</span></span> <span data-ttu-id="8bf17-465">Excel 数据表和表格模型数据表不能互换。</span><span class="sxs-lookup"><span data-stu-id="8bf17-465">Excel data tables and tabular model data tables are not interchangeable.</span></span>  
  
-   <span data-ttu-id="8bf17-466">由于为每列都设置了数据类型，该列中的每个值必须同属一种类型。</span><span class="sxs-lookup"><span data-stu-id="8bf17-466">Because a data type is set for each column, each value in that column must be of the same type.</span></span>  
  
### <a name="referring-to-tables-and-columns-in-formulas"></a><span data-ttu-id="8bf17-467">在公式中引用表和列</span><span class="sxs-lookup"><span data-stu-id="8bf17-467">Referring to Tables and Columns in Formulas</span></span>  
 <span data-ttu-id="8bf17-468">可以通过名称来引用任何表和列。</span><span class="sxs-lookup"><span data-stu-id="8bf17-468">You can refer to any table and column by using its name.</span></span> <span data-ttu-id="8bf17-469">\*\* 例如，下面的公式说明如何通过使用“完全限定”的名称来引用两个表中的列：</span><span class="sxs-lookup"><span data-stu-id="8bf17-469">For example, the following formula illustrates how to refer to columns from two tables by using the *fully qualified* name:</span></span>  
  
```  
=SUM('New Sales'[Amount]) + SUM('Past Sales'[Amount])  
```  
  
 <span data-ttu-id="8bf17-470">计算公式时，模型设计器首先检查常规语法，然后根据当前上下文中的可能列和表检查所提供的列和表的名称。</span><span class="sxs-lookup"><span data-stu-id="8bf17-470">When a formula is evaluated, the model designer first checks for general syntax, and then checks the names of columns and tables that you provide against possible columns and tables in the current context.</span></span> <span data-ttu-id="8bf17-471">如果名称不明确或者列或表无法找到，则您将收到有关公式的错误（在发生错误的单元格中，用 #ERROR 字符串代替数据值）。</span><span class="sxs-lookup"><span data-stu-id="8bf17-471">If the name is ambiguous or if the column or table cannot be found, you will get an error on your formula (an #ERROR string instead of a data value in cells where the error occurs).</span></span> <span data-ttu-id="8bf17-472">有关表、列和其他对象的命名要求的详细信息，请参阅[PowerPivot 的 DAX 语法规范](/dax/dax-syntax-reference)中的 "命名要求"。</span><span class="sxs-lookup"><span data-stu-id="8bf17-472">For more information about naming requirements for tables, columns, and other objects, see "Naming Requirements" in [DAX Syntax Specification for PowerPivot](/dax/dax-syntax-reference).</span></span>  
  
### <a name="table-relationships"></a><span data-ttu-id="8bf17-473">表关系</span><span class="sxs-lookup"><span data-stu-id="8bf17-473">Table Relationships</span></span>  
 <span data-ttu-id="8bf17-474">通过创建表之间的关系，可以在另一个表中查找数据，并使用相关值来执行复杂计算。</span><span class="sxs-lookup"><span data-stu-id="8bf17-474">By creating relationships between tables, you gain the ability to look up data in another table and use related values to perform complex calculations.</span></span> <span data-ttu-id="8bf17-475">例如，可以使用计算列来查找与当前分销商相关的所有装运记录，然后对每个分销商的装运成本求和。</span><span class="sxs-lookup"><span data-stu-id="8bf17-475">For example, you can use a calculated column to look up all the shipping records related to the current reseller, and then sum the shipping costs for each.</span></span> <span data-ttu-id="8bf17-476">但在许多情况下，关系可能没有必要。</span><span class="sxs-lookup"><span data-stu-id="8bf17-476">In many cases, however, a relationship might not be necessary.</span></span> <span data-ttu-id="8bf17-477">可以在公式中使用 LOOKUPVALUE 函数为满足在 search_column\*\* 和 search_value\*\* 参数中指定的条件的行返回 result_columnName\*\* 中的值。</span><span class="sxs-lookup"><span data-stu-id="8bf17-477">You can use the LOOKUPVALUE function in a formula to return the value in *result_columnName* for the row that meets criteria specified in the *search_column* and *search_value* parameters.</span></span>  
  
 <span data-ttu-id="8bf17-478">很多 DAX 函数都要求两个表或多个表之间存在关系，以便定位所引用的列并返回有意义的结果。</span><span class="sxs-lookup"><span data-stu-id="8bf17-478">Many DAX functions require that a relationship exist between the tables, or among multiple tables, in order to locate the columns that you have referenced and return results that make sense.</span></span> <span data-ttu-id="8bf17-479">其他函数将尝试确定关系；但是，为获得最佳结果，您始终应尽量创建关系。</span><span class="sxs-lookup"><span data-stu-id="8bf17-479">Other functions will attempt to identify the relationship; however, for best results you should always create a relationship where possible.</span></span> <span data-ttu-id="8bf17-480">有关详细信息，请参阅本主题前面的 [公式和表格模型](#bkmk_RelModel) 。</span><span class="sxs-lookup"><span data-stu-id="8bf17-480">For more information, see [Formulas and the Tabular Model](#bkmk_RelModel) earlier in this topic.</span></span>  
  
##  <a name="updating-the-results-of-formulas-process"></a><a name="bkmk_RefreshRecalc"></a><span data-ttu-id="8bf17-481">更新公式的结果 (处理) </span><span class="sxs-lookup"><span data-stu-id="8bf17-481">Updating the Results of Formulas (Process)</span></span>  
 <span data-ttu-id="8bf17-482">\*\* “数据处理” \*\* 和“重新计算”是两个独立但相关的操作。</span><span class="sxs-lookup"><span data-stu-id="8bf17-482">*Data process* and *recalculation* are two separate but related operations.</span></span> <span data-ttu-id="8bf17-483">在设计包含复杂公式、大量数据或从外部数据源获取的数据的模型时，应充分了解这些概念。</span><span class="sxs-lookup"><span data-stu-id="8bf17-483">You should thoroughly understand these concepts when designing a model that contains complex formulas, large amounts of data, or data that is obtained from external data sources.</span></span>  
  
 <span data-ttu-id="8bf17-484">\*\* “处理数据”是用外部数据源的新数据更新模型中数据的过程。</span><span class="sxs-lookup"><span data-stu-id="8bf17-484">*Processing data* is the process of updating the data in a model with new data from an external data source.</span></span>  
  
 <span data-ttu-id="8bf17-485">\*\* “重新计算”是对公式结果进行更新的过程，用于反映对公式本身的任何更改以及基础数据中的更改。</span><span class="sxs-lookup"><span data-stu-id="8bf17-485">*Recalculation* is the process of updating the results of formulas to reflect any changes to the formulas themselves and to reflect changes in the underlying data.</span></span> <span data-ttu-id="8bf17-486">重新计算会以下列方式影响性能：</span><span class="sxs-lookup"><span data-stu-id="8bf17-486">Recalculation can affect performance in the following ways:</span></span>  
  
-   <span data-ttu-id="8bf17-487">对计算列中的值进行计算并存储在模型中。</span><span class="sxs-lookup"><span data-stu-id="8bf17-487">The values in a calculated column are computed and stored in the model.</span></span> <span data-ttu-id="8bf17-488">若要更新计算列中的值，则必须使用以下三个处理命令之一处理该模型： "处理全部"、"处理数据" 或 "处理重新计算"。</span><span class="sxs-lookup"><span data-stu-id="8bf17-488">To update the values in the calculated column, you must process the model using one of three processing commands - Process Full, Process Data, or Process Recalc.</span></span> <span data-ttu-id="8bf17-489">每当您更改公式时，必须始终针对整个列重新计算公式的结果。</span><span class="sxs-lookup"><span data-stu-id="8bf17-489">The result of the formula must always be recalculated for the entire column, whenever you change the formula.</span></span>  
  
-   <span data-ttu-id="8bf17-490">每当用户向数据透视表添加度量值或打开报告时，系统都会动态计算由该度量值计算的值；当用户修改上下文时，度量值所返回的值将发生变化。</span><span class="sxs-lookup"><span data-stu-id="8bf17-490">The values calculated by measures are dynamically evaluated whenever a user adds the measure to a pivot table or open a report; as the user modifies the context, values returned by the measure change.</span></span> <span data-ttu-id="8bf17-491">度量值的结果将始终反映内存中缓存中的最新内容。</span><span class="sxs-lookup"><span data-stu-id="8bf17-491">The results of the measure always reflect the latest in the in-memory cache.</span></span>  
  
 <span data-ttu-id="8bf17-492">处理和重新计算对行筛选器公式没有影响，除非重新计算的结果返回不同的值，致使角色成员能够查询或不能查询该行。</span><span class="sxs-lookup"><span data-stu-id="8bf17-492">Processing and recalculation have no effect on row filter formulas unless the result of a recalculation returns a different value, thus making the row queryable or not queryable by role members.</span></span>  
  
 <span data-ttu-id="8bf17-493">有关详细信息，请参阅 [处理数据（SSAS 表格）](../process-data-ssas-tabular.md)。</span><span class="sxs-lookup"><span data-stu-id="8bf17-493">For more information, see [Process Data &#40;SSAS Tabular&#41;](../process-data-ssas-tabular.md).</span></span>  
  
##  <a name="troubleshooting-errors-in-formulas"></a><a name="bkmk_troubleshoot"></a><span data-ttu-id="8bf17-494">解决公式中的错误</span><span class="sxs-lookup"><span data-stu-id="8bf17-494">Troubleshooting Errors in Formulas</span></span>  
 <span data-ttu-id="8bf17-495">\*\* 如果在定义公式时遇到错误，公式可能会包含“语法错误” \*\*、“语义错误” \*\* 或“计算错误”。</span><span class="sxs-lookup"><span data-stu-id="8bf17-495">If you get an error when defining a formula, the formula might contain either a *syntactic error*, *semantic error*, or *calculation error*.</span></span>  
  
 <span data-ttu-id="8bf17-496">语法错误最容易解决。</span><span class="sxs-lookup"><span data-stu-id="8bf17-496">Syntactic errors are the easiest to resolve.</span></span> <span data-ttu-id="8bf17-497">它们通常涉及缺少括号或逗号。</span><span class="sxs-lookup"><span data-stu-id="8bf17-497">They typically involve a missing parenthesis or comma.</span></span> <span data-ttu-id="8bf17-498">有关单独函数的语法的帮助，请参阅 [DAX 函数参考](/dax/dax-function-reference)。</span><span class="sxs-lookup"><span data-stu-id="8bf17-498">For help with the syntax of individual functions, see [DAX Function Reference](/dax/dax-function-reference).</span></span>  
  
 <span data-ttu-id="8bf17-499">在语法无误时发生其他类型的错误，但引用的值或列在公式的上下文中没有意义。</span><span class="sxs-lookup"><span data-stu-id="8bf17-499">The other type of error occurs when the syntax is correct, but the value or the column referenced does not make sense in the context of the formula.</span></span> <span data-ttu-id="8bf17-500">此类语义和计算错误可能是由于下列任何问题导致的：</span><span class="sxs-lookup"><span data-stu-id="8bf17-500">Such semantic and calculation errors might be caused by any of the following problems:</span></span>  
  
-   <span data-ttu-id="8bf17-501">公式中引用不存在的列、表或函数。</span><span class="sxs-lookup"><span data-stu-id="8bf17-501">The formula refers to a non-existing column, table, or function.</span></span>  
  
-   <span data-ttu-id="8bf17-502">公式似乎正确，但在数据引擎提取数据时，它发现一个类型不匹配，并引发错误。</span><span class="sxs-lookup"><span data-stu-id="8bf17-502">The formula appears to be correct, but when the data engine fetches the data it finds a type mismatch, and raises an error.</span></span>  
  
-   <span data-ttu-id="8bf17-503">公式将错误的参数数目或类型传递到函数。</span><span class="sxs-lookup"><span data-stu-id="8bf17-503">The formula passes an incorrect number or type of parameters to a function.</span></span>  
  
-   <span data-ttu-id="8bf17-504">公式中引用有错误的其他列，因此它的值无效。</span><span class="sxs-lookup"><span data-stu-id="8bf17-504">The formula refers to a different column that has an error, and therefore its values are invalid.</span></span>  
  
-   <span data-ttu-id="8bf17-505">公式会引用尚未处理的列，这意味着，它有元数据，但没有用于计算的实际数据。</span><span class="sxs-lookup"><span data-stu-id="8bf17-505">The formula refers to a column that has not been processed, meaning it has metadata but no actual data to use for calculations.</span></span>  
  
 <span data-ttu-id="8bf17-506">在前四种情况中，DAX 标记包含无效公式的整个列。</span><span class="sxs-lookup"><span data-stu-id="8bf17-506">In the first four cases, DAX flags the entire column that contains the invalid formula.</span></span> <span data-ttu-id="8bf17-507">在最后一种情况中，DAX 会灰显该列，以便指示该列处于未处理的状态中。</span><span class="sxs-lookup"><span data-stu-id="8bf17-507">In the last case, DAX grays out the column to indicate that the column is in an unprocessed state.</span></span>  
  
##  <a name="additional-resources"></a><a name="bkmk_addional_resources"></a> <span data-ttu-id="8bf17-508">其他资源</span><span class="sxs-lookup"><span data-stu-id="8bf17-508">Additional Resources</span></span>  
 <span data-ttu-id="8bf17-509">[表格建模（Adventure Works 教程）](../tabular-modeling-adventure-works-tutorial.md)提供关于如何创建在计算列、度量值和行筛选器中包含许多计算的表格模型的分步说明。</span><span class="sxs-lookup"><span data-stu-id="8bf17-509">The [Tabular Modeling &#40;Adventure Works Tutorial&#41;](../tabular-modeling-adventure-works-tutorial.md) provides step-by-step instructions on how to create a tabular model that includes many calculations in calculated columns, measures, and row filters.</span></span> <span data-ttu-id="8bf17-510">对于大多数公式，都提供关于该公式的用途的说明。</span><span class="sxs-lookup"><span data-stu-id="8bf17-510">For most formulas, a description about what the formula is meant to do is provided.</span></span>  
  
 <span data-ttu-id="8bf17-511">[Analysis Services 和 Powerpivot 团队博客](https://go.microsoft.com/fwlink/?LinkID=220949&clcid=0x409)提供有关 [!INCLUDE[ssASCurrent](../../includes/ssascurrent-md.md)] 和 powerpivot 的信息、提示、新闻和公告。</span><span class="sxs-lookup"><span data-stu-id="8bf17-511">The [Analysis Services and PowerPivot Team Blog](https://go.microsoft.com/fwlink/?LinkID=220949&clcid=0x409) provides information, tips, news and announcements about [!INCLUDE[ssASCurrent](../../includes/ssascurrent-md.md)] and PowerPivot.</span></span>  
  
 <span data-ttu-id="8bf17-512">[DAX 资源中心](https://go.microsoft.com/fwlink/?LinkID=220966&clcid=0x409) 同时提供关于 DAX 的内部和外部信息，包括由主要商业智能专业人员提交的大量 DAX 解决方案。</span><span class="sxs-lookup"><span data-stu-id="8bf17-512">The [DAX Resource Center](https://go.microsoft.com/fwlink/?LinkID=220966&clcid=0x409) provides both internal and external information on DAX, including numerous DAX solutions submitted by leading Business Intelligence professionals.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="8bf17-513">另请参阅</span><span class="sxs-lookup"><span data-stu-id="8bf17-513">See Also</span></span>  
 <span data-ttu-id="8bf17-514">[&#40;DAX&#41; 参考的数据分析表达式](/dax/data-analysis-expressions-dax-reference) </span><span class="sxs-lookup"><span data-stu-id="8bf17-514">[Data Analysis Expressions &#40;DAX&#41; Reference](/dax/data-analysis-expressions-dax-reference) </span></span>  
 <span data-ttu-id="8bf17-515">[&#40;SSAS 表格&#41;度量值](measures-ssas-tabular.md) </span><span class="sxs-lookup"><span data-stu-id="8bf17-515">[Measures &#40;SSAS Tabular&#41;](measures-ssas-tabular.md) </span></span>  
 <span data-ttu-id="8bf17-516">[&#40;SSAS 表格&#41;计算列](ssas-calculated-columns.md) </span><span class="sxs-lookup"><span data-stu-id="8bf17-516">[Calculated Columns &#40;SSAS Tabular&#41;](ssas-calculated-columns.md) </span></span>  
 <span data-ttu-id="8bf17-517">[&#40;SSAS 表格&#41;的角色](roles-ssas-tabular.md) </span><span class="sxs-lookup"><span data-stu-id="8bf17-517">[Roles &#40;SSAS Tabular&#41;](roles-ssas-tabular.md) </span></span>  
 <span data-ttu-id="8bf17-518">[&#40;SSAS 表格&#41;的 Kpi](kpis-ssas-tabular.md) </span><span class="sxs-lookup"><span data-stu-id="8bf17-518">[KPIs &#40;SSAS Tabular&#41;](kpis-ssas-tabular.md) </span></span>  
 [<span data-ttu-id="8bf17-519">支持的数据源（SSAS 表格）</span><span class="sxs-lookup"><span data-stu-id="8bf17-519">Data Sources Supported &#40;SSAS Tabular&#41;</span></span>](data-sources-supported-ssas-tabular.md)  
  
  
