---
title: 通过 SharePoint 2010 进行 PowerPivot 数据刷新 |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
helpviewer_keywords:
- unattended data refresh [Analysis Services with SharePoint]
- scheduled data refresh [Analysis Services with SharePoint]
- data refresh [Analysis Services with SharePoint]
ms.assetid: 01b54e6f-66e5-485c-acaa-3f9aa53119c9
author: minewiskan
ms.author: owend
ms.openlocfilehash: 01874bf521055d1441b695a238d09440021d2718
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87691350"
---
# <a name="powerpivot-data-refresh-with-sharepoint-2010"></a><span data-ttu-id="2fc74-102">使用 SharePoint 2010 进行 PowerPivot 数据刷新</span><span class="sxs-lookup"><span data-stu-id="2fc74-102">PowerPivot Data Refresh with SharePoint 2010</span></span>
  [!INCLUDE[ssGemini](../includes/ssgemini-md.md)] <span data-ttu-id="2fc74-103">数据刷新是在服务器端计划的操作，它对外部数据源进行查询以便更新在内容库中存储的 Excel 2010 工作簿中嵌入的 [!INCLUDE[ssGemini](../includes/ssgemini-md.md)] 数据。</span><span class="sxs-lookup"><span data-stu-id="2fc74-103">t data refresh is a scheduled server-side operation that queries external data sources to update embedded [!INCLUDE[ssGemini](../includes/ssgemini-md.md)] data in an Excel 2010 workbook that is stored in a content library.</span></span>

 <span data-ttu-id="2fc74-104">数据刷新是 [!INCLUDE[ssGemini](../includes/ssgemini-md.md)] for SharePoint 的内置功能，但使用该功能要求您在 SharePoint 2010 场中运行特定的服务和计时器作业。</span><span class="sxs-lookup"><span data-stu-id="2fc74-104">Data refresh is a built-in feature of [!INCLUDE[ssGemini](../includes/ssgemini-md.md)] for SharePoint, but using it requires that you run specific services and timer jobs in your SharePoint 2010 farm.</span></span> <span data-ttu-id="2fc74-105">为使数据刷新成功，通常还要求执行其他一些管理步骤，例如安装数据访问接口和检查数据库权限。</span><span class="sxs-lookup"><span data-stu-id="2fc74-105">Additional administrative steps, such as installing data providers and checking database permissions, are often required for data refresh to succeed.</span></span>

 <span data-ttu-id="2fc74-106">**[!INCLUDE[applies](../includes/applies-md.md)]** SharePoint 2010</span><span class="sxs-lookup"><span data-stu-id="2fc74-106">**[!INCLUDE[applies](../includes/applies-md.md)]**  SharePoint 2010</span></span>

> [!NOTE]
>  [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)] <span data-ttu-id="2fc74-107">和 SharePoint Server 2013 Excel Services 将不同的体系结构用于 [!INCLUDE[ssGemini](../includes/ssgemini-md.md)] 数据模型的数据刷新。</span><span class="sxs-lookup"><span data-stu-id="2fc74-107">and SharePoint Server 2013 Excel Services use a different architecture for data refresh of [!INCLUDE[ssGemini](../includes/ssgemini-md.md)] data models.</span></span> <span data-ttu-id="2fc74-108">新的体系结构利用 Excel Services 作为主要组件加载 PowerPivot 数据模型。</span><span class="sxs-lookup"><span data-stu-id="2fc74-108">The new architecture utilizes Excel Services as the primary component to load PowerPivot data models.</span></span> <span data-ttu-id="2fc74-109">以前的数据刷新体系结构依赖在 SharePoint 模式下运行 PowerPivot 系统服务和 [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)] 的服务器来加载数据模型。</span><span class="sxs-lookup"><span data-stu-id="2fc74-109">The previous data refresh architecture used relied on a server running PowerPivot System Service and [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)] in SharePoint mode to load data models.</span></span> <span data-ttu-id="2fc74-110">有关详细信息，请参阅[通过 SharePoint 2013 进行 PowerPivot 数据刷新](power-pivot-sharepoint/power-pivot-data-refresh-with-sharepoint-2013.md)。</span><span class="sxs-lookup"><span data-stu-id="2fc74-110">For more information, see [PowerPivot Data Refresh with SharePoint 2013](power-pivot-sharepoint/power-pivot-data-refresh-with-sharepoint-2013.md).</span></span>

 <span data-ttu-id="2fc74-111">**本主题内容：**</span><span class="sxs-lookup"><span data-stu-id="2fc74-111">**In this topic:**</span></span>

 [<span data-ttu-id="2fc74-112">步骤1：启用 Secure Store Service 并生成主密钥</span><span class="sxs-lookup"><span data-stu-id="2fc74-112">Step 1: Enable Secure Store Service and Generate a Master Key</span></span>](#bkmk_services)

 [<span data-ttu-id="2fc74-113">步骤 2：关闭不想支持的凭据选项</span><span class="sxs-lookup"><span data-stu-id="2fc74-113">Step 2: Turn off credential options that you do not want to support</span></span>](#bkmk_creds)

 [<span data-ttu-id="2fc74-114">步骤 3：创建用于存储数据刷新中使用的凭据的目标应用程序</span><span class="sxs-lookup"><span data-stu-id="2fc74-114">Step 3: Create target applications to store credentials used in data refresh</span></span>](#bkmk_stored)

 [<span data-ttu-id="2fc74-115">步骤 4：配置服务器用于可扩展的数据刷新</span><span class="sxs-lookup"><span data-stu-id="2fc74-115">Step 4: Configure the server for scalable data refresh</span></span>](#bkmk_scale)

 [<span data-ttu-id="2fc74-116">步骤 5：安装用于导入 PowerPivot 数据的数据访问接口</span><span class="sxs-lookup"><span data-stu-id="2fc74-116">Step 5: Install Data Providers Used to Import PowerPivot Data</span></span>](#bkmk_installdp)

 [<span data-ttu-id="2fc74-117">步骤 6：授予创建计划和访问外部数据源所需的权限</span><span class="sxs-lookup"><span data-stu-id="2fc74-117">Step 6: Grant permissions to create schedules and access external data sources</span></span>](#bkmk_accounts)

 [<span data-ttu-id="2fc74-118">步骤 7：为数据刷新启用工作簿升级</span><span class="sxs-lookup"><span data-stu-id="2fc74-118">Step 7: Enable workbook upgrade for data refresh</span></span>](#bkmk_upgradewrkbk)

 [<span data-ttu-id="2fc74-119">步骤 8：验证数据刷新配置</span><span class="sxs-lookup"><span data-stu-id="2fc74-119">Step 8: Verify data refresh configuration</span></span>](#bkmk_verify)

 [<span data-ttu-id="2fc74-120">为数据刷新修改配置设置</span><span class="sxs-lookup"><span data-stu-id="2fc74-120">Modify Configuration Settings for Data Refresh</span></span>](#bkmk_config)

 [<span data-ttu-id="2fc74-121">重新计划 PowerPivot 数据刷新计时器作业</span><span class="sxs-lookup"><span data-stu-id="2fc74-121">Reschedule the PowerPivot Data Refresh timer job</span></span>](#configTimerJob)

 [<span data-ttu-id="2fc74-122">禁用数据刷新计时器作业</span><span class="sxs-lookup"><span data-stu-id="2fc74-122">Disable the Data Refresh Timer Job</span></span>](#bkmk_disableDR)

 <span data-ttu-id="2fc74-123">在您确保已配置了服务器环境和权限后，数据刷新可供使用。</span><span class="sxs-lookup"><span data-stu-id="2fc74-123">After you ensure that the server environment and permissions are configured, data refresh is ready to use.</span></span> <span data-ttu-id="2fc74-124">若要使用数据刷新，SharePoint 用户需要针对 PowerPivot 工作簿创建一个计划，以便指定执行数据刷新的频率。</span><span class="sxs-lookup"><span data-stu-id="2fc74-124">To use data refresh, a SharePoint user creates a schedule on a PowerPivot workbook that specifies how often data refresh occurs.</span></span> <span data-ttu-id="2fc74-125">通常由将文件发布到 SharePoint 的工作簿所有者或作者来创建该计划。</span><span class="sxs-lookup"><span data-stu-id="2fc74-125">Creating the schedule is typically done by the workbook owner or author who published the file to SharePoint.</span></span> <span data-ttu-id="2fc74-126">该用户为其拥有的工作簿创建并管理数据刷新计划。</span><span class="sxs-lookup"><span data-stu-id="2fc74-126">This person creates and manages the data refresh schedules for the workbooks that he or she owns.</span></span> <span data-ttu-id="2fc74-127">有关详细信息，请参阅[计划数据刷新 &#40;PowerPivot for SharePoint&#41;](schedule-a-data-refresh-powerpivot-for-sharepoint.md)。</span><span class="sxs-lookup"><span data-stu-id="2fc74-127">For more information, see [Schedule a Data Refresh &#40;PowerPivot for SharePoint&#41;](schedule-a-data-refresh-powerpivot-for-sharepoint.md).</span></span>

##  <a name="step-1-enable-secure-store-service-and-generate-a-master-key"></a><a name="bkmk_services"></a><span data-ttu-id="2fc74-128">步骤1：启用 Secure Store Service 并生成主密钥</span><span class="sxs-lookup"><span data-stu-id="2fc74-128">Step 1: Enable Secure Store Service and Generate a Master Key</span></span>
 <span data-ttu-id="2fc74-129">要运行数据刷新作业以及连接到使用存储凭据的外部数据源，PowerPivot 数据刷新依赖 Secure Store Service 来提供所需的凭据。</span><span class="sxs-lookup"><span data-stu-id="2fc74-129">PowerPivot data refresh depends on Secure Store Service to provide credentials used to run data refresh jobs and to connect to external data sources that use stored credentials.</span></span>

 <span data-ttu-id="2fc74-130">如果您是使用“新服务器”选项安装 PowerPivot for SharePoint 的，则已为您配置 Secure Store Service。</span><span class="sxs-lookup"><span data-stu-id="2fc74-130">If you installed PowerPivot for SharePoint using the New Server option, the Secure Store Service is configured for you.</span></span> <span data-ttu-id="2fc74-131">对于所有其他安装方案，您必须创建和配置服务应用程序并为 Secure Store Service 生成主密钥。</span><span class="sxs-lookup"><span data-stu-id="2fc74-131">For all other installation scenarios, you must create and configure a service application and generate a master encryption key for Secure Store Service.</span></span>

> [!NOTE]
>  <span data-ttu-id="2fc74-132">若要配置 Secure Store Service 或将 Secure Store Service 管理委托给其他用户，您必须是场管理员。</span><span class="sxs-lookup"><span data-stu-id="2fc74-132">You must be a farm administrator to configure Secure Store Service or delegate Secure Store Service administration to another user.</span></span> <span data-ttu-id="2fc74-133">若要在启用设置后配置或修改设置，您必须是服务应用程序管理员。</span><span class="sxs-lookup"><span data-stu-id="2fc74-133">You must be a service application administrator to configure or modify settings after it is enabled.</span></span>

1.  <span data-ttu-id="2fc74-134">在“管理中心”的“应用程序管理”中，单击 **“管理服务应用程序”** 。</span><span class="sxs-lookup"><span data-stu-id="2fc74-134">In Central Administration, in Application Management, click **Manage service applications**.</span></span>

2.  <span data-ttu-id="2fc74-135">在 "服务应用程序" 功能区中的 "创建" 中，单击 "**新建**"。</span><span class="sxs-lookup"><span data-stu-id="2fc74-135">In the Service Applications ribbon, in Create, click **New**.</span></span>

3.  <span data-ttu-id="2fc74-136">选择**Secure Store Service**。</span><span class="sxs-lookup"><span data-stu-id="2fc74-136">Select **Secure Store Service**.</span></span>

4.  <span data-ttu-id="2fc74-137">在 "**创建安全存储区应用程序**" 页中，输入应用程序的名称。</span><span class="sxs-lookup"><span data-stu-id="2fc74-137">In the **Create Secure Store Application** page, enter a name for the application.</span></span>

5.  <span data-ttu-id="2fc74-138">在 "**数据库**" 中，指定将承载此服务应用程序的数据库的 SQL Server 实例。</span><span class="sxs-lookup"><span data-stu-id="2fc74-138">In **Database**, specify the SQL Server instance that will host the database for this service application.</span></span> <span data-ttu-id="2fc74-139">默认值是承载场配置数据库的 SQL Server 数据库引擎实例。</span><span class="sxs-lookup"><span data-stu-id="2fc74-139">The default value is the SQL Server Database Engine instance that hosts the farm configuration databases.</span></span>

6.  <span data-ttu-id="2fc74-140">在 "**数据库名称**" 中，输入服务应用程序数据库的名称。</span><span class="sxs-lookup"><span data-stu-id="2fc74-140">In **Database Name**, enter the name of the service application database.</span></span> <span data-ttu-id="2fc74-141">默认值为 Secure_Store_Service_DB_ \<guid> 。</span><span class="sxs-lookup"><span data-stu-id="2fc74-141">The default value is Secure_Store_Service_DB_\<guid>.</span></span> <span data-ttu-id="2fc74-142">该默认名称对应于服务应用程序的默认名称。</span><span class="sxs-lookup"><span data-stu-id="2fc74-142">The default name corresponds to the default name of the service application.</span></span> <span data-ttu-id="2fc74-143">如果您输入了唯一的服务应用程序名称，则遵循您的数据库名称的类似命名约定，以便可以一起管理它们。</span><span class="sxs-lookup"><span data-stu-id="2fc74-143">If you entered a unique service application name, follow a similar naming convention for your database name so that you can manage them together.</span></span>

7.  <span data-ttu-id="2fc74-144">在 **“数据库身份验证”** 中，默认值是 “Windows 身份验证”。</span><span class="sxs-lookup"><span data-stu-id="2fc74-144">In **Database Authentication**, the default is Windows Authentication.</span></span> <span data-ttu-id="2fc74-145">如果您选择“SQL 身份验证”，请参考 SharePoint 管理员指南中有关如何在场中使用该身份验证类型的说明。</span><span class="sxs-lookup"><span data-stu-id="2fc74-145">If you choose SQL Authentication, refer to the SharePoint administrator guide for guidance on how to use the authentication type in your farm.</span></span>

8.  <span data-ttu-id="2fc74-146">在 "应用程序池" 中，选择 "**新建应用程序池"。**</span><span class="sxs-lookup"><span data-stu-id="2fc74-146">In Application Pool, select **Create new application pool.**</span></span> <span data-ttu-id="2fc74-147">请指定一个说明性名称，这将帮助其他服务器管理员标识使用此应用程序池的方式。</span><span class="sxs-lookup"><span data-stu-id="2fc74-147">Specify a descriptive name that will help other server administrators identify how the application pool is used.</span></span>

9. <span data-ttu-id="2fc74-148">为应用程序池选择一个安全帐户。</span><span class="sxs-lookup"><span data-stu-id="2fc74-148">Select a security account for the application pool.</span></span> <span data-ttu-id="2fc74-149">指定要使用域用户帐户的托管帐户。</span><span class="sxs-lookup"><span data-stu-id="2fc74-149">Specify a managed account to use a domain user account.</span></span>

10. <span data-ttu-id="2fc74-150">接受剩余的默认值，然后单击 **"确定"。**</span><span class="sxs-lookup"><span data-stu-id="2fc74-150">Accept the remaining default values, and then click **OK.**</span></span> <span data-ttu-id="2fc74-151">服务应用程序将在场的服务应用程序列表中与其他托管服务显示在一起。</span><span class="sxs-lookup"><span data-stu-id="2fc74-151">The service application will appear alongside other managed services in the farm's service application list.</span></span>

11. <span data-ttu-id="2fc74-152">单击列表中的 Secure Store Service 务应用程序。</span><span class="sxs-lookup"><span data-stu-id="2fc74-152">Click the Secure Store Service application from the list.</span></span>

12. <span data-ttu-id="2fc74-153">在 "服务应用程序" 功能区中，单击 "**管理**"。</span><span class="sxs-lookup"><span data-stu-id="2fc74-153">In the Service Applications ribbon, click **Manage**.</span></span>

13. <span data-ttu-id="2fc74-154">在 "密钥管理" 中，单击 "**生成新密钥**"。</span><span class="sxs-lookup"><span data-stu-id="2fc74-154">In Key Management, click **Generate New Key**.</span></span>

14. <span data-ttu-id="2fc74-155">输入然后确认通行短语。</span><span class="sxs-lookup"><span data-stu-id="2fc74-155">Enter and then confirm a pass phrase.</span></span> <span data-ttu-id="2fc74-156">该通行短语将用于添加其他安全存储区共享服务应用程序。</span><span class="sxs-lookup"><span data-stu-id="2fc74-156">The pass phrase will be used to add additional secure store shared service applications.</span></span>

15. <span data-ttu-id="2fc74-157">单击“确定”  。</span><span class="sxs-lookup"><span data-stu-id="2fc74-157">Click **OK**.</span></span>

 <span data-ttu-id="2fc74-158">必须先启用存储区服务操作的日志记录审核功能（有助于故障排除），然后才能使用该功能。</span><span class="sxs-lookup"><span data-stu-id="2fc74-158">Audit logging of Store Service operations, which is useful for troubleshooting purposes, must be enabled before it is available.</span></span> <span data-ttu-id="2fc74-159">有关如何启用日志记录的详细信息，请参阅[ (SharePoint 2010) 配置 Secure Store Service ](https://go.microsoft.com/fwlink/p/?LinkID=223294)。</span><span class="sxs-lookup"><span data-stu-id="2fc74-159">For more information about how to enable logging, see [Configure Secure Store Service (SharePoint 2010)](https://go.microsoft.com/fwlink/p/?LinkID=223294).</span></span>

##  <a name="step-2-turn-off-credential-options-that-you-do-not-want-to-support"></a><a name="bkmk_creds"></a><span data-ttu-id="2fc74-160">步骤2：关闭不需要支持的凭据选项</span><span class="sxs-lookup"><span data-stu-id="2fc74-160">Step 2: Turn off credential options that you do not want to support</span></span>
 <span data-ttu-id="2fc74-161">PowerPivot 数据刷新在数据刷新计划中提供三个凭据选项。</span><span class="sxs-lookup"><span data-stu-id="2fc74-161">PowerPivot data refresh provides three credential options in a data refresh schedule.</span></span> <span data-ttu-id="2fc74-162">工作簿所有者在计划数据刷新时会选择其中一个选项，由此决定用来运行数据刷新作业的帐户。</span><span class="sxs-lookup"><span data-stu-id="2fc74-162">When a workbook owner schedules data refresh, he or she chooses one of these options, thereby determining the account under which the data refresh job runs.</span></span> <span data-ttu-id="2fc74-163">作为管理员，您可以决定可供计划所有者使用的凭据选项。</span><span class="sxs-lookup"><span data-stu-id="2fc74-163">As an administrator, you can determine which credential options are available to schedule owners.</span></span>

 <span data-ttu-id="2fc74-164">要运行数据刷新，必须至少提供一个选项。</span><span class="sxs-lookup"><span data-stu-id="2fc74-164">You must have at least one option that is available in order for data refresh to work.</span></span>

 <span data-ttu-id="2fc74-165">![SSAS_PowerpivotKJ_DataRefreshCreds](media/ssas-powerpivotkj-datarefreshcreds.gif "SSAS_PowerpivotKJ_DataRefreshCreds")</span><span class="sxs-lookup"><span data-stu-id="2fc74-165">![SSAS_PowerpivotKJ_DataRefreshCreds](media/ssas-powerpivotkj-datarefreshcreds.gif "SSAS_PowerpivotKJ_DataRefreshCreds")</span></span>

 <span data-ttu-id="2fc74-166">选项1：**使用管理员配置的数据刷新帐户**，始终出现在计划定义页上，但仅当你配置无人参与的数据刷新帐户时才起作用。</span><span class="sxs-lookup"><span data-stu-id="2fc74-166">Option 1, **Use the data refresh account configured by the administrator**, always appears on the schedule definition page, but only works if you configure the unattended data refresh account.</span></span> <span data-ttu-id="2fc74-167">有关如何创建帐户的详细信息，请参阅[配置 PowerPivot 无人参与的数据刷新帐户 &#40;PowerPivot for SharePoint&#41;](configure-unattended-data-refresh-account-powerpivot-sharepoint.md)。</span><span class="sxs-lookup"><span data-stu-id="2fc74-167">For more information on how to create the account, see [Configure the PowerPivot Unattended Data Refresh Account &#40;PowerPivot for SharePoint&#41;](configure-unattended-data-refresh-account-powerpivot-sharepoint.md).</span></span>

 <span data-ttu-id="2fc74-168">选项2，**使用以下 windows 凭据进行连接**：始终显示在该页上，但仅当您在服务应用程序配置页中启用了 "**允许用户输入自定义 windows 凭据**" 选项时才起作用。</span><span class="sxs-lookup"><span data-stu-id="2fc74-168">Option 2, **Connect using the following windows credentials**, always appears on the page, but only works when you enable the **Allow users to enter custom Windows credentials** option in the service application configuration page.</span></span> <span data-ttu-id="2fc74-169">默认启用此选项，但您可以在使用此选项弊大于利的情况下禁用此选项（请参见下文）。</span><span class="sxs-lookup"><span data-stu-id="2fc74-169">This option is enabled by default, but you can disable it if the disadvantages of using it outweigh the advantages (see below).</span></span>

 <span data-ttu-id="2fc74-170">选项3：**使用保存在 Secure Store Service 中的凭据进行连接**，始终显示在页面上，但仅当计划所有者提供有效的目标应用程序时才有效。</span><span class="sxs-lookup"><span data-stu-id="2fc74-170">Option 3, **Connect using the credentials saved in Secure Store Service**, always appears on the page, but only works when a schedule owner provides a valid target application.</span></span> <span data-ttu-id="2fc74-171">管理员必须事先创建这些目标应用程序，然后向创建数据刷新计划的用户提供应用程序名称。</span><span class="sxs-lookup"><span data-stu-id="2fc74-171">An administrator must create these target applications in advance and then provide the application name to those who create the data refresh schedules.</span></span> <span data-ttu-id="2fc74-172">有关如何为数据刷新操作创建目标应用程序的详细信息，请参阅为[PowerPivot 数据刷新配置存储的凭据 &#40;PowerPivot for SharePoint&#41;](configure-stored-credentials-data-refresh-powerpivot-sharepoint.md)。</span><span class="sxs-lookup"><span data-stu-id="2fc74-172">For more information on how to create a target application for data refresh operations, see [Configure Stored Credentials for PowerPivot Data Refresh &#40;PowerPivot for SharePoint&#41;](configure-stored-credentials-data-refresh-powerpivot-sharepoint.md).</span></span>

 <span data-ttu-id="2fc74-173">**配置凭据选项 2 "使用以下 Windows 用户凭据进行连接"**</span><span class="sxs-lookup"><span data-stu-id="2fc74-173">**Configuring credential option 2, "Connect using the following Windows user credentials"**</span></span>

 <span data-ttu-id="2fc74-174">PowerPivot 服务应用程序包括一个凭据选项，该选项允许计划所有者任意输入 Windows 用户名和密码以便运行数据刷新作业。</span><span class="sxs-lookup"><span data-stu-id="2fc74-174">PowerPivot service application includes a credential option that allows schedule owners to enter an arbitrary Windows user name and password for running a data refresh job.</span></span> <span data-ttu-id="2fc74-175">这是计划定义页中的第二个凭据选项。</span><span class="sxs-lookup"><span data-stu-id="2fc74-175">This is the second credential option in the schedule definition page:</span></span>

 <span data-ttu-id="2fc74-176">![SSAS_PPS_ScheduleDataRefreshCreds](media/ssas-pps-scheduledatarefreshcreds.gif "SSAS_PPS_ScheduleDataRefreshCreds")</span><span class="sxs-lookup"><span data-stu-id="2fc74-176">![SSAS_PPS_ScheduleDataRefreshCreds](media/ssas-pps-scheduledatarefreshcreds.gif "SSAS_PPS_ScheduleDataRefreshCreds")</span></span>

 <span data-ttu-id="2fc74-177">默认情况下启用此凭据选项。</span><span class="sxs-lookup"><span data-stu-id="2fc74-177">This credential option is enabled by default.</span></span> <span data-ttu-id="2fc74-178">启用此凭据选项后，PowerPivot 系统服务将在 Secure Store Service 中生成一个目标应用程序，用来存储计划所有者输入的用户名和密码。</span><span class="sxs-lookup"><span data-stu-id="2fc74-178">When this credential option is enabled, PowerPivot System Service will generate a target application in Secure Store Service to store the user name and password entered by the schedule owner.</span></span> <span data-ttu-id="2fc74-179">使用此命名约定创建生成的目标应用程序： PowerPivotDataRefresh_ \<guid> 。</span><span class="sxs-lookup"><span data-stu-id="2fc74-179">A generated target application is created using this naming convention: PowerPivotDataRefresh_\<guid>.</span></span> <span data-ttu-id="2fc74-180">为每一组 Windows 凭据都创建一个目标应用程序。</span><span class="sxs-lookup"><span data-stu-id="2fc74-180">One target application is created for each set of Windows credentials.</span></span> <span data-ttu-id="2fc74-181">如果由 PowerPivot 系统服务拥有的目标应用程序已存在，并且该应用程序存储着计划定义者输入的用户名和密码，则 PowerPivot 系统服务将使用该目标应用程序而不会另外新建。</span><span class="sxs-lookup"><span data-stu-id="2fc74-181">If a target application already exists that is owned by the PowerPivot System Service and stores the username and password entered by the person defining the schedule, PowerPivot System Service will use that target application rather than create a new one.</span></span>

 <span data-ttu-id="2fc74-182">此凭据选项的主要优点是简便易用。</span><span class="sxs-lookup"><span data-stu-id="2fc74-182">The primary advantage of using this credential option is ease of use and simplicity.</span></span> <span data-ttu-id="2fc74-183">由于系统为您创建了目标应用程序，所以几乎不需要执行进一步的工作。</span><span class="sxs-lookup"><span data-stu-id="2fc74-183">Advance work is minimal because target applications are created for you.</span></span> <span data-ttu-id="2fc74-184">此外，使用计划所有者（很可能就是工作簿创建者）的凭据运行数据刷新简化了之后的权限要求。</span><span class="sxs-lookup"><span data-stu-id="2fc74-184">Also, running data refresh under the credentials of the schedule owner (who is most likely the person who created the workbook) simplifies permission requirements downstream.</span></span> <span data-ttu-id="2fc74-185">此用户很可能已经拥有针对目标数据库的权限。</span><span class="sxs-lookup"><span data-stu-id="2fc74-185">Most likely, this user already has permissions on the target database.</span></span> <span data-ttu-id="2fc74-186">当数据刷新在此人的 Windows 用户标识下运行时，指定 "当前用户" 的任何数据连接都将自动运行。</span><span class="sxs-lookup"><span data-stu-id="2fc74-186">When data refresh runs under this person's Windows user identity, any data connections that specify 'current user' will work automatically.</span></span>

 <span data-ttu-id="2fc74-187">此选项的缺点是不易管理。</span><span class="sxs-lookup"><span data-stu-id="2fc74-187">The disadvantage is limited management capability.</span></span> <span data-ttu-id="2fc74-188">尽管目标应用程序是自动创建的，但它们不会随着帐户信息的更改自动删除或更新。</span><span class="sxs-lookup"><span data-stu-id="2fc74-188">Although target applications are created automatically, they are not deleted automatically or updated as account information changes.</span></span> <span data-ttu-id="2fc74-189">密码过期策略可能导致这些目标应用程序过期。</span><span class="sxs-lookup"><span data-stu-id="2fc74-189">Password expiration policies might cause these target applications to become out of date.</span></span> <span data-ttu-id="2fc74-190">使用过期凭据的数据刷新作业将无法启动。</span><span class="sxs-lookup"><span data-stu-id="2fc74-190">Data refresh jobs that use expired credentials will start to fail.</span></span> <span data-ttu-id="2fc74-191">出现这种情况时，计划所有者需要通过提供数据刷新计划中的当前用户名和密码值来更新自己的凭据。</span><span class="sxs-lookup"><span data-stu-id="2fc74-191">When this occurs, schedule owners will need to update their credentials by providing current user name and password values in a data refresh schedule.</span></span> <span data-ttu-id="2fc74-192">此时将创建一个新的目标应用程序。</span><span class="sxs-lookup"><span data-stu-id="2fc74-192">A new target application will be created at that point.</span></span> <span data-ttu-id="2fc74-193">之后随着用户不断添加和修改他们数据刷新计划中的凭据信息，您会发现自己的系统上存在大量自动生成的目标应用程序。</span><span class="sxs-lookup"><span data-stu-id="2fc74-193">Over time, as users add and revise credential information in their data refresh schedules, you might find that you have a large number of auto-generated target applications on your system.</span></span>

 <span data-ttu-id="2fc74-194">当前无法确定哪些目标应用程序是活动的，哪些不活动；也无法通过特定目标应用程序回溯到使用它的数据刷新计划。</span><span class="sxs-lookup"><span data-stu-id="2fc74-194">Currently, there is no way to determine which of these target applications are active or inactive, nor is there a way to trace a specific target application back to the data refresh schedules that use it.</span></span> <span data-ttu-id="2fc74-195">通常，您应该不对这些目标应用程序执行任何操作，因为删除它们可能会破坏现有的数据刷新计划。</span><span class="sxs-lookup"><span data-stu-id="2fc74-195">In general, you should leave the target applications alone, as deleting them might break existing data refresh schedules.</span></span> <span data-ttu-id="2fc74-196">删除仍在使用中的目标应用程序将导致数据刷新失败，并显示消息 "找不到目标应用程序"，并显示在工作簿的数据刷新历史记录页中。</span><span class="sxs-lookup"><span data-stu-id="2fc74-196">Deleting a target application that is still in use will cause data refresh to fail with the message, "Target application not found", appearing in the data refresh history page of the workbook.</span></span>

 <span data-ttu-id="2fc74-197">如果选择禁用此凭据选项，则可以安全地删除为 PowerPivot 数据刷新生成的所有目标应用程序。</span><span class="sxs-lookup"><span data-stu-id="2fc74-197">Should you choose to disable this credential option, you can safely delete all of the target applications that were generated for PowerPivot data refresh.</span></span>

 <span data-ttu-id="2fc74-198">**在数据刷新计划中禁用任意 Windows 凭据**</span><span class="sxs-lookup"><span data-stu-id="2fc74-198">**Disabling the use of arbitrary Windows credentials in data refresh schedules**</span></span>

1.  <span data-ttu-id="2fc74-199">在管理中心的 "应用程序管理" 中，单击 "**管理服务应用程序**"。</span><span class="sxs-lookup"><span data-stu-id="2fc74-199">In Central Administration, in Application Management, click **Manage Service Applications**.</span></span>

2.  <span data-ttu-id="2fc74-200">单击 PowerPivot 服务应用程序名称。</span><span class="sxs-lookup"><span data-stu-id="2fc74-200">Click the PowerPivot service application name.</span></span> <span data-ttu-id="2fc74-201">PowerPivot 管理面板将出现。</span><span class="sxs-lookup"><span data-stu-id="2fc74-201">The PowerPivot Management Dashboard appears.</span></span>

3.  <span data-ttu-id="2fc74-202">在 "操作" 中，单击 "**配置服务应用程序设置**" 以打开 "PowerPivot 服务应用程序设置" 页</span><span class="sxs-lookup"><span data-stu-id="2fc74-202">In Actions, click **Configure service application settings** to open the PowerPivot Service Application Settings page</span></span>

4.  <span data-ttu-id="2fc74-203">在 "数据刷新" 部分中，清除 "**允许用户输入自定义 Windows 凭据**" 复选框。</span><span class="sxs-lookup"><span data-stu-id="2fc74-203">In the Data Refresh section, clear the **Allow users to enter custom Windows credentials** checkbox.</span></span>

     <span data-ttu-id="2fc74-204">![SSAS_PowerPivotDatarefreshOptions_AllowUser](media/ssas-powerpivotdatarefreshoptions-allowuser.gif "SSAS_PowerPivotDatarefreshOptions_AllowUser")</span><span class="sxs-lookup"><span data-stu-id="2fc74-204">![SSAS_PowerPivotDatarefreshOptions_AllowUser](media/ssas-powerpivotdatarefreshoptions-allowuser.gif "SSAS_PowerPivotDatarefreshOptions_AllowUser")</span></span>

##  <a name="step-3-create-target-applications-to-store-credentials-used-in-data-refresh"></a><a name="bkmk_stored"></a><span data-ttu-id="2fc74-205">步骤3：创建目标应用程序以存储在数据刷新中使用的凭据</span><span class="sxs-lookup"><span data-stu-id="2fc74-205">Step 3: Create target applications to store credentials used in data refresh</span></span>
 <span data-ttu-id="2fc74-206">一旦配置了 Secure Store Service，SharePoint 管理员就可以创建目标应用程序以使存储的凭据可用于数据刷新，包括无人参与的 PowerPivot 数据刷新帐户或者用于运行数据刷新作业或连接到外部数据源的任何其他帐户。</span><span class="sxs-lookup"><span data-stu-id="2fc74-206">Once Secure Store Service is configured, SharePoint administrators can create target applications to make stored credentials available for data refresh purposes, including the PowerPivot unattended data refresh account or any other account that is used to either run the job or connect to external data sources.</span></span>

 <span data-ttu-id="2fc74-207">回想上一部分中所述的内容，您需要创建目标应用程序才能使特定凭据选项可用。</span><span class="sxs-lookup"><span data-stu-id="2fc74-207">Recall from the previous section that you need to create target applications in order for certain credential options to be usable.</span></span> <span data-ttu-id="2fc74-208">具体而言，您必须为 PowerPivot 无人参与的数据刷新帐户以及要在数据刷新操作中使用的其他任何存储凭据创建目标应用程序。</span><span class="sxs-lookup"><span data-stu-id="2fc74-208">Specifically, you must create target applications for the PowerPivot unattended data refresh account, plus any additional stored credentials that you expect would be used in data refresh operations.</span></span>

 <span data-ttu-id="2fc74-209">有关如何创建包含存储凭据的目标应用程序的详细信息，请参阅[配置 Powerpivot 无人参与的数据刷新帐户 &#40;PowerPivot for SharePoint&#41;](configure-unattended-data-refresh-account-powerpivot-sharepoint.md)并[为 PowerPivot 数据刷新配置存储的凭据 &#40;PowerPivot for SharePoint&#41;](configure-stored-credentials-data-refresh-powerpivot-sharepoint.md)。</span><span class="sxs-lookup"><span data-stu-id="2fc74-209">For more information about how to create target applications that contain stored credentials, see [Configure the PowerPivot Unattended Data Refresh Account &#40;PowerPivot for SharePoint&#41;](configure-unattended-data-refresh-account-powerpivot-sharepoint.md) and [Configure Stored Credentials for PowerPivot Data Refresh &#40;PowerPivot for SharePoint&#41;](configure-stored-credentials-data-refresh-powerpivot-sharepoint.md).</span></span>

##  <a name="step-4-configure-the-server-for-scalable-data-refresh"></a><a name="bkmk_scale"></a><span data-ttu-id="2fc74-210">步骤4：配置服务器以进行可缩放的数据刷新</span><span class="sxs-lookup"><span data-stu-id="2fc74-210">Step 4: Configure the server for scalable data refresh</span></span>
 <span data-ttu-id="2fc74-211">默认情况下，每个 PowerPivot for SharePoint 安装都支持按需查询和计划的数据刷新。</span><span class="sxs-lookup"><span data-stu-id="2fc74-211">By default, each PowerPivot for SharePoint installation supports both on-demand queries and scheduled data refresh.</span></span>

 <span data-ttu-id="2fc74-212">对于每个安装，您都可以指定 Analysis Services 服务器实例是同时支持查询和计划的数据刷新，还是专用于特定类型的操作。</span><span class="sxs-lookup"><span data-stu-id="2fc74-212">For each installation, you can specify whether the Analysis Services server instance supports both query and scheduled data refresh, or is dedicated to a specific type of operation.</span></span> <span data-ttu-id="2fc74-213">如果场中安装有多个 PowerPivot for SharePoint，在您发现作业出现延迟或失败的情况下，可以考虑将某台服务器专用于数据刷新操作。</span><span class="sxs-lookup"><span data-stu-id="2fc74-213">If you have multiple installations of PowerPivot for SharePoint in your farm, you might consider dedicating a server for just data refresh operations if you find that jobs are delayed or failing.</span></span>

 <span data-ttu-id="2fc74-214">此外，如果基础硬件支持，则可以增加可同时运行的数据刷新作业的数目。</span><span class="sxs-lookup"><span data-stu-id="2fc74-214">Additionally, if the underlying hardware supports it, you can increase the number of data refresh jobs that run in parallel.</span></span> <span data-ttu-id="2fc74-215">默认情况下，将根据系统内存来计算可同时运行的作业数目；但如果 CPU 有额外处理能力来支持负载，则可以增加该数目。</span><span class="sxs-lookup"><span data-stu-id="2fc74-215">By default, the number of jobs that can run in parallel is calculated based on system memory, but you can increase that number if you have additional CPU capacity to support the workload.</span></span>

 <span data-ttu-id="2fc74-216">有关详细信息，请参阅[配置专用数据刷新或仅限查询的处理 &#40;PowerPivot for SharePoint&#41;](configure-dedicated-data-refresh-query-only-processing-powerpivot-sharepoint.md)。</span><span class="sxs-lookup"><span data-stu-id="2fc74-216">For more information, see [Configure Dedicated Data Refresh or Query-Only Processing &#40;PowerPivot for SharePoint&#41;](configure-dedicated-data-refresh-query-only-processing-powerpivot-sharepoint.md).</span></span>

##  <a name="step-5-install-data-providers-used-to-import-powerpivot-data"></a><a name="bkmk_installdp"></a><span data-ttu-id="2fc74-217">步骤5：安装用于导入 PowerPivot 数据的数据访问接口</span><span class="sxs-lookup"><span data-stu-id="2fc74-217">Step 5: Install Data Providers Used to Import PowerPivot Data</span></span>
 <span data-ttu-id="2fc74-218">数据刷新操作基本上是对检索原始数据的导入操作的重复。</span><span class="sxs-lookup"><span data-stu-id="2fc74-218">A data refresh operation is essentially a repeat of an import operation that retrieved the original data.</span></span> <span data-ttu-id="2fc74-219">这意味着用于在 PowerPivot 客户端应用程序中导入数据的数据访问接口也必须安装在 PowerPivot 服务器上。</span><span class="sxs-lookup"><span data-stu-id="2fc74-219">This means that the same data providers used to import the data in the PowerPivot client application must also be installed on the PowerPivot server.</span></span>

 <span data-ttu-id="2fc74-220">您必须是本地管理员才能在 Windows 服务器上安装数据访问接口。</span><span class="sxs-lookup"><span data-stu-id="2fc74-220">You must be a local administrator to install data providers on a Windows server.</span></span> <span data-ttu-id="2fc74-221">如果您安装其他驱动程序，请确保在 SharePoint 场中安装了 PowerPivot for SharePoint 的每台计算机上安装这些驱动程序。</span><span class="sxs-lookup"><span data-stu-id="2fc74-221">If you install additional drivers, be sure to install them on each computer in the SharePoint farm that has an installation of PowerPivot for SharePoint.</span></span> <span data-ttu-id="2fc74-222">如果您在场中具有多个 PowerPivot 服务器，则必须在每个服务器上都安装这些访问接口。</span><span class="sxs-lookup"><span data-stu-id="2fc74-222">If you have multiple PowerPivot servers in the farm, you must install the providers on each one.</span></span>

 <span data-ttu-id="2fc74-223">请记住，SharePoint 服务器是 64 位应用程序。</span><span class="sxs-lookup"><span data-stu-id="2fc74-223">Remember that SharePoint servers are 64-bit applications.</span></span> <span data-ttu-id="2fc74-224">请务必安装您准备用于支持数据刷新操作的数据访问接口的 64 位版本。</span><span class="sxs-lookup"><span data-stu-id="2fc74-224">Be sure to install the 64-bit version of the data providers you are using to support data refresh operations.</span></span>

##  <a name="step-6-grant-permissions-to-create-schedules-and-access-external-data-sources"></a><a name="bkmk_accounts"></a><span data-ttu-id="2fc74-225">步骤6：授予创建计划和访问外部数据源的权限</span><span class="sxs-lookup"><span data-stu-id="2fc74-225">Step 6: Grant permissions to create schedules and access external data sources</span></span>
 <span data-ttu-id="2fc74-226">工作簿所有者或作者必须具有 **“参与讨论”** 权限才能计划针对工作簿的数据刷新。</span><span class="sxs-lookup"><span data-stu-id="2fc74-226">Workbook owners or authors must have **Contribute** permission to schedule data refresh on a workbook.</span></span> <span data-ttu-id="2fc74-227">如果授予此权限级别，则用户可以打开和编辑工作簿的数据刷新配置页，以便指定用于刷新数据的凭据和计划信息。</span><span class="sxs-lookup"><span data-stu-id="2fc74-227">Given this permission level, he or she can open and edit the workbook's data refresh configuration page to specify the credentials and schedule information used to refresh the data.</span></span>

 <span data-ttu-id="2fc74-228">除 SharePoint 权限之外，还必须检查针对外部数据源的数据库权限，以确保数据刷新过程中使用的帐户对该数据具有足够的访问权限。</span><span class="sxs-lookup"><span data-stu-id="2fc74-228">In addition to SharePoint permissions, database permissions on external data sources must also be reviewed to ensure that accounts used during data refresh have sufficient access rights to the data.</span></span> <span data-ttu-id="2fc74-229">确定权限要求时需要您仔细评估，因为您需要授予的权限将根据工作簿中的连接字符串和运行数据刷新作业所用的用户身份而有所不同。</span><span class="sxs-lookup"><span data-stu-id="2fc74-229">Determining permission requirements will require careful evaluation on your part because the permissions that you need to grant will vary depending on the connection string in the workbook and the user identity under which the data refresh job is running.</span></span>

 <span data-ttu-id="2fc74-230">**PowerPivot 工作簿中现有的连接字符串为何对 PowerPivot 数据刷新操作至关重要？**</span><span class="sxs-lookup"><span data-stu-id="2fc74-230">**Why existing connection strings in a PowerPivot workbook matter to PowerPivot data refresh operations**</span></span>

 <span data-ttu-id="2fc74-231">运行数据刷新时，服务器会使用最初导入数据时创建的连接字符串向外部数据源发送连接请求。</span><span class="sxs-lookup"><span data-stu-id="2fc74-231">When data refresh runs, the server sends a connection request to the external data source using the connection string that was created when the data was originally imported.</span></span> <span data-ttu-id="2fc74-232">刷新数据期间，需要再次使用该连接字符串中指定的服务器位置、数据库名称和身份验证参数来访问相同的数据源。</span><span class="sxs-lookup"><span data-stu-id="2fc74-232">The server location, database name, and authentication parameters specified in that connection string are now reused during data refresh to access the same data sources.</span></span> <span data-ttu-id="2fc74-233">不能为了刷新数据而修改连接字符串及其整体构造。</span><span class="sxs-lookup"><span data-stu-id="2fc74-233">The connection string and its overall construction cannot be modified for data refresh purposes.</span></span> <span data-ttu-id="2fc74-234">在数据刷新过程中只能按原样再次使用连接字符串。</span><span class="sxs-lookup"><span data-stu-id="2fc74-234">It is simply reused as-is during data refresh.</span></span> <span data-ttu-id="2fc74-235">在某些情况下，如果您使用 Windows 身份验证之外的方式连接数据源，则可以覆盖该连接字符串中的用户名和密码。</span><span class="sxs-lookup"><span data-stu-id="2fc74-235">In some cases, if you are using non-Windows authentication to connect to a data source, you can override the user name and password in the connection string.</span></span> <span data-ttu-id="2fc74-236">本主题下文将对此进行详细解释。</span><span class="sxs-lookup"><span data-stu-id="2fc74-236">More detail about this is provided further on in this topic.</span></span>

 <span data-ttu-id="2fc74-237">对于多数工作簿，针对连接的默认身份验证选项是使用可信连接或 Windows 集成安全性，这导致连接字符串中包含 `SSPI=IntegratedSecurity` 或 `SSPI=TrustedConnection`。</span><span class="sxs-lookup"><span data-stu-id="2fc74-237">For most workbooks, the default authentication option on the connection is to use trusted connections or Windows integrated security, resulting in connection strings that include `SSPI=IntegratedSecurity` or `SSPI=TrustedConnection`.</span></span> <span data-ttu-id="2fc74-238">如果在数据刷新期间使用此连接字符串，用于运行数据刷新作业的帐户将成为 "当前用户"。</span><span class="sxs-lookup"><span data-stu-id="2fc74-238">When this connection string is used during data refresh, the account used to run the data refresh job becomes the 'current user'.</span></span> <span data-ttu-id="2fc74-239">因此，此帐户需要对通过可信连接访问的所有外部数据源都具有读取权限。</span><span class="sxs-lookup"><span data-stu-id="2fc74-239">As such, this account needs read permissions on any external data source that is accessed via a trusted connection.</span></span>

 <span data-ttu-id="2fc74-240">**您是否启用了 PowerPivot 无人参与的数据刷新帐户？**</span><span class="sxs-lookup"><span data-stu-id="2fc74-240">**Did you enable the PowerPivot unattended data refresh account?**</span></span>

 <span data-ttu-id="2fc74-241">如果是，则应授予该帐户针对数据刷新期间所访问数据源的读取权限。</span><span class="sxs-lookup"><span data-stu-id="2fc74-241">If yes, then you should grant that account read permissions on data sources that are accessed during data refresh.</span></span> <span data-ttu-id="2fc74-242">此帐户需要读取权限的原因是，在使用默认身份验证选项的工作簿中，无人参与的帐户在数据刷新过程中为 "当前用户"。</span><span class="sxs-lookup"><span data-stu-id="2fc74-242">The reason why this account needs read permissions is because in a workbook that uses the default authentication options, the unattended account will be the 'current user' during data refresh.</span></span> <span data-ttu-id="2fc74-243">除非计划所有者覆盖连接字符串中的凭据，否则此帐户将需要对组织中频繁使用的所有数据源都拥有读取权限。</span><span class="sxs-lookup"><span data-stu-id="2fc74-243">Unless the schedule owner overrides the credentials in the connection string, this account will need read permissions on any number of data sources that are actively used in your organization.</span></span>

 <span data-ttu-id="2fc74-244">**您是否在使用凭据选项 2 允许计划所有者输入 Windows 用户名和密码？**</span><span class="sxs-lookup"><span data-stu-id="2fc74-244">**Are you using credential option 2: allowing the schedule owner to enter a Windows user name and password?**</span></span>

 <span data-ttu-id="2fc74-245">通常，创建 PowerPivot 工作簿的用户已经具有足够的权限，因为该用户最初已经导入了数据。</span><span class="sxs-lookup"><span data-stu-id="2fc74-245">Typically, users who create PowerPivot workbooks already have sufficient permissions because he or she already imported the data in the first place.</span></span> <span data-ttu-id="2fc74-246">如果这些用户随后将数据刷新配置为采用他们自己的 Windows 用户身份运行，则将在数据刷新期间使用他们的 Windows 用户帐户（已经具有数据库权限）来检索数据。</span><span class="sxs-lookup"><span data-stu-id="2fc74-246">If these users subsequently configure data refresh to run under their own Windows user identity, their Windows user account, which already has rights on the database, will be used to retrieve data during data refresh.</span></span> <span data-ttu-id="2fc74-247">已有的权限应该就足够了。</span><span class="sxs-lookup"><span data-stu-id="2fc74-247">Existing permissions should be sufficient.</span></span>

 <span data-ttu-id="2fc74-248">**您是否在使用凭据选项 3，以便使用 Secure Store Service 目标应用程序来提供用来运行数据刷新作业的用户身份？**</span><span class="sxs-lookup"><span data-stu-id="2fc74-248">**Are you using credential option 3: using a Secure Store Service target application to provide a user identity for running data refresh jobs?**</span></span>

 <span data-ttu-id="2fc74-249">用于运行数据刷新作业的任何帐户都需要读取权限，其原因与为 PowerPivot 无人参与的数据刷新帐户描述的原因相同。</span><span class="sxs-lookup"><span data-stu-id="2fc74-249">Any account used to run a data refresh job needs read permissions, for the same reasons as those described for the PowerPivot unattended data refresh account.</span></span>

 <span data-ttu-id="2fc74-250">**如何检查连接字符串以确定您是否能够覆盖数据刷新期间所用的凭据**</span><span class="sxs-lookup"><span data-stu-id="2fc74-250">**How to check connection strings to determine whether you can override credentials used during data refresh**</span></span>

 <span data-ttu-id="2fc74-251">如上所述，如果连接使用 Windows 身份验证之外的方式（例如 SQL Server 身份验证），则您可以在数据刷新作业级别提供不同的用户名和密码。</span><span class="sxs-lookup"><span data-stu-id="2fc74-251">As previously noted, you can substitute a different user name and password at the data refresh job level if the connection is using non-Windows authentication (for example, SQL Server authentication).</span></span> <span data-ttu-id="2fc74-252">使用用户 ID 和密码参数向连接字符串传递非 Windows 凭据。</span><span class="sxs-lookup"><span data-stu-id="2fc74-252">Non-Windows credentials are passed on the connection string using the User ID and Password parameters.</span></span> <span data-ttu-id="2fc74-253">如果工作簿包含具有这些参数的连接字符串，您可以选择指定不同的用户名和密码，用来刷新来自该数据源的数据。</span><span class="sxs-lookup"><span data-stu-id="2fc74-253">If your workbook contains a connection string with these parameters, you can optionally specify a different user name and password for refreshing data from that data source.</span></span>

 <span data-ttu-id="2fc74-254">以下各步解释如何确定您的连接字符串是否接受用户名和密码覆盖。</span><span class="sxs-lookup"><span data-stu-id="2fc74-254">The following steps explain how to determine whether you have a connection string that accepts user name and password overrides.</span></span>

1.  <span data-ttu-id="2fc74-255">在 Excel 中打开工作簿。</span><span class="sxs-lookup"><span data-stu-id="2fc74-255">Open the workbook in Excel.</span></span>

2.  <span data-ttu-id="2fc74-256">打开 PowerPivot 窗口（在 Excel 中的 PowerPivot 功能区上，单击“PowerPivot”窗口）。</span><span class="sxs-lookup"><span data-stu-id="2fc74-256">Open the PowerPivot window (in Excel, on the PowerPivot ribbon, click PowerPivot Window).</span></span>

3.  <span data-ttu-id="2fc74-257">单击 "**设计**"。</span><span class="sxs-lookup"><span data-stu-id="2fc74-257">Click **Design**.</span></span>

4.  <span data-ttu-id="2fc74-258">单击 "**现有连接**"。</span><span class="sxs-lookup"><span data-stu-id="2fc74-258">Click **Existing Connections**.</span></span>

     <span data-ttu-id="2fc74-259">工作簿中使用的所有连接都在 " **PowerPivot 数据连接**" 下列出。</span><span class="sxs-lookup"><span data-stu-id="2fc74-259">All of the connections used in the workbook are listed under **PowerPivot Data Connections**.</span></span>

5.  <span data-ttu-id="2fc74-260">选择该连接并单击 "**编辑**"，然后单击 "**高级**"。</span><span class="sxs-lookup"><span data-stu-id="2fc74-260">Select the connection and click **Edit**, and then click **Advanced**.</span></span> <span data-ttu-id="2fc74-261">连接字符串位于该页底部。</span><span class="sxs-lookup"><span data-stu-id="2fc74-261">The connection string is at the bottom of the page.</span></span>

 <span data-ttu-id="2fc74-262">如果在连接字符串中看到 "**集成安全性 = SSPI** "，则不能在连接字符串中覆盖凭据。</span><span class="sxs-lookup"><span data-stu-id="2fc74-262">If you see **Integrated Security=SSPI** in the connection string, you cannot override the credentials in the connection string.</span></span> <span data-ttu-id="2fc74-263">将始终使用当前用户身份连接，</span><span class="sxs-lookup"><span data-stu-id="2fc74-263">The connection will always use the current user.</span></span> <span data-ttu-id="2fc74-264">忽略您提供的所有凭据。</span><span class="sxs-lookup"><span data-stu-id="2fc74-264">Any credentials that you provide are ignored.</span></span>

 <span data-ttu-id="2fc74-265">如果你看到 "**持久性安全信息 = False，Password = \* \* \* \* \* \* \* \* \* \* \* ，UserID \<userlogin> =**"，则会获得一个将接受凭据替代的连接字符串。</span><span class="sxs-lookup"><span data-stu-id="2fc74-265">If you see **Persist Security Info=False, Password=\*\*\*\*\*\*\*\*\*\*\*, UserID=\<userlogin>**,then you have a connection string that will accept credential overrides.</span></span> <span data-ttu-id="2fc74-266">连接字符串中显示的凭据（如 UserID 和密码）并不是 Windows 凭据，而是对目标数据源有效的数据库登录名或其他登录帐户。</span><span class="sxs-lookup"><span data-stu-id="2fc74-266">Credentials that appear in a connection string (such as UserID and Password) are not Windows credentials, but rather database logins or other sign-in accounts that are valid for the target data source.</span></span>

 <span data-ttu-id="2fc74-267">**如何覆盖连接字符串中的凭据**</span><span class="sxs-lookup"><span data-stu-id="2fc74-267">**How to override credentials in the connection string**</span></span>

 <span data-ttu-id="2fc74-268">通过在数据刷新计划中指定数据源凭据来覆盖凭据。</span><span class="sxs-lookup"><span data-stu-id="2fc74-268">Overriding credentials is done by specifying data source credentials in the data refresh schedule.</span></span> <span data-ttu-id="2fc74-269">作为管理员，您可以提供 Secure Store Service 中的目标应用程序来映射用来访问外部数据的凭据。</span><span class="sxs-lookup"><span data-stu-id="2fc74-269">As an administrator, you can provide a target application in Secure Store Service that maps the credentials used to access external data.</span></span> <span data-ttu-id="2fc74-270">然后，计划所有者可以在数据刷新计划中输入其定义的目标应用程序 ID。</span><span class="sxs-lookup"><span data-stu-id="2fc74-270">The schedule owner can then enter the target application ID in the data refresh schedule that he or she defines.</span></span> <span data-ttu-id="2fc74-271">有关创建此目标应用程序的详细信息，请参阅为[PowerPivot 数据刷新配置存储的凭据 &#40;PowerPivot for SharePoint&#41;](configure-stored-credentials-data-refresh-powerpivot-sharepoint.md)。</span><span class="sxs-lookup"><span data-stu-id="2fc74-271">For more information about creating this target application, see [Configure Stored Credentials for PowerPivot Data Refresh &#40;PowerPivot for SharePoint&#41;](configure-stored-credentials-data-refresh-powerpivot-sharepoint.md).</span></span>

 <span data-ttu-id="2fc74-272">或者，计划所有者可以键入在数据刷新期间用于连接数据源的一组凭据。</span><span class="sxs-lookup"><span data-stu-id="2fc74-272">Alternatively, the schedule owner can type in the set of credentials that are used to connect to data sources during data refresh.</span></span> <span data-ttu-id="2fc74-273">下图显示了计划定义页中的这一数据源选项。</span><span class="sxs-lookup"><span data-stu-id="2fc74-273">The following illustration shows this data source option in the schedule definition page.</span></span>

 <span data-ttu-id="2fc74-274">![SSAS_PowerPivotKJ_DataRefreshDSOptions](media/ssas-powerpivotkj-datarefreshdsoptions.gif "SSAS_PowerPivotKJ_DataRefreshDSOptions")</span><span class="sxs-lookup"><span data-stu-id="2fc74-274">![SSAS_PowerPivotKJ_DataRefreshDSOptions](media/ssas-powerpivotkj-datarefreshdsoptions.gif "SSAS_PowerPivotKJ_DataRefreshDSOptions")</span></span>

 <span data-ttu-id="2fc74-275">**标识数据访问要求**</span><span class="sxs-lookup"><span data-stu-id="2fc74-275">**Identifying data access requirements**</span></span>

 <span data-ttu-id="2fc74-276">如上所述，用于运行数据刷新和连接外部数据源的帐户经常是同一个帐户。</span><span class="sxs-lookup"><span data-stu-id="2fc74-276">As noted in previous sections, the account used to run data refresh and connect to external data sources is often one and the same.</span></span> <span data-ttu-id="2fc74-277">因此，用于访问外部数据源的帐户由数据刷新计划页这一部分中设置的选项来决定。</span><span class="sxs-lookup"><span data-stu-id="2fc74-277">As such, the account used to access external data sources is determined by the options set in this part of the data refresh schedule page.</span></span> <span data-ttu-id="2fc74-278">该帐户可能是 PowerPivot 无人参与的数据刷新帐户、个人用户的 Windows 帐户，或是存储在预定义目标应用程序中的帐户。</span><span class="sxs-lookup"><span data-stu-id="2fc74-278">This might be the PowerPivot unattended data refresh account, the Windows account of an individual user, or the account that is stored in a predefined target application.</span></span>

 <span data-ttu-id="2fc74-279">![SSAS_PowerpivotKJ_DataRefreshCreds](media/ssas-powerpivotkj-datarefreshcreds.gif "SSAS_PowerpivotKJ_DataRefreshCreds")</span><span class="sxs-lookup"><span data-stu-id="2fc74-279">![SSAS_PowerpivotKJ_DataRefreshCreds](media/ssas-powerpivotkj-datarefreshcreds.gif "SSAS_PowerpivotKJ_DataRefreshCreds")</span></span>

 <span data-ttu-id="2fc74-280">如果运行数据刷新所用的帐户不同于导入数据所用的帐户（例如，通过凭据选项 1 设置的 PowerPivot 无人参与数据刷新帐户或是通过凭据选项 3 设置的其他任何一组存储凭据），您将需要为该帐户创建新的数据库登录名，并授予其针对外部数据源的读取权限。</span><span class="sxs-lookup"><span data-stu-id="2fc74-280">In cases where the account used to run data refresh is different from the account used to import data (for example, the PowerPivot unattended data refresh account via credential option one, or some other set of stored credentials via credential option three), you will need to create a new database login for that account and grant it read permissions on the external data sources.</span></span>

 <span data-ttu-id="2fc74-281">在了解哪些帐户需要数据访问权限后，您可以开始检查在 PowerPivot 工作簿中最常用的数据源的权限。</span><span class="sxs-lookup"><span data-stu-id="2fc74-281">Once you understand which accounts require data access, you can begin to check permissions on the data sources that are most often used in PowerPivot workbooks.</span></span> <span data-ttu-id="2fc74-282">从频繁使用的任何数据仓库或报告数据库开始，但同时也要询问您最活跃的 PowerPivot 用户，了解他们所用的数据源。</span><span class="sxs-lookup"><span data-stu-id="2fc74-282">Start with any data warehouses or reporting databases that are actively used, but also solicit input from your most active PowerPivot users to find out which data sources they are using.</span></span> <span data-ttu-id="2fc74-283">掌握数据源列表后，则可以开始检查各个数据源，确保权限设置正确。</span><span class="sxs-lookup"><span data-stu-id="2fc74-283">Once you have a list of data sources, you can begin checking each one to ensure that permissions are set correctly.</span></span>

##  <a name="step-7-enable-workbook-upgrade-for-data-refresh"></a><a name="bkmk_upgradewrkbk"></a><span data-ttu-id="2fc74-284">步骤7：启用工作簿升级以进行数据刷新</span><span class="sxs-lookup"><span data-stu-id="2fc74-284">Step 7: Enable workbook upgrade for data refresh</span></span>
 <span data-ttu-id="2fc74-285">默认情况下，在 PowerPivot for SharePoint 的 [!INCLUDE[ssKilimanjaro](../includes/sskilimanjaro-md.md)] 版本上，无法将使用 PowerPivot for Excel 的 [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] 版本创建的工作簿配置用于计划数据刷新。</span><span class="sxs-lookup"><span data-stu-id="2fc74-285">By default, workbooks that were created using the [!INCLUDE[ssKilimanjaro](../includes/sskilimanjaro-md.md)] version of PowerPivot for Excel cannot be configured for scheduled data refresh on a [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] version of PowerPivot for SharePoint.</span></span> <span data-ttu-id="2fc74-286">如果在 SharePoint 环境中同时托管 PowerPivot 工作簿的较新版本和较旧版本，则必须先升级所有 [!INCLUDE[ssKilimanjaro](../includes/sskilimanjaro-md.md)] 工作簿，然后才能安排在服务器上对这些工作簿执行自动数据刷新。</span><span class="sxs-lookup"><span data-stu-id="2fc74-286">If you host newer and older versions of PowerPivot workbooks in your SharePoint environment, you must upgrade any [!INCLUDE[ssKilimanjaro](../includes/sskilimanjaro-md.md)] workbooks first before they can be scheduled for automatic data refresh on the server.</span></span>

##  <a name="step-8-verify-data-refresh-configuration"></a><a name="bkmk_verify"></a><span data-ttu-id="2fc74-287">步骤8：验证数据刷新配置</span><span class="sxs-lookup"><span data-stu-id="2fc74-287">Step 8: Verify data refresh configuration</span></span>
 <span data-ttu-id="2fc74-288">若要验证数据刷新，您必须具有发布到 SharePoint 站点的 PowerPivot 工作簿。</span><span class="sxs-lookup"><span data-stu-id="2fc74-288">To verify data refresh, you must have a PowerPivot workbook that is published to a SharePoint site.</span></span> <span data-ttu-id="2fc74-289">您必须具有针对该工作簿的“参与讨论”权限，以及访问数据刷新计划中包括的任何数据源所需的权限。</span><span class="sxs-lookup"><span data-stu-id="2fc74-289">You must have Contribute permissions on the workbook and permissions to access any data sources that are included in the data refresh schedule.</span></span>

 <span data-ttu-id="2fc74-290">创建计划时，请选中 "**也尽快刷新**" 复选框以立即运行数据刷新。</span><span class="sxs-lookup"><span data-stu-id="2fc74-290">When you create the schedule, select the **Also refresh as soon as possible** checkbox to run data refresh immediately.</span></span> <span data-ttu-id="2fc74-291">随后可以检查该工作簿的数据刷新历史记录页，验证刷新是否成功。</span><span class="sxs-lookup"><span data-stu-id="2fc74-291">You can then check the data refresh history page of that workbook to verify that it ran successfully.</span></span> <span data-ttu-id="2fc74-292">请记住“PowerPivot 数据刷新计时器作业”每分钟运行一次。</span><span class="sxs-lookup"><span data-stu-id="2fc74-292">Recall that the PowerPivot Data Refresh timer job runs every minute.</span></span> <span data-ttu-id="2fc74-293">所以至少也需要同样长的时间才能得到关于数据刷新成功与否的确认。</span><span class="sxs-lookup"><span data-stu-id="2fc74-293">It will take at least that long to get confirmation that data refresh succeeded.</span></span>

 <span data-ttu-id="2fc74-294">务必尝试您计划支持的所有凭据选项。</span><span class="sxs-lookup"><span data-stu-id="2fc74-294">Be sure to try all of the credential options you plan to support.</span></span> <span data-ttu-id="2fc74-295">例如，如果配置了 PowerPivot 无人参与的数据刷新帐户，请验证使用该选项是否成功执行了数据刷新。</span><span class="sxs-lookup"><span data-stu-id="2fc74-295">For example, if you configured the PowerPivot unattended data refresh account, verify that data refresh succeeds using that option.</span></span> <span data-ttu-id="2fc74-296">有关计划和查看状态信息的详细信息，请参阅[计划数据刷新 &#40;PowerPivot for SharePoint&#41;](schedule-a-data-refresh-powerpivot-for-sharepoint.md)和[查看数据刷新历史记录 &#40;PowerPivot for SharePoint&#41;](power-pivot-sharepoint/view-data-refresh-history-power-pivot-for-sharepoint.md)。</span><span class="sxs-lookup"><span data-stu-id="2fc74-296">For more information about scheduling and viewing status information, see [Schedule a Data Refresh &#40;PowerPivot for SharePoint&#41;](schedule-a-data-refresh-powerpivot-for-sharepoint.md) and [View Data Refresh History &#40;PowerPivot for SharePoint&#41;](power-pivot-sharepoint/view-data-refresh-history-power-pivot-for-sharepoint.md).</span></span>

 <span data-ttu-id="2fc74-297">如果数据刷新失败，请参考 TechNet wiki 上的[PowerPivot 数据刷新故障排除](https://go.microsoft.com/fwlink/?LinkID=223279)页，了解可能的解决方法。</span><span class="sxs-lookup"><span data-stu-id="2fc74-297">If data refresh fails, refer to the [Troubleshooting PowerPivot Data Refresh](https://go.microsoft.com/fwlink/?LinkID=223279) page on the TechNet wiki for possible solutions.</span></span>

##  <a name="modify-configuration-settings-for-data-refresh"></a><a name="bkmk_config"></a><span data-ttu-id="2fc74-298">为数据刷新修改配置设置</span><span class="sxs-lookup"><span data-stu-id="2fc74-298">Modify Configuration Settings for Data Refresh</span></span>
 <span data-ttu-id="2fc74-299">每个 PowerPivot 服务应用程序都具有影响数据刷新操作的配置设置。</span><span class="sxs-lookup"><span data-stu-id="2fc74-299">Each PowerPivot service application has configuration settings that affect data refresh operations.</span></span> <span data-ttu-id="2fc74-300">本节介绍如何修改这些设置。</span><span class="sxs-lookup"><span data-stu-id="2fc74-300">This section explains how to modify those settings.</span></span>

###  <a name="set-business-hours-to-determine-off-hours-processing"></a><a name="procIntervals"></a><span data-ttu-id="2fc74-301">设置 "工作时间" 来确定非工作时间处理</span><span class="sxs-lookup"><span data-stu-id="2fc74-301">Set 'Business Hours' to determine off-hours processing</span></span>
 <span data-ttu-id="2fc74-302">计划数据刷新操作的 SharePoint 用户可以指定“在工作时间后”的最早开始时间。</span><span class="sxs-lookup"><span data-stu-id="2fc74-302">SharePoint users who schedule data refresh operations can specify an earliest start time of "After business hours".</span></span> <span data-ttu-id="2fc74-303">如果用户要检索在工作日内累计的业务交易数据，则这可能会很有用。</span><span class="sxs-lookup"><span data-stu-id="2fc74-303">This may be useful if they want to retrieve business transaction data that accumulated during the business day.</span></span> <span data-ttu-id="2fc74-304">作为场管理员，您可以为您的组织指定最恰当地定义工作日的小时数范围。</span><span class="sxs-lookup"><span data-stu-id="2fc74-304">As a farm administrator, you can specify the range of hours that best defines a business day for your organization.</span></span> <span data-ttu-id="2fc74-305">如果将工作日定义为从 04:00 到 20:00，则基于开始时间为“在工作时间后”的数据刷新处理将在 20:01 开始。</span><span class="sxs-lookup"><span data-stu-id="2fc74-305">If you define the business day to be from 04:00 to 20:00, then data refresh processing that is based on an "After business hours" start time will begin at 20:01.</span></span>

 <span data-ttu-id="2fc74-306">在非工作时间内运行的数据刷新请求将按照接收该请求的顺序添加到队列中。</span><span class="sxs-lookup"><span data-stu-id="2fc74-306">Data refresh requests that run during off-hours are added to the queue in the order in which the request is received.</span></span> <span data-ttu-id="2fc74-307">在服务器资源变得可用时，将处理各个请求。</span><span class="sxs-lookup"><span data-stu-id="2fc74-307">Individual requests will be processed as server resources become available.</span></span>

1.  <span data-ttu-id="2fc74-308">在管理中心的 "应用程序管理" 中，单击 "**管理服务应用程序**"。</span><span class="sxs-lookup"><span data-stu-id="2fc74-308">In Central Administration, in Application Management, click **Manage Service Applications**.</span></span>

2.  <span data-ttu-id="2fc74-309">单击 PowerPivot 服务应用程序名称。</span><span class="sxs-lookup"><span data-stu-id="2fc74-309">Click the PowerPivot service application name.</span></span> <span data-ttu-id="2fc74-310">PowerPivot 管理面板将出现。</span><span class="sxs-lookup"><span data-stu-id="2fc74-310">The PowerPivot Management Dashboard appears.</span></span>

3.  <span data-ttu-id="2fc74-311">在 "操作" 中，单击 "**配置服务应用程序设置**" 以打开 "PowerPivot 服务应用程序设置" 页</span><span class="sxs-lookup"><span data-stu-id="2fc74-311">In Actions, click **Configure service application settings** to open the PowerPivot Service Application Settings page</span></span>

4.  <span data-ttu-id="2fc74-312">在“数据刷新”部分的“工作时间”中输入开始时间和结束时间，以定义工作时间后的处理期间。</span><span class="sxs-lookup"><span data-stu-id="2fc74-312">In the Data Refresh section, in Business Hours, enter a start time and end time that defines the after business hours processing period.</span></span>

     <span data-ttu-id="2fc74-313">如果您不希望定义非工作时间处理期间，可以在“开始时间”和“结束时间”中输入同样的值（例如，两个时间均为 12:00）。</span><span class="sxs-lookup"><span data-stu-id="2fc74-313">If you do not want an off-hours processing period defined, you can enter the same value for both Start Time and End Time (for example, 12:00 for both times).</span></span> <span data-ttu-id="2fc74-314">但应注意，SharePoint 站点上的计划定义页仍将“在工作时间后”作为一个选项。</span><span class="sxs-lookup"><span data-stu-id="2fc74-314">However, be aware that the schedule definition pages on the SharePoint sites will still have "After business hours" as an option.</span></span> <span data-ttu-id="2fc74-315">在未定义非工作时间处理范围的场中选择该选项的用户将最终获得数据刷新错误，因为处理作业无法开始。</span><span class="sxs-lookup"><span data-stu-id="2fc74-315">Users who select that option on a farm that has no off-hour processing range defined for it will eventually get data refresh errors as processing jobs fail to start.</span></span>

5.  <span data-ttu-id="2fc74-316">单击“确定”  。</span><span class="sxs-lookup"><span data-stu-id="2fc74-316">Click **OK**.</span></span>

###  <a name="limit-how-long-data-refresh-history-is-retained"></a><a name="usagehist"></a><span data-ttu-id="2fc74-317">限制数据刷新历史记录的保留时间</span><span class="sxs-lookup"><span data-stu-id="2fc74-317">Limit how long data refresh history is retained</span></span>
 <span data-ttu-id="2fc74-318">数据刷新历史记录用于详细记录数据刷新操作随着时间推移生成的成功和失败消息。</span><span class="sxs-lookup"><span data-stu-id="2fc74-318">Data refresh history is a detailed record of the success and failure messages that are generated for data refresh operations over time.</span></span> <span data-ttu-id="2fc74-319">通过场中的使用情况数据收集系统可以收集和管理历史记录信息。</span><span class="sxs-lookup"><span data-stu-id="2fc74-319">History information is gathered and managed through the usage data collection system in the farm.</span></span> <span data-ttu-id="2fc74-320">因此，您对使用情况数据历史记录设置的限制也适用于数据刷新历史记录。</span><span class="sxs-lookup"><span data-stu-id="2fc74-320">As such, limits that you set on usage data history also apply to data refresh history.</span></span> <span data-ttu-id="2fc74-321">因为使用情况活动报表将来自整个 PowerPivot 系统的数据收集在一起，所以，单个历史记录设置用于同时为数据刷新历史记录和所收集和存储的所有其他使用情况数据控制数据保留事宜。</span><span class="sxs-lookup"><span data-stu-id="2fc74-321">Because the usage activity reports pull together data from across the PowerPivot system, a single history setting is used to control data retention for both data refresh history and all other usage data that is collected and stored.</span></span>

1.  <span data-ttu-id="2fc74-322">在管理中心的 "应用程序管理" 中，单击 "**管理服务应用程序**"。</span><span class="sxs-lookup"><span data-stu-id="2fc74-322">In Central Administration, in Application Management, click **Manage Service Applications**.</span></span>

2.  <span data-ttu-id="2fc74-323">单击 PowerPivot 服务应用程序名称。</span><span class="sxs-lookup"><span data-stu-id="2fc74-323">Click the PowerPivot service application name.</span></span> <span data-ttu-id="2fc74-324">PowerPivot 管理面板将出现。</span><span class="sxs-lookup"><span data-stu-id="2fc74-324">The PowerPivot Management Dashboard appears.</span></span>

3.  <span data-ttu-id="2fc74-325">在 "操作" 中，单击 "**配置服务应用程序设置**" 以打开 "PowerPivot 服务应用程序设置" 页</span><span class="sxs-lookup"><span data-stu-id="2fc74-325">In Actions, click **Configure service application settings** to open the PowerPivot Service Application Settings page</span></span>

4.  <span data-ttu-id="2fc74-326">在“使用情况数据收集”部分的“使用情况数据历史记录”中，键入您希望为每个工作簿保留数据刷新活动记录的天数。</span><span class="sxs-lookup"><span data-stu-id="2fc74-326">In the Usage Data Collection section, in Usage Data History, type the number of days for which you want to keep a record of data refresh activity for each workbook.</span></span>

     <span data-ttu-id="2fc74-327">默认值为 365 天。</span><span class="sxs-lookup"><span data-stu-id="2fc74-327">The default is 365 days.</span></span> <span data-ttu-id="2fc74-328">最小值为 1 天，最大值为 5000 天。</span><span class="sxs-lookup"><span data-stu-id="2fc74-328">The minimum value is 1 day and the maximum is 5000 days.</span></span> <span data-ttu-id="2fc74-329">0 指定保留期不受限制；数据始终不会被删除。</span><span class="sxs-lookup"><span data-stu-id="2fc74-329">0 specifies an unlimited retention period; data is never deleted.</span></span> <span data-ttu-id="2fc74-330">请注意，不存在用于关闭历史记录的设置。</span><span class="sxs-lookup"><span data-stu-id="2fc74-330">Note that there is no setting for turning off history.</span></span>

5.  <span data-ttu-id="2fc74-331">单击“确定”  。</span><span class="sxs-lookup"><span data-stu-id="2fc74-331">Click **OK**.</span></span>

 <span data-ttu-id="2fc74-332">当 SharePoint 用户在具有数据刷新历史记录的工作簿上选择“管理数据刷新”选项时，这些用户将可以使用历史记录信息。</span><span class="sxs-lookup"><span data-stu-id="2fc74-332">History information is made available to SharePoint users when they choose the Manage Data Refresh option on a workbook that has a data refresh history.</span></span> <span data-ttu-id="2fc74-333">场管理员用来管理 PowerPivot 服务操作的 PowerPivot 管理面板中也使用了此信息。</span><span class="sxs-lookup"><span data-stu-id="2fc74-333">This information is also used in the PowerPivot Management Dashboard used by farm administrators to manage PowerPivot service operations.</span></span> <span data-ttu-id="2fc74-334">有关详细信息，请参阅[查看数据刷新历史记录 &#40;PowerPivot for SharePoint&#41;](power-pivot-sharepoint/view-data-refresh-history-power-pivot-for-sharepoint.md)。</span><span class="sxs-lookup"><span data-stu-id="2fc74-334">For more information, see [View Data Refresh History &#40;PowerPivot for SharePoint&#41;](power-pivot-sharepoint/view-data-refresh-history-power-pivot-for-sharepoint.md).</span></span>

 <span data-ttu-id="2fc74-335">历史记录数据的长期物理存储位于 PowerPivot 服务应用程序的 PowerPivot 服务应用程序数据库中。</span><span class="sxs-lookup"><span data-stu-id="2fc74-335">Long-term physical storage of history data is in the PowerPivot service application database for the PowerPivot service application.</span></span> <span data-ttu-id="2fc74-336">有关如何收集和存储使用情况数据的详细信息，请参阅[PowerPivot 使用情况数据收集](power-pivot-sharepoint/power-pivot-usage-data-collection.md)。</span><span class="sxs-lookup"><span data-stu-id="2fc74-336">For more information about how usage data is collected and stored, see [PowerPivot Usage Data Collection](power-pivot-sharepoint/power-pivot-usage-data-collection.md).</span></span>

##  <a name="reschedule-the-powerpivot-data-refresh-timer-job"></a><a name="configTimerJob"></a><span data-ttu-id="2fc74-337">重新计划 PowerPivot 数据刷新计时器作业</span><span class="sxs-lookup"><span data-stu-id="2fc74-337">Reschedule the PowerPivot Data Refresh timer job</span></span>
 <span data-ttu-id="2fc74-338">计划的数据刷新由 PowerPivot 数据刷新计时器作业触发，此作业以一分钟为间隔扫描 PowerPivot 服务应用程序数据库中的计划信息。</span><span class="sxs-lookup"><span data-stu-id="2fc74-338">Scheduled data refresh is triggered by a PowerPivot Data Refresh timer job that scans schedule information in the PowerPivot service application database at one minute intervals.</span></span> <span data-ttu-id="2fc74-339">当数据刷新按计划开始时，计时器作业将请求添加到可用 PowerPivot 服务器上的处理队列中。</span><span class="sxs-lookup"><span data-stu-id="2fc74-339">When data refresh is scheduled to begin, the timer job adds the request to a processing queue on an available PowerPivot server.</span></span>

 <span data-ttu-id="2fc74-340">您可以增加扫描之间的时间长度以作为一种性能优化方法。</span><span class="sxs-lookup"><span data-stu-id="2fc74-340">You can increase the length of time between scans as a performance tuning technique.</span></span> <span data-ttu-id="2fc74-341">还可以在排除问题时禁用此计时器作业，以暂时停止数据刷新操作。</span><span class="sxs-lookup"><span data-stu-id="2fc74-341">You can also disable the timer job to temporarily stop data refresh operations while you troubleshoot problems.</span></span>

 <span data-ttu-id="2fc74-342">默认设置为一分钟，这是您可以指定的最小值。</span><span class="sxs-lookup"><span data-stu-id="2fc74-342">The default setting is one minute, which is the lowest value you can specify.</span></span> <span data-ttu-id="2fc74-343">这是建议采用的值，因为它可以为在一天中的任意时间运行的计划提供可预测性最好的结果。</span><span class="sxs-lookup"><span data-stu-id="2fc74-343">This value is recommended because it provides the most predictable outcome for schedules that run at arbitrary times throughout the day.</span></span> <span data-ttu-id="2fc74-344">例如，如果用户计划在 4:15 PM 刷新数据，而计时器作业每分钟扫描一次计划，则将在 4:15 检测到计划的数据刷新请求，并在 4:15 后的几分钟内进行处理。</span><span class="sxs-lookup"><span data-stu-id="2fc74-344">For example, if a user schedules data refresh for 4:15 PM, and the timer job scans for schedules every minute, the scheduled data refresh request will be detected at 4:15 and processing will occur within a few minutes of 4:15.</span></span>

 <span data-ttu-id="2fc74-345">如果您加大该扫描时间间隔以便扫描极少运行（例如，每天午夜一次），则计划在该时间间隔中运行的所有数据刷新操作将一次全都添加到处理队列中，这可能导致大量占用服务器资源并且导致其他应用缺乏系统资源。</span><span class="sxs-lookup"><span data-stu-id="2fc74-345">If you raise the scan interval so that it runs very infrequently (for example, once a day at midnight), all of the data refresh operations that were scheduled to run during that interval are added to the processing queue all at once, potentially overwhelming the server and starving other applications of system resources.</span></span> <span data-ttu-id="2fc74-346">根据计划的刷新的数目，数据刷新操作的处理队列可能累积到并非所有作业都能完成的程度。</span><span class="sxs-lookup"><span data-stu-id="2fc74-346">Depending on the number of scheduled refreshes, the processing queue for data refresh operations might build up to such an extent that not all jobs will be able to complete.</span></span> <span data-ttu-id="2fc74-347">当位于队列末尾的数据刷新请求进入下一个处理间隔时，可能导致这些请求被丢弃。</span><span class="sxs-lookup"><span data-stu-id="2fc74-347">Data refresh requests at the end of the queue might be dropped if they run into the next processing interval.</span></span>

 <span data-ttu-id="2fc74-348">如果您的硬件支持，您可以通过指定附加处理器来并行运行多个数据刷新作业，缓解这一问题。</span><span class="sxs-lookup"><span data-stu-id="2fc74-348">If your hardware supports it, you can mitigate this problem by specifying additional processors to run more data refresh jobs in parallel.</span></span> <span data-ttu-id="2fc74-349">有关详细信息，请参阅[配置专用数据刷新或仅限查询的处理 &#40;PowerPivot for SharePoint&#41;](configure-dedicated-data-refresh-query-only-processing-powerpivot-sharepoint.md)。</span><span class="sxs-lookup"><span data-stu-id="2fc74-349">For more information, see [Configure Dedicated Data Refresh or Query-Only Processing &#40;PowerPivot for SharePoint&#41;](configure-dedicated-data-refresh-query-only-processing-powerpivot-sharepoint.md).</span></span> <span data-ttu-id="2fc74-350">有关如何发现数据刷新请求、将其添加到队列和处理的详细信息，请参阅[PowerPivot 数据刷新](power-pivot-sharepoint/power-pivot-data-refresh.md)。</span><span class="sxs-lookup"><span data-stu-id="2fc74-350">For more information about how data refresh requests are discovered, added to a queue, and processed, see [PowerPivot Data Refresh](power-pivot-sharepoint/power-pivot-data-refresh.md).</span></span>

1.  <span data-ttu-id="2fc74-351">在管理中心中，单击 **“监视”**。</span><span class="sxs-lookup"><span data-stu-id="2fc74-351">In Central Administration, click **Monitoring**.</span></span>

2.  <span data-ttu-id="2fc74-352">单击 **“检查作业定义”**。</span><span class="sxs-lookup"><span data-stu-id="2fc74-352">Click **Review Job Definitions**.</span></span>

3.  <span data-ttu-id="2fc74-353">选择**PowerPivot 数据刷新计时器作业**。</span><span class="sxs-lookup"><span data-stu-id="2fc74-353">Select the **PowerPivot Data Refresh Timer Job**.</span></span>

4.  <span data-ttu-id="2fc74-354">修改计划频率，以更改计时器作业扫描数据刷新计划信息的频率。</span><span class="sxs-lookup"><span data-stu-id="2fc74-354">Modify the schedule frequency to change how often the timer job scans for data refresh schedule information.</span></span>

##  <a name="disable-the-data-refresh-timer-job"></a><a name="bkmk_disableDR"></a><span data-ttu-id="2fc74-355">禁用数据刷新计时器作业</span><span class="sxs-lookup"><span data-stu-id="2fc74-355">Disable the Data Refresh Timer Job</span></span>
 <span data-ttu-id="2fc74-356">PowerPivot 数据刷新计时器作业是场级别计时器作业，可以对场中的所有 PowerPivot 服务器实例启用或禁用此作业。</span><span class="sxs-lookup"><span data-stu-id="2fc74-356">The PowerPivot data refresh timer job is a farm-level timer job that is either enabled or disabled for all PowerPivot server instances in the farm.</span></span> <span data-ttu-id="2fc74-357">它与特定的 Web 应用程序或 PowerPivot 服务应用程序无关。</span><span class="sxs-lookup"><span data-stu-id="2fc74-357">It is not tied to a specific Web application or PowerPivot service application.</span></span> <span data-ttu-id="2fc74-358">您无法在某些服务器上禁用它，以强制对场中的其他服务器进行数据刷新处理。</span><span class="sxs-lookup"><span data-stu-id="2fc74-358">You cannot disable it on some servers to force data refresh processing to other servers in the farm.</span></span>

 <span data-ttu-id="2fc74-359">如果您禁用 PowerPivot 数据刷新计时器作业，则将处理已位于队列中的请求，但在重新启用该作业前，不会添加新请求。</span><span class="sxs-lookup"><span data-stu-id="2fc74-359">If you disable the PowerPivot data refresh timer job, requests that were already in the queue will be processed, but no new requests will be added until you re-enable the job.</span></span> <span data-ttu-id="2fc74-360">系统将不处理计划在过去发生的请求。</span><span class="sxs-lookup"><span data-stu-id="2fc74-360">Requests that were scheduled to occur in the past are not processed.</span></span>

 <span data-ttu-id="2fc74-361">禁用计时器作业不会影响应用程序页中的功能可用性。</span><span class="sxs-lookup"><span data-stu-id="2fc74-361">Disabling the timer job has no effect on feature availability in application pages.</span></span> <span data-ttu-id="2fc74-362">无法删除或隐藏 Web 应用程序中的数据刷新功能。</span><span class="sxs-lookup"><span data-stu-id="2fc74-362">There is no way to remove or hide the data refresh feature in web applications.</span></span> <span data-ttu-id="2fc74-363">具有“参与讨论”权限或更高权限的用户仍可创建新的数据刷新操作计划，即使计时器作业已被永久禁用也不例外。</span><span class="sxs-lookup"><span data-stu-id="2fc74-363">Users who have Contribute permissions or above will still be able to create new schedules for data refresh operations, even if the timer job is permanently disabled.</span></span>

## <a name="see-also"></a><span data-ttu-id="2fc74-364">另请参阅</span><span class="sxs-lookup"><span data-stu-id="2fc74-364">See Also</span></span>
 <span data-ttu-id="2fc74-365">[计划数据刷新 &#40;PowerPivot for SharePoint&#41;](schedule-a-data-refresh-powerpivot-for-sharepoint.md) [配置专用数据刷新或仅限查询的处理 &#40;PowerPivot for SharePoint](configure-dedicated-data-refresh-query-only-processing-powerpivot-sharepoint.md)&#41;[配置 Powerpivot 无人参与的数据刷新帐户 &#40;](configure-unattended-data-refresh-account-powerpivot-sharepoint.md) PowerPivot for SharePoint&#41;[为 powerpivot 数据刷新配置存储的凭据 &#40;](configure-stored-credentials-data-refresh-powerpivot-sharepoint.md) PowerPivot for SharePoint&#41;</span><span class="sxs-lookup"><span data-stu-id="2fc74-365">[Schedule a Data Refresh &#40;PowerPivot for SharePoint&#41;](schedule-a-data-refresh-powerpivot-for-sharepoint.md) [Configure Dedicated Data Refresh or Query-Only Processing &#40;PowerPivot for SharePoint&#41;](configure-dedicated-data-refresh-query-only-processing-powerpivot-sharepoint.md) [Configure the PowerPivot Unattended Data Refresh Account &#40;PowerPivot for SharePoint&#41;](configure-unattended-data-refresh-account-powerpivot-sharepoint.md) [Configure Stored Credentials for PowerPivot Data Refresh &#40;PowerPivot for SharePoint&#41;](configure-stored-credentials-data-refresh-powerpivot-sharepoint.md)</span></span>


