---
title: 交叉验证 (Analysis Services 数据挖掘) |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
helpviewer_keywords:
- stored procedures [Analysis Services], data mining
- cross-validation [data mining]
- scoring [data mining]
- accuracy testing [data mining]
ms.assetid: 718b9072-0f35-482a-a803-9178002ff5b9
author: minewiskan
ms.author: owend
ms.openlocfilehash: ea26856075d37d815d819fa0eada61d677f77819
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87581041"
---
# <a name="cross-validation-analysis-services---data-mining"></a><span data-ttu-id="6d804-102">交叉验证（Analysis Services – 数据挖掘）</span><span class="sxs-lookup"><span data-stu-id="6d804-102">Cross-Validation (Analysis Services - Data Mining)</span></span>
  <span data-ttu-id="6d804-103">*交叉验证*是分析中的一个标准工具，是帮助你开发和优化数据挖掘模型的一项重要功能。</span><span class="sxs-lookup"><span data-stu-id="6d804-103">*Cross-validation* is a standard tool in analytics and is an important feature for helping you develop and fine-tune data mining models.</span></span> <span data-ttu-id="6d804-104">在创建了一个挖掘结构及其关联的挖掘模型之后，可使用交叉验证来确定该模型的有效性。</span><span class="sxs-lookup"><span data-stu-id="6d804-104">You use cross-validation after you have created a mining structure and related mining models to ascertain the validity of the model.</span></span>  <span data-ttu-id="6d804-105">交叉验证具有以下应用：</span><span class="sxs-lookup"><span data-stu-id="6d804-105">Cross-validation has the following applications:</span></span>  
  
-   <span data-ttu-id="6d804-106">验证特定挖掘模型的可靠性。</span><span class="sxs-lookup"><span data-stu-id="6d804-106">Validating the robustness of a particular mining model.</span></span>  
  
-   <span data-ttu-id="6d804-107">通过一条语句评估多个模型。</span><span class="sxs-lookup"><span data-stu-id="6d804-107">Evaluating multiple models from a single statement.</span></span>  
  
-   <span data-ttu-id="6d804-108">构建多个模型，然后根据统计标识最好的模型。</span><span class="sxs-lookup"><span data-stu-id="6d804-108">Building multiple models and then identifying the best model based on statistics.</span></span>  
  
 <span data-ttu-id="6d804-109">本节介绍了如何使用提供的交叉验证功能进行数据挖掘，以及如何解释基于单个数据集的一个或多个模型的交叉验证结果。</span><span class="sxs-lookup"><span data-stu-id="6d804-109">This section describes how to use the cross-validation features provided for data mining, and how to interpret the results of cross-validation for either a single model or for multiple models based on a single data set.</span></span>  
  
## <a name="overview-of-cross-validation-process"></a><span data-ttu-id="6d804-110">交叉验证过程概述</span><span class="sxs-lookup"><span data-stu-id="6d804-110">Overview of Cross-Validation Process</span></span>  
 <span data-ttu-id="6d804-111">交叉验证包括两个阶段，即定型阶段和生成结果阶段。</span><span class="sxs-lookup"><span data-stu-id="6d804-111">Cross-validation consists of two phases, training and result generation.</span></span> <span data-ttu-id="6d804-112">这些阶段包括以下步骤：</span><span class="sxs-lookup"><span data-stu-id="6d804-112">These phases include the following steps:</span></span>  
  
-   <span data-ttu-id="6d804-113">选择目标挖掘结构。</span><span class="sxs-lookup"><span data-stu-id="6d804-113">You select a target mining structure.</span></span>  
  
-   <span data-ttu-id="6d804-114">指定要测试的模型。</span><span class="sxs-lookup"><span data-stu-id="6d804-114">You specify the models you want to test.</span></span> <span data-ttu-id="6d804-115">此步骤是可选的；您也可以仅测试挖掘结构。</span><span class="sxs-lookup"><span data-stu-id="6d804-115">This step is optional; you can test just the mining structure as well.</span></span>  
  
-   <span data-ttu-id="6d804-116">指定用于对已定型的模型进行测试的参数。</span><span class="sxs-lookup"><span data-stu-id="6d804-116">You specify the parameters for testing the trained models.</span></span>  
  
    -   <span data-ttu-id="6d804-117">可预测属性、预测值和准确性阈值。</span><span class="sxs-lookup"><span data-stu-id="6d804-117">The predictable attribute, predicted value, and accuracy threshold.</span></span>  
  
    -   <span data-ttu-id="6d804-118">要对结构或模型数据进行分区的折叠数。</span><span class="sxs-lookup"><span data-stu-id="6d804-118">The number of folds into which to partition the structure or model data.</span></span>  
  
-   [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] <span data-ttu-id="6d804-119">根据现有折叠数量创建相同数量的模型并对这些模型进行定型。</span><span class="sxs-lookup"><span data-stu-id="6d804-119">creates and trains as many models as there are folds.</span></span>  
  
-   [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] <span data-ttu-id="6d804-120">为每个模型中的每个折叠或作为整体的数据集返回一组准确性度量。</span><span class="sxs-lookup"><span data-stu-id="6d804-120">returns a set of accuracy metrics for each fold in each model, or for the data set as a whole.</span></span>  
  
## <a name="configuring-cross-validation"></a><span data-ttu-id="6d804-121">配置交叉验证</span><span class="sxs-lookup"><span data-stu-id="6d804-121">Configuring Cross-Validation</span></span>  
 <span data-ttu-id="6d804-122">您可以自定义交叉验证的工作方式，以便控制交叉部分的数目、测试的模型以及预测的准确性栏。</span><span class="sxs-lookup"><span data-stu-id="6d804-122">You can customize the way that cross-validation works to control the number of cross-sections, the models that are tested, and the accuracy bar for predictions.</span></span> <span data-ttu-id="6d804-123">如果使用交叉验证存储过程，还可以指定用于验证模型的数据集。</span><span class="sxs-lookup"><span data-stu-id="6d804-123">If you use the cross-validation stored procedures, you can also specify the data set that is used for validating the models.</span></span> <span data-ttu-id="6d804-124">大量的选择意味着可以轻松生成多组不同的结果，随后必须对这些结果进行比较和分析。</span><span class="sxs-lookup"><span data-stu-id="6d804-124">This wealth of choices means that you can easily produce many sets of different results that must then be compared and analyzed.</span></span>  
  
 <span data-ttu-id="6d804-125">本节提供用于帮助您正确配置交叉验证的信息。</span><span class="sxs-lookup"><span data-stu-id="6d804-125">This section provides information to help you configure cross-validation appropriately.</span></span>  
  
### <a name="setting-the-number-of-partitions"></a><span data-ttu-id="6d804-126">设置分区的数目</span><span class="sxs-lookup"><span data-stu-id="6d804-126">Setting the Number of Partitions</span></span>  
 <span data-ttu-id="6d804-127">在指定分区数目的同时，将要创建的临时模型的数量也随之确定。</span><span class="sxs-lookup"><span data-stu-id="6d804-127">When you specify the number of partitions, you determine how many temporary models will be created.</span></span> <span data-ttu-id="6d804-128">对于每个分区，数据的交叉部分都标记为用作测试集，并通过对不在分区中的其余数据进行定型来创建一个新的模型。</span><span class="sxs-lookup"><span data-stu-id="6d804-128">For each partition, a cross-section of the data is flagged for use as the test set, and a new model is created by training on the remaining data not in the partition.</span></span> <span data-ttu-id="6d804-129">此过程将一直重复，直到 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 创建并测试指定数目的模型后才停止。</span><span class="sxs-lookup"><span data-stu-id="6d804-129">This process is repeated until [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] has created and tested the specified number of models.</span></span> <span data-ttu-id="6d804-130">将指定用于交叉验证的数据在所有分区之间平均分发。</span><span class="sxs-lookup"><span data-stu-id="6d804-130">The data that you specified as being available for cross-validation is distributed evenly among all partitions.</span></span>  
  
 <span data-ttu-id="6d804-131">关系图中的示例说明了数据的用法（如果指定三个折叠）。</span><span class="sxs-lookup"><span data-stu-id="6d804-131">The example in the diagram illustrates the usage of data if three folds are specified.</span></span>  
  
 <span data-ttu-id="6d804-132">![交叉验证如何对数据进行分段](../media/xvoverviewmain.gif "交叉验证如何对数据进行分段")</span><span class="sxs-lookup"><span data-stu-id="6d804-132">![How cross-validation segments data](../media/xvoverviewmain.gif "How cross-validation segments data")</span></span>  
  
 <span data-ttu-id="6d804-133">在该关系图显示的方案中，挖掘结构包含用于测试的维持数据集，但并未包含用于交叉验证的测试数据集。</span><span class="sxs-lookup"><span data-stu-id="6d804-133">In the scenario in the diagram, the mining structure contains a holdout data set that is used for testing, but the test data set has not been included for cross-validation.</span></span> <span data-ttu-id="6d804-134">因此，定型数据集中的所有数据（即挖掘结构中 70% 的数据）都将用于交叉验证。</span><span class="sxs-lookup"><span data-stu-id="6d804-134">As a result, all the data in the training data set, 70 percent of the data in the mining structure, is used for cross-validation.</span></span> <span data-ttu-id="6d804-135">交叉验证报告显示每个分区中使用的事例总数。</span><span class="sxs-lookup"><span data-stu-id="6d804-135">The cross-validation report shows the total number of cases used in each partition.</span></span>  
  
 <span data-ttu-id="6d804-136">您还可以通过指定要使用的总事例数，从而指定交叉验证中使用的数据量。</span><span class="sxs-lookup"><span data-stu-id="6d804-136">You can also specify the amount of data that is used during cross-validation, by specifying the number of overall cases to use.</span></span> <span data-ttu-id="6d804-137">这些事例在所有的折叠间平均分发。</span><span class="sxs-lookup"><span data-stu-id="6d804-137">The cases are distributed evenly across all folds.</span></span>  
  
 <span data-ttu-id="6d804-138">对于存储在 SQL Server [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]实例中的挖掘结构，可设置的折叠数最大值为 256，或者是事例数（以二者中少者计）。</span><span class="sxs-lookup"><span data-stu-id="6d804-138">For mining structures stored in an instance of SQL Server [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)], the maximum value that you can set for the number of folds is 256, or the number of cases, whichever is less.</span></span> <span data-ttu-id="6d804-139">如果使用的是会话挖掘结构，则折叠数的最大值为 10。</span><span class="sxs-lookup"><span data-stu-id="6d804-139">If you are using a session mining structure, the maximum number of folds is 10.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6d804-140">因为必须生成和测试每个折叠的模型，所以执行交叉验证所需的时间会随着折叠数的增加而相应增加。</span><span class="sxs-lookup"><span data-stu-id="6d804-140">As you increase the number of folds, the time required to perform cross-validation increases accordingly, because a model must be generated and tested for each fold.</span></span> <span data-ttu-id="6d804-141">如果折叠数太多，则可能会遇到性能问题。</span><span class="sxs-lookup"><span data-stu-id="6d804-141">You may experience performance problems if the number of folds is too high.</span></span>  
  
### <a name="setting-the-accuracy-threshold"></a><span data-ttu-id="6d804-142">设置准确性阈值</span><span class="sxs-lookup"><span data-stu-id="6d804-142">Setting the Accuracy Threshold</span></span>  
 <span data-ttu-id="6d804-143">可以使用状态阈值设置预测的准确性栏。</span><span class="sxs-lookup"><span data-stu-id="6d804-143">The state threshold lets you set the accuracy bar for predictions.</span></span> <span data-ttu-id="6d804-144">对于每个事例，模型都将计算 *预测概率*，即预测的状态为正确的可能性。</span><span class="sxs-lookup"><span data-stu-id="6d804-144">For each case, the model calculates the *predict probability*, meaning the probability that the predicted state is correct.</span></span> <span data-ttu-id="6d804-145">如果预测概率超出了准确性栏，则将预测计为正确；如果未超出，则将预测计为错误。</span><span class="sxs-lookup"><span data-stu-id="6d804-145">If the predict probability exceeds the accuracy bar, the prediction is counted as correct; if not, the prediction is counted as incorrect.</span></span> <span data-ttu-id="6d804-146">通过将 **“状态阈值”** 设置为介于 0.0 和 1.0 之间的数值来控制此值，其中比较靠近 1 的数字表示在预测方面具有较高的可信度，比较靠近 0 的数字则表示预测的可信度较低。</span><span class="sxs-lookup"><span data-stu-id="6d804-146">You control this value by setting **State Threshold** to a number between 0.0 and 1.0, where numbers closer to 1 indicate a strong level of confidence in the predictions, and numbers closer to 0 indicate that the prediction is less likely to be true.</span></span> <span data-ttu-id="6d804-147">状态阈值的默认值为 NULL，意味着将具有最高概率的预测状态视为目标值。</span><span class="sxs-lookup"><span data-stu-id="6d804-147">The default value for state threshold is NULL, which means that the predicted state with the highest probability is considered the target value.</span></span>  
  
 <span data-ttu-id="6d804-148">您应注意到，状态阈值的设置将影响模型准确性的度量值。</span><span class="sxs-lookup"><span data-stu-id="6d804-148">You should be aware that the setting for state threshold affects measures of model accuracy.</span></span> <span data-ttu-id="6d804-149">例如，假设要测试三个模型。</span><span class="sxs-lookup"><span data-stu-id="6d804-149">For example, assume that you have three models that you want to test.</span></span> <span data-ttu-id="6d804-150">这些模型都基于同一挖掘结构，并且都预测列 [Bike Buyer]。</span><span class="sxs-lookup"><span data-stu-id="6d804-150">All are based on the same mining structure and all predict the column [Bike Buyer].</span></span> <span data-ttu-id="6d804-151">此外，您希望预测单个值 1（表示“是，将要购买”）。</span><span class="sxs-lookup"><span data-stu-id="6d804-151">Moreover, you want to predict a single value of 1, meaning "yes, will buy."</span></span> <span data-ttu-id="6d804-152">三个模型将返回预测概率分别为 0.05、0.15 和 0.8 的预测。</span><span class="sxs-lookup"><span data-stu-id="6d804-152">The three models return predictions with predict probabilities of 0.05, 0.15, and 0.8.</span></span> <span data-ttu-id="6d804-153">如果将状态阈值设置为 0.10，则其中两个预测将计为正确。</span><span class="sxs-lookup"><span data-stu-id="6d804-153">If you set the state threshold to 0.10, two of the predictions are counted as correct.</span></span> <span data-ttu-id="6d804-154">如果将状态阈值设置为 0.5，则仅有一个模型计为已返回正确的预测。</span><span class="sxs-lookup"><span data-stu-id="6d804-154">If you set the state threshold to 0.5, only one model is counted as having returned a correct prediction.</span></span> <span data-ttu-id="6d804-155">如果使用默认值 null，则将可能性最大的预测计为正确。</span><span class="sxs-lookup"><span data-stu-id="6d804-155">If you use the default value, null, the most probable prediction is counted as correct.</span></span> <span data-ttu-id="6d804-156">在这种情况下，所有三个预测都将计为正确。</span><span class="sxs-lookup"><span data-stu-id="6d804-156">In this case, all three predictions would be counted as correct.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6d804-157">可以将阈值设置为 0.0，但是这并没有任何意义，原因是每一个预测都将计为正确，即使那些具有 0 概率的预测也是如此。</span><span class="sxs-lookup"><span data-stu-id="6d804-157">You can set a value of 0.0 for the threshold, but the value is meaningless, because every prediction will be counted as correct, even those with zero probability.</span></span> <span data-ttu-id="6d804-158">请务必小心，勿将 **“状态阈值”** 意外设置为 0.0。</span><span class="sxs-lookup"><span data-stu-id="6d804-158">Be careful not to accidentally set **State Threshold** to 0.0.</span></span>  
  
### <a name="choosing-models-and-columns-to-validate"></a><span data-ttu-id="6d804-159">选择要验证的模型和列</span><span class="sxs-lookup"><span data-stu-id="6d804-159">Choosing Models and Columns to Validate</span></span>  
 <span data-ttu-id="6d804-160">在使用数据挖掘设计器中的 **“交叉验证”** 选项卡时，必须首先从列表中选择可预测列。</span><span class="sxs-lookup"><span data-stu-id="6d804-160">When you use the **Cross Validation** tab in Data Mining Designer, you must first select the predictable column from a list.</span></span> <span data-ttu-id="6d804-161">通常，一个挖掘结构可以支持许多挖掘模型，但这些挖掘模型并不使用同一可预测列。</span><span class="sxs-lookup"><span data-stu-id="6d804-161">Typically, a mining structure can support many mining models, not all of which use the same predictable column.</span></span> <span data-ttu-id="6d804-162">在运行交叉验证时，只有使用同一可预测列的那些模型可以包括在报表中。</span><span class="sxs-lookup"><span data-stu-id="6d804-162">When you run cross-validation, only those models that use the same predictable column can be included in the report.</span></span>  
  
 <span data-ttu-id="6d804-163">若要选择可预测属性，请单击 **“目标属性”** 并从列表中选择列。</span><span class="sxs-lookup"><span data-stu-id="6d804-163">To choose a predictable attribute, click **Target Attribute** and select the column from the list.</span></span> <span data-ttu-id="6d804-164">如果目标属性是嵌套列或嵌套表中的列，则必须使用 \<Nested Table Name> (键) 的格式输入嵌套列的 \<Nested Column> 名称。</span><span class="sxs-lookup"><span data-stu-id="6d804-164">If the target attribute is a nested column, or a column in a nested table, you must type the name of the nested column using the format \<Nested Table Name>(key).\<Nested Column>.</span></span> <span data-ttu-id="6d804-165">如果嵌套表中使用的唯一列是键列，则可以使用 \<Nested Table Name> (键) 。</span><span class="sxs-lookup"><span data-stu-id="6d804-165">If the only column used from the nested table is the key column, you can use \<Nested Table Name>(key).</span></span>  
  
 <span data-ttu-id="6d804-166">选择可预测属性后， [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 将自动测试使用同一可预测属性的所有模型。</span><span class="sxs-lookup"><span data-stu-id="6d804-166">After you select the predictable attribute, [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] automatically tests all models that use the same predictable attribute.</span></span> <span data-ttu-id="6d804-167">如果目标属性包含离散值，则在选择可预测列后，您可以根据需要键入目标状态（如果有要预测的特定值）。</span><span class="sxs-lookup"><span data-stu-id="6d804-167">If the target attribute contains discrete values, after you have selected the predictable column, you can optionally type a target state, if there is a specific value that you want to predict.</span></span>  
  
 <span data-ttu-id="6d804-168">目标状态的选择会影响返回的度量值。</span><span class="sxs-lookup"><span data-stu-id="6d804-168">The selection of the target state affects the measures that are returned.</span></span> <span data-ttu-id="6d804-169">如果指定目标属性（即列名称）且不选取希望模型预测的特定值，则默认情况下将在预测最可能状态时计算模型。</span><span class="sxs-lookup"><span data-stu-id="6d804-169">If you specify a target attribute-that is, a column name-and do not pick a specific value that you want the model to predict, by default the model will be evaluated on its prediction of the most probable state.</span></span>  
  
 <span data-ttu-id="6d804-170">在对聚类分析模型进行交叉验证时，没有可预测列；应从“目标属性”列表框内的列表中选择“分类编号”\*\*\*\*\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="6d804-170">When you use cross-validation with clustering models, there is no predictable column; instead, you select **#Cluster** from the list in the **Target Attribute** list box.</span></span> <span data-ttu-id="6d804-171">选择此选项后，将禁用与聚类分析模型不相关的其他选项（如 **“目标状态”**）。</span><span class="sxs-lookup"><span data-stu-id="6d804-171">After you have selected this option, other options that are not relevant to clustering models, such as **Target State**, are disabled.</span></span> [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] <span data-ttu-id="6d804-172">将测试与该挖掘结构关联的所有聚类分析模型。</span><span class="sxs-lookup"><span data-stu-id="6d804-172">will then test all clustering models that are associated with the mining structure.</span></span>  
  
## <a name="tools-for-cross-validation"></a><span data-ttu-id="6d804-173">用于交叉验证的工具</span><span class="sxs-lookup"><span data-stu-id="6d804-173">Tools for Cross-Validation</span></span>  
 <span data-ttu-id="6d804-174">可以通过数据挖掘设计器执行交叉验证，也可以通过运行存储过程来执行交叉验证。</span><span class="sxs-lookup"><span data-stu-id="6d804-174">You can use cross-validation from the Data Mining Designer, or you can perform cross-validation by running stored procedures.</span></span>  
  
 <span data-ttu-id="6d804-175">如果您使用数据挖掘设计器工具执行交叉验证，则可在单个对话框中配置定型和准确性结果参数。</span><span class="sxs-lookup"><span data-stu-id="6d804-175">If you use the Data Mining Designer tools to perform cross-validation, you can configure the training and accuracy results parameters in a single dialog box.</span></span> <span data-ttu-id="6d804-176">这样更容易设置和查看结果。</span><span class="sxs-lookup"><span data-stu-id="6d804-176">This makes it easier to set up and view results.</span></span> <span data-ttu-id="6d804-177">可以度量与单个挖掘结构关联的所有挖掘模型的准确性，并立即查看 HTML 报告中的结果。</span><span class="sxs-lookup"><span data-stu-id="6d804-177">You can measure the accuracy of all mining models that are related to a single mining structure and then immediately view the results in an HTML report.</span></span> <span data-ttu-id="6d804-178">但是，存储过程提供了一些好处，例如，添加的自定义项和为进程编写脚本的功能。</span><span class="sxs-lookup"><span data-stu-id="6d804-178">However, the stored procedures offer some advantages, such as added customizations and the ability to script the process.</span></span>  
  
### <a name="cross-validation-in-data-mining-designer"></a><span data-ttu-id="6d804-179">数据挖掘设计器中的交叉验证</span><span class="sxs-lookup"><span data-stu-id="6d804-179">Cross-Validation in Data Mining Designer</span></span>  
 <span data-ttu-id="6d804-180">可以使用 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] 或 SQL Server Development Studio 中“挖掘准确性图表”视图的“交叉验证”\*\*\*\* 选项卡来执行交叉验证。</span><span class="sxs-lookup"><span data-stu-id="6d804-180">You can perform cross-validation by using the **Cross-Validation** tab of the Mining Accuracy Chart view in either [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] or SQL Server Development Studio.</span></span>  
  
 <span data-ttu-id="6d804-181">若要查看有关如何使用用户界面创建交叉验证报表的示例，请参阅 [创建交叉验证报表](create-a-cross-validation-report.md)。</span><span class="sxs-lookup"><span data-stu-id="6d804-181">To see an example of how to create a cross-validation report using the user interface, see [Create a Cross-Validation Report](create-a-cross-validation-report.md).</span></span>  
  
### <a name="cross-validation-stored-procedures"></a><span data-ttu-id="6d804-182">交叉验证存储过程</span><span class="sxs-lookup"><span data-stu-id="6d804-182">Cross-Validation Stored Procedures</span></span>  
 <span data-ttu-id="6d804-183">对于高级用户，交叉验证还可以完全参数化的系统存储过程的形式提供。</span><span class="sxs-lookup"><span data-stu-id="6d804-183">For advanced users, cross-validation is also available in the form of fully parameterized system stored procedures.</span></span> <span data-ttu-id="6d804-184">可以通过从 [!INCLUDE[ssASCurrent](../../includes/ssascurrent-md.md)] 或从任何托管代码应用程序连接到 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]实例来运行存储过程。</span><span class="sxs-lookup"><span data-stu-id="6d804-184">You can run the stored procedures by connecting to an instance of [!INCLUDE[ssASCurrent](../../includes/ssascurrent-md.md)] from [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], or from any managed code application.</span></span>  
  
 <span data-ttu-id="6d804-185">存储过程按照挖掘模型类型进行分组。</span><span class="sxs-lookup"><span data-stu-id="6d804-185">The stored procedures are grouped by mining model type.</span></span> <span data-ttu-id="6d804-186">一组存储过程仅使用聚类分析模型。</span><span class="sxs-lookup"><span data-stu-id="6d804-186">One set of stored procedures works with clustering models only.</span></span> <span data-ttu-id="6d804-187">另一组存储过程使用其他挖掘模型。</span><span class="sxs-lookup"><span data-stu-id="6d804-187">The other set of stored procedures works with other mining models.</span></span>  
  
 <span data-ttu-id="6d804-188">对于每种类型的挖掘模型（聚集或非聚集），存储过程将在两个不同的阶段执行交叉验证。</span><span class="sxs-lookup"><span data-stu-id="6d804-188">For each type of mining model, clustered or nonclustered, the stored procedures perform cross-validation in two separate phases.</span></span>  
  
 <span data-ttu-id="6d804-189">**对数据进行分区并生成分区度量**</span><span class="sxs-lookup"><span data-stu-id="6d804-189">**Partition data and generate metrics for partitions**</span></span>  
  
 <span data-ttu-id="6d804-190">在第一个阶段中，您将调用一个系统存储过程，该过程根据您在数据集中指定的数量创建相同数量的分区，并返回每个分区的准确性结果。</span><span class="sxs-lookup"><span data-stu-id="6d804-190">For the first phase, you call a system stored procedure that creates as many partitions as you specify within the data set, and returns accuracy results for each partition.</span></span> <span data-ttu-id="6d804-191">对于每个度量，Analysis Services 都会计算各个分区的平均偏差和标准偏差。</span><span class="sxs-lookup"><span data-stu-id="6d804-191">For each metric, Analysis Services then calculates the mean and standard deviation for the partitions.</span></span>  
  
-   [<span data-ttu-id="6d804-192">SystemGetCrossValidationResults（Analysis Services - 数据挖掘）</span><span class="sxs-lookup"><span data-stu-id="6d804-192">SystemGetCrossValidationResults &#40;Analysis Services - Data Mining&#41;</span></span>](/sql/analysis-services/data-mining/systemgetcrossvalidationresults-analysis-services-data-mining)  
  
-   [<span data-ttu-id="6d804-193">SystemGetClusterCrossValidationResults（Analysis Services - 数据挖掘）</span><span class="sxs-lookup"><span data-stu-id="6d804-193">SystemGetClusterCrossValidationResults &#40;Analysis Services - Data Mining&#41;</span></span>](/sql/analysis-services/data-mining/systemgetclustercrossvalidationresults-analysis-services-data-mining)  
  
 <span data-ttu-id="6d804-194">**生成整个数据集的度量**</span><span class="sxs-lookup"><span data-stu-id="6d804-194">**Generate metrics for entire data set**</span></span>  
  
 <span data-ttu-id="6d804-195">在第二个阶段中，您将调用另一组存储过程。</span><span class="sxs-lookup"><span data-stu-id="6d804-195">In the second phase, you call a different set of stored procedures.</span></span> <span data-ttu-id="6d804-196">这些存储过程不会对数据集进行分区，但会生成整个指定数据集的准确性结果。</span><span class="sxs-lookup"><span data-stu-id="6d804-196">These stored procedures do not partition the data set, but generate accuracy results for the specified data set as a whole.</span></span> <span data-ttu-id="6d804-197">如果您已对挖掘结构进行分区和处理，则可以调用第二组存储过程来获取结果。</span><span class="sxs-lookup"><span data-stu-id="6d804-197">If you have already partitioned and processed a mining structure, you can call this second set of stored procedures to get just the results.</span></span>  
  
-   [<span data-ttu-id="6d804-198">SystemGetAccuracyResults（Analysis Services - 数据挖掘）</span><span class="sxs-lookup"><span data-stu-id="6d804-198">SystemGetAccuracyResults &#40;Analysis Services - Data Mining&#41;</span></span>](/sql/analysis-services/data-mining/systemgetaccuracyresults-analysis-services-data-mining)  
  
-   [<span data-ttu-id="6d804-199">SystemGetClusterAccuracyResults（Analysis Services - 数据挖掘）</span><span class="sxs-lookup"><span data-stu-id="6d804-199">SystemGetClusterAccuracyResults &#40;Analysis Services - Data Mining&#41;</span></span>](/sql/analysis-services/data-mining/systemgetclusteraccuracyresults-analysis-services-data-mining)  
  
#### <a name="defining-the-testing-data"></a><span data-ttu-id="6d804-200">定义测试数据</span><span class="sxs-lookup"><span data-stu-id="6d804-200">Defining the Testing Data</span></span>  
 <span data-ttu-id="6d804-201">在运行计算准确性的交叉验证存储过程（SystemGetAccuracyResults 或 SystemGetClusterAccuracyResults）时，可以指定交叉验证过程中用于测试的数据源。</span><span class="sxs-lookup"><span data-stu-id="6d804-201">When you run the cross-validation stored procedures that calculate accuracy (SystemGetAccuracyResults or SystemGetClusterAccuracyResults), you can specify the source of the data that is used for testing during cross-validation.</span></span> <span data-ttu-id="6d804-202">此选项在用户界面中不可用。</span><span class="sxs-lookup"><span data-stu-id="6d804-202">This option is not available in the user interface.</span></span>  
  
 <span data-ttu-id="6d804-203">可以使用以下任一选项来指定测试数据源：</span><span class="sxs-lookup"><span data-stu-id="6d804-203">You can specify as a testing data source any of the following options:</span></span>  
  
-   <span data-ttu-id="6d804-204">仅使用定型数据。</span><span class="sxs-lookup"><span data-stu-id="6d804-204">Use only the training data.</span></span>  
  
-   <span data-ttu-id="6d804-205">包括现有测试数据集。</span><span class="sxs-lookup"><span data-stu-id="6d804-205">Include an existing testing data set.</span></span>  
  
-   <span data-ttu-id="6d804-206">仅使用测试数据集。</span><span class="sxs-lookup"><span data-stu-id="6d804-206">Use only the testing data set.</span></span>  
  
-   <span data-ttu-id="6d804-207">对每个模型都应用现有的筛选器。</span><span class="sxs-lookup"><span data-stu-id="6d804-207">Apply existing filters to each model.</span></span>  
  
-   <span data-ttu-id="6d804-208">定型集、测试集以及模型筛选器的任意组合。</span><span class="sxs-lookup"><span data-stu-id="6d804-208">Any combination of the training set, testing set, and model filters.</span></span>  
  
 <span data-ttu-id="6d804-209">若要指定测试数据源，您需要为存储过程的 `DataSet` 参数提供一个整数值。</span><span class="sxs-lookup"><span data-stu-id="6d804-209">To specify a testing data source, you provide an integer value for the `DataSet` parameter of the stored procedure.</span></span> <span data-ttu-id="6d804-210">有关参数值的列表，请参阅相关存储过程参考主题的“备注”部分。</span><span class="sxs-lookup"><span data-stu-id="6d804-210">For a list of the argument values, see the Remarks section of the relevant stored procedure reference topic.</span></span>  
  
 <span data-ttu-id="6d804-211">如果使用数据挖掘设计器中的“交叉验证”报表执行交叉验证，则无法更改使用的数据集\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="6d804-211">If you perform cross-validation by using the **Cross-Validation** report in the Data Mining Designer, you cannot change the data set that is used.</span></span> <span data-ttu-id="6d804-212">默认情况下使用每个模型的定型事例。</span><span class="sxs-lookup"><span data-stu-id="6d804-212">By default, the training cases for each model are used.</span></span> <span data-ttu-id="6d804-213">如果筛选器与模型关联，则应用筛选器。</span><span class="sxs-lookup"><span data-stu-id="6d804-213">If a filter is associated with a model, the filter is applied.</span></span>  
  
## <a name="results-of-cross-validation"></a><span data-ttu-id="6d804-214">交叉验证的结果</span><span class="sxs-lookup"><span data-stu-id="6d804-214">Results of Cross-Validation</span></span>  
 <span data-ttu-id="6d804-215">如果使用数据挖掘设计器，则这些结果将显示在类似于网格的 Web 查看器中。</span><span class="sxs-lookup"><span data-stu-id="6d804-215">If you use the Data Mining Designer, these results are displayed in a grid-like Web viewer.</span></span> <span data-ttu-id="6d804-216">如果使用交叉验证存储过程，则这些相同的结果将以表的形式返回。</span><span class="sxs-lookup"><span data-stu-id="6d804-216">If you use the cross-validation stored procedures, these same results are returned as a table.</span></span>  
  
 <span data-ttu-id="6d804-217">报告包含两种类型的度量值：用于在将数据集划分为不同分类时指示数据集的可变性的聚合，以及针对每个分类的特定于模型的准确性度量值。</span><span class="sxs-lookup"><span data-stu-id="6d804-217">The report contains two types of measures: aggregates that indicate the variability of the data set when divided into folds, and model-specific measures of accuracy for each fold.</span></span> <span data-ttu-id="6d804-218">下列主题提供了有关这些度量的详细信息：</span><span class="sxs-lookup"><span data-stu-id="6d804-218">The following topics provide more information about these metrics:</span></span>  
  
 [<span data-ttu-id="6d804-219">交叉验证公式</span><span class="sxs-lookup"><span data-stu-id="6d804-219">Cross-Validation Formulas</span></span>](cross-validation-formulas.md)  
  
 <span data-ttu-id="6d804-220">按测试类型列出所有度量值。</span><span class="sxs-lookup"><span data-stu-id="6d804-220">Lists all the measures by test type.</span></span> <span data-ttu-id="6d804-221">大致介绍解释度量值的方式。</span><span class="sxs-lookup"><span data-stu-id="6d804-221">Describes in general how the measures can be interpreted.</span></span>  
  
 [<span data-ttu-id="6d804-222">交叉验证报表中的度量值</span><span class="sxs-lookup"><span data-stu-id="6d804-222">Measures in the Cross-Validation Report</span></span>](measures-in-the-cross-validation-report.md)  
  
 <span data-ttu-id="6d804-223">描述用于计算每个度量值的公式，并列出每个度量值可应用于的属性的类型。</span><span class="sxs-lookup"><span data-stu-id="6d804-223">Describes the formulas for calculating each measure, and lists the type of attribute that each measure can be applied to.</span></span>  
  
## <a name="restrictions-on-cross-validation"></a><span data-ttu-id="6d804-224">交叉验证限制</span><span class="sxs-lookup"><span data-stu-id="6d804-224">Restrictions on Cross-Validation</span></span>  
 <span data-ttu-id="6d804-225">如果使用 SQL Server Development Studio 中的交叉验证报表来执行交叉验证，则对可以测试的模型和可以设置的参数存在一些限制。</span><span class="sxs-lookup"><span data-stu-id="6d804-225">If you perform cross-validation by using the cross-validation report in SQL Server Development Studio, there are some limitations on the models that you can test and the parameters you can set.</span></span>  
  
-   <span data-ttu-id="6d804-226">默认情况下，与所选挖掘模型关联的所有模型都进行交叉验证。</span><span class="sxs-lookup"><span data-stu-id="6d804-226">By default, all models associated with the selected mining structure are cross-validated.</span></span> <span data-ttu-id="6d804-227">不能指定模型或模型列表。</span><span class="sxs-lookup"><span data-stu-id="6d804-227">You cannot specify the model or a list of models.</span></span>  
  
-   <span data-ttu-id="6d804-228">基于 Microsoft 时序算法或 Microsoft 顺序分析和聚类分析算法的模型不支持交叉验证。</span><span class="sxs-lookup"><span data-stu-id="6d804-228">Cross-validation is not supported for models that are based on the Microsoft Time Series algorithm or the Microsoft Sequence Clustering algorithm.</span></span>  
  
-   <span data-ttu-id="6d804-229">如果挖掘结构不包含可通过交叉验证进行测试的任何模型，则不能创建报表。</span><span class="sxs-lookup"><span data-stu-id="6d804-229">The report cannot be created if your mining structure does not contain any models that can be tested by cross-validation.</span></span>  
  
-   <span data-ttu-id="6d804-230">如果挖掘结构包含聚类分析模型和非聚类分析模型并且你未选择“分类编号”\*\*\*\* 选项，则即使属性、状态和阈值设置可能不适用于聚类分析模型，两种类型模型的结果也都显示在同一报表中。</span><span class="sxs-lookup"><span data-stu-id="6d804-230">If the mining structure contains both clustering and non-clustering models and you do not choose the **#Cluster** option, results for both types of models are displayed in the same report, even though the attribute, state, and threshold settings might not be appropriate for the clustering models.</span></span>  
  
-   <span data-ttu-id="6d804-231">一些参数值受到限制。</span><span class="sxs-lookup"><span data-stu-id="6d804-231">Some parameter values are restricted.</span></span> <span data-ttu-id="6d804-232">例如，如果折叠数大于 10，则会显示警告，因为生成这么多模型可能导致报表显示缓慢。</span><span class="sxs-lookup"><span data-stu-id="6d804-232">For example, a warning is displayed if the number of folds is more than 10, because generating so many models might cause the report to display slowly.</span></span>  
  
 <span data-ttu-id="6d804-233">如果您正测试多个挖掘模型，并且模型都具有筛选器，则分别对每个模型进行筛选。</span><span class="sxs-lookup"><span data-stu-id="6d804-233">If you are testing multiple mining models, and the models have filters, each model is filtered separately.</span></span> <span data-ttu-id="6d804-234">不能在交叉验证过程中向模型添加筛选器或更改模型的筛选器。</span><span class="sxs-lookup"><span data-stu-id="6d804-234">You cannot add a filter to a model or change the filter for a model during cross-validation.</span></span>  
  
 <span data-ttu-id="6d804-235">因为交叉验证在默认情况下对与结构关联的所有挖掘模型进行测试，所以，如果某些模型有筛选器而另一些没有筛选器，则可能会收到不一致的结果。</span><span class="sxs-lookup"><span data-stu-id="6d804-235">Because cross-validation by defaults tests all mining models that are associated with a structure, you may receive inconsistent results if some models have a filter and others do not.</span></span> <span data-ttu-id="6d804-236">若要确保仅对具有相同筛选器的模型进行比较，应使用存储过程并指定一个挖掘模型列表。</span><span class="sxs-lookup"><span data-stu-id="6d804-236">To ensure that you compare only those models that have the same filter, you should use the stored procedures and specify a list of mining models.</span></span> <span data-ttu-id="6d804-237">或者，仅使用没有筛选器的挖掘结构测试集以确保对所有模型使用一致的数据集。</span><span class="sxs-lookup"><span data-stu-id="6d804-237">Or, use only the mining structure test set with no filters to ensure that a consistent set of data is used for all models.</span></span>  
  
 <span data-ttu-id="6d804-238">如果使用存储过程来执行交叉验证，则可以通过其他选项来选择测试数据源。</span><span class="sxs-lookup"><span data-stu-id="6d804-238">If you perform cross-validation by using the stored procedures, you have the additional option of choosing the source of testing data.</span></span> <span data-ttu-id="6d804-239">如果使用数据挖掘设计器执行交叉验证，则必须使用与模型或结构关联的测试数据集（如果有）。</span><span class="sxs-lookup"><span data-stu-id="6d804-239">If you perform cross-validation by using the Data Mining Designer, you must use the testing data set that is associated with the model or structure, if any.</span></span> <span data-ttu-id="6d804-240">通常，若要指定高级设置，则应使用交叉验证存储过程。</span><span class="sxs-lookup"><span data-stu-id="6d804-240">Generally, if you want to specify advanced settings, you should use the cross-validation stored procedures.</span></span>  
  
 <span data-ttu-id="6d804-241">交叉验证不能与时序或顺序分析和聚类分析模型一起使用。</span><span class="sxs-lookup"><span data-stu-id="6d804-241">Cross-validation cannot be used with time series or sequence clustering models.</span></span> <span data-ttu-id="6d804-242">具体而言，交叉验证无法包含具有 KEY TIME 列或 KEY SEQUENCE 列的模型。</span><span class="sxs-lookup"><span data-stu-id="6d804-242">Specifically, no model that contains a KEY TIME column or a KEY SEQUENCE column can be included in cross-validation.</span></span>  
  
## <a name="related-content"></a><span data-ttu-id="6d804-243">相关内容</span><span class="sxs-lookup"><span data-stu-id="6d804-243">Related Content</span></span>  
 <span data-ttu-id="6d804-244">请参阅以下主题以获取有关交叉验证的详细信息或有关用于测试挖掘模型的相关方法的信息（如安全性图表）。</span><span class="sxs-lookup"><span data-stu-id="6d804-244">See the following topics for more information about cross-validation, or information about related methods for testing mining models, such as accuracy charts.</span></span>  
  
|<span data-ttu-id="6d804-245">主题</span><span class="sxs-lookup"><span data-stu-id="6d804-245">Topics</span></span>|<span data-ttu-id="6d804-246">链接</span><span class="sxs-lookup"><span data-stu-id="6d804-246">Links</span></span>|  
|------------|-----------|  
|<span data-ttu-id="6d804-247">介绍如何在 SQL Server Development Studio 中设置交叉验证参数。</span><span class="sxs-lookup"><span data-stu-id="6d804-247">Describes how to set cross-validation parameters in SQL Server Development Studio.</span></span>|[<span data-ttu-id="6d804-248">“交叉验证”选项卡（“挖掘准确性图表”视图）</span><span class="sxs-lookup"><span data-stu-id="6d804-248">Cross-Validation Tab &#40;Mining Accuracy Chart View&#41;</span></span>](../cross-validation-tab-mining-accuracy-chart-view.md)|  
|<span data-ttu-id="6d804-249">介绍由交叉验证提供的度量</span><span class="sxs-lookup"><span data-stu-id="6d804-249">Describes the metrics that are provided by cross-validation</span></span>|[<span data-ttu-id="6d804-250">交叉验证公式</span><span class="sxs-lookup"><span data-stu-id="6d804-250">Cross-Validation Formulas</span></span>](cross-validation-formulas.md)|  
|<span data-ttu-id="6d804-251">说明交叉验证报表格式并定义为每种模型类型提供的统计度量值。</span><span class="sxs-lookup"><span data-stu-id="6d804-251">Explains the cross-validation report format and defines the statistical measures provided for each model type.</span></span>|[<span data-ttu-id="6d804-252">交叉验证报表中的度量值</span><span class="sxs-lookup"><span data-stu-id="6d804-252">Measures in the Cross-Validation Report</span></span>](measures-in-the-cross-validation-report.md)|  
|<span data-ttu-id="6d804-253">列出用于计算交叉验证统计信息的存储过程。</span><span class="sxs-lookup"><span data-stu-id="6d804-253">Lists the stored procedures for computing cross-validation statistics.</span></span>|[<span data-ttu-id="6d804-254">数据挖掘存储过程（Analysis Services - 数据挖掘）</span><span class="sxs-lookup"><span data-stu-id="6d804-254">Data Mining Stored Procedures &#40;Analysis Services - Data Mining&#41;</span></span>](/sql/analysis-services/data-mining/data-mining-stored-procedures-analysis-services-data-mining)|  
|||  
|<span data-ttu-id="6d804-255">介绍如何为挖掘结构和相关模型创建测试数据集。</span><span class="sxs-lookup"><span data-stu-id="6d804-255">Describes how to create a testing data set for mining structures and related models.</span></span>|[<span data-ttu-id="6d804-256">定型数据集和测试数据集</span><span class="sxs-lookup"><span data-stu-id="6d804-256">Training and Testing Data Sets</span></span>](training-and-testing-data-sets.md)|  
|<span data-ttu-id="6d804-257">查看其他安全性图表类型示例。</span><span class="sxs-lookup"><span data-stu-id="6d804-257">See examples of other accuracy chart types.</span></span>|[<span data-ttu-id="6d804-258">分类矩阵（Analysis Services - 数据挖掘）</span><span class="sxs-lookup"><span data-stu-id="6d804-258">Classification Matrix &#40;Analysis Services - Data Mining&#41;</span></span>](classification-matrix-analysis-services-data-mining.md)<br /><br /> [<span data-ttu-id="6d804-259">提升图（Analysis Services - 数据挖掘）</span><span class="sxs-lookup"><span data-stu-id="6d804-259">Lift Chart &#40;Analysis Services - Data Mining&#41;</span></span>](lift-chart-analysis-services-data-mining.md)<br /><br /> [<span data-ttu-id="6d804-260">利润图（Analysis Services - 数据挖掘）</span><span class="sxs-lookup"><span data-stu-id="6d804-260">Profit Chart &#40;Analysis Services - Data Mining&#41;</span></span>](profit-chart-analysis-services-data-mining.md)<br /><br /> [<span data-ttu-id="6d804-261">散点图（Analysis Services - 数据挖掘）</span><span class="sxs-lookup"><span data-stu-id="6d804-261">Scatter Plot &#40;Analysis Services - Data Mining&#41;</span></span>](scatter-plot-analysis-services-data-mining.md)|  
|<span data-ttu-id="6d804-262">介绍创建各种安全性图表的步骤。</span><span class="sxs-lookup"><span data-stu-id="6d804-262">Describes steps for creating various accuracy charts.</span></span>|[<span data-ttu-id="6d804-263">测试和验证任务和操作指南（数据挖掘）</span><span class="sxs-lookup"><span data-stu-id="6d804-263">Testing and Validation Tasks and How-tos &#40;Data Mining&#41;</span></span>](testing-and-validation-tasks-and-how-tos-data-mining.md)|  
  
## <a name="see-also"></a><span data-ttu-id="6d804-264">另请参阅</span><span class="sxs-lookup"><span data-stu-id="6d804-264">See Also</span></span>  
 [<span data-ttu-id="6d804-265">测试和验证（数据挖掘）</span><span class="sxs-lookup"><span data-stu-id="6d804-265">Testing and Validation &#40;Data Mining&#41;</span></span>](testing-and-validation-data-mining.md)  
  
  
