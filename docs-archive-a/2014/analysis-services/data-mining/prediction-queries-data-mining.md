---
title: 数据挖掘)  (预测查询 |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
ms.assetid: e5e6686c-1360-480e-8c0d-8a56204fbed9
author: minewiskan
ms.author: owend
ms.openlocfilehash: 543055aaed5d8991ed2c913a6ae46575c774e216
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87690884"
---
# <a name="prediction-queries-data-mining"></a><span data-ttu-id="ae073-102">预测查询（数据挖掘）</span><span class="sxs-lookup"><span data-stu-id="ae073-102">Prediction Queries (Data Mining)</span></span>
  <span data-ttu-id="ae073-103">典型数据挖掘项目的目标是使用挖掘模型来进行预测。</span><span class="sxs-lookup"><span data-stu-id="ae073-103">The goal of a typical data mining project is to use the mining model to make predictions.</span></span> <span data-ttu-id="ae073-104">例如，您可能希望预测某个服务器群集的预期停机时间量，或者生成一个分数，指示客户群体是否可能会响应广告活动。</span><span class="sxs-lookup"><span data-stu-id="ae073-104">For example, you might want to predict the amount of expected downtime for a certain cluster of servers, or generate a score that indicates whether segments of customers are likely to respond to an advertising campaign.</span></span> <span data-ttu-id="ae073-105">若要执行所有这些操作，您需要创建一个预测查询。</span><span class="sxs-lookup"><span data-stu-id="ae073-105">To do all these things, you would create a prediction query.</span></span>  
  
 <span data-ttu-id="ae073-106">就功能而言，SQL Server 中支持不同类型的预测查询，具体取决于查询的输入类型：</span><span class="sxs-lookup"><span data-stu-id="ae073-106">Functionally, there are different types of prediction queries supported in SQL Server, depending on the type of inputs to the query:</span></span>  
  
|<span data-ttu-id="ae073-107">查询类型</span><span class="sxs-lookup"><span data-stu-id="ae073-107">Query Type</span></span>|<span data-ttu-id="ae073-108">查询选项</span><span class="sxs-lookup"><span data-stu-id="ae073-108">Query Options</span></span>|  
|----------------|-------------------|  
|<span data-ttu-id="ae073-109">单独预测查询</span><span class="sxs-lookup"><span data-stu-id="ae073-109">Singleton prediction queries</span></span>|<span data-ttu-id="ae073-110">当您希望预测单个或多个新事例的结果时，可以使用单独查询。</span><span class="sxs-lookup"><span data-stu-id="ae073-110">Use a singleton query when you want to predict outcomes for a single new case, or multiple new cases.</span></span> <span data-ttu-id="ae073-111">可直接在查询中提供输入值，而查询作为单个会话执行。</span><span class="sxs-lookup"><span data-stu-id="ae073-111">You provide the input values directly in the query, and the query is executed as a single session.</span></span>|  
|<span data-ttu-id="ae073-112">批预测</span><span class="sxs-lookup"><span data-stu-id="ae073-112">Batch predictions</span></span>|<span data-ttu-id="ae073-113">当您具有希望馈送到模型以用作预测基础的外部数据时，可以使用批预测。</span><span class="sxs-lookup"><span data-stu-id="ae073-113">Use batch predictions when you have external data that you want to feed into the model, to use as the basis for predictions.</span></span> <span data-ttu-id="ae073-114">若要对整个数据集进行预测，您可将外部源中的数据映射到模型中的列，然后指定希望输出的预测数据类型。</span><span class="sxs-lookup"><span data-stu-id="ae073-114">To make predictions for an entire set of data, you map the data in the external source to the columns in the model, and then specify the type of predictive data you want to output.</span></span><br /><br /> <span data-ttu-id="ae073-115">对整个数据集的查询是在单个会话中执行的，这使得此选项要比发送多个重复的查询高效得多。</span><span class="sxs-lookup"><span data-stu-id="ae073-115">The query for the entire dataset is executed in a single session, making this option much more efficient than sending multiple repeated queries.</span></span>|  
|<span data-ttu-id="ae073-116">时序预测</span><span class="sxs-lookup"><span data-stu-id="ae073-116">Time Series predictions</span></span>|<span data-ttu-id="ae073-117">当您希望通过一些将来的步骤预测值，可以使用时序查询。</span><span class="sxs-lookup"><span data-stu-id="ae073-117">Use a time series query when you want to predict a value over some number of future steps.</span></span> <span data-ttu-id="ae073-118">SQL Server 数据挖掘还在时序查询中提供以下功能：</span><span class="sxs-lookup"><span data-stu-id="ae073-118">SQL Server Data Mining also provides the following functionality in time series queries:</span></span><br /><br /> <span data-ttu-id="ae073-119">可以通过将新数据添加为查询的一部分来扩展现有模型，并基于组合序列进行预测。</span><span class="sxs-lookup"><span data-stu-id="ae073-119">You can extend an existing model by adding new data as part of the query, and make predictions based on the composite series.</span></span><br /><br /> <span data-ttu-id="ae073-120">可以通过使用 REPLACE_MODEL_CASES 选项向新数据序列应用现有模型。</span><span class="sxs-lookup"><span data-stu-id="ae073-120">You can apply an existing model to a new data series by using the REPLACE_MODEL_CASES option.</span></span><br /><br /> <span data-ttu-id="ae073-121">可以执行交叉预测。</span><span class="sxs-lookup"><span data-stu-id="ae073-121">You can perform cross-prediction.</span></span>|  
  
 <span data-ttu-id="ae073-122">以下部分介绍预测查询的一般语法、不同类型的预测查询以及如何使用预测查询的结果。</span><span class="sxs-lookup"><span data-stu-id="ae073-122">The following sections describe the general syntax of prediction queries, the different types of prediction queries, and how to work with the results of prediction queries.</span></span>  
  
 [<span data-ttu-id="ae073-123">基本预测查询设计</span><span class="sxs-lookup"><span data-stu-id="ae073-123">Basic Prediction Query Design</span></span>](#bkmk_PredQuery)  
  
-   [<span data-ttu-id="ae073-124">添加预测函数</span><span class="sxs-lookup"><span data-stu-id="ae073-124">Adding Prediction Functions</span></span>](#bkmk_PredFunc)  
  
-   [<span data-ttu-id="ae073-125">单独查询</span><span class="sxs-lookup"><span data-stu-id="ae073-125">Singleton Queries</span></span>](#bkmk_SingletonQuery)  
  
-   [<span data-ttu-id="ae073-126">批处理预测查询</span><span class="sxs-lookup"><span data-stu-id="ae073-126">Batch Prediction Queries</span></span>](#bkmk_BatchQuery)  
  
 [<span data-ttu-id="ae073-127">使用查询结果</span><span class="sxs-lookup"><span data-stu-id="ae073-127">Working with the Results of Queries</span></span>](#bkmk_WorkResults)  
  
##  <a name="basic-prediction-query-design"></a><a name="bkmk_PredQuery"></a> <span data-ttu-id="ae073-128">基本的预测查询设计</span><span class="sxs-lookup"><span data-stu-id="ae073-128">Basic Prediction Query Design</span></span>  
 <span data-ttu-id="ae073-129">创建预测时，通常会提供一些新数据，并要求模型基于新数据生成一个预测。</span><span class="sxs-lookup"><span data-stu-id="ae073-129">When you create a prediction, you typically provide some piece of new data and ask the model to generate a prediction based on the new data.</span></span>  
  
-   <span data-ttu-id="ae073-130">在批预测查询中，可通过使用“预测联接” \*\* 将模型映射到外部数据源。</span><span class="sxs-lookup"><span data-stu-id="ae073-130">In a batch prediction query, you map the model to an external source of data by using a *prediction join*.</span></span>  
  
-   <span data-ttu-id="ae073-131">在单独预测查询中，可键入一个或多个值以用作输入。</span><span class="sxs-lookup"><span data-stu-id="ae073-131">In a singleton prediction query, you type one or more values to use as inputs.</span></span> <span data-ttu-id="ae073-132">您可以使用单独预测查询来创建多个预测。</span><span class="sxs-lookup"><span data-stu-id="ae073-132">You can create multiple predictions using a singleton prediction query.</span></span> <span data-ttu-id="ae073-133">但是，如果您需要创建多个预测，那么使用批查询时的性能会更好。</span><span class="sxs-lookup"><span data-stu-id="ae073-133">However, if you need to create many predictions, performance is better when you use a batch query.</span></span>  
  
 <span data-ttu-id="ae073-134">单独预测查询和批预测查询都使用 PREDICTION JOIN 语法来定义新数据。</span><span class="sxs-lookup"><span data-stu-id="ae073-134">Both singleton and batch prediction queries use the PREDICTION JOIN syntax to define the new data.</span></span> <span data-ttu-id="ae073-135">这两者的区别在于指定预测联接的输入端的方式。</span><span class="sxs-lookup"><span data-stu-id="ae073-135">The difference is in how the input side of the prediction join is specified.</span></span>  
  
-   <span data-ttu-id="ae073-136">在批预测查询中，数据来自使用 OPENQUERY 语法指定的外部数据源。</span><span class="sxs-lookup"><span data-stu-id="ae073-136">In a batch prediction query, the data comes from an external data source that is specified by using the OPENQUERY syntax.</span></span>  
  
-   <span data-ttu-id="ae073-137">在单独预测查询中，数据是作为查询的一部分内联提供的。</span><span class="sxs-lookup"><span data-stu-id="ae073-137">In a singleton prediction query, the data is supplied inline as part of the query.</span></span>  
  
 <span data-ttu-id="ae073-138">对于时序模型，不总是需要输入数据；可以仅使用模型中现有的数据进行预测。</span><span class="sxs-lookup"><span data-stu-id="ae073-138">For time series models, input data is not always required; it is possible to make predictions using just the data already in the model.</span></span> <span data-ttu-id="ae073-139">但是，如果您指定了新的输入数据，则必须确定是使用新数据更新和扩展模型，还是替换模型中已使用的原始数据序列。</span><span class="sxs-lookup"><span data-stu-id="ae073-139">However, if you do specify new input data, you must decide whether you will use the new data to update and extend the model, or to replace the original series of data that was used in the model.</span></span>  <span data-ttu-id="ae073-140">有关这些选项的详细信息，请参阅 [Time Series Model Query Examples](time-series-model-query-examples.md)。</span><span class="sxs-lookup"><span data-stu-id="ae073-140">For more information about these options, see [Time Series Model Query Examples](time-series-model-query-examples.md).</span></span>  
  
###  <a name="adding-prediction-functions"></a><a name="bkmk_PredFunc"></a><span data-ttu-id="ae073-141">添加预测函数</span><span class="sxs-lookup"><span data-stu-id="ae073-141">Adding Prediction Functions</span></span>  
 <span data-ttu-id="ae073-142">除了预测值，您还可以自定义预测查询，以返回与预测有关的各种类型的信息。</span><span class="sxs-lookup"><span data-stu-id="ae073-142">In addition to predicting a value, you can customize a prediction query to return various kinds of information that are related to the prediction.</span></span> <span data-ttu-id="ae073-143">例如，如果预测创建向客户推荐的产品的列表，则您还可能要返回每项预测的概率，以便可以对预测进行排名并且仅向用户展示最有价值的建议。</span><span class="sxs-lookup"><span data-stu-id="ae073-143">For example, if the prediction creates a list of products to recommend to a customer, you might also want to return the probability for each prediction, so that you can rank them and present only the top recommendations to the user.</span></span>  
  
 <span data-ttu-id="ae073-144">为此，您将向添加查询“预测函数” \*\* 。</span><span class="sxs-lookup"><span data-stu-id="ae073-144">To do this, you add *prediction functions* to the query.</span></span> <span data-ttu-id="ae073-145">每个模型或查询类型都支持特定的函数。</span><span class="sxs-lookup"><span data-stu-id="ae073-145">Each model or query type supports specific functions.</span></span> <span data-ttu-id="ae073-146">例如，聚类分析模型支持特殊预测函数，这些函数提供有关模型创建的分类的额外详细信息，而时序模型具有计算随时间的变化的函数。</span><span class="sxs-lookup"><span data-stu-id="ae073-146">For example, clustering models support special prediction functions that provide extra detail about the clusters created by the model, whereas time series models have functions that calculate differences over time.</span></span> <span data-ttu-id="ae073-147">还有可处理几乎所有模型类型的通用预测函数。</span><span class="sxs-lookup"><span data-stu-id="ae073-147">There are also general prediction functions that work with almost all model types.</span></span> <span data-ttu-id="ae073-148">有关不同查询类型支持的预测函数的列表，请参阅主题 DMX 引用：[通用预测函数 (DMX)](/sql/dmx/general-prediction-functions-dmx)。</span><span class="sxs-lookup"><span data-stu-id="ae073-148">For a list of the prediction functions supported in different types of queries, see this topic the DMX reference:  [General Prediction Functions &#40;DMX&#41;](/sql/dmx/general-prediction-functions-dmx).</span></span>  
  
###  <a name="creating-singleton-prediction-queries"></a><a name="bkmk_SingletonQuery"></a><span data-ttu-id="ae073-149">创建单独预测查询</span><span class="sxs-lookup"><span data-stu-id="ae073-149">Creating Singleton Prediction Queries</span></span>  
 <span data-ttu-id="ae073-150">如果要实时创建快速预测，则单独预测查询很有用。</span><span class="sxs-lookup"><span data-stu-id="ae073-150">A singleton prediction query is useful when you want to create quick predictions in real time.</span></span> <span data-ttu-id="ae073-151">一种常见情形可能是，您也许已通过使用网站上的窗体从客户获取了信息，希望提交这些数据作为单独预测查询的输入。</span><span class="sxs-lookup"><span data-stu-id="ae073-151">A common scenario might be that you have obtained information from a customer, perhaps by using a form on a Web site, and you want to submit that data as the input to a singleton prediction query.</span></span> <span data-ttu-id="ae073-152">例如，当客户从列表中选择产品时，您可以使用所选内容作为预测最佳建议产品的查询的输入。</span><span class="sxs-lookup"><span data-stu-id="ae073-152">For example, when a customer chooses a product from a list, you could use that selection as the input to a query that predicts the best products to recommend.</span></span>  
  
 <span data-ttu-id="ae073-153">单独预测查询不需要包含输入的单独表。</span><span class="sxs-lookup"><span data-stu-id="ae073-153">Singleton prediction queries do not require a separate table that contains input.</span></span> <span data-ttu-id="ae073-154">而应将一行或多行值作为对模型的输入提供，并且将实时返回一个或多个预测。</span><span class="sxs-lookup"><span data-stu-id="ae073-154">Instead, you provide one or multiple rows of values as input to the model, and the prediction or predictions are returned in real time.</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="ae073-155">不管名称如何，单独预测查询并不只是进行单个预测-可以为每组输入生成多个预测。</span><span class="sxs-lookup"><span data-stu-id="ae073-155">Despite the name, singleton prediction queries do not just make single predictions-you can generate multiple predictions for each set of inputs.</span></span> <span data-ttu-id="ae073-156">并且可以通过为每个输入事例创建一个 SELECT 语句并将它们与 UNION 操作符相结合，提供多个输入事例。</span><span class="sxs-lookup"><span data-stu-id="ae073-156">You provide multiple input cases by creating a SELECT statement for each input case and combining them with the UNION operator.</span></span>  
  
 <span data-ttu-id="ae073-157">创建单独预测查询时，必须以 PREDICTION JOIN 的形式向模型提供新数据。</span><span class="sxs-lookup"><span data-stu-id="ae073-157">When you create a singleton prediction query, you must provide the new data to the model in the form of a PREDICTION JOIN.</span></span> <span data-ttu-id="ae073-158">这意味着即使不映射到实际表，也必须确保新数据与挖掘模型中的现有列匹配。</span><span class="sxs-lookup"><span data-stu-id="ae073-158">This means that even though you are not mapping to an actual table, you must make sure that the new data matches the existing columns in the mining model.</span></span> <span data-ttu-id="ae073-159">如果新数据列与新数据完全匹配，则 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 将自动映射列。</span><span class="sxs-lookup"><span data-stu-id="ae073-159">If the new data columns and the new data match exactly, [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] will map the columns for you.</span></span> <span data-ttu-id="ae073-160">这称为“NATURAL PREDICTION JOIN” \*\*。</span><span class="sxs-lookup"><span data-stu-id="ae073-160">This is called a *NATURAL PREDICTION JOIN*.</span></span> <span data-ttu-id="ae073-161">但是，如果列不匹配，或者新数据在类型和量上与模型所包含的数据并不相同，则必须指定模型中的哪些列映射到新数据，或者指定缺少的值。</span><span class="sxs-lookup"><span data-stu-id="ae073-161">However, if the columns do not match, or if the new data does not contain the same kind and amount of data that is in the model, you must specify which columns in the model map to the new data, or specify the missing values.</span></span>  
  
###  <a name="batch-prediction-queries"></a><a name="bkmk_BatchQuery"></a> <span data-ttu-id="ae073-162">批预测查询</span><span class="sxs-lookup"><span data-stu-id="ae073-162">Batch Prediction Queries</span></span>  
 <span data-ttu-id="ae073-163">如果您有想用来进行预测的外部数据，则批预测查询很有用。</span><span class="sxs-lookup"><span data-stu-id="ae073-163">A batch prediction query is useful when you have external data that you want to use in making predictions.</span></span> <span data-ttu-id="ae073-164">例如，您可能已构建一个按客户的联机活动和购买历史记录对客户进行分类的模型。</span><span class="sxs-lookup"><span data-stu-id="ae073-164">For example, you might have built a model that categorizes customers by their online activity and purchasing history.</span></span> <span data-ttu-id="ae073-165">您可以向最新获取的销售线索列表应用该模型，以创建销售投影或标识建议活动的目标。</span><span class="sxs-lookup"><span data-stu-id="ae073-165">You could apply that model to a list of newly acquired leads, to create projections for sales, or to identify targets for proposed campaigns.</span></span>  
  
 <span data-ttu-id="ae073-166">当您执行预测联接时，必须将模型中的列映射到新数据源中的列。</span><span class="sxs-lookup"><span data-stu-id="ae073-166">When you perform a prediction join, you must map the columns the model to the columns in the new data source.</span></span> <span data-ttu-id="ae073-167">因此，您选择作为输入的数据源所含数据必须与模型中的数据有些相似。</span><span class="sxs-lookup"><span data-stu-id="ae073-167">Therefore, the data source that you choose for an input must data that is somewhat similar to the data in the model.</span></span> <span data-ttu-id="ae073-168">新信息不必完全匹配，也可以不完整。</span><span class="sxs-lookup"><span data-stu-id="ae073-168">The new information does not have to match exactly, and can be incomplete.</span></span> <span data-ttu-id="ae073-169">例如，假定已使用与收入和年龄有关的信息对模型进行了定型，但您用于预测的客户列表具有年龄信息，却没有与收入有关的任何信息。</span><span class="sxs-lookup"><span data-stu-id="ae073-169">For example, suppose the model was trained using information about income and age, but the customer list you are using for predictions has age but nothing about income.</span></span> <span data-ttu-id="ae073-170">在此情况下，您仍可以将新数据映射到模型，并且为每个客户创建预测。</span><span class="sxs-lookup"><span data-stu-id="ae073-170">In this scenario, you could still map the new data to the model and create a prediction for each customer.</span></span> <span data-ttu-id="ae073-171">但是，如果收入已是模型的重要预测因子，则信息不完整将会影响预测的质量。</span><span class="sxs-lookup"><span data-stu-id="ae073-171">However, if income was an important predictor for the model, the lack of complete information would affect the quality of predictions.</span></span>  
  
 <span data-ttu-id="ae073-172">为获得最佳结果，应当在新数据与模型之间联接尽可能多的匹配列。</span><span class="sxs-lookup"><span data-stu-id="ae073-172">To get the best results, you should join as many of the matching columns as possible between the new data and the model.</span></span> <span data-ttu-id="ae073-173">但是，即使没有匹配项，查询也会成功。</span><span class="sxs-lookup"><span data-stu-id="ae073-173">However, the query will succeed even if there are no matches.</span></span> <span data-ttu-id="ae073-174">如果不联接任何列，则查询将返回边缘预测，这与不含 PREDICTION JOIN 子句的语句 `SELECT <predictable-column> FROM <model>` 是等效的。</span><span class="sxs-lookup"><span data-stu-id="ae073-174">If no columns are joined, the query will return the marginal prediction, which is equivalent to the statement `SELECT <predictable-column> FROM <model>` without a PREDICTION JOIN clause.</span></span>  
  
 <span data-ttu-id="ae073-175">您在成功映射所有相关列之后，即可运行查询，而 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 将基于模型中的模式对新数据中的每一行进行预测。</span><span class="sxs-lookup"><span data-stu-id="ae073-175">After you have successfully mapped all relevant columns, you run the query, and [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] makes predictions for each row in the new data based on patterns in the model.</span></span> <span data-ttu-id="ae073-176">您可以将结果保存回包含外部数据的数据源视图中的新表，也可以使用 [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)] 或 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]复制粘贴这些数据。</span><span class="sxs-lookup"><span data-stu-id="ae073-176">You can save the results back to a new table in the data source view that contains the external data, or you can copy and paste the data is you are using [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)] or [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="ae073-177">如果使用 [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)]中的设计器，则必须先将外部数据源定义为一个数据源视图。</span><span class="sxs-lookup"><span data-stu-id="ae073-177">If you use the designer in [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)], the external data source must first be defined as a data source view.</span></span>  
  
 <span data-ttu-id="ae073-178">如果使用 DMX 来创建预测联接，则可以通过使用 OPENQUERY、OPENROWSET 或 SHAPE 命令来指定外部数据源。</span><span class="sxs-lookup"><span data-stu-id="ae073-178">If you use DMX to create a prediction join, you can specify the external data source by using the OPENQUERY, OPENROWSET, or SHAPE commands.</span></span> <span data-ttu-id="ae073-179">DMX 模板中的默认数据访问方法是 OPENQUERY。</span><span class="sxs-lookup"><span data-stu-id="ae073-179">The default data access method in the DMX templates is OPENQUERY.</span></span> <span data-ttu-id="ae073-180">有关这些方法的信息，请参阅 [<数据挖掘源数据>](/sql/dmx/source-data-query)。</span><span class="sxs-lookup"><span data-stu-id="ae073-180">For information about these methods, see [&#60;source data query&#62;](/sql/dmx/source-data-query).</span></span>  
  
###  <a name="predictions-in-time-series-mining-models"></a><a name="bkmk_TSQuery"></a> <span data-ttu-id="ae073-181">时序挖掘模型中的预测</span><span class="sxs-lookup"><span data-stu-id="ae073-181">Predictions in Time Series Mining Models</span></span>  
 <span data-ttu-id="ae073-182">时序模型不同于其他模型类型；您既可以按原样使用模型来创建预测，也可以向模型中提供新数据来更新模型，并基于最近的趋势创建预测。</span><span class="sxs-lookup"><span data-stu-id="ae073-182">Time series models are different from other models types; you can either use the model as it is to create predictions, or you can provide new data to the model to update the model and create predictions based on recent trends.</span></span> <span data-ttu-id="ae073-183">如果添加新数据，您可以指定应使用新数据的方式。</span><span class="sxs-lookup"><span data-stu-id="ae073-183">If you add new data, you can specify the way the new data should be used.</span></span>  
  
-   <span data-ttu-id="ae073-184">\*\* “扩展模型事例”意味着向时序模型中的现有数据序列添加新数据。</span><span class="sxs-lookup"><span data-stu-id="ae073-184">*Extending the model cases* means that you add the new data onto the existing series of data in the time series model.</span></span> <span data-ttu-id="ae073-185">自此以后，预测将基于新合并的序列。</span><span class="sxs-lookup"><span data-stu-id="ae073-185">Henceforth, predictions are based on the new, combined series.</span></span> <span data-ttu-id="ae073-186">如果只需向现有模型中添加几个数据点，则此选项是个不错的选择。</span><span class="sxs-lookup"><span data-stu-id="ae073-186">This option is good when you want to simply add a few data points to an existing model.</span></span>  
  
     <span data-ttu-id="ae073-187">例如，假定您有一个现有的时序模型，它的上一年销售数据已定型。</span><span class="sxs-lookup"><span data-stu-id="ae073-187">For example, suppose that you have an existing time series model that has been trained on the sales data from the previous year.</span></span> <span data-ttu-id="ae073-188">收集了几个月的新销售数据后，您决定更新今年的销售预测。</span><span class="sxs-lookup"><span data-stu-id="ae073-188">After you have collected several months of new sales data, you decide to update your sales forecasts for the current year.</span></span> <span data-ttu-id="ae073-189">您可以添加新数据并扩展模型以进行新预测，从而创建更新模型的预测联接。</span><span class="sxs-lookup"><span data-stu-id="ae073-189">You can create a prediction join that updates the model by adding new data and extends the model to make new predictions.</span></span>  
  
-   <span data-ttu-id="ae073-190">\*\* “替换模型事例”意味着您保留定型后的模型，但将基础事例替换为一组新的事例数据。</span><span class="sxs-lookup"><span data-stu-id="ae073-190">*Replacing the model cases* means that you keep the trained model, but replace the underlying cases with a new set of case data.</span></span> <span data-ttu-id="ae073-191">如果您希望保留模型中的趋势但将其应用到不同的一组数据，则此选项很有用。</span><span class="sxs-lookup"><span data-stu-id="ae073-191">This option is useful when you want to keep the trend in the model, but apply it to a different set of data.</span></span>  
  
     <span data-ttu-id="ae073-192">例如，原始模型可能已定型于一组销售量非常高的数据之上；当您使用新序列（可能来自于销售量较低的存储区）替换基础数据时，可以保留趋势，但预测将从替换序列中的值开始。</span><span class="sxs-lookup"><span data-stu-id="ae073-192">For example, your original model might have been trained on a set of data with very high sales volumes; when you replace the underlying data with a new series (perhaps from a store with lower sales volume), you preserve the trend, but the predictions begin from the values in the replacement series.</span></span>  
  
 <span data-ttu-id="ae073-193">无论您使用那种方法，预测的起点都总是原始序列的终点。</span><span class="sxs-lookup"><span data-stu-id="ae073-193">Regardless of which approach you use, the starting point for predictions is always the end of the original series.</span></span>  
  
 <span data-ttu-id="ae073-194">有关如何在时序模型上创建预测联接的详细信息，请参阅[时序模型查询示例](time-series-model-query-examples.md)或 [PredictTimeSeries (DMX)](/sql/dmx/predicttimeseries-dmx)。</span><span class="sxs-lookup"><span data-stu-id="ae073-194">For more information about how to create prediction joins on time series models, see [Time Series Model Query Examples](time-series-model-query-examples.md) or [PredictTimeSeries &#40;DMX&#41;](/sql/dmx/predicttimeseries-dmx).</span></span>  
  
##  <a name="working-with-the-results-of-a-prediction-query"></a><a name="bkmk_WorkResults"></a> <span data-ttu-id="ae073-195">处理预测查询的结果</span><span class="sxs-lookup"><span data-stu-id="ae073-195">Working with the Results of a Prediction Query</span></span>  
 <span data-ttu-id="ae073-196">您用于保存数据挖掘预测查询结果的选项取决于创建查询的方式。</span><span class="sxs-lookup"><span data-stu-id="ae073-196">Your options for saving the results of a data mining prediction query are different depending on how you create the query.</span></span>  
  
-   <span data-ttu-id="ae073-197">当您在 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] 或 [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)]中使用预测查询生成器生成查询时，可以将预测查询的结果保存到现有的 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 数据源。</span><span class="sxs-lookup"><span data-stu-id="ae073-197">When you build a query using Prediction Query Builder in either [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] or [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)], you can save the results of a prediction query to an existing [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] data source.</span></span> <span data-ttu-id="ae073-198">有关详细信息，请参阅 [查看和保存预测查询的结果](view-and-save-the-results-of-a-prediction-query.md)。</span><span class="sxs-lookup"><span data-stu-id="ae073-198">For more information, see [View and Save the Results of a Prediction Query](view-and-save-the-results-of-a-prediction-query.md).</span></span>  
  
-   <span data-ttu-id="ae073-199">当您在 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]的“查询”窗格使用 DMX 创建预测查询时，可以使用查询输出选项将结果保存到某一文件，或者作为文本保存到“查询结果”窗格或网格中。</span><span class="sxs-lookup"><span data-stu-id="ae073-199">When you create prediction queries using DMX in the Query pane of [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], you can use the query output options to save the results to a file, or to the Query Results pane as text or in a grid.</span></span> <span data-ttu-id="ae073-200">有关详细信息，请参阅[查询和文本编辑器 (SQL Server Management Studio)](../../relational-databases/scripting/query-and-text-editors-sql-server-management-studio.md)。</span><span class="sxs-lookup"><span data-stu-id="ae073-200">For more information, see [Query and Text Editors &#40;SQL Server Management Studio&#41;](../../relational-databases/scripting/query-and-text-editors-sql-server-management-studio.md).</span></span>  
  
-   <span data-ttu-id="ae073-201">当您使用 Integration Services 组件运行预测查询时，这些任务提供使用可用的 ADO.NET 连接管理器或 OLEDB 连接管理器将结果写入数据库的功能。</span><span class="sxs-lookup"><span data-stu-id="ae073-201">When you run a prediction query using the Integration Services components, the tasks provides the ability to write the results to a database by using an available ADO.NET connection manager or OLEDB connection manager.</span></span> <span data-ttu-id="ae073-202">有关详细信息，请参阅 [Data Mining Query Task](../../integration-services/control-flow/data-mining-query-task.md)。</span><span class="sxs-lookup"><span data-stu-id="ae073-202">For more information, see [Data Mining Query Task](../../integration-services/control-flow/data-mining-query-task.md).</span></span>  
  
 <span data-ttu-id="ae073-203">请务必了解，预测查询的结果与针对关系数据库的查询的结果不同，后者始终返回单行的相关值。</span><span class="sxs-lookup"><span data-stu-id="ae073-203">It is important to understand that the results of a prediction query are not like the results of a query on a relational database, which always returns a single row of related values.</span></span> <span data-ttu-id="ae073-204">您添加到查询中的每个 DMX 预测函数都返回它自己的行集。</span><span class="sxs-lookup"><span data-stu-id="ae073-204">Each DMX prediction function that you add to a query returns its own rowset.</span></span> <span data-ttu-id="ae073-205">因此，当您针对一个事例进行预测时，结果可能是一个预测的值，以及包含其他详细信息的几个嵌套表列。</span><span class="sxs-lookup"><span data-stu-id="ae073-205">Therefore, when you make a prediction on a single case, the result might be a predicted value together with several columns of nested tables containing additional detail.</span></span>  
  
 <span data-ttu-id="ae073-206">如果在一个查询中组合多个函数，则返回结果将组合为一个分层行集。</span><span class="sxs-lookup"><span data-stu-id="ae073-206">If you combine multiple functions in one query, the return results are combined as a hierarchical rowset.</span></span> <span data-ttu-id="ae073-207">例如，假定您使用一个时序模型预测销售金额和销售数量的将来值，则使用以下 DMX 语句之类的查询：</span><span class="sxs-lookup"><span data-stu-id="ae073-207">For example, say you use a time series model to predict future values for sales amount and sales quantity, using a query such as this DMX statement:</span></span>  
  
```  
SELECT  
  PredictTimeSeries([Forecasting].[Amount]) as [PredictedAmount]  
, PredictTimeSeries([Forecasting].[Quantity]) as [PredictedQty]  
FROM  
  [Forecasting]  
  
```  
  
 <span data-ttu-id="ae073-208">此查询的结果由两列构成，分别针对每个预测的序列，其中，每一行都包含具有预测值的嵌套表：</span><span class="sxs-lookup"><span data-stu-id="ae073-208">The results of this query are two columns, one for each predicted series, where each row contains a nested table with the predicted values:</span></span>  
  
 <span data-ttu-id="ae073-209">**PredictedAmount**</span><span class="sxs-lookup"><span data-stu-id="ae073-209">**PredictedAmount**</span></span>  
  
|<span data-ttu-id="ae073-210">$TIME</span><span class="sxs-lookup"><span data-stu-id="ae073-210">$TIME</span></span>|<span data-ttu-id="ae073-211">金额</span><span class="sxs-lookup"><span data-stu-id="ae073-211">Amount</span></span>|  
|-----------|------------|  
|<span data-ttu-id="ae073-212">201101</span><span class="sxs-lookup"><span data-stu-id="ae073-212">201101</span></span>|<span data-ttu-id="ae073-213">172067.11</span><span class="sxs-lookup"><span data-stu-id="ae073-213">172067.11</span></span>|  
  
|<span data-ttu-id="ae073-214">$TIME</span><span class="sxs-lookup"><span data-stu-id="ae073-214">$TIME</span></span>|<span data-ttu-id="ae073-215">金额</span><span class="sxs-lookup"><span data-stu-id="ae073-215">Amount</span></span>|  
|-----------|------------|  
|<span data-ttu-id="ae073-216">201102</span><span class="sxs-lookup"><span data-stu-id="ae073-216">201102</span></span>|<span data-ttu-id="ae073-217">363390.68</span><span class="sxs-lookup"><span data-stu-id="ae073-217">363390.68</span></span>|  
  
 <span data-ttu-id="ae073-218">**PredictedQty**</span><span class="sxs-lookup"><span data-stu-id="ae073-218">**PredictedQty**</span></span>  
  
|<span data-ttu-id="ae073-219">$TIME</span><span class="sxs-lookup"><span data-stu-id="ae073-219">$TIME</span></span>|<span data-ttu-id="ae073-220">数量</span><span class="sxs-lookup"><span data-stu-id="ae073-220">Quantity</span></span>|  
|-----------|--------------|  
|<span data-ttu-id="ae073-221">201101</span><span class="sxs-lookup"><span data-stu-id="ae073-221">201101</span></span>|<span data-ttu-id="ae073-222">77</span><span class="sxs-lookup"><span data-stu-id="ae073-222">77</span></span>|  
  
|<span data-ttu-id="ae073-223">$TIME</span><span class="sxs-lookup"><span data-stu-id="ae073-223">$TIME</span></span>|<span data-ttu-id="ae073-224">数量</span><span class="sxs-lookup"><span data-stu-id="ae073-224">Quantity</span></span>|  
|-----------|--------------|  
|<span data-ttu-id="ae073-225">201102</span><span class="sxs-lookup"><span data-stu-id="ae073-225">201102</span></span>|<span data-ttu-id="ae073-226">260</span><span class="sxs-lookup"><span data-stu-id="ae073-226">260</span></span>|  
  
 <span data-ttu-id="ae073-227">如果提供程序无法处理分层的行集，则可以通过在预测查询中使用 FLATTEN 关键字来对结果进行平展处理。</span><span class="sxs-lookup"><span data-stu-id="ae073-227">If your provider cannot handle hierarchical rowsets, you can flatten the results by using the FLATTEN keyword in the prediction query.</span></span> <span data-ttu-id="ae073-228">有关详细信息，包括平展行集的示例，请参阅 [SELECT (DMX)](/sql/dmx/select-dmx)。</span><span class="sxs-lookup"><span data-stu-id="ae073-228">For more information, including examples of flattened rowsets, see [SELECT &#40;DMX&#41;](/sql/dmx/select-dmx).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ae073-229">另请参阅</span><span class="sxs-lookup"><span data-stu-id="ae073-229">See Also</span></span>  
 <span data-ttu-id="ae073-230">[内容查询 &#40;数据挖掘&#41;](content-queries-data-mining.md) </span><span class="sxs-lookup"><span data-stu-id="ae073-230">[Content Queries &#40;Data Mining&#41;](content-queries-data-mining.md) </span></span>  
 [<span data-ttu-id="ae073-231">数据定义查询（数据挖掘）</span><span class="sxs-lookup"><span data-stu-id="ae073-231">Data Definition Queries &#40;Data Mining&#41;</span></span>](data-definition-queries-data-mining.md)  
  
  
