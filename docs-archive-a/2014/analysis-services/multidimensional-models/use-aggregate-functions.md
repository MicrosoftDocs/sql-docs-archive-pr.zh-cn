---
title: 使用聚合函数 |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
helpviewer_keywords:
- aggregate functions [Analysis Services]
ms.assetid: c42166ef-b75c-45f4-859c-09a3e9617664
author: minewiskan
ms.author: owend
ms.openlocfilehash: 83cdc571019cffd8ae99e00f119541736c6f503b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87588101"
---
# <a name="use-aggregate-functions"></a><span data-ttu-id="4c7cb-102">使用聚合函数</span><span class="sxs-lookup"><span data-stu-id="4c7cb-102">Use Aggregate Functions</span></span>
  <span data-ttu-id="4c7cb-103">使用维度来切分度量值时，按该维度中包含的层次结构汇总该度量值。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-103">When a dimension is used to slice a measure, the measure is summarized along the hierarchies contained in that dimension.</span></span> <span data-ttu-id="4c7cb-104">汇总行为取决于为度量值指定的聚合函数。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-104">The summation behavior depends on the aggregate function specified for the measure.</span></span> <span data-ttu-id="4c7cb-105">对于包含数字数据的度量值，聚合函数是 `Sum`。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-105">For most measures containing numeric data, the aggregate function is `Sum`.</span></span> <span data-ttu-id="4c7cb-106">度量值的值的总和将根据活动的层次结构的级别而异。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-106">The value of the measure will sum to different amounts depending on which level of the hierarchy is active.</span></span>  
  
 <span data-ttu-id="4c7cb-107">在 Analysis Services 中，你创建的每一个度量值均由确定该度量值的操作的聚合函数备份。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-107">In Analysis Services, every measure that you create is backed by an aggregation function that determines the measure's operation.</span></span> <span data-ttu-id="4c7cb-108">预定义的聚合类型包括 `Sum` 、 `Min` 、 `Max` 、 `Count` 、**非重复计数**和几个其他更专用的函数。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-108">Predefined aggregation types include `Sum`, `Min`, `Max`, `Count`, **Distinct Count**, and several other more specialized functions.</span></span> <span data-ttu-id="4c7cb-109">或者，如果需要基于复杂或自定义公式的聚合，可以生成 MDX 计算，而非使用预生成的聚合函数。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-109">Alternatively, if you require aggregations based on complex or custom formulas, you can build an MDX calculation in lieu of using a prebuilt aggregation function.</span></span> <span data-ttu-id="4c7cb-110">例如，如果想定义一个百分比值的度量值，你将在 MDX 中使用计算度量值执行该操作。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-110">For example, if you want to define a measure for a percentage value, you would do that in MDX, using a calculated measure.</span></span> <span data-ttu-id="4c7cb-111">请参阅 [CREATE MEMBER 语句 (MDX)](/sql/mdx/mdx-data-definition-create-member)。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-111">See [CREATE MEMBER Statement &#40;MDX&#41;](/sql/mdx/mdx-data-definition-create-member).</span></span>  
  
 <span data-ttu-id="4c7cb-112">对通过“多维数据集向导”创建的度量值分配了作为度量值定义的一部分的聚合类型。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-112">Measures that are created via the Cube Wizard are assigned an aggregation type as part of the measure definition.</span></span> <span data-ttu-id="4c7cb-113">聚合类型始终是 `Sum`，假设源列包含数字数据。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-113">The aggregation type is always `Sum`, assuming the source column contains numeric data.</span></span> <span data-ttu-id="4c7cb-114">在不考虑源列的数据类型的情况下分配 `Sum`。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-114">`Sum` is assigned regardless of the source column's data type.</span></span> <span data-ttu-id="4c7cb-115">例如，如果你使用“多维数据集向导”创建度量值并从事实数据表中拉入所有列，则你将注意到所有所得度量值均具有 `Sum` 的聚合，即使源是日期时间列。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-115">For example, if you used the Cube Wizard to create measures, and you pulled in all columns from a fact table, you will notice that all of the resulting measures have an aggregation of `Sum`, even if the source is a date time column.</span></span> <span data-ttu-id="4c7cb-116">始终检查通过向导创建的度量值的预分配的聚合方法，以确保聚合函数恰当。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-116">Always review the pre-assigned aggregation methods for measures created via the wizard to make sure the aggregation function is suitable.</span></span>  
  
 <span data-ttu-id="4c7cb-117">可在多维数据集定义之一中分配或更改聚合方法，方式为通过 [!INCLUDE[ss_dtbi](../../includes/ss-dtbi-md.md)]，或通过 MDX。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-117">You can assign or change the aggregation method in the either the cube definition, via [!INCLUDE[ss_dtbi](../../includes/ss-dtbi-md.md)], or via MDX.</span></span> <span data-ttu-id="4c7cb-118">有关详细说明，请参阅[在多维模型中创建度量值和度量值组](create-measures-and-measure-groups-in-multidimensional-models.md)或[聚合 (MDX)](/sql/mdx/aggregate-mdx)。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-118">See [Create Measures and Measure Groups in Multidimensional Models](create-measures-and-measure-groups-in-multidimensional-models.md) or [Aggregate &#40;MDX&#41;](/sql/mdx/aggregate-mdx) for further instructions.</span></span>  
  
##  <a name="aggregate-functions"></a><a name="AggFunction"></a><span data-ttu-id="4c7cb-119">聚合函数</span><span class="sxs-lookup"><span data-stu-id="4c7cb-119">Aggregate Functions</span></span>  
 [!INCLUDE[ssASnoversion](../../../includes/ssasnoversion-md.md)] <span data-ttu-id="4c7cb-120">提供了几种函数，用来针对包含在度量值组中的维度聚合度量值。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-120">provides functions to aggregate measures along the dimensions that are contained in measure groups.</span></span> <span data-ttu-id="4c7cb-121">聚合函数的 *累加性* 可确定度量值如何在多维数据集的所有维度中进行聚合。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-121">The *additivity* of an aggregation function determines how the measure is aggregated across all the dimensions in the cube.</span></span> <span data-ttu-id="4c7cb-122">聚合函数具有三个级别的累加性：</span><span class="sxs-lookup"><span data-stu-id="4c7cb-122">Aggregation functions fall into three levels of additivity:</span></span>  
  
 <span data-ttu-id="4c7cb-123">加法</span><span class="sxs-lookup"><span data-stu-id="4c7cb-123">Additive</span></span>  
 <span data-ttu-id="4c7cb-124">累加性度量值也称为完全累加性度量值，可针对包含度量值的度量值组中包括的所有维度进行聚合，没有任何限制。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-124">An additive measure, also called a fully additive measure, can be aggregated along all the dimensions that are included in the measure group that contains the measure, without restriction.</span></span>  
  
 <span data-ttu-id="4c7cb-125">半累加性</span><span class="sxs-lookup"><span data-stu-id="4c7cb-125">Semiadditive</span></span>  
 <span data-ttu-id="4c7cb-126">半累加性度量值可针对包含度量值的度量值组中包括的某些（但不是全部）维度进行聚合。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-126">A semiadditive measure can be aggregated along some, but not all, dimensions that are included in the measure group that contains the measure.</span></span> <span data-ttu-id="4c7cb-127">例如，表示可供库存数量的度量值可针对地域维度进行聚合，以生成可用于所有仓库的总计数量，但该度量值不能针对时间维度进行聚合，因为该度量值表示可用数量的定期快照。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-127">For example, a measure that represents the quantity available for inventory can be aggregated along a geography dimension to produce a total quantity available for all warehouses, but the measure cannot be aggregated along a time dimension because the measure represents a periodic snapshot of quantities available.</span></span> <span data-ttu-id="4c7cb-128">针对时间维度聚合此类度量值将产生不正确的结果。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-128">Aggregating such a measure along a time dimension would produce incorrect results.</span></span> <span data-ttu-id="4c7cb-129">有关详细信息，请参阅 [Define Semiadditive Behavior](define-semiadditive-behavior.md) 。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-129">See [Define Semiadditive Behavior](define-semiadditive-behavior.md) for details.</span></span>  
  
 <span data-ttu-id="4c7cb-130">非累加性</span><span class="sxs-lookup"><span data-stu-id="4c7cb-130">Nonadditive</span></span>  
 <span data-ttu-id="4c7cb-131">非累加性度量值不能针对包含度量值的度量值组中的任何维度进行聚合。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-131">A nonadditive measure cannot be aggregated along any dimension in the measure group that contains the measure.</span></span> <span data-ttu-id="4c7cb-132">相反，必须对表示度量值的多维数据集中的每个单元分别计算度量值。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-132">Instead, the measure must be individually calculated for each cell in the cube that represents the measure.</span></span> <span data-ttu-id="4c7cb-133">例如，返回百分比的计算度量值（例如利润率）不能由任何维度内子成员的百分比值进行聚合。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-133">For example, a calculated measure that returns a percentage, such as profit margin, cannot be aggregated from the percentage values of child members in any dimension.</span></span>  
  
 <span data-ttu-id="4c7cb-134">下表列出了 [!INCLUDE[ssASnoversion](../../../includes/ssasnoversion-md.md)]中的聚合函数，并对函数的累加性和预期输出进行了说明。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-134">The following table lists the aggregation functions in [!INCLUDE[ssASnoversion](../../../includes/ssasnoversion-md.md)], and describes both the additivity and expected output of the function.</span></span>  
  
|<span data-ttu-id="4c7cb-135">聚合函数</span><span class="sxs-lookup"><span data-stu-id="4c7cb-135">Aggregation function</span></span>|<span data-ttu-id="4c7cb-136">累加性</span><span class="sxs-lookup"><span data-stu-id="4c7cb-136">Additivity</span></span>|<span data-ttu-id="4c7cb-137">返回值</span><span class="sxs-lookup"><span data-stu-id="4c7cb-137">Returned value</span></span>|  
|--------------------------|----------------|--------------------|  
|`Sum`|<span data-ttu-id="4c7cb-138">加法</span><span class="sxs-lookup"><span data-stu-id="4c7cb-138">Additive</span></span>|<span data-ttu-id="4c7cb-139">对所有子成员的值求和。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-139">Calculates the sum of values for all child members.</span></span> <span data-ttu-id="4c7cb-140">这是默认的聚合函数。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-140">This is the default aggregation function.</span></span>|  
|`Count`|<span data-ttu-id="4c7cb-141">加法</span><span class="sxs-lookup"><span data-stu-id="4c7cb-141">Additive</span></span>|<span data-ttu-id="4c7cb-142">检索所有子成员的计数。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-142">Retrieves the count of all child members.</span></span>|  
|`Min`|<span data-ttu-id="4c7cb-143">半累加性</span><span class="sxs-lookup"><span data-stu-id="4c7cb-143">Semiadditive</span></span>|<span data-ttu-id="4c7cb-144">检索所有子成员的最低值。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-144">Retrieves the lowest value for all child members.</span></span>|  
|`Max`|<span data-ttu-id="4c7cb-145">半累加性</span><span class="sxs-lookup"><span data-stu-id="4c7cb-145">Semiadditive</span></span>|<span data-ttu-id="4c7cb-146">检索所有子成员的最高值。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-146">Retrieves the highest value for all child members.</span></span>|  
|`DistinctCount`|<span data-ttu-id="4c7cb-147">非累加性</span><span class="sxs-lookup"><span data-stu-id="4c7cb-147">Nonadditive</span></span>|<span data-ttu-id="4c7cb-148">检索所有唯一子成员的计数。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-148">Retrieves the count of all unique child members.</span></span> <span data-ttu-id="4c7cb-149">有关详细信息，请参阅下一节中的 [About Distinct Count Measures](use-aggregate-functions.md#bkmk_distinct) 。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-149">For more details, see [About Distinct Count Measures](use-aggregate-functions.md#bkmk_distinct) in the next section.</span></span>|  
|`None`|<span data-ttu-id="4c7cb-150">非累加性</span><span class="sxs-lookup"><span data-stu-id="4c7cb-150">Nonadditive</span></span>|<span data-ttu-id="4c7cb-151">不执行任何聚合，直接从事实数据表中为包含度量值的度量值组提供维度中叶成员和非叶成员的所有值。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-151">No aggregation is performed, and all values for leaf and nonleaf members in a dimension are supplied directly from the fact table for the measure group that contains the measure.</span></span> <span data-ttu-id="4c7cb-152">如果从事实数据表中无法为成员读取任何值，则该成员的值设置为空。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-152">If no value can be read from the fact table for a member, the value for that member is set to null.</span></span>|  
|`ByAccount`|<span data-ttu-id="4c7cb-153">半累加性</span><span class="sxs-lookup"><span data-stu-id="4c7cb-153">Semiadditive</span></span>|<span data-ttu-id="4c7cb-154">根据为帐户维度中某一成员的帐户类型指定的聚合函数计算聚合。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-154">Calculates the aggregation according to the aggregation function assigned to the account type for a member in an account dimension.</span></span> <span data-ttu-id="4c7cb-155">如果度量值组中不存在任何帐户类型维度，则视为 `None` 聚合函数。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-155">If no account type dimension exists in the measure group, treated as the `None` aggregation function.</span></span><br /><br /> <span data-ttu-id="4c7cb-156">有关帐户维度的详细信息，请参阅 [创建父子类型维度的财务帐户](database-dimensions-finance-account-of-parent-child-type.md)。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-156">For more information about account dimensions, see [Create a Finance Account of parent-child type Dimension](database-dimensions-finance-account-of-parent-child-type.md).</span></span>|  
|`AverageOfChildren`|<span data-ttu-id="4c7cb-157">半累加性</span><span class="sxs-lookup"><span data-stu-id="4c7cb-157">Semiadditive</span></span>|<span data-ttu-id="4c7cb-158">计算所有非空子成员的平均值。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-158">Calculates the average of values for all non-empty child members.</span></span>|  
|`FirstChild`|<span data-ttu-id="4c7cb-159">半累加性</span><span class="sxs-lookup"><span data-stu-id="4c7cb-159">Semiadditive</span></span>|<span data-ttu-id="4c7cb-160">检索第一个子成员的值。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-160">Retrieves the value of the first child member.</span></span>|  
|`LastChild`|<span data-ttu-id="4c7cb-161">半累加性</span><span class="sxs-lookup"><span data-stu-id="4c7cb-161">Semiadditive</span></span>|<span data-ttu-id="4c7cb-162">检索最后一个子成员的值。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-162">Retrieves the value of the last child member.</span></span>|  
|`FirstNonEmpty`|<span data-ttu-id="4c7cb-163">半累加性</span><span class="sxs-lookup"><span data-stu-id="4c7cb-163">Semiadditive</span></span>|<span data-ttu-id="4c7cb-164">检索第一个非空子成员的值。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-164">Retrieves the value of the first non-empty child member.</span></span>|  
|`LastNonEmpty`|<span data-ttu-id="4c7cb-165">半累加性</span><span class="sxs-lookup"><span data-stu-id="4c7cb-165">Semiadditive</span></span>|<span data-ttu-id="4c7cb-166">检索最后一个非空子成员的值。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-166">Retrieves the value of the last non-empty child member.</span></span>|  
  
##  <a name="about-distinct-count-measures"></a><a name="bkmk_distinct"></a> <span data-ttu-id="4c7cb-167">About Distinct Count Measures</span><span class="sxs-lookup"><span data-stu-id="4c7cb-167">About Distinct Count Measures</span></span>  
 <span data-ttu-id="4c7cb-168">“聚合函数” \*\*\*\* 属性值为 **Distinct Count** 的度量值称为非重复计数度量值。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-168">A measure with an **Aggregate Function** property value of **Distinct Count** is called a distinct count measure.</span></span> <span data-ttu-id="4c7cb-169">非重复计数度量值可以用于对维度的最低级别成员在事实数据表中的出现次数进行计数。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-169">A distinct count measure can be used to count occurrences of a dimension's lowest-level members in the fact table.</span></span> <span data-ttu-id="4c7cb-170">由于计数具有非重复性，因此，如果某个成员出现多次，则仅对此成员进行一次计数。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-170">Because the count is distinct, if a member occurs multiple times, it is counted only once.</span></span> <span data-ttu-id="4c7cb-171">非重复计数度量值始终位于专用的度量值组中。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-171">A distinct count measure is always placed in a dedicated measure group.</span></span> <span data-ttu-id="4c7cb-172">将非重复计数度量值放入其自己的度量值组是内置到设计器中作为性能优化技术的最佳做法。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-172">Putting a distinct count measure into its own measure group is a best practice that has been built into the designer as a performance optimization technique.</span></span>  
  
 <span data-ttu-id="4c7cb-173">非重复计数度量值通常用于确定对于某个维度的每个成员，另一维度有多少不同的最低级别成员共享事实数据表中的。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-173">Distinct count measures are commonly used to determine for each member of a dimension how many distinct, lowest-level members of another dimension share rows in the fact table.</span></span> <span data-ttu-id="4c7cb-174">例如，在“销售额”多维数据集中，对于每个客户和客户组，购买了多少不同的产品？</span><span class="sxs-lookup"><span data-stu-id="4c7cb-174">For example, in a Sales cube, for each customer and customer group, how many distinct products were purchased?</span></span> <span data-ttu-id="4c7cb-175">（即，对于“客户”维度的每个成员，“产品”维度有多少不同的最低级别成员共享事实数据表中的行？）或者，例如在“Internet 站点访问”多维数据集中，对于每个站点访问者和站点访问者组，访问了 Internet 站点上有多少不同的页？</span><span class="sxs-lookup"><span data-stu-id="4c7cb-175">(That is, for each member of the Customers dimension, how many distinct, lowest-level members of the Products dimension share rows in the fact table?) Or, for example, in an Internet Site Visits cube, for each site visitor and site visitor group, how many distinct pages on the Internet site were visited?</span></span> <span data-ttu-id="4c7cb-176">（即，对于“站点访问者”维度的每个成员，“页”维度有多少不同的最低级别成员共享事实数据表中的行？）在上述每个示例中，第二个维度的最低级别成员由非重复计数度量值进行计数。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-176">(That is, for each member of the Site Visitors dimension, how many distinct, lowest-level members of the Pages dimension share rows in the fact table?) In each of these examples, the second dimension's lowest-level members are counted by a distinct count measure.</span></span>  
  
 <span data-ttu-id="4c7cb-177">此类分析无需限制为两个维度。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-177">This kind of analysis need not be limited to two dimensions.</span></span> <span data-ttu-id="4c7cb-178">事实上，非重复计数度量值可以由多维数据集中的任何维度组合进行分隔和切片，这些维度组合包括具有计数成员的维度。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-178">In fact, a distinct count measure can be separated and sliced by any combination of dimensions in the cube, including the dimension that contains the counted members.</span></span>  
  
 <span data-ttu-id="4c7cb-179">对成员进行计数的非重复计数度量值基于事实数据表中的外键列。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-179">A distinct count measure that counts members is based on a foreign key column in the fact table.</span></span> <span data-ttu-id="4c7cb-180"> (即，度量值的 "**源列**" 属性标识此列。 ) 此列联接标识由非重复计数度量值进行计数的成员的维度表列。</span><span class="sxs-lookup"><span data-stu-id="4c7cb-180">(That is, the measure's **Source Column** property identifies this column.) This column joins the dimension table column that identifies the members counted by the distinct count measure.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4c7cb-181">另请参阅</span><span class="sxs-lookup"><span data-stu-id="4c7cb-181">See Also</span></span>  
 <span data-ttu-id="4c7cb-182">[度量值和度量值组](measures-and-measure-groups.md) </span><span class="sxs-lookup"><span data-stu-id="4c7cb-182">[Measures and Measure Groups](measures-and-measure-groups.md) </span></span>  
 <span data-ttu-id="4c7cb-183">[Mdx 函数引用 &#40;MDX&#41;](/sql/mdx/mdx-function-reference-mdx) </span><span class="sxs-lookup"><span data-stu-id="4c7cb-183">[MDX Function Reference &#40;MDX&#41;](/sql/mdx/mdx-function-reference-mdx) </span></span>  
 [<span data-ttu-id="4c7cb-184">定义半累加性行为</span><span class="sxs-lookup"><span data-stu-id="4c7cb-184">Define Semiadditive Behavior</span></span>](define-semiadditive-behavior.md)  
  
  
