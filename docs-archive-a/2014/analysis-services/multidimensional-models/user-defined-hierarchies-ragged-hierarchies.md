---
title: 不规则层次结构 |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
helpviewer_keywords:
- ragged hierarchies [Analysis Services]
ms.assetid: e40a5788-7ede-4b0f-93ab-46ca33d0cace
author: minewiskan
ms.author: owend
ms.openlocfilehash: 02cbb24b7ae80facf0ddbb1495fccc8f848df377
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87693122"
---
# <a name="ragged-hierarchies"></a><span data-ttu-id="d438f-102">不规则层次结构</span><span class="sxs-lookup"><span data-stu-id="d438f-102">Ragged Hierarchies</span></span>
  <span data-ttu-id="d438f-103">不规则层次结构是一种具有不规则级别数目的用户定义层次结构。</span><span class="sxs-lookup"><span data-stu-id="d438f-103">A ragged hierarchy is a user-defined hierarchy that has an uneven number of levels.</span></span> <span data-ttu-id="d438f-104">常见示例包括高级别经理将部门经理人员和非经理人员作为直接下属的组织图或是由“国家-地区-城市”组成的地理层次结构（其中某些城市没有父级“州”或“省”，如“华盛顿特区”、“梵蒂冈城”或“新德里”）。</span><span class="sxs-lookup"><span data-stu-id="d438f-104">Common examples include an organizational chart where a high-level manager has both departmental managers and non-managers as direct reports, or geographic hierarchies composed of Country-Region-City, where some cities lack a parent State or Province, such as Washington D.C., Vatican City, or New Delhi.</span></span>  
  
 <span data-ttu-id="d438f-105">对于某一维度中的大多数层次结构，每个级别上面的成员数与同一级别中任何其他成员上面的成员数相同。</span><span class="sxs-lookup"><span data-stu-id="d438f-105">For most hierarchies in a dimension, each level has the same number of members above it as any other member at the same level.</span></span> <span data-ttu-id="d438f-106">不规则层次结构的不同之处在于，至少一个成员的逻辑父级不在该成员的直接上一级别中。</span><span class="sxs-lookup"><span data-stu-id="d438f-106">A ragged hierarchy is different in that the logical parent of at least one member is not in the level immediately above the member.</span></span> <span data-ttu-id="d438f-107">如果出现这种情况，则层次结构会降至其他级别以寻找其他深化路径。</span><span class="sxs-lookup"><span data-stu-id="d438f-107">When this occurs, the hierarchy descends to different levels for different drilldown paths.</span></span> <span data-ttu-id="d438f-108">在客户端应用程序中，这会让深化路径变得异常复杂。</span><span class="sxs-lookup"><span data-stu-id="d438f-108">In a client application, this can make drilldown paths unnecessarily complicated.</span></span>  
  
 <span data-ttu-id="d438f-109">各种客户端应用程序处理不规则层次结构的方式良莠不齐。</span><span class="sxs-lookup"><span data-stu-id="d438f-109">Client applications vary in how well they handle a ragged hierarchy.</span></span> <span data-ttu-id="d438f-110">如果您的模型中存在不规则层次结构，请准备完成一点额外工作来获取所希望的呈现行为。</span><span class="sxs-lookup"><span data-stu-id="d438f-110">If ragged hierarchies exist in your model, be prepared to do a little extra work to get the rendering behavior you expect.</span></span>  
  
 <span data-ttu-id="d438f-111">第一步是要检查客户端应用程序，看其如何处理深化路径。</span><span class="sxs-lookup"><span data-stu-id="d438f-111">As a first step, check the client application to see how it handles the drilldown path.</span></span> <span data-ttu-id="d438f-112">例如，Excel 对于缺失值将父级名称表示为占位符。</span><span class="sxs-lookup"><span data-stu-id="d438f-112">For example, Excel repeats the parent names as placeholders for missing values.</span></span> <span data-ttu-id="d438f-113">若要自行查看此行为，请使用 Adventure Works 多维模型中的“销售区域”维度生成一个数据透视表。</span><span class="sxs-lookup"><span data-stu-id="d438f-113">To see this behavior yourself, build a PivotTable using the Sales Territory dimension in the Adventure Works multidimensional model.</span></span> <span data-ttu-id="d438f-114">在具有“销售区域”属性“组”、“国家/地区”和“区域”的数据透视表中，您会看到缺少区域值的国家/地区会获得一个占位符，在这种情况下表示对其上面父级（国家/地区名称）的重复。</span><span class="sxs-lookup"><span data-stu-id="d438f-114">In a PivotTable having the Sales Territory attributes Group, Country, and Region, you will see that countries missing a region value will get a placeholder, in this case a repeat of the parent above it (Country name).</span></span> <span data-ttu-id="d438f-115">此行为派生自在 Excel 中固定的 MDX Compatibility=1 连接字符串属性。</span><span class="sxs-lookup"><span data-stu-id="d438f-115">This behavior derives from the MDX Compatibility=1 connection string property that is fixed within Excel.</span></span> <span data-ttu-id="d438f-116">如果客户端没有自然提供您正在寻找的深化行为，那么您可以在模型中设置属性以至少更改其中的某些行为。</span><span class="sxs-lookup"><span data-stu-id="d438f-116">If the client does not naturally provide the drill-down behaviors you are looking for, you can set properties in the model to change at least some of those behaviors.</span></span>  
  
 <span data-ttu-id="d438f-117">本主题包含以下各节：</span><span class="sxs-lookup"><span data-stu-id="d438f-117">This topic contains the following sections:</span></span>  
  
-   [<span data-ttu-id="d438f-118">修改不规则层次结构中的深化导航的方法</span><span class="sxs-lookup"><span data-stu-id="d438f-118">Approaches for modifying drilldown navigation in a ragged hierarchy</span></span>](#bkmk_approach)  
  
-   [<span data-ttu-id="d438f-119">设置 HideMemberIf 以隐藏规则层次结构中的成员</span><span class="sxs-lookup"><span data-stu-id="d438f-119">Set HideMemberIf to hide members in a regular hierarchy</span></span>](#bkmk_Hide)  
  
-   [<span data-ttu-id="d438f-120">设置 MDX 兼容性以确定如何在客户端应用程序中表示占位符</span><span class="sxs-lookup"><span data-stu-id="d438f-120">Set MDX Compatibility to determine how placeholders are represented in client applications</span></span>](#bkmk_Mdx)  
  
##  <a name="approaches-for-modifying-drilldown-navigation-in-a-ragged-hierarchy"></a><a name="bkmk_approach"></a> <span data-ttu-id="d438f-121">修改不规则层次结构中的深化导航的方法</span><span class="sxs-lookup"><span data-stu-id="d438f-121">Approaches for modifying drilldown navigation in a ragged hierarchy</span></span>  
 <span data-ttu-id="d438f-122">当深化导航不返回预期值或被视为难以使用时，不规则层次结构的存在将成为问题。</span><span class="sxs-lookup"><span data-stu-id="d438f-122">The presence of a ragged hierarchy becomes a problem when drilldown navigation does not return expected values or is perceived as awkward to use.</span></span> <span data-ttu-id="d438f-123">若要解决不规则层次结构产生的导航问题，请考虑下列选项：</span><span class="sxs-lookup"><span data-stu-id="d438f-123">To fix navigation problems that result from ragged hierarchies, consider these options:</span></span>  
  
-   <span data-ttu-id="d438f-124">使用不规则层次结构，但在每个级别上设置 `HideMemberIf` 属性以指定是否对用户可视化缺失级别。</span><span class="sxs-lookup"><span data-stu-id="d438f-124">Use a regular hierarchy but set the `HideMemberIf` property on each level to specify whether a missing level is visualized to the user.</span></span> <span data-ttu-id="d438f-125">设置 `HideMemberIf` 时，还应对连接字符串设置 `MDXCompatibility` 以覆盖默认导航行为。</span><span class="sxs-lookup"><span data-stu-id="d438f-125">When setting `HideMemberIf`, you should also set `MDXCompatibility` on the connection string to override default navigation behaviors.</span></span> <span data-ttu-id="d438f-126">本主题中提供用于设置这些属性的说明。</span><span class="sxs-lookup"><span data-stu-id="d438f-126">Instructions for setting these properties are in this topic.</span></span>  
  
-   <span data-ttu-id="d438f-127">创建显式管理级别成员的父子层次结构。</span><span class="sxs-lookup"><span data-stu-id="d438f-127">Create a parent-child hierarchy that explicitly manages the level members.</span></span> <span data-ttu-id="d438f-128">有关这种方法的说明，请参阅 [SSAS 中的不规则层次结构（博客文章）](http://dwbi1.wordpress.com/2011/03/30/ragged-hierarchy-in-ssas/)。</span><span class="sxs-lookup"><span data-stu-id="d438f-128">For an illustration of the technique, see [Ragged Hierarchy in SSAS (blog post)](http://dwbi1.wordpress.com/2011/03/30/ragged-hierarchy-in-ssas/).</span></span> <span data-ttu-id="d438f-129">有关联机丛书的详细信息，请参阅[父子层次结构](parent-child-dimension.md)。</span><span class="sxs-lookup"><span data-stu-id="d438f-129">For more information in Books Online, see [Parent-Child Hierarchy](parent-child-dimension.md).</span></span> <span data-ttu-id="d438f-130">创建父子层次结构的缺点是每个维度只能有一个层次结构，并且在为中间成员计算聚合时通常会引发性能损失。</span><span class="sxs-lookup"><span data-stu-id="d438f-130">Downsides to creating a parent-child hierarchy are that you can only have one per dimension, and you typically incur a performance penalty when calculating aggregations for intermediate members.</span></span>  
  
 <span data-ttu-id="d438f-131">如果您的维度中包含一个以上不规则层次结构，则应使用第一种方法，设置 `HideMemberIf`。</span><span class="sxs-lookup"><span data-stu-id="d438f-131">If your dimension contains more than one ragged hierarchy, you should use the first approach, setting `HideMemberIf`.</span></span> <span data-ttu-id="d438f-132">拥有使用不规则层次结构方面实际经验的 BI 开发人员可以更进一步，在物理数据表中进行其他更改，从而为每个级别创建单独的表。</span><span class="sxs-lookup"><span data-stu-id="d438f-132">BI Developers with practical experience in working with ragged hierarchies go further in advocating for additional changes in the physical data tables, creating separate tables for each level.</span></span> <span data-ttu-id="d438f-133">有关此技术的详细信息，请参阅[Mason 的 SSAS 财务多维数据集-第1A 部分-不齐整层次结构 (博客) ](http://martinmason.wordpress.com/2012/03/03/the-ssas-financial-cubepart-1aragged-hierarchies-cont/) 。</span><span class="sxs-lookup"><span data-stu-id="d438f-133">See [Martin Mason's the SSAS Financial Cube-Part 1a-Ragged Hierarchies (blog)](http://martinmason.wordpress.com/2012/03/03/the-ssas-financial-cubepart-1aragged-hierarchies-cont/) for details about this technique.</span></span>  
  
##  <a name="set-hidememberif-to-hide-members-in-a-regular-hierarchy"></a><a name="bkmk_Hide"></a> <span data-ttu-id="d438f-134">设置 HideMemberIf 以隐藏规则层次结构中的成员</span><span class="sxs-lookup"><span data-stu-id="d438f-134">Set HideMemberIf to hide members in a regular hierarchy</span></span>  
 <span data-ttu-id="d438f-135">在不规则维度的表中，逻辑上缺少的成员可以用其他方式表示。</span><span class="sxs-lookup"><span data-stu-id="d438f-135">In a ragged dimension's table, the logically missing members can be represented in different ways.</span></span> <span data-ttu-id="d438f-136">表单元可以为空或包含空字符串，也可以包含与它们父级相同的值作为占位符。</span><span class="sxs-lookup"><span data-stu-id="d438f-136">The table cells can contain nulls or empty strings, or they can contain the same value as their parent to serve as a placeholder.</span></span> <span data-ttu-id="d438f-137">占位符的表示形式由子成员的占位符状态（由 `HideMemberIf` 属性确定）和客户端应用程序的 `MDX Compatibility` 连接字符串属性确定。</span><span class="sxs-lookup"><span data-stu-id="d438f-137">The representation of placeholders is determined by the placeholder status of child members, as determined by the `HideMemberIf` property, and the `MDX Compatibility` connection string property for the client application.</span></span>  
  
 <span data-ttu-id="d438f-138">对于支持显示不规则层次结构的客户端应用程序，可以使用这些属性隐藏逻辑上缺少的成员。</span><span class="sxs-lookup"><span data-stu-id="d438f-138">For client applications that support the display of ragged hierarchies, you can use these properties to hide logically missing members.</span></span>  
  
1.  <span data-ttu-id="d438f-139">在 SSDT 中，双击一个维度可在维度设计器中将其打开。</span><span class="sxs-lookup"><span data-stu-id="d438f-139">In SSDT, double-click a dimension to open it in Dimension Designer.</span></span> <span data-ttu-id="d438f-140">第一个选项卡“维度结构”在“层次结构”窗格中显示属性层次结构。</span><span class="sxs-lookup"><span data-stu-id="d438f-140">The first tab, Dimension Structure, shows attribute hierarchies in the Hierarchies pane.</span></span>  
  
2.  <span data-ttu-id="d438f-141">右键单击层次结构中的成员并选择“属性”\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="d438f-141">Right-click a member within the hierarchy and select **Properties**.</span></span> <span data-ttu-id="d438f-142">将 `HideMemberIf` 设置为下面描述的值之一。</span><span class="sxs-lookup"><span data-stu-id="d438f-142">Set `HideMemberIf` to one of the values described below.</span></span>  
  
    |<span data-ttu-id="d438f-143">HideMemberIf 设置</span><span class="sxs-lookup"><span data-stu-id="d438f-143">HideMemberIf Setting</span></span>|<span data-ttu-id="d438f-144">说明</span><span class="sxs-lookup"><span data-stu-id="d438f-144">Description</span></span>|  
    |--------------------------|-----------------|  
    |`Never`|<span data-ttu-id="d438f-145">级别成员从不隐藏。</span><span class="sxs-lookup"><span data-stu-id="d438f-145">Level members are never hidden.</span></span> <span data-ttu-id="d438f-146">这是默认值。</span><span class="sxs-lookup"><span data-stu-id="d438f-146">This is the default value.</span></span>|  
    |<span data-ttu-id="d438f-147">**OnlyChildWithNoName**</span><span class="sxs-lookup"><span data-stu-id="d438f-147">**OnlyChildWithNoName**</span></span>|<span data-ttu-id="d438f-148">如果级别成员是其父级的唯一子级，并且名称为空或空字符串，则隐藏该级别成员。</span><span class="sxs-lookup"><span data-stu-id="d438f-148">A level member is hidden when it is the only child of its parent and its name is null or an empty string.</span></span>|  
    |<span data-ttu-id="d438f-149">**OnlyChildWithParentName**</span><span class="sxs-lookup"><span data-stu-id="d438f-149">**OnlyChildWithParentName**</span></span>|<span data-ttu-id="d438f-150">如果级别成员是其父级的唯一子级，并且名称与其父级名称相同，则隐藏该级别成员。</span><span class="sxs-lookup"><span data-stu-id="d438f-150">A level member is hidden when it is the only child of its parent and its name is the same as the name of its parent.</span></span>|  
    |<span data-ttu-id="d438f-151">**NoName**</span><span class="sxs-lookup"><span data-stu-id="d438f-151">**NoName**</span></span>|<span data-ttu-id="d438f-152">如果级别成员的名称为空，则隐藏该级别成员。</span><span class="sxs-lookup"><span data-stu-id="d438f-152">A level member is hidden when its name is empty.</span></span>|  
    |<span data-ttu-id="d438f-153">**ParentName**</span><span class="sxs-lookup"><span data-stu-id="d438f-153">**ParentName**</span></span>|<span data-ttu-id="d438f-154">如果级别成员的名称与其父级的名称相同，则隐藏该级别成员。</span><span class="sxs-lookup"><span data-stu-id="d438f-154">A level member is hidden when its name is identical to that of its parent.</span></span>|  
  
##  <a name="set-mdx-compatibility-to-determine-how-placeholders-are-represented-in-client-applications"></a><a name="bkmk_Mdx"></a><span data-ttu-id="d438f-155">设置 MDX 兼容性以确定如何在客户端应用程序中表示占位符</span><span class="sxs-lookup"><span data-stu-id="d438f-155">Set MDX Compatibility to determine how placeholders are represented in client applications</span></span>  
 <span data-ttu-id="d438f-156">在层次结构级别上设置 `HideMemberIf` 后，您还应在发送自客户端应用程序的连接字符串中设置 `MDX Compatibility` 属性。</span><span class="sxs-lookup"><span data-stu-id="d438f-156">After setting `HideMemberIf` on a hierarchy level, you should also set the `MDX Compatibility` property in the connection string sent from the client application.</span></span> <span data-ttu-id="d438f-157">`MDX Compatibility` 设置确定是否使用 `HideMemberIf`。</span><span class="sxs-lookup"><span data-stu-id="d438f-157">The `MDX Compatibility` setting determines whether the `HideMemberIf` is used.</span></span>  
  
|<span data-ttu-id="d438f-158">MDX Compatibility 设置</span><span class="sxs-lookup"><span data-stu-id="d438f-158">MDX Compatibility Setting</span></span>|<span data-ttu-id="d438f-159">说明</span><span class="sxs-lookup"><span data-stu-id="d438f-159">Description</span></span>|<span data-ttu-id="d438f-160">使用情况</span><span class="sxs-lookup"><span data-stu-id="d438f-160">Usage</span></span>|  
|-------------------------------|-----------------|-----------|  
|<span data-ttu-id="d438f-161">**1**</span><span class="sxs-lookup"><span data-stu-id="d438f-161">**1**</span></span>|<span data-ttu-id="d438f-162">显示占位符值。</span><span class="sxs-lookup"><span data-stu-id="d438f-162">Show a placeholder value.</span></span>|<span data-ttu-id="d438f-163">这是 Excel、SSDT 和 SSMS 使用的默认值。</span><span class="sxs-lookup"><span data-stu-id="d438f-163">This is the default used by Excel, SSDT, and SSMS.</span></span> <span data-ttu-id="d438f-164">它指示服务器在深化不规则层次结构中的空级别时返回占位符值。</span><span class="sxs-lookup"><span data-stu-id="d438f-164">It instructs the server to return placeholder values when drilling down empty levels in a ragged hierarchy.</span></span> <span data-ttu-id="d438f-165">如果单击占位符值，则可继续深化直到到达子（叶）节点。</span><span class="sxs-lookup"><span data-stu-id="d438f-165">If you click the placeholder value, you can continue down to get to the child (leaf) nodes.</span></span><br /><br /> <span data-ttu-id="d438f-166">Excel 拥有用于连接到 Analysis Services 的连接字符串，并且它始终在每个新连接上将 `MDX Compatibility` 设置为 1。</span><span class="sxs-lookup"><span data-stu-id="d438f-166">Excel owns the connection string used to connect to Analysis Services, and it always sets `MDX Compatibility` to 1 on each new connection.</span></span> <span data-ttu-id="d438f-167">此行为将保留向后兼容性。</span><span class="sxs-lookup"><span data-stu-id="d438f-167">This behavior preserves backward compatibility.</span></span>|  
|<span data-ttu-id="d438f-168">**2**</span><span class="sxs-lookup"><span data-stu-id="d438f-168">**2**</span></span>|<span data-ttu-id="d438f-169">隐藏占位符值（null 值或父级别的重复项），但显示具有相关值的其他级别和节点。</span><span class="sxs-lookup"><span data-stu-id="d438f-169">Hide a placeholder value (either a null value or a duplicate of the parent level), but show other levels and nodes having relevant values.</span></span>|<span data-ttu-id="d438f-170">`MDX Compatibility`=2 通常被视为与不规则层次结构相关的首选设置。</span><span class="sxs-lookup"><span data-stu-id="d438f-170">`MDX Compatibility`=2 is typically viewed as the preferred setting in terms of ragged hierarchies.</span></span> <span data-ttu-id="d438f-171">[!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] 报表和一些第三方客户端应用程序可保留此设置。</span><span class="sxs-lookup"><span data-stu-id="d438f-171">A [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] report and some third-party client applications can persist this setting.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="d438f-172">另请参阅</span><span class="sxs-lookup"><span data-stu-id="d438f-172">See Also</span></span>  
 <span data-ttu-id="d438f-173">[创建用户定义的层次结构](user-defined-hierarchies-create.md) </span><span class="sxs-lookup"><span data-stu-id="d438f-173">[Create User-Defined Hierarchies](user-defined-hierarchies-create.md) </span></span>  
 <span data-ttu-id="d438f-174">[用户层次结构](../multidimensional-models-olap-logical-dimension-objects/user-hierarchies.md) </span><span class="sxs-lookup"><span data-stu-id="d438f-174">[User Hierarchies](../multidimensional-models-olap-logical-dimension-objects/user-hierarchies.md) </span></span>  
 <span data-ttu-id="d438f-175">[父子层次结构](parent-child-dimension.md) </span><span class="sxs-lookup"><span data-stu-id="d438f-175">[Parent-Child Hierarchy](parent-child-dimension.md) </span></span>  
 [<span data-ttu-id="d438f-176">连接字符串属性 (Analysis Services)</span><span class="sxs-lookup"><span data-stu-id="d438f-176">Connection String Properties &#40;Analysis Services&#41;</span></span>](https://docs.microsoft.com/analysis-services/instances/connection-string-properties-analysis-services)  
  
  
