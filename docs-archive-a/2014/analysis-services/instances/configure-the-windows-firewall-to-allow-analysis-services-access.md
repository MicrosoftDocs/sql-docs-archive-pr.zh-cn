---
title: 将 Windows 防火墙配置为允许 Analysis Services 访问 |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
helpviewer_keywords:
- ports [Analysis Services]
- Windows Firewall [Analysis Services]
- firewall systems [Analysis Services]
ms.assetid: 7673acc5-75f0-4703-9ce2-87425ea39d49
author: minewiskan
ms.author: owend
ms.openlocfilehash: f7d63b392148bf10a6b121dd4d201b7a7c61e0c4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87689129"
---
# <a name="configure-the-windows-firewall-to-allow-analysis-services-access"></a><span data-ttu-id="e4d9a-102">将 Windows 防火墙配置为允许 Analysis Services 访问</span><span class="sxs-lookup"><span data-stu-id="e4d9a-102">Configure the Windows Firewall to Allow Analysis Services Access</span></span>
  <span data-ttu-id="e4d9a-103">使 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 或 [!INCLUDE[ssGeminiShort](../../includes/ssgeminishort-md.md)] 可在网络上使用的至关重要的第一步是确定您是否需要在防火墙中取消阻止端口。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-103">An essential first step in making [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] or [!INCLUDE[ssGeminiShort](../../includes/ssgeminishort-md.md)] available on the network is to determine whether you need to unblock ports in a firewall.</span></span> <span data-ttu-id="e4d9a-104">大多数安装都要求您至少创建一个允许连接到 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]的入站防火墙规则。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-104">Most installations will require that you create at least one in-bound firewall rule that allows connections to [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)].</span></span>  
  
 <span data-ttu-id="e4d9a-105">根据您安装 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]的方式，防火墙配置要求会有所不同。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-105">Firewall configuration requirements vary depending on how you installed [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]:</span></span>  
  
-   <span data-ttu-id="e4d9a-106">在安装默认实例或创建 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 故障转移群集时，请打开 TCP 端口 2383。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-106">Open TCP port 2383 when installing a default instance or creating an [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] failover cluster.</span></span>  
  
-   <span data-ttu-id="e4d9a-107">在安装命名实例时打开 TCP 端口 2382。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-107">Open TCP port 2382 when installing a named instance.</span></span> <span data-ttu-id="e4d9a-108">命名实例使用动态端口分配。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-108">Named instances use dynamic port assignments.</span></span> <span data-ttu-id="e4d9a-109">作为 Analysis Services 的发现服务，SQL Server Browser 服务侦听 TCP 端口 2382 并将连接请求重定向到 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]当前使用的端口。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-109">As the discovery service for Analysis Services, SQL Server Browser service listens on TCP port 2382 and redirects the connection request to the port currently used by [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)].</span></span>  
  
-   <span data-ttu-id="e4d9a-110">在 SharePoint 模式下安装 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 时请打开 TCP 端口 2382，以支持 [!INCLUDE[ssGeminiShort](../../includes/ssgeminishort-md.md)] 2013。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-110">Open TCP port 2382 when installing [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] in SharePoint mode to support [!INCLUDE[ssGeminiShort](../../includes/ssgeminishort-md.md)] 2013.</span></span> <span data-ttu-id="e4d9a-111">在 [!INCLUDE[ssGeminiShort](../../includes/ssgeminishort-md.md)] 2013 中， [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 实例是 SharePoint 的外部实例。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-111">In [!INCLUDE[ssGeminiShort](../../includes/ssgeminishort-md.md)] 2013, the [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] instance is external to SharePoint.</span></span> <span data-ttu-id="e4d9a-112">对名为“PowerPivot”实例的入站请求是由 SharePoint Web 应用程序通过网络连接生成的，需要一个开放端口。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-112">Inbound requests to the named 'PowerPivot' instance originate from SharePoint web applications over a network connection, requiring an open port.</span></span> <span data-ttu-id="e4d9a-113">与其他 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 命名实例一样，针对 TCP 2382 为 SQL Server Browser 服务创建一个入站规则以允许访问 [!INCLUDE[ssGeminiShort](../../includes/ssgeminishort-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-113">As with other [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] named instances, create an inbound rule for SQL Server Browser service on TCP 2382 to allow access to [!INCLUDE[ssGeminiShort](../../includes/ssgeminishort-md.md)].</span></span>  
  
-   <span data-ttu-id="e4d9a-114">对于 [!INCLUDE[ssGeminiShort](../../includes/ssgeminishort-md.md)] 2010，请勿在 Windows 防火墙中开放端口。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-114">For [!INCLUDE[ssGeminiShort](../../includes/ssgeminishort-md.md)] 2010, do not open ports in Windows Firewall.</span></span> <span data-ttu-id="e4d9a-115">作为 SharePoint 的外接程序，该服务使用为 SharePoint 配置的端口并且仅与加载和查询 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 数据模型的 [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] 实例建立本地连接。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-115">As an add-in to SharePoint, the service uses ports configured for SharePoint and makes only local connections to the [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] instance that loads and queries [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] data models.</span></span>  
  
-   <span data-ttu-id="e4d9a-116">对于 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 在 Azure 虚拟机上运行的实例，请使用其他说明来配置服务器访问。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-116">For [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] instances running on Azure Virtual Machines, use alternate instructions for configuring server access.</span></span> <span data-ttu-id="e4d9a-117">请参阅[SQL Server Azure 虚拟机中的商业智能](https://msdn.microsoft.com/library/windowsazure/jj992719.aspx)。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-117">See [SQL Server Business Intelligence in Azure Virtual Machines](https://msdn.microsoft.com/library/windowsazure/jj992719.aspx).</span></span>  
  
 <span data-ttu-id="e4d9a-118">尽管的默认实例 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 侦听 TCP 端口2383，但你可以将服务器配置为侦听其他固定端口，并按以下格式连接到服务器： \<servername> ： \<portnumber> 。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-118">Although the default instance of [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] listens on TCP port 2383, you can configure the server to listen on a different fixed port, connecting to the server in this format: \<servername>:\<portnumber>.</span></span>  
  
 <span data-ttu-id="e4d9a-119">一个 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 实例只能使用一个 TCP 端口。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-119">Only one TCP port can be used by an [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] instance.</span></span> <span data-ttu-id="e4d9a-120">在具有多个网卡或多个 IP 地址的计算机上， [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 在一个 TCP 端口上侦听分配给或化名为该计算机的所有 IP 地址。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-120">On computers having multiple network cards or multiple IP addresses, [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] listens on one TCP port for all IP addresses assigned or aliased to the computer.</span></span> <span data-ttu-id="e4d9a-121">如果您有特定多端口要求，请考虑配置 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 以实现 HTTP 访问。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-121">If you have specific multi-port requirements, consider configuring [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] for HTTP access.</span></span> <span data-ttu-id="e4d9a-122">然后您可以在选择的任意端口上设置多个 HTTP 端点。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-122">You can then set up multiple HTTP endpoints on whatever ports you choose.</span></span> <span data-ttu-id="e4d9a-123">请参阅[在 Internet Information Services (IIS) 8.0 上配置对 Analysis Services 的 HTTP 访问](configure-http-access-to-analysis-services-on-iis-8-0.md)。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-123">See [Configure HTTP Access to Analysis Services on Internet Information Services &#40;IIS&#41; 8.0](configure-http-access-to-analysis-services-on-iis-8-0.md).</span></span>  
  
 <span data-ttu-id="e4d9a-124">本主题包含以下各节：</span><span class="sxs-lookup"><span data-stu-id="e4d9a-124">This topic contains the following sections:</span></span>  
  
-   [<span data-ttu-id="e4d9a-125">检查 Analysis Services 的端口和防火墙设置。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-125">Check port and firewall settings for Analysis Services</span></span>](#bkmk_checkport)  
  
-   [<span data-ttu-id="e4d9a-126">为 Analysis Services 的默认实例配置 Windows 防火墙</span><span class="sxs-lookup"><span data-stu-id="e4d9a-126">Configure Windows Firewall for a default instance of Analysis Services</span></span>](#bkmk_default)  
  
-   [<span data-ttu-id="e4d9a-127">为 Analysis Services 的命名实例配置 Windows 防火墙访问</span><span class="sxs-lookup"><span data-stu-id="e4d9a-127">Configure Windows Firewall access for a named instance of Analysis Services</span></span>](#bkmk_named)  
  
-   [<span data-ttu-id="e4d9a-128">Analysis Services 群集的端口配置</span><span class="sxs-lookup"><span data-stu-id="e4d9a-128">Port configuration for an Analysis Services cluster</span></span>](#bkmk_cluster)  
  
-   [<span data-ttu-id="e4d9a-129">PowerPivot for SharePoint 的端口配置</span><span class="sxs-lookup"><span data-stu-id="e4d9a-129">Port configuration for PowerPivot for SharePoint</span></span>](#bkmk_powerpivot)  
  
-   [<span data-ttu-id="e4d9a-130">将固定端口用于 Analysis Services 的默认实例或命名实例</span><span class="sxs-lookup"><span data-stu-id="e4d9a-130">Use a fixed port for a default or named instance of Analysis Services</span></span>](#bkmk_fixed)  
  
 <span data-ttu-id="e4d9a-131">有关默认 Windows 防火墙设置的详细信息以及有关影响数据库引擎、Analysis Services、Reporting Services 和 Integration Services 的 TCP 端口的说明，请参阅 [配置 Windows 防火墙以允许 SQL Server 访问](../../sql-server/install/configure-the-windows-firewall-to-allow-sql-server-access.md)。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-131">For more information about the default Windows firewall settings, and a description of the TCP ports that affect the Database Engine, Analysis Services, Reporting Services, and Integration Services, see [Configure the Windows Firewall to Allow SQL Server Access](../../sql-server/install/configure-the-windows-firewall-to-allow-sql-server-access.md).</span></span>  
  
##  <a name="check-port-and-firewall-settings-for-analysis-services"></a><a name="bkmk_checkport"></a><span data-ttu-id="e4d9a-132">检查 Analysis Services 的端口和防火墙设置</span><span class="sxs-lookup"><span data-stu-id="e4d9a-132">Check port and firewall settings for Analysis Services</span></span>  
 <span data-ttu-id="e4d9a-133">在 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]支持的 Microsoft Windows 操作系统上，Windows 防火墙默认处于打开状态并阻止远程连接。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-133">On the Microsoft Windows operating systems that are supported by [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)], Windows Firewall is on by default and is blocking remote connections.</span></span> <span data-ttu-id="e4d9a-134">必须手动在防火墙中开放某一端口，以便允许对 Analysis Services 的入站请求。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-134">You must manually open a port in the firewall to allow inbound requests to Analysis Services.</span></span> <span data-ttu-id="e4d9a-135">SQL Server 安装程序不自动为您执行此步骤。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-135">SQL Server Setup does not perform this step for you.</span></span>  
  
 <span data-ttu-id="e4d9a-136">在 msmdsrv.ini file 文件以及 SQL Server Management Studio 的 Analysis Services 实例的“常规”属性页中，指定端口设置。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-136">Port settings are specified in the msmdsrv.ini file and in the General properties page of an Analysis Services instance in SQL Server Management Studio.</span></span> <span data-ttu-id="e4d9a-137">如果 `Port` 设置为某个正整数，则该服务正在侦听某个固定端口。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-137">If `Port` is set to a positive integer, the service is listening on a fixed port.</span></span> <span data-ttu-id="e4d9a-138">如果 `Port` 设置为 0，则该服务正在侦听端口 2383（如果该服务是默认实例）或动态分配的端口（如果该服务是命名实例）。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-138">If `Port` is set to 0, the service is listening on port 2383 if it is the default instance or on a dynamically assigned port if it is a named instance.</span></span>  
  
 <span data-ttu-id="e4d9a-139">动态端口分配仅由命名实例使用。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-139">Dynamic port assignments are only used by named instances.</span></span> <span data-ttu-id="e4d9a-140"> 服务确定在它启动时要使用的端口。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-140">The `MSOLAP$InstanceName` service determines which port to use when it starts up.</span></span> <span data-ttu-id="e4d9a-141">您可以通过执行以下操作确定某一命名实例正在使用的实际端口号：</span><span class="sxs-lookup"><span data-stu-id="e4d9a-141">You can determine the actual port number in use by a named instance by doing the following:</span></span>  
  
-   <span data-ttu-id="e4d9a-142">启动任务管理器，然后单击 "**服务**" 以获取 PID `MSOLAP$InstanceName` 。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-142">Start Task Manager and then click **Services** to get the PID of the `MSOLAP$InstanceName`.</span></span>  
  
-   <span data-ttu-id="e4d9a-143">从命令行运行 `netstat -ao -p TCP`，以便查看该 PID 的 TCP 端口信息。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-143">Run `netstat -ao -p TCP` from the command line to view the TCP port information for that PID.</span></span>  
  
-   <span data-ttu-id="e4d9a-144">使用 SQL Server Management Studio 验证端口，并按以下格式连接到 Analysis Services 服务器： \<IPAddress> ： \<portnumber> 。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-144">Verify the port by using SQL Server Management Studio and connect to an Analysis Services server in this format: \<IPAddress>:\<portnumber>.</span></span>  
  
 <span data-ttu-id="e4d9a-145">尽管应用程序可能在侦听某一特定端口，但如果防火墙正在阻止访问，则连接将不会成功。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-145">Although an application might be listening on a specific port, connections will not succeed if a firewall is blocking access.</span></span> <span data-ttu-id="e4d9a-146">为了实现与某一命名 Analysis Services 实例的连接，您必须取消阻止对 msmdsrv.exe 或者该实例在防火墙中所侦听的固定端口的访问。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-146">In order for connections to reach a named Analysis Services instance, you must unblock access to either msmdsrv.exe or the fixed port on which it is listening in the firewall.</span></span> <span data-ttu-id="e4d9a-147">本主题中的其余部分将说明如何取消阻止。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-147">The remaining sections in this topic provide instructions for doing so.</span></span>  
  
 <span data-ttu-id="e4d9a-148">若要查看是否已为 Analysis Services 定义了防火墙设置，请在“控制面板”中使用“高级安全 Windows 防火墙”。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-148">To check whether firewall settings are already defined for Analysis Services, use Windows Firewall with Advanced Security in Control Panel.</span></span> <span data-ttu-id="e4d9a-149">“监视”文件夹的“防火墙”页显示为本地服务器定义的规则的完整列表。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-149">The Firewall page in the Monitoring folder shows a complete list of the rules defined for the local server.</span></span>  
  
 <span data-ttu-id="e4d9a-150">请注意，对于 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]，必须手动定义所有防火墙规则。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-150">Note that for [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)], all firewall rules must be manually defined.</span></span> <span data-ttu-id="e4d9a-151">尽管 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 和 SQL Server Browser 保留端口 2382 和 2383，但 SQL Server 安装程序以及任何配置工具都不会定义允许访问这些端口或程序可执行文件的防火墙规则。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-151">Although [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] and SQL Server Browser reserve ports 2382 and 2383, neither the SQL Server setup program nor any of the configuration tools define firewall rules that allow access to either the ports or the program executable files.</span></span>  
  
##  <a name="configure-windows-firewall-for-a-default-instance-of-analysis-services"></a><a name="bkmk_default"></a> <span data-ttu-id="e4d9a-152">为 Analysis Services 的默认实例配置 Windows 防火墙</span><span class="sxs-lookup"><span data-stu-id="e4d9a-152">Configure Windows Firewall for a default instance of Analysis Services</span></span>  
 <span data-ttu-id="e4d9a-153">默认的 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 实例侦听 TCP 端口 2383。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-153">The default instance of [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] listens on TCP port 2383.</span></span> <span data-ttu-id="e4d9a-154">如果您安装了默认实例并且想要使用此端口，则仅需在 Windows 防火墙中取消阻止对 TCP 端口 2383 的入站访问，以便允许远程访问 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]的默认实例。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-154">If you installed the default instance and want to use this port, you only need to unblock inbound access to TCP port 2383 in Windows Firewall to enable remote access to the default instance of [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)].</span></span> <span data-ttu-id="e4d9a-155">如果您安装了该默认实例，但是想要将服务配置为侦听固定端口，请参阅本主题中的 [将固定端口用于 Analysis Services 的默认实例或命名实例](#bkmk_fixed) 。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-155">If you installed the default instance but want to configure the service to listen on a fixed port, see [Use a fixed port for a default or named instance of Analysis Services](#bkmk_fixed) in this topic.</span></span>  
  
 <span data-ttu-id="e4d9a-156">若要确认该服务是否正作为默认实例 (MSSQLServerOLAPService) 运行，请在 SQL Server 配置管理器中查看服务名称。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-156">To verify whether the service is running as the default instance (MSSQLServerOLAPService), check the service name in SQL Server Configuration Manager.</span></span> <span data-ttu-id="e4d9a-157">Analysis Services 的默认实例始终作为“SQL Server Analysis Services (MSSQLSERVER)”列出\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-157">A default instance of Analysis Services is always listed as **SQL Server Analysis Services (MSSQLSERVER)**.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="e4d9a-158">不同的 Windows 操作系统为配置 Windows 防火墙提供可供选择的工具。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-158">Different Windows operating systems provide alternative tools for configuring Windows Firewall.</span></span> <span data-ttu-id="e4d9a-159">其中大多数工具都允许您在打开特定端口还是程序可执行文件之间进行选择。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-159">Most of these tools let you choose between opening a specific port or program executable.</span></span> <span data-ttu-id="e4d9a-160">除非您有具体原因来指定程序可执行文件，否则，我们建议您指定端口。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-160">Unless you have a reason for specifying the program executable, we recommend that you specify the port.</span></span>  
  
 <span data-ttu-id="e4d9a-161">在指定入站规则时，请确保采用使你以后能够轻松找到规则的命名约定（例如 **SQL Server Analysis Services (TCP-in) 2383**）。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-161">When specifying an inbound rule, be sure to adopt a naming convention that allows you to easily find the rules later (for example, **SQL Server Analysis Services (TCP-in) 2383**).</span></span>  
  
#### <a name="windows-firewall-with-advanced-security"></a><span data-ttu-id="e4d9a-162">高级安全 Windows 防火墙</span><span class="sxs-lookup"><span data-stu-id="e4d9a-162">Windows Firewall with Advanced Security</span></span>  
  
1.  <span data-ttu-id="e4d9a-163">在 Windows 7 或 Windows Vista 上，单击“控制面板”中的 **“系统和安全”**，选择 **“Windows 防火墙”**，然后单击 **“高级设置”**。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-163">On Windows 7 or Windows Vista, in Control Panel, click **System and Security**, select **Windows Firewall**, and then click **Advanced settings**.</span></span> <span data-ttu-id="e4d9a-164">在 Windows Server 2008 或 2008 R2 上，打开“管理员工具”，然后单击 **“高级安全 Windows 防火墙”**。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-164">On Windows Server 2008 or 2008 R2, open Administrator Tools and click **Windows Firewall with Advanced Security**.</span></span> <span data-ttu-id="e4d9a-165">在 Windows Server 2012 上，打开“应用程序”页并键入 **Windows 防火墙**。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-165">On Windows Server 2012, open the Applications page and type **Windows Firewall**.</span></span>  
  
2.  <span data-ttu-id="e4d9a-166">右键单击“入站规则”\*\*\*\*，然后选择“新建规则”\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-166">Right-click **Inbound Rules** and select **New Rule**.</span></span>  
  
3.  <span data-ttu-id="e4d9a-167">在 "规则类型" 中，单击 `Port` ，然后单击 "**下一步**"。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-167">In Rule Type, click `Port` and then click **Next**.</span></span>  
  
4.  <span data-ttu-id="e4d9a-168">在 "协议和端口" 中，选择 " **TCP** "，然后键入 `2383` "**特定本地端口**"。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-168">In Protocol and Ports, select **TCP** and then type `2383` in **Specific local ports**.</span></span>  
  
5.  <span data-ttu-id="e4d9a-169">在“操作”中，单击 **“允许连接”** ，然后单击 **“下一步”**。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-169">In Action, click **Allow the connection** and then click **Next**.</span></span>  
  
6.  <span data-ttu-id="e4d9a-170">在“配置文件”中，清除不适用的所有网络位置，然后单击 **“下一步”**。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-170">In Profile, clear any network locations that do not apply and then click **Next**.</span></span>  
  
7.  <span data-ttu-id="e4d9a-171">在 "名称" 中，键入此规则的描述性名称 (例如， `SQL Server Analysis Services (tcp-in) 2383`) ，然后单击 "**完成**"。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-171">In Name, type a descriptive name for this rule (for example, `SQL Server Analysis Services (tcp-in) 2383`), and then click **Finish**.</span></span>  
  
8.  <span data-ttu-id="e4d9a-172">若要确认远程连接已启用，请在另一台计算机上打开 SQL Server Management Studio 或 Excel，然后通过在 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] “服务器名称” **中指定服务器的网络名称来连接到**。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-172">To verify that remote connections are enabled, open SQL Server Management Studio or Excel on a different computer and connect to [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] by specifying the network name of the server in **Server name**.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="e4d9a-173">在您授予权限前，其他用户将无权访问此服务器。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-173">Other users will not have access to this server until you grant permissions.</span></span> <span data-ttu-id="e4d9a-174">有关详细信息，请参阅[授予对对象和操作的访问权限 (Analysis Services)](../multidimensional-models/authorizing-access-to-objects-and-operations-analysis-services.md)。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-174">For more information, see [Authorizing access to objects and operations &#40;Analysis Services&#41;](../multidimensional-models/authorizing-access-to-objects-and-operations-analysis-services.md).</span></span>  
  
#### <a name="netsh-advfirewall-syntax"></a><span data-ttu-id="e4d9a-175">Netsh AdvFirewall 语法</span><span class="sxs-lookup"><span data-stu-id="e4d9a-175">Netsh AdvFirewall Syntax</span></span>  
  
-   <span data-ttu-id="e4d9a-176">下面的命令创建一个入站规则，该规则允许 TCP 端口 2383 上的传入请求。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-176">The following command creates an inbound rule that allows incoming requests on TCP port 2383.</span></span>  
  
    ```  
    netsh advfirewall firewall add rule name="SQL Server Analysis Services inbound on TCP 2383" dir=in action=allow protocol=TCP localport=2383 profile=domain  
    ```  
  
##  <a name="configure-windows-firewall-access-for-a-named-instance-of-analysis-services"></a><a name="bkmk_named"></a><span data-ttu-id="e4d9a-177">为的命名实例配置 Windows 防火墙访问 Analysis Services</span><span class="sxs-lookup"><span data-stu-id="e4d9a-177">Configure Windows Firewall access for a named instance of Analysis Services</span></span>  
 <span data-ttu-id="e4d9a-178">[!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 的命名实例可侦听固定端口或动态分配的端口，其中，SQL Server Browser 服务提供在连接时对服务而言是最新的连接信息。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-178">Named instances of [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] can either listen on a fixed port or on a dynamically assigned port, where SQL Server Browser service provides the connection information that is current for the service at the time of the connection.</span></span>  
  
 <span data-ttu-id="e4d9a-179">SQL Server Browser 服务侦听 TCP 端口 2382。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-179">SQL Server Browser service listens on TCP port 2382.</span></span> <span data-ttu-id="e4d9a-180">不使用 UDP。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-180">UDP is not used.</span></span> <span data-ttu-id="e4d9a-181">TCP 是 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]使用的唯一传输协议。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-181">TCP is the only transmission protocol used by [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)].</span></span>  
  
 <span data-ttu-id="e4d9a-182">选择以下方法之一可以启用对 Analysis Services 的命名实例的远程访问：</span><span class="sxs-lookup"><span data-stu-id="e4d9a-182">Choose one of the following approaches to enable remote access to a named instance of Analysis Services:</span></span>  
  
-   <span data-ttu-id="e4d9a-183">使用动态端口分配和 SQL Server Browser 服务。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-183">Use dynamic port assignments and SQL Server Browser service.</span></span> <span data-ttu-id="e4d9a-184">在 Windows 防火墙中取消阻止 SQL Server Browser 服务使用的端口。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-184">Unblock the port used by SQL Server Browser service in Windows Firewall.</span></span> <span data-ttu-id="e4d9a-185">按以下格式连接到服务器： \<servername> \\<instancename \> 。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-185">Connect to the server in this format: \<servername>\\<instancename\>.</span></span>  
  
-   <span data-ttu-id="e4d9a-186">一起使用固定端口和 SQL Server Browser 服务。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-186">Use a fixed port and SQL Server Browser service together.</span></span> <span data-ttu-id="e4d9a-187">此方法允许你使用以下格式进行连接： \<servername> \\<instancename \> ，与动态端口分配方法相同，不同之处在于，在这种情况下，服务器侦听固定端口。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-187">This approach lets you connect using this format: \<servername>\\<instancename\>, identical to the dynamic port assignment approach, except that in this case the server listens on a fixed port.</span></span> <span data-ttu-id="e4d9a-188">在此方案中，SQL Server Browser 服务提供对在固定端口上侦听的 Analysis Services 实例的名称解析。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-188">In this scenario, SQL Server Browser Service provides name resolution to the Analysis Services instance listening on the fixed port.</span></span> <span data-ttu-id="e4d9a-189">若要使用此方法，请将服务器配置为侦听固定端口，取消阻止对该端口的访问，并且取消阻止对 SQL Server Browser 服务使用的端口的访问。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-189">To use this approach, configure the server to listen on a fixed port, unblock access to that port, and unblock access to the port used by SQL Server Browser service.</span></span>  
  
 <span data-ttu-id="e4d9a-190">SQL Server Browser 服务仅用于命名实例，不能用于默认实例。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-190">SQL Server Browser service is only used with named instances, never with the default instance.</span></span> <span data-ttu-id="e4d9a-191">只要您将任何 SQL Server 功能作为命名实例安装，就将自动安装和启用该服务。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-191">The service is automatically installed and enabled whenever you install any SQL Server feature as a named instance.</span></span> <span data-ttu-id="e4d9a-192">如果您选择要求 SQL Server Browser 服务的方法，请确保该服务在您的服务器上保持启用和启动。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-192">If you choose an approach that requires SQL Server Browser service, be sure it remains enabled and started on your server.</span></span>  
  
 <span data-ttu-id="e4d9a-193">如果无法使用 SQL Server Browser 服务，则必须在连接字符串中分配固定端口，绕过域名解析。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-193">If you cannot use SQL Server Browser service, you must assign a fixed port in the connection string, bypassing domain name resolution.</span></span> <span data-ttu-id="e4d9a-194">没有 SQL Server Browser 服务，所有客户端连接都必须在连接字符串上包括端口号（例如 AW-SRV01:54321）。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-194">Without SQL Server Browser service, all client connections must include the port number on the connection string (for example, AW-SRV01:54321).</span></span>  
  
 <span data-ttu-id="e4d9a-195">**选项 1：使用动态端口分配并且取消阻止对 SQL Server Browser 服务的访问**</span><span class="sxs-lookup"><span data-stu-id="e4d9a-195">**Option 1: Use dynamic port assignments and unblock access to SQL Server Browser service**</span></span>  
  
 <span data-ttu-id="e4d9a-196">在服务启动时由 `MSOLAP$InstanceName` 建立对 Analysis Services 的命名实例的端口分配。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-196">Dynamic port assignments for named instances of Analysis Services are established by the `MSOLAP$InstanceName` when the service starts.</span></span> <span data-ttu-id="e4d9a-197">默认情况下，该服务声明它找到的第一个可用端口号，并且在该服务每次重新启动时都使用不同的端口号。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-197">By default, the service claims the first available port number that it finds, using a different port number each time the service is restarted.</span></span>  
  
 <span data-ttu-id="e4d9a-198">实例名称解析由 SQL Server Browser 服务处理。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-198">Instance name resolution is handled by the SQL Server browser service.</span></span> <span data-ttu-id="e4d9a-199">如果您在将动态端口分配用于命名实例，则始终要求为 SQL Server Browser 服务取消阻止 TCP 端口 2382。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-199">Unblocking TCP port 2382 for SQL Server Browser service is always required if you are using dynamic port assignments with a named instance.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="e4d9a-200">SQL Server Browser 服务分别为数据库引擎和 Analysis Services 侦听 UDP 端口 1434 和 TCP 端口 2382。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-200">SQL Server Browser service listens on both UDP port 1434 and TCP port 2382 for the Database Engine and Analysis Services, respectively.</span></span> <span data-ttu-id="e4d9a-201">即使您已经为 SQL Server Browser 服务取消阻止了 UDP 端口 1434，也仍然必须为 Analysis Services 取消阻止 TCP 端口 2382。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-201">Even if you already unblocked UDP port 1434 for the SQL Server Browser service, you must still unblock TCP port 2382 for Analysis Services.</span></span>  
  
#### <a name="windows-firewall-with-advanced-security"></a><span data-ttu-id="e4d9a-202">高级安全 Windows 防火墙</span><span class="sxs-lookup"><span data-stu-id="e4d9a-202">Windows Firewall with Advanced Security</span></span>  
  
1.  <span data-ttu-id="e4d9a-203">在 Windows 7 或 Windows Vista 上，单击“控制面板”中的 **“系统和安全”**，选择 **“Windows 防火墙”**，然后单击 **“高级设置”**。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-203">On Windows 7 or Windows Vista, in Control Panel, click **System and Security**, select **Windows Firewall**, and then click **Advanced settings**.</span></span> <span data-ttu-id="e4d9a-204">在 Windows Server 2008 或 2008 R2 上，打开“管理员工具”，然后单击 **“高级安全 Windows 防火墙”**。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-204">On Windows Server 2008 or 2008 R2, open Administrator Tools and click **Windows Firewall with Advanced Security**.</span></span> <span data-ttu-id="e4d9a-205">在 Windows Server 2012 上，打开“应用程序”页并键入 **Windows 防火墙**。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-205">On Windows Server 2012, open the Applications page and type **Windows Firewall**.</span></span>  
  
2.  <span data-ttu-id="e4d9a-206">若要取消阻止对 SQL Server Browser 服务的访问，请右键单击“入站规则”\*\*\*\*，然后选择“新建规则”\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-206">To unblock access to SQL Server Browser service, right-click **Inbound Rules** and select **New Rule**.</span></span>  
  
3.  <span data-ttu-id="e4d9a-207">在 "规则类型" 中，单击 `Port` ，然后单击 "**下一步**"。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-207">In Rule Type, click `Port` and then click **Next**.</span></span>  
  
4.  <span data-ttu-id="e4d9a-208">在 "协议和端口" 中，选择 " **TCP** "，然后键入 `2382` "**特定本地端口**"。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-208">In Protocol and Ports, select **TCP** and then type `2382` in **Specific local ports**.</span></span>  
  
5.  <span data-ttu-id="e4d9a-209">在“操作”中，单击 **“允许连接”** ，然后单击 **“下一步”**。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-209">In Action, click **Allow the connection** and then click **Next**.</span></span>  
  
6.  <span data-ttu-id="e4d9a-210">在“配置文件”中，清除不适用的所有网络位置，然后单击 **“下一步”**。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-210">In Profile, clear any network locations that do not apply and then click **Next**.</span></span>  
  
7.  <span data-ttu-id="e4d9a-211">在 "名称" 中，键入此规则的描述性名称 (例如， `SQL Server Browser Service (tcp-in) 2382`) ，然后单击 "**完成**"。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-211">In Name, type a descriptive name for this rule (for example, `SQL Server Browser Service (tcp-in) 2382`), and then click **Finish**.</span></span>  
  
8.  <span data-ttu-id="e4d9a-212">若要验证是否已启用远程连接，请在另一台计算机上打开 SQL Server Management Studio 或 Excel，然后通过按以下格式指定服务器的网络名称和实例名称来连接到 Analysis Services： \<servername> \\<instancename \> 。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-212">To verify that remote connections are enabled, open SQL Server Management Studio or Excel on a different computer and connect to the Analysis Services by specifying the network name of the server and the instance name in this format: \<servername>\\<instancename\>.</span></span> <span data-ttu-id="e4d9a-213">例如，在具有 **Finance** 的命名实例的名为 **AW-SRV01** 的服务器上，服务器名称为 **AW-SRV01\Finance**。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-213">For example, on a server named **AW-SRV01** with a named instance of **Finance**, the server name is **AW-SRV01\Finance**.</span></span>  
  
 <span data-ttu-id="e4d9a-214">**选项 2：将固定端口用于命名实例**</span><span class="sxs-lookup"><span data-stu-id="e4d9a-214">**Option 2: Use a fixed port for a named instance**</span></span>  
  
 <span data-ttu-id="e4d9a-215">或者，您可以分配一个固定端口，然后取消阻止对该端口的访问。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-215">Alternatively, you can assign a fixed port, and then unblock access to that port.</span></span> <span data-ttu-id="e4d9a-216">与允许访问程序可执行文件的方法相比，此方法可提高审核功能。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-216">This approach offers better auditing capability than if you allowed access to the program executable.</span></span> <span data-ttu-id="e4d9a-217">因此，建议使用固定端口来访问所有 Analysis Services 实例。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-217">For this reason, using a fixed port is the recommended approach for accessing any Analysis Services instance.</span></span>  
  
 <span data-ttu-id="e4d9a-218">若要分配固定端口，请按照本主题的 [将固定端口用于 Analysis Services 的默认实例或命名实例](#bkmk_fixed) 中的说明执行，然后返回到本节以便取消阻止该端口。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-218">To assign a fixed port, follow the instructions in [Use a fixed port for a default or named instance of Analysis Services](#bkmk_fixed) in this topic, then return to this section to unblock the port.</span></span>  
  
#### <a name="windows-firewall-with-advanced-security"></a><span data-ttu-id="e4d9a-219">高级安全 Windows 防火墙</span><span class="sxs-lookup"><span data-stu-id="e4d9a-219">Windows Firewall with Advanced Security</span></span>  
  
1.  <span data-ttu-id="e4d9a-220">在 Windows 7 或 Windows Vista 上，单击“控制面板”中的 **“系统和安全”**，选择 **“Windows 防火墙”**，然后单击 **“高级设置”**。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-220">On Windows 7 or Windows Vista, in Control Panel, click **System and Security**, select **Windows Firewall**, and then click **Advanced settings**.</span></span> <span data-ttu-id="e4d9a-221">在 Windows Server 2008 或 2008 R2 上，打开“管理员工具”，然后单击 **“高级安全 Windows 防火墙”**。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-221">On Windows Server 2008 or 2008 R2, open Administrator Tools and click **Windows Firewall with Advanced Security**.</span></span> <span data-ttu-id="e4d9a-222">在 Windows Server 2012 上，打开“应用程序”页并键入 **Windows 防火墙**。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-222">On Windows Server 2012, open the Applications page and type **Windows Firewall**.</span></span>  
  
2.  <span data-ttu-id="e4d9a-223">若要取消阻止对 Analysis Services 的访问，请右键单击“入站规则”\*\*\*\*，然后选择“新建规则”\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-223">To unblock access to Analysis Services, right-click **Inbound Rules** and select **New Rule**.</span></span>  
  
3.  <span data-ttu-id="e4d9a-224">在 "规则类型" 中，单击 `Port` ，然后单击 "**下一步**"。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-224">In Rule Type, click `Port` and then click **Next**.</span></span>  
  
4.  <span data-ttu-id="e4d9a-225">在“协议和端口”中，选择 **“TCP”** ，然后在 **“特定本地端口”** 中键入固定端口。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-225">In Protocol and Ports, select **TCP** and then type the fixed port in **Specific local ports**.</span></span>  
  
5.  <span data-ttu-id="e4d9a-226">在“操作”中，单击 **“允许连接”** ，然后单击 **“下一步”**。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-226">In Action, click **Allow the connection** and then click **Next**.</span></span>  
  
6.  <span data-ttu-id="e4d9a-227">在“配置文件”中，清除不适用的所有网络位置，然后单击 **“下一步”**。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-227">In Profile, clear any network locations that do not apply and then click **Next**.</span></span>  
  
7.  <span data-ttu-id="e4d9a-228">在 "名称" 中，键入此规则的描述性名称 (例如， `SQL Server Analysis Services on port 54321`) ，然后单击 "**完成**"。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-228">In Name, type a descriptive name for this rule (for example, `SQL Server Analysis Services on port 54321`), and then click **Finish**.</span></span>  
  
8.  <span data-ttu-id="e4d9a-229">若要验证远程连接是否已启用，请在另一台计算机上打开 SQL Server Management Studio 或 Excel，并通过指定服务器的网络名称和端口号来连接到 Analysis Services，格式为： \<servername> ： \<portnumber> 。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-229">To verify that remote connections are enabled, open SQL Server Management Studio or Excel on a different computer and connect to the Analysis Services by specifying the network name of the server and the port number in this format: \<servername>:\<portnumber>.</span></span>  
  
#### <a name="netsh-advfirewall-syntax"></a><span data-ttu-id="e4d9a-230">Netsh AdvFirewall 语法</span><span class="sxs-lookup"><span data-stu-id="e4d9a-230">Netsh AdvFirewall Syntax</span></span>  
  
-   <span data-ttu-id="e4d9a-231">下面的命令创建两个入站规则；一个规则为 SQL Server Browser 服务取消阻止 TCP 2382，另一个规则取消阻止您为 Analysis Services 实例指定的固定端口。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-231">The following commands create inbound rules that unblock TCP 2382 for SQL Server Browser service and unblock the fixed port that you specified for the Analysis Services instance.</span></span> <span data-ttu-id="e4d9a-232">您可以运行这两个规则中的一个以便允许访问 Analysis Services 实例。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-232">You can run either one to allow access to a named Analysis Services instance.</span></span>  
  
     <span data-ttu-id="e4d9a-233">在这个示例命令中，端口 54321 是固定端口。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-233">In this sample command, port 54321 is the fixed port.</span></span> <span data-ttu-id="e4d9a-234">请确保用在您的系统上使用的实际端口替换此端口。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-234">Be sure to replace it with the actual port in use on your system.</span></span>  
  
    ```  
    netsh advfirewall firewall add rule name="SQL Server Analysis Services (tcp-in) on 54321" dir=in action=allow protocol=TCP localport=54321 profile=domain  
    ```  
  
    ```  
    netsh advfirewall firewall add rule name="SQL Server Browser Services inbound on TCP 2382" dir=in action=allow protocol=TCP localport=2382 profile=domain  
    ```  
  
##  <a name="use-a-fixed-port-for-a-default-or-named-instance-of-analysis-services"></a><a name="bkmk_fixed"></a><span data-ttu-id="e4d9a-235">为 Analysis Services 的默认实例或命名实例使用固定端口</span><span class="sxs-lookup"><span data-stu-id="e4d9a-235">Use a fixed port for a default or named instance of Analysis Services</span></span>  
 <span data-ttu-id="e4d9a-236">本节说明如何配置 Analysis Services 以便侦听固定端口。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-236">This section explains how to configure Analysis Services to listen on a fixed port.</span></span> <span data-ttu-id="e4d9a-237">如果您将 Analysis Services 作为命名实例安装，则使用固定端口较为常见；但是，如果业务或安全要求指定您使用非默认端口分配，则也可以使用此方法。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-237">Using a fixed port is common if you installed Analysis Services as a named instance, but you can also use this approach if business or security requirements specify that you use non-default port assignments.</span></span>  
  
 <span data-ttu-id="e4d9a-238">请注意，使用固定端口将通过要求您将端口号追加到服务器名称后，更改默认实例的连接语法。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-238">Note that using a fixed port will alter the connection syntax for the default instance by requiring you to append the port number to the server name.</span></span> <span data-ttu-id="e4d9a-239">例如，在连接到在 SQL Server Management Studio 中侦听端口 54321 的本地默认 Analysis Services 实例时，将要求您在 Management Studio 的“连接到服务器”对话框中键入 localhost:54321 作为服务器名称。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-239">For example, connecting to a local, default Analysis Services instance listening on port 54321 in SQL Server Management Studio would require that you type localhost:54321 as the server name in the Connect to Server dialog box in Management Studio.</span></span>  
  
 <span data-ttu-id="e4d9a-240">如果你使用的是命名实例，则可以分配一个固定端口，但不更改指定服务器名称 (具体而言，你可以使用 \<servername\instancename> 连接到侦听固定端口) 上的命名实例。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-240">If you are using a named instance, you can assign a fixed port with no changes to how you specify the server name (specifically, you can use \<servername\instancename> to connect to a named instance listening on a fixed port).</span></span> <span data-ttu-id="e4d9a-241">这仅适用于 SQL Server Browser 服务正在运行并且您已取消阻止了该服务正在侦听的端口的情况。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-241">This works only if SQL Server Browser service is running and you unblocked the port on which it is listening.</span></span> <span data-ttu-id="e4d9a-242">SQL Server Browser 服务将提供基于的固定端口的重定向 \<servername\instancename> 。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-242">SQL Server Browser service will provide redirection to the fixed port based on \<servername\instancename>.</span></span> <span data-ttu-id="e4d9a-243">只要您为 SQL Server Browser 服务以及侦听固定端口的 Analysis Services 的命名实例开放端口，SQL Server Browser 服务就会解析与命名实例的连接。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-243">As long as you open ports for both SQL Server Browser service and the named instance of Analysis Services listening on the fixed port, SQL Server Browser service will resolve the connection to a named instance.</span></span>  
  
1.  <span data-ttu-id="e4d9a-244">确定要使用的可用 TCP/IP 端口。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-244">Determine an available TCP/IP port to use.</span></span>  
  
     <span data-ttu-id="e4d9a-245">若要查看应避免使用的保留和已注册端口的列表，请参阅 [端口号 (IANA)](https://go.microsoft.com/fwlink/?LinkID=198469)。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-245">To view a list of reserved and registered ports that you should avoid using, see [Port Numbers (IANA)](https://go.microsoft.com/fwlink/?LinkID=198469).</span></span> <span data-ttu-id="e4d9a-246">若要查看在您的系统上已使用端口的列表，请打开命令提示符窗口，然后键入 `netstat -a -p TCP` 以便显示已在系统上打开的 TCP 端口的列表。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-246">To view a list of ports that are already in use on your system, open a command prompt window and type `netstat -a -p TCP` to display a list of the TCP ports that are open on the system.</span></span>  
  
2.  <span data-ttu-id="e4d9a-247">在您确定了要使用的端口后，通过在 msmdsrv.ini 文件中或者在 SQL Server Management Studio 的 Analysis Services 实例的“常规属性”页中编辑 `Port` 配置设置，指定该端口。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-247">After you determine which port to use, specify the port by either editing the `Port` configuration setting in the msmdsrv.ini file or in the General properties page of an Analysis Services instance in SQL Server Management Studio.</span></span>  
  
3.  <span data-ttu-id="e4d9a-248">重启服务。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-248">Restart the service.</span></span>  
  
4.  <span data-ttu-id="e4d9a-249">配置 Windows 防火墙以便取消阻止您指定的 TCP 端口。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-249">Configure Windows Firewall to unblock the TCP port you specified.</span></span> <span data-ttu-id="e4d9a-250">或者，如果您在将固定端口用于命名实例，则取消阻止您为该实例指定的 TCP 端口以及为 SQL Server Browser 服务指定的 TCP 端口 2382。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-250">Or, if you are using a fixed port for a named instance, unblock both the TCP port you specified for that instance and TCP port 2382 for SQL Server Browser service.</span></span>  
  
5.  <span data-ttu-id="e4d9a-251">通过先进行本地连接（在 Management Studio 中），然后从其他计算机上的客户端应用程序进行远程连接，进行验证。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-251">Verify by connecting locally (in Management Studio) and then remotely from a client application on another computer.</span></span> <span data-ttu-id="e4d9a-252">若要使用 Management Studio，请通过按以下格式指定服务器名称连接到 Analysis Services 的默认实例： \<servername> ： \<portnumber> 。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-252">To use Management Studio, connect to an Analysis Services default instance by specifying a server name in this format: \<servername>:\<portnumber>.</span></span> <span data-ttu-id="e4d9a-253">对于命名实例，请将服务器名称指定为 \<servername> \\<instancename \> 。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-253">For a named instance, specify the server name as \<servername>\\<instancename\>.</span></span>  
  
##  <a name="port-configuration-for-an-analysis-services-cluster"></a><a name="bkmk_cluster"></a><span data-ttu-id="e4d9a-254">Analysis Services 群集的端口配置</span><span class="sxs-lookup"><span data-stu-id="e4d9a-254">Port configuration for an Analysis Services cluster</span></span>  
 <span data-ttu-id="e4d9a-255">无论安装为默认实例还是命名实例， [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 故障转移群集始终在 TCP 端口 2383 上进行侦听。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-255">An [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] failover cluster always listens on TCP port 2383, regardless of whether you installed it as a default instance or named instance.</span></span> <span data-ttu-id="e4d9a-256">安装在 Windows 故障转移群集上时， [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 不使用动态端口分配。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-256">Dynamic port assignments are not used by [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] when it is installed on a Windows failover cluster.</span></span> <span data-ttu-id="e4d9a-257">请务必在群集中运行 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 的所有节点上开放 TCP 2383。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-257">Be sure to open TCP 2383 on every node running [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] in the cluster.</span></span> <span data-ttu-id="e4d9a-258">有关 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]群集的详细信息，请参阅 [如何安装群集 SQL Server Analysis Services](https://go.microsoft.com/fwlink/p/?LinkId=396548)。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-258">For more information about clustering [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)], see [How to Cluster SQL Server Analysis Services](https://go.microsoft.com/fwlink/p/?LinkId=396548).</span></span>  
  
##  <a name="port-configuration-for-powerpivot-for-sharepoint"></a><a name="bkmk_powerpivot"></a><span data-ttu-id="e4d9a-259">PowerPivot for SharePoint 的端口配置</span><span class="sxs-lookup"><span data-stu-id="e4d9a-259">Port configuration for PowerPivot for SharePoint</span></span>  
 <span data-ttu-id="e4d9a-260">根据您使用的 SharePoint 版本， [!INCLUDE[ssGeminiShort](../../includes/ssgeminishort-md.md)] 的服务器体系结构会有本质区别。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-260">Server architecture for [!INCLUDE[ssGeminiShort](../../includes/ssgeminishort-md.md)] is fundamentally different depending on which version of SharePoint you are using.</span></span>  
  
 <span data-ttu-id="e4d9a-261">**SharePoint 2013**</span><span class="sxs-lookup"><span data-stu-id="e4d9a-261">**SharePoint 2013**</span></span>  
  
 <span data-ttu-id="e4d9a-262">在 SharePoint 2013 中，Excel Services 会重定向对 Power Pivot 数据模型的请求，这些模型随后将在 SharePoint 环境外部的某一 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 实例上加载。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-262">In SharePoint 2013, Excel Services redirects requests for Power Pivot data models, which are subsequently loaded on an [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] instance outside of the SharePoint environment.</span></span> <span data-ttu-id="e4d9a-263">连接遵循通常的模式，在该模式下，本地计算机上的 Analysis Services 客户端库向同一网络中的远程 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 实例发送连接请求。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-263">Connections follow the typical pattern, where an Analysis Services client library on a local computer sends a connection request to a remote [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] instance in the same network.</span></span>  
  
 <span data-ttu-id="e4d9a-264">因为 [!INCLUDE[ssGeminiShort](../../includes/ssgeminishort-md.md)] 始终将 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 安装为命名实例，所以您应采用 SQL Server Browser 服务和动态端口分配。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-264">Because [!INCLUDE[ssGeminiShort](../../includes/ssgeminishort-md.md)] always installs [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] as a named instance, you should assume SQL Server Browser service and dynamic port assignments.</span></span> <span data-ttu-id="e4d9a-265">如前所述，SQL Server Browser 服务在 TCP 端口 2382 上侦听发送到 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 命名实例的连接请求，并将该请求重定向到当前端口。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-265">As noted earlier, SQL Server Browser service listens on TCP port 2382 for connection requests sent to [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] named instances, redirecting the request to the current port.</span></span>  
  
 <span data-ttu-id="e4d9a-266">请注意，SharePoint 2013 中的 Excel Services 不支持固定端口连接语法，因此请确保 SQL Server Browser 服务可以访问。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-266">Note that Excel Services in SharePoint 2013 does not support the fixed port connection syntax, so make sure SQL Server Browser service is accessible.</span></span>  
  
 <span data-ttu-id="e4d9a-267">**SharePoint 2010**</span><span class="sxs-lookup"><span data-stu-id="e4d9a-267">**SharePoint 2010**</span></span>  
  
 <span data-ttu-id="e4d9a-268">如果您使用的是 SharePoint 2010，则无需在 Windows 防火墙中开放端口。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-268">If you are using SharePoint 2010, you do not need to open ports in Windows Firewall.</span></span> <span data-ttu-id="e4d9a-269">SharePoint 会开放它所需的端口，并且诸如 PowerPivot for SharePoint 的外接程序可以在 SharePoint 环境中运行。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-269">SharePoint opens the ports that it requires, and add-ins such as PowerPivot for SharePoint operate within the SharePoint environment.</span></span> <span data-ttu-id="e4d9a-270">在 PowerPivot for SharePoint 2010 安装中，PowerPivot 系统服务独占使用与其安装在同一台计算机上的本地 SQL Server Analysis Services (PowerPivot) 服务实例。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-270">In a PowerPivot for SharePoint 2010 installation, the PowerPivot System Service has exclusive use of the local SQL Server Analysis Services (PowerPivot) service instance that is installed with it on the same computer.</span></span> <span data-ttu-id="e4d9a-271">它使用本地连接（而非网络连接）来访问加载、查询和处理 SharePoint 服务器上的 PowerPivot 数据的本地 Analysis Services 引擎服务。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-271">It uses local connections, not network connections, to access the local Analysis Services engine service that loads, queries, and processes PowerPivot data on the SharePoint server.</span></span> <span data-ttu-id="e4d9a-272">若要从客户端应用程序请求 PowerPivot 数据，请求将通过 SharePoint 安装程序打开的端口进行路由 (具体而言，入站规则定义为允许对 SharePoint-80、SharePoint Central Administration v4、SharePoint Web Services 和 SPUserCodeV4) 的访问。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-272">To request PowerPivot data from client applications, requests are routed through ports that are opened by SharePoint Setup (specifically, inbound rules are defined to allow access to SharePoint - 80, SharePoint Central Administration v4, SharePoint Web Services, and SPUserCodeV4).</span></span> <span data-ttu-id="e4d9a-273">因为 PowerPivot Web 服务在 SharePoint 场内运行，所以，SharePoint 防火墙规则足以用于远程访问 SharePoint 场中的 PowerPivot 数据了。</span><span class="sxs-lookup"><span data-stu-id="e4d9a-273">Because PowerPivot web services run within a SharePoint farm, the SharePoint firewall rules are sufficient for remote access to PowerPivot data in a SharePoint farm.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e4d9a-274">另请参阅</span><span class="sxs-lookup"><span data-stu-id="e4d9a-274">See Also</span></span>  
 <span data-ttu-id="e4d9a-275">[SQL Server Browser 服务 &#40;数据库引擎和 SSAS&#41;](../../database-engine/configure-windows/sql-server-browser-service-database-engine-and-ssas.md) </span><span class="sxs-lookup"><span data-stu-id="e4d9a-275">[SQL Server Browser Service &#40;Database Engine and SSAS&#41;](../../database-engine/configure-windows/sql-server-browser-service-database-engine-and-ssas.md) </span></span>  
 <span data-ttu-id="e4d9a-276">[启动、停止、暂停、继续、重新启动数据库引擎、SQL Server 代理或 SQL Server Browser 服务](../../database-engine/configure-windows/start-stop-pause-resume-restart-sql-server-services.md) </span><span class="sxs-lookup"><span data-stu-id="e4d9a-276">[Start, Stop, Pause, Resume, Restart the Database Engine, SQL Server Agent, or SQL Server Browser Service](../../database-engine/configure-windows/start-stop-pause-resume-restart-sql-server-services.md) </span></span>  
 [<span data-ttu-id="e4d9a-277">为数据库引擎访问配置 Windows 防火墙</span><span class="sxs-lookup"><span data-stu-id="e4d9a-277">Configure a Windows Firewall for Database Engine Access</span></span>](../../database-engine/configure-windows/configure-a-windows-firewall-for-database-engine-access.md)  
  
  
