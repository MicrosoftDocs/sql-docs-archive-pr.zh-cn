---
title: Analysis Services 实例的 SPN 注册 |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
ms.assetid: 9e78dc37-a3f0-415d-847c-32fec69efa8c
author: minewiskan
ms.author: owend
ms.openlocfilehash: 3146a581e3cc0b434d2e5b153718f1f31cd903d1
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87693577"
---
# <a name="spn-registration-for-an-analysis-services-instance"></a><span data-ttu-id="a766c-102">SPN registration for an Analysis Services instance</span><span class="sxs-lookup"><span data-stu-id="a766c-102">SPN registration for an Analysis Services instance</span></span>
  <span data-ttu-id="a766c-103">在使用 Kerberos 对客户端和服务标识进行相互身份验证时，服务主体名称 (SPN) 唯一标识 Active Directory 域中的某一服务实例。</span><span class="sxs-lookup"><span data-stu-id="a766c-103">A Service Principle Name (SPN) uniquely identifies a service instance in an Active Directory domain when Kerberos is used to mutually authenticate client and service identities.</span></span> <span data-ttu-id="a766c-104">SPN 与服务实例运行所基于的登录帐户相关联。</span><span class="sxs-lookup"><span data-stu-id="a766c-104">An SPN is associated with the logon account under which the service instance runs.</span></span>  
  
 <span data-ttu-id="a766c-105">对于通过 Kerberos 身份验证连接到 Analysis Services 的客户端应用程序，Analysis Services 客户端库使用来自连接字符串的主机名以及在 Analysis Services 的任何给定发行版中固定的其他已知变量（例如服务类）构建一个 SPN。</span><span class="sxs-lookup"><span data-stu-id="a766c-105">For client applications connecting to Analysis Services via Kerberos authentication, the Analysis Services client libraries construct an SPN using the host name from the connection string and other well-known variables, such as the service class, that are fixed in any given release of Analysis Services.</span></span>  
  
 <span data-ttu-id="a766c-106">为进行相互身份验证，客户端所构建的 SPN 必须匹配 Active Directory 域控制器 (DC) 上的相应 SPN 对象。</span><span class="sxs-lookup"><span data-stu-id="a766c-106">For mutual authentication to occur, the SPNs constructed by the client must match a corresponding SPN object on an Active Directory Domain Controller (DC).</span></span> <span data-ttu-id="a766c-107">这意味着，您对于单个 Analysis Services 实例可能需要注册多个 SPN，以便涵盖用户在连接字符串上指定主机名所可能采用的所有方法。</span><span class="sxs-lookup"><span data-stu-id="a766c-107">This means that you might need to register multiple SPNs for a single Analysis Services instance to cover all of the ways in which a user might specify the host name on a connection string.</span></span> <span data-ttu-id="a766c-108">例如，您可能需要两个 SPN 以便处理某个服务器的完全限定域名 (FQDN) 以及短计算机名称。</span><span class="sxs-lookup"><span data-stu-id="a766c-108">For example, you probably need two SPNs to handle both the fully-qualified domain name (FQDN) of a server, as well as the short computer name.</span></span> <span data-ttu-id="a766c-109">正确注册 Analysis Services SPN 是成功连接所必需的。</span><span class="sxs-lookup"><span data-stu-id="a766c-109">Correctly registering the Analysis Services SPN is essential for a successful connection.</span></span> <span data-ttu-id="a766c-110">如果该 SPN 不存在、格式错误或重复，则连接将失败。</span><span class="sxs-lookup"><span data-stu-id="a766c-110">If the SPN is non-existent, malformed, or duplicated, the connection will fail.</span></span>  
  
 <span data-ttu-id="a766c-111">SPN 注册是由 Analysis Services 管理员执行的手动任务。</span><span class="sxs-lookup"><span data-stu-id="a766c-111">SPN registration is a manual task performed by the Analysis Services administrator.</span></span> <span data-ttu-id="a766c-112">与 SQL Server 数据库引擎不同，Analysis Services 永远不会在服务启动时自动注册其 SPN。</span><span class="sxs-lookup"><span data-stu-id="a766c-112">Unlike the SQL Server database engine, Analysis Services never auto-registers its SPN at service startup.</span></span> <span data-ttu-id="a766c-113">当使用默认虚拟帐户、域用户帐户或内置帐户（包括服务 SID）运行 Analysis Services 时，必须进行手动注册。</span><span class="sxs-lookup"><span data-stu-id="a766c-113">Manual registration is required when Analysis Services runs under the default virtual account, a domain user account, or a built-in account, including a per-service SID.</span></span>  
  
 <span data-ttu-id="a766c-114">当使用由域管理员创建的预定义托管服务帐户运行服务时，不需要进行 SPN 注册。</span><span class="sxs-lookup"><span data-stu-id="a766c-114">SPN registration is not required if the service runs under a predefined managed service account created by a domain administrator.</span></span> <span data-ttu-id="a766c-115">请注意，根据您的域的功能级别，注册 SPN 可能要求域管理员权限。</span><span class="sxs-lookup"><span data-stu-id="a766c-115">Note that depending on the functional level of your domain, registering an SPN can require domain administrator permissions.</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="a766c-116">**[!INCLUDE[msCoName](../../includes/msconame-md.md)] Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]** 是一款诊断工具，可帮助解决与 Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]相关的连接问题。</span><span class="sxs-lookup"><span data-stu-id="a766c-116">**[!INCLUDE[msCoName](../../includes/msconame-md.md)] Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]** is a diagnostic tool that helps troubleshoot Kerberos related connectivity issues with [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="a766c-117">有关详细信息，请参阅 [Microsoft Kerberos Configuration Manager for SQL Server](https://www.microsoft.com/download/details.aspx?id=39046)。</span><span class="sxs-lookup"><span data-stu-id="a766c-117">For more information, see [Microsoft Kerberos Configuration Manager for SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="a766c-118">**[!INCLUDE[msCoName](../../includes/msconame-md.md)] Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]** 是一款诊断工具，可帮助解决与 Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]相关的连接问题。</span><span class="sxs-lookup"><span data-stu-id="a766c-118">**[!INCLUDE[msCoName](../../includes/msconame-md.md)] Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]** is a diagnostic tool that helps troubleshoot Kerberos related connectivity issues with [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="a766c-119">有关详细信息，请参阅 [Microsoft Kerberos Configuration Manager for SQL Server](https://www.microsoft.com/download/details.aspx?id=39046)。</span><span class="sxs-lookup"><span data-stu-id="a766c-119">For more information, see [Microsoft Kerberos Configuration Manager for SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span></span>  
  
 <span data-ttu-id="a766c-120">本主题包含以下各节：</span><span class="sxs-lookup"><span data-stu-id="a766c-120">This topic contains the following sections:</span></span>  
  
 [<span data-ttu-id="a766c-121">需要 SPN 注册时</span><span class="sxs-lookup"><span data-stu-id="a766c-121">When SPN registration is required</span></span>](#bkmk_scnearios)  
  
 [<span data-ttu-id="a766c-122">针对 Analysis Services 的 SPN 格式</span><span class="sxs-lookup"><span data-stu-id="a766c-122">SPN format for Analysis Services</span></span>](#bkmk_SPNSyntax)  
  
 [<span data-ttu-id="a766c-123">虚拟帐户的 SPN 注册</span><span class="sxs-lookup"><span data-stu-id="a766c-123">SPN registration for a virtual account</span></span>](#bkmk_virtual)  
  
 [<span data-ttu-id="a766c-124">域帐户的 SPN 注册</span><span class="sxs-lookup"><span data-stu-id="a766c-124">SPN registration for a domain account</span></span>](#bkmk_domain)  
  
 [<span data-ttu-id="a766c-125">内置帐户的 SPN 注册</span><span class="sxs-lookup"><span data-stu-id="a766c-125">SPN registration for a built-in account</span></span>](#bkmk_builtin)  
  
 [<span data-ttu-id="a766c-126">针对命名实例的 SPN 注册</span><span class="sxs-lookup"><span data-stu-id="a766c-126">SPN registration for a named instance</span></span>](#bkmk_spnNamed)  
  
 [<span data-ttu-id="a766c-127">针对 SSAS 群集的 SPN 注册</span><span class="sxs-lookup"><span data-stu-id="a766c-127">SPN registration for an SSAS cluster</span></span>](#bkmk_spnCluster)  
  
 [<span data-ttu-id="a766c-128">为 HTTP 访问配置的 SSAS 实例的 SPN 注册</span><span class="sxs-lookup"><span data-stu-id="a766c-128">SPN registration for SSAS instances configured for HTTP access</span></span>](#bkmk_spnHTTP)  
  
 [<span data-ttu-id="a766c-129">针对在固定端口上侦听的 SSAS 实例的 SPN 注册</span><span class="sxs-lookup"><span data-stu-id="a766c-129">SPN registration for SSAS instances listening on fixed ports</span></span>](#bkmk_spnFixedPorts)  
  
##  <a name="when-spn-registration-is-required"></a><a name="bkmk_scnearios"></a> <span data-ttu-id="a766c-130">在需要 SPN 注册时</span><span class="sxs-lookup"><span data-stu-id="a766c-130">When SPN registration is required</span></span>  
 <span data-ttu-id="a766c-131">在连接字符串上指定 "SSPI = Kerberos" 的任何客户端连接都将引入 Analysis Services 实例的 SPN 注册要求。</span><span class="sxs-lookup"><span data-stu-id="a766c-131">Any client connection that specifies "SSPI=Kerberos" on the connection string will introduce SPN registration requirements for an Analysis Services instance.</span></span>  
  
 <span data-ttu-id="a766c-132">在下列情况下需要 SPN 注册。</span><span class="sxs-lookup"><span data-stu-id="a766c-132">SPN registration is required under the following circumstances.</span></span> <span data-ttu-id="a766c-133">有关详细信息，请参阅 [Configure Analysis Services for Kerberos constrained delegation](configure-analysis-services-for-kerberos-constrained-delegation.md)。</span><span class="sxs-lookup"><span data-stu-id="a766c-133">For more detailed information, see [Configure Analysis Services for Kerberos constrained delegation](configure-analysis-services-for-kerberos-constrained-delegation.md).</span></span>  
  
-   <span data-ttu-id="a766c-134">将用户标识从客户端应用程序或中间层服务流到 Analysis Services 需要标识委托。</span><span class="sxs-lookup"><span data-stu-id="a766c-134">Identity delegation is necessary to flow the user identity from the client application or middle-tier service to Analysis Services.</span></span> <span data-ttu-id="a766c-135">在特定对象上定义每个用户的权限或筛选时，通常会使用标识委托。</span><span class="sxs-lookup"><span data-stu-id="a766c-135">Identity delegation is typically used when per-user permissions or filters are defined on specific objects.</span></span>  
  
     <span data-ttu-id="a766c-136">涉及标识委托的常见情形如下：在 Analysis Services 中检索数据时，配置中间层服务（例如 Excel Services 或 Reporting Services）进行约束委托，以模拟用户标识。</span><span class="sxs-lookup"><span data-stu-id="a766c-136">A common scenario involving identity delegation is configuring middle-tier services, such as Excel Services or Reporting Services, for constrained delegation for the purpose of impersonating a user identity when retrieving data in Analysis Services.</span></span> <span data-ttu-id="a766c-137">为支持此行为，在配置 Excel Services 或 Reporting Services 进行约束委托时，您必须提供 Analysis Services SPN 作为目标服务。</span><span class="sxs-lookup"><span data-stu-id="a766c-137">To support this behavior, you must provide an Analysis Services SPN as the destination service when configuring Excel Services or Reporting Services for constrained delegation.</span></span>  
  
-   <span data-ttu-id="a766c-138">Analysis Services 在使用 DirectQuery 模式从 SQL Server 关系数据库为表格数据库检索数据时委托用户标识。</span><span class="sxs-lookup"><span data-stu-id="a766c-138">Analysis Services delegates a user identity when retrieving data from a SQL Server relational database for tabular databases using DirectQuery mode.</span></span> <span data-ttu-id="a766c-139">这是 Analysis Services 会将用户标识委托给其他服务的唯一情形。</span><span class="sxs-lookup"><span data-stu-id="a766c-139">This is the only scenario in which Analysis Services will delegate the user identity to another service.</span></span>  
  
##  <a name="spn-format-for-analysis-services"></a><a name="bkmk_SPNSyntax"></a><span data-ttu-id="a766c-140">Analysis Services 的 SPN 格式</span><span class="sxs-lookup"><span data-stu-id="a766c-140">SPN format for Analysis Services</span></span>  
 <span data-ttu-id="a766c-141">使用 **“setspn”** 注册 SPN。</span><span class="sxs-lookup"><span data-stu-id="a766c-141">Use **setspn** to register an SPN.</span></span> <span data-ttu-id="a766c-142">在较新的操作系统上， **“setspn”** 作为系统实用工具安装。</span><span class="sxs-lookup"><span data-stu-id="a766c-142">On newer operating systems, **setspn** is installed as a system utility.</span></span> <span data-ttu-id="a766c-143">有关详细信息，请参阅 [SetSPN](https://technet.microsoft.com/library/cc731241\(WS.10\).aspx)。</span><span class="sxs-lookup"><span data-stu-id="a766c-143">For more information, see [SetSPN](https://technet.microsoft.com/library/cc731241\(WS.10\).aspx).</span></span>  
  
 <span data-ttu-id="a766c-144">下表介绍 Analysis Services SPN 的每个部分。</span><span class="sxs-lookup"><span data-stu-id="a766c-144">The following table describes each part of an Analysis Services SPN.</span></span>  
  
|<span data-ttu-id="a766c-145">元素</span><span class="sxs-lookup"><span data-stu-id="a766c-145">Element</span></span>|<span data-ttu-id="a766c-146">说明</span><span class="sxs-lookup"><span data-stu-id="a766c-146">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="a766c-147">服务类</span><span class="sxs-lookup"><span data-stu-id="a766c-147">Service class</span></span>|<span data-ttu-id="a766c-148">MSOLAPSvc.3 将服务标识为 Analysis Services 实例。</span><span class="sxs-lookup"><span data-stu-id="a766c-148">MSOLAPSvc.3 identifies the service as an Analysis Services instance.</span></span> <span data-ttu-id="a766c-149">.3 表示在 Analysis Services 传输中使用的 XMLA-over-TCP/IP 协议的版本。</span><span class="sxs-lookup"><span data-stu-id="a766c-149">The .3 is a reference to the version of the XMLA-over-TCP/IP protocol used in Analysis Services transmissions.</span></span> <span data-ttu-id="a766c-150">它与产品发行版无关。</span><span class="sxs-lookup"><span data-stu-id="a766c-150">It is unrelated to product release.</span></span> <span data-ttu-id="a766c-151">因此，在修订协议本身之前，MSOLAPSvc.3 是针对 SQL Server 2005、2008、2008 R2、2012 和 Analysis Services 的任何将来发行版的正确的服务类。</span><span class="sxs-lookup"><span data-stu-id="a766c-151">As such, MSOLAPSvc.3 is the correct service class for SQL Server 2005, 2008, 2008 R2, 2012 and any future release of Analysis Services until the protocol itself is revised.</span></span>|  
|<span data-ttu-id="a766c-152">主机名称</span><span class="sxs-lookup"><span data-stu-id="a766c-152">Host-name</span></span>|<span data-ttu-id="a766c-153">标识正在运行服务的计算机。</span><span class="sxs-lookup"><span data-stu-id="a766c-153">Identifies the computer on which the service is running.</span></span> <span data-ttu-id="a766c-154">该名称可以是完全限定域名称或 NetBIOS 名称。</span><span class="sxs-lookup"><span data-stu-id="a766c-154">This can be a fully-qualified domain name or a NetBIOS name.</span></span> <span data-ttu-id="a766c-155">应当为二者都注册 SPN。</span><span class="sxs-lookup"><span data-stu-id="a766c-155">You should register an SPN for both.</span></span><br /><br /> <span data-ttu-id="a766c-156">为服务器 NetBIOS 名称注册 SPN 时，务必使用 `SetupSPN -S` 检查是否存在重复的注册。</span><span class="sxs-lookup"><span data-stu-id="a766c-156">When registering an SPN for the NetBIOS name of a server, be sure to use `SetupSPN -S` to check for duplicate registration.</span></span> <span data-ttu-id="a766c-157">我们不保证 NetBIOS 名称在林中是唯一的，而拥有重复 SPN 注册可能会导致连接失败。</span><span class="sxs-lookup"><span data-stu-id="a766c-157">NetBIOS names are not guaranteed to be unique in a forest, and having a duplicate SPN registration will cause the connection to fail.</span></span><br /><br /> <span data-ttu-id="a766c-158">对于 Analysis Services 负载平衡群集，主机名应该是分配给群集的虚拟名称。</span><span class="sxs-lookup"><span data-stu-id="a766c-158">For Analysis Services load balanced clusters, the host name should be the virtual name assigned to the cluster.</span></span><br /><br /> <span data-ttu-id="a766c-159">切勿使用 IP 地址创建 SPN。</span><span class="sxs-lookup"><span data-stu-id="a766c-159">Never create an SPN using the IP address.</span></span> <span data-ttu-id="a766c-160">Kerberos 使用域的 DNS 解析功能。</span><span class="sxs-lookup"><span data-stu-id="a766c-160">Kerberos uses the DNS resolution capabilities of the domain.</span></span> <span data-ttu-id="a766c-161">指定 IP 地址会绕过该功能。</span><span class="sxs-lookup"><span data-stu-id="a766c-161">Specifying an IP address bypasses that capability.</span></span>|  
|<span data-ttu-id="a766c-162">端口号</span><span class="sxs-lookup"><span data-stu-id="a766c-162">Port-number</span></span>|<span data-ttu-id="a766c-163">尽管端口号是 SPN 语法的一部分，但在注册 Analysis Services SPN 时切勿指定端口号。</span><span class="sxs-lookup"><span data-stu-id="a766c-163">Although the port number is part of SPN syntax, you never specify a port number when registering an Analysis Services SPN.</span></span> <span data-ttu-id="a766c-164">冒号 ( : ) 字符通常用于在标准 SPN 语法中提供端口号，由 Analysis Services 用来指定实例名称。</span><span class="sxs-lookup"><span data-stu-id="a766c-164">The colon ( : ) character, typically used to provide a port number in standard SPN syntax, is used by Analysis Services to specify the instance name.</span></span> <span data-ttu-id="a766c-165">对于 Analysis Services 实例，假定端口是默认端口 (TCP 2383) 或者 SQL Server Browser 服务分配的端口 (TCP 2382)。</span><span class="sxs-lookup"><span data-stu-id="a766c-165">For an Analysis Services instance, the port is assumed to be the default port (TCP 2383) or a port assigned by the SQL Server Browser service (TCP 2382).</span></span>|  
|<span data-ttu-id="a766c-166">实例名称</span><span class="sxs-lookup"><span data-stu-id="a766c-166">Instance-name</span></span>|<span data-ttu-id="a766c-167">Analysis Services 是可以在同一台计算机上多次安装的可复制的服务。</span><span class="sxs-lookup"><span data-stu-id="a766c-167">Analysis Services is a replicable service that can be installed multiple times on the same computer.</span></span> <span data-ttu-id="a766c-168">通过其实例名称标识每个实例。</span><span class="sxs-lookup"><span data-stu-id="a766c-168">Each instance is identified through its instance name.</span></span><br /><br /> <span data-ttu-id="a766c-169">该实例名称以冒号 ( : ) 字符作为前缀。</span><span class="sxs-lookup"><span data-stu-id="a766c-169">The instance name is prefixed with a colon ( : ) character.</span></span> <span data-ttu-id="a766c-170">例如，假定一个名为 SRV01 的主机以及一个 SSAS-Tabular 命名实例，则 SPN 应该是 SRV01:SSAS-Tabular。</span><span class="sxs-lookup"><span data-stu-id="a766c-170">For example, given a host computer named SRV01 and a named instance of SSAS-Tabular, the SPN should be SRV01:SSAS-Tabular.</span></span><br /><br /> <span data-ttu-id="a766c-171">请注意，用于指定命名 Analysis Services 实例的语法不同于其他 SQL Server 实例使用的语法。</span><span class="sxs-lookup"><span data-stu-id="a766c-171">Note that the syntax for specifying a named Analysis Services instance differs from that used by other SQL Server instances.</span></span> <span data-ttu-id="a766c-172">其他服务使用反斜杠 ( \ ) 在 SPN 中追加实例名称。</span><span class="sxs-lookup"><span data-stu-id="a766c-172">Other services uses a backslash ( \ ) to append the instance name in an SPN.</span></span>|  
|<span data-ttu-id="a766c-173">服务帐户</span><span class="sxs-lookup"><span data-stu-id="a766c-173">Service-account</span></span>|<span data-ttu-id="a766c-174">这是 **“MSSQLServerOLAPService”** Windows 服务的启动帐户。</span><span class="sxs-lookup"><span data-stu-id="a766c-174">This is the startup account of the **MSSQLServerOLAPService** Windows service.</span></span> <span data-ttu-id="a766c-175">它可以是 Windows 域用户帐户、虚拟帐户、托管服务帐户 (MSA) 或内置帐户，例如服务 SID、NetworkService 或 LocalSystem。</span><span class="sxs-lookup"><span data-stu-id="a766c-175">It can be a Windows domain user account, virtual account, managed service account (MSA) or a built-in account such as a per-service SID, NetworkService, or LocalSystem.</span></span> <span data-ttu-id="a766c-176">Windows 域用户帐户可以设置为 domain\user 或格式 user@domain 。</span><span class="sxs-lookup"><span data-stu-id="a766c-176">A Windows domain user account can be formatted as domain\user or user@domain.</span></span>|  
  
##  <a name="spn-registration-for-a-virtual-account"></a><a name="bkmk_virtual"></a> <span data-ttu-id="a766c-177">虚拟帐户的 SPN 注册</span><span class="sxs-lookup"><span data-stu-id="a766c-177">SPN registration for a virtual account</span></span>  
 <span data-ttu-id="a766c-178">对于 SQL Server 服务，虚拟帐户是默认的帐户类型。</span><span class="sxs-lookup"><span data-stu-id="a766c-178">Virtual accounts are the default account type for SQL Server services.</span></span> <span data-ttu-id="a766c-179">对于默认实例，虚拟帐户为**nt Service\MSOLAPService** ，对于命名实例，则为**nt Service\MSOLAP $** \<instance-name> 。</span><span class="sxs-lookup"><span data-stu-id="a766c-179">The virtual account is **NT Service\MSOLAPService** for a default instance and **NT Service\MSOLAP$**\<instance-name> for a named instance.</span></span>  
  
 <span data-ttu-id="a766c-180">如名称所示，这些帐户不存在于 Active Directory 中。</span><span class="sxs-lookup"><span data-stu-id="a766c-180">As the name implies, these accounts do not exist in Active Directory.</span></span> <span data-ttu-id="a766c-181">虚拟帐户只存在于本地计算机上。</span><span class="sxs-lookup"><span data-stu-id="a766c-181">A virtual account exists only on the local computer.</span></span> <span data-ttu-id="a766c-182">连接外部服务、应用程序或设备时，使用本地计算机帐户进行连接。</span><span class="sxs-lookup"><span data-stu-id="a766c-182">When connecting to external services, applications, or devices, the connection is made using the local machine account.</span></span> <span data-ttu-id="a766c-183">因此，在虚拟帐户上运行 Analysis Services 的 SPN 注册实际上是计算机帐户的 SPN 注册。</span><span class="sxs-lookup"><span data-stu-id="a766c-183">For this reason, an SPN registration for Analysis Services running under a virtual account is actually an SPN registration for the machine account.</span></span>  
  
 <span data-ttu-id="a766c-184">**以 NT Service\MSOLAPService 身份运行的默认实例的示例语法**</span><span class="sxs-lookup"><span data-stu-id="a766c-184">**Example syntax for a default instance running as NT Service\MSOLAPService**</span></span>  
  
 <span data-ttu-id="a766c-185">此示例为在默认虚拟帐户下运行的 Analysis Services 默认实例显示 **“setspn”** 语法。</span><span class="sxs-lookup"><span data-stu-id="a766c-185">This example shows **setspn** syntax for Analysis Services default instance running under the default virtual account.</span></span> <span data-ttu-id="a766c-186">在此示例中，计算机主机名为 **AW-SRV01**。</span><span class="sxs-lookup"><span data-stu-id="a766c-186">In this example, the computer host name is **AW-SRV01**.</span></span> <span data-ttu-id="a766c-187">如前所述，SPN 注册必须指定“计算机帐户” \*\* 而不是虚拟帐户 **“NT Service\MSOLAPService”**。</span><span class="sxs-lookup"><span data-stu-id="a766c-187">As noted, SPN registration must specify the *machine account* instead of the virtual account, **NT Service\MSOLAPService**.</span></span>  
  
```  
Setspn -s MSOLAPSvc.3/AW-SRV01.AdventureWorks.com AW-SRV01  
```  
  
> [!NOTE]  
>  <span data-ttu-id="a766c-188">请记得创建两个 SPN 注册，一个用于 NetBIOS 主机名，另一个用于完全限定的主机域名。</span><span class="sxs-lookup"><span data-stu-id="a766c-188">Remember to create two SPN registrations, one for the NetBIOS host name and a second for a fully-qualified domain name of the host.</span></span> <span data-ttu-id="a766c-189">在连接 Analysis Services 时，不同的客户端应用程序使用不同的主机名约定。</span><span class="sxs-lookup"><span data-stu-id="a766c-189">Different client applications use different host name conventions when connecting to Analysis Services.</span></span> <span data-ttu-id="a766c-190">有两个 SPN 注册可确保这两个版本的主机名都考虑在内。</span><span class="sxs-lookup"><span data-stu-id="a766c-190">Having two SPN registrations ensures that both versions of the host name are accounted for.</span></span>  
  
 <span data-ttu-id="a766c-191">**以 NT Service\MSOLAP $ 身份运行的命名实例的示例语法\<instance-name>**</span><span class="sxs-lookup"><span data-stu-id="a766c-191">**Example syntax for a named instance running as NT Service\MSOLAP$\<instance-name>**</span></span>  
  
 <span data-ttu-id="a766c-192">此示例为在默认虚拟帐户下运行的 Analysis Services 命名实例显示 **“setspn”** 语法。</span><span class="sxs-lookup"><span data-stu-id="a766c-192">This example shows **setspn** syntax for a named instance running under the default virtual account.</span></span> <span data-ttu-id="a766c-193">在此示例中，计算机主机名为 **AW-SRV02**，实例名为 **AW-FINANCE**。</span><span class="sxs-lookup"><span data-stu-id="a766c-193">In this example, the computer host name is **AW-SRV02**, and the instance name is **AW-FINANCE**.</span></span> <span data-ttu-id="a766c-194">同样，它是为 SPN 指定的计算机帐户，而不是虚拟帐户**NT Service\MSOLAP $** \<instance-name> 。</span><span class="sxs-lookup"><span data-stu-id="a766c-194">Again, it is the machine account that is specified for the SPN, rather than the virtual account **NT Service\MSOLAP$**\<instance-name>.</span></span>  
  
```  
Setspn -s MSOLAPSvc.3/AW-SRV02.AdventureWorks.com:AW-FINANCE AW-SRV02  
```  
  
##  <a name="spn-registration-for-a-domain-account"></a><a name="bkmk_domain"></a><span data-ttu-id="a766c-195">域帐户的 SPN 注册</span><span class="sxs-lookup"><span data-stu-id="a766c-195">SPN registration for a domain account</span></span>  
 <span data-ttu-id="a766c-196">使用域帐户运行 Analysis Services 实例是一种常见做法。</span><span class="sxs-lookup"><span data-stu-id="a766c-196">Using a domain account to run an Analysis Services instance is a common practice.</span></span>  
  
 <span data-ttu-id="a766c-197">对于在网络或硬件负载平衡的群集中运行的 Analysis Services 实例而言，需要使用域帐户，且群集中每个实例都在相同的域帐户下运行。</span><span class="sxs-lookup"><span data-stu-id="a766c-197">For Analysis Services instances that run in a network or hardware load balanced cluster, a domain account is required, with each instance in the cluster running under the same domain account.</span></span>  
  
 <span data-ttu-id="a766c-198">**以域用户身份运行的默认实例的示例语法**</span><span class="sxs-lookup"><span data-stu-id="a766c-198">**Example syntax for a default instance running as a domain user**</span></span>  
  
 <span data-ttu-id="a766c-199">此示例为在 AdventureWorks 域的域用户帐户 **SSAS-Service** 之下运行的 Analysis Services 默认实例显示 **setspn**语法。</span><span class="sxs-lookup"><span data-stu-id="a766c-199">This example shows **setspn** syntax for Analysis Services default instance running under a domain user account, **SSAS-Service**, in the AdventureWorks domain.</span></span>  
  
```  
Setspn -s msolapsvc.3\AW-SRV01.Adventureworks.com AdventureWorks\SSAS-Service  
```  
  
> [!TIP]  
>  <span data-ttu-id="a766c-200">通过运行 `Setspn -L <domain account>` 或 `Setspn -L <machinename>`（取决于注册 SPN 的方式），验证是否已为 Analysis Services 服务器创建了 SPN。</span><span class="sxs-lookup"><span data-stu-id="a766c-200">Verify whether the SPN was created for the Analysis Services server by running `Setspn -L <domain account>` or `Setspn -L <machinename>`, depending on how the SPN was registered.</span></span> <span data-ttu-id="a766c-201">你应 \<hostname> 在列表中看到 msolapsvc.3。</span><span class="sxs-lookup"><span data-stu-id="a766c-201">You should see MSOLAPSVC.3/\<hostname> in the list.</span></span>  
  
##  <a name="spn-registration-for-a-built-in-account"></a><a name="bkmk_builtin"></a> <span data-ttu-id="a766c-202">内置帐户的 SPN 注册</span><span class="sxs-lookup"><span data-stu-id="a766c-202">SPN registration for a built-in account</span></span>  
 <span data-ttu-id="a766c-203">尽管不建议采用这种做法，但是旧版的 Analysis Services 安装有时会配置为在内置帐户（如 Network Service、Local Service 或 Local System）下运行。</span><span class="sxs-lookup"><span data-stu-id="a766c-203">Although this practice is not recommended, older Analysis Services installations are sometimes configured to run under built-in accounts like Network Service, Local Service, or Local System.</span></span>  
  
 <span data-ttu-id="a766c-204">**以内置帐户身份运行的默认实例的示例语法**</span><span class="sxs-lookup"><span data-stu-id="a766c-204">**Example syntax for a default instance running under a built-in account**</span></span>  
  
 <span data-ttu-id="a766c-205">在内置帐户或各服务的SID 下运行的服务的 SPN 注册相当于虚拟帐户使用的 SPN 语法。</span><span class="sxs-lookup"><span data-stu-id="a766c-205">SPN registration for a service running under a built-in account or per-service SID is equivalent to the SPN syntax used for the virtual account.</span></span> <span data-ttu-id="a766c-206">不使用帐户名，而是使用机器帐户：</span><span class="sxs-lookup"><span data-stu-id="a766c-206">Instead of the account name, use the machine account:</span></span>  
  
```  
Setspn -s MSOLAPSvc.3/AW-SRV01.AdventureWorks.com AW-SRV01  
```  
  
##  <a name="spn-registration-for-a-named-instance"></a><a name="bkmk_spnNamed"></a><span data-ttu-id="a766c-207">命名实例的 SPN 注册</span><span class="sxs-lookup"><span data-stu-id="a766c-207">SPN registration for a named instance</span></span>  
 <span data-ttu-id="a766c-208">Analysis Services 的命名实例会使用 SQL Server Browser 服务检测到的动态端口分配。</span><span class="sxs-lookup"><span data-stu-id="a766c-208">Named instances of Analysis Services use dynamic port assignments that are detected by the SQL Server Browser service.</span></span> <span data-ttu-id="a766c-209">使用命名实例时，为 SQL Server Browser Service 和 Analysis Services 命名实例注册 SPN。</span><span class="sxs-lookup"><span data-stu-id="a766c-209">When using a named instance, register an SPN for both the SQL Server Browser Service and the Analysis Services named instance.</span></span> <span data-ttu-id="a766c-210">有关详细信息，请参阅 [与 SQL Server Analysis Services 或 SQL Server 的命名实例建立连接时，需要提供 SQL Server Browser 服务的 SPN](https://support.microsoft.com/kb/950599)。</span><span class="sxs-lookup"><span data-stu-id="a766c-210">For more information, see [An SPN for the SQL Server Browser service is required when you establish a connection to a named instance of SQL Server Analysis Services or of SQL Server](https://support.microsoft.com/kb/950599).</span></span>  
  
 <span data-ttu-id="a766c-211">**以 LocalService 身份运行的 SQL Browser Service 的 SPN 示例语法**</span><span class="sxs-lookup"><span data-stu-id="a766c-211">**Example of SPN syntax for the SQL Browser Service running as LocalService**</span></span>  
  
 <span data-ttu-id="a766c-212">服务类为 **“MSOLAPDisco.3”**。</span><span class="sxs-lookup"><span data-stu-id="a766c-212">The service class is **MSOLAPDisco.3**.</span></span> <span data-ttu-id="a766c-213">默认情况下，此服务会以 NT AUTHORITY\LocalService 身份运行，这意味着已为计算机帐户设置了 SPN 注册。</span><span class="sxs-lookup"><span data-stu-id="a766c-213">By default, this service runs as NT AUTHORITY\LocalService, which means SPN registration is set for the machine account.</span></span> <span data-ttu-id="a766c-214">在此示例中，计算机帐户为 **AW-SRV01**，与计算机名相对应。</span><span class="sxs-lookup"><span data-stu-id="a766c-214">In this example, the machine account is **AW-SRV01**, corresponding to the computer name.</span></span>  
  
```  
Setspn -S MSOLAPDisco.3/AW-SRV01.AdventureWorks.com AW-SRV01  
```  
  
##  <a name="spn-registration-for-an-ssas-cluster"></a><a name="bkmk_spnCluster"></a><span data-ttu-id="a766c-215">SSAS 群集的 SPN 注册</span><span class="sxs-lookup"><span data-stu-id="a766c-215">SPN registration for an SSAS cluster</span></span>  
 <span data-ttu-id="a766c-216">对于 Analysis Services 故障转移群集，主机名应该是分配给群集的虚拟名称。</span><span class="sxs-lookup"><span data-stu-id="a766c-216">For Analysis Services failover clusters, the host name should be the virtual name assigned to the cluster.</span></span> <span data-ttu-id="a766c-217">此为 SQL Server 网络名，是当你在现有 WSFC 基础上安装 Analysis Services 后，SQL Server 安装期间指定的。</span><span class="sxs-lookup"><span data-stu-id="a766c-217">This is the SQL Server network name, specified during SQL Server Setup when you installed Analysis Services on top of an existing WSFC.</span></span> <span data-ttu-id="a766c-218">可在 Active Directory 中找到此名称。</span><span class="sxs-lookup"><span data-stu-id="a766c-218">You can find this name in Active Directory.</span></span> <span data-ttu-id="a766c-219">你还可以在**故障转移群集管理器**  |  **角色**  |  **资源**"选项卡中找到它。"资源" 选项卡上的 "服务器名称" 应在 SPN 命令中用作 "虚拟名称"。</span><span class="sxs-lookup"><span data-stu-id="a766c-219">You can also find it in **Failover Cluster Manager** | **Role** | **Resources** tab. The server name on the Resources tab is what should be used as the 'virtual name' in the SPN command.</span></span>  
  
 <span data-ttu-id="a766c-220">**Analysis Services 群集的 SPN 语法**</span><span class="sxs-lookup"><span data-stu-id="a766c-220">**SPN syntax for an Analysis Services cluster**</span></span>  
  
```  
Setspn -s msolapsvc.3/<virtualname.FQDN > <domain user account>  
```  
  
 <span data-ttu-id="a766c-221">请记住，Analysis Services 群集中的节点需要使用默认端口 (TCP 2383) 并且在相同的域用户帐户下运行，以便每个节点都具有相同的 SID。</span><span class="sxs-lookup"><span data-stu-id="a766c-221">Recall that nodes in an Analysis Services cluster are required to use the default port (TCP 2383) and run under the same domain user account so that each node has the same SID.</span></span> <span data-ttu-id="a766c-222">有关详细信息，请参阅 [如何安装群集 SQL Server Analysis Services](https://msdn.microsoft.com/library/dn736073.aspx) 。</span><span class="sxs-lookup"><span data-stu-id="a766c-222">See [How to Cluster SQL Server Analysis Services](https://msdn.microsoft.com/library/dn736073.aspx) for more information.</span></span>  
  
##  <a name="spn-registration-for-ssas-instances-configured-for-http-access"></a><a name="bkmk_spnHTTP"></a> <span data-ttu-id="a766c-223">针对为 HTTP 访问配置的 SSAS 实例的 SPN 注册</span><span class="sxs-lookup"><span data-stu-id="a766c-223">SPN registration for SSAS instances configured for HTTP access</span></span>  
 <span data-ttu-id="a766c-224">根据解决方案要求，您可能已经针对 HTTP 访问配置了 Analysis Services。</span><span class="sxs-lookup"><span data-stu-id="a766c-224">Depending on solution requirements, you might have configured Analysis Services for HTTP access.</span></span> <span data-ttu-id="a766c-225">如果您的解决方案将 IIS 作为一个中间层组件包括，并且 Kerberos 身份验证是解决方案要求，则您可能需要手动为 IIS 注册 SPN。</span><span class="sxs-lookup"><span data-stu-id="a766c-225">If your solution includes IIS as a middle tier component, and Kerberos authentication is a solution requirement, you might need to manually register an SPN for IIS.</span></span> <span data-ttu-id="a766c-226">有关详细信息，请参阅[如何配置 SQL Server 2008 Analysis Services 和 SQL Server 2005 Analysis Services](https://support.microsoft.com/kb/917409)中的 "在运行 IIS 的计算机上配置设置"，以使用 Kerberos 身份验证。</span><span class="sxs-lookup"><span data-stu-id="a766c-226">For more information, see "Configure the settings on the computer running IIS" in [How to configure SQL Server 2008 Analysis Services and SQL Server 2005 Analysis Services to use Kerberos authentication](https://support.microsoft.com/kb/917409).</span></span>  
  
 <span data-ttu-id="a766c-227">就针对 Analysis Services 实例的 SPN 注册而言，在为 TCP 或 HTTP 配置的实例之间没有差别。</span><span class="sxs-lookup"><span data-stu-id="a766c-227">In terms of SPN registration for the Analysis Services instance, there is no difference between an instance configured for TCP or HTTP.</span></span> <span data-ttu-id="a766c-228">使用 MSMDPUMP ISAPI 扩展插件从 IIS 到 Analysis Services 的连接始终是 TCP。</span><span class="sxs-lookup"><span data-stu-id="a766c-228">The connection to Analysis Services from IIS, using the MSMDPUMP ISAPI extension, is always TCP.</span></span>  
  
 <span data-ttu-id="a766c-229">这意味着，您可以使用前面几节中针对默认实例或命名实例的说明来注册 SPN。</span><span class="sxs-lookup"><span data-stu-id="a766c-229">This means that you can use the instructions from previous sections for default or named instance to register the SPN.</span></span> <span data-ttu-id="a766c-230">在指定主机名时，请确保使用您在为 HTTP 访问配置服务时在 msmdpump.ini 文件中指定的主机名。</span><span class="sxs-lookup"><span data-stu-id="a766c-230">When specifying the host name, be sure to use the host name you specified in the msmdpump.ini file when you configured the service for HTTP access.</span></span>  
  
 <span data-ttu-id="a766c-231">有关 HTTP 访问的详细信息，请参阅[在 Internet Information Services (IIS) 8.0 上配置对 Analysis Services 的 HTTP 访问](configure-http-access-to-analysis-services-on-iis-8-0.md)。</span><span class="sxs-lookup"><span data-stu-id="a766c-231">For more information about HTTP access, see [Configure HTTP Access to Analysis Services on Internet Information Services &#40;IIS&#41; 8.0](configure-http-access-to-analysis-services-on-iis-8-0.md).</span></span>  
  
##  <a name="spn-registration-for-ssas-instances-listening-on-fixed-ports"></a><a name="bkmk_spnFixedPorts"></a><span data-ttu-id="a766c-232">针对在固定端口上侦听的 SSAS 实例的 SPN 注册</span><span class="sxs-lookup"><span data-stu-id="a766c-232">SPN registration for SSAS instances listening on fixed ports</span></span>  
 <span data-ttu-id="a766c-233">您不能在 Analysis Services SPN 注册上指定端口号。</span><span class="sxs-lookup"><span data-stu-id="a766c-233">You cannot specify a port number on an Analysis Services SPN registration.</span></span> <span data-ttu-id="a766c-234">如果您将 Analysis Services 作为默认实例安装并且将其配置为侦听某一固定端口，则现在必须将其配置为侦听默认端口 (TCP 2383)。</span><span class="sxs-lookup"><span data-stu-id="a766c-234">If you installed Analysis Services as the default instance and configured it to listen on a fixed port, you must now configure it to listen on the default port (TCP 2383).</span></span> <span data-ttu-id="a766c-235">对于命名实例，您需要使用 SQL Server Browser 服务和动态端口分配。</span><span class="sxs-lookup"><span data-stu-id="a766c-235">For named instances, you need to use SQL Server Browser service and dynamic port assignments.</span></span>  
  
 <span data-ttu-id="a766c-236">一个 Analysis Services 实例只能侦听单个端口。</span><span class="sxs-lookup"><span data-stu-id="a766c-236">An Analysis Services instance can only listen on a single port.</span></span> <span data-ttu-id="a766c-237">不支持使用多个端口。</span><span class="sxs-lookup"><span data-stu-id="a766c-237">Using multiple ports is not supported.</span></span> <span data-ttu-id="a766c-238">有关端口配置的详细信息，请参阅 [Configure the Windows Firewall to Allow Analysis Services Access](configure-the-windows-firewall-to-allow-analysis-services-access.md)。</span><span class="sxs-lookup"><span data-stu-id="a766c-238">For more information about port configuration, see [Configure the Windows Firewall to Allow Analysis Services Access](configure-the-windows-firewall-to-allow-analysis-services-access.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a766c-239">另请参阅</span><span class="sxs-lookup"><span data-stu-id="a766c-239">See Also</span></span>  
 <span data-ttu-id="a766c-240">[Microsoft BI 身份验证和身份委托](https://go.microsoft.com/fwlink/?LinkID=286576) </span><span class="sxs-lookup"><span data-stu-id="a766c-240">[Microsoft BI Authentication and Identity Delegation](https://go.microsoft.com/fwlink/?LinkID=286576) </span></span>  
 <span data-ttu-id="a766c-241">[使用 Kerberos 的相互身份验证](https://go.microsoft.com/fwlink/?LinkId=299283) </span><span class="sxs-lookup"><span data-stu-id="a766c-241">[Mutual Authentication Using Kerberos](https://go.microsoft.com/fwlink/?LinkId=299283) </span></span>  
 <span data-ttu-id="a766c-242">[如何配置 SQL Server 2008 Analysis Services 和 SQL Server 2005 Analysis Services 以使用 Kerberos 身份验证](https://support.microsoft.com/kb/917409) </span><span class="sxs-lookup"><span data-stu-id="a766c-242">[How to configure SQL Server 2008 Analysis Services and SQL Server 2005 Analysis Services to use Kerberos authentication](https://support.microsoft.com/kb/917409) </span></span>  
 <span data-ttu-id="a766c-243">[服务主体名称 (Spn) SetSPN 语法 ( # A0) ](https://social.technet.microsoft.com/wiki/contents/articles/717.service-principal-names-spns-setspn-syntax-setspn-exe.aspx) </span><span class="sxs-lookup"><span data-stu-id="a766c-243">[Service Principal Names (SPNs) SetSPN Syntax (Setspn.exe)](https://social.technet.microsoft.com/wiki/contents/articles/717.service-principal-names-spns-setspn-syntax-setspn-exe.aspx) </span></span>  
 <span data-ttu-id="a766c-244">[我使用什么 SPN，如何实现？](https://social.technet.microsoft.com/wiki/contents/articles/717.service-principal-names-spns-setspn-syntax-setspn-exe.aspx) </span><span class="sxs-lookup"><span data-stu-id="a766c-244">[What SPN do I use and how does it get there?](https://social.technet.microsoft.com/wiki/contents/articles/717.service-principal-names-spns-setspn-syntax-setspn-exe.aspx) </span></span>  
 <span data-ttu-id="a766c-245">[SetSPN](https://technet.microsoft.com/library/cc731241\(WS.10\).aspx) </span><span class="sxs-lookup"><span data-stu-id="a766c-245">[SetSPN](https://technet.microsoft.com/library/cc731241\(WS.10\).aspx) </span></span>  
 <span data-ttu-id="a766c-246">[服务帐户循序渐进指南](https://technet.microsoft.com/library/dd548356\(WS.10\).aspx) </span><span class="sxs-lookup"><span data-stu-id="a766c-246">[Service Accounts Step-by-Step Guide](https://technet.microsoft.com/library/dd548356\(WS.10\).aspx) </span></span>  
 <span data-ttu-id="a766c-247">[配置 Windows 服务帐户和权限](../../database-engine/configure-windows/configure-windows-service-accounts-and-permissions.md) </span><span class="sxs-lookup"><span data-stu-id="a766c-247">[Configure Windows Service Accounts and Permissions](../../database-engine/configure-windows/configure-windows-service-accounts-and-permissions.md) </span></span>  
 <span data-ttu-id="a766c-248">[如何在配置 Internet Information Services 上承载的 Web 应用程序时使用 Spn](https://support.microsoft.com/kb/929650) </span><span class="sxs-lookup"><span data-stu-id="a766c-248">[How to use SPNs when you configure Web applications that are hosted on Internet Information Services](https://support.microsoft.com/kb/929650) </span></span>  
 <span data-ttu-id="a766c-249">[服务帐户中的新增功能](https://technet.microsoft.com/library/dd367859\(WS.10\).aspx) </span><span class="sxs-lookup"><span data-stu-id="a766c-249">[what's new in service accounts](https://technet.microsoft.com/library/dd367859\(WS.10\).aspx) </span></span>  
 [<span data-ttu-id="a766c-250">配置用于 SharePoint 2010 产品的 Kerberos 身份验证（白皮书）</span><span class="sxs-lookup"><span data-stu-id="a766c-250">Configure Kerberos authentication for SharePoint 2010 Products (white paper)</span></span>](https://technet.microsoft.com/library/ff829837.aspx)  
  
  
