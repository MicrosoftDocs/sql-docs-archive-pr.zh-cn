---
title: SQL Server 代理 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ssms
ms.topic: conceptual
helpviewer_keywords:
- SQL Server Agent, about SQL Server Agent
- automatic administration steps
ms.assetid: 8d1dc600-aabb-416f-b3af-fbc9fccfd0ec
author: stevestein
ms.author: sstein
ms.openlocfilehash: e9de43e6bbb62deecd83b80095689c0ccbb8aedc
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/04/2020
ms.locfileid: "87692085"
---
# <a name="sql-server-agent"></a><span data-ttu-id="7a090-102">SQL Server 代理</span><span class="sxs-lookup"><span data-stu-id="7a090-102">SQL Server Agent</span></span>
  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="7a090-103">代理是一种 Microsoft Windows 服务，它在 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 中执行计划的管理任务，即“作业”\*\*。</span><span class="sxs-lookup"><span data-stu-id="7a090-103">Agent is a Microsoft Windows service that executes scheduled administrative tasks, which are called *jobs* in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span>  
  
 <span data-ttu-id="7a090-104">**本主题内容**</span><span class="sxs-lookup"><span data-stu-id="7a090-104">**In This Topic**</span></span>  
  
-   [<span data-ttu-id="7a090-105">SQL Server 代理的优点</span><span class="sxs-lookup"><span data-stu-id="7a090-105">Benefits of SQL Server Agent</span></span>](#Benefits)  
  
-   [<span data-ttu-id="7a090-106">SQL Server 代理的组件</span><span class="sxs-lookup"><span data-stu-id="7a090-106">Components of SQL Server Agent</span></span>](#Components)  
  
-   [<span data-ttu-id="7a090-107">SQL Server 代理管理的安全性</span><span class="sxs-lookup"><span data-stu-id="7a090-107">Security for SQL Server Agent Administration</span></span>](#Security)  
  
##  <a name="benefits-of-sql-server-agent"></a><a name="Benefits"></a><span data-ttu-id="7a090-108">SQL Server 代理的优点</span><span class="sxs-lookup"><span data-stu-id="7a090-108">Benefits of SQL Server Agent</span></span>  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="7a090-109">代理使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 来存储作业信息。</span><span class="sxs-lookup"><span data-stu-id="7a090-109">Agent uses [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to store job information.</span></span> <span data-ttu-id="7a090-110">作业包含一个或多个作业步骤。</span><span class="sxs-lookup"><span data-stu-id="7a090-110">Jobs contain one or more job steps.</span></span> <span data-ttu-id="7a090-111">每个步骤都有自己的任务。例如，备份数据库。</span><span class="sxs-lookup"><span data-stu-id="7a090-111">Each step contains its own task, for example, backing up a database.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="7a090-112">代理可以按照计划运行作业，也可以在响应特定事件时运行作业，还可以根据需要运行作业。</span><span class="sxs-lookup"><span data-stu-id="7a090-112">Agent can run a job on a schedule, in response to a specific event, or on demand.</span></span> <span data-ttu-id="7a090-113">例如，如果希望在每个工作日下班后备份公司的所有服务器，就可以使该任务自动执行。</span><span class="sxs-lookup"><span data-stu-id="7a090-113">For example, if you want to back up all the company servers every weekday after hours, you can automate this task.</span></span> <span data-ttu-id="7a090-114">将备份安排在星期一到星期五的 22:00 之后运行，如果备份出现问题，SQL Server 代理可记录该事件并通知您。</span><span class="sxs-lookup"><span data-stu-id="7a090-114">Schedule the backup to run after 22:00 Monday through Friday; if the backup encounters a problem, SQL Server Agent can record the event and notify you.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="7a090-115">默认情况下， [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 安装后 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 代理服务处于禁用状态，除非用户明确选择自动启动该服务。</span><span class="sxs-lookup"><span data-stu-id="7a090-115">By default, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent service is disabled when [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] is installed unless the user explicitly chooses to autostart the service.</span></span>  
  
##  <a name="sql-server-agent-components"></a><a name="Components"></a><span data-ttu-id="7a090-116">SQL Server 代理组件</span><span class="sxs-lookup"><span data-stu-id="7a090-116">SQL Server Agent Components</span></span>  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="7a090-117">代理使用下列组件来定义要执行的任务、执行任务的时间以及报告任务成功或失败的方式。</span><span class="sxs-lookup"><span data-stu-id="7a090-117">Agent uses the following components to define the tasks to be performed, when to perform the tasks, and how to report the success or failure of the tasks.</span></span>  
  
### <a name="jobs"></a><span data-ttu-id="7a090-118">作业</span><span class="sxs-lookup"><span data-stu-id="7a090-118">Jobs</span></span>  
 <span data-ttu-id="7a090-119">*作业*是代理执行的一系列指定操作 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="7a090-119">A *job* is a specified series of actions that [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent performs.</span></span> <span data-ttu-id="7a090-120">使用作业能够定义可一次或多次运行的，并且可以监视其成功或失败状态的管理任务。</span><span class="sxs-lookup"><span data-stu-id="7a090-120">Use jobs to define an administrative task that can be run one or more times and monitored for success or failure.</span></span> <span data-ttu-id="7a090-121">一个作业可在一台本地服务器或者多台远程服务器上运行。</span><span class="sxs-lookup"><span data-stu-id="7a090-121">A job can run on one local server or on multiple remote servers.</span></span>  
  
> [!IMPORTANT]  
>  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="7a090-122">故障转移群集实例上发生故障转移事件时正在运行的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理作业在故障转移到其他故障转移群集节点后不恢复。</span><span class="sxs-lookup"><span data-stu-id="7a090-122">Agent jobs that are running at the time of a failover event on a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] failover cluster instance do not resume after failover to another failover cluster node.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="7a090-123">在 Hyper-V 节点暂停时，如果该暂停导致故障转移到其他节点，则正在运行的代理作业不恢复。</span><span class="sxs-lookup"><span data-stu-id="7a090-123">Agent jobs that are running at the time a Hyper-V node is paused do not resume if the pause causes a failover to another node.</span></span> <span data-ttu-id="7a090-124">已开始但由于故障转移事件而未能完成的作业在日志中记录为已开始，但不提供附加的条目来指明完成或失败。</span><span class="sxs-lookup"><span data-stu-id="7a090-124">Jobs that begin but fail to complete because of a failover event are logged as started, but do not show additional log entries for completion or failure.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="7a090-125">代理作业好像永远不会结束。</span><span class="sxs-lookup"><span data-stu-id="7a090-125">Agent jobs in these scenarios appear to have never ended.</span></span>  
  
 <span data-ttu-id="7a090-126">可以通过下列几种方式来运行作业：</span><span class="sxs-lookup"><span data-stu-id="7a090-126">You can run jobs in several ways:</span></span>  
  
-   <span data-ttu-id="7a090-127">根据一个或多个计划。</span><span class="sxs-lookup"><span data-stu-id="7a090-127">According to one or more schedules.</span></span>  
  
-   <span data-ttu-id="7a090-128">响应一个或多个警报。</span><span class="sxs-lookup"><span data-stu-id="7a090-128">In response to one or more alerts.</span></span>  
  
-   <span data-ttu-id="7a090-129">通过执行 sp_start_job 存储过程。</span><span class="sxs-lookup"><span data-stu-id="7a090-129">By executing the sp_start_job stored procedure.</span></span>  
  
 <span data-ttu-id="7a090-130">作业中的每个操作都是一个“作业步骤” \*\*。</span><span class="sxs-lookup"><span data-stu-id="7a090-130">Each action in a job is a *job step*.</span></span> <span data-ttu-id="7a090-131">例如，作业步骤可以运行 [!INCLUDE[tsql](../../includes/tsql-md.md)] 语句、执行 [!INCLUDE[ssIS](../../includes/ssis-md.md)] 包或向 Analysis Services 服务器发出命令。</span><span class="sxs-lookup"><span data-stu-id="7a090-131">For example, a job step might consist of running a [!INCLUDE[tsql](../../includes/tsql-md.md)] statement, executing an [!INCLUDE[ssIS](../../includes/ssis-md.md)] package, or issuing a command to an Analysis Services server.</span></span> <span data-ttu-id="7a090-132">作业步骤作为作业的一部分进行管理。</span><span class="sxs-lookup"><span data-stu-id="7a090-132">Job steps are managed as part of a job.</span></span>  
  
 <span data-ttu-id="7a090-133">所有作业步骤均在特定的安全上下文中运行。</span><span class="sxs-lookup"><span data-stu-id="7a090-133">Each job step runs in a specific security context.</span></span> <span data-ttu-id="7a090-134">对于使用 [!INCLUDE[tsql](../../includes/tsql-md.md)]的作业步骤，请使用 EXECUTE AS 语句设置作业步骤的安全上下文。</span><span class="sxs-lookup"><span data-stu-id="7a090-134">For job steps that use [!INCLUDE[tsql](../../includes/tsql-md.md)], use the EXECUTE AS statement to set the security context for the job step.</span></span> <span data-ttu-id="7a090-135">对于其他类型的作业步骤，请使用代理帐户来设置作业步骤的安全上下文。</span><span class="sxs-lookup"><span data-stu-id="7a090-135">For other types of job steps, use a proxy account to set the security context for the job step.</span></span>  
  
### <a name="schedules"></a><span data-ttu-id="7a090-136">计划</span><span class="sxs-lookup"><span data-stu-id="7a090-136">Schedules</span></span>  
 <span data-ttu-id="7a090-137">*计划*指定作业运行的时间。</span><span class="sxs-lookup"><span data-stu-id="7a090-137">A *schedule* specifies when a job runs.</span></span> <span data-ttu-id="7a090-138">多个作业可按同一计划运行，可将多个计划应用到同一作业。</span><span class="sxs-lookup"><span data-stu-id="7a090-138">More than one job can run on the same schedule, and more than one schedule can apply to the same job.</span></span> <span data-ttu-id="7a090-139">计划可为作业运行时间定义以下条件：</span><span class="sxs-lookup"><span data-stu-id="7a090-139">A schedule can define the following conditions for the time when a job runs:</span></span>  
  
-   <span data-ttu-id="7a090-140">每当 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理启动时。</span><span class="sxs-lookup"><span data-stu-id="7a090-140">Whenever [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent starts.</span></span>  
  
-   <span data-ttu-id="7a090-141">每当计算机的 CPU 使用率处于定义的空闲状态水平时。</span><span class="sxs-lookup"><span data-stu-id="7a090-141">Whenever CPU utilization of the computer is at a level you have defined as idle.</span></span>  
  
-   <span data-ttu-id="7a090-142">在特定日期和时间运行一次。</span><span class="sxs-lookup"><span data-stu-id="7a090-142">One time, at a specific date and time.</span></span>  
  
-   <span data-ttu-id="7a090-143">按重复的计划运行。</span><span class="sxs-lookup"><span data-stu-id="7a090-143">On a recurring schedule.</span></span>  
  
 <span data-ttu-id="7a090-144">有关详细信息，请参阅 [创建计划并将计划附加到作业](create-and-attach-schedules-to-jobs.md)。</span><span class="sxs-lookup"><span data-stu-id="7a090-144">For more information, see [Create and Attach Schedules to Jobs](create-and-attach-schedules-to-jobs.md).</span></span>  
  
### <a name="alerts"></a><span data-ttu-id="7a090-145">警报</span><span class="sxs-lookup"><span data-stu-id="7a090-145">Alerts</span></span>  
 <span data-ttu-id="7a090-146">“警报” \*\* 是对特定事件的自动响应。</span><span class="sxs-lookup"><span data-stu-id="7a090-146">An *alert* is an automatic response to a specific event.</span></span> <span data-ttu-id="7a090-147">例如，事件可以是启动的作业，也可以是达到特定阈值的系统资源。</span><span class="sxs-lookup"><span data-stu-id="7a090-147">For example, an event can be a job that starts or system resources that reach a specific threshold.</span></span> <span data-ttu-id="7a090-148">可以定义警报产生的条件。</span><span class="sxs-lookup"><span data-stu-id="7a090-148">You define the conditions under which an alert occurs.</span></span>  
  
 <span data-ttu-id="7a090-149">警报可以响应下列任一条件：</span><span class="sxs-lookup"><span data-stu-id="7a090-149">An alert can respond to one of the following conditions:</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="7a090-150">事件</span><span class="sxs-lookup"><span data-stu-id="7a090-150">events</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="7a090-151">性能条件</span><span class="sxs-lookup"><span data-stu-id="7a090-151">performance conditions</span></span>  
  
-   <span data-ttu-id="7a090-152">运行 SQL Server 代理的计算机上的 Microsoft Windows Management Instrumentation (WMI) 事件</span><span class="sxs-lookup"><span data-stu-id="7a090-152">Microsoft Windows Management Instrumentation (WMI) events on the computer where SQL Server Agent is running</span></span>  
  
 <span data-ttu-id="7a090-153">警报可以执行下列操作：</span><span class="sxs-lookup"><span data-stu-id="7a090-153">An alert can perform the following actions:</span></span>  
  
-   <span data-ttu-id="7a090-154">通知一个或多个操作员</span><span class="sxs-lookup"><span data-stu-id="7a090-154">Notify one or more operators</span></span>  
  
-   <span data-ttu-id="7a090-155">运行作业</span><span class="sxs-lookup"><span data-stu-id="7a090-155">Run a job</span></span>  
  
 <span data-ttu-id="7a090-156">有关详细信息，请参阅 [“警报”](alerts.md)。</span><span class="sxs-lookup"><span data-stu-id="7a090-156">For more information, see [Alerts](alerts.md).</span></span>  
  
### <a name="operators"></a><span data-ttu-id="7a090-157">运算符</span><span class="sxs-lookup"><span data-stu-id="7a090-157">Operators</span></span>  
 <span data-ttu-id="7a090-158">“操作员” \*\* 定义的是负责维护一个或多个 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]实例的个人的联系信息。</span><span class="sxs-lookup"><span data-stu-id="7a090-158">An *operator* defines contact information for an individual responsible for the maintenance of one or more instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="7a090-159">在有些企业中，操作员职责被分配给一个人。</span><span class="sxs-lookup"><span data-stu-id="7a090-159">In some enterprises, operator responsibilities are assigned to one individual.</span></span> <span data-ttu-id="7a090-160">在拥有多个服务器的企业中，操作员职责可以由多人分担。</span><span class="sxs-lookup"><span data-stu-id="7a090-160">In enterprises with multiple servers, many individuals can share operator responsibilities.</span></span> <span data-ttu-id="7a090-161">操作员不涉及安全信息，因此不会定义安全主体。</span><span class="sxs-lookup"><span data-stu-id="7a090-161">An operator does not contain security information, and does not define a security principal.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="7a090-162">可以通过下列一种或多种方式通知操作员有警报出现：</span><span class="sxs-lookup"><span data-stu-id="7a090-162">can notify operators of alerts through one or more of the following:</span></span>  
  
-   <span data-ttu-id="7a090-163">电子邮件</span><span class="sxs-lookup"><span data-stu-id="7a090-163">E-mail</span></span>  
  
-   <span data-ttu-id="7a090-164">寻呼程序（通过电子邮件）</span><span class="sxs-lookup"><span data-stu-id="7a090-164">Pager (through e-mail)</span></span>  
  
-   <span data-ttu-id="7a090-165">**net send**</span><span class="sxs-lookup"><span data-stu-id="7a090-165">**net send**</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="7a090-166">**代理所在的计算机必须启动 Windows Messenger 服务，才能使用**net send [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 发送通知。</span><span class="sxs-lookup"><span data-stu-id="7a090-166">To send notifications by using **net send**, the Windows Messenger service must be started on the computer where [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent resides.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="7a090-167">在 **的未来版本中，将从** 代理中删除寻呼程序和 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] net send [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]选项。</span><span class="sxs-lookup"><span data-stu-id="7a090-167">The Pager and **net send** options will be removed from [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent in a future version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="7a090-168">请避免在新的开发工作中使用这些功能，并考虑修改当前使用这些功能的应用程序。</span><span class="sxs-lookup"><span data-stu-id="7a090-168">Avoid using these features in new development work, and plan to modify applications that currently use these features.</span></span>  
  
 <span data-ttu-id="7a090-169">若要使用电子邮件或寻呼程序向操作员发送通知，必须将 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理配置为使用数据库邮件。</span><span class="sxs-lookup"><span data-stu-id="7a090-169">To send notifications to operators by using e-mail or pagers, you must configure [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent to use Database Mail.</span></span> <span data-ttu-id="7a090-170">有关详细信息，请参阅[数据库邮件](../../relational-databases/database-mail/database-mail.md)。</span><span class="sxs-lookup"><span data-stu-id="7a090-170">For more information, see [Database Mail](../../relational-databases/database-mail/database-mail.md).</span></span>  
  
 <span data-ttu-id="7a090-171">可以将操作员定义为一组个人的别名。</span><span class="sxs-lookup"><span data-stu-id="7a090-171">You can define an operator as the alias for a group of individuals.</span></span> <span data-ttu-id="7a090-172">这样，该组的所有成员就可以同时收到通知。</span><span class="sxs-lookup"><span data-stu-id="7a090-172">In this way, all members of that alias are notified at the same time.</span></span> <span data-ttu-id="7a090-173">有关详细信息，请参阅[运算符](operators.md)。</span><span class="sxs-lookup"><span data-stu-id="7a090-173">For more information, see [Operators](operators.md).</span></span>  
  
##  <a name="security-for-sql-server-agent-administration"></a><a name="Security"></a><span data-ttu-id="7a090-174">SQL Server 代理管理的安全性</span><span class="sxs-lookup"><span data-stu-id="7a090-174">Security for SQL Server Agent Administration</span></span>  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]<span data-ttu-id="7a090-175">代理使用**msdb**数据库中的**SQLAgentUserRole**、 **SQLAgentReaderRole**和**SQLAgentOperatorRole**固定数据库角色来控制对 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 不是 `sysadmin` 固定服务器角色成员的用户对代理的访问。</span><span class="sxs-lookup"><span data-stu-id="7a090-175">Agent uses the **SQLAgentUserRole**, **SQLAgentReaderRole**, and **SQLAgentOperatorRole** fixed database roles in the **msdb** database to control access to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent for users who are not members of the `sysadmin` fixed server role.</span></span> <span data-ttu-id="7a090-176">除了这些固定数据库角色之外，子系统和代理还有助于数据库管理员确保每个作业步骤运行时都具有执行其任务所需的最低权限。</span><span class="sxs-lookup"><span data-stu-id="7a090-176">In addition to these fixed database roles, subsystems and proxies help database administrators ensure that each job step runs with the minimum permissions required to perform its task.</span></span>  
  
### <a name="roles"></a><span data-ttu-id="7a090-177">角色</span><span class="sxs-lookup"><span data-stu-id="7a090-177">Roles</span></span>  
 <span data-ttu-id="7a090-178">**Msdb**中的**SQLAgentUserRole**、 **SQLAgentReaderRole**和**SQLAgentOperatorRole**固定数据库角色的成员以及 `sysadmin` 固定服务器角色的成员都有权访问 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理。</span><span class="sxs-lookup"><span data-stu-id="7a090-178">Members of the **SQLAgentUserRole**, **SQLAgentReaderRole**, and **SQLAgentOperatorRole** fixed database roles in **msdb**, and members of the `sysadmin` fixed server role have access to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent.</span></span> <span data-ttu-id="7a090-179">不属于这些角色的用户不能使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理。</span><span class="sxs-lookup"><span data-stu-id="7a090-179">A user that does not belong to any of these roles cannot use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent.</span></span> <span data-ttu-id="7a090-180">有关用于 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理的角色的详细信息，请参阅 [实现 SQL Server 代理安全性](implement-sql-server-agent-security.md)。</span><span class="sxs-lookup"><span data-stu-id="7a090-180">For more information on the roles used by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent, see [Implement SQL Server Agent Security](implement-sql-server-agent-security.md).</span></span>  
  
### <a name="subsystems"></a><span data-ttu-id="7a090-181">子系统</span><span class="sxs-lookup"><span data-stu-id="7a090-181">Subsystems</span></span>  
 <span data-ttu-id="7a090-182">子系统是预定义的对象，表示作业步骤可用的功能。</span><span class="sxs-lookup"><span data-stu-id="7a090-182">A subsystem is a predefined object that represents functionality that is available to a job step.</span></span> <span data-ttu-id="7a090-183">每个代理都可以访问一个或多个子系统。</span><span class="sxs-lookup"><span data-stu-id="7a090-183">Each proxy has access to one or more subsystems.</span></span> <span data-ttu-id="7a090-184">子系统可以提供安全性，因为它们分隔了对可用于代理的功能的访问。</span><span class="sxs-lookup"><span data-stu-id="7a090-184">Subsystems provide security because they delimit access to the functionality that is available to a proxy.</span></span> <span data-ttu-id="7a090-185">除了 [!INCLUDE[tsql](../../includes/tsql-md.md)] 作业步骤，每个作业步骤都在代理的上下文中运行。</span><span class="sxs-lookup"><span data-stu-id="7a090-185">Each job step runs in the context of a proxy, except for [!INCLUDE[tsql](../../includes/tsql-md.md)] job steps.</span></span> [!INCLUDE[tsql](../../includes/tsql-md.md)] <span data-ttu-id="7a090-186">作业步骤使用 EXECUTE AS 命令设置安全上下文。</span><span class="sxs-lookup"><span data-stu-id="7a090-186">job steps use the EXECUTE AS command to set the security context.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="7a090-187">定义了下表中列出的子系统：</span><span class="sxs-lookup"><span data-stu-id="7a090-187">defines the subsystems listed in the following table:</span></span>  
  
|<span data-ttu-id="7a090-188">子系统名称</span><span class="sxs-lookup"><span data-stu-id="7a090-188">Subsystem name</span></span>|<span data-ttu-id="7a090-189">说明</span><span class="sxs-lookup"><span data-stu-id="7a090-189">Description</span></span>|  
|--------------------|-----------------|  
|<span data-ttu-id="7a090-190">Microsoft ActiveX 脚本</span><span class="sxs-lookup"><span data-stu-id="7a090-190">Microsoft ActiveX Script</span></span>|<span data-ttu-id="7a090-191">运行 ActiveX 脚本作业步骤。</span><span class="sxs-lookup"><span data-stu-id="7a090-191">Run an ActiveX scripting job step.</span></span><br /><br /> <span data-ttu-id="7a090-192">\*\* \* \* 重要 \* 提示 \* \*\*在的未来版本中，将从代理中删除 ActiveX 脚本编写子系统 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="7a090-192">**\*\* Important \*\*** The ActiveX Scripting subsystem will be removed from [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent in a future version of [!INCLUDE[msCoName](../../includes/msconame-md.md)][!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="7a090-193">请避免在新的开发工作中使用该功能，并着手修改当前还在使用该功能的应用程序。</span><span class="sxs-lookup"><span data-stu-id="7a090-193">Avoid using this feature in new development work, and plan to modify applications that currently use this feature.</span></span>|  
|<span data-ttu-id="7a090-194">操作系统 (**CmdExec**)</span><span class="sxs-lookup"><span data-stu-id="7a090-194">Operating System (**CmdExec**)</span></span>|<span data-ttu-id="7a090-195">运行可执行程序。</span><span class="sxs-lookup"><span data-stu-id="7a090-195">Run an executable program.</span></span>|  
|<span data-ttu-id="7a090-196">PowerShell</span><span class="sxs-lookup"><span data-stu-id="7a090-196">PowerShell</span></span>|<span data-ttu-id="7a090-197">运行 PowerShell 脚本作业步骤。</span><span class="sxs-lookup"><span data-stu-id="7a090-197">Run a PowerShell scripting job step.</span></span>|  
|<span data-ttu-id="7a090-198">复制分发服务器</span><span class="sxs-lookup"><span data-stu-id="7a090-198">Replication Distributor</span></span>|<span data-ttu-id="7a090-199">运行激活复制分发服务器代理的作业步骤。</span><span class="sxs-lookup"><span data-stu-id="7a090-199">Run a job step that activates the replication Distribution Agent.</span></span>|  
|<span data-ttu-id="7a090-200">复制合并</span><span class="sxs-lookup"><span data-stu-id="7a090-200">Replication Merge</span></span>|<span data-ttu-id="7a090-201">运行激活复制合并代理的作业步骤。</span><span class="sxs-lookup"><span data-stu-id="7a090-201">Run a job step that activates the replication Merge Agent.</span></span>|  
|<span data-ttu-id="7a090-202">复制队列读取器</span><span class="sxs-lookup"><span data-stu-id="7a090-202">Replication Queue Reader</span></span>|<span data-ttu-id="7a090-203">运行激活复制队列读取器代理的作业步骤。</span><span class="sxs-lookup"><span data-stu-id="7a090-203">Run a job step that activates the replication Queue Reader Agent.</span></span>|  
|<span data-ttu-id="7a090-204">复制快照</span><span class="sxs-lookup"><span data-stu-id="7a090-204">Replication Snapshot</span></span>|<span data-ttu-id="7a090-205">运行激活复制快照代理的作业步骤。</span><span class="sxs-lookup"><span data-stu-id="7a090-205">Run a job step that activates the replication Snapshot Agent.</span></span>|  
|<span data-ttu-id="7a090-206">复制事务日志读取器</span><span class="sxs-lookup"><span data-stu-id="7a090-206">Replication Transaction Log Reader</span></span>|<span data-ttu-id="7a090-207">运行激活复制日志读取器代理的作业步骤。</span><span class="sxs-lookup"><span data-stu-id="7a090-207">Run a job step that activates the replication Log Reader Agent.</span></span>|  
|[!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] <span data-ttu-id="7a090-208">命令</span><span class="sxs-lookup"><span data-stu-id="7a090-208">Command</span></span>|<span data-ttu-id="7a090-209">运行 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 命令。</span><span class="sxs-lookup"><span data-stu-id="7a090-209">Run an [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] command.</span></span>|  
|[!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] <span data-ttu-id="7a090-210">Query</span><span class="sxs-lookup"><span data-stu-id="7a090-210">Query</span></span>|<span data-ttu-id="7a090-211">运行 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 查询。</span><span class="sxs-lookup"><span data-stu-id="7a090-211">Run an [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] query.</span></span>|  
|[!INCLUDE[ssIS](../../includes/ssis-md.md)] <span data-ttu-id="7a090-212">包执行</span><span class="sxs-lookup"><span data-stu-id="7a090-212">package execution</span></span>|<span data-ttu-id="7a090-213">运行 [!INCLUDE[ssIS](../../includes/ssis-md.md)] 包。</span><span class="sxs-lookup"><span data-stu-id="7a090-213">Run an [!INCLUDE[ssIS](../../includes/ssis-md.md)] package.</span></span>|  
  
> [!NOTE]  
>  <span data-ttu-id="7a090-214">因为 [!INCLUDE[tsql](../../includes/tsql-md.md)] 作业步骤不使用代理，因此没有针对 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 作业步骤的 [!INCLUDE[tsql](../../includes/tsql-md.md)] 代理子系统。</span><span class="sxs-lookup"><span data-stu-id="7a090-214">Because [!INCLUDE[tsql](../../includes/tsql-md.md)] job steps do not use proxies, there is no [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent subsystem for [!INCLUDE[tsql](../../includes/tsql-md.md)] job steps.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="7a090-215">代理仍将强制限制子系统。</span><span class="sxs-lookup"><span data-stu-id="7a090-215">Agent enforces subsystem restrictions even when the security principal for the proxy would normally have permission to run the task in the job step.</span></span> <span data-ttu-id="7a090-216">例如，如果一个用户是 sysadmin 固定服务器角色的成员，则即使该用户可以运行 [!INCLUDE[ssIS](../../includes/ssis-md.md)] 包，其代理仍将无法运行 [!INCLUDE[ssIS](../../includes/ssis-md.md)] 作业步骤，除非该代理可以访问 [!INCLUDE[ssIS](../../includes/ssis-md.md)] 子系统。</span><span class="sxs-lookup"><span data-stu-id="7a090-216">For example, a proxy for a user that is a member of the sysadmin fixed server role cannot run an [!INCLUDE[ssIS](../../includes/ssis-md.md)] job step unless the proxy has access to the [!INCLUDE[ssIS](../../includes/ssis-md.md)] subsystem, even though the user can run [!INCLUDE[ssIS](../../includes/ssis-md.md)] packages.</span></span>  
  
### <a name="proxies"></a><span data-ttu-id="7a090-217">代理</span><span class="sxs-lookup"><span data-stu-id="7a090-217">Proxies</span></span>  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="7a090-218">代理使用代理管理安全上下文。</span><span class="sxs-lookup"><span data-stu-id="7a090-218">Agent uses proxies to manage security contexts.</span></span> <span data-ttu-id="7a090-219">一个代理可用于多个作业步骤。</span><span class="sxs-lookup"><span data-stu-id="7a090-219">A proxy can be used in more than one job step.</span></span> <span data-ttu-id="7a090-220">`sysadmin`固定服务器角色的成员可创建代理。</span><span class="sxs-lookup"><span data-stu-id="7a090-220">Members of the `sysadmin` fixed server role can create proxies.</span></span>  
  
 <span data-ttu-id="7a090-221">每个代理对应于一个安全凭据。</span><span class="sxs-lookup"><span data-stu-id="7a090-221">Each proxy corresponds to a security credential.</span></span> <span data-ttu-id="7a090-222">每个代理都可与一组子系统和一组登录名相关联。</span><span class="sxs-lookup"><span data-stu-id="7a090-222">Each proxy can be associated with a set of subsystems and a set of logins.</span></span> <span data-ttu-id="7a090-223">代理仅可用于使用与该代理相关联的子系统的作业步骤。</span><span class="sxs-lookup"><span data-stu-id="7a090-223">The proxy can be used only for job steps that use a subsystem associated with the proxy.</span></span> <span data-ttu-id="7a090-224">若要创建使用特定代理的作业步骤，作业所有者必须使用与此代理相关联的登录名，或者是对代理具有无限访问权限的角色成员。</span><span class="sxs-lookup"><span data-stu-id="7a090-224">To create a job step that uses a specific proxy, the job owner must either use a login associated with that proxy or be a member of a role with unrestricted access to proxies.</span></span> <span data-ttu-id="7a090-225">`sysadmin`固定服务器角色的成员可以无限制地访问代理。</span><span class="sxs-lookup"><span data-stu-id="7a090-225">Members of the `sysadmin` fixed server role have unrestricted access to proxies.</span></span> <span data-ttu-id="7a090-226">**SQLAgentUserRole**、 **SQLAgentReaderRole**或 **SQLAgentOperatorRole** 的成员仅能使用授予他们特定访问权限的代理。</span><span class="sxs-lookup"><span data-stu-id="7a090-226">Members of **SQLAgentUserRole**, **SQLAgentReaderRole**, or **SQLAgentOperatorRole** can only use proxies to which they have been granted specific access.</span></span> <span data-ttu-id="7a090-227">这些 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理固定数据库角色的每个成员用户必须获得访问特定代理的权限，才能创建使用那些代理的作业步骤。</span><span class="sxs-lookup"><span data-stu-id="7a090-227">Each user that is a member of any of these [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent fixed database roles must be granted access to specific proxies so that the user can create job steps that use those proxies.</span></span>  
  
## <a name="related-tasks"></a><span data-ttu-id="7a090-228">Related Tasks</span><span class="sxs-lookup"><span data-stu-id="7a090-228">Related Tasks</span></span>  
 <span data-ttu-id="7a090-229">使用以下步骤来配置 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理以自动管理 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ：</span><span class="sxs-lookup"><span data-stu-id="7a090-229">Use the following steps to configure [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent to automate [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] administration:</span></span>  
  
1.  <span data-ttu-id="7a090-230">确定哪些管理任务或服务器事件定期执行以及这些任务或事件是否可以通过编程方式进行管理。</span><span class="sxs-lookup"><span data-stu-id="7a090-230">Establish which administrative tasks or server events occur regularly and whether these tasks or events can be administered programmatically.</span></span> <span data-ttu-id="7a090-231">如果任务涉及一系列可预见的步骤并且在特定时间或响应特定事件时执行，则该任务非常适合自动化。</span><span class="sxs-lookup"><span data-stu-id="7a090-231">A task is a good candidate for automation if it involves a predictable sequence of steps and occurs at a specific time or in response to a specific event.</span></span>  
  
2.  <span data-ttu-id="7a090-232">使用 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]、 [!INCLUDE[tsql](../../includes/tsql-md.md)] 脚本或 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 管理对象 (SMO) 定义一组作业、计划、警报和操作员。</span><span class="sxs-lookup"><span data-stu-id="7a090-232">Define a set of jobs, schedules, alerts, and operators by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)] scripts, or [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Management Objects (SMO).</span></span> <span data-ttu-id="7a090-233">有关详细信息，请参阅 [创建作业](create-jobs.md)。</span><span class="sxs-lookup"><span data-stu-id="7a090-233">For more information, see [Create Jobs](create-jobs.md).</span></span>  
  
3.  <span data-ttu-id="7a090-234">运行已定义的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理作业。</span><span class="sxs-lookup"><span data-stu-id="7a090-234">Run the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent jobs you have defined.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="7a090-235">对于默认的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]实例， [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 服务将被命名为 SQLSERVERAGENT。</span><span class="sxs-lookup"><span data-stu-id="7a090-235">For the default instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] service is named SQLSERVERAGENT.</span></span> <span data-ttu-id="7a090-236">对于命名实例， [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理服务将被命名为 SQLAgent$*instancename*。</span><span class="sxs-lookup"><span data-stu-id="7a090-236">For named instances, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent service is named SQLAgent$*instancename*.</span></span>  
  
 <span data-ttu-id="7a090-237">如果您正在运行 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]的多个实例，则可以使用多服务器管理来自动管理所有实例的公共任务。</span><span class="sxs-lookup"><span data-stu-id="7a090-237">If you are running multiple instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], you can use multiserver administration to automate tasks common across all instances.</span></span> <span data-ttu-id="7a090-238">有关详细信息，请参阅 [企业范围的自动化管理](automated-administration-across-an-enterprise.md)。</span><span class="sxs-lookup"><span data-stu-id="7a090-238">For more information, see [Automated Administration Across an Enterprise](automated-administration-across-an-enterprise.md).</span></span>  
  
 <span data-ttu-id="7a090-239">通过以下任务以开始使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理：</span><span class="sxs-lookup"><span data-stu-id="7a090-239">Use the following tasks to get started with [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent:</span></span>  
  
|||  
|-|-|  
|<span data-ttu-id="7a090-240">**说明**</span><span class="sxs-lookup"><span data-stu-id="7a090-240">**Description**</span></span>|<span data-ttu-id="7a090-241">**主题**</span><span class="sxs-lookup"><span data-stu-id="7a090-241">**Topic**</span></span>|  
|<span data-ttu-id="7a090-242">介绍如何配置 SQL Server 代理。</span><span class="sxs-lookup"><span data-stu-id="7a090-242">Describes how to configure SQL Server Agent.</span></span>|[<span data-ttu-id="7a090-243">配置 SQL Server 代理</span><span class="sxs-lookup"><span data-stu-id="7a090-243">Configure SQL Server Agent</span></span>](configure-sql-server-agent.md)|  
|<span data-ttu-id="7a090-244">介绍如何启动、停止和暂停 SQL Server 代理服务。</span><span class="sxs-lookup"><span data-stu-id="7a090-244">Describes how to start, stop, and pause the SQL Server Agent service.</span></span>|[<span data-ttu-id="7a090-245">启动、停止或暂停 SQL Server 代理服务</span><span class="sxs-lookup"><span data-stu-id="7a090-245">Start, Stop, or Pause the SQL Server Agent Service</span></span>](start-stop-or-pause-the-sql-server-agent-service.md)|  
|<span data-ttu-id="7a090-246">介绍为 SQL Server 代理服务指定帐户时的注意事项。</span><span class="sxs-lookup"><span data-stu-id="7a090-246">Describes considerations for specifying an account for the SQL Server Agent service.</span></span>|[<span data-ttu-id="7a090-247">为 SQL Server 代理服务选择帐户</span><span class="sxs-lookup"><span data-stu-id="7a090-247">Select an Account for the SQL Server Agent Service</span></span>](select-an-account-for-the-sql-server-agent-service.md)|  
|<span data-ttu-id="7a090-248">介绍如何使用 SQL Server 代理错误日志。</span><span class="sxs-lookup"><span data-stu-id="7a090-248">Describes how to use the SQL Server Agent error log.</span></span>|[<span data-ttu-id="7a090-249">SQL Server 代理错误日志</span><span class="sxs-lookup"><span data-stu-id="7a090-249">SQL Server Agent Error Log</span></span>](sql-server-agent-error-log.md)|  
|||  
|<span data-ttu-id="7a090-250">介绍如何使用性能对象。</span><span class="sxs-lookup"><span data-stu-id="7a090-250">Describes how to use performance objects.</span></span>|[<span data-ttu-id="7a090-251">使用性能对象</span><span class="sxs-lookup"><span data-stu-id="7a090-251">Use Performance Objects</span></span>](use-performance-objects.md)|  
|<span data-ttu-id="7a090-252">介绍维护计划向导，它是一个实用工具，可用来帮助您创建作业、警报和运算符以对 SQL Server 实例进行自动管理。</span><span class="sxs-lookup"><span data-stu-id="7a090-252">Describes the Maintenance Plan Wizard, which is a utility that you can use to help create jobs, alerts, and operators to automate administration of an instance of SQL Server.</span></span>|[<span data-ttu-id="7a090-253">使用维护计划向导</span><span class="sxs-lookup"><span data-stu-id="7a090-253">Use the Maintenance Plan Wizard</span></span>](../../relational-databases/maintenance-plans/use-the-maintenance-plan-wizard.md)|  
|<span data-ttu-id="7a090-254">介绍如何使用 SQL Server 代理将管理任务自动化。</span><span class="sxs-lookup"><span data-stu-id="7a090-254">Describes how to automate administrative tasks using SQL Server Agent.</span></span>|[<span data-ttu-id="7a090-255">自动执行管理任务（SQL Server 代理）</span><span class="sxs-lookup"><span data-stu-id="7a090-255">Automated Administration Tasks &#40;SQL Server Agent&#41;</span></span>](automated-administration-tasks-sql-server-agent.md)|  
  
## <a name="see-also"></a><span data-ttu-id="7a090-256">另请参阅</span><span class="sxs-lookup"><span data-stu-id="7a090-256">See Also</span></span>  
 [<span data-ttu-id="7a090-257">外围应用配置器</span><span class="sxs-lookup"><span data-stu-id="7a090-257">Surface Area Configuration</span></span>](../../relational-databases/security/surface-area-configuration.md)  
  
  
